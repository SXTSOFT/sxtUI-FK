<md-tabs md-border-bottom flex layout="column">
  <md-tab label="任务流程"  >
    <md-tab-content flex layout-fill layout="row">
      <md-content layout="row" flex ms-scroll >
        <div style="min-width:900px;max-width:100%;width:100%;" layout="row" layout-align="start start">
        <div flex="100" layout="row"  layout-align="center start" class="mt-20" ng-show="vm.loading">
          <md-progress-circular md-mode="indeterminate"></md-progress-circular>
        </div>
        <div flex="80" ng-show="!vm.loading">
          <div class="white-placeholder" style="display: none;">
            <input type="text">
          </div>
          <table class="simple">
            <thead>
            <tr>
              <th>流程</th>
              <th style="width: 24px;min-width: 24px">
                <md-menu ng-show="vm.flows && vm.flows.length===0">
                <span aria-label="任务流程" class="md-icon-button" ng-click="$mdOpenMenu($event)">
                  <md-icon md-font-icon="icon-plus" ng-click="$mdOpenMenu($event)"></md-icon>
                </span>
                  <md-menu-content>
                    <md-menu-item>
                      <md-button ng-click="vm.addNext($event,null, vm.flows.length)">
                        添加主线
                      </md-button>
                    </md-menu-item>
                  </md-menu-content>
                </md-menu>
              </th>
              <th ng-if="vm.data.Level==0" style="width: 24px;min-width: 24px">必选</th>
              <th style="width: 24px;min-width: 24px" ng-if="vm.data.Level==0">变量</th>
              <th ng-if="vm.data.Level==0" style="width: 80px;min-width: 80px">可选任务</th>
              <th style="width: 60px;min-width: 60px">通知</th>
              <th style="width: 60px;min-width: 60px">执行</th>
              <th ng-if="vm.data.Level==0" style="width: 110px;min-width: 110px">里程碑/介入点</th>
              <th ng-if="vm.data.Level==0" style="width: 24px;min-width: 24px">楼层</th>
            </tr>
            </thead>
            <tr ng-repeat="flow in vm.flows track by flow.TaskFlowId" style="height:44px;">
              <td ng-style="{'padding-left':(10+(flow.line===0?0:1)*12)+'px'}" style="white-space: nowrap;">
                {{$index+1}}、<input type="text" ng-blur="vm.updateFlowName(flow)"  ng-model="flow.Name">
              </td>
              <td>
                <md-menu>
                <span aria-label="添加" class="md-icon-button" ng-click="$mdOpenMenu($event);vm.setBack(flow)">
                  <md-icon md-font-icon="icon-plus"></md-icon>
                </span>
                  <md-menu-content>
                    <md-menu-item ng-if="vm.data.Level!==0 || flow.line===0">
                      <md-button ng-click="vm.addNext($event,flow)">
                        下一主线
                      </md-button>
                    </md-menu-item>
                    <md-menu-item ng-if="vm.data.Level!==0 || flow.line===0">
                      <md-button ng-click="vm.addNext($event,flow,true)">
                        添加分支
                      </md-button>
                    </md-menu-item>
                    <md-menu-item ng-if="flow.line!==0">
                      <md-menu>
                        <md-button style="margin:0;padding: 0 16px;height: 48px" ng-click="$mdOpenMenu()">后置任务</md-button>
                        <md-menu-content>
                          <md-menu-item ng-if="flow.EndFlagTaskFlowId">
                            <md-button ng-click="vm.setEndFlow(flow)">
                              清除后置
                            </md-button>
                          </md-menu-item>
                          <md-menu-item ng-repeat="f2 in vm.flows|filter:{showBack:true}">
                            <md-button ng-click="vm.setEndFlow(flow,f2)">
                              {{f2.Name}}
                            </md-button>
                          </md-menu-item>
                        </md-menu-content>
                      </md-menu>
                    </md-menu-item>
                    <md-menu-item>
                      <md-button ng-click="vm.removeFlow($event,flow)">
                        删除节点
                      </md-button>
                    </md-menu-item>
                  </md-menu-content>
                </md-menu>
              </td>
              <td ng-if="vm.data.Level==0" align="center"><input  ng-if="flow.line==0" type="checkbox" ng-model="flow.IsRequired" ng-click="vm.updateFlow(flow)"></td>
              <td ng-if="vm.data.Level == 0"><input ng-if="flow.line==0" style="width:90%;color:#C62828" placeholder="无" type="text" ng-blur="vm.updateExpression(flow)" ng-model="flow.Expression" ></td>
              <td ng-if="vm.data.Level==0">
                <div style="white-space: nowrap;width: 80px;overflow: hidden;text-overflow: ellipsis;" ng-click="vm.selectOptionalTask(flow)">{{flow.OptionalTask||'未选择'}}</div>
              </td>
              <!--<td ng-if="vm.data.Level==1"><input type="text" style="width:20px" placeholder="无" ng-model="flow.ReservedEndDays" ng-blur="vm.updateReservedEndDays(flow)"></td>-->
              <td>
                <div  style="white-space: nowrap;width: 60px;overflow: hidden;text-overflow: ellipsis;" ng-click="vm.selectUsers(flow,7)">
                  {{flow.Notice7||'未选择'}}
                </div>
              </td>
              <td>
                <div  style="white-space: nowrap;width: 60px;overflow: hidden;text-overflow: ellipsis;" ng-click="vm.selectUsers(flow,8)">
                  {{flow.Notice8||'未选择'}}
                </div>
              </td>
              <td ng-if="vm.data.Level==0" style="width: 110px;min-width: 110px">
                <input ng-show="!flow.IsFloor" ng-if="flow.line===0" style="width: 90%" placeholder="无里程碑" type="text" ng-blur="vm.updateMilestone(flow)"  ng-model="flow.Milestone">
                <span ng-if="flow.line!==0"><input  style="width:100%;color:#C62828" placeholder="无介入点" type="text" ng-blur="vm.updateExpression(flow)" ng-model="flow.Expression"></span>
              </td>
              <td ng-if="vm.data.Level==0" align="center"><input ng-if="flow.line===0" type="checkbox" ng-model="flow.IsFloor"  ng-click="vm.updateFlow(flow)"></td>
            </tr>
          </table>
        </div>
        <div flex="20" style="padding-top:60px">
          <div id="gitGraph"></div>
        </div>
        </div>
      </md-content>
    </md-tab-content>
    <md-tab label="基础信息">
      <md-tab-content flex layout-fill class="white-bg" layout-padding>
        <form>
          <div layout="row" flex class="create-plan">
            <md-input-container class="md-block" flex>
              <label>名 称</label>
              <input type="text" ng-model="vm.dataTemp.Name" md-autofocus>
            </md-input-container>
          </div>
          <div layout="row" flex>
            <md-input-container class="md-block" flex>
              <label>区 域</label>
              <md-select  ng-model="vm.dataTemp.AreaId" name="type" >
                <md-option ng-repeat="item in vm.AreaList" ng-value="item.Value" >{{item.Text}}</md-option>
              </md-select>
            </md-input-container>
          </div>
        </form>
        <div layout="row" flex>
          <md-button ng-click="vm.ClickSave(vm.dataTemp)" class="md-primary md-raised">
            保存
          </md-button>
        </div>
      </md-tab-content>
    </md-tab>

  </md-tab>
</md-tabs>


