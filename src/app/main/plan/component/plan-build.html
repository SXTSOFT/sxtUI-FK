<md-toolbar class="md-hue-2">
  <div class="md-toolbar-tools">
    <h2>
      <span>创建计划</span>
    </h2>
  </div>
</md-toolbar>
<md-content layout="column" flex>
    <ms-form-wizard flex class="create-plan" ng-if="!vm.initLoading" id="formWizard">
        <div  scroll-top="msWizard.selectedIndex">
            <md-tabs md-dynamic-height md-selected="msWizard.selectedIndex" md-center-tabs="true">
                <md-tab>
                    <md-tab-label>
                        <span class="ms-form-wizard-step-label">
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep1.$invalid">1</span>
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep1.$valid">
                                <i class="icon-check s16"></i>
                            </span>
                            <span class="ms-form-wizard-step-text">基本信息</span>
                        </span>
                    </md-tab-label>
                    <md-tab-body>
                      <form name="wizardStep1" flex  ms-form-wizard-form novalidate>
                            <div layout="row">
                                <md-input-container class="md-block" flex="40">
                                    <label>请选择项目</label>
                                    <md-select name="projectId" ng-model="vm.formWizard.projectId" required md-on-open="vm.getMaps()" md-on-close="vm.getYT(vm.formWizard.projectId)">
                                        <md-option ng-value="p.ProjectID" ng-repeat="p in vm.data.projects">{{p.ProjectName}}</md-option>
                                    </md-select>
                                    <div ng-messages="wizardStep1.projectId.$error" ng-show="wizardStep1.projectId.$touched" role="alert">
                                        <div ng-message="required">
                                            <span>请选择项目.</span>
                                        </div>
                                    </div>
                                </md-input-container>
                                <md-input-container class="md-block" flex="30">
                                    <label>请选择分期</label>
                                    <md-select name="sectionId" ng-model="vm.formWizard.sectionId" required md-on-open="vm.getSections()">
                                        <md-option ng-value="p.RegionID " ng-repeat="p in vm.data.sections">{{p.RegionName}}</md-option>
                                    </md-select>
                                    <div ng-messages="wizardStep1.projectId.$error" ng-show="wizardStep1.projectId.$touched" role="alert">
                                        <div ng-message="required">
                                            <span>请选择分期.</span>
                                        </div>
                                    </div>
                                </md-input-container>
                                <md-input-container class="md-block" flex="30">
                                    <label>请选择楼栋</label>
                                    <md-select name="buildingId" ng-model="vm.formWizard.BuildingId" required md-on-open="vm.getBuildings()">
                                        <md-option ng-value="p.RegionID" ng-repeat="p in vm.data.buildings">{{p.RegionName}}</md-option>
                                    </md-select>
                                    <div ng-messages="wizardStep1.projectId.$error" ng-show="wizardStep1.projectId.$touched" role="alert">
                                        <div ng-message="required">
                                            <span>请选择楼栋.</span>
                                        </div>
                                    </div>
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container class="md-block" flex="40">
                                    <label>请选择模板</label>
                                    <md-select name="templateId" required ng-disabled="!vm.formWizard.projectId" ng-model="vm.formWizard.RootTaskLibraryId">
                                        <md-option ng-value="p.RootTaskLibraryId" ng-repeat="p in vm.data.templates">{{p.Name}}</md-option>
                                    </md-select>
                                    <div ng-messages="wizardStep1.templateId.$error" ng-show="wizardStep1.templateId.$touched" role="alert">
                                        <div ng-message="required">
                                            <span>请选择模板.</span>
                                        </div>
                                    </div>
                                </md-input-container>
                                <md-input-container flex>
                                    <label>开始日期</label>
                                    <md-datepicker name="beginDate" ng-model="vm.formWizard.StartTime" md-placeholder="日期" required md-open-on-focus></md-datepicker>
                                </md-input-container>
                            </div>
                            <div layout="row" >
                                <md-input-container flex="100" class="md-block">
                                    <input type="text" name="planName" ng-change="vm.change()" ng-model="vm.formWizard.Name" placeholder="计划名称" required>
                                    <div ng-messages="wizardStep1.planName.$error" ng-show="wizardStep1.planName.$touched" role="alert">
                                        <div ng-message="required">
                                            <span>请输入计划名称.</span>
                                        </div>
                                    </div>
                                </md-input-container>
                            </div>
                        </form>
                    </md-tab-body>
                </md-tab>
                <md-tab ng-disabled="wizardStep1.$invalid">
                    <md-tab-label>
                        <span class="ms-form-wizard-step-label">
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep2.$invalid">2</span>
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep2.$valid">
                                <i class="icon-check s16"></i>
                            </span>
                            <span class="ms-form-wizard-step-text">设置任务</span>
                        </span>
                    </md-tab-label>
                    <md-tab-body>
                        <form name="wizardStep2" ms-form-wizard-form novalidate>
                            <md-content layout="row" flex ms-scroll>
                                <plan-creating flex flow="vm.flows" vars="vm.vars" branch="vm.branches" build-id="vm.formWizard.BuildingId" begin="vm.formWizard.StartTime" library-id="vm.formWizard.RootTaskLibraryId" template-id="vm.formWizard.TaskTemplateId" ct="ct"></plan-creating>
                                <!--<task-table tasks="vm.loading" flow-id="vm.formWizard.Id" all-tasks="vm.allTasks"></task-table>-->
                            </md-content>
                            <!--<md-content layout="column" flex class="opacity0" ng-class="{'opacity':vm.loading}">-->
                            <!--<canvas id="gitGraph"></canvas>-->
                            <!--</md-content>-->
                        </form>
                    </md-tab-body>
                </md-tab>
                <!--<md-tab ng-disabled="wizardStep1.$invalid || wizardStep2.$invalid">
                    <md-tab-label>
                        <span class="ms-form-wizard-step-label">
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep3.$invalid">3</span>
                            <span class="ms-form-wizard-step-number md-accent-bg" ng-if="wizardStep3.$valid">
                                <i class="icon-check s16"></i>
                            </span>
                            <span class="ms-form-wizard-step-text">人员分配</span>
                        </span>
                    </md-tab-label>
                    <md-tab-body>
                        <form name="wizardStep3" ms-form-wizard-form novalidate>
                            <div layout="row" flex ng-repeat="r in vm.currentRoles">
                                <md-input-container class="md-block" flex>
                                    <label>{{r.RoleName}}</label>
                                    <md-select  ng-model="r.Users" placeholder="{{r.RoleName}}" class="md-block" multiple flex md-on-open="vm.loadUser()">
                                    <md-select-header class="sxt-select-header">
                                        <md-input-container md-no-float class="md-block">
                                            <input ng-keydown="vm.stop($event)" type="search" name="search" ng-model="searchTerm" class="md-text" placeholder="输入关键字" >
                                        </md-input-container>
                                    </md-select-header>
                                    <md-option ng-value="p.Id" ng-repeat="p in vm.roleUsers|filter:searchTerm">{{p.UserName}}</md-option>
                                </md-select>
                                </md-input-container>
                            </div>
                        </form>
                    </md-tab-body>
                </md-tab>-->
            </md-tabs>
            <div class="navigation" flex="none" layout="row" layout-align="center center">
                <md-button class="md-raised md-accent" ng-click="vm.loading=false;msWizard.previousStep()" ng-disabled="msWizard.isFirstStep()">
                    上一步
                </md-button>
                <div class="steps">
                    <span ng-repeat="form in msWizard.forms" ng-class="{'selected md-accent-bg':msWizard.selectedIndex === $index}"></span>
                </div>
                <md-button class="md-raised md-accent" ng-click="vm.nextStep(msWizard.selectedIndex,msWizard.nextStep);" ng-hide="msWizard.isLastStep()" ng-disabled="msWizard.currentStepInvalid()">
                    下一步
                </md-button>
                <md-button class="md-raised md-warn" ng-click="vm.sendForm(msWizard.resetForm)" ng-show="msWizard.isLastStep()" ng-disabled="msWizard.formsIncomplete()">
                    生成任务
                </md-button>
            </div>
        </div>
    </ms-form-wizard>
  <div layout="column" flex layout-align="center center" ng-if="vm.initLoading">
    <md-progress-circular md-mode="indeterminate"></md-progress-circular>
  </div>
</md-content>
<!--<body-background body-show="vm.showBg" body-data="durationForm.eDuration.$error.min" body-min="vm.minError" class="body-background">-->
<!--</body-background>-->
<!--<md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="right" layout="column" md-disable-backdrop="true">-->
<!--<md-tabs md-border-bottom flex >-->
<!--<md-tab label="选择任务">-->
<!--<md-tab-content layout-padding >-->
<!--<md-input-container class="md-block">-->
<!--<label>选择任务</label>-->
<!--<md-select ng-model="vm.current.selectedTask" md-on-close="vm.reloadTask()">-->
<!--<md-option  ng-repeat="m in vm.current.OptionalTasks" ng-value="m">{{m.Name}}</md-option>-->
<!--</md-select>-->
<!--</md-input-container>-->

<!--<form name="durationForm" ng-show="vm.current.selectedTask">-->
<!--<md-input-container class="md-block">-->
<!--<label>工期(公式={{vm.getVars(vm.current.selectedTask)}})</label>-->
<!--<input type="text" required name="eDuration" ng-blur="vm.changeDuration()" ng-model="vm.current.selectedTask.eDuration">-->
<!--&lt;!&ndash;<input type="number" step="0.5" ng-min="vm.min" ng-if="!vm.current.selectedTask.vars.length" ng-blur="vm.changeDuration()" required name="eDuration" ng-model="vm.current.selectedTask.eDuration">&ndash;&gt;-->
<!--<div ng-messages="durationForm.eDuration.$error">-->
<!--<div ng-message="required">必填工期。</div>-->
<!--&lt;!&ndash;<div ng-message="min">工期应大于基本工期的80%。</div>&ndash;&gt;-->
<!--</div>-->
<!--</md-input-container>-->
<!--<md-input-container class="md-block" ng-repeat="v in vm.vars">-->
<!--<label>变量{{v.key}}{{vm.vars}}</label>-->
<!--<input type="text" required name="Duration" ng-model="v.value">-->
<!--</md-input-container>-->
<!--</form>-->
<!--<div ng-show="!vm.current.IsRequired">-->
<!--<md-button class="md-primary md-raised" ng-click="vm.deleteTaskLib()">删除节点</md-button>-->
<!--</div>-->
<!--</md-tab-content>-->
<!--</md-tab>-->
<!--</md-tabs>-->
<!--</md-sidenav>-->