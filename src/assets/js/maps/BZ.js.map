{"version":3,"sources":["BZ.js"],"names":["window","document","undefined","oldL","L","version","module","exports","define","amd","noConflict","this","Util","extend","dest","i","j","len","src","sources","Array","prototype","slice","call","arguments","length","hasOwnProperty","bind","fn","obj","args","apply","stamp","lastId","key","invokeEach","method","context","concat","limitExecByInterval","time","lock","execOnUnlock","wrapperFn","setTimeout","falseFn","formatNum","num","digits","pow","Math","round","trim","str","replace","splitWords","split","setOptions","options","getParamString","existingUrl","uppercase","params","push","encodeURIComponent","toUpperCase","indexOf","join","template","data","value","Error","isArray","Object","toString","emptyImageUrl","getPrefixed","name","prefixes","timeoutDefer","Date","timeToCall","max","lastTime","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","element","cancelAnimFrame","Class","props","NewClass","initialize","_initHooks","callInitHooks","F","proto","constructor","statics","includes","parent","__super__","_initHooksCalled","include","mergeOptions","addInitHook","init","eventsKey","Mixin","Events","addEventListener","types","event","type","indexKey","indexLenKey","typeIndex","events","contextId","action","hasEventListeners","removeEventListener","clearAllEventListeners","listeners","removed","splice","fireEvent","target","addOneTimeEventListener","handler","on","off","once","fire","ie","ielt9","ua","navigator","userAgent","toLowerCase","webkit","chrome","phantomjs","android","android23","search","gecko","mobile","orientation","msPointer","msPointerEnabled","msMaxTouchPoints","PointerEvent","pointer","pointerEnabled","maxTouchPoints","retina","devicePixelRatio","matchMedia","matches","doc","documentElement","ie3d","style","webkit3d","WebKitCSSMatrix","gecko3d","opera3d","any3d","L_DISABLE_3D","touch","L_NO_TOUCH","startName","div","createElement","supported","setAttribute","removeAttribute","Browser","opera","mobileWebkit","mobileWebkit3d","mobileOpera","Point","x","y","clone","add","point","_add","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","_round","floor","_floor","distanceTo","sqrt","equals","contains","abs","Bounds","a","b","points","min","getCenter","getBottomLeft","getTopRight","getSize","bounds","intersects","min2","max2","xIntersects","yIntersects","isValid","Transformation","c","d","_a","_b","_c","_d","transform","scale","_transform","untransform","DomUtil","get","getElementById","getStyle","el","currentStyle","defaultView","css","getComputedStyle","getViewportOffset","pos","top","left","docBody","body","docEl","offsetTop","offsetLeft","parseInt","offsetParent","scrollTop","scrollLeft","width","maxWidth","r","getBoundingClientRect","clientLeft","parentNode","documentIsLtr","_docIsLtrCached","_docIsLtr","create","tagName","className","container","appendChild","hasClass","classList","_getClass","RegExp","test","addClass","classes","_setClass","removeClass","remove","baseVal","setOpacity","opacity","filter","filterName","filters","item","e","Enabled","Opacity","testProp","getTranslateString","is3d","open","close","getScaleString","origin","preTranslateStr","scaleStr","setPosition","disable3D","_leaflet_pos","TRANSFORM","getPosition","TRANSITION","TRANSITION_END","disableTextSelection","DomEvent","preventDefault","enableTextSelection","userSelectProperty","_userSelect","disableImageDrag","enableImageDrag","LatLng","lat","lng","alt","parseFloat","isNaN","DEG_TO_RAD","PI","RAD_TO_DEG","MAX_MARGIN","latLng","margin","precision","other","R","d2r","dLat","dLon","lat1","lat2","sin1","sin","sin2","cos","atan2","wrap","lon","LatLngBounds","southWest","northEast","latlngs","latLngBounds","_southWest","_northEast","pad","bufferRatio","sw","ne","heightBuffer","widthBuffer","getSouthWest","getNorthEast","getNorthWest","getNorth","getWest","getSouthEast","getSouth","getEast","sw2","ne2","latIntersects","lngIntersects","toBBoxString","Projection","SphericalMercator","MAX_LATITUDE","project","latlng","log","tan","unproject","atan","exp","LonLat","CRS","latLngToPoint","zoom","projectedPoint","projection","transformation","pointToLatLng","untransformedPoint","s","Simple","EPSG3857","code","earthRadius","EPSG900913","EPSG4326","Map","crs","fadeAnimation","trackResize","markerZoomAnimation","_initContainer","_initLayout","_onResize","_initEvents","maxBounds","setMaxBounds","center","setView","reset","_handlers","_layers","_zoomBoundLayers","_tileLayersNum","_addLayers","layers","getZoom","_resetView","_limitZoom","setZoom","_loaded","_zoom","zoomIn","delta","zoomOut","setZoomAround","getZoomScale","viewHalf","containerPoint","latLngToContainerPoint","centerOffset","newCenter","containerPointToLatLng","fitBounds","getBounds","paddingTL","paddingTopLeft","padding","paddingBR","paddingBottomRight","getBoundsZoom","paddingOffset","swPoint","nePoint","maxZoom","fitWorld","panTo","pan","panBy","offset","_rawPanBy","_panInsideMaxBounds","panInsideBounds","_limitCenter","addLayer","layer","minZoom","_updateZoomLevels","zoomAnimation","TileLayer","_tileLayersToLoad","_onTileLayerLoad","_layerAdd","removeLayer","onRemove","hasLayer","eachLayer","invalidateSize","animate","oldSize","_sizeChanged","_initialCenter","newSize","oldCenter","debounceMoveend","_sizeTimer","addHandler","HandlerClass","enable","_container","_leaflet","_clearPanes","_clearControlPos","_clearHandlers","_checkIfLoaded","_moved","layerPointToLatLng","_getCenterLayerPoint","getPixelBounds","getMinZoom","_layersMinZoom","getMaxZoom","_layersMaxZoom","Infinity","inside","boundsSize","size","nw","se","zoomNotFound","_size","clientWidth","clientHeight","topLeftPoint","_getTopLeftPoint","getPixelOrigin","_initialTopLeftPoint","getPanes","_panes","getContainer","toZoom","getScaleZoom","LN2","latLngToLayerPoint","containerPointToLayerPoint","_getMapPanePos","layerPointToContainerPoint","layerPoint","mouseEventToContainerPoint","getMousePosition","mouseEventToLayerPoint","mouseEventToLatLng","position","_initPanes","_initControlPos","panes","_mapPane","mapPane","_createPane","_tilePane","tilePane","objectsPane","shadowPane","overlayPane","markerPane","popupPane","zoomHide","removeChild","preserveMapOffset","afterZoomAnim","zoomChanged","_getNewTopLeftPoint","loading","hard","_getZoomSpan","oldZoomSpan","onOff","_onMouseClick","_fireMouseEvent","_resizeRequest","_simulated","dragging","moved","boxZoom","_skipped","originalEvent","disable","whenReady","callback","onAdd","_latLngToNewLayerPoint","newZoom","topLeft","_getCenterOffset","centerPoint","viewBounds","_getBoundsOffset","_limitOffset","newBounds","pxBounds","nwOffset","seOffset","dx","_rebound","dy","right","ceil","map","Mercator","R_MINOR","R_MAJOR","r2","tmp","eccent","con","ts","phi","numIter","tol","dphi","EPSG3395","m","tileSize","subdomains","errorTileUrl","attribution","zoomOffset","unloadInvisibleTiles","updateWhenIdle","url","detectRetina","_url","_map","_animated","_zoomAnimated","viewreset","_reset","moveend","_update","zoomanim","_animateZoom","zoomend","_endZoomAnim","_limitedUpdate","addTo","bringToFront","pane","_setAutoZIndex","bringToBack","insertBefore","firstChild","getAttribution","_updateOpacity","setZIndex","zIndex","_updateZIndex","setUrl","noRedraw","redraw","compare","children","edgeZIndex","isFinite","tiles","_tiles","_bgBuffer","_tileContainer","tile","_tilesToLoad","reuseTiles","_unusedTiles","innerHTML","_clearBgBuffer","_getTileSize","zoomN","maxNativeZoom","tileBounds","_addTilesFromCenterOut","_removeOtherTiles","queue","_tileShouldBeLoaded","tilesToLoad","sort","fragment","createDocumentFragment","_addTile","tilePoint","continuousWorld","limit","_getWrapTileNum","noWrap","nwPoint","sePoint","kArr","_removeTile","onload","tilePos","_getTilePos","_getTile","_loadTile","_getZoomForUrl","zoomReverse","getTileUrl","_getSubdomain","z","_adjustTilePoint","tms","index","pop","_resetTile","_createTile","height","galleryimg","onselectstart","onmousemove","WebkitBackfaceVisibility","_layer","_tileOnLoad","onerror","_tileOnError","_tileLoaded","_clearBgBufferTimer","newUrl","tileLayer","WMS","defaultWmsParams","service","request","styles","format","transparent","wmsParams","_crs","_wmsVersion","projectionKey","bbox","setParams","wms","Canvas","async","_redrawTile","drawTile","_tilePoint","tileDrawn","canvas","ImageOverlay","_bounds","_image","_initImage","_onImageLoad","image","imageOverlay","Icon","createIcon","oldIcon","_createIcon","createShadow","_getIconUrl","img","_createImg","_setIconStyles","anchor","shadowAnchor","iconAnchor","marginLeft","marginTop","icon","Default","iconSize","popupAnchor","shadowSize","path","imagePath","scripts","getElementsByTagName","leafletRe","match","Marker","title","clickable","draggable","keyboard","zIndexOffset","riseOnHover","riseOffset","_latlng","update","_initIcon","_removeIcon","_removeShadow","getLatLng","setLatLng","setZIndexOffset","setIcon","_popup","bindPopup","_icon","_setPos","animation","classToAdd","addIcon","tabIndex","_initInteraction","_bringToFront","_resetZIndex","newShadow","_shadow","addShadow","_zIndex","opt","_onKeyPress","Handler","MarkerDrag","wasDragged","stopPropagation","_enabled","keyCode","marker","DivIcon","html","bgPos","backgroundPosition","divIcon","closePopupOnClick","Popup","minWidth","autoPan","closeButton","autoPanPadding","keepInView","source","_source","_isOpen","animFade","_getEvents","popup","openOn","openPopup","offsetWidth","_updatePosition","_adjustPan","getContent","_content","setContent","content","visibility","_updateContent","_updateLayout","_zoomAnimation","closeOnClick","preclick","_close","closePopup","prefix","containerClass","_closeButton","href","disableClickPropagation","_onCloseButtonClick","wrapper","_wrapper","_contentNode","disableScrollPropagation","_tipContainer","_tip","hasChildNodes","whiteSpace","offsetHeight","maxHeight","scrolledClass","_containerWidth","animated","_containerBottom","_containerLeft","bottom","containerHeight","containerWidth","layerPos","containerPos","autoPanPaddingTopLeft","autoPanPaddingBottomRight","stop","togglePopup","_popupHandlersAdded","_movePopup","setPopupContent","unbindPopup","getPopup","LayerGroup","getLayerId","clearLayers","invoke","methodName","getLayer","getLayers","layerGroup","FeatureGroup","EVENTS","_propagateEvent","_popupContent","_popupOptions","setStyle","featureGroup","Path","CLIP_PADDING","outerWidth","outerHeight","stroke","color","dashArray","lineCap","lineJoin","weight","fill","fillColor","fillOpacity","_initElements","projectLatlngs","_updatePath","_pathRoot","vml","_stroke","_fill","_updateStyle","_updatePathViewport","p","panePos","_pathViewport","SVG_NS","svg","createElementNS","createSVGRect","SVG","root","lastChild","first","getPathString","_createElement","_initPathRoot","_initPath","_initStyle","_path","pointerEvents","_animatePathZoom","_endPathZoom","_updateSvgViewport","_pathZooming","vp","_openPopup","_latlngs","shape","behavior","adj","VML","namespaces","coordsize","stroked","filled","endcap","dashStyle","joinstyle","display","v","getContext","L_PREFER_CANVAS","CANVAS","_requestUpdate","_onClick","_onMouseMove","_updateRequest","_fireMapMoveEnd","_ctx","_canvasCtx","lineWidth","strokeStyle","fillStyle","_drawPath","len2","drawMethod","beginPath","_parts","Polygon","closePath","_checkIfEmpty","ctx","save","globalAlpha","restore","_containsPoint","_animatingZoom","cursor","_mouseInside","_updateCanvasViewport","translate","LineUtil","simplify","tolerance","sqTolerance","_reducePoints","_simplifyDP","pointToSegmentDistance","p1","p2","_sqClosestPointOnSegment","closestPointOnSegment","ArrayConstructor","Uint8Array","markers","_simplifyDPStep","newPoints","last","sqDist","maxSqDist","reducedPoints","prev","_sqDist","clipSegment","useLastCode","codeOut","newCode","codeA","_lastCode","_getBitCode","codeB","_getEdgeIntersection","t","dot","Polyline","_convertLatLngs","smoothFactor","noClip","_originalPoints","_getPathPartStr","getLatLngs","setLatLngs","addLatLng","spliceLatLngs","closestLayerPoint","minDistance","parts","minPoint","jLen","distance","overwrite","_clipPoints","k","segment","lu","_simplifyPoints","polyline","PolyUtil","clipPolygon","clippedPoints","edge","edges","_code","_initWithHoles","hole","_holes","_holePoints","newParts","clipped","polygon","createMulti","Klass","_options","MultiPolyline","MultiPolygon","multiPolyline","multiPolygon","Rectangle","_boundsToLatLngs","setBounds","rectangle","Circle","radius","_mRadius","setRadius","lngRadius","_getLngRadius","pointLeft","_point","_radius","latRadius","getRadius","_getLatRadius","circle","CircleMarker","circleMarker","closed","dist","part","w","arc","w2","GeoJSON","geojson","addData","feature","features","geometries","geometry","coordinates","geometryToLayer","pointToLayer","coordsToLatLng","asFeature","defaultOptions","resetStyle","onEachFeature","_setLayerStyle","vectorOptions","coords","coordsToLatLngs","properties","levelsDeep","latLngToCoords","latLngsToCoords","latLngs","getFeature","newGeometry","geoJSON","PointToGeoJSON","toGeoJSON","multiToGeoJSON","json","jsons","isGeometryCollection","geoJson","addListener","originalHandler","newType","_getEvent","addPointerListener","addDoubleTapListener","_checkMouse","_filterClick","attachEvent","removeListener","removePointerListener","removeDoubleTapListener","detachEvent","cancelBubble","Draggable","START","_fakeStop","returnValue","clientX","clientY","rect","clientTop","getWheelDelta","wheelDelta","detail","_skipEvents","skipped","related","relatedTarget","err","caller","callee","Event","timeStamp","elapsed","_lastClick","_simulatedClick","END","mousedown","touchstart","pointerdown","MSPointerDown","MOVE","dragStartTarget","_element","_dragStartTarget","_onDown","shiftKey","which","button","touches","_disabled","_moving","_startPoint","_startPos","_newPos","_onMove","_onUp","newPoint","srcElement","_animRequest","addHooks","removeHooks","enabled","inertia","inertiaDeceleration","inertiaMaxSpeed","inertiaThreshold","easeLinearity","worldCopyJump","Drag","_draggable","dragstart","_onDragStart","drag","_onDrag","dragend","_onDragEnd","_onPreDrag","_onViewReset","_panAnim","_positions","_times","_lastTime","_lastPos","shift","pxCenter","pxWorldCenter","_initialWorldOffset","_worldWidth","worldWidth","halfWidth","newX1","newX2","newX","delay","noInertia","direction","duration","ease","speedVector","speed","limitedSpeed","limitedSpeedVector","decelerationDuration","noMoveStart","doubleClickZoom","DoubleClickZoom","_onDoubleClick","scrollWheelZoom","ScrollWheelZoom","_onWheelScroll","_delta","_lastMousePos","_startTime","_timer","_performZoom","_touchstart","_touchend","onTouchStart","count","trackedTouches","pointerId","now","doubleTap","onTouchEnd","idx","prop","newTouch","pre","touchend","endElement","POINTER_CANCEL","POINTER_DOWN","POINTER_MOVE","POINTER_UP","_pointers","_pointerDocumentListener","addPointerListenerStart","addPointerListenerEnd","addPointerListenerMove","pointers","cb","alreadyInArray","changedTouches","internalCb","pointerType","MSPOINTER_TYPE_MOUSE","buttons","touchZoom","bounceAtZoomLimits","TouchZoom","_onTouchStart","_zooming","viewCenter","_startCenter","_startDist","_centerOffset","_onTouchMove","_onTouchEnd","_scale","_updateOnMove","_getScaleOrigin","oldZoom","floatZoomDelta","roundZoomDelta","tap","tapTolerance","Tap","_fireClick","_holdTimeout","_isTapValid","_simulateEvent","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","BoxZoom","_pane","_onMouseDown","_startLayerPoint","_onMouseUp","_onKeyDown","_box","startPoint","box","newPos","_finish","boxZoomBounds","keyboardPanOffset","keyboardZoomOffset","Keyboard","keyCodes","down","up","_setPanOffset","_setZoomOffset","_onFocus","_onBlur","_addHooks","_removeHooks","_focused","focus","scrollTo","keys","_panKeys","codes","_zoomKeys","_inProgress","_marker","shadow","iconPos","Control","removeControl","addControl","corner","_controlCorners","removeFrom","_refocusOnMap","control","createCorner","vSide","hSide","l","corners","_controlContainer","Zoom","zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","zoomName","_zoomInButton","_createButton","_zoomIn","_zoomOutButton","_zoomOut","_updateDisabled","link","zoomControl","Attribution","_attributions","addAttribution","_onLayerAdd","_onLayerRemove","setPrefix","text","removeAttribution","attribs","prefixAndAttribs","attributionControl","Scale","metric","imperial","_addScales","_mScale","_iScale","centerLat","halfWorldMeters","maxMeters","_updateScales","_updateMetric","_updateImperial","meters","_getRoundNum","_getScaleWidth","maxMiles","miles","feet","maxFeet","ratio","pow10","Layers","collapsed","autoZIndex","baseLayers","overlays","_lastZIndex","_handlingClick","_addLayer","_onLayerChange","addBaseLayer","addOverlay","form","_form","_expand","_collapse","_layersLink","_onInputClick","_baseLayersList","_separator","_overlaysList","overlay","baseLayersPresent","overlaysPresent","_addItem","_createRadioElement","checked","radioHtml","radioFragment","input","label","defaultChecked","layerId","inputs","inputsLen","PosAnimation","run","_el","_onTransitionEnd","_stepTimer","setInterval","_onStep","_getPos","stepPos","_transformRe","clearInterval","_tryAnimatedZoom","_tryAnimatedPan","step","_onPanTransitionStep","end","_onPanTransitionEnd","_duration","_easeOutPower","_offset","_animate","_step","_complete","_animId","_runFrame","_easeOut","progress","zoomAnimationThreshold","_catchTransitionEnd","propertyName","_onZoomTransitionEnd","_nothingToAnimate","getElementsByClassName","backwards","_animateToCenter","_animateToZoom","_animating","_prepareBgBuffer","bg","initialTransform","front","bgLoaded","_getLoadedTilesPercentage","frontLoaded","_stopLoadingImages","complete","_defaultLocateOptions","watch","timeout","maximumAge","enableHighAccuracy","locate","_locateOptions","geolocation","_handleGeolocationError","message","onResponse","_handleGeolocationResponse","onError","_locationWatchId","watchPosition","getCurrentPosition","stopLocate","clearWatch","error","latitude","longitude","latAccuracy","accuracy","lngAccuracy","timestamp","drawVersion","drawLocal","draw","toolbar","actions","finish","undo","handlers","tooltip","start","cont","simpleshape","line","edit","cancel","editDisabled","removeDisabled","subtext","Draw","Feature","_overlayPane","_popupPane","shapeOptions","layerType","_tooltip","Tooltip","_cancelDrawing","dispose","_fireCreatedEvent","TYPE","Poly","allowIntersection","repeatMode","drawError","touchIcon","guidelineDistance","maxGuideLineLength","showLength","_markers","_markerGroup","_poly","updateContent","_getTooltipText","_mouseMarker","_onMouseOut","_onZoomEnd","_onTouch","_clearHideErrorTimeout","_cleanUpShape","_clearGuides","deleteLastVertex","lastMarker","poly","_vertexChanged","addVertex","markersLength","newLatLngIntersects","_showErrorTooltip","_errorShown","_hideErrorTooltip","_createMarker","completeShape","_finishShape","_shapeIsValid","_updateGuide","altKey","ctrlKey","prevPos","_currentLatLng","_updateTooltip","added","_updateFinishHandler","_updateRunningMeasure","_mouseDownOrigin","prevLatLng","markerCount","_drawGuide","updatePosition","pointA","pointB","fraction","dashPoint","dash","_guidesContainer","backgroundColor","_updateGuideColor","childNodes","labelText","distanceStr","_getMeasurementString","previousMarkerIndex","_measurementRunningTotal","currentLatLng","previousLatLng","GeometryUtil","readableDistance","showAsError","_hideErrorTimeout","removeError","showArea","area","_area","readableArea","geodesicArea","SimpleShape","_endLabelText","_mapDraggable","_initialLabelText","_shape","_isDrawing","_startLatLng","_dragEventCount","_drawShape","_clickToCreate","tooltipText","showRadius","useMetric","toFixed","Touch","Edit","_openPopover","_toggleMarkerHighlight","_closePopover","edited","_offsetMarker","iconMarginTop","iconMarginLeft","_createPopover","self","SvFeatureGroup","bindPopupContainer","editing","editable","_verticesHandlers","PolyVerticesEdit","_eachVertexHandler","updateMarkers","bs","_initMarkers","original","_onMarkerClick","markerLeft","markerRight","_createMiddleMarker","_updatePrevNext","_origLatLng","_index","_onMarkerDragStart","_onMarkerDrag","_fireEdit","_spliceLatLngs","_removeMarker","_updateIndexes","_middleLeft","_getMiddleLatLng","_prev","_middleRight","_next","minPoints","marker1","marker2","onClick","onDragStart","onDragEnd","moveIcon","resizeIcon","touchMoveIcon","touchResizeIcon","_unbindMarker","_moveMarker","_resizeMarkers","_createMoveMarker","_createResizeMarker","_bindMarker","_onMarkerDragEnd","onUpdate","_move","_resize","isOnTouchStart","_getCorners","currentCornerIndex","_cornerIndex","_oppositeCorner","_toggleCornerMarkers","_getPopupOffset","n","_repositionCornerMarkers","newLatLngs","resizemarkerPoint","_getResizeMarkerPoint","moveLatLng","touchExtend","TouchExtend","_detectIE","_onTouchCancel","_onTouchLeave","_touchEvent","touchEvent","pageX","pageY","msie","substring","trident","rv","LatLngUtil","cloneLatLngs","cloneLatLng","pointsCount","isMetric","areaStr","useFeet","suffix","segmentsIntersect","p3","_checkCounterclockwise","_tooFewPointsForIntersection","_lineSegmentsIntersectsRange","skipFirst","newPointIntersects","lastPoint","maxIndex","extraPoints","minIndex","polylineIntersects","firstPoint","drawControl","Toolbar","_modes","_actionButtons","_activeMode","addToolbar","buttonIndex","buttonClassPrefix","_toolbarClass","modeHandlers","getModeHandlers","_toolbarContainer","menus","_initMenuModeHandler","_initModeHandler","_lastButtonIndex","_actionsContainer","removeToolbar","handlerId","_disposeButton","_handlerActivated","_handlerDeactivated","sub","buttonIndexFn","classNamePredix","subDiv","_showMenuToolbar","ul","li","buttonTitle","hideMenu","_hideMenuToolbar","_showActionsToolbar","_hideActionsToolbar","_createActions","di","dl","getActions","menuDiv","_menuToolbar","_menuButton","lastButtonIndex","toolbarPosition","drawControlTooltips","_singleLineLabel","tooltipContainer","DrawToolbar","number","arrow","lineGroup","AreaGroup","Stamp","NumberMarker","Line","Arrow","LineGroup","group","_toolbars","_toolbarEnabled","SXT","GroupToolbar","toolbarContainer","addedTopClass","topClassName","toolbarId","fg","onLayerCreated","setDrawingOptions","enabledToolbar","getValue","_value","setValue","updateValue","lagLng","_touchEnd_timer","console","Number","setData","_updateData","DragPath","impostorOptions","stroke-linejoin","stroke-linecap","stroke-opacity","stroke-width","getAttribute","_start","_end","_endPoint","setEndpoints","_makeShapeOptions","cornerIndex","_getCenter","ql","newStart","newEnd","arrowBounds","fillable","_arrHeadWidth","_arrHeadLen","headLen","headWidth","lineAbs","lineLen","toData","getData","font-family","font-style","font-weight","letter-spacing","text-decoration","multiSelect","fontSize","strokeWidth","_text","laglng","seq","createTextNode","_status","attrs","attr","textContent","string","$groupId","dismissOnDone","_onAdd","_fireEditLayer","eb","overLayers","isMiddleNumber","forEach","_fg","$id","uuid","groupId","ly","onDelete","getTime","performance","random","isNew","isInline","circleLineIntersection","newData","onPopup","rp","x1","x2","y1","y2","lib","ex","ey","lec","dt","fx","fy","gx","gy","pointIsInLine","ps","n1","n2","f","SXTCRS","sc","areaGroup","Project","tileLayers","featureGroups","annotationBar","_tileLayer","swipeTile","_featureGroups","svFg","swipeFeature","_currentTile","isAdd","fs","_fs"],"mappings":"CAmBC,SAAUA,EAAQC,EAAUC,GAC5B,GAAIC,GAAOH,EAAOI,EACjBA,IAEDA,GAAEC,QAAU,QAGU,gBAAXC,SAAiD,gBAAnBA,QAAOC,QAC/CD,OAAOC,QAAUH,EAGW,kBAAXI,SAAyBA,OAAOC,KACjDD,OAAOJ,GAKRA,EAAEM,WAAa,WAEd,MADAV,GAAOI,EAAID,EACJQ,MAGRX,EAAOI,EAAIA,EAOXA,EAAEQ,MACDC,OAAQ,SAAUC,GACjB,GACCC,GAAGC,EAAGC,EAAKC,EADRC,EAAUC,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,EAGpD,KAAKR,EAAI,EAAGC,EAAME,EAAQM,OAAYR,EAAJD,EAASA,IAAK,CAC/CE,EAAMC,EAAQH,MACd,KAAKD,IAAKG,GACLA,EAAIQ,eAAeX,KACtBD,EAAKC,GAAKG,EAAIH,IAIjB,MAAOD,IAGRa,KAAM,SAAUC,EAAIC,GACnB,GAAIC,GAAON,UAAUC,OAAS,EAAIL,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAK,IAC7E,OAAO,YACN,MAAOI,GAAGG,MAAMF,EAAKC,GAAQN,aAI/BQ,MAAQ,WACP,GAAIC,GAAS,EACZC,EAAM,aACP,OAAO,UAAUL,GAEhB,MADAA,GAAIK,GAAOL,EAAIK,MAAUD,EAClBJ,EAAIK,OAIbC,WAAY,SAAUN,EAAKO,EAAQC,GAClC,GAAItB,GAAGe,CAEP,IAAmB,gBAARD,GAAkB,CAC5BC,EAAOV,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,EAE7C,KAAKT,IAAKc,GACTO,EAAOL,MAAMM,GAAUtB,EAAGc,EAAId,IAAIuB,OAAOR,GAE1C,QAAO,EAGR,OAAO,GAGRS,oBAAqB,SAAUX,EAAIY,EAAMH,GACxC,GAAII,GAAMC,CAEV,OAAO,SAASC,KACf,GAAIb,GAAON,SAEX,OAAIiB,QACHC,GAAe,IAIhBD,GAAO,EAEPG,WAAW,WACVH,GAAO,EAEHC,IACHC,EAAUZ,MAAMM,EAASP,GACzBY,GAAe,IAEdF,OAEHZ,GAAGG,MAAMM,EAASP,MAIpBe,QAAS,WACR,OAAO,GAGRC,UAAW,SAAUC,EAAKC,GACzB,GAAIC,GAAMC,KAAKD,IAAI,GAAID,GAAU,EACjC,OAAOE,MAAKC,MAAMJ,EAAME,GAAOA,GAGhCG,KAAM,SAAUC,GACf,MAAOA,GAAID,KAAOC,EAAID,OAASC,EAAIC,QAAQ,aAAc,KAG1DC,WAAY,SAAUF,GACrB,MAAOjD,GAAEQ,KAAKwC,KAAKC,GAAKG,MAAM,QAG/BC,WAAY,SAAU5B,EAAK6B,GAE1B,MADA7B,GAAI6B,QAAUtD,EAAES,UAAWgB,EAAI6B,QAASA,GACjC7B,EAAI6B,SAGZC,eAAgB,SAAU9B,EAAK+B,EAAaC,GAC3C,GAAIC,KACJ,KAAK,GAAI/C,KAAKc,GACbiC,EAAOC,KAAKC,mBAAmBH,EAAY9C,EAAEkD,cAAgBlD,GAAK,IAAMiD,mBAAmBnC,EAAId,IAEhG,QAAU6C,GAA4C,KAA7BA,EAAYM,QAAQ,KAAqB,IAAN,KAAaJ,EAAOK,KAAK,MAEtFC,SAAU,SAAUf,EAAKgB,GACxB,MAAOhB,GAAIC,QAAQ,oBAAqB,SAAUD,EAAKnB,GACtD,GAAIoC,GAAQD,EAAKnC,EACjB,IAAIoC,IAAUpE,EACb,KAAM,IAAIqE,OAAM,kCAAoClB,EAIrD,OAH4B,kBAAViB,KACjBA,EAAQA,EAAMD,IAERC,KAITE,QAASpD,MAAMoD,SAAW,SAAU3C,GACnC,MAAgD,mBAAxC4C,OAAOpD,UAAUqD,SAASnD,KAAKM,IAGxC8C,cAAe,8DAGf,WAIA,QAASC,GAAYC,GACpB,GAAI9D,GAAGa,EACNkD,GAAY,SAAU,MAAO,IAAK,KAEnC,KAAK/D,EAAI,EAAGA,EAAI+D,EAASrD,SAAWG,EAAIb,IACvCa,EAAK5B,EAAO8E,EAAS/D,GAAK8D,EAG3B,OAAOjD,GAKR,QAASmD,GAAanD,GACrB,GAAIY,IAAQ,GAAIwC,MACfC,EAAa/B,KAAKgC,IAAI,EAAG,IAAM1C,EAAO2C,GAGvC,OADAA,GAAW3C,EAAOyC,EACXjF,EAAO4C,WAAWhB,EAAIqD,GAP9B,GAAIE,GAAW,EAUXC,EAAYpF,EAAOqF,uBACtBT,EAAY,0BAA4BG,EAErCO,EAAWtF,EAAOuF,sBACrBX,EAAY,yBACZA,EAAY,gCACZ,SAAUY,GAAMxF,EAAOyF,aAAaD,GAGrCpF,GAAEQ,KAAK8E,iBAAmB,SAAU9D,EAAIS,EAASsD,EAAWC,GAG3D,MAFAhE,GAAKxB,EAAEuB,KAAKC,EAAIS,GAEZsD,GAAaP,IAAcL,MAC9BnD,KAEOwD,EAAU7D,KAAKvB,EAAQ4B,EAAIgE,IAIpCxF,EAAEQ,KAAKiF,gBAAkB,SAAUL,GAC9BA,GACHF,EAAS/D,KAAKvB,EAAQwF,OAOzBpF,EAAES,OAAST,EAAEQ,KAAKC,OAClBT,EAAEuB,KAAOvB,EAAEQ,KAAKe,KAChBvB,EAAE4B,MAAQ5B,EAAEQ,KAAKoB,MACjB5B,EAAEqD,WAAarD,EAAEQ,KAAK6C,WAQtBrD,EAAE0F,MAAQ,aAEV1F,EAAE0F,MAAMjF,OAAS,SAAUkF,GAG1B,GAAIC,GAAW,WAGVrF,KAAKsF,YACRtF,KAAKsF,WAAWlE,MAAMpB,KAAMa,WAIzBb,KAAKuF,YACRvF,KAAKwF,iBAKHC,EAAI,YACRA,GAAE/E,UAAYV,KAAKU,SAEnB,IAAIgF,GAAQ,GAAID,EAChBC,GAAMC,YAAcN,EAEpBA,EAAS3E,UAAYgF,CAGrB,KAAK,GAAItF,KAAKJ,MACTA,KAAKe,eAAeX,IAAY,cAANA,IAC7BiF,EAASjF,GAAKJ,KAAKI,GAKjBgF,GAAMQ,UACTnG,EAAES,OAAOmF,EAAUD,EAAMQ,eAClBR,GAAMQ,SAIVR,EAAMS,WACTpG,EAAEQ,KAAKC,OAAOkB,MAAM,MAAOsE,GAAO/D,OAAOyD,EAAMS,iBACxCT,GAAMS,UAIVT,EAAMrC,SAAW2C,EAAM3C,UAC1BqC,EAAMrC,QAAUtD,EAAES,UAAWwF,EAAM3C,QAASqC,EAAMrC,UAInDtD,EAAES,OAAOwF,EAAON,GAEhBM,EAAMH,aAEN,IAAIO,GAAS9F,IAoBb,OAlBAqF,GAASU,UAAYD,EAAOpF,UAG5BgF,EAAMF,cAAgB,WAErB,IAAIxF,KAAKgG,iBAAT,CAEIF,EAAOpF,UAAU8E,eACpBM,EAAOpF,UAAU8E,cAAc5E,KAAKZ,MAGrCA,KAAKgG,kBAAmB,CAExB,KAAK,GAAI5F,GAAI,EAAGE,EAAMoF,EAAMH,WAAWzE,OAAYR,EAAJF,EAASA,IACvDsF,EAAMH,WAAWnF,GAAGQ,KAAKZ,QAIpBqF,GAKR5F,EAAE0F,MAAMc,QAAU,SAAUb,GAC3B3F,EAAES,OAAOF,KAAKU,UAAW0E,IAI1B3F,EAAE0F,MAAMe,aAAe,SAAUnD,GAChCtD,EAAES,OAAOF,KAAKU,UAAUqC,QAASA,IAIlCtD,EAAE0F,MAAMgB,YAAc,SAAUlF,GAC/B,GAAIE,GAAOV,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAE7CuF,EAAqB,kBAAPnF,GAAoBA,EAAK,WAC1CjB,KAAKiB,GAAIG,MAAMpB,KAAMmB,GAGtBnB,MAAKU,UAAU6E,WAAavF,KAAKU,UAAU6E,eAC3CvF,KAAKU,UAAU6E,WAAWnC,KAAKgD,GAQhC,IAAIC,GAAY,iBAEhB5G,GAAE6G,SAEF7G,EAAE6G,MAAMC,QAEPC,iBAAkB,SAAUC,EAAOxF,EAAIS,GAGtC,GAAIjC,EAAEQ,KAAKuB,WAAWiF,EAAOzG,KAAKwG,iBAAkBxG,KAAMiB,EAAIS,GAAY,MAAO1B,KAEjF,IAECI,GAAGE,EAAKoG,EAAOC,EAAMC,EAAUC,EAAaC,EAFzCC,EAAS/G,KAAKqG,GAAarG,KAAKqG,OACnCW,EAAYtF,GAAWA,IAAY1B,MAAQP,EAAE4B,MAAMK,EAMpD,KAFA+E,EAAQhH,EAAEQ,KAAK2C,WAAW6D,GAErBrG,EAAI,EAAGE,EAAMmG,EAAM3F,OAAYR,EAAJF,EAASA,IACxCsG,GACCO,OAAQhG,EACRS,QAASA,GAAW1B,MAErB2G,EAAOF,EAAMrG,GAET4G,GAIHJ,EAAWD,EAAO,OAClBE,EAAcD,EAAW,OAEzBE,EAAYC,EAAOH,GAAYG,EAAOH,OAEjCE,EAAUE,KACdF,EAAUE,MAGVD,EAAOF,IAAgBE,EAAOF,IAAgB,GAAK,GAGpDC,EAAUE,GAAW5D,KAAKsD,KAI1BK,EAAOJ,GAAQI,EAAOJ,OACtBI,EAAOJ,GAAMvD,KAAKsD,GAIpB,OAAO1G,OAGRkH,kBAAmB,SAAUP,GAC5B,GAAII,GAAS/G,KAAKqG,EAClB,SAASU,IAAYJ,IAAQI,IAAUA,EAAOJ,GAAM7F,OAAS,GAC3D6F,EAAO,QAAUI,IAAUA,EAAOJ,EAAO,YAAc,IAG1DQ,oBAAqB,SAAUV,EAAOxF,EAAIS,GAEzC,IAAK1B,KAAKqG,GACT,MAAOrG,KAGR,KAAKyG,EACJ,MAAOzG,MAAKoH,wBAGb,IAAI3H,EAAEQ,KAAKuB,WAAWiF,EAAOzG,KAAKmH,oBAAqBnH,KAAMiB,EAAIS,GAAY,MAAO1B,KAEpF,IAECI,GAAGE,EAAKqG,EAAMU,EAAWhH,EAAGuG,EAAUC,EAAaC,EAAWQ,EAF3DP,EAAS/G,KAAKqG,GACjBW,EAAYtF,GAAWA,IAAY1B,MAAQP,EAAE4B,MAAMK,EAKpD,KAFA+E,EAAQhH,EAAEQ,KAAK2C,WAAW6D,GAErBrG,EAAI,EAAGE,EAAMmG,EAAM3F,OAAYR,EAAJF,EAASA,IAOxC,GANAuG,EAAOF,EAAMrG,GACbwG,EAAWD,EAAO,OAClBE,EAAcD,EAAW,OAEzBE,EAAYC,EAAOH,GAEd3F,GASJ,GAFAoG,EAAYL,GAAaF,EAAYA,EAAUE,GAAaD,EAAOJ,GAEpD,CACd,IAAKtG,EAAIgH,EAAUvG,OAAS,EAAGT,GAAK,EAAGA,IACjCgH,EAAUhH,GAAG4G,SAAWhG,GAASS,GAAY2F,EAAUhH,GAAGqB,UAAYA,IAC1E4F,EAAUD,EAAUE,OAAOlH,EAAG,GAG9BiH,EAAQ,GAAGL,OAASxH,EAAEQ,KAAKiC,QAIzBR,IAAWoF,GAAmC,IAArBO,EAAUvG,eAC/BgG,GAAUE,GACjBD,EAAOF,kBAnBFE,GAAOJ,SACPI,GAAOH,SACPG,GAAOF,EAuBhB,OAAO7G,OAGRoH,uBAAwB,WAEvB,aADOpH,MAAKqG,GACLrG,MAGRwH,UAAW,SAAUb,EAAMjD,GAC1B,IAAK1D,KAAKkH,kBAAkBP,GAC3B,MAAO3G,KAGR,IAGCqH,GAAWjH,EAAGE,EAAKwG,EAAWE,EAH3BN,EAAQjH,EAAEQ,KAAKC,UAAWwD,GAAQiD,KAAMA,EAAMc,OAAQzH,OAEtD+G,EAAS/G,KAAKqG,EAGlB,IAAIU,EAAOJ,GAIV,IAFAU,EAAYN,EAAOJ,GAAMhG,QAEpBP,EAAI,EAAGE,EAAM+G,EAAUvG,OAAYR,EAAJF,EAASA,IAC5CiH,EAAUjH,GAAG6G,OAAOrG,KAAKyG,EAAUjH,GAAGsB,QAASgF,EAKjDI,GAAYC,EAAOJ,EAAO,OAE1B,KAAKK,IAAaF,GAGjB,GAFAO,EAAYP,EAAUE,GAAWrG,QAGhC,IAAKP,EAAI,EAAGE,EAAM+G,EAAUvG,OAAYR,EAAJF,EAASA,IAC5CiH,EAAUjH,GAAG6G,OAAOrG,KAAKyG,EAAUjH,GAAGsB,QAASgF,EAKlD,OAAO1G,OAGR0H,wBAAyB,SAAUjB,EAAOxF,EAAIS,GAE7C,GAAIjC,EAAEQ,KAAKuB,WAAWiF,EAAOzG,KAAK0H,wBAAyB1H,KAAMiB,EAAIS,GAAY,MAAO1B,KAExF,IAAI2H,GAAUlI,EAAEuB,KAAK,WACpBhB,KACEmH,oBAAoBV,EAAOxF,EAAIS,GAC/ByF,oBAAoBV,EAAOkB,EAASjG,IACpC1B,KAEH,OAAOA,MACLwG,iBAAiBC,EAAOxF,EAAIS,GAC5B8E,iBAAiBC,EAAOkB,EAASjG,KAIrCjC,EAAE6G,MAAMC,OAAOqB,GAAKnI,EAAE6G,MAAMC,OAAOC,iBACnC/G,EAAE6G,MAAMC,OAAOsB,IAAMpI,EAAE6G,MAAMC,OAAOY,oBACpC1H,EAAE6G,MAAMC,OAAOuB,KAAOrI,EAAE6G,MAAMC,OAAOmB,wBACrCjI,EAAE6G,MAAMC,OAAOwB,KAAOtI,EAAE6G,MAAMC,OAAOiB,UAOpC,WAEA,GAAIQ,GAAK,iBAAmB3I,GAC3B4I,EAAQD,IAAO1I,EAASkH,iBAGxB0B,EAAKC,UAAUC,UAAUC,cACzBC,EAAkC,KAAzBJ,EAAG3E,QAAQ,UACpBgF,EAAkC,KAAzBL,EAAG3E,QAAQ,UACpBiF,EAAsC,KAA1BN,EAAG3E,QAAQ,WACvBkF,EAAoC,KAA1BP,EAAG3E,QAAQ,WACrBmF,EAA0C,KAA9BR,EAAGS,OAAO,gBACtBC,EAAgC,KAAxBV,EAAG3E,QAAQ,SAEnBsF,QAAgBC,cAAgBvJ,EAAY,GAC5CwJ,EAAY1J,EAAO8I,WAAa9I,EAAO8I,UAAUa,kBAChD3J,EAAO8I,UAAUc,mBAAqB5J,EAAO6J,aAC9CC,EAAW9J,EAAO6J,cAAgB7J,EAAO8I,UAAUiB,gBAAkB/J,EAAO8I,UAAUkB,gBACrFN,EACDO,EAAU,oBAAsBjK,IAAUA,EAAOkK,iBAAmB,GAClE,cAAgBlK,IAAUA,EAAOmK,WAAW,4BAC7CnK,EAAOmK,WAAW,2BAA2BC,QAE9CC,EAAMpK,EAASqK,gBACfC,EAAO5B,GAAO,cAAgB0B,GAAIG,MAClCC,EAAY,mBAAqBzK,IAAY,OAAS,IAAIA,GAAO0K,kBAAuBrB,EACxFsB,EAAU,kBAAoBN,GAAIG,MAClCI,EAAU,eAAiBP,GAAIG,MAC/BK,GAAS7K,EAAO8K,eAAiBP,GAAQE,GAAYE,GAAWC,KAAazB,EAM1E4B,GAAS/K,EAAOgL,aAAe7B,GAAc,WAE/C,GAAI8B,GAAY,cAGhB,IAAInB,GAAYmB,IAAaZ,GAC5B,OAAO,CAIR,IAAIa,GAAMjL,EAASkL,cAAc,OAChCC,GAAY,CAEb,OAAKF,GAAIG,cAGTH,EAAIG,aAAaJ,EAAW,WAEE,kBAAnBC,GAAID,KACdG,GAAY,GAGbF,EAAII,gBAAgBL,GACpBC,EAAM,KAECE,IAXC,IAeVhL,GAAEmL,SACD5C,GAAIA,EACJC,MAAOA,EACPK,OAAQA,EACRM,MAAOA,IAAUN,IAAWjJ,EAAOwL,QAAU7C,EAE7CS,QAASA,EACTC,UAAWA,EAEXH,OAAQA,EAERqB,KAAMA,EACNE,SAAUA,EACVE,QAASA,EACTC,QAASA,EACTC,MAAOA,EAEPrB,OAAQA,EACRiC,aAAcjC,GAAUP,EACxByC,eAAgBlC,GAAUiB,EAC1BkB,YAAanC,GAAUxJ,EAAOwL,MAE9BT,MAAOA,EACPrB,UAAWA,EACXI,QAASA,EAETG,OAAQA,MAUV7J,EAAEwL,MAAQ,SAAqBC,EAAcC,EAAe3I,GAC3DxC,KAAKkL,EAAK1I,EAAQD,KAAKC,MAAM0I,GAAKA,EAClClL,KAAKmL,EAAK3I,EAAQD,KAAKC,MAAM2I,GAAKA,GAGnC1L,EAAEwL,MAAMvK,WAEP0K,MAAO,WACN,MAAO,IAAI3L,GAAEwL,MAAMjL,KAAKkL,EAAGlL,KAAKmL,IAIjCE,IAAK,SAAUC,GACd,MAAOtL,MAAKoL,QAAQG,KAAK9L,EAAE6L,MAAMA,KAIlCC,KAAM,SAAUD,GAGf,MAFAtL,MAAKkL,GAAKI,EAAMJ,EAChBlL,KAAKmL,GAAKG,EAAMH,EACTnL,MAGRwL,SAAU,SAAUF,GACnB,MAAOtL,MAAKoL,QAAQK,UAAUhM,EAAE6L,MAAMA,KAGvCG,UAAW,SAAUH,GAGpB,MAFAtL,MAAKkL,GAAKI,EAAMJ,EAChBlL,KAAKmL,GAAKG,EAAMH,EACTnL,MAGR0L,SAAU,SAAUtJ,GACnB,MAAOpC,MAAKoL,QAAQO,UAAUvJ,IAG/BuJ,UAAW,SAAUvJ,GAGpB,MAFApC,MAAKkL,GAAK9I,EACVpC,KAAKmL,GAAK/I,EACHpC,MAGR4L,WAAY,SAAUxJ,GACrB,MAAOpC,MAAKoL,QAAQS,YAAYzJ,IAGjCyJ,YAAa,SAAUzJ,GAGtB,MAFApC,MAAKkL,GAAK9I,EACVpC,KAAKmL,GAAK/I,EACHpC,MAGRwC,MAAO,WACN,MAAOxC,MAAKoL,QAAQU,UAGrBA,OAAQ,WAGP,MAFA9L,MAAKkL,EAAI3I,KAAKC,MAAMxC,KAAKkL,GACzBlL,KAAKmL,EAAI5I,KAAKC,MAAMxC,KAAKmL,GAClBnL,MAGR+L,MAAO,WACN,MAAO/L,MAAKoL,QAAQY,UAGrBA,OAAQ,WAGP,MAFAhM,MAAKkL,EAAI3I,KAAKwJ,MAAM/L,KAAKkL,GACzBlL,KAAKmL,EAAI5I,KAAKwJ,MAAM/L,KAAKmL,GAClBnL,MAGRiM,WAAY,SAAUX,GACrBA,EAAQ7L,EAAE6L,MAAMA,EAEhB,IAAIJ,GAAII,EAAMJ,EAAIlL,KAAKkL,EACtBC,EAAIG,EAAMH,EAAInL,KAAKmL,CAEpB,OAAO5I,MAAK2J,KAAKhB,EAAIA,EAAIC,EAAIA,IAG9BgB,OAAQ,SAAUb,GAGjB,MAFAA,GAAQ7L,EAAE6L,MAAMA,GAETA,EAAMJ,IAAMlL,KAAKkL,GACvBI,EAAMH,IAAMnL,KAAKmL,GAGnBiB,SAAU,SAAUd,GAGnB,MAFAA,GAAQ7L,EAAE6L,MAAMA,GAET/I,KAAK8J,IAAIf,EAAMJ,IAAM3I,KAAK8J,IAAIrM,KAAKkL,IACzC3I,KAAK8J,IAAIf,EAAMH,IAAM5I,KAAK8J,IAAIrM,KAAKmL,IAGrCpH,SAAU,WACT,MAAO,SACNtE,EAAEQ,KAAKkC,UAAUnC,KAAKkL,GAAK,KAC3BzL,EAAEQ,KAAKkC,UAAUnC,KAAKmL,GAAK,MAI9B1L,EAAE6L,MAAQ,SAAUJ,EAAGC,EAAG3I,GACzB,MAAI0I,aAAazL,GAAEwL,MACXC,EAEJzL,EAAEQ,KAAK4D,QAAQqH,GACX,GAAIzL,GAAEwL,MAAMC,EAAE,GAAIA,EAAE,IAExBA,IAAM3L,GAAmB,OAAN2L,EACfA,EAED,GAAIzL,GAAEwL,MAAMC,EAAGC,EAAG3I,IAQ1B/C,EAAE6M,OAAS,SAAUC,EAAGC,GACvB,GAAKD,EAIL,IAAK,GAFDE,GAASD,GAAKD,EAAGC,GAAKD,EAEjBnM,EAAI,EAAGE,EAAMmM,EAAO3L,OAAYR,EAAJF,EAASA,IAC7CJ,KAAKE,OAAOuM,EAAOrM,KAIrBX,EAAE6M,OAAO5L,WAERR,OAAQ,SAAUoL,GAYjB,MAXAA,GAAQ7L,EAAE6L,MAAMA,GAEXtL,KAAK0M,KAAQ1M,KAAKuE,KAItBvE,KAAK0M,IAAIxB,EAAI3I,KAAKmK,IAAIpB,EAAMJ,EAAGlL,KAAK0M,IAAIxB,GACxClL,KAAKuE,IAAI2G,EAAI3I,KAAKgC,IAAI+G,EAAMJ,EAAGlL,KAAKuE,IAAI2G,GACxClL,KAAK0M,IAAIvB,EAAI5I,KAAKmK,IAAIpB,EAAMH,EAAGnL,KAAK0M,IAAIvB,GACxCnL,KAAKuE,IAAI4G,EAAI5I,KAAKgC,IAAI+G,EAAMH,EAAGnL,KAAKuE,IAAI4G,KANxCnL,KAAK0M,IAAMpB,EAAMF,QACjBpL,KAAKuE,IAAM+G,EAAMF,SAOXpL,MAGR2M,UAAW,SAAUnK,GACpB,MAAO,IAAI/C,GAAEwL,OACXjL,KAAK0M,IAAIxB,EAAIlL,KAAKuE,IAAI2G,GAAK,GAC3BlL,KAAK0M,IAAIvB,EAAInL,KAAKuE,IAAI4G,GAAK,EAAG3I,IAGjCoK,cAAe,WACd,MAAO,IAAInN,GAAEwL,MAAMjL,KAAK0M,IAAIxB,EAAGlL,KAAKuE,IAAI4G,IAGzC0B,YAAa,WACZ,MAAO,IAAIpN,GAAEwL,MAAMjL,KAAKuE,IAAI2G,EAAGlL,KAAK0M,IAAIvB,IAGzC2B,QAAS,WACR,MAAO9M,MAAKuE,IAAIiH,SAASxL,KAAK0M,MAG/BN,SAAU,SAAUlL,GACnB,GAAIwL,GAAKnI,CAeT,OAZCrD,GADqB,gBAAXA,GAAI,IAAmBA,YAAezB,GAAEwL,MAC5CxL,EAAE6L,MAAMpK,GAERzB,EAAEsN,OAAO7L,GAGZA,YAAezB,GAAE6M,QACpBI,EAAMxL,EAAIwL,IACVnI,EAAMrD,EAAIqD,KAEVmI,EAAMnI,EAAMrD,EAGLwL,EAAIxB,GAAKlL,KAAK0M,IAAIxB,GACxB3G,EAAI2G,GAAKlL,KAAKuE,IAAI2G,GAClBwB,EAAIvB,GAAKnL,KAAK0M,IAAIvB,GAClB5G,EAAI4G,GAAKnL,KAAKuE,IAAI4G,GAGrB6B,WAAY,SAAUD,GACrBA,EAAStN,EAAEsN,OAAOA,EAElB,IAAIL,GAAM1M,KAAK0M,IACdnI,EAAMvE,KAAKuE,IACX0I,EAAOF,EAAOL,IACdQ,EAAOH,EAAOxI,IACd4I,EAAeD,EAAKhC,GAAKwB,EAAIxB,GAAO+B,EAAK/B,GAAK3G,EAAI2G,EAClDkC,EAAeF,EAAK/B,GAAKuB,EAAIvB,GAAO8B,EAAK9B,GAAK5G,EAAI4G,CAEnD,OAAOgC,IAAeC,GAGvBC,QAAS,WACR,SAAUrN,KAAK0M,MAAO1M,KAAKuE,OAI7B9E,EAAEsN,OAAS,SAAUR,EAAGC,GACvB,OAAKD,GAAKA,YAAa9M,GAAE6M,OACjBC,EAED,GAAI9M,GAAE6M,OAAOC,EAAGC,IAQxB/M,EAAE6N,eAAiB,SAAUf,EAAGC,EAAGe,EAAGC,GACrCxN,KAAKyN,GAAKlB,EACVvM,KAAK0N,GAAKlB,EACVxM,KAAK2N,GAAKJ,EACVvN,KAAK4N,GAAKJ,GAGX/N,EAAE6N,eAAe5M,WAChBmN,UAAW,SAAUvC,EAAOwC,GAC3B,MAAO9N,MAAK+N,WAAWzC,EAAMF,QAAS0C,IAIvCC,WAAY,SAAUzC,EAAOwC,GAI5B,MAHAA,GAAQA,GAAS,EACjBxC,EAAMJ,EAAI4C,GAAS9N,KAAKyN,GAAKnC,EAAMJ,EAAIlL,KAAK0N,IAC5CpC,EAAMH,EAAI2C,GAAS9N,KAAK2N,GAAKrC,EAAMH,EAAInL,KAAK4N,IACrCtC,GAGR0C,YAAa,SAAU1C,EAAOwC,GAE7B,MADAA,GAAQA,GAAS,EACV,GAAIrO,GAAEwL,OACXK,EAAMJ,EAAI4C,EAAQ9N,KAAK0N,IAAM1N,KAAKyN,IAClCnC,EAAMH,EAAI2C,EAAQ9N,KAAK4N,IAAM5N,KAAK2N,MAStClO,EAAEwO,SACDC,IAAK,SAAUrJ,GACd,MAAsB,gBAAPA,GAAkBvF,EAAS6O,eAAetJ,GAAMA,GAGhEuJ,SAAU,SAAUC,EAAIxE,GAEvB,GAAIlG,GAAQ0K,EAAGxE,MAAMA,EAMrB,KAJKlG,GAAS0K,EAAGC,eAChB3K,EAAQ0K,EAAGC,aAAazE,MAGnBlG,GAAmB,SAAVA,IAAqBrE,EAASiP,YAAa,CACzD,GAAIC,GAAMlP,EAASiP,YAAYE,iBAAiBJ,EAAI,KACpD1K,GAAQ6K,EAAMA,EAAI3E,GAAS,KAG5B,MAAiB,SAAVlG,EAAmB,KAAOA,GAGlC+K,kBAAmB,SAAUzJ,GAE5B,GAKC0J,GALGC,EAAM,EACTC,EAAO,EACPR,EAAKpJ,EACL6J,EAAUxP,EAASyP,KACnBC,EAAQ1P,EAASqK,eAGlB,GAAG,CAUF,GATAiF,GAAQP,EAAGY,WAAc,EACzBJ,GAAQR,EAAGa,YAAc,EAGzBN,GAAOO,SAAS1P,EAAEwO,QAAQG,SAASC,EAAI,kBAAmB,KAAO,EACjEQ,GAAQM,SAAS1P,EAAEwO,QAAQG,SAASC,EAAI,mBAAoB,KAAO,EAEnEM,EAAMlP,EAAEwO,QAAQG,SAASC,EAAI,YAEzBA,EAAGe,eAAiBN,GAAmB,aAARH,EAAsB,KAEzD,IAAY,UAARA,EAAiB,CACpBC,GAAQE,EAAQO,WAAcL,EAAMK,WAAc,EAClDR,GAAQC,EAAQQ,YAAcN,EAAMM,YAAc,CAClD,OAGD,GAAY,aAARX,IAAuBN,EAAGa,WAAY,CACzC,GAAIK,GAAQ9P,EAAEwO,QAAQG,SAASC,EAAI,SAClCmB,EAAW/P,EAAEwO,QAAQG,SAASC,EAAI,aAClCoB,EAAIpB,EAAGqB,uBAEM,UAAVH,GAAiC,SAAbC,IACvBX,GAAQY,EAAEZ,KAAOR,EAAGsB,YAIrBf,GAAOa,EAAEb,KAAOE,EAAQO,WAAcL,EAAMK,WAAc,EAE1D,OAGDhB,EAAKA,EAAGe,mBAEAf,EAETA,GAAKpJ,CAEL,GAAG,CACF,GAAIoJ,IAAOS,EAAW,KAEtBF,IAAQP,EAAGgB,WAAc,EACzBR,GAAQR,EAAGiB,YAAc,EAEzBjB,EAAKA,EAAGuB,iBACAvB,EAET,OAAO,IAAI5O,GAAEwL,MAAM4D,EAAMD,IAG1BiB,cAAe,WAKd,MAJKpQ,GAAEwO,QAAQ6B,kBACdrQ,EAAEwO,QAAQ6B,iBAAkB,EAC5BrQ,EAAEwO,QAAQ8B,UAA+D,QAAnDtQ,EAAEwO,QAAQG,SAAS9O,EAASyP,KAAM,cAElDtP,EAAEwO,QAAQ8B,WAGlBC,OAAQ,SAAUC,EAASC,EAAWC,GAErC,GAAI9B,GAAK/O,EAASkL,cAAcyF,EAOhC,OANA5B,GAAG6B,UAAYA,EAEXC,GACHA,EAAUC,YAAY/B,GAGhBA,GAGRgC,SAAU,SAAUhC,EAAInK,GACvB,GAAImK,EAAGiC,YAAc/Q,EACpB,MAAO8O,GAAGiC,UAAUlE,SAASlI,EAE9B,IAAIgM,GAAYzQ,EAAEwO,QAAQsC,UAAUlC,EACpC,OAAO6B,GAAUpP,OAAS,GAAK,GAAI0P,QAAO,UAAYtM,EAAO,WAAWuM,KAAKP,IAG9EQ,SAAU,SAAUrC,EAAInK,GACvB,GAAImK,EAAGiC,YAAc/Q,EAEpB,IAAK,GADDoR,GAAUlR,EAAEQ,KAAK2C,WAAWsB,GACvB9D,EAAI,EAAGE,EAAMqQ,EAAQ7P,OAAYR,EAAJF,EAASA,IAC9CiO,EAAGiC,UAAUjF,IAAIsF,EAAQvQ,QAEpB,KAAKX,EAAEwO,QAAQoC,SAAShC,EAAInK,GAAO,CACzC,GAAIgM,GAAYzQ,EAAEwO,QAAQsC,UAAUlC,EACpC5O,GAAEwO,QAAQ2C,UAAUvC,GAAK6B,EAAYA,EAAY,IAAM,IAAMhM,KAI/D2M,YAAa,SAAUxC,EAAInK,GACtBmK,EAAGiC,YAAc/Q,EACpB8O,EAAGiC,UAAUQ,OAAO5M,GAEpBzE,EAAEwO,QAAQ2C,UAAUvC,EAAI5O,EAAEQ,KAAKwC,MAAM,IAAMhD,EAAEwO,QAAQsC,UAAUlC,GAAM,KAAK1L,QAAQ,IAAMuB,EAAO,IAAK,QAItG0M,UAAW,SAAUvC,EAAInK,GACpBmK,EAAG6B,UAAUa,UAAYxR,EAC5B8O,EAAG6B,UAAYhM,EAGfmK,EAAG6B,UAAUa,QAAU7M,GAIzBqM,UAAW,SAAUlC,GACpB,MAAOA,GAAG6B,UAAUa,UAAYxR,EAAY8O,EAAG6B,UAAY7B,EAAG6B,UAAUa,SAGzEC,WAAY,SAAU3C,EAAI1K,GAEzB,GAAI,WAAa0K,GAAGxE,MACnBwE,EAAGxE,MAAMoH,QAAUtN,MAEb,IAAI,UAAY0K,GAAGxE,MAAO,CAEhC,GAAIqH,IAAS,EACZC,EAAa,kCAGd,KACCD,EAAS7C,EAAG+C,QAAQC,KAAKF,GACxB,MAAOG,GAGR,GAAc,IAAV3N,EAAe,OAGpBA,EAAQpB,KAAKC,MAAc,IAARmB,GAEfuN,GACHA,EAAOK,QAAqB,MAAV5N,EAClBuN,EAAOM,QAAU7N,GAEjB0K,EAAGxE,MAAMqH,QAAU,WAAaC,EAAa,YAAcxN,EAAQ,MAKtE8N,SAAU,SAAUrM,GAInB,IAAK,GAFDyE,GAAQvK,EAASqK,gBAAgBE,MAE5BzJ,EAAI,EAAGA,EAAIgF,EAAMtE,OAAQV,IACjC,GAAIgF,EAAMhF,IAAMyJ,GACf,MAAOzE,GAAMhF,EAGf,QAAO,GAGRsR,mBAAoB,SAAUpG,GAK7B,GAAIqG,GAAOlS,EAAEmL,QAAQd,SACpB8H,EAAO,aAAeD,EAAO,KAAO,IAAM,IAC1CE,GAASF,EAAO,KAAO,IAAM,GAE9B,OAAOC,GAAOtG,EAAMJ,EAAI,MAAQI,EAAMH,EAAI,KAAO0G,GAGlDC,eAAgB,SAAUhE,EAAOiE,GAEhC,GAAIC,GAAkBvS,EAAEwO,QAAQyD,mBAAmBK,EAAO1G,IAAI0G,EAAOnG,WAAW,GAAKkC,KACpFmE,EAAW,UAAYnE,EAAQ,IAEhC,OAAOkE,GAAkBC,GAG1BC,YAAa,SAAU7D,EAAI/C,EAAO6G,GAGjC9D,EAAG+D,aAAe9G,GAEb6G,GAAa1S,EAAEmL,QAAQV,MAC3BmE,EAAGxE,MAAMpK,EAAEwO,QAAQoE,WAAc5S,EAAEwO,QAAQyD,mBAAmBpG,IAE9D+C,EAAGxE,MAAMgF,KAAOvD,EAAMJ,EAAI,KAC1BmD,EAAGxE,MAAM+E,IAAMtD,EAAMH,EAAI,OAI3BmH,YAAa,SAAUjE,GAKtB,MAAOA,GAAG+D,eAOZ3S,EAAEwO,QAAQoE,UAAY5S,EAAEwO,QAAQwD,UAC9B,YAAa,kBAAmB,aAAc,eAAgB,gBAKhEhS,EAAEwO,QAAQsE,WAAa9S,EAAEwO,QAAQwD,UAC/B,mBAAoB,aAAc,cAAe,gBAAiB,iBAEpEhS,EAAEwO,QAAQuE,eACgB,qBAAzB/S,EAAEwO,QAAQsE,YAA8D,gBAAzB9S,EAAEwO,QAAQsE,WACzD9S,EAAEwO,QAAQsE,WAAa,MAAQ,gBAEhC,WACC,GAAI,iBAAmBjT,GACtBG,EAAES,OAAOT,EAAEwO,SACVwE,qBAAsB,WACrBhT,EAAEiT,SAAS9K,GAAGvI,EAAQ,cAAeI,EAAEiT,SAASC,iBAGjDC,oBAAqB,WACpBnT,EAAEiT,SAAS7K,IAAIxI,EAAQ,cAAeI,EAAEiT,SAASC,uBAG7C,CACN,GAAIE,GAAqBpT,EAAEwO,QAAQwD,UACjC,aAAc,mBAAoB,cAAe,gBAAiB,gBAEpEhS,GAAES,OAAOT,EAAEwO,SACVwE,qBAAsB,WACrB,GAAII,EAAoB,CACvB,GAAIhJ,GAAQvK,EAASqK,gBAAgBE,KACrC7J,MAAK8S,YAAcjJ,EAAMgJ,GACzBhJ,EAAMgJ,GAAsB,SAI9BD,oBAAqB,WAChBC,IACHvT,EAASqK,gBAAgBE,MAAMgJ,GAAsB7S,KAAK8S,kBACnD9S,MAAK8S,gBAMhBrT,EAAES,OAAOT,EAAEwO,SACV8E,iBAAkB,WACjBtT,EAAEiT,SAAS9K,GAAGvI,EAAQ,YAAaI,EAAEiT,SAASC,iBAG/CK,gBAAiB,WAChBvT,EAAEiT,SAAS7K,IAAIxI,EAAQ,YAAaI,EAAEiT,SAASC,sBAUlDlT,EAAEwT,OAAS,SAAUC,EAAKC,EAAKC,GAI9B,GAHAF,EAAMG,WAAWH,GACjBC,EAAME,WAAWF,GAEbG,MAAMJ,IAAQI,MAAMH,GACvB,KAAM,IAAIvP,OAAM,2BAA6BsP,EAAM,KAAOC,EAAM,IAGjEnT,MAAKkT,IAAMA,EACXlT,KAAKmT,IAAMA,EAEPC,IAAQ7T,IACXS,KAAKoT,IAAMC,WAAWD,KAIxB3T,EAAES,OAAOT,EAAEwT,QACVM,WAAYhR,KAAKiR,GAAK,IACtBC,WAAY,IAAMlR,KAAKiR,GACvBE,WAAY,OAGbjU,EAAEwT,OAAOvS,WACRyL,OAAQ,SAAUjL,GACjB,IAAKA,EAAO,OAAO,CAEnBA,GAAMzB,EAAEkU,OAAOzS,EAEf,IAAI0S,GAASrR,KAAKgC,IACjBhC,KAAK8J,IAAIrM,KAAKkT,IAAMhS,EAAIgS,KACxB3Q,KAAK8J,IAAIrM,KAAKmT,IAAMjS,EAAIiS,KAEzB,OAAOS,IAAUnU,EAAEwT,OAAOS,YAG3B3P,SAAU,SAAU8P,GACnB,MAAO,UACNpU,EAAEQ,KAAKkC,UAAUnC,KAAKkT,IAAKW,GAAa,KACxCpU,EAAEQ,KAAKkC,UAAUnC,KAAKmT,IAAKU,GAAa,KAK1C5H,WAAY,SAAU6H,GACrBA,EAAQrU,EAAEkU,OAAOG,EAEjB,IAAIC,GAAI,QACPC,EAAMvU,EAAEwT,OAAOM,WACfU,GAAQH,EAAMZ,IAAMlT,KAAKkT,KAAOc,EAChCE,GAAQJ,EAAMX,IAAMnT,KAAKmT,KAAOa,EAChCG,EAAOnU,KAAKkT,IAAMc,EAClBI,EAAON,EAAMZ,IAAMc,EACnBK,EAAO9R,KAAK+R,IAAIL,EAAO,GACvBM,EAAOhS,KAAK+R,IAAIJ,EAAO,GAEpB3H,EAAI8H,EAAOA,EAAOE,EAAOA,EAAOhS,KAAKiS,IAAIL,GAAQ5R,KAAKiS,IAAIJ,EAE9D,OAAW,GAAJL,EAAQxR,KAAKkS,MAAMlS,KAAK2J,KAAKK,GAAIhK,KAAK2J,KAAK,EAAIK,KAGvDmI,KAAM,SAAUnI,EAAGC,GAClB,GAAI2G,GAAMnT,KAAKmT,GAOf,OALA5G,GAAIA,GAAK,KACTC,EAAIA,GAAM,IAEV2G,GAAOA,EAAM3G,IAAMA,EAAID,IAAYA,EAAN4G,GAAWA,IAAQ3G,EAAIA,EAAID,GAEjD,GAAI9M,GAAEwT,OAAOjT,KAAKkT,IAAKC,KAIhC1T,EAAEkU,OAAS,SAAUpH,EAAGC,GACvB,MAAID,aAAa9M,GAAEwT,OACX1G,EAEJ9M,EAAEQ,KAAK4D,QAAQ0I,GACE,gBAATA,GAAE,IAAmC,gBAATA,GAAE,GACjC,GAAI9M,GAAEwT,OAAO1G,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAE3B,KAGLA,IAAMhN,GAAmB,OAANgN,EACfA,EAES,gBAANA,IAAkB,OAASA,GAC9B,GAAI9M,GAAEwT,OAAO1G,EAAE2G,IAAK,OAAS3G,GAAIA,EAAE4G,IAAM5G,EAAEoI,KAE/CnI,IAAMjN,EACF,KAED,GAAIE,GAAEwT,OAAO1G,EAAGC,IASxB/M,EAAEmV,aAAe,SAAUC,EAAWC,GACrC,GAAKD,EAIL,IAAK,GAFDE,GAAUD,GAAaD,EAAWC,GAAaD,EAE1CzU,EAAI,EAAGE,EAAMyU,EAAQjU,OAAYR,EAAJF,EAASA,IAC9CJ,KAAKE,OAAO6U,EAAQ3U,KAItBX,EAAEmV,aAAalU,WAEdR,OAAQ,SAAUgB,GACjB,IAAKA,EAAO,MAAOlB,KAEnB,IAAI2T,GAASlU,EAAEkU,OAAOzS,EAsBtB,OApBCA,GADc,OAAXyS,EACGA,EAEAlU,EAAEuV,aAAa9T,GAGlBA,YAAezB,GAAEwT,OACfjT,KAAKiV,YAAejV,KAAKkV,YAI7BlV,KAAKiV,WAAW/B,IAAM3Q,KAAKmK,IAAIxL,EAAIgS,IAAKlT,KAAKiV,WAAW/B,KACxDlT,KAAKiV,WAAW9B,IAAM5Q,KAAKmK,IAAIxL,EAAIiS,IAAKnT,KAAKiV,WAAW9B,KAExDnT,KAAKkV,WAAWhC,IAAM3Q,KAAKgC,IAAIrD,EAAIgS,IAAKlT,KAAKkV,WAAWhC,KACxDlT,KAAKkV,WAAW/B,IAAM5Q,KAAKgC,IAAIrD,EAAIiS,IAAKnT,KAAKkV,WAAW/B,OAPxDnT,KAAKiV,WAAa,GAAIxV,GAAEwT,OAAO/R,EAAIgS,IAAKhS,EAAIiS,KAC5CnT,KAAKkV,WAAa,GAAIzV,GAAEwT,OAAO/R,EAAIgS,IAAKhS,EAAIiS,MAQnCjS,YAAezB,GAAEmV,eAC3B5U,KAAKE,OAAOgB,EAAI+T,YAChBjV,KAAKE,OAAOgB,EAAIgU,aAEVlV,MAIRmV,IAAK,SAAUC,GACd,GAAIC,GAAKrV,KAAKiV,WACbK,EAAKtV,KAAKkV,WACVK,EAAehT,KAAK8J,IAAIgJ,EAAGnC,IAAMoC,EAAGpC,KAAOkC,EAC3CI,EAAcjT,KAAK8J,IAAIgJ,EAAGlC,IAAMmC,EAAGnC,KAAOiC,CAE3C,OAAO,IAAI3V,GAAEmV,aACZ,GAAInV,GAAEwT,OAAOoC,EAAGnC,IAAMqC,EAAcF,EAAGlC,IAAMqC,GAC7C,GAAI/V,GAAEwT,OAAOqC,EAAGpC,IAAMqC,EAAcD,EAAGnC,IAAMqC,KAG/C7I,UAAW,WACV,MAAO,IAAIlN,GAAEwT,QACXjT,KAAKiV,WAAW/B,IAAMlT,KAAKkV,WAAWhC,KAAO,GAC7ClT,KAAKiV,WAAW9B,IAAMnT,KAAKkV,WAAW/B,KAAO,IAGhDsC,aAAc,WACb,MAAOzV,MAAKiV,YAGbS,aAAc,WACb,MAAO1V,MAAKkV,YAGbS,aAAc,WACb,MAAO,IAAIlW,GAAEwT,OAAOjT,KAAK4V,WAAY5V,KAAK6V,YAG3CC,aAAc,WACb,MAAO,IAAIrW,GAAEwT,OAAOjT,KAAK+V,WAAY/V,KAAKgW,YAG3CH,QAAS,WACR,MAAO7V,MAAKiV,WAAW9B,KAGxB4C,SAAU,WACT,MAAO/V,MAAKiV,WAAW/B,KAGxB8C,QAAS,WACR,MAAOhW,MAAKkV,WAAW/B,KAGxByC,SAAU,WACT,MAAO5V,MAAKkV,WAAWhC,KAGxB9G,SAAU,SAAUlL,GAElBA,EADqB,gBAAXA,GAAI,IAAmBA,YAAezB,GAAEwT,OAC5CxT,EAAEkU,OAAOzS,GAETzB,EAAEuV,aAAa9T,EAGtB,IAEC+U,GAAKC,EAFFb,EAAKrV,KAAKiV,WACbK,EAAKtV,KAAKkV,UAUX,OAPIhU,aAAezB,GAAEmV,cACpBqB,EAAM/U,EAAIuU,eACVS,EAAMhV,EAAIwU,gBAEVO,EAAMC,EAAMhV,EAGL+U,EAAI/C,KAAOmC,EAAGnC,KAASgD,EAAIhD,KAAOoC,EAAGpC,KAC3C+C,EAAI9C,KAAOkC,EAAGlC,KAAS+C,EAAI/C,KAAOmC,EAAGnC,KAGxCnG,WAAY,SAAUD,GACrBA,EAAStN,EAAEuV,aAAajI,EAExB,IAAIsI,GAAKrV,KAAKiV,WACbK,EAAKtV,KAAKkV,WACVe,EAAMlJ,EAAO0I,eACbS,EAAMnJ,EAAO2I,eAEbS,EAAiBD,EAAIhD,KAAOmC,EAAGnC,KAAS+C,EAAI/C,KAAOoC,EAAGpC,IACtDkD,EAAiBF,EAAI/C,KAAOkC,EAAGlC,KAAS8C,EAAI9C,KAAOmC,EAAGnC,GAEvD,OAAOgD,IAAiBC,GAGzBC,aAAc,WACb,OAAQrW,KAAK6V,UAAW7V,KAAK+V,WAAY/V,KAAKgW,UAAWhW,KAAK4V,YAAYpS,KAAK,MAGhF2I,OAAQ,SAAUY,GACjB,MAAKA,IAELA,EAAStN,EAAEuV,aAAajI,GAEjB/M,KAAKiV,WAAW9I,OAAOY,EAAO0I,iBACpCzV,KAAKkV,WAAW/I,OAAOY,EAAO2I,kBALT,GAQvBrI,QAAS,WACR,SAAUrN,KAAKiV,aAAcjV,KAAKkV,cAMpCzV,EAAEuV,aAAe,SAAUzI,EAAGC,GAC7B,OAAKD,GAAKA,YAAa9M,GAAEmV,aACjBrI,EAED,GAAI9M,GAAEmV,aAAarI,EAAGC,IAQ9B/M,EAAE6W,cAOF7W,EAAE6W,WAAWC,mBACZC,aAAc,cAEdC,QAAS,SAAUC,GAClB,GAAIlJ,GAAI/N,EAAEwT,OAAOM,WAChBhP,EAAMvE,KAAKwW,aACXtD,EAAM3Q,KAAKgC,IAAIhC,KAAKmK,IAAInI,EAAKmS,EAAOxD,MAAO3O,GAC3C2G,EAAIwL,EAAOvD,IAAM3F,EACjBrC,EAAI+H,EAAM1F,CAIX,OAFArC,GAAI5I,KAAKoU,IAAIpU,KAAKqU,IAAKrU,KAAKiR,GAAK,EAAMrI,EAAI,IAEpC,GAAI1L,GAAEwL,MAAMC,EAAGC,IAGvB0L,UAAW,SAAUvL,GACpB,GAAIkC,GAAI/N,EAAEwT,OAAOQ,WAChBN,EAAM7H,EAAMJ,EAAIsC,EAChB0F,GAAO,EAAI3Q,KAAKuU,KAAKvU,KAAKwU,IAAIzL,EAAMH,IAAO5I,KAAKiR,GAAK,GAAMhG,CAE5D,OAAO,IAAI/N,GAAEwT,OAAOC,EAAKC,KAS3B1T,EAAE6W,WAAWU,QACZP,QAAS,SAAUC,GAClB,MAAO,IAAIjX,GAAEwL,MAAMyL,EAAOvD,IAAKuD,EAAOxD,MAGvC2D,UAAW,SAAUvL,GACpB,MAAO,IAAI7L,GAAEwT,OAAO3H,EAAMH,EAAGG,EAAMJ,KASrCzL,EAAEwX,KACDC,cAAe,SAAUR,EAAQS,GAChC,GAAIC,GAAiBpX,KAAKqX,WAAWZ,QAAQC,GAC5C5I,EAAQ9N,KAAK8N,MAAMqJ,EAEpB,OAAOnX,MAAKsX,eAAevJ,WAAWqJ,EAAgBtJ,IAGvDyJ,cAAe,SAAUjM,EAAO6L,GAC/B,GAAIrJ,GAAQ9N,KAAK8N,MAAMqJ,GACtBK,EAAqBxX,KAAKsX,eAAetJ,YAAY1C,EAAOwC,EAE7D,OAAO9N,MAAKqX,WAAWR,UAAUW,IAGlCf,QAAS,SAAUC,GAClB,MAAO1W,MAAKqX,WAAWZ,QAAQC,IAGhC5I,MAAO,SAAUqJ,GAChB,MAAO,KAAM5U,KAAKD,IAAI,EAAG6U,IAG1BrK,QAAS,SAAUqK,GAClB,GAAIM,GAAIzX,KAAK8N,MAAMqJ,EACnB,OAAO1X,GAAE6L,MAAMmM,EAAGA,KASpBhY,EAAEwX,IAAIS,OAASjY,EAAES,UAAWT,EAAEwX,KAC7BI,WAAY5X,EAAE6W,WAAWU,OACzBM,eAAgB,GAAI7X,GAAE6N,eAAe,EAAG,EAAG,GAAI,GAE/CQ,MAAO,SAAUqJ,GAChB,MAAO5U,MAAKD,IAAI,EAAG6U,MAUrB1X,EAAEwX,IAAIU,SAAWlY,EAAES,UAAWT,EAAEwX,KAC/BW,KAAM,YAENP,WAAY5X,EAAE6W,WAAWC,kBACzBe,eAAgB,GAAI7X,GAAE6N,eAAe,GAAM/K,KAAKiR,GAAI,IAAM,GAAMjR,KAAKiR,GAAI,IAEzEiD,QAAS,SAAUC,GAClB,GAAIU,GAAiBpX,KAAKqX,WAAWZ,QAAQC,GAC5CmB,EAAc,OACf,OAAOT,GAAexL,WAAWiM,MAInCpY,EAAEwX,IAAIa,WAAarY,EAAES,UAAWT,EAAEwX,IAAIU,UACrCC,KAAM,gBAQPnY,EAAEwX,IAAIc,SAAWtY,EAAES,UAAWT,EAAEwX,KAC/BW,KAAM,YAENP,WAAY5X,EAAE6W,WAAWU,OACzBM,eAAgB,GAAI7X,GAAE6N,eAAe,EAAI,IAAK,GAAK,GAAK,IAAK,MAQ9D7N,EAAEuY,IAAMvY,EAAE0F,MAAMjF,QAEf2F,SAAUpG,EAAE6G,MAAMC,OAElBxD,SACCkV,IAAKxY,EAAEwX,IAAIU,SAQXO,cAAezY,EAAEwO,QAAQsE,aAAe9S,EAAEmL,QAAQlC,UAClDyP,aAAa,EACbC,oBAAqB3Y,EAAEwO,QAAQsE,YAAc9S,EAAEmL,QAAQV,OAGxD5E,WAAY,SAAUT,EAAI9B,GACzBA,EAAUtD,EAAEqD,WAAW9C,KAAM+C,GAG7B/C,KAAKqY,eAAexT,GACpB7E,KAAKsY,cAGLtY,KAAKuY,UAAY9Y,EAAEuB,KAAKhB,KAAKuY,UAAWvY,MAExCA,KAAKwY,cAEDzV,EAAQ0V,WACXzY,KAAK0Y,aAAa3V,EAAQ0V,WAGvB1V,EAAQ4V,QAAU5V,EAAQoU,OAAS5X,GACtCS,KAAK4Y,QAAQnZ,EAAEkU,OAAO5Q,EAAQ4V,QAAS5V,EAAQoU,MAAO0B,OAAO,IAG9D7Y,KAAK8Y,aAEL9Y,KAAK+Y,WACL/Y,KAAKgZ,oBACLhZ,KAAKiZ,eAAiB,EAEtBjZ,KAAKwF,gBAELxF,KAAKkZ,WAAWnW,EAAQoW,SAOzBP,QAAS,SAAUD,EAAQxB,GAG1B,MAFAA,GAAOA,IAAS5X,EAAYS,KAAKoZ,UAAYjC,EAC7CnX,KAAKqZ,WAAW5Z,EAAEkU,OAAOgF,GAAS3Y,KAAKsZ,WAAWnC,IAC3CnX,MAGRuZ,QAAS,SAAUpC,EAAMpU,GACxB,MAAK/C,MAAKwZ,QAIHxZ,KAAK4Y,QAAQ5Y,KAAK2M,YAAawK,GAAOA,KAAMpU,KAHlD/C,KAAKyZ,MAAQzZ,KAAKsZ,WAAWnC,GACtBnX,OAKT0Z,OAAQ,SAAUC,EAAO5W,GACxB,MAAO/C,MAAKuZ,QAAQvZ,KAAKyZ,OAASE,GAAS,GAAI5W,IAGhD6W,QAAS,SAAUD,EAAO5W,GACzB,MAAO/C,MAAKuZ,QAAQvZ,KAAKyZ,OAASE,GAAS,GAAI5W,IAGhD8W,cAAe,SAAUnD,EAAQS,EAAMpU,GACtC,GAAI+K,GAAQ9N,KAAK8Z,aAAa3C,GAC7B4C,EAAW/Z,KAAK8M,UAAUpB,SAAS,GACnCsO,EAAiBtD,YAAkBjX,GAAEwL,MAAQyL,EAAS1W,KAAKia,uBAAuBvD,GAElFwD,EAAeF,EAAexO,SAASuO,GAAUnO,WAAW,EAAI,EAAIkC,GACpEqM,EAAYna,KAAKoa,uBAAuBL,EAAS1O,IAAI6O,GAEtD,OAAOla,MAAK4Y,QAAQuB,EAAWhD,GAAOA,KAAMpU,KAG7CsX,UAAW,SAAUtN,EAAQhK,GAE5BA,EAAUA,MACVgK,EAASA,EAAOuN,UAAYvN,EAAOuN,YAAc7a,EAAEuV,aAAajI,EAEhE,IAAIwN,GAAY9a,EAAE6L,MAAMvI,EAAQyX,gBAAkBzX,EAAQ0X,UAAY,EAAG,IACxEC,EAAYjb,EAAE6L,MAAMvI,EAAQ4X,oBAAsB5X,EAAQ0X,UAAY,EAAG,IAEzEtD,EAAOnX,KAAK4a,cAAc7N,GAAQ,EAAOwN,EAAUlP,IAAIqP,IACvDG,EAAgBH,EAAUlP,SAAS+O,GAAW7O,SAAS,GAEvDoP,EAAU9a,KAAKyW,QAAQ1J,EAAO0I,eAAgB0B,GAC9C4D,EAAU/a,KAAKyW,QAAQ1J,EAAO2I,eAAgByB,GAC9CwB,EAAS3Y,KAAK6W,UAAUiE,EAAQzP,IAAI0P,GAASrP,SAAS,GAAGL,IAAIwP,GAAgB1D,EAI9E,OAFAA,GAAOpU,GAAWA,EAAQiY,QAAUzY,KAAKmK,IAAI3J,EAAQiY,QAAS7D,GAAQA,EAE/DnX,KAAK4Y,QAAQD,EAAQxB,EAAMpU,IAGnCkY,SAAU,SAAUlY,GACnB,MAAO/C,MAAKqa,YAAY,IAAK,OAAQ,GAAI,MAAOtX,IAGjDmY,MAAO,SAAUvC,EAAQ5V,GACxB,MAAO/C,MAAK4Y,QAAQD,EAAQ3Y,KAAKyZ,OAAQ0B,IAAKpY,KAG/CqY,MAAO,SAAUC,GAOhB,MALArb,MAAK+H,KAAK,aAEV/H,KAAKsb,UAAU7b,EAAE6L,MAAM+P,IAEvBrb,KAAK+H,KAAK,QACH/H,KAAK+H,KAAK,YAGlB2Q,aAAc,SAAU3L,GAKvB,MAJAA,GAAStN,EAAEuV,aAAajI,GAExB/M,KAAK+C,QAAQ0V,UAAY1L,EAEpBA,GAID/M,KAAKwZ,SACRxZ,KAAKub,sBAGCvb,KAAK4H,GAAG,UAAW5H,KAAKub,oBAAqBvb,OAP5CA,KAAK6H,IAAI,UAAW7H,KAAKub,oBAAqBvb,OAUvDwb,gBAAiB,SAAUzO,EAAQhK,GAClC,GAAI4V,GAAS3Y,KAAK2M,YACjBwN,EAAYna,KAAKyb,aAAa9C,EAAQ3Y,KAAKyZ,MAAO1M,EAEnD,OAAI4L,GAAOxM,OAAOgO,GAAqBna,KAEhCA,KAAKkb,MAAMf,EAAWpX,IAG9B2Y,SAAU,SAAUC,GAGnB,GAAI9W,GAAKpF,EAAE4B,MAAMsa,EAEjB,OAAI3b,MAAK+Y,QAAQlU,GAAc7E,MAE/BA,KAAK+Y,QAAQlU,GAAM8W,GAGfA,EAAM5Y,SAAauQ,MAAMqI,EAAM5Y,QAAQiY,UAAa1H,MAAMqI,EAAM5Y,QAAQ6Y,WAC3E5b,KAAKgZ,iBAAiBnU,GAAM8W,EAC5B3b,KAAK6b,qBAIF7b,KAAK+C,QAAQ+Y,eAAiBrc,EAAEsc,WAAcJ,YAAiBlc,GAAEsc,YACpE/b,KAAKiZ,iBACLjZ,KAAKgc,oBACLL,EAAM/T,GAAG,OAAQ5H,KAAKic,iBAAkBjc,OAGrCA,KAAKwZ,SACRxZ,KAAKkc,UAAUP,GAGT3b,OAGRmc,YAAa,SAAUR,GACtB,GAAI9W,GAAKpF,EAAE4B,MAAMsa,EAEjB,OAAK3b,MAAK+Y,QAAQlU,IAEd7E,KAAKwZ,SACRmC,EAAMS,SAASpc,YAGTA,MAAK+Y,QAAQlU,GAEhB7E,KAAKwZ,SACRxZ,KAAK+H,KAAK,eAAgB4T,MAAOA,IAG9B3b,KAAKgZ,iBAAiBnU,WAClB7E,MAAKgZ,iBAAiBnU,GAC7B7E,KAAK6b,qBAIF7b,KAAK+C,QAAQ+Y,eAAiBrc,EAAEsc,WAAcJ,YAAiBlc,GAAEsc,YACpE/b,KAAKiZ,iBACLjZ,KAAKgc,oBACLL,EAAM9T,IAAI,OAAQ7H,KAAKic,iBAAkBjc,OAGnCA,MAxByBA,MA2BjCqc,SAAU,SAAUV,GACnB,MAAKA,GAEGlc,EAAE4B,MAAMsa,IAAU3b,MAAK+Y,SAFV,GAKtBuD,UAAW,SAAU7a,EAAQC,GAC5B,IAAK,GAAItB,KAAKJ,MAAK+Y,QAClBtX,EAAOb,KAAKc,EAAS1B,KAAK+Y,QAAQ3Y,GAEnC,OAAOJ,OAGRuc,eAAgB,SAAUxZ,GACzB,IAAK/C,KAAKwZ,QAAW,MAAOxZ,KAE5B+C,GAAUtD,EAAES,QACXsc,SAAS,EACTrB,KAAK,GACHpY,KAAY,GAAQyZ,SAAS,GAAQzZ,EAExC,IAAI0Z,GAAUzc,KAAK8M,SACnB9M,MAAK0c,cAAe,EACpB1c,KAAK2c,eAAiB,IAEtB,IAAIC,GAAU5c,KAAK8M,UAClB+P,EAAYJ,EAAQ/Q,SAAS,GAAGlJ,QAChC2X,EAAYyC,EAAQlR,SAAS,GAAGlJ,QAChC6Y,EAASwB,EAAUrR,SAAS2O,EAE7B,OAAKkB,GAAOnQ,GAAMmQ,EAAOlQ,GAErBpI,EAAQyZ,SAAWzZ,EAAQoY,IAC9Bnb,KAAKob,MAAMC,IAGPtY,EAAQoY,KACXnb,KAAKsb,UAAUD,GAGhBrb,KAAK+H,KAAK,QAENhF,EAAQ+Z,iBACXhY,aAAa9E,KAAK+c,YAClB/c,KAAK+c,WAAa9a,WAAWxC,EAAEuB,KAAKhB,KAAK+H,KAAM/H,KAAM,WAAY,MAEjEA,KAAK+H,KAAK,YAIL/H,KAAK+H,KAAK,UAChB0U,QAASA,EACTG,QAASA,KAtB2B5c,MA2BtCgd,WAAY,SAAU9Y,EAAM+Y,GAC3B,IAAKA,EAAgB,MAAOjd,KAE5B,IAAI2H,GAAU3H,KAAKkE,GAAQ,GAAI+Y,GAAajd,KAQ5C,OANAA,MAAK8Y,UAAU1V,KAAKuE,GAEhB3H,KAAK+C,QAAQmB,IAChByD,EAAQuV,SAGFld,MAGR8Q,OAAQ,WACH9Q,KAAKwZ,SACRxZ,KAAK+H,KAAK,UAGX/H,KAAKwY,YAAY,MAEjB,WAEQxY,MAAKmd,WAAWC,SACtB,MAAO9L,GACRtR,KAAKmd,WAAWC,SAAW7d,EAU5B,MAPAS,MAAKqd,cACDrd,KAAKsd,kBACRtd,KAAKsd,mBAGNtd,KAAKud,iBAEEvd,MAMR2M,UAAW,WAGV,MAFA3M,MAAKwd,iBAEDxd,KAAK2c,iBAAmB3c,KAAKyd,SACzBzd,KAAK2c,eAEN3c,KAAK0d,mBAAmB1d,KAAK2d,yBAGrCvE,QAAS,WACR,MAAOpZ,MAAKyZ,OAGba,UAAW,WACV,GAAIvN,GAAS/M,KAAK4d,iBACjBvI,EAAKrV,KAAK6W,UAAU9J,EAAOH,iBAC3B0I,EAAKtV,KAAK6W,UAAU9J,EAAOF,cAE5B,OAAO,IAAIpN,GAAEmV,aAAaS,EAAIC,IAG/BuI,WAAY,WACX,MAAO7d,MAAK+C,QAAQ6Y,UAAYrc,EAC9BS,KAAK8d,iBAAmBve,EAAY,EAAIS,KAAK8d,eAC9C9d,KAAK+C,QAAQ6Y,SAGfmC,WAAY,WACX,MAAO/d,MAAK+C,QAAQiY,UAAYzb,EAC9BS,KAAKge,iBAAmBze,EAAY0e,EAAAA,EAAWje,KAAKge,eACrDhe,KAAK+C,QAAQiY,SAGfJ,cAAe,SAAU7N,EAAQmR,EAAQzD,GACxC1N,EAAStN,EAAEuV,aAAajI,EAExB,IAQCoR,GARGhH,EAAOnX,KAAK6d,cAAgBK,EAAS,EAAI,GAC5ClD,EAAUhb,KAAK+d,aACfK,EAAOpe,KAAK8M,UAEZuR,EAAKtR,EAAO4I,eACZ2I,EAAKvR,EAAO+I,eAEZyI,GAAe,CAGhB9D,GAAUhb,EAAE6L,MAAMmP,IAAY,EAAG,GAEjC,GACCtD,KACAgH,EAAane,KAAKyW,QAAQ6H,EAAInH,GAAM3L,SAASxL,KAAKyW,QAAQ4H,EAAIlH,IAAO9L,IAAIoP,GACzE8D,EAAgBL,EAAqCC,EAAWjT,EAAIkT,EAAKlT,GAAKiT,EAAWhT,EAAIiT,EAAKjT,EAAzEiT,EAAKhS,SAAS+R,SAE/BI,GAAwBvD,GAAR7D,EAEzB,OAAIoH,IAAgBL,EACZ,KAGDA,EAAS/G,EAAOA,EAAO,GAG/BrK,QAAS,WAQR,MAPK9M,MAAKwe,QAASxe,KAAK0c,eACvB1c,KAAKwe,MAAQ,GAAI/e,GAAEwL,MAClBjL,KAAKmd,WAAWsB,YAChBze,KAAKmd,WAAWuB,cAEjB1e,KAAK0c,cAAe,GAEd1c,KAAKwe,MAAMpT,SAGnBwS,eAAgB,WACf,GAAIe,GAAe3e,KAAK4e,kBACxB,OAAO,IAAInf,GAAE6M,OAAOqS,EAAcA,EAAatT,IAAIrL,KAAK8M,aAGzD+R,eAAgB,WAEf,MADA7e,MAAKwd,iBACExd,KAAK8e,sBAGbC,SAAU,WACT,MAAO/e,MAAKgf,QAGbC,aAAc,WACb,MAAOjf,MAAKmd,YAMbrD,aAAc,SAAUoF,GACvB,GAAIjH,GAAMjY,KAAK+C,QAAQkV,GACvB,OAAOA,GAAInK,MAAMoR,GAAUjH,EAAInK,MAAM9N,KAAKyZ,QAG3C0F,aAAc,SAAUrR,GACvB,MAAO9N,MAAKyZ,MAASlX,KAAKoU,IAAI7I,GAASvL,KAAK6c,KAM7C3I,QAAS,SAAUC,EAAQS,GAE1B,MADAA,GAAOA,IAAS5X,EAAYS,KAAKyZ,MAAQtC,EAClCnX,KAAK+C,QAAQkV,IAAIf,cAAczX,EAAEkU,OAAO+C,GAASS,IAGzDN,UAAW,SAAUvL,EAAO6L,GAE3B,MADAA,GAAOA,IAAS5X,EAAYS,KAAKyZ,MAAQtC,EAClCnX,KAAK+C,QAAQkV,IAAIV,cAAc9X,EAAE6L,MAAMA,GAAQ6L,IAGvDuG,mBAAoB,SAAUpS,GAC7B,GAAI8L,GAAiB3X,EAAE6L,MAAMA,GAAOD,IAAIrL,KAAK6e,iBAC7C,OAAO7e,MAAK6W,UAAUO,IAGvBiI,mBAAoB,SAAU3I,GAC7B,GAAIU,GAAiBpX,KAAKyW,QAAQhX,EAAEkU,OAAO+C,IAAS5K,QACpD,OAAOsL,GAAe3L,UAAUzL,KAAK6e,mBAGtCS,2BAA4B,SAAUhU,GACrC,MAAO7L,GAAE6L,MAAMA,GAAOE,SAASxL,KAAKuf,mBAGrCC,2BAA4B,SAAUlU,GACrC,MAAO7L,GAAE6L,MAAMA,GAAOD,IAAIrL,KAAKuf,mBAGhCnF,uBAAwB,SAAU9O,GACjC,GAAImU,GAAazf,KAAKsf,2BAA2B7f,EAAE6L,MAAMA,GACzD,OAAOtL,MAAK0d,mBAAmB+B,IAGhCxF,uBAAwB,SAAUvD,GACjC,MAAO1W,MAAKwf,2BAA2Bxf,KAAKqf,mBAAmB5f,EAAEkU,OAAO+C,MAGzEgJ,2BAA4B,SAAUpO,GACrC,MAAO7R,GAAEiT,SAASiN,iBAAiBrO,EAAGtR,KAAKmd,aAG5CyC,uBAAwB,SAAUtO,GACjC,MAAOtR,MAAKsf,2BAA2Btf,KAAK0f,2BAA2BpO,KAGxEuO,mBAAoB,SAAUvO,GAC7B,MAAOtR,MAAK0d,mBAAmB1d,KAAK4f,uBAAuBtO,KAM5D+G,eAAgB,SAAUxT,GACzB,GAAIsL,GAAYnQ,KAAKmd,WAAa1d,EAAEwO,QAAQC,IAAIrJ,EAEhD,KAAKsL,EACJ,KAAM,IAAIvM,OAAM,2BACV,IAAIuM,EAAUiN,SACpB,KAAM,IAAIxZ,OAAM,wCAGjBuM,GAAUiN,UAAW,GAGtB9E,YAAa,WACZ,GAAInI,GAAYnQ,KAAKmd,UAErB1d,GAAEwO,QAAQyC,SAASP,EAAW,qBAC5B1Q,EAAEmL,QAAQR,MAAQ,iBAAmB,KACrC3K,EAAEmL,QAAQtB,OAAS,kBAAoB,KACvC7J,EAAEmL,QAAQ3C,MAAQ,iBAAmB,KACrCjI,KAAK+C,QAAQmV,cAAgB,qBAAuB,IAEtD,IAAI4H,GAAWrgB,EAAEwO,QAAQG,SAAS+B,EAAW,WAE5B,cAAb2P,GAAwC,aAAbA,GAAwC,UAAbA,IACzD3P,EAAUtG,MAAMiW,SAAW,YAG5B9f,KAAK+f,aAED/f,KAAKggB,iBACRhgB,KAAKggB,mBAIPD,WAAY,WACX,GAAIE,GAAQjgB,KAAKgf,SAEjBhf,MAAKkgB,SAAWD,EAAME,QAAUngB,KAAKogB,YAAY,mBAAoBpgB,KAAKmd,YAE1End,KAAKqgB,UAAYJ,EAAMK,SAAWtgB,KAAKogB,YAAY,oBAAqBpgB,KAAKkgB,UAC7ED,EAAMM,YAAcvgB,KAAKogB,YAAY,uBAAwBpgB,KAAKkgB,UAClED,EAAMO,WAAaxgB,KAAKogB,YAAY,uBACpCH,EAAMQ,YAAczgB,KAAKogB,YAAY,wBACrCH,EAAMS,WAAa1gB,KAAKogB,YAAY,uBACpCH,EAAMU,UAAY3gB,KAAKogB,YAAY,qBAEnC,IAAIQ,GAAW,oBAEV5gB,MAAK+C,QAAQqV,sBACjB3Y,EAAEwO,QAAQyC,SAASuP,EAAMS,WAAYE,GACrCnhB,EAAEwO,QAAQyC,SAASuP,EAAMO,WAAYI,GACrCnhB,EAAEwO,QAAQyC,SAASuP,EAAMU,UAAWC,KAItCR,YAAa,SAAUlQ,EAAWC,GACjC,MAAO1Q,GAAEwO,QAAQ+B,OAAO,MAAOE,EAAWC,GAAanQ,KAAKgf,OAAOuB,cAGpElD,YAAa,WACZrd,KAAKmd,WAAW0D,YAAY7gB,KAAKkgB,WAGlChH,WAAY,SAAUC,GACrBA,EAASA,EAAU1Z,EAAEQ,KAAK4D,QAAQsV,GAAUA,GAAUA,KAEtD,KAAK,GAAI/Y,GAAI,EAAGE,EAAM6Y,EAAOrY,OAAYR,EAAJF,EAASA,IAC7CJ,KAAK0b,SAASvC,EAAO/Y,KAOvBiZ,WAAY,SAAUV,EAAQxB,EAAM2J,EAAmBC,GAEtD,GAAIC,GAAehhB,KAAKyZ,QAAUtC,CAE7B4J,KACJ/gB,KAAK+H,KAAK,aAENiZ,GACHhhB,KAAK+H,KAAK,cAIZ/H,KAAKyZ,MAAQtC,EACbnX,KAAK2c,eAAiBhE,EAEtB3Y,KAAK8e,qBAAuB9e,KAAKihB,oBAAoBtI,GAEhDmI,EAGJ9gB,KAAK8e,qBAAqBvT,KAAKvL,KAAKuf,kBAFpC9f,EAAEwO,QAAQiE,YAAYlS,KAAKkgB,SAAU,GAAIzgB,GAAEwL,MAAM,EAAG,IAKrDjL,KAAKgc,kBAAoBhc,KAAKiZ,cAE9B,IAAIiI,IAAWlhB,KAAKwZ,OACpBxZ,MAAKwZ,SAAU,EAEX0H,IACHlhB,KAAK+H,KAAK,QACV/H,KAAKsc,UAAUtc,KAAKkc,UAAWlc,OAGhCA,KAAK+H,KAAK,aAAcoZ,MAAOL,IAE/B9gB,KAAK+H,KAAK,SAENiZ,GAAeD,IAClB/gB,KAAK+H,KAAK,WAGX/H,KAAK+H,KAAK,WAAYoZ,MAAOL,KAG9BxF,UAAW,SAAUD,GACpB5b,EAAEwO,QAAQiE,YAAYlS,KAAKkgB,SAAUlgB,KAAKuf,iBAAiB/T,SAAS6P,KAGrE+F,aAAc,WACb,MAAOphB,MAAK+d,aAAe/d,KAAK6d,cAGjChC,kBAAmB,WAClB,GAAIzb,GACHwb,EAAUqC,EAAAA,EACVjD,IAAWiD,EAAAA,GACXoD,EAAcrhB,KAAKohB,cAEpB,KAAKhhB,IAAKJ,MAAKgZ,iBAAkB,CAChC,GAAI2C,GAAQ3b,KAAKgZ,iBAAiB5Y,EAC7BkT,OAAMqI,EAAM5Y,QAAQ6Y,WACxBA,EAAUrZ,KAAKmK,IAAIkP,EAASD,EAAM5Y,QAAQ6Y,UAEtCtI,MAAMqI,EAAM5Y,QAAQiY,WACxBA,EAAUzY,KAAKgC,IAAIyW,EAASW,EAAM5Y,QAAQiY,UAIxC5a,IAAMb,EACTS,KAAKge,eAAiBhe,KAAK8d,eAAiBve,GAE5CS,KAAKge,eAAiBhD,EACtBhb,KAAK8d,eAAiBlC,GAGnByF,IAAgBrhB,KAAKohB,gBACxBphB,KAAK+H,KAAK,qBAIZwT,oBAAqB,WACpBvb,KAAKwb,gBAAgBxb,KAAK+C,QAAQ0V,YAGnC+E,eAAgB,WACf,IAAKxd,KAAKwZ,QACT,KAAM,IAAI5V,OAAM,mCAMlB4U,YAAa,SAAU8I,GACtB,GAAK7hB,EAAEiT,SAAP,CAEA4O,EAAQA,GAAS,KAEjB7hB,EAAEiT,SAAS4O,GAAOthB,KAAKmd,WAAY,QAASnd,KAAKuhB,cAAevhB,KAEhE,IAECI,GAAGE,EAFAyG,GAAU,WAAY,YAAa,UAAW,aAChD,aAAc,YAAa,cAG7B,KAAK3G,EAAI,EAAGE,EAAMyG,EAAOjG,OAAYR,EAAJF,EAASA,IACzCX,EAAEiT,SAAS4O,GAAOthB,KAAKmd,WAAYpW,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,KAGjEA,MAAK+C,QAAQoV,aAChB1Y,EAAEiT,SAAS4O,GAAOjiB,EAAQ,SAAUW,KAAKuY,UAAWvY,QAItDuY,UAAW,WACV9Y,EAAEQ,KAAKiF,gBAAgBlF,KAAKyhB,gBAC5BzhB,KAAKyhB,eAAiBhiB,EAAEQ,KAAK8E,iBAC5B,WAAc/E,KAAKuc,gBAAgBO,iBAAiB,KAAW9c,MAAM,EAAOA,KAAKmd,aAGnFoE,cAAe,SAAUjQ,IACnBtR,KAAKwZ,UAAalI,EAAEoQ,aACtB1hB,KAAK2hB,UAAY3hB,KAAK2hB,SAASC,SAChC5hB,KAAK6hB,SAAY7hB,KAAK6hB,QAAQD,UAC/BniB,EAAEiT,SAASoP,SAASxQ,KAErBtR,KAAK+H,KAAK,YACV/H,KAAKwhB,gBAAgBlQ,KAGtBkQ,gBAAiB,SAAUlQ,GAC1B,GAAKtR,KAAKwZ,UAAW/Z,EAAEiT,SAASoP,SAASxQ,GAAzC,CAEA,GAAI3K,GAAO2K,EAAE3K,IAIb,IAFAA,EAAiB,eAATA,EAAwB,YAAwB,eAATA,EAAwB,WAAaA,EAE/E3G,KAAKkH,kBAAkBP,GAA5B,CAEa,gBAATA,GACHlH,EAAEiT,SAASC,eAAerB,EAG3B,IAAI0I,GAAiBha,KAAK0f,2BAA2BpO,GACpDmO,EAAazf,KAAKsf,2BAA2BtF,GAC7CtD,EAAS1W,KAAK0d,mBAAmB+B,EAElCzf,MAAK+H,KAAKpB,GACT+P,OAAQA,EACR+I,WAAYA,EACZzF,eAAgBA,EAChB+H,cAAezQ,OAIjB2K,iBAAkB,WACjBjc,KAAKgc,oBACDhc,KAAKiZ,iBAAmBjZ,KAAKgc,mBAChChc,KAAK+H,KAAK,mBAIZwV,eAAgB,WACf,IAAK,GAAInd,GAAI,EAAGE,EAAMN,KAAK8Y,UAAUhY,OAAYR,EAAJF,EAASA,IACrDJ,KAAK8Y,UAAU1Y,GAAG4hB,WAIpBC,UAAW,SAAUC,EAAUxgB,GAM9B,MALI1B,MAAKwZ,QACR0I,EAASthB,KAAKc,GAAW1B,KAAMA,MAE/BA,KAAK4H,GAAG,OAAQsa,EAAUxgB,GAEpB1B,MAGRkc,UAAW,SAAUP,GACpBA,EAAMwG,MAAMniB,MACZA,KAAK+H,KAAK,YAAa4T,MAAOA,KAM/B4D,eAAgB,WACf,MAAO9f,GAAEwO,QAAQqE,YAAYtS,KAAKkgB,WAGnCzC,OAAQ,WACP,GAAI9O,GAAM3O,KAAKuf,gBACf,OAAO5Q,KAAQA,EAAIxC,QAAQ,EAAG,KAG/ByS,iBAAkB,WACjB,MAAO5e,MAAK6e,iBAAiBrT,SAASxL,KAAKuf,mBAG5C0B,oBAAqB,SAAUtI,EAAQxB,GACtC,GAAI4C,GAAW/Z,KAAK8M,UAAUnB,UAAU,EAExC,OAAO3L,MAAKyW,QAAQkC,EAAQxB,GAAM1L,UAAUsO,GAAUjO,UAGvDsW,uBAAwB,SAAU1L,EAAQ2L,EAASlI,GAClD,GAAImI,GAAUtiB,KAAKihB,oBAAoB9G,EAAWkI,GAAShX,IAAIrL,KAAKuf,iBACpE,OAAOvf,MAAKyW,QAAQC,EAAQ2L,GAAS5W,UAAU6W,IAIhD3E,qBAAsB,WACrB,MAAO3d,MAAKsf,2BAA2Btf,KAAK8M,UAAUnB,UAAU,KAIjE4W,iBAAkB,SAAU7L,GAC3B,MAAO1W,MAAKqf,mBAAmB3I,GAAQlL,SAASxL,KAAK2d,yBAItDlC,aAAc,SAAU9C,EAAQxB,EAAMpK,GAErC,IAAKA,EAAU,MAAO4L,EAEtB,IAAI6J,GAAcxiB,KAAKyW,QAAQkC,EAAQxB,GACtC4C,EAAW/Z,KAAK8M,UAAUpB,SAAS,GACnC+W,EAAa,GAAIhjB,GAAE6M,OAAOkW,EAAYhX,SAASuO,GAAWyI,EAAYnX,IAAI0O,IAC1EsB,EAASrb,KAAK0iB,iBAAiBD,EAAY1V,EAAQoK,EAEpD,OAAOnX,MAAK6W,UAAU2L,EAAYnX,IAAIgQ,GAASlE,IAIhDwL,aAAc,SAAUtH,EAAQtO,GAC/B,IAAKA,EAAU,MAAOsO,EAEtB,IAAIoH,GAAaziB,KAAK4d,iBACrBgF,EAAY,GAAInjB,GAAE6M,OAAOmW,EAAW/V,IAAIrB,IAAIgQ,GAASoH,EAAWle,IAAI8G,IAAIgQ,GAEzE,OAAOA,GAAOhQ,IAAIrL,KAAK0iB,iBAAiBE,EAAW7V,KAIpD2V,iBAAkB,SAAUG,EAAUpK,EAAWtB,GAChD,GAAI2L,GAAW9iB,KAAKyW,QAAQgC,EAAU9C,eAAgBwB,GAAM3L,SAASqX,EAASnW,KAC7EqW,EAAW/iB,KAAKyW,QAAQgC,EAAU3C,eAAgBqB,GAAM3L,SAASqX,EAASte,KAE1Eye,EAAKhjB,KAAKijB,SAASH,EAAS5X,GAAI6X,EAAS7X,GACzCgY,EAAKljB,KAAKijB,SAASH,EAAS3X,GAAI4X,EAAS5X,EAE1C,OAAO,IAAI1L,GAAEwL,MAAM+X,EAAIE,IAGxBD,SAAU,SAAUpU,EAAMsU,GACzB,MAAOtU,GAAOsU,EAAQ,EACtB5gB,KAAKC,MAAMqM,EAAOsU,GAAS,EAC3B5gB,KAAKgC,IAAI,EAAGhC,KAAK6gB,KAAKvU,IAAStM,KAAKgC,IAAI,EAAGhC,KAAKwJ,MAAMoX,KAGvD7J,WAAY,SAAUnC,GACrB,GAAIzK,GAAM1M,KAAK6d,aACdtZ,EAAMvE,KAAK+d,YAEZ,OAAOxb,MAAKgC,IAAImI,EAAKnK,KAAKmK,IAAInI,EAAK4S,OAIrC1X,EAAE4jB,IAAM,SAAUxe,EAAI9B,GACrB,MAAO,IAAItD,GAAEuY,IAAInT,EAAI9B,IAStBtD,EAAE6W,WAAWgN,UACZ9M,aAAc,cAEd+M,QAAS,kBACTC,QAAS,QAET/M,QAAS,SAAUC,GAClB,GAAIlJ,GAAI/N,EAAEwT,OAAOM,WAChBhP,EAAMvE,KAAKwW,aACXtD,EAAM3Q,KAAKgC,IAAIhC,KAAKmK,IAAInI,EAAKmS,EAAOxD,MAAO3O,GAC3CkL,EAAIzP,KAAKwjB,QACTC,EAAKzjB,KAAKujB,QACVrY,EAAIwL,EAAOvD,IAAM3F,EAAIiC,EACrBtE,EAAI+H,EAAM1F,EACVkW,EAAMD,EAAKhU,EACXkU,EAASphB,KAAK2J,KAAK,EAAMwX,EAAMA,GAC/BE,EAAMD,EAASphB,KAAK+R,IAAInJ,EAEzByY,GAAMrhB,KAAKD,KAAK,EAAIshB,IAAQ,EAAIA,GAAe,GAATD,EAEtC,IAAIE,GAAKthB,KAAKqU,IAAI,IAAkB,GAAVrU,KAAKiR,GAAYrI,IAAMyY,CAGjD,OAFAzY,IAAKsE,EAAIlN,KAAKoU,IAAIkN,GAEX,GAAIpkB,GAAEwL,MAAMC,EAAGC,IAGvB0L,UAAW,SAAUvL,GAepB,IAdA,GAYCsY,GAZGpW,EAAI/N,EAAEwT,OAAOQ,WAChBhE,EAAIzP,KAAKwjB,QACTC,EAAKzjB,KAAKujB,QACVpQ,EAAM7H,EAAMJ,EAAIsC,EAAIiC,EACpBiU,EAAMD,EAAKhU,EACXkU,EAASphB,KAAK2J,KAAK,EAAKwX,EAAMA,GAC9BG,EAAKthB,KAAKwU,KAAMzL,EAAMH,EAAIsE,GAC1BqU,EAAOvhB,KAAKiR,GAAK,EAAK,EAAIjR,KAAKuU,KAAK+M,GACpCE,EAAU,GACVC,EAAM,KACN5jB,EAAI2jB,EACJE,EAAO,GAGA1hB,KAAK8J,IAAI4X,GAAQD,KAAW5jB,EAAI,GACvCwjB,EAAMD,EAASphB,KAAK+R,IAAIwP;AACxBG,EAAQ1hB,KAAKiR,GAAK,EAAK,EAAIjR,KAAKuU,KAAK+M,EACnCthB,KAAKD,KAAK,EAAMshB,IAAQ,EAAMA,GAAM,GAAMD,IAAWG,EACvDA,GAAOG,CAGR,OAAO,IAAIxkB,GAAEwT,OAAO6Q,EAAMtW,EAAG2F,KAM/B1T,EAAEwX,IAAIiN,SAAWzkB,EAAES,UAAWT,EAAEwX,KAC/BW,KAAM,YAENP,WAAY5X,EAAE6W,WAAWgN,SAEzBhM,eAAiB,WAChB,GAAI6M,GAAI1kB,EAAE6W,WAAWgN,SACpB7T,EAAI0U,EAAEX,QACN1V,EAAQ,IAAOvL,KAAKiR,GAAK/D,EAE1B,OAAO,IAAIhQ,GAAE6N,eAAeQ,EAAO,IAAMA,EAAO,SASlDrO,EAAEsc,UAAYtc,EAAE0F,MAAMjF,QACrB2F,SAAUpG,EAAE6G,MAAMC,OAElBxD,SACC6Y,QAAS,EACTZ,QAAS,GACToJ,SAAU,IACVC,WAAY,MACZC,aAAc,GACdC,YAAa,GACbC,WAAY,EACZvT,QAAS,EAYTwT,qBAAsBhlB,EAAEmL,QAAQ/B,OAChC6b,eAAgBjlB,EAAEmL,QAAQ/B,QAG3BvD,WAAY,SAAUqf,EAAK5hB,GAC1BA,EAAUtD,EAAEqD,WAAW9C,KAAM+C,GAGzBA,EAAQ6hB,cAAgBnlB,EAAEmL,QAAQtB,QAAUvG,EAAQiY,QAAU,IAEjEjY,EAAQqhB,SAAW7hB,KAAKwJ,MAAMhJ,EAAQqhB,SAAW,GACjDrhB,EAAQyhB,aAEJzhB,EAAQ6Y,QAAU,GACrB7Y,EAAQ6Y,UAET5b,KAAK+C,QAAQiY,WAGVjY,EAAQgK,SACXhK,EAAQgK,OAAStN,EAAEuV,aAAajS,EAAQgK,SAGzC/M,KAAK6kB,KAAOF,CAEZ,IAAIN,GAAarkB,KAAK+C,QAAQshB,UAEJ,iBAAfA,KACVrkB,KAAK+C,QAAQshB,WAAaA,EAAWxhB,MAAM,MAI7Csf,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EACZrjB,KAAK+kB,UAAY1B,EAAI2B,cAGrBhlB,KAAKqY,iBAGLgL,EAAIzb,IACHqd,UAAajlB,KAAKklB,OAClBC,QAAWnlB,KAAKolB,SACdplB,MAECA,KAAK+kB,WACR1B,EAAIzb,IACHyd,SAAYrlB,KAAKslB,aACjBC,QAAWvlB,KAAKwlB,cACdxlB,MAGCA,KAAK+C,QAAQ2hB,iBACjB1kB,KAAKylB,eAAiBhmB,EAAEQ,KAAK2B,oBAAoB5B,KAAKolB,QAAS,IAAKplB,MACpEqjB,EAAIzb,GAAG,OAAQ5H,KAAKylB,eAAgBzlB,OAGrCA,KAAKklB,SACLllB,KAAKolB,WAGNM,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGRoc,SAAU,SAAUiH,GACnBrjB,KAAKmd,WAAWvN,WAAWiR,YAAY7gB,KAAKmd,YAE5CkG,EAAIxb,KACHod,UAAajlB,KAAKklB,OAClBC,QAAWnlB,KAAKolB,SACdplB,MAECA,KAAK+kB,WACR1B,EAAIxb,KACHwd,SAAYrlB,KAAKslB,aACjBC,QAAWvlB,KAAKwlB,cACdxlB,MAGCA,KAAK+C,QAAQ2hB,gBACjBrB,EAAIxb,IAAI,OAAQ7H,KAAKylB,eAAgBzlB,MAGtCA,KAAKmd,WAAa,KAClBnd,KAAK8kB,KAAO,MAGba,aAAc,WACb,GAAIC,GAAO5lB,KAAK8kB,KAAK9F,OAAOsB,QAO5B,OALItgB,MAAKmd,aACRyI,EAAKxV,YAAYpQ,KAAKmd,YACtBnd,KAAK6lB,eAAeD,EAAMrjB,KAAKgC,MAGzBvE,MAGR8lB,YAAa,WACZ,GAAIF,GAAO5lB,KAAK8kB,KAAK9F,OAAOsB,QAO5B,OALItgB,MAAKmd,aACRyI,EAAKG,aAAa/lB,KAAKmd,WAAYyI,EAAKI,YACxChmB,KAAK6lB,eAAeD,EAAMrjB,KAAKmK,MAGzB1M,MAGRimB,eAAgB,WACf,MAAOjmB,MAAK+C,QAAQwhB,aAGrBtF,aAAc,WACb,MAAOjf,MAAKmd,YAGbnM,WAAY,SAAUC,GAOrB,MANAjR,MAAK+C,QAAQkO,QAAUA,EAEnBjR,KAAK8kB,MACR9kB,KAAKkmB,iBAGClmB,MAGRmmB,UAAW,SAAUC,GAIpB,MAHApmB,MAAK+C,QAAQqjB,OAASA,EACtBpmB,KAAKqmB,gBAEErmB,MAGRsmB,OAAQ,SAAU3B,EAAK4B,GAOtB,MANAvmB,MAAK6kB,KAAOF,EAEP4B,GACJvmB,KAAKwmB,SAGCxmB,MAGRwmB,OAAQ,WAKP,MAJIxmB,MAAK8kB,OACR9kB,KAAKklB,QAAQ/D,MAAM,IACnBnhB,KAAKolB,WAECplB,MAGRqmB,cAAe,WACVrmB,KAAKmd,YAAcnd,KAAK+C,QAAQqjB,SAAW7mB,IAC9CS,KAAKmd,WAAWtT,MAAMuc,OAASpmB,KAAK+C,QAAQqjB,SAI9CP,eAAgB,SAAUD,EAAMa,GAE/B,GAECL,GAAQhmB,EAAGE,EAFR6Y,EAASyM,EAAKc,SACjBC,GAAcF,EAAQxI,EAAAA,IAAWA,EAAAA,GAGlC,KAAK7d,EAAI,EAAGE,EAAM6Y,EAAOrY,OAAYR,EAAJF,EAASA,IAErC+Y,EAAO/Y,KAAOJ,KAAKmd,aACtBiJ,EAASjX,SAASgK,EAAO/Y,GAAGyJ,MAAMuc,OAAQ,IAErC9S,MAAM8S,KACVO,EAAaF,EAAQE,EAAYP,IAKpCpmB,MAAK+C,QAAQqjB,OAASpmB,KAAKmd,WAAWtT,MAAMuc,QAC1CQ,SAASD,GAAcA,EAAa,GAAKF,EAAQ,EAAG,KAGvDP,eAAgB,WACf,GAAI9lB,GACHymB,EAAQ7mB,KAAK8mB,MAEd,IAAIrnB,EAAEmL,QAAQ3C,MACb,IAAK7H,IAAKymB,GACTpnB,EAAEwO,QAAQ+C,WAAW6V,EAAMzmB,GAAIJ,KAAK+C,QAAQkO,aAG7CxR,GAAEwO,QAAQ+C,WAAWhR,KAAKmd,WAAYnd,KAAK+C,QAAQkO,UAIrDoH,eAAgB,WACf,GAAIiI,GAAWtgB,KAAK8kB,KAAK9F,OAAOsB,QAEhC,KAAKtgB,KAAKmd,WAAY,CAKrB,GAJAnd,KAAKmd,WAAa1d,EAAEwO,QAAQ+B,OAAO,MAAO,iBAE1ChQ,KAAKqmB,gBAEDrmB,KAAK+kB,UAAW,CACnB,GAAI7U,GAAY,wBAEhBlQ,MAAK+mB,UAAYtnB,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAWlQ,KAAKmd,YACzDnd,KAAKgnB,eAAiBvnB,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAWlQ,KAAKmd,gBAG9Dnd,MAAKgnB,eAAiBhnB,KAAKmd,UAG5BmD,GAASlQ,YAAYpQ,KAAKmd,YAEtBnd,KAAK+C,QAAQkO,QAAU,GAC1BjR,KAAKkmB,mBAKRhB,OAAQ,SAAU5T,GACjB,IAAK,GAAI/P,KAAOvB,MAAK8mB,OACpB9mB,KAAK+H,KAAK,cAAekf,KAAMjnB,KAAK8mB,OAAOvlB,IAG5CvB,MAAK8mB,UACL9mB,KAAKknB,aAAe,EAEhBlnB,KAAK+C,QAAQokB,aAChBnnB,KAAKonB,iBAGNpnB,KAAKgnB,eAAeK,UAAY,GAE5BrnB,KAAK+kB,WAAazT,GAAKA,EAAE6P,MAC5BnhB,KAAKsnB,iBAGNtnB,KAAKqY,kBAGNkP,aAAc,WACb,GAAIlE,GAAMrjB,KAAK8kB,KACd3N,EAAOkM,EAAIjK,UAAYpZ,KAAK+C,QAAQyhB,WACpCgD,EAAQxnB,KAAK+C,QAAQ0kB,cACrBrD,EAAWpkB,KAAK+C,QAAQqhB,QAMzB,OAJIoD,IAASrQ,EAAOqQ,IACnBpD,EAAW7hB,KAAKC,MAAM6gB,EAAIvJ,aAAa3C,GAAQkM,EAAIvJ,aAAa0N,GAASpD,IAGnEA,GAGRgB,QAAS,WAER,GAAKplB,KAAK8kB,KAAV,CAEA,GAAIzB,GAAMrjB,KAAK8kB,KACd/X,EAASsW,EAAIzF,iBACbzG,EAAOkM,EAAIjK,UACXgL,EAAWpkB,KAAKunB,cAEjB,MAAIpQ,EAAOnX,KAAK+C,QAAQiY,SAAW7D,EAAOnX,KAAK+C,QAAQ6Y,SAAvD,CAIA,GAAI8L,GAAajoB,EAAEsN,OAClBA,EAAOL,IAAIhB,SAAS0Y,GAAUpY,SAC9Be,EAAOxI,IAAImH,SAAS0Y,GAAUpY,SAE/BhM,MAAK2nB,uBAAuBD,IAExB1nB,KAAK+C,QAAQ0hB,sBAAwBzkB,KAAK+C,QAAQokB,aACrDnnB,KAAK4nB,kBAAkBF,MAIzBC,uBAAwB,SAAU5a,GACjC,GAGI1M,GAAGD,EAAGkL,EAHNuc,KACHlP,EAAS5L,EAAOJ,WAIjB,KAAKtM,EAAI0M,EAAOL,IAAIvB,EAAG9K,GAAK0M,EAAOxI,IAAI4G,EAAG9K,IACzC,IAAKD,EAAI2M,EAAOL,IAAIxB,EAAG9K,GAAK2M,EAAOxI,IAAI2G,EAAG9K,IACzCkL,EAAQ,GAAI7L,GAAEwL,MAAM7K,EAAGC,GAEnBL,KAAK8nB,oBAAoBxc,IAC5Buc,EAAMzkB,KAAKkI,EAKd,IAAIyc,GAAcF,EAAM/mB,MAExB,IAAoB,IAAhBinB,EAAJ,CAGAF,EAAMG,KAAK,SAAUzb,EAAGC,GACvB,MAAOD,GAAEN,WAAW0M,GAAUnM,EAAEP,WAAW0M,IAG5C,IAAIsP,GAAW3oB,EAAS4oB,wBASxB,KANKloB,KAAKknB,cACTlnB,KAAK+H,KAAK,WAGX/H,KAAKknB,cAAgBa,EAEhB3nB,EAAI,EAAO2nB,EAAJ3nB,EAAiBA,IAC5BJ,KAAKmoB,SAASN,EAAMznB,GAAI6nB,EAGzBjoB,MAAKgnB,eAAe5W,YAAY6X,KAGjCH,oBAAqB,SAAUM,GAC9B,GAAKA,EAAUld,EAAI,IAAMkd,EAAUjd,IAAMnL,MAAK8mB,OAC7C,OAAO,CAGR,IAAI/jB,GAAU/C,KAAK+C,OAEnB,KAAKA,EAAQslB,gBAAiB,CAC7B,GAAIC,GAAQtoB,KAAKuoB,iBAGjB,IAAKxlB,EAAQylB,SAAWJ,EAAUld,EAAI,GAAKkd,EAAUld,GAAKod,EAAMpd,IAC/Dkd,EAAUjd,EAAI,GAAKid,EAAUjd,GAAKmd,EAAMnd,EAAK,OAAO,EAGtD,GAAIpI,EAAQgK,OAAQ,CACnB,GAAIqX,GAAWrhB,EAAQqhB,SACtBqE,EAAUL,EAAUxc,WAAWwY,GAC/BsE,EAAUD,EAAQpd,KAAK+Y,EAAUA,IACjC/F,EAAKre,KAAK8kB,KAAKjO,UAAU4R,GACzBnK,EAAKte,KAAK8kB,KAAKjO,UAAU6R,EAS1B,IALK3lB,EAAQslB,iBAAoBtlB,EAAQylB,SACxCnK,EAAKA,EAAG3J,OACR4J,EAAKA,EAAG5J,SAGJ3R,EAAQgK,OAAOC,YAAYqR,EAAIC,IAAQ,OAAO,EAGpD,OAAO,GAGRsJ,kBAAmB,SAAU7a,GAC5B,GAAI4b,GAAMzd,EAAGC,EAAG5J,CAEhB,KAAKA,IAAOvB,MAAK8mB,OAChB6B,EAAOpnB,EAAIsB,MAAM,KACjBqI,EAAIiE,SAASwZ,EAAK,GAAI,IACtBxd,EAAIgE,SAASwZ,EAAK,GAAI,KAGlBzd,EAAI6B,EAAOL,IAAIxB,GAAKA,EAAI6B,EAAOxI,IAAI2G,GAAKC,EAAI4B,EAAOL,IAAIvB,GAAKA,EAAI4B,EAAOxI,IAAI4G,IAC9EnL,KAAK4oB,YAAYrnB,IAKpBqnB,YAAa,SAAUrnB,GACtB,GAAI0lB,GAAOjnB,KAAK8mB,OAAOvlB,EAEvBvB,MAAK+H,KAAK,cAAekf,KAAMA,EAAMtC,IAAKsC,EAAK1mB,MAE3CP,KAAK+C,QAAQokB,YAChB1nB,EAAEwO,QAAQ4C,YAAYoW,EAAM,uBAC5BjnB,KAAKonB,aAAahkB,KAAK6jB,IAEbA,EAAKrX,aAAe5P,KAAKgnB,gBACnChnB,KAAKgnB,eAAenG,YAAYoG,GAI5BxnB,EAAEmL,QAAQnC,UACdwe,EAAK4B,OAAS,KACd5B,EAAK1mB,IAAMd,EAAEQ,KAAK+D,qBAGZhE,MAAK8mB,OAAOvlB,IAGpB4mB,SAAU,SAAUC,EAAWjY,GAC9B,GAAI2Y,GAAU9oB,KAAK+oB,YAAYX,GAG3BnB,EAAOjnB,KAAKgpB,UAOhBvpB,GAAEwO,QAAQiE,YAAY+U,EAAM6B,EAASrpB,EAAEmL,QAAQrC,QAE/CvI,KAAK8mB,OAAOsB,EAAUld,EAAI,IAAMkd,EAAUjd,GAAK8b,EAE/CjnB,KAAKipB,UAAUhC,EAAMmB,GAEjBnB,EAAKrX,aAAe5P,KAAKgnB,gBAC5B7W,EAAUC,YAAY6W,IAIxBiC,eAAgB,WAEf,GAAInmB,GAAU/C,KAAK+C,QAClBoU,EAAOnX,KAAK8kB,KAAK1L,SAQlB,OANIrW,GAAQomB,cACXhS,EAAOpU,EAAQiY,QAAU7D,GAG1BA,GAAQpU,EAAQyhB,WAETzhB,EAAQ0kB,cAAgBllB,KAAKmK,IAAIyK,EAAMpU,EAAQ0kB,eAAiBtQ,GAGxE4R,YAAa,SAAUX,GACtB,GAAIrW,GAAS/R,KAAK8kB,KAAKjG,iBACtBuF,EAAWpkB,KAAKunB,cAEjB,OAAOa,GAAUxc,WAAWwY,GAAU5Y,SAASuG,IAKhDqX,WAAY,SAAUhB,GACrB,MAAO3oB,GAAEQ,KAAKwD,SAASzD,KAAK6kB,KAAMplB,EAAES,QACnCuX,EAAGzX,KAAKqpB,cAAcjB,GACtBkB,EAAGlB,EAAUkB,EACbpe,EAAGkd,EAAUld,EACbC,EAAGid,EAAUjd,GACXnL,KAAK+C,WAGTwlB,gBAAiB,WAChB,GAAItQ,GAAMjY,KAAK8kB,KAAK/hB,QAAQkV,IAC3BmG,EAAOnG,EAAInL,QAAQ9M,KAAK8kB,KAAK1L,UAC9B,OAAOgF,GAAK1S,SAAS1L,KAAKunB,gBAAgBvb,UAG3Cud,iBAAkB,SAAUnB,GAE3B,GAAIE,GAAQtoB,KAAKuoB,iBAGZvoB,MAAK+C,QAAQslB,iBAAoBroB,KAAK+C,QAAQylB,SAClDJ,EAAUld,GAAMkd,EAAUld,EAAIod,EAAMpd,EAAKod,EAAMpd,GAAKod,EAAMpd,GAGvDlL,KAAK+C,QAAQymB,MAChBpB,EAAUjd,EAAImd,EAAMnd,EAAIid,EAAUjd,EAAI,GAGvCid,EAAUkB,EAAItpB,KAAKkpB,kBAGpBG,cAAe,SAAUjB,GACxB,GAAIqB,GAAQlnB,KAAK8J,IAAI+b,EAAUld,EAAIkd,EAAUjd,GAAKnL,KAAK+C,QAAQshB,WAAWvjB,MAC1E,OAAOd,MAAK+C,QAAQshB,WAAWoF,IAGhCT,SAAU,WACT,GAAIhpB,KAAK+C,QAAQokB,YAAcnnB,KAAKonB,aAAatmB,OAAS,EAAG,CAC5D,GAAImmB,GAAOjnB,KAAKonB,aAAasC,KAE7B,OADA1pB,MAAK2pB,WAAW1C,GACTA,EAER,MAAOjnB,MAAK4pB,eAIbD,WAAY,aAEZC,YAAa,WACZ,GAAI3C,GAAOxnB,EAAEwO,QAAQ+B,OAAO,MAAO,eAcnC,OAbAiX,GAAKpd,MAAM0F,MAAQ0X,EAAKpd,MAAMggB,OAAS7pB,KAAKunB,eAAiB,KAC7DN,EAAK6C,WAAa,KAElB7C,EAAK8C,cAAgB9C,EAAK+C,YAAcvqB,EAAEQ,KAAKiC,QAE3CzC,EAAEmL,QAAQ3C,OAASjI,KAAK+C,QAAQkO,UAAY1R,GAC/CE,EAAEwO,QAAQ+C,WAAWiW,EAAMjnB,KAAK+C,QAAQkO,SAIrCxR,EAAEmL,QAAQG,iBACbkc,EAAKpd,MAAMogB,yBAA2B,UAEhChD,GAGRgC,UAAW,SAAUhC,EAAMmB,GAC1BnB,EAAKiD,OAAUlqB,KACfinB,EAAK4B,OAAU7oB,KAAKmqB,YACpBlD,EAAKmD,QAAUpqB,KAAKqqB,aAEpBrqB,KAAKupB,iBAAiBnB,GACtBnB,EAAK1mB,IAAUP,KAAKopB,WAAWhB,GAE/BpoB,KAAK+H,KAAK,iBACTkf,KAAMA,EACNtC,IAAKsC,EAAK1mB,OAIZ+pB,YAAa,WACZtqB,KAAKknB,eAEDlnB,KAAK+kB,WACRtlB,EAAEwO,QAAQyC,SAAS1Q,KAAKgnB,eAAgB,yBAGpChnB,KAAKknB,eACTlnB,KAAK+H,KAAK,QAEN/H,KAAK+kB,YAERjgB,aAAa9E,KAAKuqB,qBAClBvqB,KAAKuqB,oBAAsBtoB,WAAWxC,EAAEuB,KAAKhB,KAAKsnB,eAAgBtnB,MAAO,QAK5EmqB,YAAa,WACZ,GAAIxO,GAAQ3b,KAAKkqB,MAGblqB,MAAKO,MAAQd,EAAEQ,KAAK+D,gBACvBvE,EAAEwO,QAAQyC,SAAS1Q,KAAM,uBAEzB2b,EAAM5T,KAAK,YACVkf,KAAMjnB,KACN2kB,IAAK3kB,KAAKO,OAIZob,EAAM2O,eAGPD,aAAc,WACb,GAAI1O,GAAQ3b,KAAKkqB,MAEjBvO,GAAM5T,KAAK,aACVkf,KAAMjnB,KACN2kB,IAAK3kB,KAAKO,KAGX,IAAIiqB,GAAS7O,EAAM5Y,QAAQuhB,YACvBkG,KACHxqB,KAAKO,IAAMiqB,GAGZ7O,EAAM2O,iBAIR7qB,EAAEgrB,UAAY,SAAU9F,EAAK5hB,GAC5B,MAAO,IAAItD,GAAEsc,UAAU4I,EAAK5hB,IAQ7BtD,EAAEsc,UAAU2O,IAAMjrB,EAAEsc,UAAU7b,QAE7ByqB,kBACCC,QAAS,MACTC,QAAS,SACTnrB,QAAS,QACTyZ,OAAQ,GACR2R,OAAQ,GACRC,OAAQ,aACRC,aAAa,GAGd1lB,WAAY,SAAUqf,EAAK5hB,GAE1B/C,KAAK6kB,KAAOF,CAEZ,IAAIsG,GAAYxrB,EAAES,UAAWF,KAAK2qB,kBACjCvG,EAAWrhB,EAAQqhB,UAAYpkB,KAAK+C,QAAQqhB,QAEzCrhB,GAAQ6hB,cAAgBnlB,EAAEmL,QAAQtB,OACrC2hB,EAAU1b,MAAQ0b,EAAUpB,OAAoB,EAAXzF,EAErC6G,EAAU1b,MAAQ0b,EAAUpB,OAASzF,CAGtC,KAAK,GAAIhkB,KAAK2C,GAER/C,KAAK+C,QAAQhC,eAAeX,IAAY,QAANA,IACtC6qB,EAAU7qB,GAAK2C,EAAQ3C,GAIzBJ,MAAKirB,UAAYA,EAEjBxrB,EAAEqD,WAAW9C,KAAM+C,IAGpBof,MAAO,SAAUkB,GAEhBrjB,KAAKkrB,KAAOlrB,KAAK+C,QAAQkV,KAAOoL,EAAItgB,QAAQkV,IAE5CjY,KAAKmrB,YAAc9X,WAAWrT,KAAKirB,UAAUvrB,QAE7C,IAAI0rB,GAAgBprB,KAAKmrB,aAAe,IAAM,MAAQ,KACtDnrB,MAAKirB,UAAUG,GAAiBprB,KAAKkrB,KAAKtT,KAE1CnY,EAAEsc,UAAUrb,UAAUyhB,MAAMvhB,KAAKZ,KAAMqjB,IAGxC+F,WAAY,SAAUhB,GAErB,GAAI/E,GAAMrjB,KAAK8kB,KACdV,EAAWpkB,KAAK+C,QAAQqhB,SAExBqE,EAAUL,EAAUxc,WAAWwY,GAC/BsE,EAAUD,EAAQpd,KAAK+Y,EAAUA,IAEjC/F,EAAKre,KAAKkrB,KAAKzU,QAAQ4M,EAAIxM,UAAU4R,EAASL,EAAUkB,IACxDhL,EAAKte,KAAKkrB,KAAKzU,QAAQ4M,EAAIxM,UAAU6R,EAASN,EAAUkB,IACxD+B,EAAOrrB,KAAKmrB,aAAe,KAAOnrB,KAAKkrB,OAASzrB,EAAEwX,IAAIc,UACpDuG,EAAGnT,EAAGkT,EAAGnT,EAAGmT,EAAGlT,EAAGmT,EAAGpT,GAAG1H,KAAK,MAC7B6a,EAAGnT,EAAGoT,EAAGnT,EAAGmT,EAAGpT,EAAGmT,EAAGlT,GAAG3H,KAAK,KAE/BmhB,EAAMllB,EAAEQ,KAAKwD,SAASzD,KAAK6kB,MAAOpN,EAAGzX,KAAKqpB,cAAcjB,IAEzD,OAAOzD,GAAMllB,EAAEQ,KAAK+C,eAAehD,KAAKirB,UAAWtG,GAAK,GAAQ,SAAW0G,GAG5EC,UAAW,SAAUnoB,EAAQojB,GAQ5B,MANA9mB,GAAES,OAAOF,KAAKirB,UAAW9nB,GAEpBojB,GACJvmB,KAAKwmB,SAGCxmB,QAITP,EAAEgrB,UAAUc,IAAM,SAAU5G,EAAK5hB,GAChC,MAAO,IAAItD,GAAEsc,UAAU2O,IAAI/F,EAAK5hB,IASjCtD,EAAEsc,UAAUyP,OAAS/rB,EAAEsc,UAAU7b,QAChC6C,SACC0oB,OAAO,GAGRnmB,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,IAGpByjB,OAAQ,WACHxmB,KAAK8kB,OACR9kB,KAAKklB,QAAQ/D,MAAM,IACnBnhB,KAAKolB,UAGN,KAAK,GAAIhlB,KAAKJ,MAAK8mB,OAClB9mB,KAAK0rB,YAAY1rB,KAAK8mB,OAAO1mB,GAE9B,OAAOJ,OAGR0rB,YAAa,SAAUzE,GACtBjnB,KAAK2rB,SAAS1E,EAAMA,EAAK2E,WAAY5rB,KAAK8kB,KAAKrL,QAGhDmQ,YAAa,WACZ,GAAI3C,GAAOxnB,EAAEwO,QAAQ+B,OAAO,SAAU,eAGtC,OAFAiX,GAAK1X,MAAQ0X,EAAK4C,OAAS7pB,KAAK+C,QAAQqhB,SACxC6C,EAAK8C,cAAgB9C,EAAK+C,YAAcvqB,EAAEQ,KAAKiC,QACxC+kB,GAGRgC,UAAW,SAAUhC,EAAMmB,GAC1BnB,EAAKiD,OAASlqB,KACdinB,EAAK2E,WAAaxD,EAElBpoB,KAAK0rB,YAAYzE,GAEZjnB,KAAK+C,QAAQ0oB,OACjBzrB,KAAK6rB,UAAU5E,IAIjB0E,SAAU,aAIVE,UAAW,SAAU5E,GACpBjnB,KAAKmqB,YAAYvpB,KAAKqmB,MAKxBxnB,EAAEgrB,UAAUqB,OAAS,SAAU/oB,GAC9B,MAAO,IAAItD,GAAEsc,UAAUyP,OAAOzoB,IAQ/BtD,EAAEssB,aAAetsB,EAAE0F,MAAMjF,QACxB2F,SAAUpG,EAAE6G,MAAMC,OAElBxD,SACCkO,QAAS,GAGV3L,WAAY,SAAUqf,EAAK5X,EAAQhK,GAClC/C,KAAK6kB,KAAOF,EACZ3kB,KAAKgsB,QAAUvsB,EAAEuV,aAAajI,GAE9BtN,EAAEqD,WAAW9C,KAAM+C,IAGpBof,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EAEPrjB,KAAKisB,QACTjsB,KAAKksB,aAGN7I,EAAIrE,OAAOyB,YAAYrQ,YAAYpQ,KAAKisB,QAExC5I,EAAIzb,GAAG,YAAa5H,KAAKklB,OAAQllB,MAE7BqjB,EAAItgB,QAAQ+Y,eAAiBrc,EAAEmL,QAAQV,OAC1CmZ,EAAIzb,GAAG,WAAY5H,KAAKslB,aAActlB,MAGvCA,KAAKklB,UAGN9I,SAAU,SAAUiH,GACnBA,EAAItE,WAAW0B,YAAYI,YAAY7gB,KAAKisB,QAE5C5I,EAAIxb,IAAI,YAAa7H,KAAKklB,OAAQllB,MAE9BqjB,EAAItgB,QAAQ+Y,eACfuH,EAAIxb,IAAI,WAAY7H,KAAKslB,aAActlB,OAIzC0lB,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGRgR,WAAY,SAAUC,GAGrB,MAFAjR,MAAK+C,QAAQkO,QAAUA,EACvBjR,KAAKkmB,iBACElmB,MAIR2lB,aAAc,WAIb,MAHI3lB,MAAKisB,QACRjsB,KAAK8kB,KAAK9F,OAAOyB,YAAYrQ,YAAYpQ,KAAKisB,QAExCjsB,MAGR8lB,YAAa,WACZ,GAAIF,GAAO5lB,KAAK8kB,KAAK9F,OAAOyB,WAI5B,OAHIzgB,MAAKisB,QACRrG,EAAKG,aAAa/lB,KAAKisB,OAAQrG,EAAKI,YAE9BhmB,MAGRsmB,OAAQ,SAAU3B,GACjB3kB,KAAK6kB,KAAOF,EACZ3kB,KAAKisB,OAAO1rB,IAAMP,KAAK6kB,MAGxBoB,eAAgB,WACf,MAAOjmB,MAAK+C,QAAQwhB,aAGrB2H,WAAY,WACXlsB,KAAKisB,OAASxsB,EAAEwO,QAAQ+B,OAAO,MAAO,uBAElChQ,KAAK8kB,KAAK/hB,QAAQ+Y,eAAiBrc,EAAEmL,QAAQV,MAChDzK,EAAEwO,QAAQyC,SAAS1Q,KAAKisB,OAAQ,yBAEhCxsB,EAAEwO,QAAQyC,SAAS1Q,KAAKisB,OAAQ,qBAGjCjsB,KAAKkmB,iBAGLzmB,EAAES,OAAOF,KAAKisB,QACbnC,WAAY,KACZC,cAAetqB,EAAEQ,KAAKiC,QACtB8nB,YAAavqB,EAAEQ,KAAKiC,QACpB2mB,OAAQppB,EAAEuB,KAAKhB,KAAKmsB,aAAcnsB,MAClCO,IAAKP,KAAK6kB,QAIZS,aAAc,SAAUhU,GACvB,GAAI+R,GAAMrjB,KAAK8kB,KACdsH,EAAQpsB,KAAKisB,OACbne,EAAQuV,EAAIvJ,aAAaxI,EAAE6F,MAC3BkH,EAAKre,KAAKgsB,QAAQrW,eAClB2I,EAAKte,KAAKgsB,QAAQlW,eAElBwM,EAAUe,EAAIjB,uBAAuB/D,EAAI/M,EAAE6F,KAAM7F,EAAEqH,QACnDyF,EAAOiF,EAAIjB,uBAAuB9D,EAAIhN,EAAE6F,KAAM7F,EAAEqH,QAAQlN,UAAU6W,GAClEvQ,EAASuQ,EAAQ/W,KAAK6S,EAAKvS,YAAY,IAAW,EAAI,EAAIiC,IAE3Dse,GAAMviB,MAAMpK,EAAEwO,QAAQoE,WACrB5S,EAAEwO,QAAQyD,mBAAmBK,GAAU,UAAYjE,EAAQ,MAG7DoX,OAAQ,WACP,GAAIkH,GAAUpsB,KAAKisB,OAClB3J,EAAUtiB,KAAK8kB,KAAKzF,mBAAmBrf,KAAKgsB,QAAQrW,gBACpDyI,EAAOpe,KAAK8kB,KAAKzF,mBAAmBrf,KAAKgsB,QAAQlW,gBAAgBrK,UAAU6W,EAE5E7iB,GAAEwO,QAAQiE,YAAYka,EAAO9J,GAE7B8J,EAAMviB,MAAM0F,MAAS6O,EAAKlT,EAAI,KAC9BkhB,EAAMviB,MAAMggB,OAASzL,EAAKjT,EAAI,MAG/BghB,aAAc,WACbnsB,KAAK+H,KAAK,SAGXme,eAAgB,WACfzmB,EAAEwO,QAAQ+C,WAAWhR,KAAKisB,OAAQjsB,KAAK+C,QAAQkO,YAIjDxR,EAAE4sB,aAAe,SAAU1H,EAAK5X,EAAQhK,GACvC,MAAO,IAAItD,GAAEssB,aAAapH,EAAK5X,EAAQhK,IAQxCtD,EAAE6sB,KAAO7sB,EAAE0F,MAAMjF,QAChB6C,SAYCmN,UAAW,IAGZ5K,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,IAGpBwpB,WAAY,SAAUC,GACrB,MAAOxsB,MAAKysB,YAAY,OAAQD,IAGjCE,aAAc,SAAUF,GACvB,MAAOxsB,MAAKysB,YAAY,SAAUD,IAGnCC,YAAa,SAAUvoB,EAAMsoB,GAC5B,GAAIjsB,GAAMP,KAAK2sB,YAAYzoB,EAE3B,KAAK3D,EAAK,CACT,GAAa,SAAT2D,EACH,KAAM,IAAIN,OAAM,kDAEjB,OAAO,MAGR,GAAIgpB,EAQJ,OAJCA,GAHIJ,GAA+B,QAApBA,EAAQvc,QAGjBjQ,KAAK6sB,WAAWtsB,EAAKisB,GAFrBxsB,KAAK6sB,WAAWtsB,GAIvBP,KAAK8sB,eAAeF,EAAK1oB,GAElB0oB,GAGRE,eAAgB,SAAUF,EAAK1oB,GAC9B,GAEC6oB,GAFGhqB,EAAU/C,KAAK+C,QAClBqb,EAAO3e,EAAE6L,MAAMvI,EAAQmB,EAAO,QAI9B6oB,GADY,WAAT7oB,EACMzE,EAAE6L,MAAMvI,EAAQiqB,cAAgBjqB,EAAQkqB,YAExCxtB,EAAE6L,MAAMvI,EAAQkqB,aAGrBF,GAAU3O,IACd2O,EAAS3O,EAAK1S,SAAS,GAAG,IAG3BkhB,EAAI1c,UAAY,kBAAoBhM,EAAO,IAAMnB,EAAQmN,UAErD6c,IACHH,EAAI/iB,MAAMqjB,YAAeH,EAAO7hB,EAAK,KACrC0hB,EAAI/iB,MAAMsjB,WAAeJ,EAAO5hB,EAAK,MAGlCiT,IACHwO,EAAI/iB,MAAM0F,MAAS6O,EAAKlT,EAAI,KAC5B0hB,EAAI/iB,MAAMggB,OAASzL,EAAKjT,EAAI,OAI9B0hB,WAAY,SAAUtsB,EAAK8N,GAG1B,MAFAA,GAAKA,GAAM/O,EAASkL,cAAc,OAClC6D,EAAG9N,IAAMA,EACF8N,GAGRse,YAAa,SAAUzoB,GACtB,MAAIzE,GAAEmL,QAAQtB,QAAUtJ,KAAK+C,QAAQmB,EAAO,aACpClE,KAAK+C,QAAQmB,EAAO,aAErBlE,KAAK+C,QAAQmB,EAAO,UAI7BzE,EAAE2tB,KAAO,SAAUrqB,GAClB,MAAO,IAAItD,GAAE6sB,KAAKvpB,IAQnBtD,EAAE6sB,KAAKe,QAAU5tB,EAAE6sB,KAAKpsB,QAEvB6C,SACCuqB,UAAW,GAAI,IACfL,YAAa,GAAI,IACjBM,aAAc,EAAG,KAEjBC,YAAa,GAAI,KAGlBb,YAAa,SAAUzoB,GACtB,GAAI3C,GAAM2C,EAAO,KAEjB,IAAIlE,KAAK+C,QAAQxB,GAChB,MAAOvB,MAAK+C,QAAQxB,EAGjB9B,GAAEmL,QAAQtB,QAAmB,SAATpF,IACvBA,GAAQ,MAGT,IAAIupB,GAAOhuB,EAAE6sB,KAAKe,QAAQK,SAE1B,KAAKD,EACJ,KAAM,IAAI7pB,OAAM,iEAGjB,OAAO6pB,GAAO,WAAavpB,EAAO,UAIpCzE,EAAE6sB,KAAKe,QAAQK,UAAa,WAC3B,GAGIttB,GAAGE,EAAKC,EAAKkJ,EAASgkB,EAHtBE,EAAUruB,EAASsuB,qBAAqB,UAC3CC,EAAY,oCAIb,KAAKztB,EAAI,EAAGE,EAAMqtB,EAAQ7sB,OAAYR,EAAJF,EAASA,IAI1C,GAHAG,EAAMotB,EAAQvtB,GAAGG,IACjBkJ,EAAUlJ,EAAIutB,MAAMD,GAInB,MADAJ,GAAOltB,EAAIsC,MAAMgrB,GAAW,IACpBJ,EAAOA,EAAO,IAAM,IAAM,YAUrChuB,EAAEsuB,OAAStuB,EAAE0F,MAAMjF,QAElB2F,SAAUpG,EAAE6G,MAAMC,OAElBxD,SACCqqB,KAAM,GAAI3tB,GAAE6sB,KAAKe,QACjBW,MAAO,GACP5a,IAAK,GACL6a,WAAW,EACXC,WAAW,EACXC,UAAU,EACVC,aAAc,EACdnd,QAAS,EACTod,aAAa,EACbC,WAAY,KAGbhpB,WAAY,SAAUoR,EAAQ3T,GAC7BtD,EAAEqD,WAAW9C,KAAM+C,GACnB/C,KAAKuuB,QAAU9uB,EAAEkU,OAAO+C,IAGzByL,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EAEZA,EAAIzb,GAAG,YAAa5H,KAAKwuB,OAAQxuB,MAEjCA,KAAKyuB,YACLzuB,KAAKwuB,SACLxuB,KAAK+H,KAAK,OAENsb,EAAItgB,QAAQ+Y,eAAiBuH,EAAItgB,QAAQqV,qBAC5CiL,EAAIzb,GAAG,WAAY5H,KAAKslB,aAActlB,OAIxC0lB,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGRoc,SAAU,SAAUiH,GACfrjB,KAAK2hB,UACR3hB,KAAK2hB,SAASK,UAGfhiB,KAAK0uB,cACL1uB,KAAK2uB,gBAEL3uB,KAAK+H,KAAK,UAEVsb,EAAIxb,KACHod,UAAajlB,KAAKwuB,OAClBnJ,SAAYrlB,KAAKslB,cACftlB,MAEHA,KAAK8kB,KAAO,MAGb8J,UAAW,WACV,MAAO5uB,MAAKuuB,SAGbM,UAAW,SAAUnY,GAKpB,MAJA1W,MAAKuuB,QAAU9uB,EAAEkU,OAAO+C,GAExB1W,KAAKwuB,SAEExuB,KAAK+H,KAAK,QAAU2O,OAAQ1W,KAAKuuB,WAGzCO,gBAAiB,SAAUzT,GAI1B,MAHArb,MAAK+C,QAAQqrB,aAAe/S,EAC5Brb,KAAKwuB,SAEExuB,MAGR+uB,QAAS,SAAU3B,GAalB,MAXAptB,MAAK+C,QAAQqqB,KAAOA,EAEhBptB,KAAK8kB,OACR9kB,KAAKyuB,YACLzuB,KAAKwuB,UAGFxuB,KAAKgvB,QACRhvB,KAAKivB,UAAUjvB,KAAKgvB,QAGdhvB,MAGRwuB,OAAQ,WACP,GAAIxuB,KAAKkvB,MAAO,CACf,GAAIvgB,GAAM3O,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,SAAS/rB,OACrDxC,MAAKmvB,QAAQxgB,GAGd,MAAO3O,OAGRyuB,UAAW,WACV,GAAI1rB,GAAU/C,KAAK+C,QAClBsgB,EAAMrjB,KAAK8kB,KACXsK,EAAa/L,EAAItgB,QAAQ+Y,eAAiBuH,EAAItgB,QAAQqV,oBACtDiX,EAAaD,EAAY,wBAA0B,oBAEhDhC,EAAOrqB,EAAQqqB,KAAKb,WAAWvsB,KAAKkvB,OACvCI,GAAU,CAGPlC,KAASptB,KAAKkvB,QACblvB,KAAKkvB,OACRlvB,KAAK0uB,cAENY,GAAU,EAENvsB,EAAQirB,QACXZ,EAAKY,MAAQjrB,EAAQirB,OAGlBjrB,EAAQqQ,MACXga,EAAKha,IAAMrQ,EAAQqQ,MAIrB3T,EAAEwO,QAAQyC,SAAS0c,EAAMiC,GAErBtsB,EAAQorB,WACXf,EAAKmC,SAAW,KAGjBvvB,KAAKkvB,MAAQ9B,EAEbptB,KAAKwvB,mBAEDzsB,EAAQsrB,aACX5uB,EAAEiT,SACA9K,GAAGwlB,EAAM,YAAaptB,KAAKyvB,cAAezvB,MAC1C4H,GAAGwlB,EAAM,WAAYptB,KAAK0vB,aAAc1vB,KAG3C,IAAI2vB,GAAY5sB,EAAQqqB,KAAKV,aAAa1sB,KAAK4vB,SAC9CC,GAAY,CAETF,KAAc3vB,KAAK4vB,UACtB5vB,KAAK2uB,gBACLkB,GAAY,GAGTF,GACHlwB,EAAEwO,QAAQyC,SAASif,EAAWN,GAE/BrvB,KAAK4vB,QAAUD,EAGX5sB,EAAQkO,QAAU,GACrBjR,KAAKkmB,gBAIN,IAAIjG,GAAQjgB,KAAK8kB,KAAK9F,MAElBsQ,IACHrP,EAAMS,WAAWtQ,YAAYpQ,KAAKkvB,OAG/BS,GAAaE,GAChB5P,EAAMO,WAAWpQ,YAAYpQ,KAAK4vB,UAIpClB,YAAa,WACR1uB,KAAK+C,QAAQsrB,aAChB5uB,EAAEiT,SACA7K,IAAI7H,KAAKkvB,MAAO,YAAalvB,KAAKyvB,eAClC5nB,IAAI7H,KAAKkvB,MAAO,WAAYlvB,KAAK0vB,cAGpC1vB,KAAK8kB,KAAK9F,OAAO0B,WAAWG,YAAY7gB,KAAKkvB,OAE7ClvB,KAAKkvB,MAAQ,MAGdP,cAAe,WACV3uB,KAAK4vB,SACR5vB,KAAK8kB,KAAK9F,OAAOwB,WAAWK,YAAY7gB,KAAK4vB,SAE9C5vB,KAAK4vB,QAAU,MAGhBT,QAAS,SAAUxgB,GAClBlP,EAAEwO,QAAQiE,YAAYlS,KAAKkvB,MAAOvgB,GAE9B3O,KAAK4vB,SACRnwB,EAAEwO,QAAQiE,YAAYlS,KAAK4vB,QAASjhB,GAGrC3O,KAAK8vB,QAAUnhB,EAAIxD,EAAInL,KAAK+C,QAAQqrB,aAEpCpuB,KAAK0vB,gBAGNrJ,cAAe,SAAUhL,GACxBrb,KAAKkvB,MAAMrlB,MAAMuc,OAASpmB,KAAK8vB,QAAUzU,GAG1CiK,aAAc,SAAUyK,GACvB,GAAIphB,GAAM3O,KAAK8kB,KAAK1C,uBAAuBpiB,KAAKuuB,QAASwB,EAAI5Y,KAAM4Y,EAAIpX,QAAQnW,OAE/ExC,MAAKmvB,QAAQxgB,IAGd6gB,iBAAkB,WAEjB,GAAKxvB,KAAK+C,QAAQkrB,UAAlB,CAIA,GAAIb,GAAOptB,KAAKkvB,MACfnoB,GAAU,WAAY,YAAa,YAAa,WAAY,cAE7DtH,GAAEwO,QAAQyC,SAAS0c,EAAM,qBACzB3tB,EAAEiT,SAAS9K,GAAGwlB,EAAM,QAASptB,KAAKuhB,cAAevhB,MACjDP,EAAEiT,SAAS9K,GAAGwlB,EAAM,WAAYptB,KAAKgwB,YAAahwB,KAElD,KAAK,GAAII,GAAI,EAAGA,EAAI2G,EAAOjG,OAAQV,IAClCX,EAAEiT,SAAS9K,GAAGwlB,EAAMrmB,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,KAGlDP,GAAEwwB,QAAQC,aACblwB,KAAK2hB,SAAW,GAAIliB,GAAEwwB,QAAQC,WAAWlwB,MAErCA,KAAK+C,QAAQmrB,WAChBluB,KAAK2hB,SAASzE,YAKjBqE,cAAe,SAAUjQ,GACxB,GAAI6e,GAAanwB,KAAK2hB,UAAY3hB,KAAK2hB,SAASC,SAE5C5hB,KAAKkH,kBAAkBoK,EAAE3K,OAASwpB,IACrC1wB,EAAEiT,SAAS0d,gBAAgB9e,GAGxB6e,IAEEnwB,KAAK2hB,UAAa3hB,KAAK2hB,SAAS0O,WAAarwB,KAAK8kB,KAAKnD,WAAY3hB,KAAK8kB,KAAKnD,SAASC,UAE5F5hB,KAAK+H,KAAKuJ,EAAE3K,MACXob,cAAezQ,EACfoF,OAAQ1W,KAAKuuB,WAIfyB,YAAa,SAAU1e,GACJ,KAAdA,EAAEgf,SACLtwB,KAAK+H,KAAK,SACTga,cAAezQ,EACfoF,OAAQ1W,KAAKuuB,WAKhB/M,gBAAiB,SAAUlQ,GAE1BtR,KAAK+H,KAAKuJ,EAAE3K,MACXob,cAAezQ,EACfoF,OAAQ1W,KAAKuuB,UAKC,gBAAXjd,EAAE3K,MAA0B3G,KAAKkH,kBAAkBoK,EAAE3K,OACxDlH,EAAEiT,SAASC,eAAerB,GAEZ,cAAXA,EAAE3K,KACLlH,EAAEiT,SAAS0d,gBAAgB9e,GAE3B7R,EAAEiT,SAASC,eAAerB,IAI5BN,WAAY,SAAUC,GAMrB,MALAjR,MAAK+C,QAAQkO,QAAUA,EACnBjR,KAAK8kB,MACR9kB,KAAKkmB,iBAGClmB,MAGRkmB,eAAgB,WACfzmB,EAAEwO,QAAQ+C,WAAWhR,KAAKkvB,MAAOlvB,KAAK+C,QAAQkO,SAC1CjR,KAAK4vB,SACRnwB,EAAEwO,QAAQ+C,WAAWhR,KAAK4vB,QAAS5vB,KAAK+C,QAAQkO,UAIlDwe,cAAe,WACdzvB,KAAKqmB,cAAcrmB,KAAK+C,QAAQurB,aAGjCoB,aAAc,WACb1vB,KAAKqmB,cAAc,MAIrB5mB,EAAE8wB,OAAS,SAAU7Z,EAAQ3T,GAC5B,MAAO,IAAItD,GAAEsuB,OAAOrX,EAAQ3T,IAS7BtD,EAAE+wB,QAAU/wB,EAAE6sB,KAAKpsB,QAClB6C,SACCuqB,UAAW,GAAI,IAOfpd,UAAW,mBACXugB,MAAM,GAGPlE,WAAY,SAAUC,GACrB,GAAIjiB,GAAOiiB,GAA+B,QAApBA,EAAQvc,QAAqBuc,EAAUltB,EAASkL,cAAc,OACnFzH,EAAU/C,KAAK+C,OAchB,OAZIA,GAAQ0tB,QAAS,EACpBlmB,EAAI8c,UAAYtkB,EAAQ0tB,KAExBlmB,EAAI8c,UAAY,GAGbtkB,EAAQ2tB,QACXnmB,EAAIV,MAAM8mB,oBACP5tB,EAAQ2tB,MAAMxlB,EAAK,OAAUnI,EAAQ2tB,MAAMvlB,EAAK,MAGpDnL,KAAK8sB,eAAeviB,EAAK,QAClBA,GAGRmiB,aAAc,WACb,MAAO,SAITjtB,EAAEmxB,QAAU,SAAU7tB,GACrB,MAAO,IAAItD,GAAE+wB,QAAQztB,IAQtBtD,EAAEuY,IAAI9R,cACL2qB,mBAAmB,IAGpBpxB,EAAEqxB,MAAQrxB,EAAE0F,MAAMjF,QACjB2F,SAAUpG,EAAE6G,MAAMC,OAElBxD,SACCguB,SAAU,GACVvhB,SAAU,IAEVwhB,SAAS,EACTC,aAAa,EACb5V,QAAS,EAAG,GACZ6V,gBAAiB,EAAG,GAGpBC,YAAY,EACZjhB,UAAW,GACX4L,eAAe,GAGhBxW,WAAY,SAAUvC,EAASquB,GAC9B3xB,EAAEqD,WAAW9C,KAAM+C,GAEnB/C,KAAKqxB,QAAUD,EACfpxB,KAAK+kB,UAAYtlB,EAAEmL,QAAQV,OAASlK,KAAK+C,QAAQ+Y,cACjD9b,KAAKsxB,SAAU,GAGhBnP,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EAEPrjB,KAAKmd,YACTnd,KAAKsY,aAGN,IAAIiZ,GAAWlO,EAAItgB,QAAQmV,aAEvBqZ,IACH9xB,EAAEwO,QAAQ+C,WAAWhR,KAAKmd,WAAY,GAEvCkG,EAAIrE,OAAO2B,UAAUvQ,YAAYpQ,KAAKmd,YAEtCkG,EAAIzb,GAAG5H,KAAKwxB,aAAcxxB,MAE1BA,KAAKwuB,SAED+C,GACH9xB,EAAEwO,QAAQ+C,WAAWhR,KAAKmd,WAAY,GAGvCnd,KAAK+H,KAAK,QAEVsb,EAAItb,KAAK,aAAc0pB,MAAOzxB,OAE1BA,KAAKqxB,SACRrxB,KAAKqxB,QAAQtpB,KAAK,aAAc0pB,MAAOzxB,QAIzC0lB,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGR0xB,OAAQ,SAAUrO,GAEjB,MADAA,GAAIsO,UAAU3xB,MACPA,MAGRoc,SAAU,SAAUiH,GACnBA,EAAIrE,OAAO2B,UAAUE,YAAY7gB,KAAKmd,YAEtC1d,EAAEQ,KAAKiC,QAAQlC,KAAKmd,WAAWyU,aAE/BvO,EAAIxb,IAAI7H,KAAKwxB,aAAcxxB,MAEvBqjB,EAAItgB,QAAQmV,eACfzY,EAAEwO,QAAQ+C,WAAWhR,KAAKmd,WAAY,GAGvCnd,KAAK8kB,KAAO,KAEZ9kB,KAAK+H,KAAK,SAEVsb,EAAItb,KAAK,cAAe0pB,MAAOzxB,OAE3BA,KAAKqxB,SACRrxB,KAAKqxB,QAAQtpB,KAAK,cAAe0pB,MAAOzxB,QAI1C4uB,UAAW,WACV,MAAO5uB,MAAKuuB,SAGbM,UAAW,SAAUnY,GAMpB,MALA1W,MAAKuuB,QAAU9uB,EAAEkU,OAAO+C,GACpB1W,KAAK8kB,OACR9kB,KAAK6xB,kBACL7xB,KAAK8xB,cAEC9xB,MAGR+xB,WAAY,WACX,MAAO/xB,MAAKgyB,UAGbC,WAAY,SAAUC,GAGrB,MAFAlyB,MAAKgyB,SAAWE,EAChBlyB,KAAKwuB,SACExuB,MAGRwuB,OAAQ,WACFxuB,KAAK8kB,OAEV9kB,KAAKmd,WAAWtT,MAAMsoB,WAAa,SAEnCnyB,KAAKoyB,iBACLpyB,KAAKqyB,gBACLryB,KAAK6xB,kBAEL7xB,KAAKmd,WAAWtT,MAAMsoB,WAAa,GAEnCnyB,KAAK8xB,eAGNN,WAAY,WACX,GAAIzqB,IACHke,UAAWjlB,KAAK6xB,gBAajB,OAVI7xB,MAAK+kB,YACRhe,EAAOse,SAAWrlB,KAAKsyB,iBAEpB,gBAAkBtyB,MAAK+C,QAAU/C,KAAK+C,QAAQwvB,aAAevyB,KAAK8kB,KAAK/hB,QAAQ8tB,qBAClF9pB,EAAOyrB,SAAWxyB,KAAKyyB,QAEpBzyB,KAAK+C,QAAQouB,aAChBpqB,EAAOoe,QAAUnlB,KAAK8xB,YAGhB/qB,GAGR0rB,OAAQ,WACHzyB,KAAK8kB,MACR9kB,KAAK8kB,KAAK4N,WAAW1yB,OAIvBsY,YAAa,WACZ,GAIC2Y,GAJG0B,EAAS,gBACZC,EAAiBD,EAAS,IAAM3yB,KAAK+C,QAAQmN,UAAY,kBACvDlQ,KAAK+kB,UAAY,WAAa,QAChC5U,EAAYnQ,KAAKmd,WAAa1d,EAAEwO,QAAQ+B,OAAO,MAAO4iB,EAGnD5yB,MAAK+C,QAAQkuB,cAChBA,EAAcjxB,KAAK6yB,aAClBpzB,EAAEwO,QAAQ+B,OAAO,IAAK2iB,EAAS,gBAAiBxiB,GACjD8gB,EAAY6B,KAAO,SACnB7B,EAAY5J,UAAY,SACxB5nB,EAAEiT,SAASqgB,wBAAwB9B,GAEnCxxB,EAAEiT,SAAS9K,GAAGqpB,EAAa,QAASjxB,KAAKgzB,oBAAqBhzB,MAG/D,IAAIizB,GAAUjzB,KAAKkzB,SAClBzzB,EAAEwO,QAAQ+B,OAAO,MAAO2iB,EAAS,mBAAoBxiB,EACtD1Q,GAAEiT,SAASqgB,wBAAwBE,GAEnCjzB,KAAKmzB,aAAe1zB,EAAEwO,QAAQ+B,OAAO,MAAO2iB,EAAS,WAAYM,GAEjExzB,EAAEiT,SAAS0gB,yBAAyBpzB,KAAKmzB,cACzC1zB,EAAEiT,SAAS9K,GAAGqrB,EAAS,cAAexzB,EAAEiT,SAAS0d,iBAEjDpwB,KAAKqzB,cAAgB5zB,EAAEwO,QAAQ+B,OAAO,MAAO2iB,EAAS,iBAAkBxiB,GACxEnQ,KAAKszB,KAAO7zB,EAAEwO,QAAQ+B,OAAO,MAAO2iB,EAAS,OAAQ3yB,KAAKqzB,gBAG3DjB,eAAgB,WACf,GAAKpyB,KAAKgyB,SAAV,CAEA,GAA6B,gBAAlBhyB,MAAKgyB,SACfhyB,KAAKmzB,aAAa9L,UAAYrnB,KAAKgyB,aAC7B,CACN,KAAOhyB,KAAKmzB,aAAaI,iBACxBvzB,KAAKmzB,aAAatS,YAAY7gB,KAAKmzB,aAAanN,WAEjDhmB,MAAKmzB,aAAa/iB,YAAYpQ,KAAKgyB,UAEpChyB,KAAK+H,KAAK,mBAGXsqB,cAAe,WACd,GAAIliB,GAAYnQ,KAAKmzB,aACpBtpB,EAAQsG,EAAUtG,KAEnBA,GAAM0F,MAAQ,GACd1F,EAAM2pB,WAAa,QAEnB,IAAIjkB,GAAQY,EAAUyhB,WACtBriB,GAAQhN,KAAKmK,IAAI6C,EAAOvP,KAAK+C,QAAQyM,UACrCD,EAAQhN,KAAKgC,IAAIgL,EAAOvP,KAAK+C,QAAQguB,UAErClnB,EAAM0F,MAASA,EAAQ,EAAK,KAC5B1F,EAAM2pB,WAAa,GAEnB3pB,EAAMggB,OAAS,EAEf,IAAIA,GAAS1Z,EAAUsjB,aACtBC,EAAY1zB,KAAK+C,QAAQ2wB,UACzBC,EAAgB,wBAEbD,IAAa7J,EAAS6J,GACzB7pB,EAAMggB,OAAS6J,EAAY,KAC3Bj0B,EAAEwO,QAAQyC,SAASP,EAAWwjB,IAE9Bl0B,EAAEwO,QAAQ4C,YAAYV,EAAWwjB,GAGlC3zB,KAAK4zB,gBAAkB5zB,KAAKmd,WAAWyU,aAGxCC,gBAAiB,WAChB,GAAK7xB,KAAK8kB,KAAV,CAEA,GAAInW,GAAM3O,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,SAC3CsF,EAAW7zB,KAAK+kB,UAChB1J,EAAS5b,EAAE6L,MAAMtL,KAAK+C,QAAQsY,OAE3BwY,IACHp0B,EAAEwO,QAAQiE,YAAYlS,KAAKmd,WAAYxO,GAGxC3O,KAAK8zB,kBAAoBzY,EAAOlQ,GAAK0oB,EAAW,EAAIllB,EAAIxD,GACxDnL,KAAK+zB,gBAAkBxxB,KAAKC,MAAMxC,KAAK4zB,gBAAkB,GAAKvY,EAAOnQ,GAAK2oB,EAAW,EAAIllB,EAAIzD,GAG7FlL,KAAKmd,WAAWtT,MAAMmqB,OAASh0B,KAAK8zB,iBAAmB,KACvD9zB,KAAKmd,WAAWtT,MAAMgF,KAAO7O,KAAK+zB,eAAiB,OAGpDzB,eAAgB,SAAUvC,GACzB,GAAIphB,GAAM3O,KAAK8kB,KAAK1C,uBAAuBpiB,KAAKuuB,QAASwB,EAAI5Y,KAAM4Y,EAAIpX,OAEvElZ,GAAEwO,QAAQiE,YAAYlS,KAAKmd,WAAYxO,IAGxCmjB,WAAY,WACX,GAAK9xB,KAAK+C,QAAQiuB,QAAlB,CAEA,GAAI3N,GAAMrjB,KAAK8kB,KACdmP,EAAkBj0B,KAAKmd,WAAWsW,aAClCS,EAAiBl0B,KAAK4zB,gBAEtBO,EAAW,GAAI10B,GAAEwL,MAAMjL,KAAK+zB,gBAAiBE,EAAkBj0B,KAAK8zB,iBAEjE9zB,MAAK+kB,WACRoP,EAAS5oB,KAAK9L,EAAEwO,QAAQqE,YAAYtS,KAAKmd,YAG1C,IAAIiX,GAAe/Q,EAAI7D,2BAA2B2U,GACjD1Z,EAAUhb,EAAE6L,MAAMtL,KAAK+C,QAAQmuB,gBAC/B3W,EAAY9a,EAAE6L,MAAMtL,KAAK+C,QAAQsxB,uBAAyB5Z,GAC1DC,EAAYjb,EAAE6L,MAAMtL,KAAK+C,QAAQuxB,2BAA6B7Z,GAC9D2D,EAAOiF,EAAIvW,UACXkW,EAAK,EACLE,EAAK,CAEFkR,GAAalpB,EAAIgpB,EAAiBxZ,EAAUxP,EAAIkT,EAAKlT,IACxD8X,EAAKoR,EAAalpB,EAAIgpB,EAAiB9V,EAAKlT,EAAIwP,EAAUxP,GAEvDkpB,EAAalpB,EAAI8X,EAAKzI,EAAUrP,EAAI,IACvC8X,EAAKoR,EAAalpB,EAAIqP,EAAUrP,GAE7BkpB,EAAajpB,EAAI8oB,EAAkBvZ,EAAUvP,EAAIiT,EAAKjT,IACzD+X,EAAKkR,EAAajpB,EAAI8oB,EAAkB7V,EAAKjT,EAAIuP,EAAUvP,GAExDipB,EAAajpB,EAAI+X,EAAK3I,EAAUpP,EAAI,IACvC+X,EAAKkR,EAAajpB,EAAIoP,EAAUpP,IAG7B6X,GAAME,IACTG,EACEtb,KAAK,gBACLqT,OAAO4H,EAAIE,MAIf8P,oBAAqB,SAAU1hB,GAC9BtR,KAAKyyB,SACLhzB,EAAEiT,SAAS6hB,KAAKjjB,MAIlB7R,EAAEgyB,MAAQ,SAAU1uB,EAASquB,GAC5B,MAAO,IAAI3xB,GAAEqxB,MAAM/tB,EAASquB,IAI7B3xB,EAAEuY,IAAI/R,SACL0rB,UAAW,SAAUF,EAAO/a,EAAQ3T,GAGnC,GAFA/C,KAAK0yB,eAECjB,YAAiBhyB,GAAEqxB,OAAQ,CAChC,GAAIoB,GAAUT,CAEdA,GAAQ,GAAIhyB,GAAEqxB,MAAM/tB,GAClB8rB,UAAUnY,GACVub,WAAWC,GAKd,MAHAT,GAAMH,SAAU,EAEhBtxB,KAAKgvB,OAASyC,EACPzxB,KAAK0b,SAAS+V,IAGtBiB,WAAY,SAAUjB,GASrB,MARKA,IAASA,IAAUzxB,KAAKgvB,SAC5ByC,EAAQzxB,KAAKgvB,OACbhvB,KAAKgvB,OAAS,MAEXyC,IACHzxB,KAAKmc,YAAYsV,GACjBA,EAAMH,SAAU,GAEVtxB,QASTP,EAAEsuB,OAAO9nB,SACR0rB,UAAW,WAMV,MALI3xB,MAAKgvB,QAAUhvB,KAAK8kB,OAAS9kB,KAAK8kB,KAAKzI,SAASrc,KAAKgvB,UACxDhvB,KAAKgvB,OAAOH,UAAU7uB,KAAKuuB,SAC3BvuB,KAAK8kB,KAAK6M,UAAU3xB,KAAKgvB,SAGnBhvB,MAGR0yB,WAAY,WAIX,MAHI1yB,MAAKgvB,QACRhvB,KAAKgvB,OAAOyD,SAENzyB,MAGRw0B,YAAa,WAQZ,MAPIx0B,MAAKgvB,SACJhvB,KAAKgvB,OAAOsC,QACftxB,KAAK0yB,aAEL1yB,KAAK2xB,aAGA3xB,MAGRivB,UAAW,SAAUiD,EAASnvB,GAC7B,GAAIgqB,GAASttB,EAAE6L,MAAMtL,KAAK+C,QAAQqqB,KAAKrqB,QAAQwqB,cAAgB,EAAG,GA0BlE,OAxBAR,GAASA,EAAO1hB,IAAI5L,EAAEqxB,MAAMpwB,UAAUqC,QAAQsY,QAE1CtY,GAAWA,EAAQsY,SACtB0R,EAASA,EAAO1hB,IAAItI,EAAQsY,SAG7BtY,EAAUtD,EAAES,QAAQmb,OAAQ0R,GAAShqB,GAEhC/C,KAAKy0B,sBACTz0B,KACE4H,GAAG,QAAS5H,KAAKw0B,YAAax0B,MAC9B4H,GAAG,SAAU5H,KAAK0yB,WAAY1yB,MAC9B4H,GAAG,OAAQ5H,KAAK00B,WAAY10B,MAC9BA,KAAKy0B,qBAAsB,GAGxBvC,YAAmBzyB,GAAEqxB,OACxBrxB,EAAEqD,WAAWovB,EAASnvB,GACtB/C,KAAKgvB,OAASkD,GAEdlyB,KAAKgvB,OAAS,GAAIvvB,GAAEqxB,MAAM/tB,EAAS/C,MACjCiyB,WAAWC,GAGPlyB,MAGR20B,gBAAiB,SAAUzC,GAI1B,MAHIlyB,MAAKgvB,QACRhvB,KAAKgvB,OAAOiD,WAAWC,GAEjBlyB,MAGR40B,YAAa,WASZ,MARI50B,MAAKgvB,SACRhvB,KAAKgvB,OAAS,KACdhvB,KACE6H,IAAI,QAAS7H,KAAKw0B,YAAax0B,MAC/B6H,IAAI,SAAU7H,KAAK0yB,WAAY1yB,MAC/B6H,IAAI,OAAQ7H,KAAK00B,WAAY10B,MAC/BA,KAAKy0B,qBAAsB,GAErBz0B,MAGR60B,SAAU,WACT,MAAO70B,MAAKgvB,QAGb0F,WAAY,SAAUpjB,GACrBtR,KAAKgvB,OAAOH,UAAUvd,EAAEoF,WAU1BjX,EAAEq1B,WAAar1B,EAAE0F,MAAMjF,QACtBoF,WAAY,SAAU6T,GACrBnZ,KAAK+Y,UAEL,IAAI3Y,GAAGE,CAEP,IAAI6Y,EACH,IAAK/Y,EAAI,EAAGE,EAAM6Y,EAAOrY,OAAYR,EAAJF,EAASA,IACzCJ,KAAK0b,SAASvC,EAAO/Y,KAKxBsb,SAAU,SAAUC,GACnB,GAAI9W,GAAK7E,KAAK+0B,WAAWpZ,EAQzB,OANA3b,MAAK+Y,QAAQlU,GAAM8W,EAEf3b,KAAK8kB,MACR9kB,KAAK8kB,KAAKpJ,SAASC,GAGb3b,MAGRmc,YAAa,SAAUR,GACtB,GAAI9W,GAAK8W,IAAS3b,MAAK+Y,QAAU4C,EAAQ3b,KAAK+0B,WAAWpZ,EAQzD,OANI3b,MAAK8kB,MAAQ9kB,KAAK+Y,QAAQlU,IAC7B7E,KAAK8kB,KAAK3I,YAAYnc,KAAK+Y,QAAQlU,UAG7B7E,MAAK+Y,QAAQlU,GAEb7E,MAGRqc,SAAU,SAAUV,GACnB,MAAKA,GAEGA,IAAS3b,MAAK+Y,SAAW/Y,KAAK+0B,WAAWpZ,IAAU3b,MAAK+Y,SAF3C,GAKtBic,YAAa,WAEZ,MADAh1B,MAAKsc,UAAUtc,KAAKmc,YAAanc,MAC1BA,MAGRi1B,OAAQ,SAAUC,GACjB,GACC90B,GAAGub,EADAxa,EAAOV,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,EAGjD,KAAKT,IAAKJ,MAAK+Y,QACd4C,EAAQ3b,KAAK+Y,QAAQ3Y,GAEjBub,EAAMuZ,IACTvZ,EAAMuZ,GAAY9zB,MAAMua,EAAOxa,EAIjC,OAAOnB,OAGRmiB,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EACZrjB,KAAKsc,UAAU+G,EAAI3H,SAAU2H,IAG9BjH,SAAU,SAAUiH,GACnBrjB,KAAKsc,UAAU+G,EAAIlH,YAAakH,GAChCrjB,KAAK8kB,KAAO,MAGbY,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGRsc,UAAW,SAAU7a,EAAQC,GAC5B,IAAK,GAAItB,KAAKJ,MAAK+Y,QAClBtX,EAAOb,KAAKc,EAAS1B,KAAK+Y,QAAQ3Y,GAEnC,OAAOJ,OAGRm1B,SAAU,SAAUtwB,GACnB,MAAO7E,MAAK+Y,QAAQlU,IAGrBuwB,UAAW,WACV,GAAIjc,KAEJ,KAAK,GAAI/Y,KAAKJ,MAAK+Y,QAClBI,EAAO/V,KAAKpD,KAAK+Y,QAAQ3Y,GAE1B,OAAO+Y,IAGRgN,UAAW,SAAUC,GACpB,MAAOpmB,MAAKi1B,OAAO,YAAa7O,IAGjC2O,WAAY,SAAUpZ,GACrB,MAAOlc,GAAE4B,MAAMsa,MAIjBlc,EAAE41B,WAAa,SAAUlc,GACxB,MAAO,IAAI1Z,GAAEq1B,WAAW3b,IASzB1Z,EAAE61B,aAAe71B,EAAEq1B,WAAW50B,QAC7B2F,SAAUpG,EAAE6G,MAAMC,OAElBX,SACC2vB,OAAQ,gFAGT7Z,SAAU,SAAUC,GACnB,MAAI3b,MAAKqc,SAASV,GACV3b,MAGJ,MAAQ2b,IACXA,EAAM/T,GAAGnI,EAAE61B,aAAaC,OAAQv1B,KAAKw1B,gBAAiBx1B,MAGvDP,EAAEq1B,WAAWp0B,UAAUgb,SAAS9a,KAAKZ,KAAM2b,GAEvC3b,KAAKy1B,eAAiB9Z,EAAMsT,WAC/BtT,EAAMsT,UAAUjvB,KAAKy1B,cAAez1B,KAAK01B,eAGnC11B,KAAK+H,KAAK,YAAa4T,MAAOA,MAGtCQ,YAAa,SAAUR,GACtB,MAAK3b,MAAKqc,SAASV,IAGfA,IAAS3b,MAAK+Y,UACjB4C,EAAQ3b,KAAK+Y,QAAQ4C,IAGtBA,EAAM9T,IAAIpI,EAAE61B,aAAaC,OAAQv1B,KAAKw1B,gBAAiBx1B,MAEvDP,EAAEq1B,WAAWp0B,UAAUyb,YAAYvb,KAAKZ,KAAM2b,GAE1C3b,KAAKy1B,eACRz1B,KAAKi1B,OAAO,eAGNj1B,KAAK+H,KAAK,eAAgB4T,MAAOA,KAdhC3b,MAiBTivB,UAAW,SAAUiD,EAASnvB,GAG7B,MAFA/C,MAAKy1B,cAAgBvD,EACrBlyB,KAAK01B,cAAgB3yB,EACd/C,KAAKi1B,OAAO,YAAa/C,EAASnvB,IAG1C4uB,UAAW,SAAUjb,GAEpB,IAAK,GAAI7R,KAAM7E,MAAK+Y,QAAS,CAC5B/Y,KAAK+Y,QAAQlU,GAAI8sB,UAAUjb,EAC3B,OAED,MAAO1W,OAGR21B,SAAU,SAAU9rB,GACnB,MAAO7J,MAAKi1B,OAAO,WAAYprB,IAGhC8b,aAAc,WACb,MAAO3lB,MAAKi1B,OAAO,iBAGpBnP,YAAa,WACZ,MAAO9lB,MAAKi1B,OAAO,gBAGpB3a,UAAW,WACV,GAAIvN,GAAS,GAAItN,GAAEmV,YAMnB,OAJA5U,MAAKsc,UAAU,SAAUX,GACxB5O,EAAO7M,OAAOyb,YAAiBlc,GAAEsuB,OAASpS,EAAMiT,YAAcjT,EAAMrB,eAG9DvN,GAGRyoB,gBAAiB,SAAUlkB,GAC1BA,EAAI7R,EAAES,QACLyb,MAAOrK,EAAE7J,OACTA,OAAQzH,MACNsR,GACHtR,KAAK+H,KAAKuJ,EAAE3K,KAAM2K,MAIpB7R,EAAEm2B,aAAe,SAAUzc,GAC1B,MAAO,IAAI1Z,GAAE61B,aAAanc,IAQ3B1Z,EAAEo2B,KAAOp2B,EAAE0F,MAAMjF,QAChB2F,UAAWpG,EAAE6G,MAAMC,QAEnBX,SAICkwB,aAAc,WACb,GAAIvxB,GAAM9E,EAAEmL,QAAQ/B,OAAS,KAAO,IACnCpB,GAAUlD,EAAMhC,KAAKgC,IAAIlF,EAAO02B,WAAY12B,EAAO22B,aAAe,GAAK,CACxE,OAAOzzB,MAAKgC,IAAI,EAAGhC,KAAKmK,IAAI,GAAKjF,QAInC1E,SACCkzB,QAAQ,EACRC,MAAO,UACPC,UAAW,KACXC,QAAS,KACTC,SAAU,KACVC,OAAQ,EACRrlB,QAAS,GAETslB,MAAM,EACNC,UAAW,KACXC,YAAa,GAEbxI,WAAW,GAGZ3oB,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,IAGpBof,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,EAEPrjB,KAAKmd,aACTnd,KAAK02B,gBACL12B,KAAKwY,eAGNxY,KAAK22B,iBACL32B,KAAK42B,cAED52B,KAAKmd,YACRnd,KAAK8kB,KAAK+R,UAAUzmB,YAAYpQ,KAAKmd,YAGtCnd,KAAK+H,KAAK,OAEVsb,EAAIzb,IACHqd,UAAajlB,KAAK22B,eAClBxR,QAAWnlB,KAAK42B,aACd52B,OAGJ0lB,MAAO,SAAUrC,GAEhB,MADAA,GAAI3H,SAAS1b,MACNA,MAGRoc,SAAU,SAAUiH,GACnBA,EAAIwT,UAAUhW,YAAY7gB,KAAKmd,YAG/Bnd,KAAK+H,KAAK,UACV/H,KAAK8kB,KAAO,KAERrlB,EAAEmL,QAAQksB,MACb92B,KAAKmd,WAAa,KAClBnd,KAAK+2B,QAAU,KACf/2B,KAAKg3B,MAAQ,MAGd3T,EAAIxb,KACHod,UAAajlB,KAAK22B,eAClBxR,QAAWnlB,KAAK42B,aACd52B,OAGJ22B,eAAgB,aAIhBhB,SAAU,SAAU9rB,GAOnB,MANApK,GAAEqD,WAAW9C,KAAM6J,GAEf7J,KAAKmd,YACRnd,KAAKi3B,eAGCj3B,MAGRwmB,OAAQ,WAKP,MAJIxmB,MAAK8kB,OACR9kB,KAAK22B,iBACL32B,KAAK42B,eAEC52B,QAITP,EAAEuY,IAAI/R,SACLixB,oBAAqB,WACpB,GAAIC,GAAI13B,EAAEo2B,KAAKC,aACd1X,EAAOpe,KAAK8M,UACZsqB,EAAU33B,EAAEwO,QAAQqE,YAAYtS,KAAKkgB,UACrCxT,EAAM0qB,EAAQxrB,WAAW,IAAIH,UAAU2S,EAAKxS,WAAWurB,GAAGrrB,UAC1DvH,EAAMmI,EAAIrB,IAAI+S,EAAKxS,WAAW,EAAQ,EAAJurB,GAAOrrB,SAE1C9L,MAAKq3B,cAAgB,GAAI53B,GAAE6M,OAAOI,EAAKnI,MASzC9E,EAAEo2B,KAAKyB,OAAS,6BAEhB73B,EAAEmL,QAAQ2sB,OAASj4B,EAASk4B,kBAAmBl4B,EAASk4B,gBAAgB/3B,EAAEo2B,KAAKyB,OAAQ,OAAOG,eAE9Fh4B,EAAEo2B,KAAOp2B,EAAEo2B,KAAK31B,QACf0F,SACC8xB,IAAKj4B,EAAEmL,QAAQ2sB,KAGhB5R,aAAc,WACb,GAAIgS,GAAO33B,KAAK8kB,KAAK+R,UACpBpJ,EAAOztB,KAAKmd,UAKb,OAHIsQ,IAAQkK,EAAKC,YAAcnK,GAC9BkK,EAAKvnB,YAAYqd,GAEXztB,MAGR8lB,YAAa,WACZ,GAAI6R,GAAO33B,KAAK8kB,KAAK+R,UACpBpJ,EAAOztB,KAAKmd,WACZ0a,EAAQF,EAAK3R,UAKd,OAHIyH,IAAQoK,IAAUpK,GACrBkK,EAAK5R,aAAa0H,EAAMoK,GAElB73B,MAGR83B,cAAe,aAIfC,eAAgB,SAAU7zB,GACzB,MAAO5E,GAASk4B,gBAAgB/3B,EAAEo2B,KAAKyB,OAAQpzB,IAGhDwyB,cAAe,WACd12B,KAAK8kB,KAAKkT,gBACVh4B,KAAKi4B,YACLj4B,KAAKk4B,cAGND,UAAW,WACVj4B,KAAKmd,WAAand,KAAK+3B,eAAe,KAEtC/3B,KAAKm4B,MAAQn4B,KAAK+3B,eAAe,QAE7B/3B,KAAK+C,QAAQmN,WAChBzQ,EAAEwO,QAAQyC,SAAS1Q,KAAKm4B,MAAOn4B,KAAK+C,QAAQmN,WAG7ClQ,KAAKmd,WAAW/M,YAAYpQ,KAAKm4B,QAGlCD,WAAY,WACPl4B,KAAK+C,QAAQkzB,SAChBj2B,KAAKm4B,MAAMztB,aAAa,kBAAmB,SAC3C1K,KAAKm4B,MAAMztB,aAAa,iBAAkB,UAEvC1K,KAAK+C,QAAQwzB,MAChBv2B,KAAKm4B,MAAMztB,aAAa,YAAa,WAElC1K,KAAK+C,QAAQq1B,eAChBp4B,KAAKm4B,MAAMztB,aAAa,iBAAkB1K,KAAK+C,QAAQq1B,eAEnDp4B,KAAK+C,QAAQkrB,WAAcjuB,KAAK+C,QAAQq1B,eAC5Cp4B,KAAKm4B,MAAMztB,aAAa,iBAAkB,QAE3C1K,KAAKi3B,gBAGNA,aAAc,WACTj3B,KAAK+C,QAAQkzB,QAChBj2B,KAAKm4B,MAAMztB,aAAa,SAAU1K,KAAK+C,QAAQmzB,OAC/Cl2B,KAAKm4B,MAAMztB,aAAa,iBAAkB1K,KAAK+C,QAAQkO,SACvDjR,KAAKm4B,MAAMztB,aAAa,eAAgB1K,KAAK+C,QAAQuzB,QACjDt2B,KAAK+C,QAAQozB,UAChBn2B,KAAKm4B,MAAMztB,aAAa,mBAAoB1K,KAAK+C,QAAQozB,WAEzDn2B,KAAKm4B,MAAMxtB,gBAAgB,oBAExB3K,KAAK+C,QAAQqzB,SAChBp2B,KAAKm4B,MAAMztB,aAAa,iBAAkB1K,KAAK+C,QAAQqzB,SAEpDp2B,KAAK+C,QAAQszB,UAChBr2B,KAAKm4B,MAAMztB,aAAa,kBAAmB1K,KAAK+C,QAAQszB,WAGzDr2B,KAAKm4B,MAAMztB,aAAa,SAAU,QAE/B1K,KAAK+C,QAAQwzB,MAChBv2B,KAAKm4B,MAAMztB,aAAa,OAAQ1K,KAAK+C,QAAQyzB,WAAax2B,KAAK+C,QAAQmzB,OACvEl2B,KAAKm4B,MAAMztB,aAAa,eAAgB1K,KAAK+C,QAAQ0zB,cAErDz2B,KAAKm4B,MAAMztB,aAAa,OAAQ,SAIlCksB,YAAa,WACZ,GAAIl0B,GAAM1C,KAAK83B,eACVp1B,KAEJA,EAAM,QAEP1C,KAAKm4B,MAAMztB,aAAa,IAAKhI,IAI9B8V,YAAa,WACZ,GAAIxY,KAAK+C,QAAQkrB,UAAW,EACvBxuB,EAAEmL,QAAQ2sB,KAAQ93B,EAAEmL,QAAQksB,KAC/Br3B,EAAEwO,QAAQyC,SAAS1Q,KAAKm4B,MAAO,qBAGhC14B,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,QAASnd,KAAKuhB,cAAevhB,KAI5D,KAAK,GAFD+G,IAAU,WAAY,YAAa,YACtC,WAAY,YAAa,eACjB3G,EAAI,EAAGA,EAAI2G,EAAOjG,OAAQV,IAClCX,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAYpW,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,QAKnEuhB,cAAe,SAAUjQ,GACpBtR,KAAK8kB,KAAKnD,UAAY3hB,KAAK8kB,KAAKnD,SAASC,SAE7C5hB,KAAKwhB,gBAAgBlQ,IAGtBkQ,gBAAiB,SAAUlQ,GAC1B,GAAKtR,KAAKkH,kBAAkBoK,EAAE3K,MAA9B,CAEA,GAAI0c,GAAMrjB,KAAK8kB,KACd9K,EAAiBqJ,EAAI3D,2BAA2BpO,GAChDmO,EAAa4D,EAAI/D,2BAA2BtF,GAC5CtD,EAAS2M,EAAI3F,mBAAmB+B,EAEjCzf,MAAK+H,KAAKuJ,EAAE3K,MACX+P,OAAQA,EACR+I,WAAYA,EACZzF,eAAgBA,EAChB+H,cAAezQ,IAGD,gBAAXA,EAAE3K,MACLlH,EAAEiT,SAASC,eAAerB,GAEZ,cAAXA,EAAE3K,MACLlH,EAAEiT,SAAS0d,gBAAgB9e,OAK9B7R,EAAEuY,IAAI/R,SACL+xB,cAAe,WACTh4B,KAAK62B,YACT72B,KAAK62B,UAAYp3B,EAAEo2B,KAAKn1B,UAAUq3B,eAAe,OACjD/3B,KAAKgf,OAAOyB,YAAYrQ,YAAYpQ,KAAK62B;AAErC72B,KAAK+C,QAAQ+Y,eAAiBrc,EAAEmL,QAAQV,OAC3CzK,EAAEwO,QAAQyC,SAAS1Q,KAAK62B,UAAW,yBAEnC72B,KAAK4H,IACJyd,SAAYrlB,KAAKq4B,iBACjB9S,QAAWvlB,KAAKs4B,gBAGjB74B,EAAEwO,QAAQyC,SAAS1Q,KAAK62B,UAAW,qBAGpC72B,KAAK4H,GAAG,UAAW5H,KAAKu4B,oBACxBv4B,KAAKu4B,uBAIPF,iBAAkB,SAAU/mB,GAC3B,GAAIxD,GAAQ9N,KAAK8Z,aAAaxI,EAAE6F,MAC/BkE,EAASrb,KAAKuiB,iBAAiBjR,EAAEqH,QAAQ9M,aAAaiC,GAAOvC,KAAKvL,KAAKq3B,cAAc3qB,IAEtF1M,MAAK62B,UAAUhtB,MAAMpK,EAAEwO,QAAQoE,WAC9B5S,EAAEwO,QAAQyD,mBAAmB2J,GAAU,UAAYvN,EAAQ,KAE5D9N,KAAKw4B,cAAe,GAGrBF,aAAc,WACbt4B,KAAKw4B,cAAe,GAGrBD,mBAAoB,WAEnB,IAAIv4B,KAAKw4B,aAAT,CAOAx4B,KAAKk3B,qBAEL,IAAIuB,GAAKz4B,KAAKq3B,cACb3qB,EAAM+rB,EAAG/rB,IACTnI,EAAMk0B,EAAGl0B,IACTgL,EAAQhL,EAAI2G,EAAIwB,EAAIxB,EACpB2e,EAAStlB,EAAI4G,EAAIuB,EAAIvB,EACrBwsB,EAAO33B,KAAK62B,UACZjR,EAAO5lB,KAAKgf,OAAOyB,WAGhBhhB,GAAEmL,QAAQE,cACb8a,EAAK/E,YAAY8W,GAGlBl4B,EAAEwO,QAAQiE,YAAYylB,EAAMjrB,GAC5BirB,EAAKjtB,aAAa,QAAS6E,GAC3BooB,EAAKjtB,aAAa,SAAUmf,GAC5B8N,EAAKjtB,aAAa,WAAYgC,EAAIxB,EAAGwB,EAAIvB,EAAGoE,EAAOsa,GAAQrmB,KAAK,MAE5D/D,EAAEmL,QAAQE,cACb8a,EAAKxV,YAAYunB,OAUpBl4B,EAAEo2B,KAAK5vB,SAENgpB,UAAW,SAAUiD,EAASnvB,GAmB7B,MAjBImvB,aAAmBzyB,GAAEqxB,MACxB9wB,KAAKgvB,OAASkD,GAETlyB,KAAKgvB,SAAUjsB,IACnB/C,KAAKgvB,OAAS,GAAIvvB,GAAEqxB,MAAM/tB,EAAS/C,OAEpCA,KAAKgvB,OAAOiD,WAAWC,IAGnBlyB,KAAKy0B,sBACTz0B,KACE4H,GAAG,QAAS5H,KAAK04B,WAAY14B,MAC7B4H,GAAG,SAAU5H,KAAK0yB,WAAY1yB,MAEhCA,KAAKy0B,qBAAsB,GAGrBz0B,MAGR40B,YAAa,WASZ,MARI50B,MAAKgvB,SACRhvB,KAAKgvB,OAAS,KACdhvB,KACE6H,IAAI,QAAS7H,KAAK04B,YAClB7wB,IAAI,SAAU7H,KAAK0yB,YAErB1yB,KAAKy0B,qBAAsB,GAErBz0B,MAGR2xB,UAAW,SAAUjb,GAUpB,MARI1W,MAAKgvB,SAERtY,EAASA,GAAU1W,KAAKuuB,SACvBvuB,KAAK24B,SAASp2B,KAAKwJ,MAAM/L,KAAK24B,SAAS73B,OAAS,IAEjDd,KAAK04B,YAAYhiB,OAAQA,KAGnB1W,MAGR0yB,WAAY,WAIX,MAHI1yB,MAAKgvB,QACRhvB,KAAKgvB,OAAOyD,SAENzyB,MAGR04B,WAAY,SAAUpnB,GACrBtR,KAAKgvB,OAAOH,UAAUvd,EAAEoF,QACxB1W,KAAK8kB,KAAK6M,UAAU3xB,KAAKgvB,WAU3BvvB,EAAEmL,QAAQksB,KAAOr3B,EAAEmL,QAAQ2sB,KAAQ,WACjC,IACC,GAAIhtB,GAAMjL,EAASkL,cAAc,MACjCD,GAAI8c,UAAY,oBAEhB,IAAIuR,GAAQruB,EAAIyb,UAGhB,OAFA4S,GAAM/uB,MAAMgvB,SAAW,oBAEhBD,GAA+B,gBAAdA,GAAME,IAE7B,MAAOxnB,GACR,OAAO,MAIV7R,EAAEo2B,KAAOp2B,EAAEmL,QAAQ2sB,MAAQ93B,EAAEmL,QAAQksB,IAAMr3B,EAAEo2B,KAAOp2B,EAAEo2B,KAAK31B,QAC1D0F,SACCmzB,KAAK,EACLjD,aAAc,KAGfiC,eAAiB,WAChB,IAEC,MADAz4B,GAAS05B,WAAW3tB,IAAI,OAAQ,iCACzB,SAAUnH,GAChB,MAAO5E,GAASkL,cAAc,SAAWtG,EAAO,mBAEhD,MAAOoN,GACR,MAAO,UAAUpN,GAChB,MAAO5E,GAASkL,cACf,IAAMtG,EAAO,6DAKjB+zB,UAAW,WACV,GAAI9nB,GAAYnQ,KAAKmd,WAAand,KAAK+3B,eAAe,QAEtDt4B,GAAEwO,QAAQyC,SAASP,EAAW,qBAC5BnQ,KAAK+C,QAAQmN,UAAY,IAAMlQ,KAAK+C,QAAQmN,UAAY,KAEtDlQ,KAAK+C,QAAQkrB,WAChBxuB,EAAEwO,QAAQyC,SAASP,EAAW,qBAG/BA,EAAU8oB,UAAY,MAEtBj5B,KAAKm4B,MAAQn4B,KAAK+3B,eAAe,QACjC5nB,EAAUC,YAAYpQ,KAAKm4B,OAE3Bn4B,KAAK8kB,KAAK+R,UAAUzmB,YAAYD,IAGjC+nB,WAAY,WACXl4B,KAAKi3B,gBAGNA,aAAc,WACb,GAAIhB,GAASj2B,KAAK+2B,QACjBR,EAAOv2B,KAAKg3B,MACZj0B,EAAU/C,KAAK+C,QACfoN,EAAYnQ,KAAKmd,UAElBhN,GAAU+oB,QAAUn2B,EAAQkzB,OAC5B9lB,EAAUgpB,OAASp2B,EAAQwzB,KAEvBxzB,EAAQkzB,QACNA,IACJA,EAASj2B,KAAK+2B,QAAU/2B,KAAK+3B,eAAe,UAC5C9B,EAAOmD,OAAS,QAChBjpB,EAAUC,YAAY6lB,IAEvBA,EAAOK,OAASvzB,EAAQuzB,OAAS,KACjCL,EAAOC,MAAQnzB,EAAQmzB,MACvBD,EAAOhlB,QAAUlO,EAAQkO,QAErBlO,EAAQozB,UACXF,EAAOoD,UAAY55B,EAAEQ,KAAK4D,QAAQd,EAAQozB,WACzCpzB,EAAQozB,UAAU3yB,KAAK,KACvBT,EAAQozB,UAAUxzB,QAAQ,WAAY,KAEvCszB,EAAOoD,UAAY,GAEhBt2B,EAAQqzB,UACXH,EAAOmD,OAASr2B,EAAQqzB,QAAQzzB,QAAQ,OAAQ,SAE7CI,EAAQszB,WACXJ,EAAOqD,UAAYv2B,EAAQszB,WAGlBJ,IACV9lB,EAAU0Q,YAAYoV,GACtBj2B,KAAK+2B,QAAU,MAGZh0B,EAAQwzB,MACNA,IACJA,EAAOv2B,KAAKg3B,MAAQh3B,KAAK+3B,eAAe,QACxC5nB,EAAUC,YAAYmmB,IAEvBA,EAAKL,MAAQnzB,EAAQyzB,WAAazzB,EAAQmzB,MAC1CK,EAAKtlB,QAAUlO,EAAQ0zB,aAEbF,IACVpmB,EAAU0Q,YAAY0V,GACtBv2B,KAAKg3B,MAAQ,OAIfJ,YAAa,WACZ,GAAI/sB,GAAQ7J,KAAKmd,WAAWtT,KAE5BA,GAAM0vB,QAAU,OAChBv5B,KAAKm4B,MAAMqB,EAAIx5B,KAAK83B,gBAAkB,IACtCjuB,EAAM0vB,QAAU,MAIlB95B,EAAEuY,IAAI/R,QAAQxG,EAAEmL,QAAQ2sB,MAAQ93B,EAAEmL,QAAQksB,QACzCkB,cAAe,WACd,IAAIh4B,KAAK62B,UAAT,CAEA,GAAIc,GAAO33B,KAAK62B,UAAYv3B,EAASkL,cAAc,MACnDmtB,GAAKznB,UAAY,wBACjBlQ,KAAKgf,OAAOyB,YAAYrQ,YAAYunB,GAEpC33B,KAAK4H,GAAG,UAAW5H,KAAKk3B,qBACxBl3B,KAAKk3B,0BASPz3B,EAAEmL,QAAQkhB,OAAU,WACnB,QAASxsB,EAASkL,cAAc,UAAUivB,cAG3Ch6B,EAAEo2B,KAAQp2B,EAAEo2B,KAAK6B,MAAQr4B,EAAOq6B,kBAAqBj6B,EAAEmL,QAAQkhB,OAASrsB,EAAEo2B,KAAOp2B,EAAEo2B,KAAK31B,QACvF0F,SAEC+zB,QAAQ,EACRjC,KAAK,GAGNlR,OAAQ,WAKP,MAJIxmB,MAAK8kB,OACR9kB,KAAK22B,iBACL32B,KAAK45B,kBAEC55B,MAGR21B,SAAU,SAAU9rB,GAOnB,MANApK,GAAEqD,WAAW9C,KAAM6J,GAEf7J,KAAK8kB,OACR9kB,KAAKi3B,eACLj3B,KAAK45B,kBAEC55B,MAGRoc,SAAU,SAAUiH,GACnBA,EACExb,IAAI,YAAa7H,KAAK22B,eAAgB32B,MACtC6H,IAAI,UAAW7H,KAAK42B,YAAa52B,MAE/BA,KAAK+C,QAAQkrB,YAChBjuB,KAAK8kB,KAAKjd,IAAI,QAAS7H,KAAK65B,SAAU75B,MACtCA,KAAK8kB,KAAKjd,IAAI,YAAa7H,KAAK85B,aAAc95B,OAG/CA,KAAK45B,iBAEL55B,KAAK8kB,KAAO,MAGb8U,eAAgB,WACX55B,KAAK8kB,OAASrlB,EAAEo2B,KAAKkE,iBACxBt6B,EAAEo2B,KAAKkE,eAAiBt6B,EAAEQ,KAAK8E,iBAAiB/E,KAAKg6B,gBAAiBh6B,KAAK8kB,QAI7EkV,gBAAiB,WAChBv6B,EAAEo2B,KAAKkE,eAAiB,KACxB/5B,KAAK+H,KAAK,YAGX2uB,cAAe,WACd12B,KAAK8kB,KAAKkT,gBACVh4B,KAAKi6B,KAAOj6B,KAAK8kB,KAAKoV,YAGvBjD,aAAc,WACb,GAAIl0B,GAAU/C,KAAK+C,OAEfA,GAAQkzB,SACXj2B,KAAKi6B,KAAKE,UAAYp3B,EAAQuzB,OAC9Bt2B,KAAKi6B,KAAKG,YAAcr3B,EAAQmzB,OAE7BnzB,EAAQwzB,OACXv2B,KAAKi6B,KAAKI,UAAYt3B,EAAQyzB,WAAazzB,EAAQmzB,QAIrDoE,UAAW,WACV,GAAIl6B,GAAGC,EAAGC,EAAKi6B,EAAMjvB,EAAOkvB,CAI5B,KAFAx6B,KAAKi6B,KAAKQ,YAELr6B,EAAI,EAAGE,EAAMN,KAAK06B,OAAO55B,OAAYR,EAAJF,EAASA,IAAK,CACnD,IAAKC,EAAI,EAAGk6B,EAAOv6B,KAAK06B,OAAOt6B,GAAGU,OAAYy5B,EAAJl6B,EAAUA,IACnDiL,EAAQtL,KAAK06B,OAAOt6B,GAAGC,GACvBm6B,GAAoB,IAANn6B,EAAU,OAAS,QAAU,KAE3CL,KAAKi6B,KAAKO,GAAYlvB,EAAMJ,EAAGI,EAAMH,EAGlCnL,gBAAgBP,GAAEk7B,SACrB36B,KAAKi6B,KAAKW,cAKbC,cAAe,WACd,OAAQ76B,KAAK06B,OAAO55B,QAGrB81B,YAAa,WACZ,IAAI52B,KAAK66B,gBAAT,CAEA,GAAIC,GAAM96B,KAAKi6B,KACdl3B,EAAU/C,KAAK+C,OAEhB/C,MAAKs6B,YACLQ,EAAIC,OACJ/6B,KAAKi3B,eAEDl0B,EAAQwzB,OACXuE,EAAIE,YAAcj4B,EAAQ0zB,YAC1BqE,EAAIvE,QAGDxzB,EAAQkzB,SACX6E,EAAIE,YAAcj4B,EAAQkO,QAC1B6pB,EAAI7E,UAGL6E,EAAIG,YAKLziB,YAAa,WACRxY,KAAK+C,QAAQkrB,YAEhBjuB,KAAK8kB,KAAKld,GAAG,YAAa5H,KAAK85B,aAAc95B,MAC7CA,KAAK8kB,KAAKld,GAAG,QAAS5H,KAAK65B,SAAU75B,QAIvC65B,SAAU,SAAUvoB,GACftR,KAAKk7B,eAAe5pB,EAAEmO,aACzBzf,KAAK+H,KAAK,QAASuJ,IAIrBwoB,aAAc,SAAUxoB,GAClBtR,KAAK8kB,OAAQ9kB,KAAK8kB,KAAKqW,iBAGxBn7B,KAAKk7B,eAAe5pB,EAAEmO,aACzBzf,KAAKi6B,KAAKnO,OAAOjiB,MAAMuxB,OAAS,UAChCp7B,KAAKq7B,cAAe,EACpBr7B,KAAK+H,KAAK,YAAauJ,IAEbtR,KAAKq7B,eACfr7B,KAAKi6B,KAAKnO,OAAOjiB,MAAMuxB,OAAS,GAChCp7B,KAAKq7B,cAAe,EACpBr7B,KAAK+H,KAAK,WAAYuJ,QAKzB7R,EAAEuY,IAAI/R,QAASxG,EAAEo2B,KAAK6B,MAAQr4B,EAAOq6B,kBAAqBj6B,EAAEmL,QAAQkhB,WACnEkM,cAAe,WACd,GACC8C,GADGnD,EAAO33B,KAAK62B,SAGXc,KACJA,EAAO33B,KAAK62B,UAAYv3B,EAASkL,cAAc,UAC/CmtB,EAAK9tB,MAAMiW,SAAW,WACtBgb,EAAM96B,KAAKk6B,WAAavC,EAAK8B,WAAW,MAExCqB,EAAI1E,QAAU,QACd0E,EAAIzE,SAAW,QAEfr2B,KAAKgf,OAAOyB,YAAYrQ,YAAYunB,GAEhC33B,KAAK+C,QAAQ+Y,gBAChB9b,KAAK62B,UAAU3mB,UAAY,wBAC3BlQ,KAAK4H,GAAG,WAAY5H,KAAKq4B,kBACzBr4B,KAAK4H,GAAG,UAAW5H,KAAKs4B,eAEzBt4B,KAAK4H,GAAG,UAAW5H,KAAKs7B,uBACxBt7B,KAAKs7B,0BAIPA,sBAAuB,WAEtB,IAAIt7B,KAAKw4B,aAAT,CACAx4B,KAAKk3B,qBAEL,IAAIuB,GAAKz4B,KAAKq3B,cACb3qB,EAAM+rB,EAAG/rB,IACT0R,EAAOqa,EAAGl0B,IAAIiH,SAASkB,GACvBirB,EAAO33B,KAAK62B,SAGbp3B,GAAEwO,QAAQiE,YAAYylB,EAAMjrB,GAC5BirB,EAAKpoB,MAAQ6O,EAAKlT,EAClBysB,EAAK9N,OAASzL,EAAKjT,EACnBwsB,EAAK8B,WAAW,MAAM8B,WAAW7uB,EAAIxB,GAAIwB,EAAIvB,OAY/C1L,EAAE+7B,UAKDC,SAAU,SAAsBhvB,EAAmBivB,GAClD,IAAKA,IAAcjvB,EAAO3L,OACzB,MAAO2L,GAAO9L,OAGf,IAAIg7B,GAAcD,EAAYA,CAQ9B,OALAjvB,GAASzM,KAAK47B,cAAcnvB,EAAQkvB,GAGpClvB,EAASzM,KAAK67B,YAAYpvB,EAAQkvB,IAMnCG,uBAAyB,SAAoB3E,EAAa4E,EAAcC,GACvE,MAAOz5B,MAAK2J,KAAKlM,KAAKi8B,yBAAyB9E,EAAG4E,EAAIC,GAAI,KAG3DE,sBAAuB,SAAoB/E,EAAa4E,EAAcC,GACrE,MAAOh8B,MAAKi8B,yBAAyB9E,EAAG4E,EAAIC,IAI7CH,YAAa,SAAUpvB,EAAQkvB,GAE9B,GAAIr7B,GAAMmM,EAAO3L,OAChBq7B,QAA0BC,aAAe78B,EAAY,GAAK68B,WAAa37B,MACvE47B,EAAU,GAAIF,GAAiB77B,EAEhC+7B,GAAQ,GAAKA,EAAQ/7B,EAAM,GAAK,EAEhCN,KAAKs8B,gBAAgB7vB,EAAQ4vB,EAASV,EAAa,EAAGr7B,EAAM,EAE5D,IAAIF,GACHm8B,IAED,KAAKn8B,EAAI,EAAOE,EAAJF,EAASA,IAChBi8B,EAAQj8B,IACXm8B,EAAUn5B,KAAKqJ,EAAOrM,GAIxB,OAAOm8B,IAGRD,gBAAiB,SAAU7vB,EAAQ4vB,EAASV,EAAa9D,EAAO2E,GAE/D,GACC/S,GAAOrpB,EAAGq8B,EADPC,EAAY,CAGhB,KAAKt8B,EAAIy3B,EAAQ,EAAQ2E,EAAO,GAAZp8B,EAAeA,IAClCq8B,EAASz8B,KAAKi8B,yBAAyBxvB,EAAOrM,GAAIqM,EAAOorB,GAAQprB,EAAO+vB,IAAO,GAE3EC,EAASC,IACZjT,EAAQrpB,EACRs8B,EAAYD,EAIVC,GAAYf,IACfU,EAAQ5S,GAAS,EAEjBzpB,KAAKs8B,gBAAgB7vB,EAAQ4vB,EAASV,EAAa9D,EAAOpO,GAC1DzpB,KAAKs8B,gBAAgB7vB,EAAQ4vB,EAASV,EAAalS,EAAO+S,KAK5DZ,cAAe,SAAUnvB,EAAQkvB,GAGhC,IAAK,GAFDgB,IAAiBlwB,EAAO,IAEnBrM,EAAI,EAAGw8B,EAAO,EAAGt8B,EAAMmM,EAAO3L,OAAYR,EAAJF,EAASA,IACnDJ,KAAK68B,QAAQpwB,EAAOrM,GAAIqM,EAAOmwB,IAASjB,IAC3CgB,EAAcv5B,KAAKqJ,EAAOrM,IAC1Bw8B,EAAOx8B,EAMT,OAHWE,GAAM,EAAbs8B,GACHD,EAAcv5B,KAAKqJ,EAAOnM,EAAM,IAE1Bq8B,GAMRG,YAAa,SAAUvwB,EAAGC,EAAGO,EAAQgwB,GACpC,GAGCC,GAAS7F,EAAG8F,EAHTC,EAAQH,EAAc/8B,KAAKm9B,UAAYn9B,KAAKo9B,YAAY7wB,EAAGQ,GAC9DswB,EAAQr9B,KAAKo9B,YAAY5wB,EAAGO,EAO7B,KAFA/M,KAAKm9B,UAAYE,IAEJ,CAEZ,KAAMH,EAAQG,GACb,OAAQ9wB,EAAGC,EAEL,IAAI0wB,EAAQG,EAClB,OAAO,CAGPL,GAAUE,GAASG,EACnBlG,EAAIn3B,KAAKs9B,qBAAqB/wB,EAAGC,EAAGwwB,EAASjwB,GAC7CkwB,EAAUj9B,KAAKo9B,YAAYjG,EAAGpqB,GAE1BiwB,IAAYE,GACf3wB,EAAI4qB,EACJ+F,EAAQD,IAERzwB,EAAI2qB,EACJkG,EAAQJ,KAMZK,qBAAsB,SAAU/wB,EAAGC,EAAGoL,EAAM7K,GAC3C,GAAIiW,GAAKxW,EAAEtB,EAAIqB,EAAErB,EAChBgY,EAAK1W,EAAErB,EAAIoB,EAAEpB,EACbuB,EAAMK,EAAOL,IACbnI,EAAMwI,EAAOxI,GAEd,OAAW,GAAPqT,EACI,GAAInY,GAAEwL,MAAMsB,EAAErB,EAAI8X,GAAMze,EAAI4G,EAAIoB,EAAEpB,GAAK+X,EAAI3e,EAAI4G,GACrC,EAAPyM,EACH,GAAInY,GAAEwL,MAAMsB,EAAErB,EAAI8X,GAAMtW,EAAIvB,EAAIoB,EAAEpB,GAAK+X,EAAIxW,EAAIvB,GACrC,EAAPyM,EACH,GAAInY,GAAEwL,MAAM1G,EAAI2G,EAAGqB,EAAEpB,EAAI+X,GAAM3e,EAAI2G,EAAIqB,EAAErB,GAAK8X,GACpC,EAAPpL,EACH,GAAInY,GAAEwL,MAAMyB,EAAIxB,EAAGqB,EAAEpB,EAAI+X,GAAMxW,EAAIxB,EAAIqB,EAAErB,GAAK8X,GAD/C,QAKRoa,YAAa,SAAoBjG,EAAGpqB,GACnC,GAAI6K,GAAO,CAaX,OAXIuf,GAAEjsB,EAAI6B,EAAOL,IAAIxB,EACpB0M,GAAQ,EACEuf,EAAEjsB,EAAI6B,EAAOxI,IAAI2G,IAC3B0M,GAAQ,GAELuf,EAAEhsB,EAAI4B,EAAOL,IAAIvB,EACpByM,GAAQ,EACEuf,EAAEhsB,EAAI4B,EAAOxI,IAAI4G,IAC3ByM,GAAQ,GAGFA,GAIRilB,QAAS,SAAUd,EAAIC,GACtB,GAAIhZ,GAAKgZ,EAAG9wB,EAAI6wB,EAAG7wB,EAClBgY,EAAK8Y,EAAG7wB,EAAI4wB,EAAG5wB,CAChB,OAAO6X,GAAKA,EAAKE,EAAKA,GAIvB+Y,yBAA0B,SAAU9E,EAAG4E,EAAIC,EAAIS,GAC9C,GAKCc,GALGryB,EAAI6wB,EAAG7wB,EACVC,EAAI4wB,EAAG5wB,EACP6X,EAAKgZ,EAAG9wB,EAAIA,EACZgY,EAAK8Y,EAAG7wB,EAAIA,EACZqyB,EAAMxa,EAAKA,EAAKE,EAAKA,CAkBtB,OAfIsa,GAAM,IACTD,IAAMpG,EAAEjsB,EAAIA,GAAK8X,GAAMmU,EAAEhsB,EAAIA,GAAK+X,GAAMsa,EAEpCD,EAAI,GACPryB,EAAI8wB,EAAG9wB,EACPC,EAAI6wB,EAAG7wB,GACGoyB,EAAI,IACdryB,GAAK8X,EAAKua,EACVpyB,GAAK+X,EAAKqa,IAIZva,EAAKmU,EAAEjsB,EAAIA,EACXgY,EAAKiU,EAAEhsB,EAAIA,EAEJsxB,EAASzZ,EAAKA,EAAKE,EAAKA,EAAK,GAAIzjB,GAAEwL,MAAMC,EAAGC,KASrD1L,EAAEg+B,SAAWh+B,EAAEo2B,KAAK31B,QACnBoF,WAAY,SAAUyP,EAAShS,GAC9BtD,EAAEo2B,KAAKn1B,UAAU4E,WAAW1E,KAAKZ,KAAM+C,GAEvC/C,KAAK24B,SAAW34B,KAAK09B,gBAAgB3oB,IAGtChS,SAGC46B,aAAc,EACdC,QAAQ,GAGTjH,eAAgB,WACf32B,KAAK69B,kBAEL,KAAK,GAAIz9B,GAAI,EAAGE,EAAMN,KAAK24B,SAAS73B,OAAYR,EAAJF,EAASA,IACpDJ,KAAK69B,gBAAgBz9B,GAAKJ,KAAK8kB,KAAKzF,mBAAmBrf,KAAK24B,SAASv4B,KAIvE03B,cAAe,WACd,IAAK,GAAI13B,GAAI,EAAGE,EAAMN,KAAK06B,OAAO55B,OAAQ4B,EAAM,GAAQpC,EAAJF,EAASA,IAC5DsC,GAAO1C,KAAK89B,gBAAgB99B,KAAK06B,OAAOt6B,GAEzC,OAAOsC,IAGRq7B,WAAY,WACX,MAAO/9B,MAAK24B,UAGbqF,WAAY,SAAUjpB,GAErB,MADA/U,MAAK24B,SAAW34B,KAAK09B,gBAAgB3oB,GAC9B/U,KAAKwmB,UAGbyX,UAAW,SAAUvnB,GAEpB,MADA1W,MAAK24B,SAASv1B,KAAK3D,EAAEkU,OAAO+C,IACrB1W,KAAKwmB,UAGb0X,cAAe,WACd,GAAI52B,MAAaC,OAAOnG,MAAMpB,KAAK24B,SAAU93B,UAG7C,OAFAb,MAAK09B,gBAAgB19B,KAAK24B,UAAU,GACpC34B,KAAKwmB,SACElf,GAGR62B,kBAAmB,SAAUhH,GAG5B,IAAK,GAF4C4E,GAAIC,EAAjDoC,EAAcngB,EAAAA,EAAUogB,EAAQr+B,KAAK06B,OAAgB4D,EAAW,KAE3Dj+B,EAAI,EAAGk+B,EAAOF,EAAMv9B,OAAYy9B,EAAJl+B,EAAUA,IAE9C,IAAK,GADDoM,GAAS4xB,EAAMh+B,GACVD,EAAI,EAAGE,EAAMmM,EAAO3L,OAAYR,EAAJF,EAASA,IAAK,CAClD27B,EAAKtvB,EAAOrM,EAAI,GAChB47B,EAAKvvB,EAAOrM,EACZ,IAAIq8B,GAASh9B,EAAE+7B,SAASS,yBAAyB9E,EAAG4E,EAAIC,GAAI,EAC/CoC,GAAT3B,IACH2B,EAAc3B,EACd6B,EAAW7+B,EAAE+7B,SAASS,yBAAyB9E,EAAG4E,EAAIC,IAOzD,MAHIsC,KACHA,EAASE,SAAWj8B,KAAK2J,KAAKkyB,IAExBE,GAGRhkB,UAAW,WACV,MAAO,IAAI7a,GAAEmV,aAAa5U,KAAK+9B,eAGhCL,gBAAiB,SAAU3oB,EAAS0pB,GACnC,GAAIr+B,GAAGE,EAAKmH,EAASg3B,EAAY1pB,IAEjC,KAAK3U,EAAI,EAAGE,EAAMyU,EAAQjU,OAAYR,EAAJF,EAASA,IAAK,CAC/C,GAAIX,EAAEQ,KAAK4D,QAAQkR,EAAQ3U,KAAgC,gBAAlB2U,GAAQ3U,GAAG,GACnD,MAEDqH,GAAOrH,GAAKX,EAAEkU,OAAOoB,EAAQ3U,IAE9B,MAAOqH,IAGR+Q,YAAa,WACZ/Y,EAAEo2B,KAAKn1B,UAAU8X,YAAY5X,KAAKZ,OAGnC89B,gBAAiB,SAAUrxB,GAG1B,IAAK,GAA2C0qB,GAF5C30B,EAAQ/C,EAAEo2B,KAAKkD,IAEV14B,EAAI,EAAGk6B,EAAO9tB,EAAO3L,OAAQ4B,EAAM,GAAW63B,EAAJl6B,EAAUA,IAC5D82B,EAAI1qB,EAAOpM,GACPmC,GACH20B,EAAErrB,SAEHpJ,IAAQrC,EAAI,IAAM,KAAO82B,EAAEjsB,EAAI,IAAMisB,EAAEhsB,CAExC,OAAOzI,IAGRg8B,YAAa,WACZ,GAECt+B,GAAGu+B,EAAGC,EAFHnyB,EAASzM,KAAK69B,gBACjBv9B,EAAMmM,EAAO3L,MAGd,IAAId,KAAK+C,QAAQ66B,OAEhB,YADA59B,KAAK06B,QAAUjuB,GAIhBzM,MAAK06B,SAEL,IAAI2D,GAAQr+B,KAAK06B,OAChBjC,EAAKz4B,KAAK8kB,KAAKuS,cACfwH,EAAKp/B,EAAE+7B,QAER,KAAKp7B,EAAI,EAAGu+B,EAAI,EAAOr+B,EAAM,EAAVF,EAAaA,IAC/Bw+B,EAAUC,EAAG/B,YAAYrwB,EAAOrM,GAAIqM,EAAOrM,EAAI,GAAIq4B,EAAIr4B,GAClDw+B,IAILP,EAAMM,GAAKN,EAAMM,OACjBN,EAAMM,GAAGv7B,KAAKw7B,EAAQ,IAGjBA,EAAQ,KAAOnyB,EAAOrM,EAAI,IAAQA,IAAME,EAAM,IAClD+9B,EAAMM,GAAGv7B,KAAKw7B,EAAQ,IACtBD,OAMHG,gBAAiB,WAIhB,IAAK,GAHDT,GAAQr+B,KAAK06B,OAChBmE,EAAKp/B,EAAE+7B,SAECp7B,EAAI,EAAGE,EAAM+9B,EAAMv9B,OAAYR,EAAJF,EAASA,IAC5Ci+B,EAAMj+B,GAAKy+B,EAAGpD,SAAS4C,EAAMj+B,GAAIJ,KAAK+C,QAAQ46B,eAIhD/G,YAAa,WACP52B,KAAK8kB,OAEV9kB,KAAK0+B,cACL1+B,KAAK8+B,kBAELr/B,EAAEo2B,KAAKn1B,UAAUk2B,YAAYh2B,KAAKZ,UAIpCP,EAAEs/B,SAAW,SAAUhqB,EAAShS,GAC/B,MAAO,IAAItD,GAAEg+B,SAAS1oB,EAAShS,IAUhCtD,EAAEu/B,YAMFv/B,EAAEu/B,SAASC,YAAc,SAAUxyB,EAAQM,GAC1C,GAAImyB,GAEH9+B,EAAGC,EAAGs+B,EACNpyB,EAAGC,EACHlM,EAAK6+B,EAAMhI,EAHXiI,GAAS,EAAG,EAAG,EAAG,GAIlBP,EAAKp/B,EAAE+7B,QAER,KAAKp7B,EAAI,EAAGE,EAAMmM,EAAO3L,OAAYR,EAAJF,EAASA,IACzCqM,EAAOrM,GAAGi/B,MAAQR,EAAGzB,YAAY3wB,EAAOrM,GAAI2M,EAI7C,KAAK4xB,EAAI,EAAO,EAAJA,EAAOA,IAAK,CAIvB,IAHAQ,EAAOC,EAAMT,GACbO,KAEK9+B,EAAI,EAAGE,EAAMmM,EAAO3L,OAAQT,EAAIC,EAAM,EAAOA,EAAJF,EAASC,EAAID,IAC1DmM,EAAIE,EAAOrM,GACXoM,EAAIC,EAAOpM,GAGLkM,EAAE8yB,MAAQF,EAUH3yB,EAAE6yB,MAAQF,IACtBhI,EAAI0H,EAAGvB,qBAAqB9wB,EAAGD,EAAG4yB,EAAMpyB,GACxCoqB,EAAEkI,MAAQR,EAAGzB,YAAYjG,EAAGpqB,GAC5BmyB,EAAc97B,KAAK+zB,KAXf3qB,EAAE6yB,MAAQF,IACbhI,EAAI0H,EAAGvB,qBAAqB9wB,EAAGD,EAAG4yB,EAAMpyB,GACxCoqB,EAAEkI,MAAQR,EAAGzB,YAAYjG,EAAGpqB,GAC5BmyB,EAAc97B,KAAK+zB,IAEpB+H,EAAc97B,KAAKmJ,GASrBE,GAASyyB,EAGV,MAAOzyB,IAQRhN,EAAEk7B,QAAUl7B,EAAEg+B,SAASv9B,QACtB6C,SACCwzB,MAAM,GAGPjxB,WAAY,SAAUyP,EAAShS,GAC9BtD,EAAEg+B,SAAS/8B,UAAU4E,WAAW1E,KAAKZ,KAAM+U,EAAShS,GACpD/C,KAAKs/B,eAAevqB,IAGrBuqB,eAAgB,SAAUvqB,GACzB,GAAI3U,GAAGE,EAAKi/B,CACZ,IAAIxqB,GAAWtV,EAAEQ,KAAK4D,QAAQkR,EAAQ,KAAiC,gBAAlBA,GAAQ,GAAG,GAI/D,IAHA/U,KAAK24B,SAAW34B,KAAK09B,gBAAgB3oB,EAAQ,IAC7C/U,KAAKw/B,OAASzqB,EAAQpU,MAAM,GAEvBP,EAAI,EAAGE,EAAMN,KAAKw/B,OAAO1+B,OAAYR,EAAJF,EAASA,IAC9Cm/B,EAAOv/B,KAAKw/B,OAAOp/B,GAAKJ,KAAK09B,gBAAgB19B,KAAKw/B,OAAOp/B,IACrDm/B,EAAK,GAAGpzB,OAAOozB,EAAKA,EAAKz+B,OAAS,KACrCy+B,EAAK7V,KAMR3U,GAAU/U,KAAK24B,SAEX5jB,EAAQjU,QAAU,GAAKiU,EAAQ,GAAG5I,OAAO4I,EAAQA,EAAQjU,OAAS,KACrEiU,EAAQ2U,OAIViN,eAAgB,WAOf,GANAl3B,EAAEg+B,SAAS/8B,UAAUi2B,eAAe/1B,KAAKZ,MAIzCA,KAAKy/B,eAEAz/B,KAAKw/B,OAAV,CAEA,GAAIp/B,GAAGC,EAAGC,EAAKi6B,CAEf,KAAKn6B,EAAI,EAAGE,EAAMN,KAAKw/B,OAAO1+B,OAAYR,EAAJF,EAASA,IAG9C,IAFAJ,KAAKy/B,YAAYr/B,MAEZC,EAAI,EAAGk6B,EAAOv6B,KAAKw/B,OAAOp/B,GAAGU,OAAYy5B,EAAJl6B,EAAUA,IACnDL,KAAKy/B,YAAYr/B,GAAGC,GAAKL,KAAK8kB,KAAKzF,mBAAmBrf,KAAKw/B,OAAOp/B,GAAGC,MAKxE29B,WAAY,SAAUjpB,GACrB,MAAIA,IAAWtV,EAAEQ,KAAK4D,QAAQkR,EAAQ,KAAiC,gBAAlBA,GAAQ,GAAG,IAC/D/U,KAAKs/B,eAAevqB,GACb/U,KAAKwmB,UAEL/mB,EAAEg+B,SAAS/8B,UAAUs9B,WAAWp9B,KAAKZ,KAAM+U,IAIpD2pB,YAAa,WACZ,GAAIjyB,GAASzM,KAAK69B,gBACjB6B,IAID,IAFA1/B,KAAK06B,QAAUjuB,GAAQ9K,OAAO3B,KAAKy/B,cAE/Bz/B,KAAK+C,QAAQ66B,OAAjB,CAEA,IAAK,GAAIx9B,GAAI,EAAGE,EAAMN,KAAK06B,OAAO55B,OAAYR,EAAJF,EAASA,IAAK,CACvD,GAAIu/B,GAAUlgC,EAAEu/B,SAASC,YAAYj/B,KAAK06B,OAAOt6B,GAAIJ,KAAK8kB,KAAKuS,cAC3DsI,GAAQ7+B,QACX4+B,EAASt8B,KAAKu8B,GAIhB3/B,KAAK06B,OAASgF,IAGf5B,gBAAiB,SAAUrxB,GAC1B,GAAI/J,GAAMjD,EAAEg+B,SAAS/8B,UAAUo9B,gBAAgBl9B,KAAKZ,KAAMyM,EAC1D,OAAO/J,IAAOjD,EAAEmL,QAAQ2sB,IAAM,IAAM,QAItC93B,EAAEmgC,QAAU,SAAU7qB,EAAShS,GAC9B,MAAO,IAAItD,GAAEk7B,QAAQ5lB,EAAShS,IAQ9B,WACA,QAAS88B,GAAYC,GAEpB,MAAOrgC,GAAE61B,aAAap1B,QAErBoF,WAAY,SAAUyP,EAAShS,GAC9B/C,KAAK+Y,WACL/Y,KAAK+/B,SAAWh9B,EAChB/C,KAAKg+B,WAAWjpB,IAGjBipB,WAAY,SAAUjpB,GACrB,GAAI3U,GAAI,EACPE,EAAMyU,EAAQjU,MAUf,KARAd,KAAKsc,UAAU,SAAUX,GAChBrb,EAAJF,EACHub,EAAMqiB,WAAWjpB,EAAQ3U,MAEzBJ,KAAKmc,YAAYR,IAEhB3b,MAEQM,EAAJF,GACNJ,KAAK0b,SAAS,GAAIokB,GAAM/qB,EAAQ3U,KAAMJ,KAAK+/B,UAG5C,OAAO//B,OAGR+9B,WAAY,WACX,GAAIhpB,KAMJ,OAJA/U,MAAKsc,UAAU,SAAUX,GACxB5G,EAAQ3R,KAAKuY,EAAMoiB,gBAGbhpB,KAKVtV,EAAEugC,cAAgBH,EAAYpgC,EAAEg+B,UAChCh+B,EAAEwgC,aAAeJ,EAAYpgC,EAAEk7B,SAE/Bl7B,EAAEygC,cAAgB,SAAUnrB,EAAShS,GACpC,MAAO,IAAItD,GAAEugC,cAAcjrB,EAAShS,IAGrCtD,EAAE0gC,aAAe,SAAUprB,EAAShS,GACnC,MAAO,IAAItD,GAAEwgC,aAAalrB,EAAShS,OASrCtD,EAAE2gC,UAAY3gC,EAAEk7B,QAAQz6B,QACvBoF,WAAY,SAAU0P,EAAcjS,GACnCtD,EAAEk7B,QAAQj6B,UAAU4E,WAAW1E,KAAKZ,KAAMA,KAAKqgC,iBAAiBrrB,GAAejS,IAGhFu9B,UAAW,SAAUtrB,GACpBhV,KAAKg+B,WAAWh+B,KAAKqgC,iBAAiBrrB,KAGvCqrB,iBAAkB,SAAUrrB,GAE3B,MADAA,GAAevV,EAAEuV,aAAaA,IAE7BA,EAAaS,eACbT,EAAaW,eACbX,EAAaU,eACbV,EAAac,mBAKhBrW,EAAE8gC,UAAY,SAAUvrB,EAAcjS,GACrC,MAAO,IAAItD,GAAE2gC,UAAUprB,EAAcjS,IAQtCtD,EAAE+gC,OAAS/gC,EAAEo2B,KAAK31B,QACjBoF,WAAY,SAAUoR,EAAQ+pB,EAAQ19B,GACrCtD,EAAEo2B,KAAKn1B,UAAU4E,WAAW1E,KAAKZ,KAAM+C,GAEvC/C,KAAKuuB,QAAU9uB,EAAEkU,OAAO+C,GACxB1W,KAAK0gC,SAAWD,GAGjB19B,SACCwzB,MAAM,GAGP1H,UAAW,SAAUnY,GAEpB,MADA1W,MAAKuuB,QAAU9uB,EAAEkU,OAAO+C,GACjB1W,KAAKwmB,UAGbma,UAAW,SAAUF,GAEpB,MADAzgC,MAAK0gC,SAAWD,EACTzgC,KAAKwmB,UAGbmQ,eAAgB,WACf,GAAIiK,GAAY5gC,KAAK6gC,gBACpBnqB,EAAS1W,KAAKuuB,QACduS,EAAY9gC,KAAK8kB,KAAKzF,oBAAoB3I,EAAOxD,IAAKwD,EAAOvD,IAAMytB,GAEpE5gC,MAAK+gC,OAAS/gC,KAAK8kB,KAAKzF,mBAAmB3I,GAC3C1W,KAAKghC,QAAUz+B,KAAKgC,IAAIvE,KAAK+gC,OAAO71B,EAAI41B,EAAU51B,EAAG,IAGtDoP,UAAW,WACV,GAAIsmB,GAAY5gC,KAAK6gC,gBACpBI,EAAajhC,KAAK0gC,SAAW,SAAY,IACzChqB,EAAS1W,KAAKuuB,OAEf,OAAO,IAAI9uB,GAAEmV,cACX8B,EAAOxD,IAAM+tB,EAAWvqB,EAAOvD,IAAMytB,IACrClqB,EAAOxD,IAAM+tB,EAAWvqB,EAAOvD,IAAMytB,KAGxChS,UAAW,WACV,MAAO5uB,MAAKuuB,SAGbuJ,cAAe,WACd,GAAIX,GAAIn3B,KAAK+gC,OACZtxB,EAAIzP,KAAKghC,OAEV,OAAIhhC,MAAK66B,gBACD,GAGJp7B,EAAEmL,QAAQ2sB,IACN,IAAMJ,EAAEjsB,EAAI,KAAOisB,EAAEhsB,EAAIsE,GAC/B,IAAMA,EAAI,IAAMA,EAAI,WACnB0nB,EAAEjsB,EAAI,IAAO,KAAOisB,EAAEhsB,EAAIsE,GAAK,MAEjC0nB,EAAErrB,SACF2D,EAAIlN,KAAKC,MAAMiN,GACR,MAAQ0nB,EAAEjsB,EAAI,IAAMisB,EAAEhsB,EAAI,IAAMsE,EAAI,IAAMA,EAAI,gBAIvDyxB,UAAW,WACV,MAAOlhC,MAAK0gC,UAKbS,cAAe,WACd,MAAQnhC,MAAK0gC,SAAW,SAAY,KAGrCG,cAAe,WACd,MAAO7gC,MAAKmhC,gBAAkB5+B,KAAKiS,IAAI/U,EAAEwT,OAAOM,WAAavT,KAAKuuB,QAAQrb,MAG3E2nB,cAAe,WACd,IAAK76B,KAAK8kB,KACT,OAAO,CAER,IAAI2T,GAAKz4B,KAAK8kB,KAAKuS,cAClB5nB,EAAIzP,KAAKghC,QACT7J,EAAIn3B,KAAK+gC,MAEV,OAAO5J,GAAEjsB,EAAIuE,EAAIgpB,EAAGl0B,IAAI2G,GAAKisB,EAAEhsB,EAAIsE,EAAIgpB,EAAGl0B,IAAI4G,GAC7CgsB,EAAEjsB,EAAIuE,EAAIgpB,EAAG/rB,IAAIxB,GAAKisB,EAAEhsB,EAAIsE,EAAIgpB,EAAG/rB,IAAIvB,KAI1C1L,EAAE2hC,OAAS,SAAU1qB,EAAQ+pB,EAAQ19B,GACpC,MAAO,IAAItD,GAAE+gC,OAAO9pB,EAAQ+pB,EAAQ19B,IAQrCtD,EAAE4hC,aAAe5hC,EAAE+gC,OAAOtgC,QACzB6C,SACC09B,OAAQ,GACRnK,OAAQ,GAGThxB,WAAY,SAAUoR,EAAQ3T,GAC7BtD,EAAE+gC,OAAO9/B,UAAU4E,WAAW1E,KAAKZ,KAAM0W,EAAQ,KAAM3T,GACvD/C,KAAKghC,QAAUhhC,KAAK+C,QAAQ09B,QAG7B9J,eAAgB,WACf32B,KAAK+gC,OAAS/gC,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,UAGjD0I,aAAe,WACdx3B,EAAE+gC,OAAO9/B,UAAUu2B,aAAar2B,KAAKZ,MACrCA,KAAK2gC,UAAU3gC,KAAK+C,QAAQ09B,SAG7B5R,UAAW,SAAUnY,GAKpB,MAJAjX,GAAE+gC,OAAO9/B,UAAUmuB,UAAUjuB,KAAKZ,KAAM0W,GACpC1W,KAAKgvB,QAAUhvB,KAAKgvB,OAAOsC,SAC9BtxB,KAAKgvB,OAAOH,UAAUnY,GAEhB1W,MAGR2gC,UAAW,SAAUF,GAEpB,MADAzgC,MAAK+C,QAAQ09B,OAASzgC,KAAKghC,QAAUP,EAC9BzgC,KAAKwmB,UAGb0a,UAAW,WACV,MAAOlhC,MAAKghC,WAIdvhC,EAAE6hC,aAAe,SAAU5qB,EAAQ3T,GAClC,MAAO,IAAItD,GAAE4hC,aAAa3qB,EAAQ3T,IAQnCtD,EAAEg+B,SAASx3B,QAASxG,EAAEo2B,KAAK8D,QAC1BuB,eAAgB,SAAU/D,EAAGoK,GAC5B,GAAInhC,GAAGC,EAAGs+B,EAAGr+B,EAAKi6B,EAAMiH,EAAMC,EAC7BC,EAAI1hC,KAAK+C,QAAQuzB,OAAS,CAM3B,KAJI72B,EAAEmL,QAAQR,QACbs3B,GAAK,IAGDthC,EAAI,EAAGE,EAAMN,KAAK06B,OAAO55B,OAAYR,EAAJF,EAASA,IAE9C,IADAqhC,EAAOzhC,KAAK06B,OAAOt6B,GACdC,EAAI,EAAGk6B,EAAOkH,EAAK3gC,OAAQ69B,EAAIpE,EAAO,EAAOA,EAAJl6B,EAAUs+B,EAAIt+B,IAC3D,IAAKkhC,GAAiB,IAANlhC,KAIhBmhC,EAAO/hC,EAAE+7B,SAASM,uBAAuB3E,EAAGsK,EAAK9C,GAAI8C,EAAKphC,IAE9CqhC,GAARF,GACH,OAAO,CAIV,QAAO,QAST/hC,EAAEk7B,QAAQ10B,QAASxG,EAAEo2B,KAAK8D,QACzBuB,eAAgB,SAAU/D,GACzB,GACCsK,GAAM1F,EAAIC,EACV57B,EAAGC,EAAGs+B,EACNr+B,EAAKi6B,EAHFrc,GAAS,CAOb,IAAIze,EAAEg+B,SAAS/8B,UAAUw6B,eAAet6B,KAAKZ,KAAMm3B,GAAG,GAErD,OAAO,CAKR,KAAK/2B,EAAI,EAAGE,EAAMN,KAAK06B,OAAO55B,OAAYR,EAAJF,EAASA,IAG9C,IAFAqhC,EAAOzhC,KAAK06B,OAAOt6B,GAEdC,EAAI,EAAGk6B,EAAOkH,EAAK3gC,OAAQ69B,EAAIpE,EAAO,EAAOA,EAAJl6B,EAAUs+B,EAAIt+B,IAC3D07B,EAAK0F,EAAKphC,GACV27B,EAAKyF,EAAK9C,GAEJ5C,EAAG5wB,EAAIgsB,EAAEhsB,GAAQ6wB,EAAG7wB,EAAIgsB,EAAEhsB,GAC9BgsB,EAAEjsB,GAAK8wB,EAAG9wB,EAAI6wB,EAAG7wB,IAAMisB,EAAEhsB,EAAI4wB,EAAG5wB,IAAM6wB,EAAG7wB,EAAI4wB,EAAG5wB,GAAK4wB,EAAG7wB,IACzDgT,GAAUA,EAKb,OAAOA,SASTze,EAAE+gC,OAAOv6B,QAASxG,EAAEo2B,KAAK8D,QACxBW,UAAW,WACV,GAAInD,GAAIn3B,KAAK+gC,MACb/gC,MAAKi6B,KAAKQ,YACVz6B,KAAKi6B,KAAK0H,IAAIxK,EAAEjsB,EAAGisB,EAAEhsB,EAAGnL,KAAKghC,QAAS,EAAa,EAAVz+B,KAAKiR,IAAQ,IAGvD0nB,eAAgB,SAAU/D,GACzB,GAAIxe,GAAS3Y,KAAK+gC,OACjBa,EAAK5hC,KAAK+C,QAAQkzB,OAASj2B,KAAK+C,QAAQuzB,OAAS,EAAI,CAEtD,OAAQa,GAAElrB,WAAW0M,IAAW3Y,KAAKghC,QAAUY,QASjDniC,EAAE4hC,aAAap7B,QAASxG,EAAEo2B,KAAK8D,QAC9B1C,aAAc,WACbx3B,EAAEo2B,KAAKn1B,UAAUu2B,aAAar2B,KAAKZ,YASrCP,EAAEoiC,QAAUpiC,EAAE61B,aAAap1B,QAE1BoF,WAAY,SAAUw8B,EAAS/+B,GAC9BtD,EAAEqD,WAAW9C,KAAM+C,GAEnB/C,KAAK+Y,WAED+oB,GACH9hC,KAAK+hC,QAAQD,IAIfC,QAAS,SAAUD,GAClB,GACC1hC,GAAGE,EAAK0hC,EADLC,EAAWxiC,EAAEQ,KAAK4D,QAAQi+B,GAAWA,EAAUA,EAAQG,QAG3D,IAAIA,EAAU,CACb,IAAK7hC,EAAI,EAAGE,EAAM2hC,EAASnhC,OAAYR,EAAJF,EAASA,IAE3C4hC,EAAUC,EAAS7hC,IACf4hC,EAAQE,YAAcF,EAAQG,UAAYH,EAAQC,UAAYD,EAAQI,cACzEpiC,KAAK+hC,QAAQE,EAAS7hC,GAGxB,OAAOJ,MAGR,GAAI+C,GAAU/C,KAAK+C,OAEnB,KAAIA,EAAQmO,QAAWnO,EAAQmO,OAAO4wB,GAAtC,CAEA,GAAInmB,GAAQlc,EAAEoiC,QAAQQ,gBAAgBP,EAAS/+B,EAAQu/B,aAAcv/B,EAAQw/B,eAAgBx/B,EAU7F,OATA4Y,GAAMqmB,QAAUviC,EAAEoiC,QAAQW,UAAUV,GAEpCnmB,EAAM8mB,eAAiB9mB,EAAM5Y,QAC7B/C,KAAK0iC,WAAW/mB,GAEZ5Y,EAAQ4/B,eACX5/B,EAAQ4/B,cAAcb,EAASnmB,GAGzB3b,KAAK0b,SAASC,KAGtB+mB,WAAY,SAAU/mB,GACrB,GAAI9R,GAAQ7J,KAAK+C,QAAQ8G,KACrBA,KAEHpK,EAAEQ,KAAKC,OAAOyb,EAAM5Y,QAAS4Y,EAAM8mB,gBAEnCziC,KAAK4iC,eAAejnB,EAAO9R,KAI7B8rB,SAAU,SAAU9rB,GACnB7J,KAAKsc,UAAU,SAAUX,GACxB3b,KAAK4iC,eAAejnB,EAAO9R,IACzB7J,OAGJ4iC,eAAgB,SAAUjnB,EAAO9R,GACX,kBAAVA,KACVA,EAAQA,EAAM8R,EAAMqmB,UAEjBrmB,EAAMga,UACTha,EAAMga,SAAS9rB,MAKlBpK,EAAES,OAAOT,EAAEoiC,SACVQ,gBAAiB,SAAUP,EAASQ,EAAcC,EAAgBM,GACjE,GAGCnsB,GAAQ3B,EAAS3U,EAAGE,EAHjB6hC,EAA4B,YAAjBL,EAAQn7B,KAAqBm7B,EAAQK,SAAWL,EAC9DgB,EAASX,EAASC,YAClBjpB,IAKD,QAFAopB,EAAiBA,GAAkBviC,KAAKuiC,eAEhCJ,EAASx7B,MAChB,IAAK,QAEJ,MADA+P,GAAS6rB,EAAeO,GACjBR,EAAeA,EAAaR,EAASprB,GAAU,GAAIjX,GAAEsuB,OAAOrX,EAEpE,KAAK,aACJ,IAAKtW,EAAI,EAAGE,EAAMwiC,EAAOhiC,OAAYR,EAAJF,EAASA,IACzCsW,EAAS6rB,EAAeO,EAAO1iC,IAC/B+Y,EAAO/V,KAAKk/B,EAAeA,EAAaR,EAASprB,GAAU,GAAIjX,GAAEsuB,OAAOrX,GAEzE,OAAO,IAAIjX,GAAE61B,aAAanc,EAE3B,KAAK,aAEJ,MADApE,GAAU/U,KAAK+iC,gBAAgBD,EAAQ,EAAGP,GACnC,GAAI9iC,GAAEg+B,SAAS1oB,EAAS8tB,EAEhC,KAAK,UACJ,GAAsB,IAAlBC,EAAOhiC,SAAiBgiC,EAAO,GAAGhiC,OACrC,KAAM,IAAI8C,OAAM,0BAGjB,OADAmR,GAAU/U,KAAK+iC,gBAAgBD,EAAQ,EAAGP,GACnC,GAAI9iC,GAAEk7B,QAAQ5lB,EAAS8tB,EAE/B,KAAK,kBAEJ,MADA9tB,GAAU/U,KAAK+iC,gBAAgBD,EAAQ,EAAGP,GACnC,GAAI9iC,GAAEugC,cAAcjrB,EAAS8tB,EAErC,KAAK,eAEJ,MADA9tB,GAAU/U,KAAK+iC,gBAAgBD,EAAQ,EAAGP,GACnC,GAAI9iC,GAAEwgC,aAAalrB,EAAS8tB,EAEpC,KAAK,qBACJ,IAAKziC,EAAI,EAAGE,EAAM6hC,EAASD,WAAWphC,OAAYR,EAAJF,EAASA,IAEtD+Y,EAAO/V,KAAKpD,KAAKqiC,iBAChBF,SAAUA,EAASD,WAAW9hC,GAC9BuG,KAAM,UACNq8B,WAAYlB,EAAQkB,YAClBV,EAAcC,EAAgBM,GAElC,OAAO,IAAIpjC,GAAE61B,aAAanc,EAE3B,SACC,KAAM,IAAIvV,OAAM,6BAInB2+B,eAAgB,SAAUO,GACzB,MAAO,IAAIrjC,GAAEwT,OAAO6vB,EAAO,GAAIA,EAAO,GAAIA,EAAO,KAGlDC,gBAAiB,SAAUD,EAAQG,EAAYV,GAC9C,GAAI7rB,GAAQtW,EAAGE,EACdyU,IAED,KAAK3U,EAAI,EAAGE,EAAMwiC,EAAOhiC,OAAYR,EAAJF,EAASA,IACzCsW,EAASusB,EACRjjC,KAAK+iC,gBAAgBD,EAAO1iC,GAAI6iC,EAAa,EAAGV,IAC/CA,GAAkBviC,KAAKuiC,gBAAgBO,EAAO1iC,IAEhD2U,EAAQ3R,KAAKsT,EAGd,OAAO3B,IAGRmuB,eAAgB,SAAUxsB,GACzB,GAAIosB,IAAUpsB,EAAOvD,IAAKuD,EAAOxD,IAKjC,OAHIwD,GAAOtD,MAAQ7T,GAClBujC,EAAO1/B,KAAKsT,EAAOtD,KAEb0vB,GAGRK,gBAAiB,SAAUC,GAG1B,IAAK,GAFDN,MAEK1iC,EAAI,EAAGE,EAAM8iC,EAAQtiC,OAAYR,EAAJF,EAASA,IAC9C0iC,EAAO1/B,KAAK3D,EAAEoiC,QAAQqB,eAAeE,EAAQhjC,IAG9C,OAAO0iC,IAGRO,WAAY,SAAU1nB,EAAO2nB,GAC5B,MAAO3nB,GAAMqmB,QAAUviC,EAAES,UAAWyb,EAAMqmB,SAAUG,SAAUmB,IAAgB7jC,EAAEoiC,QAAQW,UAAUc,IAGnGd,UAAW,SAAUe,GACpB,MAAqB,YAAjBA,EAAQ58B,KACJ48B,GAIP58B,KAAM,UACNq8B,cACAb,SAAUoB,KAKb,IAAIC,IACHC,UAAW,WACV,MAAOhkC,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAM,QACNy7B,YAAa3iC,EAAEoiC,QAAQqB,eAAeljC,KAAK4uB,gBAK9CnvB,GAAEsuB,OAAO9nB,QAAQu9B,GACjB/jC,EAAE+gC,OAAOv6B,QAAQu9B,GACjB/jC,EAAE4hC,aAAap7B,QAAQu9B,GAEvB/jC,EAAEg+B,SAASx3B,SACVw9B,UAAW,WACV,MAAOhkC,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAM,aACNy7B,YAAa3iC,EAAEoiC,QAAQsB,gBAAgBnjC,KAAK+9B,mBAK/Ct+B,EAAEk7B,QAAQ10B,SACTw9B,UAAW,WACV,GACCrjC,GAAGE,EAAKi/B,EADLuD,GAAUrjC,EAAEoiC,QAAQsB,gBAAgBnjC,KAAK+9B,cAK7C,IAFA+E,EAAO,GAAG1/B,KAAK0/B,EAAO,GAAG,IAErB9iC,KAAKw/B,OACR,IAAKp/B,EAAI,EAAGE,EAAMN,KAAKw/B,OAAO1+B,OAAYR,EAAJF,EAASA,IAC9Cm/B,EAAO9/B,EAAEoiC,QAAQsB,gBAAgBnjC,KAAKw/B,OAAOp/B,IAC7Cm/B,EAAKn8B,KAAKm8B,EAAK,IACfuD,EAAO1/B,KAAKm8B,EAId,OAAO9/B,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAM,UACNy7B,YAAaU,OAKf,WACA,QAASY,GAAe/8B,GACvB,MAAO,YACN,GAAIm8B,KAMJ,OAJA9iC,MAAKsc,UAAU,SAAUX,GACxBmnB,EAAO1/B,KAAKuY,EAAM8nB,YAAYtB,SAASC,eAGjC3iC,EAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAMA,EACNy7B,YAAaU,KAKhBrjC,EAAEugC,cAAc/5B,SAASw9B,UAAWC,EAAe,qBACnDjkC,EAAEwgC,aAAah6B,SAASw9B,UAAWC,EAAe,kBAElDjkC,EAAEq1B,WAAW7uB,SACZw9B,UAAW,WAEV,GAECE,GAFGxB,EAAWniC,KAAKgiC,SAAWhiC,KAAKgiC,QAAQG,SAC3CyB,IAGD,IAAIzB,GAA8B,eAAlBA,EAASx7B,KACxB,MAAO+8B,GAAe,cAAc9iC,KAAKZ,KAG1C,IAAI6jC,GAAuB1B,GAA8B,uBAAlBA,EAASx7B,IAShD,OAPA3G,MAAKsc,UAAU,SAAUX,GACpBA,EAAM8nB,YACTE,EAAOhoB,EAAM8nB,YACbG,EAAMxgC,KAAKygC,EAAuBF,EAAKxB,SAAW1iC,EAAEoiC,QAAQW,UAAUmB,OAIpEE,EACIpkC,EAAEoiC,QAAQwB,WAAWrjC,MAC3BkiC,WAAY0B,EACZj9B,KAAM,wBAKPA,KAAM,oBACNs7B,SAAU2B,SAMdnkC,EAAEqkC,QAAU,SAAUhC,EAAS/+B,GAC9B,MAAO,IAAItD,GAAEoiC,QAAQC,EAAS/+B,IAQ/BtD,EAAEiT,UAEDqxB,YAAa,SAAU7iC,EAAKyF,EAAM1F,EAAIS,GAErC,GAECiG,GAASq8B,EAAiBC,EAFvBp/B,EAAKpF,EAAE4B,MAAMJ,GAChBM,EAAM,YAAcoF,EAAO9B,CAG5B,OAAI3D,GAAIK,GAAevB,MAEvB2H,EAAU,SAAU2J,GACnB,MAAOrQ,GAAGL,KAAKc,GAAWR,EAAKoQ,GAAK7R,EAAEiT,SAASwxB,cAG5CzkC,EAAEmL,QAAQzB,SAAqC,IAA1BxC,EAAKpD,QAAQ,SAC9BvD,KAAKmkC,mBAAmBjjC,EAAKyF,EAAMgB,EAAS9C,IAEhDpF,EAAEmL,QAAQR,OAAmB,aAATzD,GAAwB3G,KAAKokC,sBACpDpkC,KAAKokC,qBAAqBljC,EAAKyG,EAAS9C,GAGrC,oBAAsB3D,GAEZ,eAATyF,GACHzF,EAAIsF,iBAAiB,iBAAkBmB,GAAS,GAChDzG,EAAIsF,iBAAiBG,EAAMgB,GAAS,IAEhB,eAAThB,GAAoC,eAATA,GAEtCq9B,EAAkBr8B,EAClBs8B,EAAoB,eAATt9B,EAAwB,YAAc,WAEjDgB,EAAU,SAAU2J,GACnB,MAAK7R,GAAEiT,SAAS2xB,YAAYnjC,EAAKoQ,GAC1B0yB,EAAgB1yB,GADvB,QAIDpQ,EAAIsF,iBAAiBy9B,EAASt8B,GAAS,IAEpB,UAAThB,GAAoBlH,EAAEmL,QAAQnC,SACxCu7B,EAAkBr8B,EAClBA,EAAU,SAAU2J,GACnB,MAAO7R,GAAEiT,SAAS4xB,aAAahzB,EAAG0yB,IAGnC9iC,EAAIsF,iBAAiBG,EAAMgB,GAAS,IAEpCzG,EAAIsF,iBAAiBG,EAAMgB,GAAS,GAG3B,eAAiBzG,IAC3BA,EAAIqjC,YAAY,KAAO59B,EAAMgB,GAG9BzG,EAAIK,GAAOoG,EAEJ3H,QAGRwkC,eAAgB,SAAUtjC,EAAKyF,EAAM1F,GAEpC,GAAI4D,GAAKpF,EAAE4B,MAAMJ,GAChBM,EAAM,YAAcoF,EAAO9B,EAC3B8C,EAAUzG,EAAIK,EAEf,OAAKoG,IAEDlI,EAAEmL,QAAQzB,SAAqC,IAA1BxC,EAAKpD,QAAQ,SACrCvD,KAAKykC,sBAAsBvjC,EAAKyF,EAAM9B,GAC5BpF,EAAEmL,QAAQR,OAAmB,aAATzD,GAAwB3G,KAAK0kC,wBAC3D1kC,KAAK0kC,wBAAwBxjC,EAAK2D,GAExB,uBAAyB3D,GAEtB,eAATyF,GACHzF,EAAIiG,oBAAoB,iBAAkBQ,GAAS,GACnDzG,EAAIiG,oBAAoBR,EAAMgB,GAAS,IAEnB,eAAThB,GAAoC,eAATA,EACtCzF,EAAIiG,oBAA8B,eAATR,EAAwB,YAAc,WAAagB,GAAS,GAErFzG,EAAIiG,oBAAoBR,EAAMgB,GAAS,GAE9B,eAAiBzG,IAC3BA,EAAIyjC,YAAY,KAAOh+B,EAAMgB,GAG9BzG,EAAIK,GAAO,KAEJvB,MAxBgBA,MA2BxBowB,gBAAiB,SAAU9e,GAS1B,MAPIA,GAAE8e,gBACL9e,EAAE8e,kBAEF9e,EAAEszB,cAAe,EAElBnlC,EAAEiT,SAASoP,SAASxQ,GAEbtR,MAGRozB,yBAA0B,SAAU/kB,GACnC,GAAIkmB,GAAO90B,EAAEiT,SAAS0d,eAEtB,OAAO3wB,GAAEiT,SACP9K,GAAGyG,EAAI,aAAckmB,GACrB3sB,GAAGyG,EAAI,sBAAuBkmB,IAGjCxB,wBAAyB,SAAU1kB,GAGlC,IAAK,GAFDkmB,GAAO90B,EAAEiT,SAAS0d,gBAEbhwB,EAAIX,EAAEolC,UAAUC,MAAMhkC,OAAS,EAAGV,GAAK,EAAGA,IAClDX,EAAEiT,SAAS9K,GAAGyG,EAAI5O,EAAEolC,UAAUC,MAAM1kC,GAAIm0B,EAGzC,OAAO90B,GAAEiT,SACP9K,GAAGyG,EAAI,QAAS5O,EAAEiT,SAASqyB,WAC3Bn9B,GAAGyG,EAAI,WAAYkmB,IAGtB5hB,eAAgB,SAAUrB,GAOzB,MALIA,GAAEqB,eACLrB,EAAEqB,iBAEFrB,EAAE0zB,aAAc,EAEVhlC,MAGRu0B,KAAM,SAAUjjB,GACf,MAAO7R,GAAEiT,SACPC,eAAerB,GACf8e,gBAAgB9e,IAGnBqO,iBAAkB,SAAUrO,EAAGnB,GAC9B,IAAKA,EACJ,MAAO,IAAI1Q,GAAEwL,MAAMqG,EAAE2zB,QAAS3zB,EAAE4zB,QAGjC,IAAIC,GAAOh1B,EAAUT,uBAErB,OAAO,IAAIjQ,GAAEwL,MACZqG,EAAE2zB,QAAUE,EAAKt2B,KAAOsB,EAAUR,WAClC2B,EAAE4zB,QAAUC,EAAKv2B,IAAMuB,EAAUi1B,YAGnCC,cAAe,SAAU/zB,GAExB,GAAIqI,GAAQ,CAQZ,OANIrI,GAAEg0B,aACL3rB,EAAQrI,EAAEg0B,WAAa,KAEpBh0B,EAAEi0B,SACL5rB,GAASrI,EAAEi0B,OAAS,GAEd5rB,GAGR6rB,eAEAT,UAAW,SAAUzzB,GAEpB7R,EAAEiT,SAAS8yB,YAAYl0B,EAAE3K,OAAQ,GAGlCmb,SAAU,SAAUxQ,GACnB,GAAIm0B,GAAUzlC,KAAKwlC,YAAYl0B,EAAE3K,KAGjC,OADA3G,MAAKwlC,YAAYl0B,EAAE3K,OAAQ,EACpB8+B,GAIRpB,YAAa,SAAUh2B,EAAIiD,GAE1B,GAAIo0B,GAAUp0B,EAAEq0B,aAEhB,KAAKD,EAAW,OAAO,CAEvB,KACC,KAAOA,GAAYA,IAAYr3B,GAC9Bq3B,EAAUA,EAAQ91B,WAElB,MAAOg2B,GACR,OAAO,EAER,MAAQF,KAAYr3B,GAGrB61B,UAAW,WAEV,GAAI5yB,GAAIjS,EAAOqH,KACf,KAAK4K,EAEJ,IADA,GAAIu0B,GAAShlC,UAAUilC,OAAOD,OACvBA,IACNv0B,EAAIu0B,EAAkB,UAAE,IACpBv0B,GAAKjS,EAAO0mC,QAAUz0B,EAAE3L,cAG5BkgC,EAASA,EAAOA,MAGlB,OAAOv0B,IAIRgzB,aAAc,SAAUhzB,EAAG3J,GAC1B,GAAIq+B,GAAa10B,EAAE00B,WAAa10B,EAAEyQ,cAAcikB,UAC/CC,EAAUxmC,EAAEiT,SAASwzB,YAAeF,EAAYvmC,EAAEiT,SAASwzB,UAO5D,OAAKD,IAAWA,EAAU,KAAiB,IAAVA,GAAoB30B,EAAE7J,OAAO0+B,kBAAoB70B,EAAEoQ,eACnFjiB,GAAEiT,SAAS6hB,KAAKjjB,IAGjB7R,EAAEiT,SAASwzB,WAAaF,EAEjBr+B,EAAQ2J,MAIjB7R,EAAEiT,SAAS9K,GAAKnI,EAAEiT,SAASqxB,YAC3BtkC,EAAEiT,SAAS7K,IAAMpI,EAAEiT,SAAS8xB,eAO5B/kC,EAAEolC,UAAYplC,EAAE0F,MAAMjF,QACrB2F,SAAUpG,EAAE6G,MAAMC,OAElBX,SACCk/B,MAAOrlC,EAAEmL,QAAQR,OAAS,aAAc,cAAgB,aACxDg8B,KACCC,UAAW,UACXC,WAAY,WACZC,YAAa,WACbC,cAAe,YAEhBC,MACCJ,UAAW,YACXC,WAAY,YACZC,YAAa,YACbC,cAAe,cAIjBlhC,WAAY,SAAUL,EAASyhC,GAC9B1mC,KAAK2mC,SAAW1hC,EAChBjF,KAAK4mC,iBAAmBF,GAAmBzhC,GAG5CiY,OAAQ,WACP,IAAIld,KAAKqwB,SAAT,CAEA,IAAK,GAAIjwB,GAAIX,EAAEolC,UAAUC,MAAMhkC,OAAS,EAAGV,GAAK,EAAGA,IAClDX,EAAEiT,SAAS9K,GAAG5H,KAAK4mC,iBAAkBnnC,EAAEolC,UAAUC,MAAM1kC,GAAIJ,KAAK6mC,QAAS7mC,KAG1EA,MAAKqwB,UAAW,IAGjBrO,QAAS,WACR,GAAKhiB,KAAKqwB,SAAV,CAEA,IAAK,GAAIjwB,GAAIX,EAAEolC,UAAUC,MAAMhkC,OAAS,EAAGV,GAAK,EAAGA,IAClDX,EAAEiT,SAAS7K,IAAI7H,KAAK4mC,iBAAkBnnC,EAAEolC,UAAUC,MAAM1kC,GAAIJ,KAAK6mC,QAAS7mC,KAG3EA,MAAKqwB,UAAW,EAChBrwB,KAAKyd,QAAS,IAGfopB,QAAS,SAAUv1B,GAGlB,GAFAtR,KAAKyd,QAAS,GAEVnM,EAAEw1B,WAA0B,IAAZx1B,EAAEy1B,OAA8B,IAAbz1B,EAAE01B,QAAkB11B,EAAE21B,WAE7DxnC,EAAEiT,SAAS0d,gBAAgB9e,IAEvB7R,EAAEolC,UAAUqC,YAEhBznC,EAAEwO,QAAQ8E,mBACVtT,EAAEwO,QAAQwE,wBAENzS,KAAKmnC,UAAT,CAEA,GAAItP,GAAQvmB,EAAE21B,QAAU31B,EAAE21B,QAAQ,GAAK31B,CAEvCtR,MAAKonC,YAAc,GAAI3nC,GAAEwL,MAAM4sB,EAAMoN,QAASpN,EAAMqN,SACpDllC,KAAKqnC,UAAYrnC,KAAKsnC,QAAU7nC,EAAEwO,QAAQqE,YAAYtS,KAAK2mC,UAE3DlnC,EAAEiT,SACA9K,GAAGtI,EAAUG,EAAEolC,UAAU4B,KAAKn1B,EAAE3K,MAAO3G,KAAKunC,QAASvnC,MACrD4H,GAAGtI,EAAUG,EAAEolC,UAAUuB,IAAI90B,EAAE3K,MAAO3G,KAAKwnC,MAAOxnC,QAGrDunC,QAAS,SAAUj2B,GAClB,GAAIA,EAAE21B,SAAW31B,EAAE21B,QAAQnmC,OAAS,EAEnC,YADAd,KAAKyd,QAAS,EAIf,IAAIoa,GAASvmB,EAAE21B,SAAgC,IAArB31B,EAAE21B,QAAQnmC,OAAewQ,EAAE21B,QAAQ,GAAK31B,EACjEm2B,EAAW,GAAIhoC,GAAEwL,MAAM4sB,EAAMoN,QAASpN,EAAMqN,SAC5C7pB,EAASosB,EAASj8B,SAASxL,KAAKonC,cAE5B/rB,EAAOnQ,GAAMmQ,EAAOlQ,KAEzB1L,EAAEiT,SAASC,eAAerB,GAErBtR,KAAKyd,SACTzd,KAAK+H,KAAK,aAEV/H,KAAKyd,QAAS,EACdzd,KAAKqnC,UAAY5nC,EAAEwO,QAAQqE,YAAYtS,KAAK2mC,UAAUn7B,SAAS6P,GAE/D5b,EAAEwO,QAAQyC,SAASpR,EAASyP,KAAM,oBAClCtP,EAAEwO,QAAQyC,SAAUY,EAAE7J,QAAU6J,EAAEo2B,WAAa,wBAGhD1nC,KAAKsnC,QAAUtnC,KAAKqnC,UAAUh8B,IAAIgQ,GAClCrb,KAAKmnC,SAAU,EAEf1nC,EAAEQ,KAAKiF,gBAAgBlF,KAAK2nC,cAC5B3nC,KAAK2nC,aAAeloC,EAAEQ,KAAK8E,iBAAiB/E,KAAK6xB,gBAAiB7xB,MAAM,EAAMA,KAAK4mC,oBAGpF/U,gBAAiB,WAChB7xB,KAAK+H,KAAK,WACVtI,EAAEwO,QAAQiE,YAAYlS,KAAK2mC,SAAU3mC,KAAKsnC,SAC1CtnC,KAAK+H,KAAK,SAGXy/B,MAAO,SAAUl2B,GAChB7R,EAAEwO,QAAQ4C,YAAYvR,EAASyP,KAAM,oBACrCtP,EAAEwO,QAAQ4C,YAAaS,EAAE7J,QAAU6J,EAAEo2B,WAAa,sBAElD,KAAK,GAAItnC,KAAKX,GAAEolC,UAAU4B,KACzBhnC,EAAEiT,SACA7K,IAAIvI,EAAUG,EAAEolC,UAAU4B,KAAKrmC,GAAIJ,KAAKunC,SACxC1/B,IAAIvI,EAAUG,EAAEolC,UAAUuB,IAAIhmC,GAAIJ,KAAKwnC,MAG1C/nC,GAAEwO,QAAQ+E,kBACVvT,EAAEwO,QAAQ2E,sBAEN5S,KAAKyd,QAAUzd,KAAKmnC,UAEvB1nC,EAAEQ,KAAKiF,gBAAgBlF,KAAK2nC,cAE5B3nC,KAAK+H,KAAK,WACTy2B,SAAUx+B,KAAKsnC,QAAQr7B,WAAWjM,KAAKqnC,cAIzCrnC,KAAKmnC,SAAU,KAUjB1nC,EAAEwwB,QAAUxwB,EAAE0F,MAAMjF,QACnBoF,WAAY,SAAU+d,GACrBrjB,KAAK8kB,KAAOzB,GAGbnG,OAAQ,WACHld,KAAKqwB,WAETrwB,KAAKqwB,UAAW,EAChBrwB,KAAK4nC,aAGN5lB,QAAS,WACHhiB,KAAKqwB,WAEVrwB,KAAKqwB,UAAW,EAChBrwB,KAAK6nC,gBAGNC,QAAS,WACR,QAAS9nC,KAAKqwB,YAShB5wB,EAAEuY,IAAI9R,cACLyb,UAAU,EAEVomB,SAAUtoC,EAAEmL,QAAQlC,UACpBs/B,oBAAqB,KACrBC,gBAAiBhqB,EAAAA,EACjBiqB,iBAAkBzoC,EAAEmL,QAAQR,MAAQ,GAAK,GACzC+9B,cAAe,IAGfC,eAAe,IAGhB3oC,EAAEuY,IAAIqwB,KAAO5oC,EAAEwwB,QAAQ/vB,QACtB0nC,SAAU,WACT,IAAK5nC,KAAKsoC,WAAY,CACrB,GAAIjlB,GAAMrjB,KAAK8kB,IAEf9kB,MAAKsoC,WAAa,GAAI7oC,GAAEolC,UAAUxhB,EAAInD,SAAUmD,EAAIlG,YAEpDnd,KAAKsoC,WAAW1gC,IACf2gC,UAAavoC,KAAKwoC,aAClBC,KAAQzoC,KAAK0oC,QACbC,QAAW3oC,KAAK4oC,YACd5oC,MAECqjB,EAAItgB,QAAQqlC,gBACfpoC,KAAKsoC,WAAW1gC,GAAG,UAAW5H,KAAK6oC,WAAY7oC,MAC/CqjB,EAAIzb,GAAG,YAAa5H,KAAK8oC,aAAc9oC,MAEvCqjB,EAAIpB,UAAUjiB,KAAK8oC,aAAc9oC,OAGnCA,KAAKsoC,WAAWprB,UAGjB2qB,YAAa,WACZ7nC,KAAKsoC,WAAWtmB,WAGjBJ,MAAO,WACN,MAAO5hB,MAAKsoC,YAActoC,KAAKsoC,WAAW7qB,QAG3C+qB,aAAc,WACb,GAAInlB,GAAMrjB,KAAK8kB,IAEXzB,GAAI0lB,UACP1lB,EAAI0lB,SAASxU,OAGdlR,EACEtb,KAAK,aACLA,KAAK,aAEHsb,EAAItgB,QAAQglC,UACf/nC,KAAKgpC,cACLhpC,KAAKipC,YAIPP,QAAS,WACR,GAAI1oC,KAAK8kB,KAAK/hB,QAAQglC,QAAS,CAC9B,GAAIlmC,GAAO7B,KAAKkpC,WAAa,GAAI7kC,MAChCsK,EAAM3O,KAAKmpC,SAAWnpC,KAAKsoC,WAAWhB,OAEvCtnC,MAAKgpC,WAAW5lC,KAAKuL,GACrB3O,KAAKipC,OAAO7lC,KAAKvB,GAEbA,EAAO7B,KAAKipC,OAAO,GAAK,MAC3BjpC,KAAKgpC,WAAWI,QAChBppC,KAAKipC,OAAOG,SAIdppC,KAAK8kB,KACH/c,KAAK,QACLA,KAAK,SAGR+gC,aAAc,WAEb,GAAIO,GAAWrpC,KAAK8kB,KAAKhY,UAAUnB,UAAU,GAC5C29B,EAAgBtpC,KAAK8kB,KAAKzF,oBAAoB,EAAG,GAElDrf,MAAKupC,oBAAsBD,EAAc99B,SAAS69B,GAAUn+B,EAC5DlL,KAAKwpC,YAAcxpC,KAAK8kB,KAAKrO,SAAS,EAAG,MAAMvL,GAGhD29B,WAAY,WAEX,GAAIY,GAAazpC,KAAKwpC,YACrBE,EAAYnnC,KAAKC,MAAMinC,EAAa,GACpCzmB,EAAKhjB,KAAKupC,oBACVr+B,EAAIlL,KAAKsoC,WAAWhB,QAAQp8B,EAC5By+B,GAASz+B,EAAIw+B,EAAY1mB,GAAMymB,EAAaC,EAAY1mB,EACxD4mB,GAAS1+B,EAAIw+B,EAAY1mB,GAAMymB,EAAaC,EAAY1mB,EACxD6mB,EAAOtnC,KAAK8J,IAAIs9B,EAAQ3mB,GAAMzgB,KAAK8J,IAAIu9B,EAAQ5mB,GAAM2mB,EAAQC,CAE9D5pC,MAAKsoC,WAAWhB,QAAQp8B,EAAI2+B,GAG7BjB,WAAY,SAAUt3B,GACrB,GAAI+R,GAAMrjB,KAAK8kB,KACd/hB,EAAUsgB,EAAItgB,QACd+mC,GAAS,GAAIzlC,MAASrE,KAAKkpC,UAE3Ba,GAAahnC,EAAQglC,SAAW+B,EAAQ/mC,EAAQmlC,mBAAqBloC,KAAKgpC,WAAW,EAItF,IAFA3lB,EAAItb,KAAK,UAAWuJ,GAEhBy4B,EACH1mB,EAAItb,KAAK,eAEH,CAEN,GAAIiiC,GAAYhqC,KAAKmpC,SAAS39B,SAASxL,KAAKgpC,WAAW,IACtDiB,GAAYjqC,KAAKkpC,UAAYY,EAAQ9pC,KAAKipC,OAAO,IAAM,IACvDiB,EAAOnnC,EAAQolC,cAEfgC,EAAcH,EAAUp+B,WAAWs+B,EAAOD,GAC1CG,EAAQD,EAAYl+B,YAAY,EAAG,IAEnCo+B,EAAe9nC,KAAKmK,IAAI3J,EAAQklC,gBAAiBmC,GACjDE,EAAqBH,EAAYv+B,WAAWy+B,EAAeD,GAE3DG,EAAuBF,GAAgBtnC,EAAQilC,oBAAsBkC,GACrE7uB,EAASivB,EAAmB1+B,YAAY2+B,EAAuB,GAAG/nC,OAE9D6Y,GAAOnQ,GAAMmQ,EAAOlQ,GAIxBkQ,EAASgI,EAAIV,aAAatH,EAAQgI,EAAItgB,QAAQ0V,WAE9ChZ,EAAEQ,KAAK8E,iBAAiB,WACvBse,EAAIjI,MAAMC,GACT4uB,SAAUM,EACVpC,cAAe+B,EACfM,aAAa,OATfnnB,EAAItb,KAAK,eAiBbtI,EAAEuY,IAAI7R,YAAY,aAAc,WAAY1G,EAAEuY,IAAIqwB,MAOlD5oC,EAAEuY,IAAI9R,cACLukC,iBAAiB,IAGlBhrC,EAAEuY,IAAI0yB,gBAAkBjrC,EAAEwwB,QAAQ/vB,QACjC0nC,SAAU,WACT5nC,KAAK8kB,KAAKld,GAAG,WAAY5H,KAAK2qC,eAAgB3qC,OAG/C6nC,YAAa,WACZ7nC,KAAK8kB,KAAKjd,IAAI,WAAY7H,KAAK2qC,eAAgB3qC,OAGhD2qC,eAAgB,SAAUr5B,GACzB,GAAI+R,GAAMrjB,KAAK8kB,KACd3N,EAAOkM,EAAIjK,WAAa9H,EAAEyQ,cAAc+kB,SAAW,GAAK,EAErB,YAAhCzjB,EAAItgB,QAAQ0nC,gBACfpnB,EAAI9J,QAAQpC,GAEZkM,EAAIxJ,cAAcvI,EAAE0I,eAAgB7C,MAKvC1X,EAAEuY,IAAI7R,YAAY,aAAc,kBAAmB1G,EAAEuY,IAAI0yB,iBAOzDjrC,EAAEuY,IAAI9R,cACL0kC,iBAAiB,IAGlBnrC,EAAEuY,IAAI6yB,gBAAkBprC,EAAEwwB,QAAQ/vB,QACjC0nC,SAAU,WACTnoC,EAAEiT,SAAS9K,GAAG5H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAK8qC,eAAgB9qC,MACvEP,EAAEiT,SAAS9K,GAAG5H,KAAK8kB,KAAK3H,WAAY,sBAAuB1d,EAAEiT,SAASC,gBACtE3S,KAAK+qC,OAAS,GAGflD,YAAa,WACZpoC,EAAEiT,SAAS7K,IAAI7H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAK8qC,gBACxDrrC,EAAEiT,SAAS7K,IAAI7H,KAAK8kB,KAAK3H,WAAY,sBAAuB1d,EAAEiT,SAASC,iBAGxEm4B,eAAgB,SAAUx5B,GACzB,GAAIqI,GAAQla,EAAEiT,SAAS2yB,cAAc/zB,EAErCtR,MAAK+qC,QAAUpxB,EACf3Z,KAAKgrC,cAAgBhrC,KAAK8kB,KAAKpF,2BAA2BpO,GAErDtR,KAAKirC,aACTjrC,KAAKirC,YAAc,GAAI5mC,MAGxB,IAAIwK,GAAOtM,KAAKgC,IAAI,KAAO,GAAIF,MAASrE,KAAKirC,YAAa,EAE1DnmC,cAAa9E,KAAKkrC,QAClBlrC,KAAKkrC,OAASjpC,WAAWxC,EAAEuB,KAAKhB,KAAKmrC,aAAcnrC,MAAO6O,GAE1DpP,EAAEiT,SAASC,eAAerB,GAC1B7R,EAAEiT,SAAS0d,gBAAgB9e,IAG5B65B,aAAc,WACb,GAAI9nB,GAAMrjB,KAAK8kB,KACdnL,EAAQ3Z,KAAK+qC,OACb5zB,EAAOkM,EAAIjK,SAEZO,GAAQA,EAAQ,EAAIpX,KAAK6gB,KAAKzJ,GAASpX,KAAKwJ,MAAM4N,GAClDA,EAAQpX,KAAKgC,IAAIhC,KAAKmK,IAAIiN,EAAO,GAAI,IACrCA,EAAQ0J,EAAI/J,WAAWnC,EAAOwC,GAASxC,EAEvCnX,KAAK+qC,OAAS,EACd/qC,KAAKirC,WAAa,KAEbtxB,IAE+B,WAAhC0J,EAAItgB,QAAQ6nC,gBACfvnB,EAAI9J,QAAQpC,EAAOwC,GAEnB0J,EAAIxJ,cAAc7Z,KAAKgrC,cAAe7zB,EAAOwC,OAKhDla,EAAEuY,IAAI7R,YAAY,aAAc,kBAAmB1G,EAAEuY,IAAI6yB,iBAOzDprC,EAAES,OAAOT,EAAEiT,UAEV04B,YAAa3rC,EAAEmL,QAAQ7B,UAAY,gBAAkBtJ,EAAEmL,QAAQzB,QAAU,cAAgB,aACzFkiC,UAAW5rC,EAAEmL,QAAQ7B,UAAY,cAAgBtJ,EAAEmL,QAAQzB,QAAU,YAAc,WAGnFi7B,qBAAsB,SAAUljC,EAAKyG,EAAS9C,GAU7C,QAASymC,GAAah6B,GACrB,GAAIi6B,EAQJ,IANI9rC,EAAEmL,QAAQzB,SACbqiC,EAAepoC,KAAKkO,EAAEm6B,WACtBF,EAAQC,EAAe1qC,QAEvByqC,EAAQj6B,EAAE21B,QAAQnmC,SAEfyqC,EAAQ,GAAZ,CAIA,GAAIG,GAAMrnC,KAAKqnC,MACd/xB,EAAQ+xB,GAAOlP,GAAQkP,EAExBthC,GAAQkH,EAAE21B,QAAU31B,EAAE21B,QAAQ,GAAK31B,EACnCq6B,EAAahyB,EAAQ,GAAcmwB,GAATnwB,EAC1B6iB,EAAOkP,GAGR,QAASE,GAAWt6B,GACnB,GAAI7R,EAAEmL,QAAQzB,QAAS,CACtB,GAAI0iC,GAAML,EAAejoC,QAAQ+N,EAAEm6B,UACnC,IAAY,KAARI,EACH,MAEDL,GAAejkC,OAAOskC,EAAK,GAG5B,GAAIF,EAAW,CACd,GAAIlsC,EAAEmL,QAAQzB,QAAS,CAEtB,GACC2iC,GADGC,IAIJ,KAAK,GAAI3rC,KAAKgK,GACb0hC,EAAO1hC,EAAMhK,GACO,kBAAT0rC,GACVC,EAAS3rC,GAAK0rC,EAAK9qC,KAAKoJ,GAExB2hC,EAAS3rC,GAAK0rC,CAGhB1hC,GAAQ2hC,EAET3hC,EAAMzD,KAAO,WACbgB,EAAQyC,GACRoyB,EAAO,MA1DT,GAAIA,GAGHpyB,EAFAuhC,GAAY,EACZ7B,EAAQ,IAERkC,EAAM,YACN1F,EAAatmC,KAAKorC,YAClBa,EAAWjsC,KAAKqrC,UAChBG,IAsDDtqC,GAAI8qC,EAAM1F,EAAazhC,GAAMymC,EAC7BpqC,EAAI8qC,EAAMC,EAAWpnC,GAAM+mC,CAI3B,IAAIM,GAAazsC,EAAEmL,QAAQzB,QAAU7J,EAASqK,gBAAkBzI,CAShE,OAPAA,GAAIsF,iBAAiB8/B,EAAYgF,GAAc,GAC/CY,EAAW1lC,iBAAiBylC,EAAUL,GAAY,GAE9CnsC,EAAEmL,QAAQzB,SACb+iC,EAAW1lC,iBAAiB/G,EAAEiT,SAASy5B,eAAgBP,GAAY,GAG7D5rC,MAGR0kC,wBAAyB,SAAUxjC,EAAK2D,GACvC,GAAImnC,GAAM,WAWV,OATA9qC,GAAIiG,oBAAoBnH,KAAKorC,YAAalqC,EAAI8qC,EAAMhsC,KAAKorC,YAAcvmC,IAAK,IAC3EpF,EAAEmL,QAAQzB,QAAU7J,EAASqK,gBAAkBzI,GAAKiG,oBACpDnH,KAAKqrC,UAAWnqC,EAAI8qC,EAAMhsC,KAAKqrC,UAAYxmC,IAAK,GAE7CpF,EAAEmL,QAAQzB,SACb7J,EAASqK,gBAAgBxC,oBAAoB1H,EAAEiT,SAASy5B,eAAgBjrC,EAAI8qC,EAAMhsC,KAAKqrC,UAAYxmC,IAClG,GAGK7E,QASTP,EAAES,OAAOT,EAAEiT,UAGV05B,aAAc3sC,EAAEmL,QAAQ7B,UAAY,gBAAkB,cACtDsjC,aAAc5sC,EAAEmL,QAAQ7B,UAAY,gBAAkB,cACtDujC,WAAY7sC,EAAEmL,QAAQ7B,UAAY,cAAgB,YAClDojC,eAAgB1sC,EAAEmL,QAAQ7B,UAAY,kBAAoB,gBAE1DwjC,aACAC,0BAA0B,EAM1BrI,mBAAoB,SAAUjjC,EAAKyF,EAAMgB,EAAS9C,GAEjD,OAAQ8B,GACP,IAAK,aACJ,MAAO3G,MAAKysC,wBAAwBvrC,EAAKyF,EAAMgB,EAAS9C,EACzD,KAAK,WACJ,MAAO7E,MAAK0sC,sBAAsBxrC,EAAKyF,EAAMgB,EAAS9C,EACvD,KAAK,YACJ,MAAO7E,MAAK2sC,uBAAuBzrC,EAAKyF,EAAMgB,EAAS9C,EACxD,SACC,KAAM;GAIT4nC,wBAAyB,SAAUvrC,EAAKyF,EAAMgB,EAAS9C,GACtD,GAAImnC,GAAM,YACTY,EAAW5sC,KAAKusC,UAEbM,EAAK,SAAUv7B,GAElB7R,EAAEiT,SAASC,eAAerB,EAG1B,KAAK,GADDw7B,IAAiB,EACZ1sC,EAAI,EAAGA,EAAIwsC,EAAS9rC,OAAQV,IACpC,GAAIwsC,EAASxsC,GAAGqrC,YAAcn6B,EAAEm6B,UAAW,CAC1CqB,GAAiB,CACjB,OAGGA,GACJF,EAASxpC,KAAKkO,GAGfA,EAAE21B,QAAU2F,EAASjsC,QACrB2Q,EAAEy7B,gBAAkBz7B,GAEpB3J,EAAQ2J,GAQT,IALApQ,EAAI8qC,EAAM,aAAennC,GAAMgoC,EAC/B3rC,EAAIsF,iBAAiBxG,KAAKosC,aAAcS,GAAI,IAIvC7sC,KAAKwsC,yBAA0B,CACnC,GAAIQ,GAAa,SAAU17B,GAC1B,IAAK,GAAIlR,GAAI,EAAGA,EAAIwsC,EAAS9rC,OAAQV,IACpC,GAAIwsC,EAASxsC,GAAGqrC,YAAcn6B,EAAEm6B,UAAW,CAC1CmB,EAASrlC,OAAOnH,EAAG,EACnB,QAKHd,GAASqK,gBAAgBnD,iBAAiBxG,KAAKssC,WAAYU,GAAY,GACvE1tC,EAASqK,gBAAgBnD,iBAAiBxG,KAAKmsC,eAAgBa,GAAY,GAE3EhtC,KAAKwsC,0BAA2B,EAGjC,MAAOxsC,OAGR2sC,uBAAwB,SAAUzrC,EAAKyF,EAAMgB,EAAS9C,GAIrD,QAASgoC,GAAGv7B,GAGX,GAAKA,EAAE27B,cAAgB37B,EAAE47B,sBAA0C,UAAlB57B,EAAE27B,aAA0C,IAAd37B,EAAE67B,QAAjF,CAEA,IAAK,GAAI/sC,GAAI,EAAGA,EAAI6mC,EAAQnmC,OAAQV,IACnC,GAAI6mC,EAAQ7mC,GAAGqrC,YAAcn6B,EAAEm6B,UAAW,CACzCxE,EAAQ7mC,GAAKkR,CACb,OAIFA,EAAE21B,QAAUA,EAAQtmC,QACpB2Q,EAAEy7B,gBAAkBz7B,GAEpB3J,EAAQ2J,IAlBT,GAAI06B,GAAM,YACT/E,EAAUjnC,KAAKusC,SAuBhB,OAHArrC,GAAI8qC,EAAM,YAAcnnC,GAAMgoC,EAC9B3rC,EAAIsF,iBAAiBxG,KAAKqsC,aAAcQ,GAAI,GAErC7sC,MAGR0sC,sBAAuB,SAAUxrC,EAAKyF,EAAMgB,EAAS9C,GACpD,GAAImnC,GAAM,YACT/E,EAAUjnC,KAAKusC,UAEZM,EAAK,SAAUv7B,GAClB,IAAK,GAAIlR,GAAI,EAAGA,EAAI6mC,EAAQnmC,OAAQV,IACnC,GAAI6mC,EAAQ7mC,GAAGqrC,YAAcn6B,EAAEm6B,UAAW,CACzCxE,EAAQ1/B,OAAOnH,EAAG,EAClB,OAIFkR,EAAE21B,QAAUA,EAAQtmC,QACpB2Q,EAAEy7B,gBAAkBz7B,GAEpB3J,EAAQ2J,GAOT,OAJApQ,GAAI8qC,EAAM,WAAannC,GAAMgoC,EAC7B3rC,EAAIsF,iBAAiBxG,KAAKssC,WAAYO,GAAI,GAC1C3rC,EAAIsF,iBAAiBxG,KAAKmsC,eAAgBU,GAAI,GAEvC7sC,MAGRykC,sBAAuB,SAAUvjC,EAAKyF,EAAM9B,GAC3C,GAAImnC,GAAM,YACTa,EAAK3rC,EAAI8qC,EAAMrlC,EAAO9B,EAEvB,QAAQ8B,GACP,IAAK,aACJzF,EAAIiG,oBAAoBnH,KAAKosC,aAAcS,GAAI,EAC/C,MACD,KAAK,YACJ3rC,EAAIiG,oBAAoBnH,KAAKqsC,aAAcQ,GAAI,EAC/C,MACD,KAAK,WACJ3rC,EAAIiG,oBAAoBnH,KAAKssC,WAAYO,GAAI,GAC7C3rC,EAAIiG,oBAAoBnH,KAAKmsC,eAAgBU,GAAI,GAInD,MAAO7sC,SASTP,EAAEuY,IAAI9R,cACLknC,UAAW3tC,EAAEmL,QAAQR,QAAU3K,EAAEmL,QAAQlC,UACzC2kC,oBAAoB,IAGrB5tC,EAAEuY,IAAIs1B,UAAY7tC,EAAEwwB,QAAQ/vB,QAC3B0nC,SAAU,WACTnoC,EAAEiT,SAAS9K,GAAG5H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAKutC,cAAevtC,OAGvE6nC,YAAa,WACZpoC,EAAEiT,SAAS7K,IAAI7H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAKutC,cAAevtC,OAGxEutC,cAAe,SAAUj8B,GACxB,GAAI+R,GAAMrjB,KAAK8kB,IAEf,IAAKxT,EAAE21B,SAAgC,IAArB31B,EAAE21B,QAAQnmC,SAAgBuiB,EAAI8X,iBAAkBn7B,KAAKwtC,SAAvE,CAEA,GAAIzR,GAAK1Y,EAAIzD,uBAAuBtO,EAAE21B,QAAQ,IAC7CjL,EAAK3Y,EAAIzD,uBAAuBtO,EAAE21B,QAAQ,IAC1CwG,EAAapqB,EAAI1F,sBAElB3d,MAAK0tC,aAAe3R,EAAG1wB,IAAI2wB,GAAIrwB,UAAU,GACzC3L,KAAK2tC,WAAa5R,EAAG9vB,WAAW+vB,GAEhCh8B,KAAKyd,QAAS,EACdzd,KAAKwtC,UAAW,EAEhBxtC,KAAK4tC,cAAgBH,EAAWjiC,SAASxL,KAAK0tC,cAE1CrqB,EAAI0lB,UACP1lB,EAAI0lB,SAASxU,OAGd90B,EAAEiT,SACA9K,GAAGtI,EAAU,YAAaU,KAAK6tC,aAAc7tC,MAC7C4H,GAAGtI,EAAU,WAAYU,KAAK8tC,YAAa9tC,MAE7CP,EAAEiT,SAASC,eAAerB,KAG3Bu8B,aAAc,SAAUv8B,GACvB,GAAI+R,GAAMrjB,KAAK8kB,IAEf,IAAKxT,EAAE21B,SAAgC,IAArB31B,EAAE21B,QAAQnmC,QAAiBd,KAAKwtC,SAAlD,CAEA,GAAIzR,GAAK1Y,EAAIzD,uBAAuBtO,EAAE21B,QAAQ,IAC7CjL,EAAK3Y,EAAIzD,uBAAuBtO,EAAE21B,QAAQ,GAE3CjnC,MAAK+tC,OAAShS,EAAG9vB,WAAW+vB,GAAMh8B,KAAK2tC,WACvC3tC,KAAK+qC,OAAShP,EAAGxwB,KAAKywB,GAAIrwB,UAAU,GAAGF,UAAUzL,KAAK0tC,cAElC,IAAhB1tC,KAAK+tC,UAEJ1qB,EAAItgB,QAAQsqC,qBACXhqB,EAAIjK,YAAciK,EAAIxF,cAAgB7d,KAAK+tC,OAAS,GACvD1qB,EAAIjK,YAAciK,EAAItF,cAAgB/d,KAAK+tC,OAAS,KAGlD/tC,KAAKyd,SACThe,EAAEwO,QAAQyC,SAAS2S,EAAInD,SAAU,oBAEjCmD,EACEtb,KAAK,aACLA,KAAK,aAEP/H,KAAKyd,QAAS,GAGfhe,EAAEQ,KAAKiF,gBAAgBlF,KAAK2nC,cAC5B3nC,KAAK2nC,aAAeloC,EAAEQ,KAAK8E,iBAC1B/E,KAAKguC,cAAehuC,MAAM,EAAMA,KAAK8kB,KAAK3H,YAE3C1d,EAAEiT,SAASC,eAAerB,OAG3B08B,cAAe,WACd,GAAI3qB,GAAMrjB,KAAK8kB,KACd/S,EAAS/R,KAAKiuC,kBACdt1B,EAAS0K,EAAI3F,mBAAmB3L,GAChCoF,EAAOkM,EAAIlE,aAAanf,KAAK+tC,OAE9B1qB,GAAIiC,aAAa3M,EAAQxB,EAAMnX,KAAK0tC,aAAc1tC,KAAK+tC,OAAQ/tC,KAAK+qC,SAGrE+C,YAAa,WACZ,IAAK9tC,KAAKyd,SAAWzd,KAAKwtC,SAEzB,YADAxtC,KAAKwtC,UAAW,EAIjB,IAAInqB,GAAMrjB,KAAK8kB,IAEf9kB,MAAKwtC,UAAW,EAChB/tC,EAAEwO,QAAQ4C,YAAYwS,EAAInD,SAAU,oBACpCzgB,EAAEQ,KAAKiF,gBAAgBlF,KAAK2nC,cAE5BloC,EAAEiT,SACA7K,IAAIvI,EAAU,YAAaU,KAAK6tC,cAChChmC,IAAIvI,EAAU,WAAYU,KAAK8tC,YAEjC,IAAI/7B,GAAS/R,KAAKiuC,kBACjBt1B,EAAS0K,EAAI3F,mBAAmB3L,GAEhCm8B,EAAU7qB,EAAIjK,UACd+0B,EAAiB9qB,EAAIlE,aAAanf,KAAK+tC,QAAUG,EACjDE,EAAkBD,EAAiB,EAClC5rC,KAAK6gB,KAAK+qB,GAAkB5rC,KAAKwJ,MAAMoiC,GAExCh3B,EAAOkM,EAAI/J,WAAW40B,EAAUE,GAChCtgC,EAAQuV,EAAIvJ,aAAa3C,GAAQnX,KAAK+tC,MAEvC1qB,GAAIiC,aAAa3M,EAAQxB,EAAMpF,EAAQjE,IAGxCmgC,gBAAiB,WAChB,GAAI/zB,GAAela,KAAK4tC,cAAcpiC,SAASxL,KAAK+qC,QAAQr/B,SAAS1L,KAAK+tC,OAC1E,OAAO/tC,MAAK0tC,aAAariC,IAAI6O,MAI/Bza,EAAEuY,IAAI7R,YAAY,aAAc,YAAa1G,EAAEuY,IAAIs1B,WAOnD7tC,EAAEuY,IAAI9R,cACLmoC,KAAK,EACLC,aAAc,KAGf7uC,EAAEuY,IAAIu2B,IAAM9uC,EAAEwwB,QAAQ/vB,QACrB0nC,SAAU,WACTnoC,EAAEiT,SAAS9K,GAAG5H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAK6mC,QAAS7mC,OAGjE6nC,YAAa,WACZpoC,EAAEiT,SAAS7K,IAAI7H,KAAK8kB,KAAK3H,WAAY,aAAcnd,KAAK6mC,QAAS7mC,OAGlE6mC,QAAS,SAAUv1B,GAClB,GAAKA,EAAE21B,QAAP,CAOA,GALAxnC,EAAEiT,SAASC,eAAerB,GAE1BtR,KAAKwuC,YAAa,EAGdl9B,EAAE21B,QAAQnmC,OAAS,EAGtB,MAFAd,MAAKwuC,YAAa,MAClB1pC,cAAa9E,KAAKyuC,aAInB,IAAI5W,GAAQvmB,EAAE21B,QAAQ,GACrB54B,EAAKwpB,EAAMpwB,MAEZzH,MAAKqnC,UAAYrnC,KAAKsnC,QAAU,GAAI7nC,GAAEwL,MAAM4sB,EAAMoN,QAASpN,EAAMqN,SAG7D72B,EAAG4B,SAAwC,MAA7B5B,EAAG4B,QAAQ5H,eAC5B5I,EAAEwO,QAAQyC,SAASrC,EAAI,kBAIxBrO,KAAKyuC,aAAexsC,WAAWxC,EAAEuB,KAAK,WACjChB,KAAK0uC,gBACR1uC,KAAKwuC,YAAa,EAClBxuC,KAAKwnC,QACLxnC,KAAK2uC,eAAe,cAAe9W,KAElC73B,MAAO,KAEVP,EAAEiT,SACA9K,GAAGtI,EAAU,YAAaU,KAAKunC,QAASvnC,MACxC4H,GAAGtI,EAAU,WAAYU,KAAKwnC,MAAOxnC,QAGxCwnC,MAAO,SAAUl2B,GAOhB,GANAxM,aAAa9E,KAAKyuC,cAElBhvC,EAAEiT,SACA7K,IAAIvI,EAAU,YAAaU,KAAKunC,QAASvnC,MACzC6H,IAAIvI,EAAU,WAAYU,KAAKwnC,MAAOxnC,MAEpCA,KAAKwuC,YAAcl9B,GAAKA,EAAEy7B,eAAgB,CAE7C,GAAIlV,GAAQvmB,EAAEy7B,eAAe,GAC5B1+B,EAAKwpB,EAAMpwB,MAER4G,IAAMA,EAAG4B,SAAwC,MAA7B5B,EAAG4B,QAAQ5H,eAClC5I,EAAEwO,QAAQ4C,YAAYxC,EAAI,kBAIvBrO,KAAK0uC,eACR1uC,KAAK2uC,eAAe,QAAS9W,KAKhC6W,YAAa,WACZ,MAAO1uC,MAAKsnC,QAAQr7B,WAAWjM,KAAKqnC,YAAcrnC,KAAK8kB,KAAK/hB,QAAQurC,cAGrE/G,QAAS,SAAUj2B,GAClB,GAAIumB,GAAQvmB,EAAE21B,QAAQ,EACtBjnC,MAAKsnC,QAAU,GAAI7nC,GAAEwL,MAAM4sB,EAAMoN,QAASpN,EAAMqN,UAGjDyJ,eAAgB,SAAUhoC,EAAM2K,GAC/B,GAAIs9B,GAAiBtvC,EAASuvC,YAAY,cAE1CD,GAAeltB,YAAa,EAC5BpQ,EAAE7J,OAAO0+B,iBAAkB,EAE3ByI,EAAeE,eACdnoC,GAAM,GAAM,EAAMtH,EAAQ,EAC1BiS,EAAEy9B,QAASz9B,EAAE09B,QACb19B,EAAE2zB,QAAS3zB,EAAE4zB,SACb,GAAO,GAAO,GAAO,EAAO,EAAG,MAEhC5zB,EAAE7J,OAAOwnC,cAAcL,MAIrBnvC,EAAEmL,QAAQR,QAAU3K,EAAEmL,QAAQzB,SACjC1J,EAAEuY,IAAI7R,YAAY,aAAc,MAAO1G,EAAEuY,IAAIu2B,KAS9C9uC,EAAEuY,IAAI9R,cACL2b,SAAS,IAGVpiB,EAAEuY,IAAIk3B,QAAUzvC,EAAEwwB,QAAQ/vB,QACzBoF,WAAY,SAAU+d,GACrBrjB,KAAK8kB,KAAOzB,EACZrjB,KAAKmd,WAAakG,EAAIlG,WACtBnd,KAAKmvC,MAAQ9rB,EAAIrE,OAAOyB,YACxBzgB,KAAKyd,QAAS,GAGfmqB,SAAU,WACTnoC,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,YAAand,KAAKovC,aAAcpvC,OAGhE6nC,YAAa,WACZpoC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,YAAand,KAAKovC,cAClDpvC,KAAKyd,QAAS,GAGfmE,MAAO,WACN,MAAO5hB,MAAKyd,QAGb2xB,aAAc,SAAU99B,GAGvB,MAFAtR,MAAKyd,QAAS,GAETnM,EAAEw1B,UAA0B,IAAZx1B,EAAEy1B,OAA8B,IAAbz1B,EAAE01B,QAAyB,GAEnEvnC,EAAEwO,QAAQwE,uBACVhT,EAAEwO,QAAQ8E,mBAEV/S,KAAKqvC,iBAAmBrvC,KAAK8kB,KAAKlF,uBAAuBtO,OAEzD7R,GAAEiT,SACA9K,GAAGtI,EAAU,YAAaU,KAAK85B,aAAc95B,MAC7C4H,GAAGtI,EAAU,UAAWU,KAAKsvC,WAAYtvC,MACzC4H,GAAGtI,EAAU,UAAWU,KAAKuvC,WAAYvvC,QAG5C85B,aAAc,SAAUxoB,GAClBtR,KAAKyd,SACTzd,KAAKwvC,KAAO/vC,EAAEwO,QAAQ+B,OAAO,MAAO,mBAAoBhQ,KAAKmvC,OAC7D1vC,EAAEwO,QAAQiE,YAAYlS,KAAKwvC,KAAMxvC,KAAKqvC,kBAGtCrvC,KAAKmd,WAAWtT,MAAMuxB,OAAS,YAC/Bp7B,KAAK8kB,KAAK/c,KAAK,gBAGhB,IAAI0nC,GAAazvC,KAAKqvC,iBACrBK,EAAM1vC,KAAKwvC,KAEX/vB,EAAazf,KAAK8kB,KAAKlF,uBAAuBtO,GAC9C+J,EAASoE,EAAWjU,SAASikC,GAE7BE,EAAS,GAAIlwC,GAAEwL,MACd1I,KAAKmK,IAAI+S,EAAWvU,EAAGukC,EAAWvkC,GAClC3I,KAAKmK,IAAI+S,EAAWtU,EAAGskC,EAAWtkC,GAEpC1L,GAAEwO,QAAQiE,YAAYw9B,EAAKC,GAE3B3vC,KAAKyd,QAAS,EAGdiyB,EAAI7lC,MAAM0F,MAAUhN,KAAKgC,IAAI,EAAGhC,KAAK8J,IAAIgP,EAAOnQ,GAAK,GAAM,KAC3DwkC,EAAI7lC,MAAMggB,OAAUtnB,KAAKgC,IAAI,EAAGhC,KAAK8J,IAAIgP,EAAOlQ,GAAK,GAAM,MAG5DykC,QAAS,WACJ5vC,KAAKyd,SACRzd,KAAKmvC,MAAMtuB,YAAY7gB,KAAKwvC,MAC5BxvC,KAAKmd,WAAWtT,MAAMuxB,OAAS,IAGhC37B,EAAEwO,QAAQ2E,sBACVnT,EAAEwO,QAAQ+E,kBAEVvT,EAAEiT,SACA7K,IAAIvI,EAAU,YAAaU,KAAK85B,cAChCjyB,IAAIvI,EAAU,UAAWU,KAAKsvC,YAC9BznC,IAAIvI,EAAU,UAAWU,KAAKuvC,aAGjCD,WAAY,SAAUh+B,GAErBtR,KAAK4vC,SAEL,IAAIvsB,GAAMrjB,KAAK8kB,KACdrF,EAAa4D,EAAIzD,uBAAuBtO,EAEzC,KAAItR,KAAKqvC,iBAAiBljC,OAAOsT,GAAjC,CAEA,GAAI1S,GAAS,GAAItN,GAAEmV,aAClByO,EAAI3F,mBAAmB1d,KAAKqvC,kBAC5BhsB,EAAI3F,mBAAmB+B,GAExB4D,GAAIhJ,UAAUtN,GAEdsW,EAAItb,KAAK,cACR8nC,cAAe9iC,MAIjBwiC,WAAY,SAAUj+B,GACH,KAAdA,EAAEgf,SACLtwB,KAAK4vC,aAKRnwC,EAAEuY,IAAI7R,YAAY,aAAc,UAAW1G,EAAEuY,IAAIk3B,SAOjDzvC,EAAEuY,IAAI9R,cACLioB,UAAU,EACV2hB,kBAAmB,GACnBC,mBAAoB,IAGrBtwC,EAAEuY,IAAIg4B,SAAWvwC,EAAEwwB,QAAQ/vB,QAE1B+vC,UACCphC,MAAU,IACVsU,OAAU,IACV+sB,MAAU,IACVC,IAAU,IACVz2B,QAAU,IAAK,IAAK,GAAI,KACxBE,SAAU,IAAK,IAAK,MAGrBtU,WAAY,SAAU+d,GACrBrjB,KAAK8kB,KAAOzB,EAEZrjB,KAAKowC,cAAc/sB,EAAItgB,QAAQ+sC,mBAC/B9vC,KAAKqwC,eAAehtB,EAAItgB,QAAQgtC,qBAGjCnI,SAAU,WACT,GAAIz3B,GAAYnQ,KAAK8kB,KAAK3H,UAGC,MAAvBhN,EAAUof,WACbpf,EAAUof,SAAW,KAGtB9vB,EAAEiT,SACA9K,GAAGuI,EAAW,QAASnQ,KAAKswC,SAAUtwC,MACtC4H,GAAGuI,EAAW,OAAQnQ,KAAKuwC,QAASvwC,MACpC4H,GAAGuI,EAAW,YAAanQ,KAAKovC,aAAcpvC,MAEhDA,KAAK8kB,KACHld,GAAG,QAAS5H,KAAKwwC,UAAWxwC,MAC5B4H,GAAG,OAAQ5H,KAAKywC,aAAczwC,OAGjC6nC,YAAa,WACZ7nC,KAAKywC,cAEL,IAAItgC,GAAYnQ,KAAK8kB,KAAK3H,UAE1B1d,GAAEiT,SACA7K,IAAIsI,EAAW,QAASnQ,KAAKswC,SAAUtwC,MACvC6H,IAAIsI,EAAW,OAAQnQ,KAAKuwC,QAASvwC,MACrC6H,IAAIsI,EAAW,YAAanQ,KAAKovC,aAAcpvC,MAEjDA,KAAK8kB,KACHjd,IAAI,QAAS7H,KAAKwwC,UAAWxwC,MAC7B6H,IAAI,OAAQ7H,KAAKywC,aAAczwC,OAGlCovC,aAAc,WACb,IAAIpvC,KAAK0wC,SAAT,CAEA,GAAI3hC,GAAOzP,EAASyP,KACnBC,EAAQ1P,EAASqK,gBACjBiF,EAAMG,EAAKM,WAAaL,EAAMK,UAC9BR,EAAOE,EAAKO,YAAcN,EAAMM,UAEjCtP,MAAK8kB,KAAK3H,WAAWwzB,QAErBtxC,EAAOuxC,SAAS/hC,EAAMD,KAGvB0hC,SAAU,WACTtwC,KAAK0wC,UAAW,EAChB1wC,KAAK8kB,KAAK/c,KAAK,UAGhBwoC,QAAS,WACRvwC,KAAK0wC,UAAW,EAChB1wC,KAAK8kB,KAAK/c,KAAK,SAGhBqoC,cAAe,SAAUj1B,GACxB,GAEC/a,GAAGE,EAFAuwC,EAAO7wC,KAAK8wC,YACfC,EAAQ/wC,KAAKiwC,QAGd,KAAK7vC,EAAI,EAAGE,EAAMywC,EAAMliC,KAAK/N,OAAYR,EAAJF,EAASA,IAC7CywC,EAAKE,EAAMliC,KAAKzO,KAAO,GAAK+a,EAAK,EAElC,KAAK/a,EAAI,EAAGE,EAAMywC,EAAM5tB,MAAMriB,OAAYR,EAAJF,EAASA,IAC9CywC,EAAKE,EAAM5tB,MAAM/iB,KAAO+a,EAAK,EAE9B,KAAK/a,EAAI,EAAGE,EAAMywC,EAAMb,KAAKpvC,OAAYR,EAAJF,EAASA,IAC7CywC,EAAKE,EAAMb,KAAK9vC,KAAO,EAAG+a,EAE3B,KAAK/a,EAAI,EAAGE,EAAMywC,EAAMZ,GAAGrvC,OAAYR,EAAJF,EAASA,IAC3CywC,EAAKE,EAAMZ,GAAG/vC,KAAO,EAAG,GAAK+a,IAI/Bk1B,eAAgB,SAAUl5B,GACzB,GAEC/W,GAAGE,EAFAuwC,EAAO7wC,KAAKgxC,aACfD,EAAQ/wC,KAAKiwC,QAGd,KAAK7vC,EAAI,EAAGE,EAAMywC,EAAMr3B,OAAO5Y,OAAYR,EAAJF,EAASA,IAC/CywC,EAAKE,EAAMr3B,OAAOtZ,IAAM+W,CAEzB,KAAK/W,EAAI,EAAGE,EAAMywC,EAAMn3B,QAAQ9Y,OAAYR,EAAJF,EAASA,IAChDywC,EAAKE,EAAMn3B,QAAQxZ,KAAO+W,GAI5Bq5B,UAAW,WACV/wC,EAAEiT,SAAS9K,GAAGtI,EAAU,UAAWU,KAAKuvC,WAAYvvC,OAGrDywC,aAAc,WACbhxC,EAAEiT,SAAS7K,IAAIvI,EAAU,UAAWU,KAAKuvC,WAAYvvC,OAGtDuvC,WAAY,SAAUj+B,GACrB,GAAI/P,GAAM+P,EAAEgf,QACXjN,EAAMrjB,KAAK8kB,IAEZ,IAAIvjB,IAAOvB,MAAK8wC,SAAU,CAEzB,GAAIztB,EAAI0lB,UAAY1lB,EAAI0lB,SAASkI,YAAe,MAEhD5tB,GAAIjI,MAAMpb,KAAK8wC,SAASvvC,IAEpB8hB,EAAItgB,QAAQ0V,WACf4K,EAAI7H,gBAAgB6H,EAAItgB,QAAQ0V,eAG3B,CAAA,KAAIlX,IAAOvB,MAAKgxC,WAItB,MAHA3tB,GAAI9J,QAAQ8J,EAAIjK,UAAYpZ,KAAKgxC,UAAUzvC,IAM5C9B,EAAEiT,SAAS6hB,KAAKjjB,MAIlB7R,EAAEuY,IAAI7R,YAAY,aAAc,WAAY1G,EAAEuY,IAAIg4B,UAOlDvwC,EAAEwwB,QAAQC,WAAazwB,EAAEwwB,QAAQ/vB,QAChCoF,WAAY,SAAUirB,GACrBvwB,KAAKkxC,QAAU3gB,GAGhBqX,SAAU,WACT,GAAIxa,GAAOptB,KAAKkxC,QAAQhiB,KACnBlvB,MAAKsoC,aACTtoC,KAAKsoC,WAAa,GAAI7oC,GAAEolC,UAAUzX,EAAMA,IAGzCptB,KAAKsoC,WACH1gC,GAAG,YAAa5H,KAAKwoC,aAAcxoC,MACnC4H,GAAG,OAAQ5H,KAAK0oC,QAAS1oC,MACzB4H,GAAG,UAAW5H,KAAK4oC,WAAY5oC,MACjCA,KAAKsoC,WAAWprB,SAChBzd,EAAEwO,QAAQyC,SAAS1Q,KAAKkxC,QAAQhiB,MAAO,6BAGxC2Y,YAAa,WACZ7nC,KAAKsoC,WACHzgC,IAAI,YAAa7H,KAAKwoC,aAAcxoC,MACpC6H,IAAI,OAAQ7H,KAAK0oC,QAAS1oC,MAC1B6H,IAAI,UAAW7H,KAAK4oC,WAAY5oC,MAElCA,KAAKsoC,WAAWtmB,UAChBviB,EAAEwO,QAAQ4C,YAAY7Q,KAAKkxC,QAAQhiB,MAAO,6BAG3CtN,MAAO,WACN,MAAO5hB,MAAKsoC,YAActoC,KAAKsoC,WAAW7qB,QAG3C+qB,aAAc,WACbxoC,KAAKkxC,QACHxe,aACA3qB,KAAK,aACLA,KAAK,cAGR2gC,QAAS,WACR,GAAInY,GAASvwB,KAAKkxC,QACjBC,EAAS5gB,EAAOX,QAChBwhB,EAAU3xC,EAAEwO,QAAQqE,YAAYie,EAAOrB,OACvCxY,EAAS6Z,EAAOzL,KAAKpH,mBAAmB0zB,EAGrCD,IACH1xC,EAAEwO,QAAQiE,YAAYi/B,EAAQC,GAG/B7gB,EAAOhC,QAAU7X,EAEjB6Z,EACExoB,KAAK,QAAS2O,OAAQA,IACtB3O,KAAK,SAGR6gC,WAAY,SAAUt3B,GACrBtR,KAAKkxC,QACHnpC,KAAK,WACLA,KAAK,UAAWuJ,MAUpB7R,EAAE4xC,QAAU5xC,EAAE0F,MAAMjF,QACnB6C,SACC+c,SAAU,YAGXxa,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,IAGpBuP,YAAa,WACZ,MAAOtS,MAAK+C,QAAQ+c,UAGrB5N,YAAa,SAAU4N,GACtB,GAAIuD,GAAMrjB,KAAK8kB,IAYf,OAVIzB,IACHA,EAAIiuB,cAActxC,MAGnBA,KAAK+C,QAAQ+c,SAAWA,EAEpBuD,GACHA,EAAIkuB,WAAWvxC,MAGTA,MAGRif,aAAc,WACb,MAAOjf,MAAKmd,YAGbuI,MAAO,SAAUrC,GAChBrjB,KAAK8kB,KAAOzB,CAEZ,IAAIlT,GAAYnQ,KAAKmd,WAAand,KAAKmiB,MAAMkB,GAC5C1U,EAAM3O,KAAKsS,cACXk/B,EAASnuB,EAAIouB,gBAAgB9iC,EAU9B,OARAlP,GAAEwO,QAAQyC,SAASP,EAAW,mBAEA,KAA1BxB,EAAIpL,QAAQ,UACfiuC,EAAOzrB,aAAa5V,EAAWqhC,EAAOxrB,YAEtCwrB,EAAOphC,YAAYD,GAGbnQ,MAGR0xC,WAAY,SAAUruB,GACrB,GAAI1U,GAAM3O,KAAKsS,cACdk/B,EAASnuB,EAAIouB,gBAAgB9iC,EAS9B,OAPA6iC,GAAO3wB,YAAY7gB,KAAKmd,YACxBnd,KAAK8kB,KAAO,KAER9kB,KAAKoc,UACRpc,KAAKoc,SAASiH,GAGRrjB,MAGR2xC,cAAe,WACV3xC,KAAK8kB,MACR9kB,KAAK8kB,KAAK7F,eAAe0xB,WAK5BlxC,EAAEmyC,QAAU,SAAU7uC,GACrB,MAAO,IAAItD,GAAE4xC,QAAQtuC,IAMtBtD,EAAEuY,IAAI/R,SACLsrC,WAAY,SAAUK,GAErB,MADAA,GAAQlsB,MAAM1lB,MACPA,MAGRsxC,cAAe,SAAUM,GAExB,MADAA,GAAQF,WAAW1xC,MACZA,MAGRggB,gBAAiB,WAMhB,QAAS6xB,GAAaC,EAAOC,GAC5B,GAAI7hC,GAAY8hC,EAAIF,EAAQ,IAAME,EAAID,CAEtCE,GAAQH,EAAQC,GAAStyC,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAWC,GAR7D,GAAI8hC,GAAUjyC,KAAKyxC,mBAClBO,EAAI,WACJ7hC,EAAYnQ,KAAKkyC,kBAChBzyC,EAAEwO,QAAQ+B,OAAO,MAAOgiC,EAAI,oBAAqBhyC,KAAKmd,WAQxD00B,GAAa,MAAO,QACpBA,EAAa,MAAO,SACpBA,EAAa,SAAU,QACvBA,EAAa,SAAU,UAGxBv0B,iBAAkB,WACjBtd,KAAKmd,WAAW0D,YAAY7gB,KAAKkyC,sBASnCzyC,EAAE4xC,QAAQc,KAAO1yC,EAAE4xC,QAAQnxC,QAC1B6C,SACC+c,SAAU,UACVsyB,WAAY,IACZC,YAAa,UACbC,YAAa,IACbC,aAAc,YAGfpwB,MAAO,SAAUkB,GAChB,GAAImvB,GAAW,uBACdriC,EAAY1Q,EAAEwO,QAAQ+B,OAAO,MAAOwiC,EAAW,eAchD,OAZAxyC,MAAK8kB,KAAOzB,EAEZrjB,KAAKyyC,cAAiBzyC,KAAK0yC,cAC1B1yC,KAAK+C,QAAQqvC,WAAYpyC,KAAK+C,QAAQsvC,YACtCG,EAAW,MAAQriC,EAAWnQ,KAAK2yC,QAAU3yC,MAC9CA,KAAK4yC,eAAiB5yC,KAAK0yC,cAC1B1yC,KAAK+C,QAAQuvC,YAAatyC,KAAK+C,QAAQwvC,aACvCC,EAAW,OAAQriC,EAAWnQ,KAAK6yC,SAAU7yC,MAE9CA,KAAK8yC,kBACLzvB,EAAIzb,GAAG,2BAA4B5H,KAAK8yC,gBAAiB9yC,MAElDmQ,GAGRiM,SAAU,SAAUiH,GACnBA,EAAIxb,IAAI,2BAA4B7H,KAAK8yC,gBAAiB9yC,OAG3D2yC,QAAS,SAAUrhC,GAClBtR,KAAK8kB,KAAKpL,OAAOpI,EAAEw1B,SAAW,EAAI,IAGnC+L,SAAU,SAAUvhC,GACnBtR,KAAK8kB,KAAKlL,QAAQtI,EAAEw1B,SAAW,EAAI,IAGpC4L,cAAe,SAAUjiB,EAAMzC,EAAO9d,EAAWC,EAAWlP,EAAIS,GAC/D,GAAIqxC,GAAOtzC,EAAEwO,QAAQ+B,OAAO,IAAKE,EAAWC,EAC5C4iC,GAAK1rB,UAAYoJ,EACjBsiB,EAAKjgB,KAAO,IACZigB,EAAK/kB,MAAQA,CAEb,IAAIuG,GAAO90B,EAAEiT,SAAS0d,eAUtB,OARA3wB,GAAEiT,SACA9K,GAAGmrC,EAAM,QAASxe,GAClB3sB,GAAGmrC,EAAM,YAAaxe,GACtB3sB,GAAGmrC,EAAM,WAAYxe,GACrB3sB,GAAGmrC,EAAM,QAAStzC,EAAEiT,SAASC,gBAC7B/K,GAAGmrC,EAAM,QAAS9xC,EAAIS,GACtBkG,GAAGmrC,EAAM,QAAS/yC,KAAK2xC,cAAejwC,GAEjCqxC,GAGRD,gBAAiB,WAChB,GAAIzvB,GAAMrjB,KAAK8kB,KACd5U,EAAY,kBAEbzQ,GAAEwO,QAAQ4C,YAAY7Q,KAAKyyC,cAAeviC,GAC1CzQ,EAAEwO,QAAQ4C,YAAY7Q,KAAK4yC,eAAgB1iC,GAEvCmT,EAAI5J,QAAU4J,EAAIxF,cACrBpe,EAAEwO,QAAQyC,SAAS1Q,KAAK4yC,eAAgB1iC,GAErCmT,EAAI5J,QAAU4J,EAAItF,cACrBte,EAAEwO,QAAQyC,SAAS1Q,KAAKyyC,cAAeviC,MAK1CzQ,EAAEuY,IAAI9R,cACL8sC,aAAa,IAGdvzC,EAAEuY,IAAI7R,YAAY,WACbnG,KAAK+C,QAAQiwC,cAChBhzC,KAAKgzC,YAAc,GAAIvzC,GAAE4xC,QAAQc,KACjCnyC,KAAKuxC,WAAWvxC,KAAKgzC,gBAIvBvzC,EAAEmyC,QAAQz6B,KAAO,SAAUpU,GAC1B,MAAO,IAAItD,GAAE4xC,QAAQc,KAAKpvC,IAS3BtD,EAAE4xC,QAAQ4B,YAAcxzC,EAAE4xC,QAAQnxC,QACjC6C,SACC+c,SAAU,cACV6S,OAAQ,wFAGTrtB,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,GAEnB/C,KAAKkzC,kBAGN/wB,MAAO,SAAUkB,GAChBrjB,KAAKmd,WAAa1d,EAAEwO,QAAQ+B,OAAO,MAAO,+BAC1CvQ,EAAEiT,SAASqgB,wBAAwB/yB,KAAKmd,WAExC,KAAK,GAAI/c,KAAKijB,GAAItK,QACbsK,EAAItK,QAAQ3Y,GAAG6lB,gBAClBjmB,KAAKmzC,eAAe9vB,EAAItK,QAAQ3Y,GAAG6lB,iBAUrC,OANA5C,GACEzb,GAAG,WAAY5H,KAAKozC,YAAapzC,MACjC4H,GAAG,cAAe5H,KAAKqzC,eAAgBrzC,MAEzCA,KAAKolB,UAEEplB,KAAKmd,YAGbf,SAAU,SAAUiH,GACnBA,EACExb,IAAI,WAAY7H,KAAKozC,aACrBvrC,IAAI,cAAe7H,KAAKqzC,iBAI3BC,UAAW,SAAU3gB,GAGpB,MAFA3yB,MAAK+C,QAAQ4vB,OAASA,EACtB3yB,KAAKolB,UACEplB,MAGRmzC,eAAgB,SAAUI,GACzB,MAAKA,IAEAvzC,KAAKkzC,cAAcK,KACvBvzC,KAAKkzC,cAAcK,GAAQ,GAE5BvzC,KAAKkzC,cAAcK,KAEnBvzC,KAAKolB,UAEEplB,MATP,QAYDwzC,kBAAmB,SAAUD,GAC5B,MAAKA,IAEDvzC,KAAKkzC,cAAcK,KACtBvzC,KAAKkzC,cAAcK,KACnBvzC,KAAKolB,WAGCplB,MAPP,QAUDolB,QAAS,WACR,GAAKplB,KAAK8kB,KAAV,CAEA,GAAI2uB,KAEJ,KAAK,GAAIrzC,KAAKJ,MAAKkzC,cACdlzC,KAAKkzC,cAAc9yC,IACtBqzC,EAAQrwC,KAAKhD,EAIf,IAAIszC,KAEA1zC,MAAK+C,QAAQ4vB,QAChB+gB,EAAiBtwC,KAAKpD,KAAK+C,QAAQ4vB,QAEhC8gB,EAAQ3yC,QACX4yC,EAAiBtwC,KAAKqwC,EAAQjwC,KAAK,OAGpCxD,KAAKmd,WAAWkK,UAAYqsB,EAAiBlwC,KAAK,SAGnD4vC,YAAa,SAAU9hC,GAClBA,EAAEqK,MAAMsK,gBACXjmB,KAAKmzC,eAAe7hC,EAAEqK,MAAMsK,mBAI9BotB,eAAgB,SAAU/hC,GACrBA,EAAEqK,MAAMsK,gBACXjmB,KAAKwzC,kBAAkBliC,EAAEqK,MAAMsK,qBAKlCxmB,EAAEuY,IAAI9R,cACLytC,oBAAoB,IAGrBl0C,EAAEuY,IAAI7R,YAAY,WACbnG,KAAK+C,QAAQ4wC,qBAChB3zC,KAAK2zC,oBAAqB,GAAKl0C,GAAE4xC,QAAQ4B,aAAevtB,MAAM1lB,SAIhEP,EAAEmyC,QAAQrtB,YAAc,SAAUxhB,GACjC,MAAO,IAAItD,GAAE4xC,QAAQ4B,YAAYlwC,IAQlCtD,EAAE4xC,QAAQuC,MAAQn0C,EAAE4xC,QAAQnxC,QAC3B6C,SACC+c,SAAU,aACVtQ,SAAU,IACVqkC,QAAQ,EACRC,UAAU,EACVpvB,gBAAgB,GAGjBvC,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,CAEZ,IAAInT,GAAY,wBACfC,EAAY1Q,EAAEwO,QAAQ+B,OAAO,MAAOE,GACpCnN,EAAU/C,KAAK+C,OAOhB,OALA/C,MAAK+zC,WAAWhxC,EAASmN,EAAWC,GAEpCkT,EAAIzb,GAAG7E,EAAQ2hB,eAAiB,UAAY,OAAQ1kB,KAAKolB,QAASplB,MAClEqjB,EAAIpB,UAAUjiB,KAAKolB,QAASplB,MAErBmQ,GAGRiM,SAAU,SAAUiH,GACnBA,EAAIxb,IAAI7H,KAAK+C,QAAQ2hB,eAAiB,UAAY,OAAQ1kB,KAAKolB,QAASplB,OAGzE+zC,WAAY,SAAUhxC,EAASmN,EAAWC,GACrCpN,EAAQ8wC,SACX7zC,KAAKg0C,QAAUv0C,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAY,QAASC,IAEzDpN,EAAQ+wC,WACX9zC,KAAKi0C,QAAUx0C,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAY,QAASC,KAI9DiV,QAAS,WACR,GAAIrY,GAAS/M,KAAK8kB,KAAKxK,YACtB45B,EAAYnnC,EAAOJ,YAAYuG,IAC/BihC,EAAkB,QAAU5xC,KAAKiR,GAAKjR,KAAKiS,IAAI0/B,EAAY3xC,KAAKiR,GAAK,KACrEguB,EAAO2S,GAAmBpnC,EAAO2I,eAAevC,IAAMpG,EAAO0I,eAAetC,KAAO,IAEnFiL,EAAOpe,KAAK8kB,KAAKhY,UACjB/J,EAAU/C,KAAK+C,QACfqxC,EAAY,CAETh2B,GAAKlT,EAAI,IACZkpC,EAAY5S,GAAQz+B,EAAQyM,SAAW4O,EAAKlT,IAG7ClL,KAAKq0C,cAActxC,EAASqxC,IAG7BC,cAAe,SAAUtxC,EAASqxC,GAC7BrxC,EAAQ8wC,QAAUO,GACrBp0C,KAAKs0C,cAAcF,GAGhBrxC,EAAQ+wC,UAAYM,GACvBp0C,KAAKu0C,gBAAgBH,IAIvBE,cAAe,SAAUF,GACxB,GAAII,GAASx0C,KAAKy0C,aAAaL,EAE/Bp0C,MAAKg0C,QAAQnqC,MAAM0F,MAAQvP,KAAK00C,eAAeF,EAASJ,GAAa,KACrEp0C,KAAKg0C,QAAQ3sB,UAAqB,IAATmtB,EAAgBA,EAAS,KAAQA,EAAS,IAAQ,OAG5ED,gBAAiB,SAAUH,GAC1B,GAECO,GAAUC,EAAOC,EAFdC,EAAsB,UAAZV,EACbtmC,EAAQ9N,KAAKi0C,OAGVa,GAAU,MACbH,EAAWG,EAAU,KACrBF,EAAQ50C,KAAKy0C,aAAaE,GAE1B7mC,EAAMjE,MAAM0F,MAAQvP,KAAK00C,eAAeE,EAAQD,GAAY,KAC5D7mC,EAAMuZ,UAAYutB,EAAQ,QAG1BC,EAAO70C,KAAKy0C,aAAaK,GAEzBhnC,EAAMjE,MAAM0F,MAAQvP,KAAK00C,eAAeG,EAAOC,GAAW,KAC1DhnC,EAAMuZ,UAAYwtB,EAAO,QAI3BH,eAAgB,SAAUK,GACzB,MAAOxyC,MAAKC,MAAMxC,KAAK+C,QAAQyM,SAAWulC,GAAS,IAGpDN,aAAc,SAAUryC,GACvB,GAAI4yC,GAAQzyC,KAAKD,IAAI,IAAKC,KAAKwJ,MAAM3J,GAAO,IAAItB,OAAS,GACxD0M,EAAIpL,EAAM4yC,CAIX,OAFAxnC,GAAIA,GAAK,GAAK,GAAKA,GAAK,EAAI,EAAIA,GAAK,EAAI,EAAIA,GAAK,EAAI,EAAI,EAEnDwnC,EAAQxnC,KAIjB/N,EAAEmyC,QAAQ9jC,MAAQ,SAAU/K,GAC3B,MAAO,IAAItD,GAAE4xC,QAAQuC,MAAM7wC,IAQ5BtD,EAAE4xC,QAAQ4D,OAASx1C,EAAE4xC,QAAQnxC,QAC5B6C,SACCmyC,WAAW,EACXp1B,SAAU,WACVq1B,YAAY,GAGb7vC,WAAY,SAAU8vC,EAAYC,EAAUtyC,GAC3CtD,EAAEqD,WAAW9C,KAAM+C,GAEnB/C,KAAK+Y,WACL/Y,KAAKs1C,YAAc,EACnBt1C,KAAKu1C,gBAAiB,CAEtB,KAAK,GAAIn1C,KAAKg1C,GACbp1C,KAAKw1C,UAAUJ,EAAWh1C,GAAIA,EAG/B,KAAKA,IAAKi1C,GACTr1C,KAAKw1C,UAAUH,EAASj1C,GAAIA,GAAG,IAIjC+hB,MAAO,SAAUkB,GAQhB,MAPArjB,MAAKsY,cACLtY,KAAKolB,UAEL/B,EACEzb,GAAG,WAAY5H,KAAKy1C,eAAgBz1C,MACpC4H,GAAG,cAAe5H,KAAKy1C,eAAgBz1C,MAElCA,KAAKmd,YAGbf,SAAU,SAAUiH,GACnBA,EACExb,IAAI,WAAY7H,KAAKy1C,gBACrB5tC,IAAI,cAAe7H,KAAKy1C,iBAG3BC,aAAc,SAAU/5B,EAAOzX,GAG9B,MAFAlE,MAAKw1C,UAAU75B,EAAOzX,GACtBlE,KAAKolB,UACEplB,MAGR21C,WAAY,SAAUh6B,EAAOzX,GAG5B,MAFAlE,MAAKw1C,UAAU75B,EAAOzX,GAAM,GAC5BlE,KAAKolB,UACEplB,MAGRmc,YAAa,SAAUR,GACtB,GAAI9W,GAAKpF,EAAE4B,MAAMsa,EAGjB,cAFO3b,MAAK+Y,QAAQlU,GACpB7E,KAAKolB,UACEplB,MAGRsY,YAAa,WACZ,GAAIpI,GAAY,yBACfC,EAAYnQ,KAAKmd,WAAa1d,EAAEwO,QAAQ+B,OAAO,MAAOE,EAGvDC,GAAUzF,aAAa,iBAAiB,GAEnCjL,EAAEmL,QAAQR,MAKd3K,EAAEiT,SAAS9K,GAAGuI,EAAW,QAAS1Q,EAAEiT,SAAS0d,iBAJ7C3wB,EAAEiT,SACAqgB,wBAAwB5iB,GACxBijB,yBAAyBjjB,EAK5B,IAAIylC,GAAO51C,KAAK61C,MAAQp2C,EAAEwO,QAAQ+B,OAAO,OAAQE,EAAY,QAE7D,IAAIlQ,KAAK+C,QAAQmyC,UAAW,CACtBz1C,EAAEmL,QAAQnC,SACdhJ,EAAEiT,SACA9K,GAAGuI,EAAW,YAAanQ,KAAK81C,QAAS91C,MACzC4H,GAAGuI,EAAW,WAAYnQ,KAAK+1C,UAAW/1C,KAE7C,IAAI+yC,GAAO/yC,KAAKg2C,YAAcv2C,EAAEwO,QAAQ+B,OAAO,IAAKE,EAAY,UAAWC,EAC3E4iC,GAAKjgB,KAAO,IACZigB,EAAK/kB,MAAQ,SAETvuB,EAAEmL,QAAQR,MACb3K,EAAEiT,SACA9K,GAAGmrC,EAAM,QAAStzC,EAAEiT,SAAS6hB,MAC7B3sB,GAAGmrC,EAAM,QAAS/yC,KAAK81C,QAAS91C,MAGlCP,EAAEiT,SAAS9K,GAAGmrC,EAAM,QAAS/yC,KAAK81C,QAAS91C,MAG5CP,EAAEiT,SAAS9K,GAAGguC,EAAM,QAAS,WAC5B3zC,WAAWxC,EAAEuB,KAAKhB,KAAKi2C,cAAej2C,MAAO,IAC3CA,MAEHA,KAAK8kB,KAAKld,GAAG,QAAS5H,KAAK+1C,UAAW/1C,UAGtCA,MAAK81C,SAGN91C,MAAKk2C,gBAAkBz2C,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAY,QAAS0lC,GACpE51C,KAAKm2C,WAAa12C,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAY,aAAc0lC,GACpE51C,KAAKo2C,cAAgB32C,EAAEwO,QAAQ+B,OAAO,MAAOE,EAAY,YAAa0lC,GAEtEzlC,EAAUC,YAAYwlC,IAGvBJ,UAAW,SAAU75B,EAAOzX,EAAMmyC,GACjC,GAAIxxC,GAAKpF,EAAE4B,MAAMsa,EAEjB3b,MAAK+Y,QAAQlU,IACZ8W,MAAOA,EACPzX,KAAMA,EACNmyC,QAASA,GAGNr2C,KAAK+C,QAAQoyC,YAAcx5B,EAAMwK,YACpCnmB,KAAKs1C,cACL35B,EAAMwK,UAAUnmB,KAAKs1C,eAIvBlwB,QAAS,WACR,GAAKplB,KAAKmd,WAAV,CAIAnd,KAAKk2C,gBAAgB7uB,UAAY,GACjCrnB,KAAKo2C,cAAc/uB,UAAY,EAE/B,IAECjnB,GAAGc,EAFAo1C,GAAoB,EACvBC,GAAkB,CAGnB,KAAKn2C,IAAKJ,MAAK+Y,QACd7X,EAAMlB,KAAK+Y,QAAQ3Y,GACnBJ,KAAKw2C,SAASt1C,GACdq1C,EAAkBA,GAAmBr1C,EAAIm1C,QACzCC,EAAoBA,IAAsBp1C,EAAIm1C,OAG/Cr2C,MAAKm2C,WAAWtsC,MAAM0vB,QAAUgd,GAAmBD,EAAoB,GAAK,SAG7Eb,eAAgB,SAAUnkC,GACzB,GAAIpQ,GAAMlB,KAAK+Y,QAAQtZ,EAAE4B,MAAMiQ,EAAEqK,OAEjC,IAAKza,EAAL,CAEKlB,KAAKu1C,gBACTv1C,KAAKolB,SAGN,IAAIze,GAAOzF,EAAIm1C,QACF,aAAX/kC,EAAE3K,KAAsB,aAAe,gBAC5B,aAAX2K,EAAE3K,KAAsB,kBAAoB,IAE1CA,IACH3G,KAAK8kB,KAAK/c,KAAKpB,EAAMzF,KAKvBu1C,oBAAqB,SAAUvyC,EAAMwyC,GAEpC,GAAIC,GAAY,qEAAuEzyC,EAAO,GAC1FwyC,KACHC,GAAa,sBAEdA,GAAa,IAEb,IAAIC,GAAgBt3C,EAASkL,cAAc,MAG3C,OAFAosC,GAAcvvB,UAAYsvB,EAEnBC,EAAc5wB,YAGtBwwB,SAAU,SAAUt1C,GACnB,GACC21C,GADGC,EAAQx3C,EAASkL,cAAc,SAElCksC,EAAU12C,KAAK8kB,KAAKzI,SAASnb,EAAIya,MAE9Bza,GAAIm1C,SACPQ,EAAQv3C,EAASkL,cAAc,SAC/BqsC,EAAMlwC,KAAO,WACbkwC,EAAM3mC,UAAY,kCAClB2mC,EAAME,eAAiBL,GAEvBG,EAAQ72C,KAAKy2C,oBAAoB,sBAAuBC,GAGzDG,EAAMG,QAAUv3C,EAAE4B,MAAMH,EAAIya,OAE5Blc,EAAEiT,SAAS9K,GAAGivC,EAAO,QAAS72C,KAAKi2C,cAAej2C,KAElD,IAAIkE,GAAO5E,EAASkL,cAAc,OAClCtG,GAAKmjB,UAAY,IAAMnmB,EAAIgD,KAE3B4yC,EAAM1mC,YAAYymC,GAClBC,EAAM1mC,YAAYlM,EAElB,IAAIiM,GAAYjP,EAAIm1C,QAAUr2C,KAAKo2C,cAAgBp2C,KAAKk2C,eAGxD,OAFA/lC,GAAUC,YAAY0mC,GAEfA,GAGRb,cAAe,WACd,GAAI71C,GAAGy2C,EAAO31C,EACb+1C,EAASj3C,KAAK61C,MAAMjoB,qBAAqB,SACzCspB,EAAYD,EAAOn2C,MAIpB,KAFAd,KAAKu1C,gBAAiB,EAEjBn1C,EAAI,EAAO82C,EAAJ92C,EAAeA,IAC1By2C,EAAQI,EAAO72C,GACfc,EAAMlB,KAAK+Y,QAAQ89B,EAAMG,SAErBH,EAAMH,UAAY12C,KAAK8kB,KAAKzI,SAASnb,EAAIya,OAC5C3b,KAAK8kB,KAAKpJ,SAASxa,EAAIya,QAEZk7B,EAAMH,SAAW12C,KAAK8kB,KAAKzI,SAASnb,EAAIya,QACnD3b,KAAK8kB,KAAK3I,YAAYjb,EAAIya,MAI5B3b,MAAKu1C,gBAAiB,EAEtBv1C,KAAK2xC,iBAGNmE,QAAS,WACRr2C,EAAEwO,QAAQyC,SAAS1Q,KAAKmd,WAAY,oCAGrC44B,UAAW,WACV/1C,KAAKmd,WAAWjN,UAAYlQ,KAAKmd,WAAWjN,UAAUvN,QAAQ,mCAAoC,OAIpGlD,EAAEmyC,QAAQz4B,OAAS,SAAUi8B,EAAYC,EAAUtyC,GAClD,MAAO,IAAItD,GAAE4xC,QAAQ4D,OAAOG,EAAYC,EAAUtyC,IAQnDtD,EAAE03C,aAAe13C,EAAE0F,MAAMjF,QACxB2F,SAAUpG,EAAE6G,MAAMC,OAElB6wC,IAAK,SAAU/oC,EAAIshC,EAAQ1F,EAAU9B,GACpCnoC,KAAKu0B,OAELv0B,KAAKq3C,IAAMhpC,EACXrO,KAAKixC,aAAc,EACnBjxC,KAAKsnC,QAAUqI,EAEf3vC,KAAK+H,KAAK,SAEVsG,EAAGxE,MAAMpK,EAAEwO,QAAQsE,YAAc,QAAU03B,GAAY,KACtD,uBAAyB9B,GAAiB,IAAO,MAElD1oC,EAAEiT,SAAS9K,GAAGyG,EAAI5O,EAAEwO,QAAQuE,eAAgBxS,KAAKs3C,iBAAkBt3C,MACnEP,EAAEwO,QAAQiE,YAAY7D,EAAIshC,GAG1BlwC,EAAEQ,KAAKiC,QAAQmM,EAAGujB,aAGlB5xB,KAAKu3C,WAAaC,YAAY/3C,EAAEuB,KAAKhB,KAAKy3C,QAASz3C,MAAO,KAG3Du0B,KAAM,WACAv0B,KAAKixC,cAKVxxC,EAAEwO,QAAQiE,YAAYlS,KAAKq3C,IAAKr3C,KAAK03C,WACrC13C,KAAKs3C,mBACL73C,EAAEQ,KAAKiC,QAAQlC,KAAKq3C,IAAIzlB,eAGzB6lB,QAAS,WACR,GAAIE,GAAU33C,KAAK03C,SACnB,OAAKC,IAML33C,KAAKq3C,IAAIjlC,aAAeulC,MAExB33C,MAAK+H,KAAK,aAPT/H,MAAKs3C,oBAaPM,aAAc,qDAEdF,QAAS,WACR,GAAI7oC,GAAMD,EAAKnF,EACd4E,EAAKrO,KAAKq3C,IACVxtC,EAAQxK,EAAOoP,iBAAiBJ,EAEjC,IAAI5O,EAAEmL,QAAQV,MAAO,CAEpB,GADAT,EAAUI,EAAMpK,EAAEwO,QAAQoE,WAAWyb,MAAM9tB,KAAK43C,eAC3CnuC,EAAW,MAChBoF,GAAOwE,WAAW5J,EAAQ,IAC1BmF,EAAOyE,WAAW5J,EAAQ,QAE1BoF,GAAOwE,WAAWxJ,EAAMgF,MACxBD,EAAOyE,WAAWxJ,EAAM+E,IAGzB,OAAO,IAAInP,GAAEwL,MAAM4D,EAAMD,GAAK,IAG/B0oC,iBAAkB,WACjB73C,EAAEiT,SAAS7K,IAAI7H,KAAKq3C,IAAK53C,EAAEwO,QAAQuE,eAAgBxS,KAAKs3C,iBAAkBt3C,MAErEA,KAAKixC,cACVjxC,KAAKixC,aAAc,EAEnBjxC,KAAKq3C,IAAIxtC,MAAMpK,EAAEwO,QAAQsE,YAAc,GAIvCvS,KAAKq3C,IAAIjlC,aAAepS,KAAKsnC,QAE7BuQ,cAAc73C,KAAKu3C,YAEnBv3C,KAAK+H,KAAK,QAAQA,KAAK,WAUzBtI,EAAEuY,IAAI/R,SAEL2S,QAAS,SAAUD,EAAQxB,EAAMpU,GAUhC,GARAoU,EAAOA,IAAS5X,EAAYS,KAAKyZ,MAAQzZ,KAAKsZ,WAAWnC,GACzDwB,EAAS3Y,KAAKyb,aAAahc,EAAEkU,OAAOgF,GAASxB,EAAMnX,KAAK+C,QAAQ0V,WAChE1V,EAAUA,MAEN/C,KAAK+oC,UACR/oC,KAAK+oC,SAASxU,OAGXv0B,KAAKwZ,UAAYzW,EAAQ8V,OAAS9V,KAAY,EAAM,CAEnDA,EAAQyZ,UAAYjd,IACvBwD,EAAQoU,KAAO1X,EAAES,QAAQsc,QAASzZ,EAAQyZ,SAAUzZ,EAAQoU,MAC5DpU,EAAQoY,IAAM1b,EAAES,QAAQsc,QAASzZ,EAAQyZ,SAAUzZ,EAAQoY,KAI5D,IAAI0Y,GAAY7zB,KAAKyZ,QAAUtC,EAC/BnX,KAAK83C,kBAAoB93C,KAAK83C,iBAAiBn/B,EAAQxB,EAAMpU,EAAQoU,MACpEnX,KAAK+3C,gBAAgBp/B,EAAQ5V,EAAQoY,IAEtC,IAAI0Y,EAGH,MADA/uB,cAAa9E,KAAK+c,YACX/c,KAOT,MAFAA,MAAKqZ,WAAWV,EAAQxB,GAEjBnX,MAGRob,MAAO,SAAUC,EAAQtY,GAIxB,GAHAsY,EAAS5b,EAAE6L,MAAM+P,GAAQ7Y,QACzBO,EAAUA,OAELsY,EAAOnQ,IAAMmQ,EAAOlQ,EACxB,MAAOnL,KAkBR,IAfKA,KAAK+oC,WACT/oC,KAAK+oC,SAAW,GAAItpC,GAAE03C,aAEtBn3C,KAAK+oC,SAASnhC,IACbowC,KAAQh4C,KAAKi4C,qBACbC,IAAOl4C,KAAKm4C,qBACVn4C,OAIC+C,EAAQynC,aACZxqC,KAAK+H,KAAK,aAIPhF,EAAQyZ,WAAY,EAAO,CAC9B/c,EAAEwO,QAAQyC,SAAS1Q,KAAKkgB,SAAU,mBAElC,IAAIyvB,GAAS3vC,KAAKuf,iBAAiB/T,SAAS6P,EAC5Crb,MAAK+oC,SAASqO,IAAIp3C,KAAKkgB,SAAUyvB,EAAQ5sC,EAAQknC,UAAY,IAAMlnC,EAAQolC,mBAE3EnoC,MAAKsb,UAAUD,GACfrb,KAAK+H,KAAK,QAAQA,KAAK,UAGxB,OAAO/H,OAGRi4C,qBAAsB,WACrBj4C,KAAK+H,KAAK,SAGXowC,oBAAqB,WACpB14C,EAAEwO,QAAQ4C,YAAY7Q,KAAKkgB,SAAU,oBACrClgB,KAAK+H,KAAK,YAGXgwC,gBAAiB,SAAUp/B,EAAQ5V,GAElC,GAAIsY,GAASrb,KAAKuiB,iBAAiB5J,GAAQ3M,QAG3C,QAAKjJ,GAAWA,EAAQyZ,YAAa,GAASxc,KAAK8M,UAAUV,SAASiP,IAEtErb,KAAKob,MAAMC,EAAQtY,IAEZ,IAJiF,KAc1FtD,EAAE03C,aAAe13C,EAAEwO,QAAQsE,WAAa9S,EAAE03C,aAAe13C,EAAE03C,aAAaj3C,QAEvEk3C,IAAK,SAAU/oC,EAAIshC,EAAQ1F,EAAU9B,GACpCnoC,KAAKu0B,OAELv0B,KAAKq3C,IAAMhpC,EACXrO,KAAKixC,aAAc,EACnBjxC,KAAKo4C,UAAYnO,GAAY,IAC7BjqC,KAAKq4C,cAAgB,EAAI91C,KAAKgC,IAAI4jC,GAAiB,GAAK,IAExDnoC,KAAKqnC,UAAY5nC,EAAEwO,QAAQqE,YAAYjE,GACvCrO,KAAKs4C,QAAU3I,EAAOnkC,SAASxL,KAAKqnC,WACpCrnC,KAAKirC,YAAc,GAAI5mC,MAEvBrE,KAAK+H,KAAK,SAEV/H,KAAKu4C,YAGNhkB,KAAM,WACAv0B,KAAKixC,cAEVjxC,KAAKw4C,QACLx4C,KAAKy4C,cAGNF,SAAU,WAETv4C,KAAK04C,QAAUj5C,EAAEQ,KAAK8E,iBAAiB/E,KAAKu4C,SAAUv4C,MACtDA,KAAKw4C,SAGNA,MAAO,WACN,GAAIvS,IAAY,GAAI5hC,MAAUrE,KAAKirC,WAClChB,EAA4B,IAAjBjqC,KAAKo4C,SAEHnO,GAAVhE,EACHjmC,KAAK24C,UAAU34C,KAAK44C,SAAS3S,EAAUgE,KAEvCjqC,KAAK24C,UAAU,GACf34C,KAAKy4C,cAIPE,UAAW,SAAUE,GACpB,GAAIlqC,GAAM3O,KAAKqnC,UAAUh8B,IAAIrL,KAAKs4C,QAAQ1sC,WAAWitC,GACrDp5C,GAAEwO,QAAQiE,YAAYlS,KAAKq3C,IAAK1oC,GAEhC3O,KAAK+H,KAAK,SAGX0wC,UAAW,WACVh5C,EAAEQ,KAAKiF,gBAAgBlF,KAAK04C,SAE5B14C,KAAKixC,aAAc,EACnBjxC,KAAK+H,KAAK,QAGX6wC,SAAU,SAAUrb,GACnB,MAAO,GAAIh7B,KAAKD,IAAI,EAAIi7B,EAAGv9B,KAAKq4C,kBASlC54C,EAAEuY,IAAI9R,cACL4V,eAAe,EACfg9B,uBAAwB,IAGrBr5C,EAAEwO,QAAQsE,YAEb9S,EAAEuY,IAAI7R,YAAY,WAEjBnG,KAAKglB,cAAgBhlB,KAAK+C,QAAQ+Y,eAAiBrc,EAAEwO,QAAQsE,YAC5D9S,EAAEmL,QAAQV,QAAUzK,EAAEmL,QAAQlC,YAAcjJ,EAAEmL,QAAQI,YAInDhL,KAAKglB,eACRvlB,EAAEiT,SAAS9K,GAAG5H,KAAKkgB,SAAUzgB,EAAEwO,QAAQuE,eAAgBxS,KAAK+4C,oBAAqB/4C,QAKpFP,EAAEuY,IAAI/R,QAASxG,EAAEwO,QAAQsE,YAExBwmC,oBAAqB,SAAUznC,GAC1BtR,KAAKm7B,gBAAkB7pB,EAAE0nC,aAAaz1C,QAAQ,cAAgB,GACjEvD,KAAKi5C,wBAIPC,kBAAmB,WAClB,OAAQl5C,KAAKmd,WAAWg8B,uBAAuB,yBAAyBr4C,QAGzEg3C,iBAAkB,SAAUn/B,EAAQxB,EAAMpU,GAEzC,GAAI/C,KAAKm7B,eAAkB,OAAO,CAKlC,IAHAp4B,EAAUA,OAGL/C,KAAKglB,eAAiBjiB,EAAQyZ,WAAY,GAASxc,KAAKk5C,qBAC5D32C,KAAK8J,IAAI8K,EAAOnX,KAAKyZ,OAASzZ,KAAK+C,QAAQ+1C,uBAA0B,OAAO,CAG7E,IAAIhrC,GAAQ9N,KAAK8Z,aAAa3C,GAC7BkE,EAASrb,KAAKuiB,iBAAiB5J,GAAQhN,UAAU,EAAI,EAAImC,GACzDiE,EAAS/R,KAAK2d,uBAAuBpS,KAAK8P,EAG3C,OAAItY,GAAQyZ,WAAY,GAASxc,KAAK8M,UAAUV,SAASiP,IAEzDrb,KACE+H,KAAK,aACLA,KAAK,aAEP/H,KAAKslB,aAAa3M,EAAQxB,EAAMpF,EAAQjE,EAAO,MAAM,IAE9C,IARoE,GAW5EwX,aAAc,SAAU3M,EAAQxB,EAAMpF,EAAQjE,EAAO6L,EAAOy/B,GAE3Dp5C,KAAKm7B,gBAAiB,EAGtB17B,EAAEwO,QAAQyC,SAAS1Q,KAAKkgB,SAAU,qBAGlClgB,KAAKq5C,iBAAmB1gC,EACxB3Y,KAAKs5C,eAAiBniC,EAGlB1X,EAAEolC,YACLplC,EAAEolC,UAAUqC,WAAY,GAGzBlnC,KAAK+H,KAAK,YACT4Q,OAAQA,EACRxB,KAAMA,EACNpF,OAAQA,EACRjE,MAAOA,EACP6L,MAAOA,EACPy/B,UAAWA,KAIbH,qBAAsB,WAErBj5C,KAAKm7B,gBAAiB,EAEtB17B,EAAEwO,QAAQ4C,YAAY7Q,KAAKkgB,SAAU,qBAErClgB,KAAKqZ,WAAWrZ,KAAKq5C,iBAAkBr5C,KAAKs5C,gBAAgB,GAAM,GAE9D75C,EAAEolC,YACLplC,EAAEolC,UAAUqC,WAAY,SAU3BznC,EAAEsc,UAAU9V,SACXqf,aAAc,SAAUhU,GAClBtR,KAAKu5C,aACTv5C,KAAKu5C,YAAa,EAClBv5C,KAAKw5C,mBAGN,IAAIC,GAAKz5C,KAAK+mB,UACblZ,EAAYpO,EAAEwO,QAAQoE,UACtBqnC,EAAmBpoC,EAAEqI,MAAQla,EAAEwO,QAAQyD,mBAAmBJ,EAAEqI,OAAS8/B,EAAG5vC,MAAMgE,GAC9EoE,EAAWxS,EAAEwO,QAAQ6D,eAAeR,EAAExD,MAAOwD,EAAES,OAEhD0nC,GAAG5vC,MAAMgE,GAAayD,EAAE8nC,UACxBnnC,EAAW,IAAMynC,EACjBA,EAAmB,IAAMznC,GAG1BuT,aAAc,WACb,GAAIm0B,GAAQ35C,KAAKgnB,eAChByyB,EAAKz5C,KAAK+mB,SAEX4yB,GAAM9vC,MAAMsoB,WAAa,GACzBwnB,EAAM/pC,WAAWQ,YAAYupC,GAG7Bl6C,EAAEQ,KAAKiC,QAAQu3C,EAAG7nB,aAElB5xB,KAAKu5C,YAAa,GAGnBjyB,eAAgB,WACf,GAAIjE,GAAMrjB,KAAK8kB,MAEXzB,GAAQA,EAAI8X,gBAAmB9X,EAAI+pB,UAAUI,WAChDxtC,KAAK+mB,UAAUM,UAAY,GAC3BrnB,KAAK+mB,UAAUld,MAAMpK,EAAEwO,QAAQoE,WAAa,KAI9CmnC,iBAAkB,WAEjB,GAAIG,GAAQ35C,KAAKgnB,eAChByyB,EAAKz5C,KAAK+mB,UAKP6yB,EAAW55C,KAAK65C,0BAA0BJ,GAC7CK,EAAc95C,KAAK65C,0BAA0BF,EAE9C,OAAIF,IAAMG,EAAW,IAAqB,GAAdE,GAE3BH,EAAM9vC,MAAMsoB,WAAa,aACzBnyB,MAAK+5C,mBAAmBJ,KAKzBF,EAAG5vC,MAAMsoB,WAAa,SACtBsnB,EAAG5vC,MAAMpK,EAAEwO,QAAQoE,WAAa,GAGhCrS,KAAKgnB,eAAiByyB,EACtBA,EAAKz5C,KAAK+mB,UAAY4yB,EAEtB35C,KAAK+5C,mBAAmBN,OAGxB30C,cAAa9E,KAAKuqB,uBAGnBsvB,0BAA2B,SAAU1pC,GACpC,GACC/P,GAAGE,EADAumB,EAAQ1W,EAAUyd,qBAAqB,OAClC2d,EAAQ,CAEjB,KAAKnrC,EAAI,EAAGE,EAAMumB,EAAM/lB,OAAYR,EAAJF,EAASA,IACpCymB,EAAMzmB,GAAG45C,UACZzO,GAGF,OAAOA,GAAQjrC,GAIhBy5C,mBAAoB,SAAU5pC,GAC7B,GACC/P,GAAGE,EAAK2mB,EADLJ,EAAQpmB,MAAMC,UAAUC,MAAMC,KAAKuP,EAAUyd,qBAAqB,OAGtE,KAAKxtB,EAAI,EAAGE,EAAMumB,EAAM/lB,OAAYR,EAAJF,EAASA,IACxC6mB,EAAOJ,EAAMzmB,GAER6mB,EAAK+yB,WACT/yB,EAAK4B,OAASppB,EAAEQ,KAAKiC,QACrB+kB,EAAKmD,QAAU3qB,EAAEQ,KAAKiC,QACtB+kB,EAAK1mB,IAAMd,EAAEQ,KAAK+D,cAElBijB,EAAKrX,WAAWiR,YAAYoG,OAWhCxnB,EAAEuY,IAAI/R,SACLg0C,uBACCC,OAAO,EACPthC,SAAS,EACToC,QAASiD,EAAAA,EACTk8B,QAAS,IACTC,WAAY,EACZC,oBAAoB,GAGrBC,OAAQ,SAAqBv3C,GAI5B,GAFAA,EAAU/C,KAAKu6C,eAAiB96C,EAAES,OAAOF,KAAKi6C,sBAAuBl3C,IAEhEoF,UAAUqyC,YAKd,MAJAx6C,MAAKy6C,yBACJ7iC,KAAM,EACN8iC,QAAS,+BAEH16C,IAGR,IAAI26C,GAAal7C,EAAEuB,KAAKhB,KAAK46C,2BAA4B56C,MACxD66C,EAAUp7C,EAAEuB,KAAKhB,KAAKy6C,wBAAyBz6C,KAQhD,OANI+C,GAAQm3C,MACXl6C,KAAK86C,iBACJ3yC,UAAUqyC,YAAYO,cAAcJ,EAAYE,EAAS93C,GAE1DoF,UAAUqyC,YAAYQ,mBAAmBL,EAAYE,EAAS93C,GAExD/C,MAGRi7C,WAAY,WAOX,MANI9yC,WAAUqyC,aACbryC,UAAUqyC,YAAYU,WAAWl7C,KAAK86C,kBAEnC96C,KAAKu6C,iBACRv6C,KAAKu6C,eAAe3hC,SAAU,GAExB5Y,MAGRy6C,wBAAyB,SAAUU,GAClC,GAAI5tC,GAAI4tC,EAAMvjC,KACb8iC,EAAUS,EAAMT,UACR,IAANntC,EAAU,oBACH,IAANA,EAAU,uBAAyB,UAEnCvN,MAAKu6C,eAAe3hC,UAAY5Y,KAAKwZ,SACxCxZ,KAAKib,WAGNjb,KAAK+H,KAAK,iBACT6P,KAAMrK,EACNmtC,QAAS,sBAAwBA,EAAU,OAI7CE,2BAA4B,SAAUjsC,GACrC,GAAIuE,GAAMvE,EAAIm0B,OAAOsY,SACpBjoC,EAAMxE,EAAIm0B,OAAOuY,UACjB3kC,EAAS,GAAIjX,GAAEwT,OAAOC,EAAKC,GAE3BmoC,EAAc,IAAM3sC,EAAIm0B,OAAOyY,SAAW,SAC1CC,EAAcF,EAAc/4C,KAAKiS,IAAI/U,EAAEwT,OAAOM,WAAaL,GAE3DnG,EAAStN,EAAEuV,cACT9B,EAAMooC,EAAanoC,EAAMqoC,IACzBtoC,EAAMooC,EAAanoC,EAAMqoC,IAE3Bz4C,EAAU/C,KAAKu6C,cAEhB,IAAIx3C,EAAQ6V,QAAS,CACpB,GAAIzB,GAAO5U,KAAKmK,IAAI1M,KAAK4a,cAAc7N,GAAShK,EAAQiY,QACxDhb,MAAK4Y,QAAQlC,EAAQS,GAGtB,GAAIzT,IACHgT,OAAQA,EACR3J,OAAQA,EACR0uC,UAAW9sC,EAAI8sC,UAGhB,KAAK,GAAIr7C,KAAKuO,GAAIm0B,OACY,gBAAlBn0B,GAAIm0B,OAAO1iC,KACrBsD,EAAKtD,GAAKuO,EAAIm0B,OAAO1iC,GAIvBJ,MAAK+H,KAAK,gBAAiBrE,OAK5BrE,OAAQC,UAQT,SAAUD,EAAQC,EAAUC,GAI7BE,EAAEi8C,YAAc,QAEhBj8C,EAAEk8C,WACDC,MACCC,SACCC,SACC9tB,MAAO,OACPulB,KAAM,MAEPwI,QACC/tB,MAAO,OACPulB,KAAM,MAEPyI,MACChuB,MAAO,WACPulB,KAAM,YAEPpG,SACCpO,SAAU,OACVa,QAAS,QACTW,UAAW,OACXa,OAAQ,OACR7Q,OAAQ,SAGV0rB,UACC7a,QACC8a,SACCC,MAAO,UAER1b,OAAQ,MAETlQ,QACC2rB,SACCC,MAAO,aAGTvc,SACCsc,SACCC,MAAO,WACPC,KAAM,SACNlE,IAAK,gBAGPnZ,UACCoc,MAAO,+BACPe,SACCC,MAAO,UACPC,KAAM,UACNlE,IAAK,eAGP3X,WACC2b,SACCC,MAAO,WAGTE,aACCH,SACChE,IAAK,YAGPoE,MACCJ,SACCC,MAAM,aAKVI,MACCV,SACCC,SACC/gB,MACC/M,MAAO,MACPulB,KAAM,MAEPiJ,QACCxuB,MAAO,gBACPulB,KAAM,OAGRpG,SACCoP,KAAM,MACNE,aAAc,aACd3rC,OAAQ,MACR4rC,eAAgB,eAGlBT,UACCM,MACCL,SACC3I,KAAM,WACNoJ,QAAS,cAGX7rC,QACCorC,SACC3I,KAAM,gBAQX9zC,EAAEm9C,QAEFn9C,EAAEm9C,KAAKC,QAAUp9C,EAAEwwB,QAAQ/vB,QAC1B2F,SAAUpG,EAAE6G,MAAMC,OAElBjB,WAAY,SAAU+d,EAAKtgB,GAC1B/C,KAAK8kB,KAAOzB,EACZrjB,KAAKmd,WAAakG,EAAIlG,WACtBnd,KAAK88C,aAAez5B,EAAIrE,OAAOyB,YAC/BzgB,KAAK+8C,WAAa15B,EAAIrE,OAAO2B,UAGzB5d,GAAWA,EAAQi6C,eACtBj6C,EAAQi6C,aAAev9C,EAAEQ,KAAKC,UAAWF,KAAK+C,QAAQi6C,aAAcj6C,EAAQi6C,eAE7Ev9C,EAAEqD,WAAW9C,KAAM+C,IAGpBma,OAAQ,WACHld,KAAKqwB,WAET5wB,EAAEwwB,QAAQvvB,UAAUwc,OAAOtc,KAAKZ,MAEhCA,KAAK+H,KAAK,WAAaJ,QAAS3H,KAAK2G,OAErC3G,KAAK8kB,KAAK/c,KAAK,kBAAoBk1C,UAAWj9C,KAAK2G,SAGpDqb,QAAS,WACHhiB,KAAKqwB,WAEV5wB,EAAEwwB,QAAQvvB,UAAUshB,QAAQphB,KAAKZ,MAEjCA,KAAK8kB,KAAK/c,KAAK,iBAAmBk1C,UAAWj9C,KAAK2G,OAElD3G,KAAK+H,KAAK,YAAcJ,QAAS3H,KAAK2G,SAGvCihC,SAAU,WACT,GAAIvkB,GAAMrjB,KAAK8kB,IAEXzB,KACH5jB,EAAEwO,QAAQwE,uBAEV4Q,EAAIpE,eAAe0xB,QAEnB3wC,KAAKk9C,SAAW,GAAIz9C,GAAE09C,QAAQn9C,KAAK8kB,MAEnCrlB,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,QAASnd,KAAKo9C,eAAgBp9C,QAI/D6nC,YAAa,WACR7nC,KAAK8kB,OACRrlB,EAAEwO,QAAQ2E,sBAEV5S,KAAKk9C,SAASG,UACdr9C,KAAKk9C,SAAW,KAEhBz9C,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,QAASnd,KAAKo9C,eAAgBp9C,QAIhE8C,WAAY,SAAUC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,IAGpBu6C,kBAAmB,SAAU3hC,GAC5B3b,KAAK8kB,KAAK/c,KAAK,gBAAkB4T,MAAOA,EAAOshC,UAAWj9C,KAAK2G,QAIhEy2C,eAAgB,SAAU9rC,GACP,KAAdA,EAAEgf,SACLtwB,KAAKgiB,aAKRviB,EAAEm9C,KAAKnf,SAAWh+B,EAAEm9C,KAAKC,QAAQ38C,QAChC0F,SACC23C,KAAM,YAGPC,KAAM/9C,EAAEg+B,SAER16B,SACC06C,mBAAmB,EACnBC,YAAY,EACZC,WACCznB,MAAO,UACPikB,QAAS,MAEV/sB,KAAM,GAAI3tB,GAAE+wB,SACXlD,SAAU,GAAI7tB,GAAEwL,MAAM,EAAG,GACzBiF,UAAW,0CAEZ0tC,UAAW,GAAIn+C,GAAE+wB,SAChBlD,SAAU,GAAI7tB,GAAEwL,MAAM,GAAI,IAC1BiF,UAAW,6DAEZ2tC,kBAAmB,GACnBC,mBAAoB,IACpBd,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNtI,WAAW,GAEZ4lB,QAAQ,EACRgB,MAAM,EACNkJ,YAAY,EACZ3vB,aAAc,KAGf9oB,WAAY,SAAU+d,EAAKtgB,GAEtBtD,EAAEmL,QAAQR,QACbpK,KAAK+C,QAAQqqB,KAAOptB,KAAK+C,QAAQ66C,WAIlC59C,KAAK+C,QAAQ46C,UAAUjD,QAAUj7C,EAAEk8C,UAAUC,KAAKK,SAASld,SAASoc,MAGhEp4C,GAAWA,EAAQ46C,YACtB56C,EAAQ46C,UAAYl+C,EAAEQ,KAAKC,UAAWF,KAAK+C,QAAQ46C,UAAW56C,EAAQ46C,YAIvE39C,KAAK2G,KAAOlH,EAAEm9C,KAAKnf,SAAS8f,KAE5B99C,EAAEm9C,KAAKC,QAAQn8C,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB;EAGrD6kC,SAAU,WACTnoC,EAAEm9C,KAAKC,QAAQn8C,UAAUknC,SAAShnC,KAAKZ,MACnCA,KAAK8kB,OACR9kB,KAAKg+C,YAELh+C,KAAKi+C,aAAe,GAAIx+C,GAAEq1B,WAC1B90B,KAAK8kB,KAAKpJ,SAAS1b,KAAKi+C,cAExBj+C,KAAKk+C,MAAQ,GAAIz+C,GAAEg+B,YAAaz9B,KAAK+C,QAAQi6C,cAE7Ch9C,KAAKk9C,SAASiB,cAAcn+C,KAAKo+C,mBAO5Bp+C,KAAKq+C,eACTr+C,KAAKq+C,aAAe5+C,EAAE8wB,OAAOvwB,KAAK8kB,KAAKnY,aACtCygB,KAAM3tB,EAAEmxB,SACP1gB,UAAW,uBACX+c,YAAa,GAAI,IACjBK,UAAW,GAAI,MAEhBrc,QAAS,EACTmd,aAAcpuB,KAAK+C,QAAQqrB,gBAI7BpuB,KAAKq+C,aACHz2C,GAAG,YAAa5H,KAAKovC,aAAcpvC,MACnC4H,GAAG,WAAY5H,KAAKs+C,YAAat+C,MACjC4H,GAAG,UAAW5H,KAAKsvC,WAAYtvC,MAC/B4H,GAAG,YAAa5H,KAAK85B,aAAc95B,MACnC0lB,MAAM1lB,KAAK8kB,MAEb9kB,KAAK8kB,KACHld,GAAG,UAAW5H,KAAKsvC,WAAYtvC,MAC/B4H,GAAG,YAAa5H,KAAK85B,aAAc95B,MACnC4H,GAAG,mBAAoB5H,KAAKu+C,WAAYv+C,MACxC4H,GAAG,QAAS5H,KAAKw+C,SAAUx+C,MAC3B4H,GAAG,UAAW5H,KAAKu+C,WAAYv+C,QAInC6nC,YAAa,WACZpoC,EAAEm9C,KAAKC,QAAQn8C,UAAUmnC,YAAYjnC,KAAKZ,MAE1CA,KAAKy+C,yBAELz+C,KAAK0+C,gBAGL1+C,KAAK8kB,KAAK3I,YAAYnc,KAAKi+C,oBACpBj+C,MAAKi+C,mBACLj+C,MAAKg+C,SAEZh+C,KAAK8kB,KAAK3I,YAAYnc,KAAKk+C,aACpBl+C,MAAKk+C,MAEZl+C,KAAKq+C,aACHx2C,IAAI,YAAa7H,KAAKovC,aAAcpvC,MACpC6H,IAAI,WAAY7H,KAAKs+C,YAAat+C,MAClC6H,IAAI,UAAW7H,KAAKsvC,WAAYtvC,MAChC6H,IAAI,YAAa7H,KAAK85B,aAAc95B,MACtCA,KAAK8kB,KAAK3I,YAAYnc,KAAKq+C,oBACpBr+C,MAAKq+C,aAGZr+C,KAAK2+C,eAEL3+C,KAAK8kB,KACHjd,IAAI,UAAW7H,KAAKsvC,WAAYtvC,MAChC6H,IAAI,YAAa7H,KAAK85B,aAAc95B,MACpC6H,IAAI,UAAW7H,KAAKsvC,WAAYtvC,MAChC6H,IAAI,UAAW7H,KAAKu+C,WAAYv+C,MAChC6H,IAAI,QAAS7H,KAAKw+C,SAAUx+C,OAG/B4+C,iBAAkB,WACjB,KAAI5+C,KAAKg+C,SAASl9C,QAAU,GAA5B,CAIA,GAAI+9C,GAAa7+C,KAAKg+C,SAASt0B,MAC9Bo1B,EAAO9+C,KAAKk+C,MACZxnC,EAAS1W,KAAKk+C,MAAMhgB,cAAc4gB,EAAK/gB,aAAaj9B,OAAS,EAAG,GAAG,EAEpEd,MAAKi+C,aAAa9hC,YAAY0iC,GAE1BC,EAAK/gB,aAAaj9B,OAAS,GAC9Bd,KAAK8kB,KAAK3I,YAAY2iC,GAGvB9+C,KAAK++C,eAAeroC,GAAQ,KAG7BsoC,UAAW,SAAUtoC,GACpB,GAAIuoC,GAAgBj/C,KAAKg+C,SAASl9C,MAElC,OAAIm+C,GAAgB,IAAMj/C,KAAK+C,QAAQ06C,mBAAqBz9C,KAAKk+C,MAAMgB,oBAAoBxoC,OAC1F1W,MAAKm/C,qBAGGn/C,KAAKo/C,aACbp/C,KAAKq/C,oBAGNr/C,KAAKg+C,SAAS56C,KAAKpD,KAAKs/C,cAAc5oC,IAEtC1W,KAAKk+C,MAAMjgB,UAAUvnB,GAEkB,IAAnC1W,KAAKk+C,MAAMngB,aAAaj9B,QAC3Bd,KAAK8kB,KAAKpJ,SAAS1b,KAAKk+C,WAGzBl+C,MAAK++C,eAAeroC,GAAQ,KAG7B6oC,cAAe,WACVv/C,KAAKg+C,SAASl9C,QAAU,IAI5Bd,KAAKs9C,oBACLt9C,KAAKgiB,UAEDhiB,KAAK+C,QAAQ26C,YAChB19C,KAAKkd,WAIPsiC,aAAc,WACb,GAAIxyC,GAAahN,KAAKk+C,MAAMgB,oBAAoBl/C,KAAKk+C,MAAMngB,aAAa,IAAI,EAE5E,QAAM/9B,KAAK+C,QAAQ06C,mBAAqBzwC,IAAgBhN,KAAKy/C,oBAC5Dz/C,MAAKm/C,qBAINn/C,KAAKs9C,oBACLt9C,KAAKgiB,eACDhiB,KAAK+C,QAAQ26C,YAChB19C,KAAKkd,YAMPuiC,cAAe,WACd,OAAO,GAGRlB,WAAY,WACXv+C,KAAK0/C,gBAGN5lB,aAAc,SAAUxoB,GACvB,GAAIq+B,GAAS3vC,KAAK8kB,KAAKlF,uBAAuBtO,EAAEyQ,cAChD,KAAIzQ,EAAEyQ,cAAc49B,QAAUruC,EAAEyQ,cAAc69B,UAAW5/C,KAAKg+C,SAASl9C,OAAQ,CAC9E,GAAI++C,GAAU7/C,KAAK8kB,KAAKzF,mBAAmBrf,KAAKg+C,SAASh+C,KAAKg+C,SAASl9C,OAAS,GAAG8tB,YAC/Etd,GAAEyQ,cAAc49B,OACnBhQ,EAAOzkC,EAAI20C,EAAQ30C,EAEXoG,EAAEyQ,cAAc69B,UACxBjQ,EAAOxkC,EAAI00C,EAAQ10C,GAGrB,GAAIuL,GAAS1W,KAAK8kB,KAAKpH,mBAAmBiyB,EAI1C3vC,MAAK8/C,eAAiBppC,EAEtB1W,KAAK+/C,eAAerpC,GAGpB1W,KAAK0/C,aAAa/P,GAGlB3vC,KAAKq+C,aAAaxvB,UAAUnY,GAE5BjX,EAAEiT,SAASC,eAAerB,EAAEyQ,gBAG7Bg9B,eAAgB,SAAUroC,EAAQspC,GACjChgD,KAAK8kB,KAAK/c,KAAK,mBAAqBoR,OAAQnZ,KAAKi+C,eACjDj+C,KAAKigD,uBAELjgD,KAAKkgD,sBAAsBxpC,EAAQspC,GAEnChgD,KAAK2+C,eAEL3+C,KAAK+/C,kBAGN3Q,aAAc,SAAU99B,GACvB,GAAIyQ,GAAgBzQ,EAAEyQ,aACtB/hB,MAAKmgD,iBAAmB1gD,EAAE6L,MAAMyW,EAAckjB,QAASljB,EAAcmjB,UAGtEoK,WAAY,SAAUh+B,GACrB,GAAItR,KAAKmgD,iBAAkB,CAG1B,GAAI3hB,GAAW/+B,EAAE6L,MAAMgG,EAAEyQ,cAAckjB,QAAS3zB,EAAEyQ,cAAcmjB,SAC9Dj5B,WAAWjM,KAAKmgD,iBAClB,IAAI59C,KAAK8J,IAAImyB,GAAY,GAAKn/B,EAAOkK,kBAAoB,GAAI,CAC5D,IAAI+H,EAAEyQ,cAAc49B,QAAUruC,EAAEyQ,cAAc69B,UAAW5/C,KAAKg+C,SAASl9C,OAAQ,CAC9E,GAAIs/C,GAAapgD,KAAKg+C,SAASh+C,KAAKg+C,SAASl9C,OAAS,GAAG8tB,WACrDtd,GAAEyQ,cAAc49B,OACnBruC,EAAEoF,OAAOvD,IAAMitC,EAAWjtC,IAElB7B,EAAEyQ,cAAc69B,UACxBtuC,EAAEoF,OAAOxD,IAAMktC,EAAWltC,KAG5BlT,KAAKg/C,UAAU1tC,EAAEoF,SAGnB1W,KAAKmgD,iBAAmB,MAGzB3B,SAAU,SAAUltC,GAEf7R,EAAEmL,QAAQR,QACbpK,KAAKovC,aAAa99B,GAClBtR,KAAKsvC,WAAWh+B,KAIlBgtC,YAAa,WACRt+C,KAAKk9C,UACRl9C,KAAKk9C,SAASoB,YAAY19C,KAAKZ,KAAKk9C,WAItC+C,qBAAsB,WACrB,GAAII,GAAcrgD,KAAKg+C,SAASl9C,MAE5Bu/C,GAAc,GACjBrgD,KAAKg+C,SAASqC,EAAc,GAAGz4C,GAAG,QAAS5H,KAAKw/C,aAAcx/C,MAI3DqgD,EAAc,GACjBrgD,KAAKg+C,SAASqC,EAAc,GAAGx4C,IAAI,QAAS7H,KAAKw/C,aAAcx/C,OAIjEs/C,cAAe,SAAU5oC,GACxB,GAAI6Z,GAAS,GAAI9wB,GAAEsuB,OAAOrX,GACzB0W,KAAMptB,KAAK+C,QAAQqqB,KACnBgB,aAA0C,EAA5BpuB,KAAK+C,QAAQqrB,cAK5B,OAFApuB,MAAKi+C,aAAaviC,SAAS6U,GAEpBA,GAGRmvB,aAAc,SAAU/P,GACvB,GAAI0Q,GAAcrgD,KAAKg+C,SAASl9C,MAE5Bu/C,GAAc,IACjB1Q,EAASA,GAAU3vC,KAAK8kB,KAAKzF,mBAAmBrf,KAAK8/C,gBAGrD9/C,KAAK2+C,eACL3+C,KAAKsgD,WACJtgD,KAAK8kB,KAAKzF,mBAAmBrf,KAAKg+C,SAASqC,EAAc,GAAGzxB,aAC5D+gB,KAKHoQ,eAAgB,SAAUpsC,GACzB,GAAI4/B,GAAOvzC,KAAKo+C,iBAEZzqC,IACH3T,KAAKk9C,SAASqD,eAAe5sC,GAGzB3T,KAAKo/C,aACTp/C,KAAKk9C,SAASiB,cAAc5K,IAI9B+M,WAAY,SAAUE,EAAQC,GAC7B,GAKCC,GACAC,EACAC,EAPG9/C,EAASyB,KAAKwJ,MAAMxJ,KAAK2J,KAAK3J,KAAKD,IAAKm+C,EAAOv1C,EAAIs1C,EAAOt1C,EAAI,GAAK3I,KAAKD,IAAKm+C,EAAOt1C,EAAIq1C,EAAOr1C,EAAI,KACtG0yC,EAAoB79C,KAAK+C,QAAQ86C,kBACjCC,EAAqB99C,KAAK+C,QAAQ+6C,mBAElC19C,EAAIU,EAASg9C,EAAqBh9C,EAASg9C,EAAqBD,CAWjE,KALK79C,KAAK6gD,mBACT7gD,KAAK6gD,iBAAmBphD,EAAEwO,QAAQ+B,OAAO,MAAO,sBAAuBhQ,KAAK88C,eAIlEh8C,EAAJV,EAAYA,GAAKJ,KAAK+C,QAAQ86C,kBAEpC6C,EAAWtgD,EAAIU,EAGf6/C,GACCz1C,EAAG3I,KAAKwJ,MAAOy0C,EAAOt1C,GAAK,EAAIw1C,GAAcA,EAAWD,EAAOv1C,GAC/DC,EAAG5I,KAAKwJ,MAAOy0C,EAAOr1C,GAAK,EAAIu1C,GAAcA,EAAWD,EAAOt1C,IAIhEy1C,EAAOnhD,EAAEwO,QAAQ+B,OAAO,MAAO,0BAA2BhQ,KAAK6gD,kBAC/DD,EAAK/2C,MAAMi3C,gBACT9gD,KAAKo/C,YAAgDp/C,KAAK+C,QAAQ46C,UAAUznB,MAAzDl2B,KAAK+C,QAAQi6C,aAAa9mB,MAE/Cz2B,EAAEwO,QAAQiE,YAAY0uC,EAAMD,IAI9BI,kBAAmB,SAAU7qB,GAC5B,GAAIl2B,KAAK6gD,iBACR,IAAK,GAAIzgD,GAAI,EAAG4xC,EAAIhyC,KAAK6gD,iBAAiBG,WAAWlgD,OAAYkxC,EAAJ5xC,EAAOA,IACnEJ,KAAK6gD,iBAAiBG,WAAW5gD,GAAGyJ,MAAMi3C,gBAAkB5qB,GAM/DyoB,aAAc,WACb,GAAI3+C,KAAK6gD,iBACR,KAAO7gD,KAAK6gD,iBAAiB76B,YAC5BhmB,KAAK6gD,iBAAiBhgC,YAAY7gB,KAAK6gD,iBAAiB76B,aAK3Do4B,gBAAiB,WAChB,GACC6C,GAAWC,EADRnD,EAAa/9C,KAAK+C,QAAQg7C,UAsB9B,OAnB6B,KAAzB/9C,KAAKg+C,SAASl9C,OACjBmgD,GACC1N,KAAM9zC,EAAEk8C,UAAUC,KAAKK,SAASld,SAASmd,QAAQC,QAGlD+E,EAAcnD,EAAa/9C,KAAKmhD,wBAA0B,GAGzDF,EAD4B,IAAzBjhD,KAAKg+C,SAASl9C,QAEhByyC,KAAM9zC,EAAEk8C,UAAUC,KAAKK,SAASld,SAASmd,QAAQE,KACjDO,QAASuE,IAIT3N,KAAM9zC,EAAEk8C,UAAUC,KAAKK,SAASld,SAASmd,QAAQhE,IACjDyE,QAASuE,IAILD,GAGRf,sBAAuB,SAAUxpC,EAAQspC,GACxC,GACCoB,GAAqB5iB,EADlBygB,EAAgBj/C,KAAKg+C,SAASl9C,MAGL,KAAzBd,KAAKg+C,SAASl9C,OACjBd,KAAKqhD,yBAA2B,GAEhCD,EAAsBnC,GAAiBe,EAAQ,EAAI,GACnDxhB,EAAW9nB,EAAOzK,WAAWjM,KAAKg+C,SAASoD,GAAqBxyB,aAEhE5uB,KAAKqhD,0BAA4B7iB,GAAYwhB,EAAQ,EAAI,MAI3DmB,sBAAuB,WACtB,GAEC3iB,GAFG8iB,EAAgBthD,KAAK8/C,eACxByB,EAAiBvhD,KAAKg+C,SAASh+C,KAAKg+C,SAASl9C,OAAS,GAAG8tB,WAM1D,OAFA4P,GAAWx+B,KAAKqhD,yBAA2BC,EAAcr1C,WAAWs1C,GAE7D9hD,EAAE+hD,aAAaC,iBAAiBjjB,EAAUx+B,KAAK+C,QAAQ8wC,OAAQ7zC,KAAK+C,QAAQ8xC,OAGpFsK,kBAAmB,WAClBn/C,KAAKo/C,aAAc,EAGnBp/C,KAAKk9C,SACHwE,cACAvD,eAAgB5K,KAAMvzC,KAAK+C,QAAQ46C,UAAUjD,UAG/C16C,KAAK+gD,kBAAkB/gD,KAAK+C,QAAQ46C,UAAUznB,OAC9Cl2B,KAAKk+C,MAAMvoB,UAAWO,MAAOl2B,KAAK+C,QAAQ46C,UAAUznB,QAGpDl2B,KAAKy+C,yBACLz+C,KAAK2hD,kBAAoB1/C,WAAWxC,EAAEQ,KAAKe,KAAKhB,KAAKq/C,kBAAmBr/C,MAAOA,KAAK+C,QAAQ46C,UAAUxD,UAGvGkF,kBAAmB,WAClBr/C,KAAKo/C,aAAc,EAEnBp/C,KAAKy+C,yBAGLz+C,KAAKk9C,SACH0E,cACAzD,cAAcn+C,KAAKo+C,mBAGrBp+C,KAAK+gD,kBAAkB/gD,KAAK+C,QAAQi6C,aAAa9mB,OACjDl2B,KAAKk+C,MAAMvoB,UAAWO,MAAOl2B,KAAK+C,QAAQi6C,aAAa9mB,SAGxDuoB,uBAAwB,WACnBz+C,KAAK2hD,oBACR78C,aAAa9E,KAAK2hD,mBAClB3hD,KAAK2hD,kBAAoB,OAI3BjD,cAAe,WACV1+C,KAAKg+C,SAASl9C,OAAS,GAC1Bd,KAAKg+C,SAASh+C,KAAKg+C,SAASl9C,OAAS,GAAG+G,IAAI,QAAS7H,KAAKw/C,aAAcx/C,OAI1Es9C,kBAAmB,WAClB,GAAIwB,GAAO,GAAI9+C,MAAKw9C,KAAKx9C,KAAKk+C,MAAMngB,aAAc/9B,KAAK+C,QAAQi6C,aAC/Dv9C,GAAEm9C,KAAKC,QAAQn8C,UAAU48C,kBAAkB18C,KAAKZ,KAAM8+C,MAKxDr/C,EAAEm9C,KAAKjiB,QAAUl7B,EAAEm9C,KAAKnf,SAASv9B,QAChC0F,SACC23C,KAAM,WAGPC,KAAM/9C,EAAEk7B,QAER53B,SACC8+C,UAAU,EACV7E,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNC,UAAW,KACXC,YAAa,GACbxI,WAAW,IAIb3oB,WAAY,SAAU+d,EAAKtgB,GAC1BtD,EAAEm9C,KAAKnf,SAAS/8B,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,GAGrD/C,KAAK2G,KAAOlH,EAAEm9C,KAAKjiB,QAAQ4iB,MAG5B0C,qBAAsB,WACrB,GAAII,GAAcrgD,KAAKg+C,SAASl9C,MAGZ,KAAhBu/C,GACHrgD,KAAKg+C,SAAS,GAAGp2C,GAAG,QAAS5H,KAAKw/C,aAAcx/C,MAI7CqgD,EAAc,IACjBrgD,KAAKg+C,SAASqC,EAAc,GAAGz4C,GAAG,WAAY5H,KAAKw/C,aAAcx/C,MAE7DqgD,EAAc,GACjBrgD,KAAKg+C,SAASqC,EAAc,GAAGx4C,IAAI,WAAY7H,KAAKw/C,aAAcx/C,QAKrEo+C,gBAAiB,WAChB,GAAI7K,GAAMoJ,CAWV,OAT6B,KAAzB38C,KAAKg+C,SAASl9C,OACjByyC,EAAO9zC,EAAEk8C,UAAUC,KAAKK,SAASrc,QAAQsc,QAAQC,MACvCn8C,KAAKg+C,SAASl9C,OAAS,EACjCyyC,EAAO9zC,EAAEk8C,UAAUC,KAAKK,SAASrc,QAAQsc,QAAQE,MAEjD7I,EAAO9zC,EAAEk8C,UAAUC,KAAKK,SAASrc,QAAQsc,QAAQhE,IACjDyE,EAAU38C,KAAKmhD,0BAIf5N,KAAMA,EACNoJ,QAASA,IAIXwE,sBAAuB,WACtB,GAAIW,GAAO9hD,KAAK+hD,KAEhB,OAAKD,GAIEriD,EAAE+hD,aAAaQ,aAAaF,EAAM9hD,KAAK+C,QAAQ8wC,QAH9C,MAMT4L,cAAe,WACd,MAAOz/C,MAAKg+C,SAASl9C,QAAU,GAGhCi+C,eAAgB,SAAUroC,EAAQspC,GACjC,GAAI5c,IAGCpjC,KAAK+C,QAAQ06C,mBAAqBz9C,KAAK+C,QAAQ8+C,WACnDze,EAAUpjC,KAAKk+C,MAAMngB,aAErB/9B,KAAK+hD,MAAQtiD,EAAE+hD,aAAaS,aAAa7e,IAG1C3jC,EAAEm9C,KAAKnf,SAAS/8B,UAAUq+C,eAAen+C,KAAKZ,KAAM0W,EAAQspC,IAG7DtB,cAAe,WACd,GAAI2B,GAAcrgD,KAAKg+C,SAASl9C,MAE5Bu/C,GAAc,IACjBrgD,KAAKg+C,SAAS,GAAGn2C,IAAI,QAAS7H,KAAKw/C,aAAcx/C,MAE7CqgD,EAAc,GACjBrgD,KAAKg+C,SAASqC,EAAc,GAAGx4C,IAAI,WAAY7H,KAAKw/C,aAAcx/C,UAOtEP,EAAEyiD,eAEFziD,EAAEm9C,KAAKsF,YAAcziD,EAAEm9C,KAAKC,QAAQ38C,QACnC6C,SACC26C,YAAY,GAGbp4C,WAAY,SAAU+d,EAAKtgB,GAC1B/C,KAAKmiD,cAAgB1iD,EAAEk8C,UAAUC,KAAKK,SAASI,YAAYH,QAAQhE,IAEnEz4C,EAAEm9C,KAAKC,QAAQn8C,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAGrD6kC,SAAU,WACTnoC,EAAEm9C,KAAKC,QAAQn8C,UAAUknC,SAAShnC,KAAKZ,MACnCA,KAAK8kB,OACR9kB,KAAKoiD,cAAgBpiD,KAAK8kB,KAAKnD,SAASmmB,UAEpC9nC,KAAKoiD,eACRpiD,KAAK8kB,KAAKnD,SAASK,UAIpBhiB,KAAKmd,WAAWtT,MAAMuxB,OAAS,YAE/Bp7B,KAAKk9C,SAASiB,eAAgB5K,KAAMvzC,KAAKqiD,oBAEzCriD,KAAK8kB,KACHld,GAAG,YAAa5H,KAAKovC,aAAcpvC,MACnC4H,GAAG,YAAa5H,KAAK85B,aAAc95B,MACnC4H,GAAG,aAAc5H,KAAKovC,aAAcpvC,MACpC4H,GAAG,YAAa5H,KAAK85B,aAAc95B,QAIvC6nC,YAAa,WACZpoC,EAAEm9C,KAAKC,QAAQn8C,UAAUmnC,YAAYjnC,KAAKZ,MACtCA,KAAK8kB,OACJ9kB,KAAKoiD,eACRpiD,KAAK8kB,KAAKnD,SAASzE,SAIpBld,KAAKmd,WAAWtT,MAAMuxB,OAAS,GAE/Bp7B,KAAK8kB,KACHjd,IAAI,YAAa7H,KAAKovC,aAAcpvC,MACpC6H,IAAI,YAAa7H,KAAK85B,aAAc95B,MACpC6H,IAAI,aAAc7H,KAAKovC,aAAcpvC,MACrC6H,IAAI,YAAa7H,KAAK85B,aAAc95B,MAEtCP,EAAEiT,SAAS7K,IAAIvI,EAAU,UAAWU,KAAKsvC,WAAYtvC,MACrDP,EAAEiT,SAAS7K,IAAIvI,EAAU,WAAYU,KAAKsvC,WAAYtvC,MAGlDA,KAAKsiD,SACRtiD,KAAK8kB,KAAK3I,YAAYnc,KAAKsiD,cACpBtiD,MAAKsiD,SAGdtiD,KAAKuiD,YAAa,GAGnBnE,gBAAiB,WAChB,OACC7K,KAAMvzC,KAAKmiD,gBAIb/S,aAAc,SAAU99B,GACvBtR,KAAKuiD,YAAa,EAClBviD,KAAKwiD,aAAelxC,EAAEoF,OACtB1W,KAAKyiD,gBAAkB,EACvBhjD,EAAEiT,SACA9K,GAAGtI,EAAU,UAAWU,KAAKsvC,WAAYtvC,MACzC4H,GAAGtI,EAAU,WAAYU,KAAKsvC,WAAYtvC,MAC1C2S,eAAerB,EAAEyQ,gBAGpB+X,aAAc,SAAUxoB,GACvB,GAAIoF,GAASpF,EAAEoF,MACZpF,GAAEyQ,cAAc49B,QAAU3/C,KAAKwiD,aACjC9rC,EAAOxD,IAAMlT,KAAKwiD,aAAatvC,IAExB5B,EAAEyQ,cAAc69B,SAAW5/C,KAAKwiD,eACvC9rC,EAAOvD,IAAMnT,KAAKwiD,aAAarvC,KAEhCnT,KAAKk9C,SAASqD,eAAe7pC,GACzB1W,KAAKuiD,eACNviD,KAAKyiD,gBACPziD,KAAKk9C,SAASiB,cAAcn+C,KAAKo+C,mBACjCp+C,KAAK0iD,WAAWhsC,KAIlB44B,WAAY,SAAUh+B,GAClBtR,KAAK2iD,gBACP3iD,KAAK2iD,eAAerxC,GAChBtR,KAAKsiD,SACRtiD,KAAK8kB,KAAK3I,YAAYnc,KAAKsiD,QAC3BtiD,KAAKsiD,OAAS,OAGPtiD,KAAKsiD,QACbtiD,KAAKs9C,kBAAkBhsC,GAGxBtR,KAAKgiB,UACDhiB,KAAK+C,QAAQ26C,YAChB19C,KAAKkd,YAKRzd,EAAEm9C,KAAKxc,UAAY3gC,EAAEm9C,KAAKsF,YAAYhiD,QACrC0F,SACC23C,KAAM,aAGPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNC,UAAW,KACXC,YAAa,GACbxI,WAAW,GAEZ4lB,QAAQ,GAGTvuC,WAAY,SAAU+d,EAAKtgB,GAE1B/C,KAAK2G,KAAOlH,EAAEm9C,KAAKxc,UAAUmd,KAE7Bv9C,KAAKqiD,kBAAoB5iD,EAAEk8C,UAAUC,KAAKK,SAAS1b,UAAU2b,QAAQC,MAErE18C,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAGzD2/C,WAAY,SAAUhsC,GAChB1W,KAAKsiD,OAITtiD,KAAKsiD,OAAOhiB,UAAU,GAAI7gC,GAAEmV,aAAa5U,KAAKwiD,aAAc9rC,KAH5D1W,KAAKsiD,OAAS,GAAI7iD,GAAE2gC,UAAU,GAAI3gC,GAAEmV,aAAa5U,KAAKwiD,aAAc9rC,GAAS1W,KAAK+C,QAAQi6C,cAC1Fh9C,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAM1BhF,kBAAmB,WAClB,GAAI/c,GAAY,GAAI9gC,GAAE2gC,UAAUpgC,KAAKsiD,OAAOhoC,YAAata,KAAK+C,QAAQi6C,aACtEv9C,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMugC,IAG3D6d,gBAAiB,WAChB,GAEChb,GAAS0e,EAAMnF,EAFZiG,EAAcnjD,EAAEm9C,KAAKsF,YAAYxhD,UAAU09C,gBAAgBx9C,KAAKZ,MACnE44B,EAAQ54B,KAAKsiD,MASd,OANI1pB,KACHwK,EAAUpjC,KAAKsiD,OAAOvkB,aACtB+jB,EAAOriD,EAAE+hD,aAAaS,aAAa7e,GACnCuZ,EAAUl9C,EAAE+hD,aAAaQ,aAAaF,EAAM9hD,KAAK+C,QAAQ8wC,UAIzDN,KAAMqP,EAAYrP,KAClBoJ,QAASA,MAMZl9C,EAAEm9C,KAAKpc,OAAS/gC,EAAEm9C,KAAKsF,YAAYhiD,QAClC0F,SACC23C,KAAM,UAGPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNC,UAAW,KACXC,YAAa,GACbxI,WAAW,GAEZ40B,YAAY,EACZhP,QAAQ,EACRgB,MAAM,GAGPvvC,WAAY,SAAU+d,EAAKtgB,GAE1B/C,KAAK2G,KAAOlH,EAAEm9C,KAAKpc,OAAO+c,KAE1Bv9C,KAAKqiD,kBAAoB5iD,EAAEk8C,UAAUC,KAAKK,SAAS7a,OAAO8a,QAAQC,MAElE18C,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAGzD2/C,WAAY,SAAUhsC,GAChB1W,KAAKsiD,OAITtiD,KAAKsiD,OAAO3hB,UAAU3gC,KAAKwiD,aAAav2C,WAAWyK,KAHnD1W,KAAKsiD,OAAS,GAAI7iD,GAAE+gC,OAAOxgC,KAAKwiD,aAAcxiD,KAAKwiD,aAAav2C,WAAWyK,GAAS1W,KAAK+C,QAAQi6C,cACjGh9C,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAM1BhF,kBAAmB,WAClB,GAAIlc,GAAS,GAAI3hC,GAAE+gC,OAAOxgC,KAAKwiD,aAAcxiD,KAAKsiD,OAAOphB,YAAalhC,KAAK+C,QAAQi6C,aACnFv9C,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMohC,IAG3DtH,aAAc,SAAUxoB,GACvB,GAGCmvB,GAHG/pB,EAASpF,EAAEoF,OACdmsC,EAAa7iD,KAAK+C,QAAQ8/C,WAC1BC,EAAY9iD,KAAK+C,QAAQ8wC,MAG1B7zC,MAAKk9C,SAASqD,eAAe7pC,GACzB1W,KAAKuiD,aACRviD,KAAK0iD,WAAWhsC,GAGhB+pB,EAASzgC,KAAKsiD,OAAOphB,YAAY6hB,QAAQ,GAEzC/iD,KAAKk9C,SAASiB,eACb5K,KAAMvzC,KAAKmiD,cACXxF,QAASkG,EAAapjD,EAAEk8C,UAAUC,KAAKK,SAAS7a,OAAOX,OAAS,KAC/DhhC,EAAE+hD,aAAaC,iBAAiBhhB,EAAQqiB,EAAW9iD,KAAK+C,QAAQ8xC,MAAQ,SAO7Ep1C,EAAEm9C,KAAK7uB,OAAStuB,EAAEm9C,KAAKC,QAAQ38C,QAC9B0F,SACC23C,KAAM,UAGPx6C,SACCqqB,KAAM,GAAI3tB,GAAE6sB,KAAKe,QACjBqwB,YAAY,EACZtvB,aAAc,KAGf9oB,WAAY,SAAU+d,EAAKtgB,GAE1B/C,KAAK2G,KAAOlH,EAAEm9C,KAAK7uB,OAAOwvB,KAE1B99C,EAAEm9C,KAAKC,QAAQn8C,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAGrD6kC,SAAU,WACTnoC,EAAEm9C,KAAKC,QAAQn8C,UAAUknC,SAAShnC,KAAKZ,MAEnCA,KAAK8kB,OACR9kB,KAAKk9C,SAASiB,eAAgB5K,KAAM9zC,EAAEk8C,UAAUC,KAAKK,SAAS1rB,OAAO2rB,QAAQC,QAGxEn8C,KAAKq+C,eACTr+C,KAAKq+C,aAAe5+C,EAAE8wB,OAAOvwB,KAAK8kB,KAAKnY,aACtCygB,KAAM3tB,EAAEmxB,SACP1gB,UAAW,uBACX+c,YAAa,GAAI,IACjBK,UAAW,GAAI,MAEhBrc,QAAS,EACTmd,aAAcpuB,KAAK+C,QAAQqrB,gBAI7BpuB,KAAKq+C,aACHz2C,GAAG,QAAS5H,KAAK65B,SAAU75B,MAC3B0lB,MAAM1lB,KAAK8kB,MAEb9kB,KAAK8kB,KAAKld,GAAG,YAAa5H,KAAK85B,aAAc95B,MAC7CA,KAAK8kB,KAAKld,GAAG,QAAS5H,KAAKw+C,SAAUx+C,QAIvC6nC,YAAa,WACZpoC,EAAEm9C,KAAKC,QAAQn8C,UAAUmnC,YAAYjnC,KAAKZ,MAEtCA,KAAK8kB,OACJ9kB,KAAKkxC,UACRlxC,KAAKkxC,QAAQrpC,IAAI,QAAS7H,KAAK65B,SAAU75B,MACzCA,KAAK8kB,KACHjd,IAAI,QAAS7H,KAAK65B,SAAU75B,MAC5B6H,IAAI,QAAS7H,KAAKw+C,SAAUx+C,MAC5Bmc,YAAYnc,KAAKkxC,eACZlxC,MAAKkxC,SAGblxC,KAAKq+C,aAAax2C,IAAI,QAAS7H,KAAK65B,SAAU75B,MAC9CA,KAAK8kB,KAAK3I,YAAYnc,KAAKq+C,oBACpBr+C,MAAKq+C,aAEZr+C,KAAK8kB,KAAKjd,IAAI,YAAa7H,KAAK85B,aAAc95B,QAIhD85B,aAAc,SAAUxoB,GACvB,GAAIoF,GAASpF,EAAEoF,MAEf1W,MAAKk9C,SAASqD,eAAe7pC,GAC7B1W,KAAKq+C,aAAaxvB,UAAUnY,GAEvB1W,KAAKkxC,SAYTx6B,EAAS1W,KAAKq+C,aAAazvB,YAC3B5uB,KAAKkxC,QAAQriB,UAAUnY,KAZvB1W,KAAKkxC,QAAU,GAAIzxC,GAAEsuB,OAAOrX,GAC3B0W,KAAMptB,KAAK+C,QAAQqqB,KACnBgB,aAAcpuB,KAAK+C,QAAQqrB,eAG5BpuB,KAAKkxC,QAAQtpC,GAAG,QAAS5H,KAAK65B,SAAU75B,MACxCA,KAAK8kB,KACHld,GAAG,QAAS5H,KAAK65B,SAAU75B,MAC3B0b,SAAS1b,KAAKkxC,WAQlBrX,SAAU,WACT75B,KAAKs9C,oBAELt9C,KAAKgiB,UACDhiB,KAAK+C,QAAQ26C,YAChB19C,KAAKkd,UAIPshC,SAAU,SAAUltC,GAEnBtR,KAAK85B,aAAaxoB,GAClBtR,KAAK65B,YAGNyjB,kBAAmB,WAClB,GAAI/sB,GAAS,GAAI9wB,GAAEsuB,OAAOi1B,MAAMhjD,KAAKkxC,QAAQtiB,aAAexB,KAAMptB,KAAK+C,QAAQqqB,MAC/E3tB,GAAEm9C,KAAKC,QAAQn8C,UAAU48C,kBAAkB18C,KAAKZ,KAAMuwB,MAKxD9wB,EAAEwjD,KAAOxjD,EAAEwjD,SAEXxjD,EAAEwjD,KAAKl1B,OAAStuB,EAAEwwB,QAAQ/vB,QACzBoF,WAAY,SAAUirB,EAAQxtB,GAC7B/C,KAAKkxC,QAAU3gB,EACf9wB,EAAEqD,WAAW9C,KAAM+C,IAGpB6kC,SAAU,WACT,GAAIrX,GAASvwB,KAAKkxC,OAElB3gB,GAAO5O,SAASzE,SAChBqT,EAAO3oB,GAAG,UAAW5H,KAAK4oC,WAAY5oC,MACtCA,KAAKkjD,eACLljD,KAAKmjD,yBACL5yB,EAAOzL,KAAKld,GAAG,WAAW5H,KAAKuhB,cAAcvhB,OAG9C6nC,YAAa,WACZ,GAAItX,GAASvwB,KAAKkxC,OAElB3gB,GAAO5O,SAASK,UAChBuO,EAAO1oB,IAAI,UAAW7H,KAAK4oC,WAAY5oC,MACvCA,KAAKmjD,yBACLnjD,KAAKojD,gBACL7yB,EAAOzL,KAAKjd,IAAI,WAAW7H,KAAKuhB,cAAcvhB,OAG/CuhB,cAAc,WACbvhB,KAAKgiB,WAEN4mB,WAAY,SAAUt3B,GACrB,GAAIqK,GAAQrK,EAAE7J,MACdkU,GAAM0nC,QAAS,EACfrjD,KAAKkjD,gBAGNC,uBAAwB,WACvB,GAAI/1B,GAAOptB,KAAKkxC,QAAQhiB,KAMnB9B,KAKLA,EAAKvjB,MAAM0vB,QAAU,OAEjB95B,EAAEwO,QAAQoC,SAAS+c,EAAM,iCAC5B3tB,EAAEwO,QAAQ4C,YAAYuc,EAAM,gCAE5BptB,KAAKsjD,cAAcl2B,EAAM,MAGzB3tB,EAAEwO,QAAQyC,SAAS0c,EAAM,gCAEzBptB,KAAKsjD,cAAcl2B,EAAM,IAG1BA,EAAKvjB,MAAM0vB,QAAU,KAGtB+pB,cAAe,SAAUl2B,EAAM/R,GAC9B,GAAIkoC,GAAgBp0C,SAASie,EAAKvjB,MAAMsjB,UAAW,IAAM9R,EACxDmoC,EAAiBr0C,SAASie,EAAKvjB,MAAMqjB,WAAY,IAAM7R,CAExD+R,GAAKvjB,MAAMsjB,UAAYo2B,EAAgB,KACvCn2B,EAAKvjB,MAAMqjB,WAAas2B,EAAiB,MAG1CN,aAAa,WACZljD,KAAKyjD,kBAENA,eAAe,WACd,GAAIC,GAAO1jD,KACVmQ,EAAY1Q,EAAEkkD,eAAeC,mBAAmBF,EAAKxS,QAAQwS,EAE3DvzC,KACFuzC,EAAKxS,QAAQjiB,UAAU9e,GACtB8gB,aAAa,EACb5V,OAAQ,GAAI5b,GAAEwL,MAAM,GAAIy4C,EAAKxS,QAAQnuC,QAAQqqB,KAAKrqB,QAAQkqB,WAAW,MAEtEy2B,EAAKxS,QAAQvf,YACb+xB,EAAKxS,QAAQliB,OAAOH,UAAU60B,EAAKxS,QAAQ3iB,WAG7C60B,cAAc,WACb,GAAIM,GAAO1jD,IACX0jD,GAAKxS,QAAQxe,aACbgxB,EAAKxS,QAAQtc,eAEdlC,WAAW,WACV1yB,KAAKojD,mBAIP3jD,EAAEsuB,OAAO5nB,YAAY,WAChB1G,EAAEwjD,KAAKl1B,SACV/tB,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAKl1B,OAAO/tB,MAE7BA,KAAK+C,QAAQ+gD,YAOnBrkD,EAAEwjD,KAAOxjD,EAAEwjD,SAKXxjD,EAAEwjD,KAAKzF,KAAO/9C,EAAEwwB,QAAQ/vB,QACvB6C,WAEAuC,WAAY,SAAUw5C,EAAM/7C,GAE3B/C,KAAK+U,SAAW+pC,EAAKnmB,UACjBmmB,EAAKtf,SACRx/B,KAAK+U,QAAU/U,KAAK+U,QAAQpT,OAAOm9C,EAAKtf,SAGzCx/B,KAAK+jD,oBACL,KAAK,GAAI3jD,GAAI,EAAGA,EAAIJ,KAAK+U,QAAQjU,OAAQV,IACxCJ,KAAK+jD,kBAAkB3gD,KAAK,GAAI3D,GAAEwjD,KAAKe,iBAAiBlF,EAAM9+C,KAAK+U,QAAQ3U,GAAI2C,GAGhF/C,MAAKk+C,MAAQY,EACbr/C,EAAEqD,WAAW9C,KAAM+C,IAGpBkhD,mBAAoB,SAAU/hC,GAC7B,IAAK,GAAI9hB,GAAI,EAAGA,EAAIJ,KAAK+jD,kBAAkBjjD,OAAQV,IAClD8hB,EAASliB,KAAK+jD,kBAAkB3jD,KAIlCwnC,SAAU,WACT5nC,KAAKikD,mBAAmB,SAAUt8C,GACjCA,EAAQigC,aAET5nC,KAAKkjD,gBAGNrb,YAAa,WACZ7nC,KAAKikD,mBAAmB,SAAUt8C,GACjCA,EAAQkgC,gBAET7nC,KAAKojD,iBAGNc,cAAe,WACdlkD,KAAKikD,mBAAmB,SAAUt8C,GACjCA,EAAQu8C,mBAGVhB,aAAa,WACZljD,KAAKyjD,kBAENA,eAAe,WACd,GAAIC,GAAO1jD,KACVmQ,EAAY1Q,EAAEkkD,eAAeC,mBAAmBF,EAAKxF,MAAMwF,EAE5D,IAAGvzC,EAAW,CACbuzC,EAAKxF,MAAMjvB,UAAU9e,GACpB8gB,aAAa,EACb5V,OAAQ,GAAI5b,GAAEwL,MAAM,EAAG,KAExBy4C,EAAKxF,MAAMvsB,WACX,IAAIwyB,GAAKT,EAAKxF,MAAM5jC,WACpBopC,GAAKxF,MAAMlvB,OAAOH,UAAU,GAAIpvB,GAAEwT,OAAOkxC,EAAGlvC,WAAW/B,IAAKixC,EAAGlvC,WAAW9B,KAAKgxC,EAAGjvC,WAAW/B,IAAIgxC,EAAGlvC,WAAW9B,KAAK,MAGtHiwC,cAAc,WACb,GAAIM,GAAO1jD,IACX0jD,GAAKxF,MAAMxrB,aACXgxB,EAAKxF,MAAMtpB,eAEZlC,WAAW,WACV1yB,KAAKojD,mBAKP3jD,EAAEwjD,KAAKe,iBAAmBvkD,EAAEwwB,QAAQ/vB,QACnC6C,SACCqqB,KAAM,GAAI3tB,GAAE+wB,SACXlD,SAAU,GAAI7tB,GAAEwL,MAAM,EAAG,GACzBiF,UAAW,0CAEZ0tC,UAAW,GAAIn+C,GAAE+wB,SAChBlD,SAAU,GAAI7tB,GAAEwL,MAAM,GAAI,IAC1BiF,UAAW,8DAIb5K,WAAY,SAAUw5C,EAAM/pC,EAAShS,GAEhCtD,EAAEmL,QAAQR,QACbpK,KAAK+C,QAAQqqB,KAAOptB,KAAK+C,QAAQ66C,WAElC59C,KAAKk+C,MAAQY,EACb9+C,KAAK24B,SAAW5jB,EAEhBtV,EAAEqD,WAAW9C,KAAM+C,IAGpB6kC,SAAU,WACT,GAAIkX,GAAO9+C,KAAKk+C,KAEVY,aAAgBr/C,GAAEk7B,UACvBmkB,EAAK+E,QAAQ9gD,QAAQwzB,MAAO,GAG7BuoB,EAAKnpB,SAASmpB,EAAK+E,QAAQ9gD,SAEvB/C,KAAKk+C,MAAMp5B,OAEd9kB,KAAK8kB,KAAO9kB,KAAKk+C,MAAMp5B,KAElB9kB,KAAKi+C,cACTj+C,KAAKokD,eAENpkD,KAAKk+C,MAAMp5B,KAAKpJ,SAAS1b,KAAKi+C,gBAIhCpW,YAAa,WACZ,GAAIiX,GAAO9+C,KAAKk+C,KAEhBY,GAAKnpB,SAASmpB,EAAK/7C,QAAQshD,UAEvBvF,EAAKh6B,OACRg6B,EAAKh6B,KAAK3I,YAAYnc,KAAKi+C,oBACpBj+C,MAAKi+C,mBACLj+C,MAAKg+C,WAIdkG,cAAe,WACdlkD,KAAKi+C,aAAajpB,cAClBh1B,KAAKokD,gBAGNA,aAAc,WACRpkD,KAAKi+C,eACTj+C,KAAKi+C,aAAe,GAAIx+C,GAAEq1B,YAE3B90B,KAAKg+C,WAEL,IACC59C,GAAGC,EAAGC,EAAKiwB,EADRxb,EAAU/U,KAAK24B,QAGnB,KAAKv4B,EAAI,EAAGE,EAAMyU,EAAQjU,OAAYR,EAAJF,EAASA,IAE1CmwB,EAASvwB,KAAKs/C,cAAcvqC,EAAQ3U,GAAIA,GACxCmwB,EAAO3oB,GAAG,QAAS5H,KAAKskD,eAAgBtkD,MACxCA,KAAKg+C,SAAS56C,KAAKmtB,EAGpB,IAAIg0B,GAAYC,CAEhB,KAAKpkD,EAAI,EAAGC,EAAIC,EAAM,EAAOA,EAAJF,EAASC,EAAID,KAC3B,IAANA,GAAaX,EAAEk7B,SAAY36B,KAAKk+C,gBAAiBz+C,GAAEk7B,WAIvD4pB,EAAavkD,KAAKg+C,SAAS39C,GAC3BmkD,EAAcxkD,KAAKg+C,SAAS59C,GAE5BJ,KAAKykD,oBAAoBF,EAAYC,GACrCxkD,KAAK0kD,gBAAgBH,EAAYC,KAInClF,cAAe,SAAU5oC,EAAQ+S,GAEhC,GAAI8G,GAAS,GAAI9wB,GAAEsuB,OAAOi1B,MAAMtsC,GAC/BwX,WAAW,EACXd,KAAMptB,KAAK+C,QAAQqqB,MAiBpB,OAdAmD,GAAOo0B,YAAcjuC,EACrB6Z,EAAOq0B,OAASn7B,EAEhB8G,EACE3oB,GAAG,YAAa5H,KAAK6kD,mBAAoB7kD,MACzC4H,GAAG,OAAQ5H,KAAK8kD,cAAe9kD,MAC/B4H,GAAG,UAAW5H,KAAK+kD,UAAW/kD,MAC9B4H,GAAG,YAAa5H,KAAK6tC,aAAc7tC,MACnC4H,GAAG,gBAAiB5H,KAAK6tC,aAAc7tC,MACvC4H,GAAG,WAAY5H,KAAK+kD,UAAW/kD,MAC/B4H,GAAG,cAAe5H,KAAK+kD,UAAW/kD,MAEpCA,KAAKi+C,aAAaviC,SAAS6U,GAEpBA,GAGRs0B,mBAAoB,WACnB7kD,KAAKk+C,MAAMn2C,KAAK,cAGjBi9C,eAAgB,WACf,GAAI19C,MAAaC,OAAOnG,MAAMpB,KAAK24B,SAAU93B,UAG7C,OAFAb,MAAKk+C,MAAMxgB,gBAAgB19B,KAAK24B,UAAU,GAC1C34B,KAAKk+C,MAAM13B,SACJlf,GAGR29C,cAAe,SAAU10B,GACxB,GAAInwB,GAAImwB,EAAOq0B,MAEf5kD,MAAKi+C,aAAa9hC,YAAYoU,GAC9BvwB,KAAKg+C,SAASz2C,OAAOnH,EAAG,GACxBJ,KAAKglD,eAAe5kD,EAAG,GACvBJ,KAAKklD,eAAe9kD,EAAG,IAEvBmwB,EACE1oB,IAAI,YAAa7H,KAAK6kD,mBAAoB7kD,MAC1C6H,IAAI,OAAQ7H,KAAK8kD,cAAe9kD,MAChC6H,IAAI,UAAW7H,KAAK+kD,UAAW/kD,MAC/B6H,IAAI,YAAa7H,KAAK8kD,cAAe9kD,MACrC6H,IAAI,WAAY7H,KAAK+kD,UAAW/kD,MAChC6H,IAAI,QAAS7H,KAAKskD,eAAgBtkD,OAGrC+kD,UAAW,WACV/kD,KAAKk+C,MAAMmF,QAAS,EACpBrjD,KAAKk+C,MAAMn2C,KAAK,QAChB/H,KAAKk+C,MAAMp5B,KAAK/c,KAAK,mBAAqBoR,OAAQnZ,KAAKi+C,gBAGxD6G,cAAe,SAAUxzC,GACxB,GAAIif,GAASjf,EAAE7J,MAEfhI,GAAES,OAAOqwB,EAAOo0B,YAAap0B,EAAOhC,SAEhCgC,EAAO40B,aACV50B,EAAO40B,YAAYt2B,UAAU7uB,KAAKolD,iBAAiB70B,EAAO80B,MAAO90B,IAE9DA,EAAO+0B,cACV/0B,EAAO+0B,aAAaz2B,UAAU7uB,KAAKolD,iBAAiB70B,EAAQA,EAAOg1B,QAGpEvlD,KAAKk+C,MAAM13B,SACXxmB,KAAKk+C,MAAMn2C,KAAK,aAGjBu8C,eAAgB,SAAUhzC,GAEzB,GAAIk0C,GAAY/lD,EAAEk7B,SAAY36B,KAAKk+C,gBAAiBz+C,GAAEk7B,QAAW,EAAI,EACpEpK,EAASjf,EAAE7J,MAGRzH,MAAK24B,SAAS73B,OAAS0kD,IAK3BxlD,KAAKilD,cAAc10B,GAGnBvwB,KAAK0kD,gBAAgBn0B,EAAO80B,MAAO90B,EAAOg1B,OAGtCh1B,EAAO40B,aACVnlD,KAAKi+C,aAAa9hC,YAAYoU,EAAO40B,aAElC50B,EAAO+0B,cACVtlD,KAAKi+C,aAAa9hC,YAAYoU,EAAO+0B,cAIlC/0B,EAAO80B,OAAS90B,EAAOg1B,MAC1BvlD,KAAKykD,oBAAoBl0B,EAAO80B,MAAO90B,EAAOg1B,OAEnCh1B,EAAO80B,MAGP90B,EAAOg1B,QAClBh1B,EAAO80B,MAAMC,aAAe,MAH5B/0B,EAAOg1B,MAAMJ,YAAc,KAM5BnlD,KAAK+kD,cAGNlX,aAAc,SAAUv8B,GAEvB,GAAImO,GAAazf,KAAK8kB,KAAKlF,uBAAuBtO,EAAEyQ,cAAcklB,QAAQ,IACzEvwB,EAAS1W,KAAK8kB,KAAKpH,mBAAmB+B,GACtC8Q,EAASjf,EAAE7J,MAEZhI,GAAES,OAAOqwB,EAAOo0B,YAAajuC,GAEzB6Z,EAAO40B,aACV50B,EAAO40B,YAAYt2B,UAAU7uB,KAAKolD,iBAAiB70B,EAAO80B,MAAO90B,IAE9DA,EAAO+0B,cACV/0B,EAAO+0B,aAAaz2B,UAAU7uB,KAAKolD,iBAAiB70B,EAAQA,EAAOg1B,QAGpEvlD,KAAKk+C,MAAM13B,SACXxmB,KAAKkkD,iBAGNgB,eAAgB,SAAUz7B,EAAO9P,GAChC3Z,KAAKi+C,aAAa3hC,UAAU,SAAUiU,GACjCA,EAAOq0B,OAASn7B,IACnB8G,EAAOq0B,QAAUjrC,MAKpB8qC,oBAAqB,SAAUgB,EAASC,GACvC,GAECC,GACAC,EACAC,EAJGnvC,EAAS1W,KAAKolD,iBAAiBK,EAASC,GAC3Cn1B,EAASvwB,KAAKs/C,cAAc5oC,EAK7B6Z,GAAOvf,WAAW,IAElBy0C,EAAQH,aAAeI,EAAQP,YAAc50B,EAE7Cq1B,EAAc,WACb,GAAIxlD,GAAIslD,EAAQd,MAEhBr0B,GAAOq0B,OAASxkD,EAEhBmwB,EACE1oB,IAAI,QAAS89C,EAAS3lD,MACtB4H,GAAG,QAAS5H,KAAKskD,eAAgBtkD,MAEnC0W,EAAOxD,IAAMqd,EAAO3B,YAAY1b,IAChCwD,EAAOvD,IAAMod,EAAO3B,YAAYzb,IAChCnT,KAAKglD,eAAe5kD,EAAG,EAAGsW,GAC1B1W,KAAKg+C,SAASz2C,OAAOnH,EAAG,EAAGmwB,GAE3BA,EAAOvf,WAAW,GAElBhR,KAAKklD,eAAe9kD,EAAG,GACvBslD,EAAQd,SACR5kD,KAAK0kD,gBAAgBe,EAASl1B,GAC9BvwB,KAAK0kD,gBAAgBn0B,EAAQm1B,GAE7B1lD,KAAKk+C,MAAMn2C,KAAK,cAGjB89C,EAAY,WACXt1B,EAAO1oB,IAAI,YAAa+9C,EAAa5lD,MACrCuwB,EAAO1oB,IAAI,UAAWg+C,EAAW7lD,MACjCuwB,EAAO1oB,IAAI,YAAa+9C,EAAa5lD,MAErCA,KAAKykD,oBAAoBgB,EAASl1B,GAClCvwB,KAAKykD,oBAAoBl0B,EAAQm1B,IAGlCC,EAAU,WACTC,EAAYhlD,KAAKZ,MACjB6lD,EAAUjlD,KAAKZ,MACfA,KAAK+kD,aAGNx0B,EACE3oB,GAAG,QAAS+9C,EAAS3lD,MACrB4H,GAAG,YAAag+C,EAAa5lD,MAC7B4H,GAAG,UAAWi+C,EAAW7lD,MACzB4H,GAAG,YAAag+C,EAAa5lD,MAE/BA,KAAKi+C,aAAaviC,SAAS6U,IAG5Bm0B,gBAAiB,SAAUe,EAASC,GAC/BD,IACHA,EAAQF,MAAQG,GAEbA,IACHA,EAAQL,MAAQI,IAIlBL,iBAAkB,SAAUK,EAASC,GACpC,GAAIriC,GAAMrjB,KAAKk+C,MAAMp5B,KACpBiX,EAAK1Y,EAAI5M,QAAQgvC,EAAQ72B,aACzBoN,EAAK3Y,EAAI5M,QAAQivC,EAAQ92B,YAE1B,OAAOvL,GAAIxM,UAAUklB,EAAGxwB,KAAKywB,GAAIrwB,UAAU,OAI7ClM,EAAEg+B,SAASt3B,YAAY,WAGlBnG,KAAK6jD,UAILpkD,EAAEwjD,KAAKzF,OACVx9C,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAKzF,KAAKx9C,MAE3BA,KAAK+C,QAAQ+gD,UAChB9jD,KAAK6jD,QAAQ3mC,UAIfld,KAAK4H,GAAG,MAAO,WACV5H,KAAK6jD,SAAW7jD,KAAK6jD,QAAQ/b,WAChC9nC,KAAK6jD,QAAQjc,aAIf5nC,KAAK4H,GAAG,SAAU,WACb5H,KAAK6jD,SAAW7jD,KAAK6jD,QAAQ/b,WAChC9nC,KAAK6jD,QAAQhc,mBAKhBpoC,EAAEwjD,KAAOxjD,EAAEwjD,SAEXxjD,EAAEwjD,KAAKf,YAAcziD,EAAEwwB,QAAQ/vB,QAC9B6C,SACC+iD,SAAU,GAAIrmD,GAAE+wB,SACflD,SAAU,GAAI7tB,GAAEwL,MAAM,EAAG,GACzBiF,UAAW,4DAEZ61C,WAAY,GAAItmD,GAAE+wB,SACjBlD,SAAU,GAAI7tB,GAAEwL,MAAM,EAAG,GACzBiF,UAAW,8DAEZ81C,cAAe,GAAIvmD,GAAE+wB,SACpBlD,SAAU,GAAI7tB,GAAEwL,MAAM,GAAI,IAC1BiF,UAAW,+EAEZ+1C,gBAAiB,GAAIxmD,GAAE+wB,SACtBlD,SAAU,GAAI7tB,GAAEwL,MAAM,GAAI,IAC1BiF,UAAW,kFAIb5K,WAAY,SAAUszB,EAAO71B,GAExBtD,EAAEmL,QAAQR,QACbpK,KAAK+C,QAAQ+iD,SAAW9lD,KAAK+C,QAAQijD,cACrChmD,KAAK+C,QAAQgjD,WAAa/lD,KAAK+C,QAAQkjD,iBAGxCjmD,KAAKsiD,OAAS1pB,EACdn5B,EAAEQ,KAAK6C,WAAW9C,KAAM+C,IAGzB6kC,SAAU,WACT,GAAIhP,GAAQ54B,KAAKsiD,MACbtiD,MAAKsiD,OAAOx9B,OACf9kB,KAAK8kB,KAAO9kB,KAAKsiD,OAAOx9B,KACxB8T,EAAMjD,SAASiD,EAAM71B,QAAQ8gD,SAEzBjrB,EAAM9T,OACT9kB,KAAK8kB,KAAO8T,EAAM9T,KACb9kB,KAAKi+C,cACTj+C,KAAKokD,eAENpkD,KAAK8kB,KAAKpJ,SAAS1b,KAAKi+C,gBAG1Bj+C,KAAKkjD,eACLljD,KAAK8kB,KAAKld,GAAG,WAAW5H,KAAKuhB,cAAcvhB,OAG5C6nC,YAAa,WACZ,GAAIjP,GAAQ54B,KAAKsiD,MAIjB,IAFA1pB,EAAMjD,SAASiD,EAAM71B,QAAQshD,UAEzBzrB,EAAM9T,KAAM,CACf9kB,KAAKkmD,cAAclmD,KAAKmmD,YAExB,KAAK,GAAI/lD,GAAI,EAAG4xC,EAAIhyC,KAAKomD,eAAetlD,OAAYkxC,EAAJ5xC,EAAOA,IACtDJ,KAAKkmD,cAAclmD,KAAKomD,eAAehmD,GAExCJ,MAAKomD,eAAiB,KAEtBpmD,KAAK8kB,KAAK3I,YAAYnc,KAAKi+C,oBACpBj+C,MAAKi+C,aAEbj+C,KAAKojD,gBACLpjD,KAAK8kB,KAAKjd,IAAI,WAAW7H,KAAKuhB,cAAcvhB,MAC5CA,KAAK8kB,KAAO,MAEbvD,cAAc,SAASjQ,GACtBtR,KAAKgiB,WAENkiC,cAAe,WACdlkD,KAAKi+C,aAAajpB,cAClBh1B,KAAKokD,gBAGNA,aAAc,WACRpkD,KAAKi+C,eACTj+C,KAAKi+C,aAAe,GAAIx+C,GAAEq1B,YAI3B90B,KAAKqmD,oBAGLrmD,KAAKsmD,uBAGND,kBAAmB,aAInBC,oBAAqB,aAIrBhH,cAAe,SAAU5oC,EAAQ0W,GAEhC,GAAImD,GAAS,GAAI9wB,GAAEsuB,OAAOi1B,MAAMtsC,GAC/BwX,WAAW,EACXd,KAAMA,EACNgB,aAAc,IAOf,OAJApuB,MAAKumD,YAAYh2B,GAEjBvwB,KAAKi+C,aAAaviC,SAAS6U,GAEpBA,GAGRg2B,YAAa,SAAUh2B,GACtBA,EACE3oB,GAAG,YAAa5H,KAAK6kD,mBAAoB7kD,MACzC4H,GAAG,OAAQ5H,KAAK8kD,cAAe9kD,MAC/B4H,GAAG,UAAW5H,KAAKwmD,iBAAkBxmD,MACrC4H,GAAG,aAAc5H,KAAKutC,cAAevtC,MACrC4H,GAAG,YAAa5H,KAAK6tC,aAAc7tC,MACnC4H,GAAG,gBAAiB5H,KAAK6tC,aAAc7tC,MACvC4H,GAAG,WAAY5H,KAAK8tC,YAAa9tC,MACjC4H,GAAG,cAAe5H,KAAK8tC,YAAa9tC,OAGvCkmD,cAAe,SAAU31B,GACxBA,EACE1oB,IAAI,YAAa7H,KAAK6kD,mBAAoB7kD,MAC1C6H,IAAI,OAAQ7H,KAAK8kD,cAAe9kD,MAChC6H,IAAI,UAAW7H,KAAKwmD,iBAAkBxmD,MACtC6H,IAAI,aAAc7H,KAAKutC,cAAevtC,MACtC6H,IAAI,YAAa7H,KAAK6tC,aAAc7tC,MACpC6H,IAAI,gBAAiB7H,KAAK6tC,aAAc7tC,MACxC6H,IAAI,WAAY7H,KAAK8tC,YAAa9tC,MAClC6H,IAAI,cAAe7H,KAAK8tC,YAAa9tC,OAGxC6kD,mBAAoB,SAAUvzC,GAC7B,GAAIif,GAASjf,EAAE7J,MACf8oB,GAAOvf,WAAW,GAElBhR,KAAKsiD,OAAOv6C,KAAK,cAGlBg9C,UAAW,WACV/kD,KAAKsiD,OAAOe,QAAS,EACrBrjD,KAAKsiD,OAAOv6C,KAAK,QACjBtI,EAAEkkD,eAAe8C,SAASzmD,KAAKsiD,SAGhCwC,cAAe,SAAUxzC,GACxB,GAAIif,GAASjf,EAAE7J,OACdiP,EAAS6Z,EAAO3B,WAEjB5uB,MAAKojD,gBAED7yB,IAAWvwB,KAAKmmD,YACnBnmD,KAAK0mD,MAAMhwC,GAEX1W,KAAK2mD,QAAQjwC,GAGd1W,KAAKsiD,OAAO97B,SACZxmB,KAAKsiD,OAAOv6C,KAAK,aAGlBy+C,iBAAkB,SAAUl1C,GAC3B,GAAIif,GAASjf,EAAE7J,MACf8oB,GAAOvf,WAAW,GAClBhR,KAAKkjD,eACLljD,KAAK+kD,aAGNxX,cAAe,SAAUj8B,GAIxB,GAHAtR,KAAK4mD,gBAAiB,EACtBnnD,EAAEwjD,KAAKf,YAAYxhD,UAAUmkD,mBAAmBjkD,KAAKZ,KAAMsR,GAE1B,kBAAtBtR,MAAgB,YAAkB,CAE5C,GAAIiyC,GAAUjyC,KAAK6mD,cAClBt2B,EAASjf,EAAE7J,OACXq/C,EAAqBv2B,EAAOw2B,YAE7Bx2B,GAAOvf,WAAW,GAIlBhR,KAAKgnD,gBAAkB/U,GAAS6U,EAAqB,GAAK,GAC1D9mD,KAAKinD,qBAAqB,EAAGH,GAG9B9mD,KAAKsiD,OAAOv6C,KAAK,cAGlB8lC,aAAc,SAAUv8B,GACnBtR,KAAK4mD,gBACR5mD,KAAKutC,cAAcj8B,GAEpBtR,KAAK4mD,gBAAiB,CACtB,IAAInnC,GAAazf,KAAK8kB,KAAKlF,uBAAuBtO,EAAEyQ,cAAcklB,QAAQ,IACzEvwB,EAAS1W,KAAK8kB,KAAKpH,mBAAmB+B,GACtC8Q,EAASjf,EAAE7J,MAYZ,OAXAzH,MAAKojD,gBACD7yB,IAAWvwB,KAAKmmD,YACnBnmD,KAAK0mD,MAAMhwC,GAEX1W,KAAK2mD,QAAQjwC,GAGd1W,KAAKsiD,OAAO97B,UAIL,GAGRsnB,YAAa,SAAUx8B,GACtB,GAAIif,GAASjf,EAAE7J,MACf8oB,GAAOvf,WAAW,GAClBhR,KAAKkkD,gBACLlkD,KAAKkjD,eACLljD,KAAK+kD,aAGN2B,MAAO,aAIPC,QAAS,aAITzD,aAAa,WACZljD,KAAKyjD,kBAENA,eAAe,WACd,GAAIC,GAAO1jD,KACVmQ,EAAY1Q,EAAEkkD,eAAeC,mBAAmBF,EAAKpB,OAAOoB,EAE7D,IAAGvzC,EAAW,CACbnQ,KAAKsiD,OAAOrzB,UAAU9e,GACrB8gB,aAAY,EACZ5V,OAAQrb,KAAKknD,mBAEd,IAAI3pB,GAAIv9B,KAAKsiD,OAAOjiB,iBAAiBrgC,KAAKsiD,OAAOhoC,aAChD6sC,EAAI5pB,EAAE,GAAGpqB,KAAOoqB,EAAE,GAAGpqB,IAAMoqB,EAAE,GAAGpqB,KAAO,CACxCnT,MAAKsiD,OAAO3wB,UAAU,GAAIlyB,GAAEwT,OAAOsqB,EAAE,GAAGrqB,IAAKi0C,MAK/CD,gBAAgB,WACf,MAAO,IAAIznD,GAAEwL,MAAM,EAAE,IAEtBm4C,cAAc,WACbpjD,KAAKsiD,OAAO5vB,aACZ1yB,KAAKsiD,OAAO1tB,eAEblC,WAAW,WACV1yB,KAAKojD,mBAKP3jD,EAAEwjD,KAAOxjD,EAAEwjD,SAEXxjD,EAAEwjD,KAAK7iB,UAAY3gC,EAAEwjD,KAAKf,YAAYhiD,QACrCmmD,kBAAmB,WAClB,GAAIt5C,GAAS/M,KAAKsiD,OAAOhoC,YACxB3B,EAAS5L,EAAOJ,WAEjB3M,MAAKmmD,YAAcnmD,KAAKs/C,cAAc3mC,EAAQ3Y,KAAK+C,QAAQ+iD,WAG5DQ,oBAAqB,WACpB,GAAIrU,GAAUjyC,KAAK6mD,aAEnB7mD,MAAKomD,iBAEL,KAAK,GAAIhmD,GAAI,EAAG4xC,EAAIC,EAAQnxC,OAAYkxC,EAAJ5xC,EAAOA,IAC1CJ,KAAKomD,eAAehjD,KAAKpD,KAAKs/C,cAAcrN,EAAQ7xC,GAAIJ,KAAK+C,QAAQgjD,aAErE/lD,KAAKomD,eAAehmD,GAAG2mD,aAAe3mD,GAIxCykD,mBAAoB,SAAUvzC,GAC7B7R,EAAEwjD,KAAKf,YAAYxhD,UAAUmkD,mBAAmBjkD,KAAKZ,KAAMsR,EAG3D,IAAI2gC,GAAUjyC,KAAK6mD,cAClBt2B,EAASjf,EAAE7J,OACXq/C,EAAqBv2B,EAAOw2B,YAE7B/mD,MAAKgnD,gBAAkB/U,GAAS6U,EAAqB,GAAK,GAE1D9mD,KAAKinD,qBAAqB,EAAGH,IAG9BN,iBAAkB,SAAUl1C,GAC3B,GACCvE,GAAQ4L,EADL4X,EAASjf,EAAE7J,MAIX8oB,KAAWvwB,KAAKmmD,cACnBp5C,EAAS/M,KAAKsiD,OAAOhoC,YACrB3B,EAAS5L,EAAOJ,YAEhB4jB,EAAO1B,UAAUlW,IAGlB3Y,KAAKinD,qBAAqB,GAE1BjnD,KAAKonD,2BAEL3nD,EAAEwjD,KAAKf,YAAYxhD,UAAU8lD,iBAAiB5lD,KAAKZ,KAAMsR,IAG1Do1C,MAAO,SAAUvsC,GAOhB,IAAK,GAHJkB,GAHGtG,EAAU/U,KAAKsiD,OAAOvkB,aACzBhxB,EAAS/M,KAAKsiD,OAAOhoC,YACrB3B,EAAS5L,EAAOJ,YACR06C,KAGAjnD,EAAI,EAAG4xC,EAAIj9B,EAAQjU,OAAYkxC,EAAJ5xC,EAAOA,IAC1Cib,GAAUtG,EAAQ3U,GAAG8S,IAAMyF,EAAOzF,IAAK6B,EAAQ3U,GAAG+S,IAAMwF,EAAOxF,KAC/Dk0C,EAAWjkD,MAAM+W,EAAUjH,IAAMmI,EAAO,GAAIlB,EAAUhH,IAAMkI,EAAO,IAGpErb,MAAKsiD,OAAOtkB,WAAWqpB,GAGvBrnD,KAAKonD,4BAGNT,QAAS,SAAUjwC,GAClB,GAAI3J,EAGJ/M,MAAKsiD,OAAOhiB,UAAU7gC,EAAEuV,aAAa0B,EAAQ1W,KAAKgnD,kBAGlDj6C,EAAS/M,KAAKsiD,OAAOhoC,YACrBta,KAAKmmD,YAAYt3B,UAAU9hB,EAAOJ,cAGnCk6C,YAAa,WACZ,GAAI95C,GAAS/M,KAAKsiD,OAAOhoC,YACxB+D,EAAKtR,EAAO4I,eACZL,EAAKvI,EAAO2I,eACZ4I,EAAKvR,EAAO+I,eACZT,EAAKtI,EAAO0I,cAEb,QAAQ4I,EAAI/I,EAAIgJ,EAAIjJ,IAGrB4xC,qBAAsB,SAAUh2C,GAC/B,IAAK,GAAI7Q,GAAI,EAAG4xC,EAAIhyC,KAAKomD,eAAetlD,OAAYkxC,EAAJ5xC,EAAOA,IACtDJ,KAAKomD,eAAehmD,GAAG4Q,WAAWC,IAIpCm2C,yBAA0B,WAGzB,IAAK,GAFDnV,GAAUjyC,KAAK6mD,cAEVzmD,EAAI,EAAG4xC,EAAIhyC,KAAKomD,eAAetlD,OAAYkxC,EAAJ5xC,EAAOA,IACtDJ,KAAKomD,eAAehmD,GAAGyuB,UAAUojB,EAAQ7xC,OAK5CX,EAAE2gC,UAAUj6B,YAAY,WACnB1G,EAAEwjD,KAAK7iB,YACVpgC,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAK7iB,UAAUpgC,MAEhCA,KAAK+C,QAAQ+gD,YAOnBrkD,EAAEwjD,KAAOxjD,EAAEwjD,SAEXxjD,EAAEwjD,KAAKziB,OAAS/gC,EAAEwjD,KAAKf,YAAYhiD,QAClCmmD,kBAAmB,WAClB,GAAI1tC,GAAS3Y,KAAKsiD,OAAO1zB,WAEzB5uB,MAAKmmD,YAAcnmD,KAAKs/C,cAAc3mC,EAAQ3Y,KAAK+C,QAAQ+iD,WAG5DQ,oBAAqB,WACpB,GAAI3tC,GAAS3Y,KAAKsiD,OAAO1zB,YACxB04B,EAAoBtnD,KAAKunD,sBAAsB5uC,EAEhD3Y,MAAKomD,kBACLpmD,KAAKomD,eAAehjD,KAAKpD,KAAKs/C,cAAcgI,EAAmBtnD,KAAK+C,QAAQgjD,cAG7EwB,sBAAuB,SAAU7wC,GAEhC,GAAIiD,GAAQ3Z,KAAKsiD,OAAOthB,QAAUz+B,KAAKiS,IAAIjS,KAAKiR,GAAK,GACpDlI,EAAQtL,KAAK8kB,KAAKrO,QAAQC,EAC3B,OAAO1W,MAAK8kB,KAAKjO,WAAWvL,EAAMJ,EAAIyO,EAAOrO,EAAMH,EAAIwO,KAGxD+sC,MAAO,SAAUhwC,GAChB,GAAI4wC,GAAoBtnD,KAAKunD,sBAAsB7wC,EAGnD1W,MAAKomD,eAAe,GAAGv3B,UAAUy4B,GAGjCtnD,KAAKsiD,OAAOzzB,UAAUnY,IAGvBiwC,QAAS,SAAUjwC,GAClB,GAAI8wC,GAAaxnD,KAAKmmD,YAAYv3B,YACjC6R,EAAS+mB,EAAWv7C,WAAWyK,EAEhC1W,MAAKsiD,OAAO3hB,UAAUF,MAIxBhhC,EAAE+gC,OAAOr6B,YAAY,WAChB1G,EAAEwjD,KAAKziB,SACVxgC,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAKziB,OAAOxgC,MAE7BA,KAAK+C,QAAQ+gD,UAKlB9jD,KAAK4H,GAAG,MAAO,WACV5H,KAAK6jD,SAAW7jD,KAAK6jD,QAAQ/b,WAChC9nC,KAAK6jD,QAAQjc,aAIf5nC,KAAK4H,GAAG,SAAU,WACb5H,KAAK6jD,SAAW7jD,KAAK6jD,QAAQ/b,WAChC9nC,KAAK6jD,QAAQhc,kBAKhBpoC,EAAEuY,IAAI9R,cACLuhD,aAAa,IAGdhoD,EAAEuY,IAAI0vC,YAAcjoD,EAAEwwB,QAAQ/vB,QAE7BoF,WAAY,SAAU+d,GACrBrjB,KAAK8kB,KAAOzB,EACZrjB,KAAKmd,WAAakG,EAAIlG,WACtBnd,KAAKmvC,MAAQ9rB,EAAIrE,OAAOyB,aAGzBmnB,SAAU,WACTnoC,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,aAAcnd,KAAKutC,cAAevtC,MACjEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,WAAYnd,KAAK8tC,YAAa9tC,MAC7DP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,YAAand,KAAK6tC,aAAc7tC,MAC3DA,KAAK2nD,aACRloD,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,gBAAiBnd,KAAKutC,cAAevtC,MACpEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,cAAend,KAAK8tC,YAAa9tC,MAChEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,gBAAiBnd,KAAK6tC,aAAc7tC,MACnEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,kBAAmBnd,KAAK4nD,eAAgB5nD,QAGvEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,cAAend,KAAK4nD,eAAgB5nD,MACnEP,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,aAAcnd,KAAK6nD,cAAe7nD,QAInE6nC,YAAa,WACZpoC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,aAAcnd,KAAKutC,eACnD9tC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,WAAYnd,KAAK8tC,aACjDruC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,YAAand,KAAK6tC,cAC9C7tC,KAAK2nD,aACRloD,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,gBAAiBnd,KAAKutC,eACtD9tC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,cAAend,KAAK8tC,aACpDruC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,gBAAiBnd,KAAK6tC,cACtDpuC,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,kBAAmBnd,KAAK4nD,kBAExDnoD,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,cAAend,KAAK4nD,gBACpDnoD,EAAEiT,SAAS7K,IAAI7H,KAAKmd,WAAY,aAAcnd,KAAK6nD,iBAIrDC,YAAa,SAAUx2C,EAAG3K,GAKzB,GAAIohD,KACJ,IAAyB,mBAAdz2C,GAAE21B,QAAyB,CACrC,IAAK31B,EAAE21B,QAAQnmC,OACd,MAEDinD,GAAaz2C,EAAE21B,QAAQ,OACjB,CAAA,GAAsB,UAAlB31B,EAAE27B,YAMZ,MAJS,IADT8a,EAAaz2C,GACCtR,KAAKskC,aAAahzB,GACnB,OAMd,GAAI0I,GAAiBha,KAAK8kB,KAAKpF,2BAA2BqoC,GACzDtoC,EAAazf,KAAK8kB,KAAKlF,uBAAuBmoC,GAC9CrxC,EAAS1W,KAAK8kB,KAAKpH,mBAAmB+B;AAEvCzf,KAAK8kB,KAAK/c,KAAKpB,GACd+P,OAAQA,EACR+I,WAAYA,EACZzF,eAAgBA,EAChBguC,MAAOD,EAAWC,MAClBC,MAAOF,EAAWE,MAClBlmC,cAAezQ,KAKdgzB,aAAc,SAAUhzB,GACpB,GAAI00B,GAAa10B,EAAE00B,WAAa10B,EAAEyQ,cAAcikB,UAC5CC,EAAUxmC,EAAEiT,SAASwzB,YAAeF,EAAYvmC,EAAEiT,SAASwzB,UAM/D,OAAKD,IAAWA,EAAU,KAAiB,IAAVA,GAAmB30B,EAAE7J,OAAO0+B,kBAAoB70B,EAAEoQ,YAC/EjiB,EAAEiT,SAAS6hB,KAAKjjB,IACT,IAEX7R,EAAEiT,SAASwzB,WAAaF,GACjB,IAGduH,cAAe,SAAUj8B,GACxB,GAAKtR,KAAK8kB,KAAKtL,QAAf,CAIA,GAAI7S,GAAO,YACX3G,MAAK8nD,YAAYx2C,EAAG3K,KAIrBmnC,YAAa,SAAUx8B,GACtB,GAAKtR,KAAK8kB,KAAKtL,QAAf,CAIA,GAAI7S,GAAO,UACX3G,MAAK8nD,YAAYx2C,EAAG3K,KAGrBihD,eAAgB,SAAUt2C,GACzB,GAAKtR,KAAK8kB,KAAKtL,QAAf,CAIA,GAAI7S,GAAO,aACP3G,MAAK2nD,cACRhhD,EAAO,iBAER3G,KAAK8nD,YAAYx2C,EAAG3K,KAGrBkhD,cAAe,SAAUv2C,GACxB,GAAKtR,KAAK8kB,KAAKtL,QAAf,CAIA,GAAI7S,GAAO,YACX3G,MAAK8nD,YAAYx2C,EAAG3K,KAGrBknC,aAAc,SAAUv8B,GACvB,GAAKtR,KAAK8kB,KAAKtL,QAAf,CAIA,GAAI7S,GAAO,WACX3G,MAAK8nD,YAAYx2C,EAAG3K,KAGrBghD,UAAW,WACV,GAAIz/C,GAAK7I,EAAO8I,UAAUC,UAEtB8/C,EAAOhgD,EAAG3E,QAAQ,QACtB,IAAI2kD,EAAO,EAEV,MAAO/4C,UAASjH,EAAGigD,UAAUD,EAAO,EAAGhgD,EAAG3E,QAAQ,IAAK2kD,IAAQ,GAGhE,IAAIE,GAAUlgD,EAAG3E,QAAQ,WACzB,IAAI6kD,EAAU,EAAG,CAEhB,GAAIC,GAAKngD,EAAG3E,QAAQ,MACpB,OAAO4L,UAASjH,EAAGigD,UAAUE,EAAK,EAAGngD,EAAG3E,QAAQ,IAAK8kD,IAAM,IAG5D,GAAIlpB,GAAOj3B,EAAG3E,QAAQ,QACtB,OAAI47B,GAAO,EAEHhwB,SAASjH,EAAGigD,UAAUhpB,EAAO,EAAGj3B,EAAG3E,QAAQ,IAAK47B,IAAQ,KAIzD,KAIT1/B,EAAEuY,IAAI7R,YAAY,aAAc,cAAe1G,EAAEuY,IAAI0vC,aAIrDjoD,EAAEsuB,OAAOi1B,MAAQvjD,EAAEsuB,OAAO7tB,QAIzBsvB,iBAAkB,WAEjB,GAAKxvB,KAAK+C,QAAQkrB,UAAlB,CAMA,GAAIb,GAAOptB,KAAKkvB,MACfnoB,GAAU,WAAY,YAAa,YAAa,WAAY,cAAe,aAAc,WAAY,YAClG/G,MAAK2nD,YACR5gD,EAAOpF,QAAQ,gBAAiB,cAAe,gBAAiB,oBAEhEoF,EAAOpF,QAAQ,gBAGhBlC,EAAEwO,QAAQyC,SAAS0c,EAAM,qBACzB3tB,EAAEiT,SAAS9K,GAAGwlB,EAAM,QAASptB,KAAKuhB,cAAevhB,MACjDP,EAAEiT,SAAS9K,GAAGwlB,EAAM,WAAYptB,KAAKgwB,YAAahwB,KAElD,KAAK,GAAII,GAAI,EAAGA,EAAI2G,EAAOjG,OAAQV,IAClCX,EAAEiT,SAAS9K,GAAGwlB,EAAMrmB,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,KAGlDP,GAAEwwB,QAAQC,aACblwB,KAAK2hB,SAAW,GAAIliB,GAAEwwB,QAAQC,WAAWlwB,MAErCA,KAAK+C,QAAQmrB,WAChBluB,KAAK2hB,SAASzE,YAIjByqC,UAAW,WACV,GAAIz/C,GAAK7I,EAAO8I,UAAUC,UAEtB8/C,EAAOhgD,EAAG3E,QAAQ,QACtB,IAAI2kD,EAAO,EAEV,MAAO/4C,UAASjH,EAAGigD,UAAUD,EAAO,EAAGhgD,EAAG3E,QAAQ,IAAK2kD,IAAQ,GAGhE,IAAIE,GAAUlgD,EAAG3E,QAAQ,WACzB,IAAI6kD,EAAU,EAAG,CAEhB,GAAIC,GAAKngD,EAAG3E,QAAQ,MACpB,OAAO4L,UAASjH,EAAGigD,UAAUE,EAAK,EAAGngD,EAAG3E,QAAQ,IAAK8kD,IAAM,IAG5D,GAAIlpB,GAAOj3B,EAAG3E,QAAQ,QACtB,OAAI47B,GAAO,EAEHhwB,SAASjH,EAAGigD,UAAUhpB,EAAO,EAAGj3B,EAAG3E,QAAQ,IAAK47B,IAAQ,KAIzD,KAST1/B,EAAE6oD,YAEDC,aAAc,SAAUxzC,GAEvB,IAAK,GADD3J,MACKhL,EAAI,EAAG4xC,EAAIj9B,EAAQjU,OAAYkxC,EAAJ5xC,EAAOA,IAC1CgL,EAAMhI,KAAKpD,KAAKwoD,YAAYzzC,EAAQ3U,IAErC,OAAOgL,IAGRo9C,YAAa,SAAU9xC,GACtB,MAAOjX,GAAEkU,OAAO+C,EAAOxD,IAAKwD,EAAOvD,OAIrC1T,EAAE+hD,aAAe/hD,EAAES,OAAOT,EAAE+hD,kBAE3BS,aAAc,SAAU7e,GACvB,GAGCrH,GAAIC,EAHDysB,EAAcrlB,EAAQtiC,OACzBghD,EAAO,EACP9tC,EAAMvU,EAAEwT,OAAOM,UAGhB,IAAIk1C,EAAc,EAAG,CACpB,IAAK,GAAIroD,GAAI,EAAOqoD,EAAJroD,EAAiBA,IAChC27B,EAAKqH,EAAQhjC,GACb47B,EAAKoH,GAAShjC,EAAI,GAAKqoD,GACvB3G,IAAU9lB,EAAG7oB,IAAM4oB,EAAG5oB,KAAOa,GAC1B,EAAIzR,KAAK+R,IAAIynB,EAAG7oB,IAAMc,GAAOzR,KAAK+R,IAAI0nB,EAAG9oB,IAAMc,GAEnD8tC,GAAc,QAAPA,EAAmB,QAAY,EAGvC,MAAOv/C,MAAK8J,IAAIy1C,IAGjBE,aAAc,SAAUF,EAAM4G,GAC7B,GAAIC,EAoBJ,OAlBID,GAEFC,EADG7G,GAAQ,KACO,KAAPA,GAAeiB,QAAQ,GAAK,MAE7BjB,EAAKiB,QAAQ,GAAK,YAG7BjB,GAAQ,QAGP6G,EADG7G,GAAQ,SACAA,EAAO,SAASiB,QAAQ,GAAK,YAC9BjB,GAAQ,MACPA,EAAO,MAAMiB,QAAQ,GAAK,SAE3BxgD,KAAK6gB,KAAK0+B,GAAQ,aAIvB6G,GAGRlH,iBAAkB,SAAUjjB,EAAUkqB,EAAUE,GAC/C,GAAI1H,EAEJ,IAAIwH,EAGFxH,EADG1iB,EAAW,KACCA,EAAY,KAAMukB,QAAQ,GAAK,MAEhCxgD,KAAK6gB,KAAKob,GAAY,SAKrC,IAFAA,GAAY,QAERA,EAAW,KACd0iB,GAAe1iB,EAAW,MAAMukB,QAAQ,GAAK,aACvC,CACN,GAAI8F,GAAS,KACTD,KACHpqB,EAAsB,EAAXA,EACXqqB,EAAS,OAEV3H,EAAc3+C,KAAK6gB,KAAKob,GAAYqqB,EAItC,MAAO3H,MAKTzhD,EAAEQ,KAAKC,OAAOT,EAAE+7B,UAGfstB,kBAAmB,SAAoB3xB,EAAa4E,EAAcC,EAAc+sB,GAC/E,MAAO/oD,MAAKgpD,uBAAuB7xB,EAAG6E,EAAI+sB,KACxC/oD,KAAKgpD,uBAAuBjtB,EAAIC,EAAI+sB,IACpC/oD,KAAKgpD,uBAAuB7xB,EAAG4E,EAAIC,KACnCh8B,KAAKgpD,uBAAuB7xB,EAAG4E,EAAIgtB,IAItCC,uBAAwB,SAAoB7xB,EAAa4E,EAAcC,GACtE,OAAQA,EAAG7wB,EAAIgsB,EAAEhsB,IAAM4wB,EAAG7wB,EAAIisB,EAAEjsB,IAAM6wB,EAAG5wB,EAAIgsB,EAAEhsB,IAAM6wB,EAAG9wB,EAAIisB,EAAEjsB,MAIhEzL,EAAEg+B,SAASx3B,SAGV+G,WAAY,WACX,GAEC5M,GAAG+2B,EAAG4E,EAFHtvB,EAASzM,KAAK69B,gBACjBv9B,EAAMmM,EAASA,EAAO3L,OAAS,CAGhC,IAAId,KAAKipD,+BACR,OAAO,CAGR,KAAK7oD,EAAIE,EAAM,EAAGF,GAAK,EAAGA,IAKzB,GAJA+2B,EAAI1qB,EAAOrM,EAAI,GACf27B,EAAKtvB,EAAOrM,GAGRJ,KAAKkpD,6BAA6B/xB,EAAG4E,EAAI37B,EAAI,GAChD,OAAO,CAIT,QAAO,GAKR8+C,oBAAqB,SAAUxoC,EAAQyyC,GAEtC,MAAKnpD,MAAK8kB,KAIH9kB,KAAKopD,mBAAmBppD,KAAK8kB,KAAKzF,mBAAmB3I,GAASyyC,IAH7D,GASTC,mBAAoB,SAAU3hB,EAAU0hB,GACvC,GAAI18C,GAASzM,KAAK69B,gBACjBv9B,EAAMmM,EAASA,EAAO3L,OAAS,EAC/BuoD,EAAY58C,EAASA,EAAOnM,EAAM,GAAK,KAEvCgpD,EAAWhpD,EAAM,CAElB,OAAIN,MAAKipD,6BAA6B,IAC9B,EAGDjpD,KAAKkpD,6BAA6BG,EAAW5hB,EAAU6hB,EAAUH,EAAY,EAAI,IAKzFF,6BAA8B,SAAUM,GACvC,GAAI98C,GAASzM,KAAK69B,gBACjBv9B,EAAMmM,EAASA,EAAO3L,OAAS,CAIhC,OAFAR,IAAOipD,GAAe,GAEdvpD,KAAK69B,iBAA0B,GAAPv9B,GAKjC4oD,6BAA8B,SAAU/xB,EAAG4E,EAAIutB,EAAUE,GACxD,GACCxtB,GAAI+sB,EADDt8C,EAASzM,KAAK69B,eAGlB2rB,GAAWA,GAAY,CAGvB,KAAK,GAAInpD,GAAIipD,EAAUjpD,EAAImpD,EAAUnpD,IAIpC,GAHA27B,EAAKvvB,EAAOpM,EAAI,GAChB0oD,EAAKt8C,EAAOpM,GAERZ,EAAE+7B,SAASstB,kBAAkB3xB,EAAG4E,EAAIC,EAAI+sB,GAC3C,OAAO,CAIT,QAAO,KAKTtpD,EAAEk7B,QAAQ10B,SAET+G,WAAY,WACX,GAAIy8C,GAEHnpD,EAAKopD,EAAYL,EAAWC,EAD5B78C,EAASzM,KAAK69B,eAGf,OAAI79B,MAAKipD,gCACD,GAGRQ,EAAqBhqD,EAAEg+B,SAAS/8B,UAAUsM,WAAWpM,KAAKZ,QAIlD,GAGRM,EAAMmM,EAAO3L,OACb4oD,EAAaj9C,EAAO,GACpB48C,EAAY58C,EAAOnM,EAAM,GACzBgpD,EAAWhpD,EAAM,EAGVN,KAAKkpD,6BAA6BG,EAAWK,EAAYJ,EAAU,OAI5E7pD,EAAEuY,IAAI7R,YAAY,WACbnG,KAAK+C,QAAQ4mD,cAChB3pD,KAAK2pD,YAAc,GAAIlqD,GAAE4xC,QAAQuL,KACjC58C,KAAKuxC,WAAWvxC,KAAK2pD,gBAKvBlqD,EAAEmqD,QAAUnqD,EAAE0F,MAAMjF,QACnB2F,UAAWpG,EAAE6G,MAAMC,QAEnBjB,WAAY,SAAUvC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,GAEnB/C,KAAK6pD,UACL7pD,KAAK8pD,kBACL9pD,KAAK+pD,YAAc,MAGpBjiB,QAAS,WACR,MAA4B,QAArB9nC,KAAK+pD,aAGb/nC,QAAS,WACHhiB,KAAK8nC,WAEV9nC,KAAK+pD,YAAYpiD,QAAQqa,WAG1BgoC,WAAY,SAAU3mC,GACrB,GAICjjB,GAJG+P,EAAY1Q,EAAEwO,QAAQ+B,OAAO,MAAO,wBACvCi6C,EAAc,EACdC,EAAoBlqD,KAAKmqD,eAAiB,GAC1CC,EAAepqD,KAAKqqD,gBAAgBhnC,EAMrC,KAHArjB,KAAKsqD,kBAAoB7qD,EAAEwO,QAAQ+B,OAAO,MAAO,oCACjDhQ,KAAK8kB,KAAOzB,EAEPjjB,EAAI,EAAGA,EAAIgqD,EAAatpD,OAAQV,IAChCgqD,EAAahqD,GAAG0nC,UAChBsiB,EAAahqD,GAAGmqD,MAClBvqD,KAAKwqD,qBACJJ,EAAahqD,GACbJ,KAAKsqD,kBACL,WACC,MAAOL,MAERC,GAIDlqD,KAAKyqD,iBACJL,EAAahqD,GAAGuH,QAChB3H,KAAKsqD,kBACLL,IACAC,EACAE,EAAahqD,GAAG4tB,OAChB,GAOJ,OAAKi8B,IAKLjqD,KAAK0qD,mBAAqBT,EAG1BjqD,KAAK2qD,kBAAoBlrD,EAAEwO,QAAQ+B,OAAO,KAAM,wBAGhDG,EAAUC,YAAYpQ,KAAKsqD,mBAC3Bn6C,EAAUC,YAAYpQ,KAAK2qD,mBAEpBx6C,GAdP,QAiBDy6C,cAAe,WAEd,IAAK,GAAIC,KAAa7qD,MAAK6pD,OACtB7pD,KAAK6pD,OAAO9oD,eAAe8pD,KAE9B7qD,KAAK8qD,eACJ9qD,KAAK6pD,OAAOgB,GAAW7jB,OACvBhnC,KAAK6pD,OAAOgB,GAAWljD,QAAQuV,OAC/Bld,KAAK6pD,OAAOgB,GAAWljD,SAIxB3H,KAAK6pD,OAAOgB,GAAWljD,QAAQqa,UAG/BhiB,KAAK6pD,OAAOgB,GAAWljD,QACrBE,IAAI,UAAW7H,KAAK+qD,kBAAmB/qD,MACvC6H,IAAI,WAAY7H,KAAKgrD,oBAAqBhrD,MAG9CA,MAAK6pD,SAGL,KAAK,GAAIzpD,GAAI,EAAG4xC,EAAIhyC,KAAK8pD,eAAehpD,OAAYkxC,EAAJ5xC,EAAOA,IACtDJ,KAAK8qD,eACJ9qD,KAAK8pD,eAAe1pD,GAAG4mC,OACvBhnC,KAAK8pD,eAAe1pD,GAAG8hB,SACvBliB,KAGFA,MAAK8pD,kBACL9pD,KAAK2qD,kBAAoB,MAG1BH,qBAAqB,SAASS,EAAK96C,EAAW+6C,EAAeC,GAY5D,IAAK,GAXDC,GAAS3rD,EAAEwO,QAAQ+B,OAAO,MAAO,yBAA0BG,GAC3D62B,EAAShnC,KAAK0yC,eACjBviC,UAAUA,EACV6d,MAAMi9B,EAAI1X,KACVrjC,UAAUi7C,EAAkB,IAAMF,EAAItkD,KACtCub,SAAS,WACRliB,KAAKqrD,iBAAiBD,EAAOpkB,IAE9BtlC,QAAQ1B,OAELsrD,EAAK7rD,EAAEwO,QAAQ+B,OAAO,KAAM,GAAIo7C,GAC3BhrD,EAAI,EAAGA,EAAI6qD,EAAIV,MAAMzpD,OAAQV,IAAK,CAC1C,GAAI+jB,GAAI8mC,EAAIV,MAAMnqD,GAAGmrD,EAAK9rD,EAAEwO,QAAQ+B,OAAO,KAAM,GAAIs7C,EACjDnnC,GAAE2jB,SACL9nC,KAAKyqD,iBACJtmC,EAAExc,QACF4jD,EACAL,IACAC,EACAhnC,EAAE6J,SAKNy8B,iBAAkB,SAAU9iD,EAASwI,EAAW85C,EAAakB,EAAiBK,EAAYC,GACzF,GAAI9kD,GAAOgB,EAAQhB,IAEnB3G,MAAK6pD,OAAOljD,MAEZ3G,KAAK6pD,OAAOljD,GAAMgB,QAAUA,EAE5B3H,KAAK6pD,OAAOljD,GAAMqgC,OAAShnC,KAAK0yC,eAC/B/rC,KAAMA,EACNqnB,MAAOw9B,EACPt7C,UAAWi7C,EAAkB,IAAMxkD,EACnCwJ,UAAWA,EACX+R,SAAUliB,KAAK6pD,OAAOljD,GAAMgB,QAAQuV,OACpCxb,QAAS1B,KAAK6pD,OAAOljD,GAAMgB,UAG5B3H,KAAK6pD,OAAOljD,GAAMsjD,YAAcA,EAE7BwB,GACFzrD,KAAK6pD,OAAOljD,GAAMgB,QAAQC,GAAG,UAAU5H,KAAK0rD,iBAAiB1rD,MAE9DA,KAAK6pD,OAAOljD,GAAMgB,QAChBC,GAAG,UAAW5H,KAAK+qD,kBAAmB/qD,MACtC4H,GAAG,WAAY5H,KAAKgrD,oBAAqBhrD,OAE5C0yC,cAAe,SAAU3vC,GAExB,GAAIgwC,GAAOtzC,EAAEwO,QAAQ+B,OAAO,IAAKjN,EAAQmN,WAAa,GAAInN,EAAQoN,UAkBlE,OAjBA4iC,GAAKjgB,KAAO,IAER/vB,EAAQwwC,OACXR,EAAK1rB,UAAYtkB,EAAQwwC,MAGtBxwC,EAAQirB,QACX+kB,EAAK/kB,MAAQjrB,EAAQirB,OAGtBvuB,EAAEiT,SACA9K,GAAGmrC,EAAM,QAAStzC,EAAEiT,SAAS0d,iBAC7BxoB,GAAGmrC,EAAM,YAAatzC,EAAEiT,SAAS0d,iBACjCxoB,GAAGmrC,EAAM,WAAYtzC,EAAEiT,SAAS0d,iBAChCxoB,GAAGmrC,EAAM,QAAStzC,EAAEiT,SAASC,gBAC7B/K,GAAGmrC,EAAM,QAAShwC,EAAQmf,SAAUnf,EAAQrB,SAEvCqxC,GAGR+X,eAAgB,SAAU9jB,EAAQ9kB,GACjCziB,EAAEiT,SACA7K,IAAIm/B,EAAQ,QAASvnC,EAAEiT,SAAS0d,iBAChCvoB,IAAIm/B,EAAQ,YAAavnC,EAAEiT,SAAS0d,iBACpCvoB,IAAIm/B,EAAQ,WAAYvnC,EAAEiT,SAAS0d,iBACnCvoB,IAAIm/B,EAAQ,QAASvnC,EAAEiT,SAASC,gBAChC9K,IAAIm/B,EAAQ,QAAS9kB,IAGxB6oC,kBAAmB,SAAUz5C,GAE5BtR,KAAKgiB,UAGLhiB,KAAK+pD,YAAc/pD,KAAK6pD,OAAOv4C,EAAE3J,SAEjClI,EAAEwO,QAAQyC,SAAS1Q,KAAK+pD,YAAY/iB,OAAQ,uCAE5ChnC,KAAK2rD,sBAEL3rD,KAAK+H,KAAK,WAGXijD,oBAAqB,WACpBhrD,KAAK4rD,sBAELnsD,EAAEwO,QAAQ4C,YAAY7Q,KAAK+pD,YAAY/iB,OAAQ,uCAE/ChnC,KAAK+pD,YAAc,KAEnB/pD,KAAK+H,KAAK,YAGX8jD,eAAgB,SAAUlkD,GACzB,GAGC4jD,GAAIO,EAAIC,EAAI/kB,EAHT72B,EAAYnQ,KAAK2qD,kBACpBxd,EAAUntC,KAAKgsD,WAAWrkD,GAC1BqqC,EAAI7E,EAAQrsC,MAIb,KAAKgrD,EAAK,EAAGC,EAAK/rD,KAAK8pD,eAAehpD,OAAairD,EAALD,EAASA,IACtD9rD,KAAK8qD,eAAe9qD,KAAK8pD,eAAegC,GAAI9kB,OAAQhnC,KAAK8pD,eAAegC,GAAI5pC,SAK7E,KAHAliB,KAAK8pD,kBAGE35C,EAAU6V,YAChB7V,EAAU0Q,YAAY1Q,EAAU6V,WAGjC,KAAK,GAAI5lB,GAAI,EAAO4xC,EAAJ5xC,EAAOA,IAClB,WAAa+sC,GAAQ/sC,KAAO+sC,EAAQ/sC,GAAG0nC,UAI3CyjB,EAAK9rD,EAAEwO,QAAQ+B,OAAO,KAAM,GAAIG,GAEhC62B,EAAShnC,KAAK0yC,eACb1kB,MAAOmf,EAAQ/sC,GAAG4tB,MAClBulB,KAAMpG,EAAQ/sC,GAAGmzC,KACjBpjC,UAAWo7C,EACXrpC,SAAUirB,EAAQ/sC,GAAG8hB,SACrBxgB,QAASyrC,EAAQ/sC,GAAGsB,UAGrB1B,KAAK8pD,eAAe1mD,MACnB4jC,OAAQA,EACR9kB,SAAUirB,EAAQ/sC,GAAG8hB,aAIxBmpC,iBAAkB,SAAUY,EAAQjlB,GAChChnC,KAAKksD,aACPlsD,KAAK0rD,oBAGL1rD,KAAKgiB,UACLhiB,KAAKksD,aAAeD,EACpBjsD,KAAKmsD,YAAcnlB,EACnBilB,EAAQpiD,MAAM0vB,QAAU,QACxB0yB,EAAQpiD,MAAM+E,IAAOo4B,EAAO/3B,UAAY,EAAK,OAG/Cy8C,iBAAiB,WACb1rD,KAAKksD,eACPlsD,KAAKksD,aAAariD,MAAM0vB,QAAU,OAClCv5B,KAAKksD,aAAe,KACpBlsD,KAAKmsD,YAAc,OAGrBR,oBAAqB,WAEpB,GAAI1B,GAAcjqD,KAAK+pD,YAAYE,YAClCmC,EAAkBpsD,KAAK0qD,iBACvB2B,EAAkBrsD,KAAK+pD,YAAY/iB,OAAO/3B,UAAY,CACpDjP,MAAKksD,eACPlsD,KAAKksD,aAAariD,MAAM0vB,QAAU,QAEhCv5B,KAAKmsD,cACPE,EAAkBrsD,KAAKmsD,YAAYl9C,UAAY,GAEhDjP,KAAK0rD,mBAEL1rD,KAAK6rD,eAAe7rD,KAAK+pD,YAAYpiD,SAGrC3H,KAAK2qD,kBAAkB9gD,MAAM+E,IAAMy9C,EAAkB,KAEjC,IAAhBpC,IACHxqD,EAAEwO,QAAQyC,SAAS1Q,KAAKsqD,kBAAmB,8BAC3C7qD,EAAEwO,QAAQyC,SAAS1Q,KAAK2qD,kBAAmB,6BAGxCV,IAAgBmC,IACnB3sD,EAAEwO,QAAQyC,SAAS1Q,KAAKsqD,kBAAmB,iCAC3C7qD,EAAEwO,QAAQyC,SAAS1Q,KAAK2qD,kBAAmB,gCAG5C3qD,KAAK2qD,kBAAkB9gD,MAAM0vB,QAAU,SAGxCqyB,oBAAqB,WACpB5rD,KAAK2qD,kBAAkB9gD,MAAM0vB,QAAU,OAEvC95B,EAAEwO,QAAQ4C,YAAY7Q,KAAKsqD,kBAAmB,8BAC9C7qD,EAAEwO,QAAQ4C,YAAY7Q,KAAKsqD,kBAAmB,iCAC9C7qD,EAAEwO,QAAQ4C,YAAY7Q,KAAK2qD,kBAAmB,4BAC9ClrD,EAAEwO,QAAQ4C,YAAY7Q,KAAK2qD,kBAAmB,kCAKhDlrD,EAAE09C,QAAU19C,EAAE0F,MAAMjF,QACnBoF,WAAY,SAAU+d,GACrBrjB,KAAK8kB,KAAOzB,EACZrjB,KAAK+8C,WAAa15B,EAAIrE,OAAO2B,UAE7B3gB,KAAKmd,WAAakG,EAAItgB,QAAQupD,oBAAsB7sD,EAAEwO,QAAQ+B,OAAO,MAAO,uBAAwBhQ,KAAK+8C,YAAc,KACvH/8C,KAAKusD,kBAAmB,EAExBvsD,KAAK8kB,KAAKld,GAAG,WAAY5H,KAAKs+C,YAAat+C,OAG5Cq9C,QAAS,WACRr9C,KAAK8kB,KAAKjd,IAAI,WAAY7H,KAAKs+C,YAAat+C,MAExCA,KAAKmd,aACRnd,KAAK+8C,WAAWl8B,YAAY7gB,KAAKmd,YACjCnd,KAAKmd,WAAa,OAIpBghC,cAAe,SAAU8C,GACxB,MAAKjhD,MAAKmd,YAGV8jC,EAAUtE,QAAUsE,EAAUtE,SAAW,GAGR,IAA7BsE,EAAUtE,QAAQ77C,QAAiBd,KAAKusD,iBAInCtL,EAAUtE,QAAQ77C,OAAS,GAAKd,KAAKusD,mBAC7C9sD,EAAEwO,QAAQ4C,YAAY7Q,KAAKmd,WAAY,+BACvCnd,KAAKusD,kBAAmB,IALxB9sD,EAAEwO,QAAQyC,SAAS1Q,KAAKmd,WAAY,+BACpCnd,KAAKusD,kBAAmB,GAOzBvsD,KAAKmd,WAAWkK,WACd45B,EAAUtE,QAAQ77C,OAAS,EAAI,8CAAgDmgD,EAAUtE,QAAU,gBAAuB,IAC3H,SAAWsE,EAAU1N,KAAO,UAEtBvzC,MAlBCA,MAqBTugD,eAAgB,SAAU7pC,GACzB,GAAI/H,GAAM3O,KAAK8kB,KAAKzF,mBAAmB3I,GACtC81C,EAAmBxsD,KAAKmd,UAOzB,OALInd,MAAKmd,aACRqvC,EAAiB3iD,MAAMsoB,WAAa,UACpC1yB,EAAEwO,QAAQiE,YAAYs6C,EAAkB79C,IAGlC3O,MAGR0hD,YAAa,WAIZ,MAHI1hD,MAAKmd,YACR1d,EAAEwO,QAAQyC,SAAS1Q,KAAKmd,WAAY,8BAE9Bnd,MAGR4hD,YAAa,WAIZ,MAHI5hD,MAAKmd,YACR1d,EAAEwO,QAAQ4C,YAAY7Q,KAAKmd,WAAY,8BAEjCnd,MAGRs+C,YAAa,WACRt+C,KAAKmd,aACRnd,KAAKmd,WAAWtT,MAAMsoB,WAAa,aAMtC1yB,EAAEgtD,YAAchtD,EAAEmqD,QAAQ1pD,QAEzB0F,SACC23C,KAAM,QAGPx6C,SACCg8B,YACAa,WACAW,aACAa,UACA7Q,UACAm8B,UACApQ,QACAqQ,SACAC,aACAvrD,UAGDiE,WAAY,SAAUvC,GAErB,IAAK,GAAI4D,KAAQ3G,MAAK+C,QACjB/C,KAAK+C,QAAQhC,eAAe4F,IAC3B5D,EAAQ4D,KACX5D,EAAQ4D,GAAQlH,EAAES,UAAWF,KAAK+C,QAAQ4D,GAAO5D,EAAQ4D,IAK5D3G,MAAKmqD,cAAgB,oBACrB1qD,EAAEmqD,QAAQlpD,UAAU4E,WAAW1E,KAAKZ,KAAM+C,IAG3CsnD,gBAAiB,SAAUhnC,GAE1B,QAEEykB,QAAS9nC,KAAK+C,QAAQw9B,UACtB54B,QAAS,GAAIlI,GAAEm9C,KAAKiQ,UAAUxpC,EAAKrjB,KAAK+C,QAAQw9B,WAChDvS,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQ5M,YAGxCuH,QAAS9nC,KAAK+C,QAAQw9B,UACtB54B,QAAS,GAAIlI,GAAEm9C,KAAKxc,UAAU/c,EAAKrjB,KAAK+C,QAAQw9B,WAChDvS,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQ5M,YAGxCuH,QAAS9nC,KAAK+C,QAAQ1B,MACtBsG,QAAS,GAAIlI,GAAEm9C,KAAKkQ,MAAMzpC,EAAKrjB,KAAK+C,QAAQ1B,OAC5C2sB,MAAO,2CAGP8Z,SAAQ,EACRyL,KAAK,KACL5sC,KAAK,QACL4jD,QACCziB,QAAS9nC,KAAK+C,QAAQg8B,SACtBp3B,QAAS,GAAIlI,GAAEm9C,KAAKnf,SAASpa,EAAKrjB,KAAK+C,QAAQg8B,UAC/C/Q,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQpO,WAGxC+I,QAAS9nC,KAAK+C,QAAQ68B,QACtBj4B,QAAS,GAAIlI,GAAEm9C,KAAKjiB,QAAQtX,EAAKrjB,KAAK+C,QAAQ68B,SAC9C5R,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQvN,UAGxCkI,QAAS9nC,KAAK+C,QAAQq+B,OACtBz5B,QAAS,GAAIlI,GAAEm9C,KAAKpc,OAAOnd,EAAKrjB,KAAK+C,QAAQq+B,QAC7CpT,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQ/L,WAIzC0G,QAAS9nC,KAAK+C,QAAQwtB,OACtB5oB,QAAS,GAAIlI,GAAEm9C,KAAK7uB,OAAO1K,EAAKrjB,KAAK+C,QAAQwtB,QAC7CvC,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQ1O,QAAQ5c,SAExCuX,QAAS9nC,KAAK+C,QAAQ2pD,OACtB/kD,QAAS,GAAIlI,GAAEm9C,KAAKmQ,aAAa1pC,EAAIrjB,KAAK+C,QAAQ2pD,QAClD1+B,MAAM,SAGN8Z,QAAS9nC,KAAK+C,QAAQu5C,KACtB30C,QAAS,GAAIlI,GAAEm9C,KAAKoQ,KAAK3pC,EAAIrjB,KAAK+C,QAAQu5C,MAC1CtuB,MAAM,OAGN8Z,QAAS9nC,KAAK+C,QAAQ4pD,MACtBhlD,QAAS,GAAIlI,GAAEm9C,KAAKqQ,MAAM5pC,EAAIrjB,KAAK+C,QAAQ4pD,OAC3C3+B,MAAM,OAGN8Z,QAAS9nC,KAAK+C,QAAQ6pD,UACtBjlD,QAAS,GAAIlI,GAAEm9C,KAAKsQ,UAAU7pC,EAAIrjB,KAAK+C,QAAQ6pD,WAC/C5+B,MAAM,SAMTg+B,WAAY,SAAUrkD,GACrB,QAEEmgC,QAASngC,EAAQ43C,cACjBvxB,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQE,OAAO/tB,MACvCulB,KAAM9zC,EAAEk8C,UAAUC,KAAKC,QAAQE,OAAOxI,KACtCrxB,SAAUva,EAAQ43C,cAClB79C,QAASiG,IAGTmgC,QAASngC,EAAQi3C,iBACjB5wB,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQG,KAAKhuB,MACrCulB,KAAM9zC,EAAEk8C,UAAUC,KAAKC,QAAQG,KAAKzI,KACpCrxB,SAAUva,EAAQi3C,iBAClBl9C,QAASiG,IAGTqmB,MAAOvuB,EAAEk8C,UAAUC,KAAKC,QAAQC,QAAQ9tB,MACxCulB,KAAM9zC,EAAEk8C,UAAUC,KAAKC,QAAQC,QAAQvI,KACvCrxB,SAAUliB,KAAKgiB,QACftgB,QAAS1B,QAKZ8C,WAAY,SAAUC,GACrBtD,EAAEqD,WAAW9C,KAAM+C,EAEnB,KAAK,GAAI4D,KAAQ3G,MAAK6pD,OACjB7pD,KAAK6pD,OAAO9oD,eAAe4F,IAAS5D,EAAQhC,eAAe4F,IAC9D3G,KAAK6pD,OAAOljD,GAAMgB,QAAQ7E,WAAWC,EAAQ4D,OAMjDlH,EAAE4xC,QAAQuL,KAAOn9C,EAAE4xC,QAAQnxC,QAEzB6C,SACC+c,SAAU,WACV87B,MAAM,EACNuR,SACA5Q,MAAM,EACN3mB,aAAa,MAGdtwB,WAAY,SAAUvC,GAErBtD,EAAE4xC,QAAQ3wC,UAAU4E,WAAW1E,KAAKZ,KAAM+C,GAC1C/C,KAAKotD,aAGD3tD,EAAEgtD,aAAezsD,KAAK+C,QAAQ64C,OACjC57C,KAAKotD,UAAU3tD,EAAEgtD,YAAYlP,MAAQ,GAAI99C,GAAEgtD,YAAYzsD,KAAK+C,QAAQ64C,MACpE57C,KAAKotD,UAAU3tD,EAAEgtD,YAAYlP,MAAM31C,GAAG,SAAU5H,KAAKqtD,gBAAiBrtD,OAEnEP,EAAEgtD,aAAezsD,KAAK+C,QAAQoqD,QACjCntD,KAAKotD,UAAqB,UAAI,GAAI3tD,GAAE6tD,IAAIC,aAAavtD,KAAK+C,QAAQoqD,OAClEntD,KAAKotD,UAAqB,UAAExlD,GAAG,SAAU5H,KAAKqtD,gBAAiBrtD,QAMjEmiB,MAAO,SAAUkB,GAChBrjB,KAAK8kB,KAAOzB,CACZ,IAGCmqC,GAHGr9C,EAAY1Q,EAAEwO,QAAQ+B,OAAO,MAAO,gBACvCy9C,GAAgB,EAChBC,EAAe,0BAGhB,KAAK,GAAIC,KAAa3tD,MAAKotD,UACtBptD,KAAKotD,UAAUrsD,eAAe4sD,KACjCH,EAAmBxtD,KAAKotD,UAAUO,GAAW3D,WAAW3mC,GAEpDmqC,IAEEC,IACChuD,EAAEwO,QAAQoC,SAASm9C,EAAkBE,IACzCjuD,EAAEwO,QAAQyC,SAAS88C,EAAiBxM,WAAW,GAAI0M,GAEpDD,GAAgB,GAGjBt9C,EAAUC,YAAYo9C,IAUzB,OALGxtD,MAAK+C,QAAQw5C,OACfv8C,KAAK4tD,GAAK5tD,KAAK+C,QAAQ6yB,cAAgB,GAAIn2B,GAAEkkD,eAC7CtgC,EAAI3H,SAAS1b,KAAK4tD,IAClBvqC,EAAIzb,GAAG,eAAe5H,KAAK6tD,eAAe7tD,OAEpCmQ,GAGR09C,eAAe,SAASv8C,GACvBtR,KAAK4tD,GAAGlyC,SAASpK,EAAEqK,QAGpBS,SAAU,WACT,IAAK,GAAIuxC,KAAa3tD,MAAKotD,UACtBptD,KAAKotD,UAAUrsD,eAAe4sD,IACjC3tD,KAAKotD,UAAUO,GAAW/C,iBAK7BkD,kBAAmB,SAAU/qD,GAC5B,IAAK,GAAI4qD,KAAa3tD,MAAKotD,UACtBptD,KAAKotD,UAAUO,YAAsBluD,GAAEgtD,aAC1CzsD,KAAKotD,UAAUO,GAAW7qD,WAAWC,IAKxCsqD,gBAAiB,SAAU/7C,GAC1B,GAAIy8C,GAAiBz8C,EAAE7J,MAEvB,KAAK,GAAIkmD,KAAa3tD,MAAKotD,UACtBptD,KAAKotD,UAAUO,KAAeI,GACjC/tD,KAAKotD,UAAUO,GAAW3rC,aAM/BviB,EAAEuY,IAAI9R,cACJomD,qBAAqB,EACrB3C,aAAa,KAGbtqD,OAAQC,UACV,SAAWD,EAAQC,EAAUC,GAG5BE,EAAEo2B,KAAK5vB,SACN+nD,SAAS,WACR,MAAOhuD,MAAKiuD,QAEbC,SAAS,SAASvqD,GACjB3D,KAAKiuD,OAAStqD,GAEfwqD,YAAY,SAASxqD,GACpB3D,KAAKiuD,OAASxuD,EAAES,OAAOF,KAAKiuD,WAAWtqD,GACvC3D,KAAKwmB,SACLxmB,KAAKi3B,cAAgBj3B,KAAKi3B,gBAE3BoJ,iBAAiB,SAAStzB,GAEzB,MADAA,GAAStN,EAAEuV,aAAajI,IACfA,EAAO0I,eAAgB1I,EAAO4I,eAAgB5I,EAAO2I,eAAgB3I,EAAO+I,iBAEtFmZ,UAAU,SAASiD,EAASk8B,GAS3B,MARIpuD,MAAKgvB,SAAUo/B,IAClBpuD,KAAKgvB,OAAS,GAAIvvB,GAAEqxB,MAAMs9B,EAAQpuD,OACnCA,KAAKgvB,OAAOiD,WAAWC,GACnBlyB,KAAKy0B,sBAERz0B,KAAK4H,GAAG,SAAU5H,KAAK0yB,WAAY1yB,MACnCA,KAAKy0B,qBAAsB,GAErBz0B,MAERsa,UAAU,WACT,MAAOta,MAAKgsB,WAiCdvsB,EAAEsuB,OAAO9nB,SACR+nD,SAAS,WACR,MAAOhuD,MAAKiuD,QAEbC,SAAS,SAASvqD,GACjB3D,KAAKiuD,OAAStqD,GAEf2W,UAAU,WACT,MAAOta,MAAKgsB,SAEbqU,iBAAiB,SAAStzB,GAEzB,MADAA,GAAStN,EAAEuV,aAAajI,IACfA,EAAO0I,eAAgB1I,EAAO4I,eAAgB5I,EAAO2I,eAAgB3I,EAAO+I,iBAEtFmZ,UAAU,SAASiD,EAASnvB,GAC3B,GAAIuI,GAAQ7L,EAAE6L,MAAMtL,KAAK+C,QAAQqqB,KAAKrqB,QAAQwqB,cAAiB,EAAG,GAmBlE,OAlBAjiB,GAAQA,EAAMD,IAAI5L,EAAEqxB,MAAMpwB,UAAUqC,QAAQsY,QACzCtY,GAAWA,EAAQsY,SACrB/P,EAAQA,EAAMD,IAAItI,EAAQsY,SAC3BtY,EAAUtD,EAAES,QACXmb,OAAO/P,GACLvI,GACC/C,KAAKy0B,sBACRz0B,KAAK4H,GAAG,SAAU5H,KAAK0yB,WAAY1yB,MACjC4H,GAAG,OAAQ5H,KAAK00B,WAAY10B,MAC9BA,KAAKy0B,qBAAsB,GAEzBvC,YAAmBzyB,GAAEqxB,OACvBrxB,EAAEqD,WAAWovB,EAASnvB,GACtB/C,KAAKgvB,OAASkD,GAGdlyB,KAAKgvB,OAAS,GAAIvvB,GAAEqxB,MAAM/tB,EAAS/C,MAAMiyB,WAAWC,GAE9ClyB,QAITP,EAAEolC,UAAU5+B,SACXX,WAAY,SAAUL,EAASyhC,GAC9B1mC,KAAK2mC,SAAW1hC,EAChBjF,KAAK4mC,iBAAmBF,GAAmBzhC,EAC3CjF,KAAKwvB,oBAENhO,gBAAiB,SAAUlQ,GAC1B,GAAIoyC,GAAO1jD,IACE,cAAVsR,EAAE3K,MAA+B,YAAR2K,EAAE3K,OAC1B+8C,EAAK2K,iBACPvpD,aAAa4+C,EAAK2K,iBACN,aAAV/8C,EAAE3K,OACJ+8C,EAAK2K,gBAAkBpsD,WAAW,WACjCqsD,QAAQ33C,IAAI,iBACZ+sC,EAAK37C,KAAK,YAAaga,cAAezQ,KACpC,OAGLoyC,EAAK37C,KAAKuJ,EAAE3K,MAAOob,cAAczQ,KAElCke,iBAAkB,WAEjB,GAAIvqB,GAAUjF,KAAK2mC,SAClB5/B,GAAU,WAAY,YAAa,YAAa,WAAY,cAAe,aAAc,WAAY,YAClG/G,MAAK2nD,YACR5gD,EAAOpF,QAAQ,gBAAiB,cAAe,gBAAiB,oBAEhEoF,EAAOpF,QAAQ,eAGhB,KAAK,GAAIvB,GAAI,EAAGA,EAAI2G,EAAOjG,OAAQV,IAClCX,EAAEiT,SAAS9K,GAAG3C,EAAS8B,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,OAG1D2nD,UAAW,WACV,GAAIz/C,GAAK7I,EAAO8I,UAAUC,UAEtB8/C,EAAOhgD,EAAG3E,QAAQ,QACtB,IAAI2kD,EAAO,EAEV,MAAO/4C,UAASjH,EAAGigD,UAAUD,EAAO,EAAGhgD,EAAG3E,QAAQ,IAAK2kD,IAAQ,GAGhE,IAAIE,GAAUlgD,EAAG3E,QAAQ,WACzB,IAAI6kD,EAAU,EAAG,CAEhB,GAAIC,GAAKngD,EAAG3E,QAAQ,MACpB,OAAO4L,UAASjH,EAAGigD,UAAUE,EAAK,EAAGngD,EAAG3E,QAAQ,IAAK8kD,IAAM,IAG5D,GAAIlpB,GAAOj3B,EAAG3E,QAAQ,QACtB,OAAI47B,GAAO,EAEHhwB,SAASjH,EAAGigD,UAAUhpB,EAAO,EAAGj3B,EAAG3E,QAAQ,IAAK47B,IAAQ,KAIzD,KAIT1/B,EAAEwwB,QAAQC,WAAWjqB,SAEpB2hC,SAAU,WACT,GAAIxa,GAAOptB,KAAKkxC,QAAQhiB,KACnBlvB,MAAKsoC,aACTtoC,KAAKsoC,WAAa,GAAI7oC,GAAEolC,UAAUzX,EAAMA,IAGzCptB,KAAKsoC,WACH1gC,GAAG,YAAa5H,KAAKwoC,aAAcxoC,MACnC4H,GAAG,OAAQ5H,KAAK0oC,QAAS1oC,MACzB4H,GAAG,UAAW5H,KAAK4oC,WAAY5oC,MAC/B4H,GAAG,aAAc5H,KAAKutC,cAAevtC,MACrC4H,GAAG,aAAc5H,KAAKutC,cAAevtC,MACrC4H,GAAG,YAAa5H,KAAK6tC,aAAc7tC,MACnC4H,GAAG,gBAAiB5H,KAAK6tC,aAAc7tC,MACvC4H,GAAG,WAAY5H,KAAK8tC,YAAa9tC,MACjC4H,GAAG,cAAe5H,KAAK8tC,YAAa9tC,MACpC4H,GAAG,cAAe5H,KAAK8tC,YAAa9tC,MACtCA,KAAKsoC,WAAWprB,SAChBzd,EAAEwO,QAAQyC,SAAS1Q,KAAKkxC,QAAQhiB,MAAO,6BAGxC2Y,YAAa,WACZ7nC,KAAKsoC,WACHzgC,IAAI,YAAa7H,KAAKwoC,aAAcxoC,MACpC6H,IAAI,OAAQ7H,KAAK0oC,QAAS1oC,MAC1B6H,IAAI,UAAW7H,KAAK4oC,WAAY5oC,MAChC6H,IAAI,aAAc7H,KAAKutC,cAAevtC,MACtC6H,IAAI,YAAa7H,KAAK6tC,aAAc7tC,MACpC6H,IAAI,gBAAiB7H,KAAK6tC,aAAc7tC,MACxC6H,IAAI,WAAY7H,KAAK8tC,YAAa9tC,MAClC6H,IAAI,cAAe7H,KAAK8tC,YAAa9tC,MAEvCA,KAAKsoC,WAAWtmB,UAChBviB,EAAEwO,QAAQ4C,YAAY7Q,KAAKkxC,QAAQhiB,MAAO,6BAG3Cqe,cAAe,SAAUj8B,GACxBtR,KAAK4mD,gBAAiB,EACtB5mD,KAAKwoC,aAAal3B,IAInBu8B,aAAc,SAAUv8B,GACnBtR,KAAK4mD,gBACR5mD,KAAKutC,cAAcj8B,GAEpBtR,KAAK4mD,gBAAiB,CACtB,IAAIr2B,GAASvwB,KAAKkxC,QACjBzxB,EAAa8Q,EAAOzL,KAAKlF,uBAAuBtO,EAAEyQ,cAAcklB,QAAQ,IACxEvwB,EAAS6Z,EAAOzL,KAAKpH,mBAAmB+B,EAGzC,OAFA8Q,GAAO1B,UAAUnY,IAEV,GAGRo3B,YAAa,SAAUx8B,GACtBtR,KAAK4oC,WAAWt3B,MAIlB7R,EAAE6sB,KAAKiiC,OAAS9uD,EAAE+wB,QAAQtwB,QACzB6C,SACCuqB,UAAW,GAAI,IACfL,YAAa,GAAI,IACjB/c,UAAW,4BAGZqc,WAAY,SAAUC,GACrB,GAAIjiB,GAAOiiB,GAA+B,QAApBA,EAAQvc,QAAqBuc,EAAUltB,EAASkL,cAAc,OACnFzH,EAAU/C,KAAK+C,QAEZwwC,EAAOj0C,EAASkL,cAAc,OAClCD,GAAI6F,YAAYmjC,EAEhB,IAAI2I,GAAUz8C,EAAEwO,QAAQ+B,OAAO,MAAO,+BAWtC,OAVAksC,GAAQryC,MAAM0vB,QAAS,OACvBhvB,EAAI6F,YAAY8rC,GAGZn5C,EAAQ2tB,QACXnmB,EAAIV,MAAM8mB,oBACP5tB,EAAQ2tB,MAAMxlB,EAAK,OAAUnI,EAAQ2tB,MAAMvlB,EAAK,MAGpDnL,KAAK8sB,eAAeviB,EAAK,QAClBA,KAIT9K,EAAEstD,aAAettD,EAAEsuB,OAAOi1B,MAAM9iD,QAC/BoF,WAAY,SAAUoR,EAAQ3T,GAC7BtD,EAAEsuB,OAAOrtB,UAAU4E,WAAW1E,KAAKZ,KAAK0W,EAAO3T,GAC/C/C,KAAK+C,QAAQqqB,KAAO,GAAI3tB,GAAE6sB,KAAKiiC,QAEhCC,QAAQ,SAAS9qD,GAChB1D,KAAK0D,KAAOA,EACZ1D,KAAKyuD,eAENjgC,OAAQ,WACP,GAAIxuB,KAAKkvB,MAAO,CACf,GAAIvgB,GAAM3O,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,SAAS/rB,OACrDxC,MAAKmvB,QAAQxgB,GACb3O,KAAKyuD,cAGN,MAAOzuD,OAERyuD,YAAY,WACX,GAAGzuD,KAAKkvB,OAASlvB,KAAK0D,KAAK,CAC1B,GAAIw4C,GAAUl8C,KAAKkvB,MAAMtB,qBAAqB,OAAO,EAClDsuB,IAAWl8C,KAAK0D,KAAKw4C,UACvBA,EAAQ70B,UAAYrnB,KAAK0D,KAAKw4C,QAC/B,IAAI3I,GAAOvzC,KAAKkvB,MAAMtB,qBAAqB,QAAQ,EACnD2lB,IAAQvzC,KAAK0D,KAAKgpD,SAAWnZ,EAAKlsB,UAAYrnB,KAAK0D,KAAKgpD,YAK3DjtD,EAAEm9C,KAAKmQ,aAAettD,EAAEm9C,KAAK7uB,OAAO7tB,QACnC0F,SACC23C,KAAM,gBAGPx6C,SACC26C,YAAY,EACZtvB,aAAc,KAGf9oB,WAAY,SAAU+d,EAAKtgB,GAG1BtD,EAAEm9C,KAAK7uB,OAAOrtB,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,GACnD/C,KAAK2G,KAAOlH,EAAEm9C,KAAKmQ,aAAaxP,MAGjCzjB,aAAc,SAAUxoB,GACvB,GAAIoF,GAASpF,EAAEoF,MAEf1W,MAAKk9C,SAASqD,eAAe7pC,GAC7B1W,KAAKq+C,aAAaxvB,UAAUnY,GAEvB1W,KAAKkxC,SAWTx6B,EAAS1W,KAAKq+C,aAAazvB,YAC3B5uB,KAAKkxC,QAAQriB,UAAUnY,KAXvB1W,KAAKkxC,QAAU,GAAIzxC,GAAEstD,aAAar2C,GACjC0X,aAAcpuB,KAAK+C,QAAQqrB,eAG5BpuB,KAAKkxC,QAAQtpC,GAAG,QAAS5H,KAAK65B,SAAU75B,MACxCA,KAAK8kB,KACHld,GAAG,QAAS5H,KAAK65B,SAAU75B,MAC3B0b,SAAS1b,KAAKkxC,WAQlBoM,kBAAmB,WAClB,GAAI/sB,GAAS,GAAI9wB,GAAEstD,aAAa/sD,KAAKkxC,QAAQtiB,YAC7CnvB,GAAEm9C,KAAKC,QAAQn8C,UAAU48C,kBAAkB18C,KAAKZ,KAAMuwB,MAIxD9wB,EAAEwjD,KAAK8J,aAAettD,EAAEwjD,KAAKl1B,OAAO7tB,QACnCojD,cAAe,SAAUl2B,EAAM/R,OAKhC5b,EAAEstD,aAAa5mD,YAAY,WACtB1G,EAAEwjD,KAAKl1B,SACV/tB,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAK8J,aAAa/sD,MACnCA,KAAK+C,QAAQ+gD,YAQnBrkD,EAAEivD,SAAWjvD,EAAEo2B,KAAK31B,QACnByuD,iBACC14B,OAAO,UACP24B,kBAAkB,QAClBC,iBAAiB,QACjBC,iBAAiB,EACjBC,eAAe,EACfx4B,KAAK,QAENG,cAAc,WACbj3B,EAAEo2B,KAAKn1B,UAAUg2B,cAAc91B,KAAKZ,OAKrC42B,YAAY,WACXn3B,EAAEo2B,KAAKn1B,UAAUk2B,YAAYh2B,KAAKZ,KAC1BA,MAAKm4B,MAAM62B,aAAa,MAGjCx2C,YAAY,WAEX,GADA/Y,EAAEo2B,KAAKn1B,UAAU8X,YAAY5X,KAAKZ,MAC9BA,KAAK+C,QAAQkrB,UAAW,CAE3BxuB,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAY,QAASnd,KAAKuhB,cAAevhB,KAE5D,KAAK,GADD+G,IAAW,WAAY,YAAa,YAAa,WAAY,YAAa,eACrE3G,EAAI,EAAGA,EAAI2G,EAAOjG,OAAQV,IAClCX,EAAEiT,SAAS9K,GAAG5H,KAAKmd,WAAYpW,EAAO3G,GAAIJ,KAAKwhB,gBAAiBxhB,UAKpEP,EAAEutD,KAAOvtD,EAAEivD,SAASxuD,QACnBoF,WAAW,SAAS62C,EAAOjE,EAAKn1C,GAC/BtD,EAAEo2B,KAAKn1B,UAAU4E,WAAW1E,KAAKZ,KAAM+C,GACvC/C,KAAKivD,OAAS9S,EACdn8C,KAAKkvD,KAAOhX,GAEbn1C,SACC0zB,YAAY,GAEbE,eAAe,WACd32B,KAAKonC,YAAcpnC,KAAK8kB,KAAKzF,mBAAmBrf,KAAKivD,QACrDjvD,KAAKmvD,UAAYnvD,KAAK8kB,KAAKzF,mBAAmBrf,KAAKkvD,OAEpD50C,UAAU,WACT,MAAO,IAAI7a,GAAEmV,aAAa5U,KAAKivD,OAAQjvD,KAAKkvD,OAE7CE,aAAa,SAASjT,EAAOjE,GAC5Bl4C,KAAKivD,OAAS9S,EAAOn8C,KAAKkvD,KAAOhX,EAAKl4C,KAAKwmB,UAE5CsR,cAAc,WACb,IAAKr4B,EAAEmL,QAAQ2sB,IAAK,MAAO,EAC3B,IAAI9f,GAAIzX,KAAKonC,YACZ91B,EAAItR,KAAKmvD,UACTzsD,EAAM,IAAM+U,EAAEvM,EAAI,IAAMuM,EAAEtM,CAE3B,OADAzI,IAAO,IAAM4O,EAAEpG,EAAI,IAAMoG,EAAEnG,GAG5Bs4B,UAAW,WACV,MAAOhkC,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAK,UACLq8B,WAAWhjC,KAAKguD,WAChBjrD,QAAQ/C,KAAK+C,QACbo/B,UACCx7B,KAAM,OACNy7B,YAAa3iC,EAAEoiC,QAAQsB,iBAAiBnjC,KAAKivD,OAAQjvD,KAAKkvD,aAM9DzvD,EAAEm9C,KAAKoQ,KAAOvtD,EAAEm9C,KAAKsF,YAAYhiD,QAChC0F,SACC23C,KAAM,OAGPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNtI,WAAW,IAGb3oB,WAAW,SAAS+d,EAAKtgB,GACxB/C,KAAK2G,KAAOlH,EAAEm9C,KAAKoQ,KAAKzP,KACxBv9C,KAAKqiD,kBAAoB5iD,EAAEk8C,UAAUC,KAAKK,SAASK,KAAKJ,QAAQC,MAChE18C,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAEzD2/C,WAAW,SAASpxC,GAChBtR,KAAKsiD,OACPtiD,KAAKsiD,OAAO8M,aAAapvD,KAAKwiD,aAAclxC,IAG5CtR,KAAKsiD,OAAS,GAAI7iD,GAAEutD,KAAKhtD,KAAKwiD,aAAclxC,EAAGtR,KAAKqvD,qBACpDrvD,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAI1BhF,kBAAkB,WACjB,GAAIhsC,GAAI,GAAI7R,GAAEutD,KAAKhtD,KAAKwiD,aAAcxiD,KAAKsiD,OAAO4M,KAAMlvD,KAAKqvD,oBAC7D5vD,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMsR,IAE3D+9C,kBAAkB,WACjB,MAAOrvD,MAAK+C,QAAQi6C,gBAItBv9C,EAAEwjD,KAAK+J,KAAOvtD,EAAEwjD,KAAK7iB,UAAUlgC,QAC9B2kD,mBAAmB,SAASvzC,GAC3B7R,EAAEwjD,KAAKf,YAAYxhD,UAAUmkD,mBAAmBjkD,KAAKZ,KAAMsR,EAC3D,IAAIisB,GAAIv9B,KAAK6mD,cACZp/C,EAAS6J,EAAE7J,OACX6nD,EAAc7nD,EAAOs/C,YACtB/mD,MAAKgnD,gBAAkBzpB,GAAG+xB,EAAc,GAAK,GAC7CtvD,KAAKinD,qBAAqB,EAAGqI,IAG9B/hB,cAAe,SAAUj8B,GAGxB,GAAiC,kBAAtBtR,MAAgB,YAAkB,CAE5C,GAAIiyC,GAAUjyC,KAAK6mD,cAClBt2B,EAASjf,EAAE7J,OACX6nD,EAAc/+B,EAAOw2B,YACtBx2B,GAAOvf,WAAW,GAClBhR,KAAKgnD,gBAAkB/U,GAASqd,EAAc,GAAK,GACnDtvD,KAAKinD,qBAAqB,EAAGqI,GAG9BtvD,KAAKsiD,OAAOv6C,KAAK,cAElBy+C,iBAAiB,SAASl1C,GACzB7R,EAAEwjD,KAAK7iB,UAAU1/B,UAAU8lD,iBAAiB5lD,KAAKZ,KAAMsR,IAGxDi+C,WAAW,WACV,GAAIj+C,GAAItR,KAAKsiD,OAAO2M,OACnB1xB,EAAIv9B,KAAKsiD,OAAO4M,KAChB9uD,IAAMkR,EAAE4B,IAAMqqB,EAAErqB,KAAO,EACvBuE,IAAMnG,EAAE6B,IAAMoqB,EAAEpqB,KAAO,CACxB,OAAO,IAAI1T,GAAEwT,OAAO3B,EAAE4B,IAAM9S,EAAGkR,EAAE6B,IAAMsE,IAExCivC,MAAM,SAASp1C,GACd,GAAI6qC,GAAQn8C,KAAKsiD,OAAO2M,OACvB/W,EAAMl4C,KAAKsiD,OAAO4M,KAClBv2C,EAAS3Y,KAAKuvD,aACdC,GAAOl+C,EAAE4B,IAAMyF,EAAOzF,IAAK5B,EAAE6B,IAAMwF,EAAOxF,KAC1Cs8C,EAAW,GAAIhwD,GAAEwT,OAAOkpC,EAAMjpC,IAAMs8C,EAAG,GAAIrT,EAAMhpC,IAAMq8C,EAAG,IAC1DE,EAAS,GAAIjwD,GAAEwT,OAAOilC,EAAIhlC,IAAMs8C,EAAG,GAAItX,EAAI/kC,IAAMq8C,EAAG,GACrDxvD,MAAKsiD,OAAO8M,aAAaK,EAAUC,GACnC1vD,KAAKonD,2BACLpnD,KAAKinD,sBAAqB,IAG3BN,QAAQ,SAASr7C,GAKhBtL,KAAKgnD,iBAAmBhnD,KAAKsiD,OAAO2M,OACnCjvD,KAAKsiD,OAAO8M,aAAapvD,KAAKsiD,OAAO2M,OAAQ3jD,GAC7CtL,KAAKsiD,OAAO8M,aAAa9jD,EAAOtL,KAAKsiD,OAAO4M,KAC7C,IAAIniD,GAAS/M,KAAKsiD,OAAOhoC,WACzBta,MAAKmmD,YAAYt3B,UAAU9hB,EAAOJ,cAEnCk6C,YAAY,WACX,OAAS7mD,KAAKsiD,OAAO2M,OAAQjvD,KAAKsiD,OAAO4M,OAE1CzL,eAAe,WACdhkD,EAAEwjD,KAAKf,YAAYxhD,UAAU+iD,eAAe7iD,KAAKZ,KACjD,IAAIm8C,GAAQn8C,KAAKsiD,OAAO2M,OACvB/W,EAAMl4C,KAAKsiD,OAAO4M,KAClBvgD,EAAMwtC,EAAMjpC,IAAMglC,EAAIhlC,IAAOipC,EAAQjE,CACtCl4C,MAAKsiD,OAAO3wB,UAAUhjB,MAGxBlP,EAAEutD,KAAK7mD,YAAY,WAClBnG,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAK+J,KAAKhtD,QAIhCP,EAAEwtD,MAAQxtD,EAAEutD,KAAK9sD,QAChBoF,WAAW,SAAS62C,EAAOjE,EAAKn1C,GAC/BtD,EAAEutD,KAAKtsD,UAAU4E,WAAW1E,KAAKZ,KAAMm8C,EAAOjE,EAAKn1C,GACnD/C,KAAK2vD,YAAc,GAAIlwD,GAAEmV,aAAa,GAAInV,GAAEwT,OAAO,MAAO,OAAQ,GAAIxT,GAAEwT,OAAO,EAAG,KAEnFlQ,SACC0zB,YAAY,GAEbm5B,SAAS,WACR,OAAO,GAERj5B,eAAe,WACdl3B,EAAEutD,KAAKtsD,UAAUi2B,eAAe/1B,KAAKZ,KACrC,IAAIsR,GAAItR,KAAK8kB,KAAKzF,mBAAmBrf,KAAK2vD,YAAYl6C,gBACrD8nB,EAAIv9B,KAAK8kB,KAAKzF,mBAAmBrf,KAAK2vD,YAAYj6C,eACnD1V,MAAK6vD,cAAgBttD,KAAK8J,IAAIiF,EAAEpG,EAAIqyB,EAAEryB,GACtClL,KAAK8vD,YAAcvtD,KAAK8J,IAAIiF,EAAEnG,EAAIoyB,EAAEpyB,IAErC2sB,cAAc,WACb,IAAKr4B,EAAEmL,QAAQ2sB,IAAK,MAAO,EAC3B,IAAI4kB,GAAQn8C,KAAKonC,YAChB8Q,EAAMl4C,KAAKmvD,UACXY,EAAU/vD,KAAK8vD,YACfE,EAAYhwD,KAAK6vD,cACjB1I,EAAI5kD,KAAKkS,MAAM0nC,EAAMhxC,EAAI+sC,EAAI/sC,EAAGgxC,EAAMjxC,EAAIgtC,EAAIhtC,GAC9CqB,EAAIhK,KAAKiS,IAAI2yC,GACb13C,EAAIlN,KAAK+R,IAAI6yC,GACbzkD,EAAMjD,EAAEutD,KAAKtsD,UAAUo3B,cAAcl3B,KAAKZ,KAK3C,OAJI0C,IAAO,KAAOw1C,EAAIhtC,GAAK6kD,EAAUxjD,EAAIyjD,EAAY,EAAIvgD,IAAM,KAAOyoC,EAAI/sC,GAAK4kD,EAAUtgD,EAAIugD,EAAY,EAAIzjD,IACzG7J,GAAO,IAAMw1C,EAAIhtC,EAAI,IAAMgtC,EAAI/sC,EAClCzI,GAAO,KAAOw1C,EAAIhtC,GAAK6kD,EAAUxjD,EAAIyjD,EAAY,EAAIvgD,IAAM,KAAOyoC,EAAI/sC,GAAK6kD,EAAY,EAAIzjD,EAAIwjD,EAAUtgD,IACtG/M,GAAO,IAAMw1C,EAAIhtC,EAAI,IAAMgtC,EAAI/sC,KAKrC1L,EAAEm9C,KAAKqQ,MAAQxtD,EAAEm9C,KAAKsF,YAAYhiD,QACjC0F,SACC23C,KAAM,SAGPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNtI,WAAW,IAGb3oB,WAAW,SAAS+d,EAAKtgB,GACxB/C,KAAK2G,KAAOlH,EAAEm9C,KAAKqQ,MAAM1P,KACzBv9C,KAAKqiD,kBAAoB5iD,EAAEk8C,UAAUC,KAAKK,SAASK,KAAKJ,QAAQC,MAChE18C,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAEzD2/C,WAAW,SAAShsC,GAChB1W,KAAKsiD,OACPtiD,KAAKsiD,OAAO8M,aAAapvD,KAAKwiD,aAAc9rC,IAG5C1W,KAAKsiD,OAAS,GAAI7iD,GAAEwtD,MAAMjtD,KAAKwiD,aAAc9rC,EAAQ1W,KAAKqvD,qBAC1DrvD,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAG1BhF,kBAAkB,WACjB,GAAIhsC,GAAI,GAAI7R,GAAEwtD,MAAMjtD,KAAKwiD,aAAcxiD,KAAKsiD,OAAO4M,KAAMlvD,KAAKqvD,oBAC9D5vD,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMsR,IAE3D+9C,kBAAkB,WACjB,MAAOrvD,MAAK+C,QAAQi6C,gBAItBv9C,EAAEwjD,KAAKgK,MAAQxtD,EAAEwjD,KAAK+J,KAAK9sD,WAI3BT,EAAEwtD,MAAM9mD,YAAY,WACnBnG,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAKgK,MAAMjtD,QAKjCP,EAAEytD,UAAYztD,EAAEutD,KAAK9sD,QACpBoF,WAAW,SAAS62C,EAAOjE,EAAKn1C,GAC/BtD,EAAEutD,KAAKtsD,UAAU4E,WAAW1E,KAAKZ,KAAMm8C,EAAOjE,EAAKn1C,IAIpDA,SACC0zB,YAAY,GAEbm5B,SAAS,WACR,OAAO,GAERj5B,eAAe,WACdl3B,EAAEutD,KAAKtsD,UAAUi2B,eAAe/1B,KAAKZ,OAMtC83B,cAAc,WACb,IAAKr4B,EAAEmL,QAAQ2sB,IAAK,MAAO,EAC3B,IAAI4kB,GAAQn8C,KAAKonC,YAChB8Q,EAAMl4C,KAAKmvD,UACXc,EAAU,GACVC,EAAU,GACV/I,EAAI5kD,KAAKkS,MAAM0nC,EAAMhxC,EAAI+sC,EAAI/sC,EAAGgxC,EAAMjxC,EAAIgtC,EAAIhtC,GAC9CqB,EAAIhK,KAAKiS,IAAI2yC,GACb13C,EAAIlN,KAAK+R,IAAI6yC,GACbzkD,EAAMjD,EAAEutD,KAAKtsD,UAAUo3B,cAAcl3B,KAAKZ,KAQ3C,OANA0C,IAAO,KAAOy5C,EAAMjxC,GAAK+kD,EAAU1jD,EAAI2jD,EAAU,EAAIzgD,IAAM,KAAO0sC,EAAMhxC,GAAK8kD,EAAUxgD,EAAIygD,EAAU,EAAI3jD,IACzG7J,GAAO,KAAOy5C,EAAMjxC,GAAK+kD,EAAU1jD,EAAI2jD,EAAU,EAAIzgD,IAAM,KAAO0sC,EAAMhxC,GAAK+kD,EAAU,EAAI3jD,EAAI0jD,EAAUxgD,IAEzG/M,GAAO,KAAOw1C,EAAIhtC,GAAK+kD,EAAU1jD,EAAI2jD,EAAU,EAAIzgD,IAAM,KAAOyoC,EAAI/sC,GAAK8kD,EAAUxgD,EAAIygD,EAAU,EAAI3jD,IACrG7J,GAAO,KAAOw1C,EAAIhtC,GAAK+kD,EAAU1jD,EAAI2jD,EAAU,EAAIzgD,IAAM,KAAOyoC,EAAI/sC,GAAK+kD,EAAU,EAAI3jD,EAAI0jD,EAAUxgD,KAItG0S,MAAM,SAASkB,GACd5jB,EAAEutD,KAAKtsD,UAAUyhB,MAAMvhB,KAAKZ,KAAMqjB,IAiBnCjH,SAAS,SAASiH,GACjB5jB,EAAEutD,KAAKtsD,UAAU0b,SAASxb,KAAKZ,KAAKqjB,IAGrCogB,UAAW,WACV,MAAOhkC,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAM,UACNq8B,WAAYhjC,KAAKguD,WACjBjrD,QAAS/C,KAAK+C,QACdo/B,UACCx7B,KAAM,YACNy7B,YAAa3iC,EAAEoiC,QAAQsB,iBAAiBnjC,KAAKivD,OAAQjvD,KAAKkvD,aAK9DzvD,EAAEm9C,KAAKsQ,UAAYztD,EAAEm9C,KAAKsF,YAAYhiD,QACrC0F,SACC23C,KAAM,aAGPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTslB,MAAM,EACNtI,WAAW,IAGb3oB,WAAW,SAAS+d,EAAKtgB,GACxB/C,KAAK2G,KAAOlH,EAAEm9C,KAAKsQ,UAAU3P,KAC7Bv9C,KAAKqiD,kBAAoB5iD,EAAEk8C,UAAUC,KAAKK,SAASK,KAAKJ,QAAQC,MAChE18C,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,IAEzD2/C,WAAW,SAAShsC,GAChB1W,KAAKsiD,OACPtiD,KAAKsiD,OAAO8M,aAAapvD,KAAKwiD,aAAc9rC,IAG5C1W,KAAKsiD,OAAS,GAAI7iD,GAAEytD,UAAUltD,KAAKwiD,aAAc9rC,EAAQ1W,KAAKqvD,qBAC9DrvD,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAG1BhF,kBAAkB,WACjB,GAAIhsC,GAAI,GAAI7R,GAAEytD,UAAUltD,KAAKwiD,aAAcxiD,KAAKsiD,OAAO4M,KAAMlvD,KAAKqvD,oBAClE5vD,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMsR,IAE3D+9C,kBAAkB,WACjB,MAAOrvD,MAAK+C,QAAQi6C,gBAGtBv9C,EAAEwjD,KAAKiK,UAAYztD,EAAEwjD,KAAK+J,KAAK9sD,WAI/BT,EAAEytD,UAAU/mD,YAAY,WACvBnG,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAKiK,UAAUltD,QAKrCP,EAAEotD,UAAYptD,EAAE2gC,UAAUlgC,QACzB6C,SACCi6C,cACCvmB,YAAY,KAGdgN,UAAW,WACV,GACCrjC,GAAGE,EAAKi/B,EADLuD,GAAUrjC,EAAEoiC,QAAQsB,gBAAgBnjC,KAAK+9B,cAK7C,IAFA+E,EAAO,GAAG1/B,KAAK0/B,EAAO,GAAG,IAErB9iC,KAAKw/B,OACR,IAAKp/B,EAAI,EAAGE,EAAMN,KAAKw/B,OAAO1+B,OAAYR,EAAJF,EAASA,IAC9Cm/B,EAAO9/B,EAAEoiC,QAAQsB,gBAAgBnjC,KAAKw/B,OAAOp/B,IAC7Cm/B,EAAKn8B,KAAKm8B,EAAK,IACfuD,EAAO1/B,KAAKm8B,EAId,OAAO9/B,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAM,UACNq8B,WAAYhjC,KAAKguD,WACjBjrD,QAAS/C,KAAK+C,QACdo/B,UACCx7B,KAAM,YACNy7B,YAAaU,QAKjBrjC,EAAEm9C,KAAKiQ,UAAYptD,EAAEm9C,KAAKxc,UAAUlgC,QACnC0F,SACC23C,KAAM,aAEPx6C,SACCi6C,cACC/mB,QAAQ,EACRC,MAAO,UACPI,OAAQ,EACRrlB,QAAS,EACTulB,UAAW,KACXC,YAAY,KAGdnxB,WAAW,SAAS+d,EAAKtgB,GACxBtD,EAAEm9C,KAAKxc,UAAU1/B,UAAU4E,WAAW1E,KAAKZ,KAAMqjB,EAAKtgB,GACtD/C,KAAK2G,KAAOlH,EAAEm9C,KAAKiQ,UAAUtP,MAE9BD,kBAAmB,WAClB,GAAI/c,GAAY,GAAI9gC,GAAEotD,UAAU7sD,KAAKsiD,OAAOhoC,YAAata,KAAK+C,QAAQi6C,aACtEv9C,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMugC,MAG5D9gC,EAAEwjD,KAAK4J,UAAYptD,EAAEwjD,KAAK7iB,UAAUlgC,WAGpCT,EAAEotD,UAAU1mD,YAAY,WACvBnG,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAK4J,UAAU7sD,QAGrCP,EAAEstD,aAAa9mD,SACdkqD,OAAO,WACN,MAAO1wD,GAAEkkD,eAAeyM,QAAQpwD,MAC/B2G,KAAK,oBAKRlH,EAAEqtD,MAAQrtD,EAAEo2B,KAAK31B,QAChB0F,SACC8xB,IAAIj4B,EAAEmL,QAAQ2sB,KAEfx0B,SACCstD,cAAc,YACdC,aAAa,SACbp6B,MAAM,QACNq6B,cAAc,OACdC,iBAAiB,SACjBv6B,OAAO,QACP84B,eAAe,EACf0B,kBAAkB,OAClBt6B,UAAU,GACVu6B,aAAY,GAEbprD,WAAW,SAASoR,EAAQ3T,GAC3B,GAAI2gD,GAAO1jD,IACXP,GAAEo2B,KAAKn1B,UAAU4E,WAAW1E,KAAK8iD,EAAM3gD,GACvC2gD,EAAKn1B,QAAU7X,EAEfzU,WAAW,WACVyhD,EAAKzsB,eACLysB,EAAK/sB,kBACH,KAEJrc,UAAW,WACV7a,EAAEo2B,KAAKn1B,UAAU4Z,UAAU1Z,KAAKZ,KAEhC,IAAIsR,GAAItR,KAAKghC,QACZzD,EAAIv9B,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,SACtCnuB,EAAIJ,KAAK8kB,KAAKpH,mBAAmB,GAAIje,GAAEwL,MAAMsyB,EAAEryB,EAAIoG,EAAGisB,EAAEpyB,EAAImG,IAC5DmG,EAAIzX,KAAK8kB,KAAKpH,mBAAmB,GAAIje,GAAEwL,MAAMsyB,EAAEryB,EAAIoG,EAAGisB,EAAEpyB,EAAImG,GAC7D,OAAO,IAAI7R,GAAEmV,aAAaxU,EAAGqX,IAG9Bkf,eAAe,WACd,GAAI32B,KAAK8kB,KAAM,CACd9kB,KAAK+gC,OAAS/gC,KAAK8kB,KAAKzF,mBAAmBrf,KAAKuuB,QAChD,IAAIkS,GAAQkwB,EAAUC,EAAaz5C,EAAOnX,KAAK8kB,KAAK1L,SACpD,QAAQjC,GACP,IAAK,GACJspB,EAAS,GACTkwB,EAAW,EACXC,EAAc,GACd,MACD,KAAK,GACJnwB,EAAS,GACTkwB,EAAW,GACXC,EAAc,CACd,MACD,KAAK,GACJnwB,EAAS,GACTkwB,EAAW,GACXC,EAAc,CACd,MACD,KAAK,GACJnwB,EAAS,GACTkwB,EAAW,GACXC,EAAc,EAEhB5wD,KAAKghC,QAAUP,EACfzgC,KAAK6wD,MAAMnmD,aAAa,YAAaimD,GACrC3wD,KAAKm4B,MAAMztB,aAAa,eAAgBkmD,KAG1C5yB,WAAW,SAAS8yB,GACnB9wD,KAAKuuB,QAAUuiC,GAEhBliC,UAAU,WACT,MAAO5uB,MAAKuuB,SAEbuJ,cAAc,WACb,GAAIxsB,GAAQtL,KAAK+gC,OAChBr9B,EAAO1D,KAAKguD,UACb,QACCvtB,OAAOzgC,KAAKghC,QACZ91B,EAAEI,EAAMJ,EACRC,EAAEG,EAAMH,EACRzI,IAAIgB,EAAKA,EAAKqtD,KAAK,GAAG,KAGxBh5B,eAAe,SAASzmB,GACvB,MAAOhS,GAASk4B,gBAAgB/3B,EAAEo2B,KAAKyB,OAAQhmB,IAEhDolB,cAAc,WACb12B,KAAK8kB,KAAKkT,gBAAiBh4B,KAAKi4B,YAAaj4B,KAAKk4B,cAEnDD,UAAU,WACTj4B,KAAKmd,WAAand,KAAK+3B,eAAe,KACtC/3B,KAAKm4B,MAAQn4B,KAAK+3B,eAAe,UACjC/3B,KAAKmd,WAAW/M,YAAYpQ,KAAKm4B,OACjCn4B,KAAK6wD,MAAQ7wD,KAAK+3B,eAAe,QACjC/3B,KAAK6wD,MAAMzgD,YAAY9Q,EAAS0xD,eAAe,KAC/ChxD,KAAK6wD,MAAMzgD,YAAY9Q,EAAS0xD,eAAe,KAC/ChxD,KAAKmd,WAAW/M,YAAYpQ,KAAK6wD,QAElC34B,WAAW,WACVl4B,KAAKi3B,cACL,IAAIsc,GAAOvzC,KAAK6wD,KAChBtd,GAAK7oC,aAAa,iBAAkB1K,KAAK+C,QAAQ,mBACjDwwC,EAAK7oC,aAAa,cAAe1K,KAAK+C,QAAQ,gBAC9CwwC,EAAK7oC,aAAa,OAAQ1K,KAAK+C,QAAQmzB,OACvCqd,EAAK7oC,aAAa,aAAc1K,KAAK+C,QAAQ,eAC7CwwC,EAAK7oC,aAAa,cAAe1K,KAAK+C,QAAQ,gBAC9CwwC,EAAK7oC,aAAa,cAAe,UACjC6oC,EAAK7oC,aAAa,oBAAqB,WACvC6oC,EAAK7oC,aAAa,kBAAmB1K,KAAK+C,QAAQ,oBAClDwwC,EAAK7oC,aAAa,SAAU1K,KAAK+C,QAAQmzB,OACzCqd,EAAK7oC,aAAa,eAAgB,GAC9B,WAAa1K,KAAKixD,SAAW,YAAcjxD,KAAKixD,UACnDjxD,KAAKm4B,MAAMztB,aAAa,mBAAoB,QAC5C1K,KAAK+C,QAAQozB,UAAY,QAG1Bod,EAAKrjC,UAAY,oBACjBqjC,EAAK7oC,aAAa,OAAQ1K,KAAK+C,QAAQmzB,OACvCqd,EAAK7oC,aAAa,iBAAkB,QACpC6oC,EAAK7oC,aAAa,QAAS,oBAC3B6oC,EAAK7oC,aAAa,YAAa,YAC/B6oC,EAAK7oC,aAAa,iBAAkB1K,KAAK+C,QAAQ,kBACjD,IAAImuD,GAAQ,8EAA8EruD,MAAM,KAC/FE,EAAU/C,KAAK+C;AAChB,IAAK,GAAIouD,KAAQD,GAChB3d,EAAK7oC,aAAawmD,EAAMC,GAAOpuD,EAAQmuD,EAAMC,MAG/Cv6B,YAAY,WACX,GAAItlB,GAAItR,KAAK83B,eACb93B,MAAK6wD,MAAMnmD,aAAa,IAAK4G,EAAEpG,GAC3BzL,EAAEmL,QAAQ5C,GACbhI,KAAK6wD,MAAMnmD,aAAa,IAAK4G,EAAEnG,EAAI,EAAInL,KAAK8kB,KAAKrL,OAEjDzZ,KAAK6wD,MAAMnmD,aAAa,IAAK4G,EAAEnG,EAAInL,KAAK8kB,KAAKrL,MAAQ,GAEtDzZ,KAAK6wD,MAAMO,YAAc9/C,EAAE5O,KAAO1C,KAAKqxD,OACvCrxD,KAAKm4B,MAAMztB,aAAa,KAAM4G,EAAEpG,GAChClL,KAAKm4B,MAAMztB,aAAa,KAAM4G,EAAEnG,GAChCnL,KAAKm4B,MAAMztB,aAAa,IAAK4G,EAAEmvB,SAEhCxJ,aAAa,WACZx3B,EAAEo2B,KAAKn1B,UAAUu2B,aAAar2B,KAAKZ,MACnCA,KAAKm4B,MAAMxtB,gBAAgB,oBAC3B3K,KAAKm4B,MAAMxtB,gBAAgB,gBAC3B3K,KAAK6wD,MAAMnmD,aAAa,iBAAkB1K,KAAK+C,QAAQ,mBACvD/C,KAAK6wD,MAAMnmD,aAAa,cAAe1K,KAAK+C,QAAQ,gBACpD/C,KAAK6wD,MAAMnmD,aAAa,OAAQ1K,KAAK+C,QAAQmzB,OAC7Cl2B,KAAK6wD,MAAMnmD,aAAa,aAAc1K,KAAK+C,QAAQ,eACnD/C,KAAK6wD,MAAMnmD,aAAa,cAAe1K,KAAK+C,QAAQ,gBACpD/C,KAAK6wD,MAAMnmD,aAAa,cAAe,UACvC1K,KAAK6wD,MAAMnmD,aAAa,oBAAqB,WAC7C1K,KAAK6wD,MAAMnmD,aAAa,kBAAmB1K,KAAK+C,QAAQ,oBACxD/C,KAAKm4B,MAAMztB,aAAa,SAAU1K,KAAK+C,QAAQmzB,OAC/Cl2B,KAAKm4B,MAAMztB,aAAa,eAAgB,IACrC1K,KAAKiuD,QAAUjuD,KAAKiuD,OAAOqD,UAC7BtxD,KAAKm4B,MAAMztB,aAAa,mBAAoB,SAE9C+4B,UAAW,WACV,MAAOhkC,GAAEoiC,QAAQwB,WAAWrjC,MAC3B2G,KAAK,UACLq8B,WAAWhjC,KAAKguD,WAChBjrD,QAAQ/C,KAAK+C,QACbo/B,UACCx7B,KAAM,QACNy7B,YAAa3iC,EAAEoiC,QAAQqB,eAAeljC,KAAK4uB,mBAK/CnvB,EAAEm9C,KAAKkQ,MAAQrtD,EAAEm9C,KAAKsF,YAAYhiD,QACjC0F,SACC23C,KAAM,SAEPx6C,SACCkzB,QAAO,EACPC,MAAM,UACNI,OAAO,EACPrlB,QAAQ,EACRslB,MAAK,EACLE,YAAY,GACZxI,WAAU,GAEX3oB,WAAW,SAASgM,EAAGisB,GACtBv9B,KAAK2G,KAAOlH,EAAEm9C,KAAKkQ,MAAMvP,KACzBv9C,KAAKqiD,kBAAoB,WACzB5iD,EAAEm9C,KAAKsF,YAAYxhD,UAAU4E,WAAW1E,KAAKZ,KAAMsR,EAAGisB,IAEvDrgB,OAAO,SAAS8pB,GACVhnC,KAAKqwB,WACT5wB,EAAEwwB,QAAQvvB,UAAUwc,OAAOtc,KAAKZ,MAChCA,KAAK+H,KAAK,WACTJ,QAAS3H,KAAK2G,KACdqgC,OAAQA,IAEThnC,KAAK8kB,KAAK/c,KAAK,kBACdk1C,UAAWj9C,KAAK2G,SAInB0oD,kBAAkB,WAIjB,MAHArvD,MAAK+C,QAAQwwC,KAAOvzC,KAAKuzC,KACzBvzC,KAAK+C,QAAQirB,MAAQhuB,KAAKguB,MAC1BhuB,KAAK+C,QAAQ1B,MAAQrB,KAAKuzC,KACnBvzC,KAAK+C,SAEb2/C,WAAW,SAASpxC,GACftR,KAAKsiD,OACRtiD,KAAKsiD,OAAOhiB,UAAU,GAAI7gC,GAAEmV,aAAa5U,KAAKwiD,aAAclxC,KAE5DtR,KAAKsiD,OAAS,GAAI7iD,GAAEqtD,MAAM9sD,KAAKwiD,aAAcxiD,KAAKqvD,qBAClDrvD,KAAK8kB,KAAKpJ,SAAS1b,KAAKsiD,UAG1BhF,kBAAkB,SAAShsC,GAC1B,GAAIjQ,GAAQ,GAAI5B,GAAEqtD,MAAM9sD,KAAKsiD,OAAO/zB,QAASvuB,KAAKqvD,oBAClD5vD,GAAEm9C,KAAKsF,YAAYxhD,UAAU48C,kBAAkB18C,KAAKZ,KAAMqB,IAE3DshD,eAAe,SAASrxC,GACpBA,EAAEy7B,iBACJz7B,EAAE2zB,QAAU3zB,EAAEy7B,eAAe,GAAG9H,QAChC3zB,EAAE4zB,QAAU5zB,EAAEy7B,eAAe,GAAG7H,QAEjC,IAAI3H,GAAIv9B,KAAK8kB,KAAKlF,uBAAuBtO,GACxClR,EAAI,GAAIX,GAAEwL,MAAM,EAAG,EACpBjL,MAAKwiD,aAAexiD,KAAK8kB,KAAKpH,mBAAmB6f,EAAE/xB,SAASpL,IAC5DJ,KAAK0iD,WAAW1iD,KAAK8kB,KAAKpH,mBAAmB6f,EAAElyB,IAAIjL,KACnDJ,KAAKs9C,qBAENxjB,aAAa,SAASxoB,GACrB,GAAIoF,GAASpF,EAAEoF,MACf1W,MAAKk9C,SAASqD,eAAe7pC,MAI/BjX,EAAEwjD,KAAK6J,MAAQrtD,EAAEwjD,KAAKf,YAAYhiD,QACjC6C,SACCwuD,eAAc,GAEflL,kBAAmB,WAIlBrmD,KAAKmmD,YAAcnmD,KAAKs/C,cAAct/C,KAAKsiD,OAAO/zB,QAAS,GAAI9uB,GAAE+wB,SAChElD,SAAU,GAAI7tB,GAAEwL,MAAMjL,KAAKsiD,OAAOthB,QAAShhC,KAAKsiD,OAAOthB,SACvD9wB,UAAW,6DAEZlQ,KAAKmmD,YAAYn1C,WAAW,IAE7B+zC,UAAU,WACTtlD,EAAEwjD,KAAKf,YAAYxhD,UAAUqkD,UAAUnkD,KAAKZ,MAC5CA,KAAKmmD,YAAYn1C,WAAW,IAE7B6zC,mBAAoB,SAAUvzC,GAC7B7R,EAAEwjD,KAAKf,YAAYxhD,UAAUmkD,mBAAmBjkD,KAAKZ,KAAMsR,IAE5Dg1C,oBAAqB,WACpBtmD,KAAKomD,mBAENM,MAAM,SAAShwC,GACd1W,KAAKsiD,OAAOtkB,WAAWtnB,GACvB1W,KAAKsiD,OAAO97B,SACZxmB,KAAKsiD,OAAOv6C,KAAK,aAElB+8C,cAAe,SAAUxzC,GACxB,GAAIif,GAASjf,EAAE7J,OACdiP,EAAS6Z,EAAO3B,WAEjB5uB,MAAKojD,gBAED7yB,IAAWvwB,KAAKmmD,aACnBnmD,KAAK0mD,MAAMhwC,MAMdjX,EAAEqtD,MAAM3mD,YAAY,WACnBnG,KAAK6jD,QAAU,GAAIpkD,GAAEwjD,KAAK6J,MAAM9sD,QAKjCP,EAAEkkD,eAAiBlkD,EAAE61B,aAAap1B,QACjC6C,WAGAuC,WAAY,SAAUvC,GACrB,GAAI2gD,GAAO1jD,IACX0jD,GAAK3qC,WACLtZ,EAAEQ,KAAK6C,WAAW4gD,EAAM3gD,IAEzBof,MAAO,SAAUkB,GAChB,GAAIqgC,GAAO1jD,IACXP,GAAE61B,aAAa50B,UAAUyhB,MAAMvhB,KAAKZ,KAAKqjB,GAEzCA,EAAIzb,GAAG,QAAQ87C,EAAK7pB,SAAS6pB,IAI9B8N,OAAO,SAAS71C,EAAMuG,GACjBliB,KAAK+C,QAAQof,OAASniB,KAAK+C,QAAQof,MAAMvhB,KAAKZ,KAAK2b,EAAMuG,MAAY,GACxEA,KAKF2X,SAAS,SAASvoB,GACjB,GAAIoyC,GAAO1jD,IACX,IAAGsR,EAAE7J,iBAAkBhI,GAAEsuB,OAExB,WADA21B,GAAK+N,eAAengD,EAAE7J,OAGvB,IAECiqD,GAFGv6B,EAAI7lB,EAAEoF,OACTi7C,IAaD,IAXA3xD,KAAKsc,UAAU,SAAUX,GACrBA,EAAMkoC,SAAWloC,EAAMkoC,QAAQxzB,WACjCqhC,EAAK/1C,EACN,IAAI5O,GAAS4O,EAAMrB,WACnBg0C,SAAQ33C,IAAI5J,EAAOoqB,GAChBpqB,GAAUtN,EAAEkkD,eAAeiO,eAAe7kD,EAAOkI,WAAW/B,IAAKnG,EAAOmI,WAAWhC,IAAKikB,EAAEjkB,IAAK,IACjGzT,EAAEkkD,eAAeiO,eAAe7kD,EAAOkI,WAAW9B,IAAKpG,EAAOmI,WAAW/B,IAAKgkB,EAAEhkB,IAAK,IAErFw+C,EAAWvuD,KAAKuY,KAGM,GAArBg2C,EAAW7wD,OACbd,KAAKyxD,eAAeE,EAAW,QAE3B,IAAGA,EAAW7wD,OAAO,EAAE,CACxB4wD,GACFA,EAAG7N,QAAQ7hC,SACZ,IAAI65B,GAAUp8C,EAAEwO,QAAQ+B,OAAO,MAAM,0BACpCs7C,EAAK7rD,EAAEwO,QAAQ+B,OAAO,KAAK,GAAG6rC,EAC/B8V,GAAWE,QAAQ,SAASl2C,GAC3B,GAAI4vC,GAAM9rD,EAAEwO,QAAQ+B,OAAO,KAAK,GAAGs7C,GAClC/+C,EAAI9M,EAAEwO,QAAQ+B,OAAO,IAAI,GAAGu7C,EAC7Bh/C,GAAE7B,aAAa,OAAO,sBACnBiR,YAAiBlc,GAAEqtD,MACrBvgD,EAAE8a,UAAY,KAAK1L,EAAMqyC,YAAcryC,EAAMqyC,WAAW+C,KAEjDp1C,YAAiBlc,GAAEytD,UAC1B3gD,EAAE8a,UAAY,MAEP1L,YAAiBlc,GAAEotD,YAC1BtgD,EAAE8a,UAAY,OAEf5nB,EAAEiT,SAAS9K,GAAG2E,EAAE,QAAQ,SAAS+E,GAChCoyC,EAAK5+B,KAAK4N,aACVgxB,EAAK+N,eAAe91C,OAGtB+nC,EAAK5+B,KAAK6M,UAAUkqB,EAAQ1kB,GAC3BlG,aAAY,MAKfwgC,eAAgB,SAAS91C,GACrBA,EAAMkoC,SAAWloC,EAAMkoC,QAAQxzB,WAClCrwB,KAAKsc,UAAU,SAAUX,GACpBA,EAAMkoC,SAAWloC,EAAMkoC,QAAQxzB,UAClC1U,EAAMkoC,QAAQ7hC,YAEZrG,EAAMkoC,UAAYloC,EAAMkoC,QAAQxzB,UACnC1U,EAAMkoC,QAAQ3mC,WAEhBxB,SAAU,SAAUC,EAAM4gC,GACzB,GAAImH,GAAO1jD,IAmBX,OAlBAP,GAAE61B,aAAa50B,UAAUgb,SAAS9a,KAAK8iD,EAAK/nC,GAC5CA,EAAM/T,GAAG,QAAQ87C,EAAK7pB,SAAS6pB,GAC/BzhD,WAAW,WAGT0Z,EAAMm2C,IAAMpO,EACR/nC,EAAMsyC,QAAWtyC,EAAMsyC,OAAO8D,KACjCp2C,EAAMuyC,UACL6D,IAAItyD,EAAEkkD,eAAeqO,SAGvBvyD,EAAEkkD,eAAe8C,SAAS9qC,GAAM,GAC7B4gC,KAAO,GACTmH,EAAK+N,eAAe91C,IAGrB,KAEK3b,MAER+hC,QAAS,SAAUD,GAClB,GACC1hC,GAAGE,EAAK0hC,EADLC,EAAWxiC,EAAEQ,KAAK4D,QAAQi+B,GAAWA,EAAUA,EAAQG,QAG3D,IAAIA,EAAU,CACb,IAAK7hC,EAAI,EAAGE,EAAM2hC,EAASnhC,OAAYR,EAAJF,EAASA,IAE3C4hC,EAAUC,EAAS7hC,IACf4hC,EAAQE,YAAcF,EAAQG,UAAYH,EAAQC,UAAYD,EAAQI,cACzEpiC,KAAK+hC,QAAQE,EAAS7hC,GAGxB,OAAOJ,MAGR,GAAI+C,GAAU/C,KAAK+C,OAEnB,KAAIA,EAAQmO,QAAWnO,EAAQmO,OAAO4wB,GAAtC,CAEA,GAC+BnmB,GAAMjF,EADjCyrB,EAA4B,YAAjBL,EAAQn7B,KAAqBm7B,EAAQK,SAAWL,EAC9DgB,EAASX,EAASC,WACnB,QAAQD,EAASx7B,MAChB,IAAK,QACJ+P,EAAS1W,KAAKuiC,eAAeO,GAC7BnnB,EAAQ,GAAIlc,GAAEqtD,MAAMp2C,EAAOorB,EAAQ/+B,QACnC,MACD,KAAK,YACJ2T,EAAS1W,KAAK+iC,gBAAgBD,GAC9BnnB,EAAQ,GAAIlc,GAAEytD,UAAUx2C,EAAO,GAAGA,EAAO,GAAGorB,EAAQ/+B,QACpD,MACD,KAAK,YACJ2T,EAAS1W,KAAK+iC,gBAAgBD,EAAQ,GACtCnnB,EAAQ,GAAIlc,GAAEotD,UAAUn2C,EAAQorB,EAAQ/+B,SAI1C,MADA4Y,GAAMuyC,UAAYvyC,EAAMuyC,SAASpsB,EAAQkB,YAClChjC,KAAK0b,SAASC,GAAM,KAE5B4mB,eAAgB,SAAUO,GACzB,MAAO,IAAIrjC,GAAEwT,OAAO6vB,EAAO,GAAIA,EAAO,GAAIA,EAAO,KAElDC,gBAAiB,SAAUD,EAAQG,EAAYV,GAC9C,GAAI7rB,GAAQtW,EAAGE,EACdyU,IAED,KAAK3U,EAAI,EAAGE,EAAMwiC,EAAOhiC,OAAYR,EAAJF,EAASA,IACzCsW,EAASusB,EACRjjC,KAAK+iC,gBAAgBD,EAAO1iC,GAAI6iC,EAAa,EAAGV,IAC/CA,GAAkBviC,KAAKuiC,gBAAgBO,EAAO1iC,IAEhD2U,EAAQ3R,KAAKsT,EAEd,OAAO3B,IAERoH,YAAY,SAASR,GACpB,GAAGA,YAAiBlc,GAAEytD,UAAU,CAC/B,GAAIU,GAAKjyC,EAAMm2C,GACf,IAAGlE,EAAG,CACL,GAAIqE,GAAUt2C,EAAMqyC,WAAW+D,GAC/BnE,GAAGtxC,UAAU,SAAS41C,GAClBA,YAAczyD,GAAEqtD,OAASoF,YAAczyD,GAAEotD,UACxCqF,EAAGlE,WAAWsD,UAAUW,IAC1BC,EAAG/D,aACFmD,SAAU,OAEXY,EAAGJ,IAAI/uD,QAAQ0jD,UAAYyL,EAAGJ,IAAI/uD,QAAQ0jD,SAAS7lD,KAAKsxD,EAAGJ,MAGrDI,YAAczyD,GAAEqtD,QACvBoF,EAAG/D,aACFmD,SAAU,OAEXY,EAAGJ,IAAI/uD,QAAQ0jD,UAAYyL,EAAGJ,IAAI/uD,QAAQ0jD,SAAS7lD,KAAKsxD,EAAGJ,SAK/Dn2C,EAAMm2C,IAAI/uD,QAAQovD,UAAYx2C,EAAMm2C,IAAI/uD,QAAQovD,SAASvxD,KAAK+a,EAAMm2C,KACpEryD,EAAE61B,aAAa50B,UAAUyb,YAAYR,MAGvClc,EAAES,OAAOT,EAAEkkD,gBACVqO,KAAK,WACJ,GAAIxkD,IAAI,GAAInJ,OAAO+tD,SAChB/yD,GAAOgzD,aAAiD,kBAA3BhzD,GAAOgzD,YAAY3mB,MAClDl+B,GAAK6kD,YAAY3mB,MAElB,IAAIsmB,GAAO,uCAAuCrvD,QAAQ,QAAS,SAAS4K,GAC3E,GAAIkC,IAAKjC,EAAkB,GAAdjL,KAAK+vD,UAAa,GAAK,CAEpC,OADA9kD,GAAIjL,KAAKwJ,MAAMyB,EAAE,KACN,KAAHD,EAASkC,EAAO,EAAFA,EAAM,GAAM1L,SAAS,KAE5C,OAAOiuD,IAERvL,SAAS,SAAS9qC,EAAM42C,GACvB,GAAG52C,YAAiBlc,GAAEytD,UAAU,CAC/B,GAAIU,GAAKjyC,EAAMm2C,GACf,IAAGlE,EAAG,CACL,GAAIqE,GAAUt2C,EAAMqyC,WAAW+D,GAC/BnE,GAAGtxC,UAAU,SAAS41C,GACrB,GAAGA,YAAczyD,GAAEqtD,MAAM,CACxB,GAAI0F,GAAW/yD,EAAEkkD,eAAe8O,uBAAuB92C,EAAMyrB,YAAYzrB,EAAMwzC,UAAU+C,EAAGnxB,OAAOmxB,EAAGlxB,QACnGwxB,GACFN,EAAG/D,aACFmD,SAAUW,IAGJC,EAAGlE,WAAWsD,UAAUW,GAC/BC,EAAG/D,aACFmD,SAAU,eAOX,IAAG31C,YAAiBlc,GAAEqtD,MAAM,CAChC,GAAIc,GAAKjyC,EAAMm2C,GACf,IAAGlE,EAAG,CACL,GAAIqE,GAAU,IACdrE,GAAGtxC,UAAU,SAAS41C,GACrB,IAAID,GAAWC,YAAczyD,GAAEytD,UAAU,CACxC,GAAIsF,GAAW/yD,EAAEkkD,eAAe8O,uBAAuBP,EAAG9qB,YAAY8qB,EAAG/C,UAAUxzC,EAAMolB,OAAOplB,EAAMqlB,QACnGwxB,KACFP,EAAUC,EAAGlE,WAAW+D,KAEzBzD,QAAQ33C,IAAI67C,OAER,IAAGN,YAAczyD,GAAEotD,UAAU,CACjC,GAAIrgD,GAAI0lD,EAAG53C,WACR7a,GAAEkkD,eAAeiO,eAAeplD,EAAEyI,WAAW/B,IAAK1G,EAAE0I,WAAWhC,IAAIyI,EAAM4S,QAAQrb,MACjFzT,EAAEkkD,eAAeiO,eAAeplD,EAAEyI,WAAW9B,IAAK3G,EAAE0I,WAAW/B,IAAIwI,EAAM4S,QAAQpb,OACnF8+C,EAAUC,EAAGlE,WAAW+D,QAK3Bp2C,EAAMwyC,aACLmD,SAASW,SAIP,IAAGt2C,YAAiBlc,GAAEotD,UAAU,CACpC,GAAIe,GAAKjyC,EAAMm2C,GACf,IAAGlE,EAAG,CACL,GAAIqE,GAAUt2C,EAAMqyC,WAAW+D,GAC/BnE,GAAGtxC,UAAU,SAAS41C,GACrB,GAAGA,YAAczyD,GAAEqtD,MAAM,CACxB,GAAItgD,GAAImP,EAAMrB,WACX7a,GAAEkkD,eAAeiO,eAAeplD,EAAEyI,WAAW/B,IAAK1G,EAAE0I,WAAWhC,IAAIg/C,EAAG3jC,QAAQrb,MAC7EzT,EAAEkkD,eAAeiO,eAAeplD,EAAEyI,WAAW9B,IAAK3G,EAAE0I,WAAW/B,IAAI++C,EAAG3jC,QAAQpb,KACjF++C,EAAG/D,aACFmD,SAAUW,IAGJC,EAAGlE,WAAWsD,UAAUW,GAC/BC,EAAG/D,aACFmD,SAAU,WAQhB31C,EAAMm2C,KAAOn2C,EAAMm2C,IAAI/uD,QAAQ0jD,UAAY9qC,EAAMm2C,IAAI/uD,QAAQ0jD,SAAS7lD,KAAK+a,EAAMm2C,IAAIn2C,EAAM42C,IAG5FnC,QAAS,SAAUz0C,EAAO+2C,GACzB,MAAOjzD,GAAES,QACR6C,QAAQ4Y,EAAM5Y,SACZ2vD,IAEJ9O,mBAAmB,SAASjoC,EAAM4gC,GACjC,GAAIqR,GAAKjyC,EAAMm2C,GACf,OAAOlE,GAAG7qD,QAAQ4vD,SAAW/E,EAAG7qD,QAAQ4vD,SACtCh3C,MAAOA,EACPia,aAAcg4B,EACdrR,KAAMA,KAqBTkW,uBAAuB,SAAS12B,EAAGC,EAAG42B,EAAGnjD,GACxC,GAAIojD,GAAK92B,EAAG7wB,EAAE4nD,EAAK92B,EAAG9wB,EACrB6nD,EAAKh3B,EAAG5wB,EAAE6nD,EAAKh3B,EAAG7wB,EAClBD,EAAI0nD,EAAG1nD,EAAEC,EAAIynD,EAAGznD,EAEb8nD,EAAM1wD,KAAK2J,KAAK3J,KAAKD,IAAIuwD,EAAGC,EAAG,GAAGvwD,KAAKD,IAAIywD,EAAGC,EAAG,IACjDhwC,GAAM6vC,EAAGC,GAAIG,EACb/vC,GAAM6vC,EAAGC,GAAIC,EACb11B,EAAIva,GAAI9X,EAAE4nD,GAAM5vC,GAAI/X,EAAE6nD,GACtBE,EAAK31B,EAAEva,EAAG8vC,EACbK,EAAK51B,EAAEra,EAAG8vC,EACPI,EAAM7wD,KAAK2J,KAAK3J,KAAKD,IAAI4wD,EAAGhoD,EAAE,GAAG3I,KAAKD,IAAI6wD,EAAGhoD,EAAE,GACnD,IAAUsE,EAAN2jD,EACJ,CACC,GAAIC,GAAK9wD,KAAK2J,KAAK3J,KAAKD,IAAImN,EAAE,GAAKlN,KAAKD,IAAI8wD,EAAI,IAC5CE,GAAM/1B,EAAE81B,GAAIrwC,EAAK8vC,EACpBS,GAAMh2B,EAAE81B,GAAInwC,EAAK8vC,EAEdQ,GAAMj2B,EAAE81B,GAAIrwC,EAAK8vC,EACpBW,GAAMl2B,EAAE81B,GAAInwC,EAAK8vC,CAElB,OAAOhzD,MAAK0zD,cAAc33B,EAAGC,IAAK9wB,EAAEooD,EAAGnoD,EAAEooD,IAAKroD,EAAEsoD,EAAGroD,EAAEsoD,KAEjD,MAAGL,IAAO3jD,EACPzP,KAAK0zD,cAAc33B,EAAGC,IAAK9wB,EAAEgoD,EAAG/nD,EAAEgoD,MAGlC,GAGTO,cAAc,SAAS33B,EAAGC,EAAG23B,GAC5B,IAAI,GAAIvzD,GAAG,EAAE4xC,EAAE2hB,EAAG7yD,OAASkxC,EAAF5xC,EAAIA,IAAK,CACjC,GAAI+2B,GAAIw8B,EAAGvzD,EACX,IAAIJ,KAAK4xD,eAAe71B,EAAG7wB,EAAG8wB,EAAG9wB,EAAGisB,EAAEjsB,IAAMlL,KAAK4xD,eAAe71B,EAAG5wB,EAAG6wB,EAAG7wB,EAAGgsB,EAAEhsB,GAC7E,OAAO,EAET,OAAO,GAERymD,eAAe,SAASgC,EAAGC,EAAG1M,EAAG2M,GAchC,MAbGA,IACCvxD,KAAK8J,IAAIunD,EAAGC,GAAI,MACfD,EAAGC,GAELD,GAAI,IACJC,GAAI,MAGJD,GAAI,IACJC,GAAI,MAIAD,EAAKC,EACZD,GAAMzM,GAAKA,GAAK0M,EAChBA,GAAM1M,GAAKA,GAAKyM,MAGhBv0D,OAAOC,UAIV,SAAUD,EAAOC,GACb,YAEAG,GAAEs0D,OAASt0D,EAAES,UAAWT,EAAEwX,KACtBI,WAAY5X,EAAE6W,WAAWU,OACzBM,eAAgB,GAAI7X,GAAE6N,eAAe,EAAG,EAAG,EAAG,GAC9CQ,MAAO,SAAUwD,GACb,MAAO,KAAM/O,KAAKD,IAAI,EAAGgP,KAMjC,IAAI0iD,GAAKv0D,EAAE6tD,MACX0G,GAAGzG,aAAe9tD,EAAEgtD,YAAYvsD,QAC5B6C,SACI1B,SACAurD,aACAqH,cAEJ5J,gBAAgB,SAAShnC,GACrB,QAEQykB,QAAS9nC,KAAK+C,QAAQ1B,MACtBsG,QAAS,GAAIlI,GAAEm9C,KAAKkQ,MAAMzpC,EAAKrjB,KAAK+C,QAAQ1B,OAC5C2sB,MAAO,OAGP8Z,QAAS9nC,KAAK+C,QAAQ6pD,UACtBjlD,QAAS,GAAIlI,GAAEm9C,KAAKsQ,UAAU7pC,EAAIrjB,KAAK+C,QAAQ6pD,WAC/C5+B,MAAM,QAGN8Z,QAAS9nC,KAAK+C,QAAQkxD,UACtBtsD,QAAS,GAAIlI,GAAEm9C,KAAKiQ,UAAUxpC,EAAIrjB,KAAK+C,QAAQkxD,WAC/CjmC,MAAM,YAKtBgmC,EAAGD,OAASt0D,EAAES,UAAWT,EAAEwX,KACvBI,WAAY5X,EAAE6W,WAAWU,OACzBM,eAAgB,GAAI7X,GAAE6N,eAAe,EAAG,EAAG,EAAG,GAC9CQ,MAAO,SAAUwD,GACb,MAAO,KAAM/O,KAAKD,IAAI,EAAGgP,MAIjC0iD,EAAGE,QAAUz0D,EAAE0F,MAAMjF,QACjB2F,SAAUpG,EAAE6G,MAAMC,OAClBxD,SACIoxD,cACAC,kBAEJ9uD,WAAW,SAAST,EAAG9B,GACnB,GAAI2gD,GAAO1jD,KAAK4tD,GAAK,CACrB7qD,GAAUtD,EAAEqD,WAAW4gD,EAAM3gD,GAC7B2gD,EAAK5+B,KAAOrlB,EAAE4jB,IAAIxe,GACdoT,IAAK+7C,EAAGD,OACRp7C,QAAS,GAAI,IACbxB,KAAM,EACNyE,QAAS,EACTZ,QAAS,EACT4vB,iBAAiB,EACjBypB,eAAe,EACf1gB,oBAAoB,IAExB+P,EAAK4Q,aAEL,KAAI,GAAIrtC,KAAQlkB,GAAQoxD,WACpBzQ,EAAK4Q,WAAWrtC,IACZtC,IAAK5hB,EAAQoxD,WAAWltC,GAAMtC,IAC9BhJ,MAAOlc,EAAEgrB,UAAU1nB,EAAQoxD,WAAWltC,GAAMtC,IAAKllB,EAAEQ,KAAKC,QAAQqkB,aAAa,GAAOxhB,EAAQoxD,WAAWltC,GAAMlkB,WAE7G6qD,IACAlK,EAAK6Q,UAAUttC,GACf2mC,GAAK,EAGbA,IAAK,EACLlK,EAAK8Q,iBACL,KAAI,GAAIvtC,KAAQlkB,GAAQqxD,cAAc,CAClC,GAAIK,GAAO,GAAIh1D,GAAEkkD,eAAe5gD,EAAQqxD,cAAcntC,GAAMlkB,QAC5D2gD,GAAK8Q,eAAevtC,IAChBtL,MAAO84C,EACP5Y,QAAQ,GAAIp8C,GAAE4xC,QAAQuL,KAAKn9C,EAAES,OAAO6C,EAAQqxD,cAAcntC,GAAM40B,SAC5DjmB,aAAa6+B,MAGjB7G,IACAlK,EAAKgR,aAAaztC,GAAK,GACvB2mC,GAAK,KAIjB2G,UAAU,SAAS51B,GACf,GAAI+kB,GAAO1jD,KAAKqjB,EAAMqgC,EAAK5+B,IACxB4+B,GAAKiR,cACJtxC,EAAIlH,YAAYunC,EAAKiR,cAEzBrG,QAAQ33C,IAAI,QAAQgoB,GACpB+kB,EAAKiR,aAAejR,EAAK4Q,WAAW31B,GAAGhjB,MAAM+J,MAAMrC,IAEvDqxC,aAAa,SAAS/1B,EAAEi2B,GACpB,GAAIlR,GAAO1jD,KACP60D,EAAKnR,EAAKoR,IAAOpR,EAAKoR,QACtBzxC,EAAMqgC,EAAK5+B,IACf,OAAG+vC,GAAGl2B,IACEi2B,IAEAvxC,EAAIlH,YAAY04C,EAAGl2B,GAAGhjB,OACtB0H,EAAIiuB,cAAcujB,EAAGl2B,GAAGkd,qBAErBgZ,GAAGl2B,SAGNi2B,IACJC,EAAGl2B,GAAK+kB,EAAK8Q,eAAe71B,GACzBk2B,EAAGl2B,KACFk2B,EAAGl2B,GAAGhjB,MAAM+J,MAAMrC,GAClBwxC,EAAGl2B,GAAGkd,QAAQn2B,MAAMrC,UAMrChkB,OAAOC","file":"BZ.js","sourcesContent":["/**\n * BZ 0.1\n * \n * \n * http://www.sxt.com.cn/\n * \n * Copyright 2016, jiuyuong\n * \n * http://www.sxt.com.cn/\n * \n * Licensed under MIT\n * \n * Released on: April 12, 2016\n */\n/*\r\n Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com\r\n (c) 2010-2013, Vladimir Agafonkin\r\n (c) 2010-2011, CloudMade\r\n */\r\n(function (window, document, undefined) {\r\n\tvar oldL = window.L,\r\n\t\tL = {};\r\n\r\n\tL.version = '0.7.2';\r\n\r\n// define Leaflet for Node module pattern loaders, including Browserify\r\n\tif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\t\tmodule.exports = L;\r\n\r\n// define Leaflet as an AMD module\r\n\t} else if (typeof define === 'function' && define.amd) {\r\n\t\tdefine(L);\r\n\t}\r\n\r\n// define Leaflet as a global L variable, saving the original L to restore later if needed\r\n\r\n\tL.noConflict = function () {\r\n\t\twindow.L = oldL;\r\n\t\treturn this;\r\n\t};\r\n\r\n\twindow.L = L;\r\n\r\n\r\n\t/*\r\n\t * L.Util contains various utility functions used throughout Leaflet code.\r\n\t */\r\n\r\n\tL.Util = {\r\n\t\textend: function (dest) { // (Object[, Object, ...]) ->\r\n\t\t\tvar sources = Array.prototype.slice.call(arguments, 1),\r\n\t\t\t\ti, j, len, src;\r\n\r\n\t\t\tfor (j = 0, len = sources.length; j < len; j++) {\r\n\t\t\t\tsrc = sources[j] || {};\r\n\t\t\t\tfor (i in src) {\r\n\t\t\t\t\tif (src.hasOwnProperty(i)) {\r\n\t\t\t\t\t\tdest[i] = src[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn dest;\r\n\t\t},\r\n\r\n\t\tbind: function (fn, obj) { // (Function, Object) -> Function\r\n\t\t\tvar args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n\t\t\treturn function () {\r\n\t\t\t\treturn fn.apply(obj, args || arguments);\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tstamp: (function () {\r\n\t\t\tvar lastId = 0,\r\n\t\t\t\tkey = '_leaflet_id';\r\n\t\t\treturn function (obj) {\r\n\t\t\t\tobj[key] = obj[key] || ++lastId;\r\n\t\t\t\treturn obj[key];\r\n\t\t\t};\r\n\t\t}()),\r\n\r\n\t\tinvokeEach: function (obj, method, context) {\r\n\t\t\tvar i, args;\r\n\r\n\t\t\tif (typeof obj === 'object') {\r\n\t\t\t\targs = Array.prototype.slice.call(arguments, 3);\r\n\r\n\t\t\t\tfor (i in obj) {\r\n\t\t\t\t\tmethod.apply(context, [i, obj[i]].concat(args));\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tlimitExecByInterval: function (fn, time, context) {\r\n\t\t\tvar lock, execOnUnlock;\r\n\r\n\t\t\treturn function wrapperFn() {\r\n\t\t\t\tvar args = arguments;\r\n\r\n\t\t\t\tif (lock) {\r\n\t\t\t\t\texecOnUnlock = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlock = true;\r\n\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tlock = false;\r\n\r\n\t\t\t\t\tif (execOnUnlock) {\r\n\t\t\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\t\t\texecOnUnlock = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, time);\r\n\r\n\t\t\t\tfn.apply(context, args);\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tfalseFn: function () {\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tformatNum: function (num, digits) {\r\n\t\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\t\treturn Math.round(num * pow) / pow;\r\n\t\t},\r\n\r\n\t\ttrim: function (str) {\r\n\t\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t\t},\r\n\r\n\t\tsplitWords: function (str) {\r\n\t\t\treturn L.Util.trim(str).split(/\\s+/);\r\n\t\t},\r\n\r\n\t\tsetOptions: function (obj, options) {\r\n\t\t\tobj.options = L.extend({}, obj.options, options);\r\n\t\t\treturn obj.options;\r\n\t\t},\r\n\r\n\t\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\t\tvar params = [];\r\n\t\t\tfor (var i in obj) {\r\n\t\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t\t}\r\n\t\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t\t},\r\n\t\ttemplate: function (str, data) {\r\n\t\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\t\tvar value = data[key];\r\n\t\t\t\tif (value === undefined) {\r\n\t\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\t\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\t\tvalue = value(data);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tisArray: Array.isArray || function (obj) {\r\n\t\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t\t},\r\n\r\n\t\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n\t};\r\n\r\n\t(function () {\r\n\r\n\t\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\t\tfunction getPrefixed(name) {\r\n\t\t\tvar i, fn,\r\n\t\t\t\tprefixes = ['webkit', 'moz', 'o', 'ms'];\r\n\r\n\t\t\tfor (i = 0; i < prefixes.length && !fn; i++) {\r\n\t\t\t\tfn = window[prefixes[i] + name];\r\n\t\t\t}\r\n\r\n\t\t\treturn fn;\r\n\t\t}\r\n\r\n\t\tvar lastTime = 0;\r\n\r\n\t\tfunction timeoutDefer(fn) {\r\n\t\t\tvar time = +new Date(),\r\n\t\t\t\ttimeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\t\tlastTime = time + timeToCall;\r\n\t\t\treturn window.setTimeout(fn, timeToCall);\r\n\t\t}\r\n\r\n\t\tvar requestFn = window.requestAnimationFrame ||\r\n\t\t\tgetPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n\r\n\t\tvar cancelFn = window.cancelAnimationFrame ||\r\n\t\t\tgetPrefixed('CancelAnimationFrame') ||\r\n\t\t\tgetPrefixed('CancelRequestAnimationFrame') ||\r\n\t\t\tfunction (id) { window.clearTimeout(id); };\r\n\r\n\r\n\t\tL.Util.requestAnimFrame = function (fn, context, immediate, element) {\r\n\t\t\tfn = L.bind(fn, context);\r\n\r\n\t\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\t\tfn();\r\n\t\t\t} else {\r\n\t\t\t\treturn requestFn.call(window, fn, element);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tL.Util.cancelAnimFrame = function (id) {\r\n\t\t\tif (id) {\r\n\t\t\t\tcancelFn.call(window, id);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t}());\r\n\r\n// shortcuts for most used utility functions\r\n\tL.extend = L.Util.extend;\r\n\tL.bind = L.Util.bind;\r\n\tL.stamp = L.Util.stamp;\r\n\tL.setOptions = L.Util.setOptions;\r\n\r\n\r\n\t/*\r\n\t * L.Class powers the OOP facilities of the library.\r\n\t * Thanks to John Resig and Dean Edwards for inspiration!\r\n\t */\r\n\r\n\tL.Class = function () {};\r\n\r\n\tL.Class.extend = function (props) {\r\n\r\n\t\t// extended class with the new prototype\r\n\t\tvar NewClass = function () {\r\n\r\n\t\t\t// call the constructor\r\n\t\t\tif (this.initialize) {\r\n\t\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t\t}\r\n\r\n\t\t\t// call all constructor hooks\r\n\t\t\tif (this._initHooks) {\r\n\t\t\t\tthis.callInitHooks();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// instantiate class without calling constructor\r\n\t\tvar F = function () {};\r\n\t\tF.prototype = this.prototype;\r\n\r\n\t\tvar proto = new F();\r\n\t\tproto.constructor = NewClass;\r\n\r\n\t\tNewClass.prototype = proto;\r\n\r\n\t\t//inherit parent's statics\r\n\t\tfor (var i in this) {\r\n\t\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\t\tNewClass[i] = this[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// mix static properties into the class\r\n\t\tif (props.statics) {\r\n\t\t\tL.extend(NewClass, props.statics);\r\n\t\t\tdelete props.statics;\r\n\t\t}\r\n\r\n\t\t// mix includes into the prototype\r\n\t\tif (props.includes) {\r\n\t\t\tL.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\t\tdelete props.includes;\r\n\t\t}\r\n\r\n\t\t// merge options\r\n\t\tif (props.options && proto.options) {\r\n\t\t\tprops.options = L.extend({}, proto.options, props.options);\r\n\t\t}\r\n\r\n\t\t// mix given properties into the prototype\r\n\t\tL.extend(proto, props);\r\n\r\n\t\tproto._initHooks = [];\r\n\r\n\t\tvar parent = this;\r\n\t\t// jshint camelcase: false\r\n\t\tNewClass.__super__ = parent.prototype;\r\n\r\n\t\t// add method for calling all hooks\r\n\t\tproto.callInitHooks = function () {\r\n\r\n\t\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\t\tif (parent.prototype.callInitHooks) {\r\n\t\t\t\tparent.prototype.callInitHooks.call(this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._initHooksCalled = true;\r\n\r\n\t\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\t\tproto._initHooks[i].call(this);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn NewClass;\r\n\t};\r\n\r\n\r\n// method for adding properties to prototype\r\n\tL.Class.include = function (props) {\r\n\t\tL.extend(this.prototype, props);\r\n\t};\r\n\r\n// merge new default options to the Class\r\n\tL.Class.mergeOptions = function (options) {\r\n\t\tL.extend(this.prototype.options, options);\r\n\t};\r\n\r\n// add a constructor hook\r\n\tL.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\t\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\t\tthis[fn].apply(this, args);\r\n\t\t};\r\n\r\n\t\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\t\tthis.prototype._initHooks.push(init);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Mixin.Events is used to add custom events functionality to Leaflet classes.\r\n\t */\r\n\r\n\tvar eventsKey = '_leaflet_events';\r\n\r\n\tL.Mixin = {};\r\n\r\n\tL.Mixin.Events = {\r\n\r\n\t\taddEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])\r\n\r\n\t\t\t// types can be a map of types/handlers\r\n\t\t\tif (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }\r\n\r\n\t\t\tvar events = this[eventsKey] = this[eventsKey] || {},\r\n\t\t\t\tcontextId = context && context !== this && L.stamp(context),\r\n\t\t\t\ti, len, event, type, indexKey, indexLenKey, typeIndex;\r\n\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tevent = {\r\n\t\t\t\t\taction: fn,\r\n\t\t\t\t\tcontext: context || this\r\n\t\t\t\t};\r\n\t\t\t\ttype = types[i];\r\n\r\n\t\t\t\tif (contextId) {\r\n\t\t\t\t\t// store listeners of a particular context in a separate hash (if it has an id)\r\n\t\t\t\t\t// gives a major performance boost when removing thousands of map layers\r\n\r\n\t\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\t\ttypeIndex = events[indexKey] = events[indexKey] || {};\r\n\r\n\t\t\t\t\tif (!typeIndex[contextId]) {\r\n\t\t\t\t\t\ttypeIndex[contextId] = [];\r\n\r\n\t\t\t\t\t\t// keep track of the number of keys in the index to quickly check if it's empty\r\n\t\t\t\t\t\tevents[indexLenKey] = (events[indexLenKey] || 0) + 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttypeIndex[contextId].push(event);\r\n\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[type] = events[type] || [];\r\n\t\t\t\t\tevents[type].push(event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\thasEventListeners: function (type) { // (String) -> Boolean\r\n\t\t\tvar events = this[eventsKey];\r\n\t\t\treturn !!events && ((type in events && events[type].length > 0) ||\r\n\t\t\t\t(type + '_idx' in events && events[type + '_idx_len'] > 0));\r\n\t\t},\r\n\r\n\t\tremoveEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])\r\n\r\n\t\t\tif (!this[eventsKey]) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif (!types) {\r\n\t\t\t\treturn this.clearAllEventListeners();\r\n\t\t\t}\r\n\r\n\t\t\tif (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\t\tvar events = this[eventsKey],\r\n\t\t\t\tcontextId = context && context !== this && L.stamp(context),\r\n\t\t\t\ti, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;\r\n\r\n\t\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\ttype = types[i];\r\n\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\ttypeIndex = events[indexKey];\r\n\r\n\t\t\t\tif (!fn) {\r\n\t\t\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\t\t\tdelete events[type];\r\n\t\t\t\t\tdelete events[indexKey];\r\n\t\t\t\t\tdelete events[indexLenKey];\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlisteners = contextId && typeIndex ? typeIndex[contextId] : events[type];\r\n\r\n\t\t\t\t\tif (listeners) {\r\n\t\t\t\t\t\tfor (j = listeners.length - 1; j >= 0; j--) {\r\n\t\t\t\t\t\t\tif ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {\r\n\t\t\t\t\t\t\t\tremoved = listeners.splice(j, 1);\r\n\t\t\t\t\t\t\t\t// set the old action to a no-op, because it is possible\r\n\t\t\t\t\t\t\t\t// that the listener is being iterated over as part of a dispatch\r\n\t\t\t\t\t\t\t\tremoved[0].action = L.Util.falseFn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (context && typeIndex && (listeners.length === 0)) {\r\n\t\t\t\t\t\t\tdelete typeIndex[contextId];\r\n\t\t\t\t\t\t\tevents[indexLenKey]--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tclearAllEventListeners: function () {\r\n\t\t\tdelete this[eventsKey];\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tfireEvent: function (type, data) { // (String[, Object])\r\n\t\t\tif (!this.hasEventListeners(type)) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tvar event = L.Util.extend({}, data, { type: type, target: this });\r\n\r\n\t\t\tvar events = this[eventsKey],\r\n\t\t\t\tlisteners, i, len, typeIndex, contextId;\r\n\r\n\t\t\tif (events[type]) {\r\n\t\t\t\t// make sure adding/removing listeners inside other listeners won't cause infinite loop\r\n\t\t\t\tlisteners = events[type].slice();\r\n\r\n\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// fire event for the context-indexed listeners as well\r\n\t\t\ttypeIndex = events[type + '_idx'];\r\n\r\n\t\t\tfor (contextId in typeIndex) {\r\n\t\t\t\tlisteners = typeIndex[contextId].slice();\r\n\r\n\t\t\t\tif (listeners) {\r\n\t\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddOneTimeEventListener: function (types, fn, context) {\r\n\r\n\t\t\tif (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\t\tvar handler = L.bind(function () {\r\n\t\t\t\tthis\r\n\t\t\t\t\t.removeEventListener(types, fn, context)\r\n\t\t\t\t\t.removeEventListener(types, handler, context);\r\n\t\t\t}, this);\r\n\r\n\t\t\treturn this\r\n\t\t\t\t.addEventListener(types, fn, context)\r\n\t\t\t\t.addEventListener(types, handler, context);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Mixin.Events.on = L.Mixin.Events.addEventListener;\r\n\tL.Mixin.Events.off = L.Mixin.Events.removeEventListener;\r\n\tL.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;\r\n\tL.Mixin.Events.fire = L.Mixin.Events.fireEvent;\r\n\r\n\r\n\t/*\r\n\t * L.Browser handles different browser and feature detections for internal Leaflet use.\r\n\t */\r\n\r\n\t(function () {\r\n\r\n\t\tvar ie = 'ActiveXObject' in window,\r\n\t\t\tielt9 = ie && !document.addEventListener,\r\n\r\n\t\t// terrible browser detection to work around Safari / iOS / Android browser bugs\r\n\t\t\tua = navigator.userAgent.toLowerCase(),\r\n\t\t\twebkit = ua.indexOf('webkit') !== -1,\r\n\t\t\tchrome = ua.indexOf('chrome') !== -1,\r\n\t\t\tphantomjs = ua.indexOf('phantom') !== -1,\r\n\t\t\tandroid = ua.indexOf('android') !== -1,\r\n\t\t\tandroid23 = ua.search('android [23]') !== -1,\r\n\t\t\tgecko = ua.indexOf('gecko') !== -1,\r\n\r\n\t\t\tmobile = typeof orientation !== undefined + '',\r\n\t\t\tmsPointer = window.navigator && window.navigator.msPointerEnabled &&\r\n\t\t\t\twindow.navigator.msMaxTouchPoints && !window.PointerEvent,\r\n\t\t\tpointer = (window.PointerEvent && window.navigator.pointerEnabled && window.navigator.maxTouchPoints) ||\r\n\t\t\t\tmsPointer,\r\n\t\t\tretina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||\r\n\t\t\t\t('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&\r\n\t\t\t\twindow.matchMedia('(min-resolution:144dpi)').matches),\r\n\r\n\t\t\tdoc = document.documentElement,\r\n\t\t\tie3d = ie && ('transition' in doc.style),\r\n\t\t\twebkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,\r\n\t\t\tgecko3d = 'MozPerspective' in doc.style,\r\n\t\t\topera3d = 'OTransition' in doc.style,\r\n\t\t\tany3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;\r\n\r\n\r\n\t\t// PhantomJS has 'ontouchstart' in document.documentElement, but doesn't actually support touch.\r\n\t\t// https://github.com/Leaflet/Leaflet/pull/1434#issuecomment-13843151\r\n\r\n\t\tvar touch = !window.L_NO_TOUCH && !phantomjs && (function () {\r\n\r\n\t\t\t\tvar startName = 'ontouchstart';\r\n\r\n\t\t\t\t// IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.Pointer) or WebKit, etc.\r\n\t\t\t\tif (pointer || (startName in doc)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Firefox/Gecko\r\n\t\t\t\tvar div = document.createElement('div'),\r\n\t\t\t\t\tsupported = false;\r\n\r\n\t\t\t\tif (!div.setAttribute) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tdiv.setAttribute(startName, 'return;');\r\n\r\n\t\t\t\tif (typeof div[startName] === 'function') {\r\n\t\t\t\t\tsupported = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdiv.removeAttribute(startName);\r\n\t\t\t\tdiv = null;\r\n\r\n\t\t\t\treturn supported;\r\n\t\t\t}());\r\n\r\n\r\n\t\tL.Browser = {\r\n\t\t\tie: ie,\r\n\t\t\tielt9: ielt9,\r\n\t\t\twebkit: webkit,\r\n\t\t\tgecko: gecko && !webkit && !window.opera && !ie,\r\n\r\n\t\t\tandroid: android,\r\n\t\t\tandroid23: android23,\r\n\r\n\t\t\tchrome: chrome,\r\n\r\n\t\t\tie3d: ie3d,\r\n\t\t\twebkit3d: webkit3d,\r\n\t\t\tgecko3d: gecko3d,\r\n\t\t\topera3d: opera3d,\r\n\t\t\tany3d: any3d,\r\n\r\n\t\t\tmobile: mobile,\r\n\t\t\tmobileWebkit: mobile && webkit,\r\n\t\t\tmobileWebkit3d: mobile && webkit3d,\r\n\t\t\tmobileOpera: mobile && window.opera,\r\n\r\n\t\t\ttouch: touch,\r\n\t\t\tmsPointer: msPointer,\r\n\t\t\tpointer: pointer,\r\n\r\n\t\t\tretina: retina\r\n\t\t};\r\n\r\n\t}());\r\n\r\n\r\n\t/*\r\n\t * L.Point represents a point with x and y coordinates.\r\n\t */\r\n\r\n\tL.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {\r\n\t\tthis.x = (round ? Math.round(x) : x);\r\n\t\tthis.y = (round ? Math.round(y) : y);\r\n\t};\r\n\r\n\tL.Point.prototype = {\r\n\r\n\t\tclone: function () {\r\n\t\t\treturn new L.Point(this.x, this.y);\r\n\t\t},\r\n\r\n\t\t// non-destructive, returns a new point\r\n\t\tadd: function (point) {\r\n\t\t\treturn this.clone()._add(L.point(point));\r\n\t\t},\r\n\r\n\t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t\t_add: function (point) {\r\n\t\t\tthis.x += point.x;\r\n\t\t\tthis.y += point.y;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsubtract: function (point) {\r\n\t\t\treturn this.clone()._subtract(L.point(point));\r\n\t\t},\r\n\r\n\t\t_subtract: function (point) {\r\n\t\t\tthis.x -= point.x;\r\n\t\t\tthis.y -= point.y;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tdivideBy: function (num) {\r\n\t\t\treturn this.clone()._divideBy(num);\r\n\t\t},\r\n\r\n\t\t_divideBy: function (num) {\r\n\t\t\tthis.x /= num;\r\n\t\t\tthis.y /= num;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tmultiplyBy: function (num) {\r\n\t\t\treturn this.clone()._multiplyBy(num);\r\n\t\t},\r\n\r\n\t\t_multiplyBy: function (num) {\r\n\t\t\tthis.x *= num;\r\n\t\t\tthis.y *= num;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tround: function () {\r\n\t\t\treturn this.clone()._round();\r\n\t\t},\r\n\r\n\t\t_round: function () {\r\n\t\t\tthis.x = Math.round(this.x);\r\n\t\t\tthis.y = Math.round(this.y);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tfloor: function () {\r\n\t\t\treturn this.clone()._floor();\r\n\t\t},\r\n\r\n\t\t_floor: function () {\r\n\t\t\tthis.x = Math.floor(this.x);\r\n\t\t\tthis.y = Math.floor(this.y);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tdistanceTo: function (point) {\r\n\t\t\tpoint = L.point(point);\r\n\r\n\t\t\tvar x = point.x - this.x,\r\n\t\t\t\ty = point.y - this.y;\r\n\r\n\t\t\treturn Math.sqrt(x * x + y * y);\r\n\t\t},\r\n\r\n\t\tequals: function (point) {\r\n\t\t\tpoint = L.point(point);\r\n\r\n\t\t\treturn point.x === this.x &&\r\n\t\t\t\tpoint.y === this.y;\r\n\t\t},\r\n\r\n\t\tcontains: function (point) {\r\n\t\t\tpoint = L.point(point);\r\n\r\n\t\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t\t\tMath.abs(point.y) <= Math.abs(this.y);\r\n\t\t},\r\n\r\n\t\ttoString: function () {\r\n\t\t\treturn 'Point(' +\r\n\t\t\t\tL.Util.formatNum(this.x) + ', ' +\r\n\t\t\t\tL.Util.formatNum(this.y) + ')';\r\n\t\t}\r\n\t};\r\n\r\n\tL.point = function (x, y, round) {\r\n\t\tif (x instanceof L.Point) {\r\n\t\t\treturn x;\r\n\t\t}\r\n\t\tif (L.Util.isArray(x)) {\r\n\t\t\treturn new L.Point(x[0], x[1]);\r\n\t\t}\r\n\t\tif (x === undefined || x === null) {\r\n\t\t\treturn x;\r\n\t\t}\r\n\t\treturn new L.Point(x, y, round);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Bounds represents a rectangular area on the screen in pixel coordinates.\r\n\t */\r\n\r\n\tL.Bounds = function (a, b) { //(Point, Point) or Point[]\r\n\t\tif (!a) { return; }\r\n\r\n\t\tvar points = b ? [a, b] : a;\r\n\r\n\t\tfor (var i = 0, len = points.length; i < len; i++) {\r\n\t\t\tthis.extend(points[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Bounds.prototype = {\r\n\t\t// extend the bounds to contain the given point\r\n\t\textend: function (point) { // (Point)\r\n\t\t\tpoint = L.point(point);\r\n\r\n\t\t\tif (!this.min && !this.max) {\r\n\t\t\t\tthis.min = point.clone();\r\n\t\t\t\tthis.max = point.clone();\r\n\t\t\t} else {\r\n\t\t\t\tthis.min.x = Math.min(point.x, this.min.x);\r\n\t\t\t\tthis.max.x = Math.max(point.x, this.max.x);\r\n\t\t\t\tthis.min.y = Math.min(point.y, this.min.y);\r\n\t\t\t\tthis.max.y = Math.max(point.y, this.max.y);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetCenter: function (round) { // (Boolean) -> Point\r\n\t\t\treturn new L.Point(\r\n\t\t\t\t(this.min.x + this.max.x) / 2,\r\n\t\t\t\t(this.min.y + this.max.y) / 2, round);\r\n\t\t},\r\n\r\n\t\tgetBottomLeft: function () { // -> Point\r\n\t\t\treturn new L.Point(this.min.x, this.max.y);\r\n\t\t},\r\n\r\n\t\tgetTopRight: function () { // -> Point\r\n\t\t\treturn new L.Point(this.max.x, this.min.y);\r\n\t\t},\r\n\r\n\t\tgetSize: function () {\r\n\t\t\treturn this.max.subtract(this.min);\r\n\t\t},\r\n\r\n\t\tcontains: function (obj) { // (Bounds) or (Point) -> Boolean\r\n\t\t\tvar min, max;\r\n\r\n\t\t\tif (typeof obj[0] === 'number' || obj instanceof L.Point) {\r\n\t\t\t\tobj = L.point(obj);\r\n\t\t\t} else {\r\n\t\t\t\tobj = L.bounds(obj);\r\n\t\t\t}\r\n\r\n\t\t\tif (obj instanceof L.Bounds) {\r\n\t\t\t\tmin = obj.min;\r\n\t\t\t\tmax = obj.max;\r\n\t\t\t} else {\r\n\t\t\t\tmin = max = obj;\r\n\t\t\t}\r\n\r\n\t\t\treturn (min.x >= this.min.x) &&\r\n\t\t\t\t(max.x <= this.max.x) &&\r\n\t\t\t\t(min.y >= this.min.y) &&\r\n\t\t\t\t(max.y <= this.max.y);\r\n\t\t},\r\n\r\n\t\tintersects: function (bounds) { // (Bounds) -> Boolean\r\n\t\t\tbounds = L.bounds(bounds);\r\n\r\n\t\t\tvar min = this.min,\r\n\t\t\t\tmax = this.max,\r\n\t\t\t\tmin2 = bounds.min,\r\n\t\t\t\tmax2 = bounds.max,\r\n\t\t\t\txIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n\t\t\t\tyIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n\t\t\treturn xIntersects && yIntersects;\r\n\t\t},\r\n\r\n\t\tisValid: function () {\r\n\t\t\treturn !!(this.min && this.max);\r\n\t\t}\r\n\t};\r\n\r\n\tL.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])\r\n\t\tif (!a || a instanceof L.Bounds) {\r\n\t\t\treturn a;\r\n\t\t}\r\n\t\treturn new L.Bounds(a, b);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.\r\n\t */\r\n\r\n\tL.Transformation = function (a, b, c, d) {\r\n\t\tthis._a = a;\r\n\t\tthis._b = b;\r\n\t\tthis._c = c;\r\n\t\tthis._d = d;\r\n\t};\r\n\r\n\tL.Transformation.prototype = {\r\n\t\ttransform: function (point, scale) { // (Point, Number) -> Point\r\n\t\t\treturn this._transform(point.clone(), scale);\r\n\t\t},\r\n\r\n\t\t// destructive transform (faster)\r\n\t\t_transform: function (point, scale) {\r\n\t\t\tscale = scale || 1;\r\n\t\t\tpoint.x = scale * (this._a * point.x + this._b);\r\n\t\t\tpoint.y = scale * (this._c * point.y + this._d);\r\n\t\t\treturn point;\r\n\t\t},\r\n\r\n\t\tuntransform: function (point, scale) {\r\n\t\t\tscale = scale || 1;\r\n\t\t\treturn new L.Point(\r\n\t\t\t\t(point.x / scale - this._b) / this._a,\r\n\t\t\t\t(point.y / scale - this._d) / this._c);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.DomUtil contains various utility functions for working with DOM.\r\n\t */\r\n\r\n\tL.DomUtil = {\r\n\t\tget: function (id) {\r\n\t\t\treturn (typeof id === 'string' ? document.getElementById(id) : id);\r\n\t\t},\r\n\r\n\t\tgetStyle: function (el, style) {\r\n\r\n\t\t\tvar value = el.style[style];\r\n\r\n\t\t\tif (!value && el.currentStyle) {\r\n\t\t\t\tvalue = el.currentStyle[style];\r\n\t\t\t}\r\n\r\n\t\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\t\tvalue = css ? css[style] : null;\r\n\t\t\t}\r\n\r\n\t\t\treturn value === 'auto' ? null : value;\r\n\t\t},\r\n\r\n\t\tgetViewportOffset: function (element) {\r\n\r\n\t\t\tvar top = 0,\r\n\t\t\t\tleft = 0,\r\n\t\t\t\tel = element,\r\n\t\t\t\tdocBody = document.body,\r\n\t\t\t\tdocEl = document.documentElement,\r\n\t\t\t\tpos;\r\n\r\n\t\t\tdo {\r\n\t\t\t\ttop  += el.offsetTop  || 0;\r\n\t\t\t\tleft += el.offsetLeft || 0;\r\n\r\n\t\t\t\t//add borders\r\n\t\t\t\ttop += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;\r\n\t\t\t\tleft += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;\r\n\r\n\t\t\t\tpos = L.DomUtil.getStyle(el, 'position');\r\n\r\n\t\t\t\tif (el.offsetParent === docBody && pos === 'absolute') { break; }\r\n\r\n\t\t\t\tif (pos === 'fixed') {\r\n\t\t\t\t\ttop  += docBody.scrollTop  || docEl.scrollTop  || 0;\r\n\t\t\t\t\tleft += docBody.scrollLeft || docEl.scrollLeft || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pos === 'relative' && !el.offsetLeft) {\r\n\t\t\t\t\tvar width = L.DomUtil.getStyle(el, 'width'),\r\n\t\t\t\t\t\tmaxWidth = L.DomUtil.getStyle(el, 'max-width'),\r\n\t\t\t\t\t\tr = el.getBoundingClientRect();\r\n\r\n\t\t\t\t\tif (width !== 'none' || maxWidth !== 'none') {\r\n\t\t\t\t\t\tleft += r.left + el.clientLeft;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//calculate full y offset since we're breaking out of the loop\r\n\t\t\t\t\ttop += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tel = el.offsetParent;\r\n\r\n\t\t\t} while (el);\r\n\r\n\t\t\tel = element;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tif (el === docBody) { break; }\r\n\r\n\t\t\t\ttop  -= el.scrollTop  || 0;\r\n\t\t\t\tleft -= el.scrollLeft || 0;\r\n\r\n\t\t\t\tel = el.parentNode;\r\n\t\t\t} while (el);\r\n\r\n\t\t\treturn new L.Point(left, top);\r\n\t\t},\r\n\r\n\t\tdocumentIsLtr: function () {\r\n\t\t\tif (!L.DomUtil._docIsLtrCached) {\r\n\t\t\t\tL.DomUtil._docIsLtrCached = true;\r\n\t\t\t\tL.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';\r\n\t\t\t}\r\n\t\t\treturn L.DomUtil._docIsLtr;\r\n\t\t},\r\n\r\n\t\tcreate: function (tagName, className, container) {\r\n\r\n\t\t\tvar el = document.createElement(tagName);\r\n\t\t\tel.className = className;\r\n\r\n\t\t\tif (container) {\r\n\t\t\t\tcontainer.appendChild(el);\r\n\t\t\t}\r\n\r\n\t\t\treturn el;\r\n\t\t},\r\n\r\n\t\thasClass: function (el, name) {\r\n\t\t\tif (el.classList !== undefined) {\r\n\t\t\t\treturn el.classList.contains(name);\r\n\t\t\t}\r\n\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t\t},\r\n\r\n\t\taddClass: function (el, name) {\r\n\t\t\tif (el.classList !== undefined) {\r\n\t\t\t\tvar classes = L.Util.splitWords(name);\r\n\t\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t\t}\r\n\t\t\t} else if (!L.DomUtil.hasClass(el, name)) {\r\n\t\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\t\tL.DomUtil._setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tremoveClass: function (el, name) {\r\n\t\t\tif (el.classList !== undefined) {\r\n\t\t\t\tel.classList.remove(name);\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_setClass: function (el, name) {\r\n\t\t\tif (el.className.baseVal === undefined) {\r\n\t\t\t\tel.className = name;\r\n\t\t\t} else {\r\n\t\t\t\t// in case of SVG element\r\n\t\t\t\tel.className.baseVal = name;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getClass: function (el) {\r\n\t\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t\t},\r\n\r\n\t\tsetOpacity: function (el, value) {\r\n\r\n\t\t\tif ('opacity' in el.style) {\r\n\t\t\t\tel.style.opacity = value;\r\n\r\n\t\t\t} else if ('filter' in el.style) {\r\n\r\n\t\t\t\tvar filter = false,\r\n\t\t\t\t\tfilterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\t\t\ttry {\r\n\t\t\t\t\tfilter = el.filters.item(filterName);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\t\t\tif (value === 1) { return; }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvalue = Math.round(value * 100);\r\n\r\n\t\t\t\tif (filter) {\r\n\t\t\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\t\t\tfilter.Opacity = value;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttestProp: function (props) {\r\n\r\n\t\t\tvar style = document.documentElement.style;\r\n\r\n\t\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\t\tif (props[i] in style) {\r\n\t\t\t\t\treturn props[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tgetTranslateString: function (point) {\r\n\t\t\t// on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate\r\n\t\t\t// makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care\r\n\t\t\t// (same speed either way), Opera 12 doesn't support translate3d\r\n\r\n\t\t\tvar is3d = L.Browser.webkit3d,\r\n\t\t\t\topen = 'translate' + (is3d ? '3d' : '') + '(',\r\n\t\t\t\tclose = (is3d ? ',0' : '') + ')';\r\n\r\n\t\t\treturn open + point.x + 'px,' + point.y + 'px' + close;\r\n\t\t},\r\n\r\n\t\tgetScaleString: function (scale, origin) {\r\n\r\n\t\t\tvar preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),\r\n\t\t\t\tscaleStr = ' scale(' + scale + ') ';\r\n\r\n\t\t\treturn preTranslateStr + scaleStr;\r\n\t\t},\r\n\r\n\t\tsetPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t\t// jshint camelcase: false\r\n\t\t\tel._leaflet_pos = point;\r\n\r\n\t\t\tif (!disable3D && L.Browser.any3d) {\r\n\t\t\t\tel.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);\r\n\t\t\t} else {\r\n\t\t\t\tel.style.left = point.x + 'px';\r\n\t\t\t\tel.style.top = point.y + 'px';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetPosition: function (el) {\r\n\t\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t\t// so it's safe to cache the position for performance\r\n\r\n\t\t\t// jshint camelcase: false\r\n\t\t\treturn el._leaflet_pos;\r\n\t\t}\r\n\t};\r\n\r\n\r\n// prefix style property names\r\n\r\n\tL.DomUtil.TRANSFORM = L.DomUtil.testProp(\r\n\t\t['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\n\tL.DomUtil.TRANSITION = L.DomUtil.testProp(\r\n\t\t['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\n\tL.DomUtil.TRANSITION_END =\r\n\t\tL.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?\r\n\t\tL.DomUtil.TRANSITION + 'End' : 'transitionend';\r\n\r\n\t(function () {\r\n\t\tif ('onselectstart' in document) {\r\n\t\t\tL.extend(L.DomUtil, {\r\n\t\t\t\tdisableTextSelection: function () {\r\n\t\t\t\t\tL.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tenableTextSelection: function () {\r\n\t\t\t\t\tL.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tvar userSelectProperty = L.DomUtil.testProp(\r\n\t\t\t\t['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n\t\t\tL.extend(L.DomUtil, {\r\n\t\t\t\tdisableTextSelection: function () {\r\n\t\t\t\t\tif (userSelectProperty) {\r\n\t\t\t\t\t\tvar style = document.documentElement.style;\r\n\t\t\t\t\t\tthis._userSelect = style[userSelectProperty];\r\n\t\t\t\t\t\tstyle[userSelectProperty] = 'none';\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tenableTextSelection: function () {\r\n\t\t\t\t\tif (userSelectProperty) {\r\n\t\t\t\t\t\tdocument.documentElement.style[userSelectProperty] = this._userSelect;\r\n\t\t\t\t\t\tdelete this._userSelect;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tL.extend(L.DomUtil, {\r\n\t\t\tdisableImageDrag: function () {\r\n\t\t\t\tL.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t\t},\r\n\r\n\t\t\tenableImageDrag: function () {\r\n\t\t\t\tL.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t\t}\r\n\t\t});\r\n\t})();\r\n\r\n\r\n\t/*\r\n\t * L.LatLng represents a geographical point with latitude and longitude coordinates.\r\n\t */\r\n\r\n\tL.LatLng = function (lat, lng, alt) { // (Number, Number, Number)\r\n\t\tlat = parseFloat(lat);\r\n\t\tlng = parseFloat(lng);\r\n\r\n\t\tif (isNaN(lat) || isNaN(lng)) {\r\n\t\t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n\t\t}\r\n\r\n\t\tthis.lat = lat;\r\n\t\tthis.lng = lng;\r\n\r\n\t\tif (alt !== undefined) {\r\n\t\t\tthis.alt = parseFloat(alt);\r\n\t\t}\r\n\t};\r\n\r\n\tL.extend(L.LatLng, {\r\n\t\tDEG_TO_RAD: Math.PI / 180,\r\n\t\tRAD_TO_DEG: 180 / Math.PI,\r\n\t\tMAX_MARGIN: 1.0E-9 // max margin of error for the \"equals\" check\r\n\t});\r\n\r\n\tL.LatLng.prototype = {\r\n\t\tequals: function (obj) { // (LatLng) -> Boolean\r\n\t\t\tif (!obj) { return false; }\r\n\r\n\t\t\tobj = L.latLng(obj);\r\n\r\n\t\t\tvar margin = Math.max(\r\n\t\t\t\tMath.abs(this.lat - obj.lat),\r\n\t\t\t\tMath.abs(this.lng - obj.lng));\r\n\r\n\t\t\treturn margin <= L.LatLng.MAX_MARGIN;\r\n\t\t},\r\n\r\n\t\ttoString: function (precision) { // (Number) -> String\r\n\t\t\treturn 'LatLng(' +\r\n\t\t\t\tL.Util.formatNum(this.lat, precision) + ', ' +\r\n\t\t\t\tL.Util.formatNum(this.lng, precision) + ')';\r\n\t\t},\r\n\r\n\t\t// Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula\r\n\t\t// TODO move to projection code, LatLng shouldn't know about Earth\r\n\t\tdistanceTo: function (other) { // (LatLng) -> Number\r\n\t\t\tother = L.latLng(other);\r\n\r\n\t\t\tvar R = 6378137, // earth radius in meters\r\n\t\t\t\td2r = L.LatLng.DEG_TO_RAD,\r\n\t\t\t\tdLat = (other.lat - this.lat) * d2r,\r\n\t\t\t\tdLon = (other.lng - this.lng) * d2r,\r\n\t\t\t\tlat1 = this.lat * d2r,\r\n\t\t\t\tlat2 = other.lat * d2r,\r\n\t\t\t\tsin1 = Math.sin(dLat / 2),\r\n\t\t\t\tsin2 = Math.sin(dLon / 2);\r\n\r\n\t\t\tvar a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);\r\n\r\n\t\t\treturn R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t\t},\r\n\r\n\t\twrap: function (a, b) { // (Number, Number) -> LatLng\r\n\t\t\tvar lng = this.lng;\r\n\r\n\t\t\ta = a || -180;\r\n\t\t\tb = b ||  180;\r\n\r\n\t\t\tlng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n\t\t\treturn new L.LatLng(this.lat, lng);\r\n\t\t}\r\n\t};\r\n\r\n\tL.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)\r\n\t\tif (a instanceof L.LatLng) {\r\n\t\t\treturn a;\r\n\t\t}\r\n\t\tif (L.Util.isArray(a)) {\r\n\t\t\tif (typeof a[0] === 'number' || typeof a[0] === 'string') {\r\n\t\t\t\treturn new L.LatLng(a[0], a[1], a[2]);\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (a === undefined || a === null) {\r\n\t\t\treturn a;\r\n\t\t}\r\n\t\tif (typeof a === 'object' && 'lat' in a) {\r\n\t\t\treturn new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);\r\n\t\t}\r\n\t\tif (b === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn new L.LatLng(a, b);\r\n\t};\r\n\r\n\r\n\r\n\t/*\r\n\t * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.\r\n\t */\r\n\r\n\tL.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])\r\n\t\tif (!southWest) { return; }\r\n\r\n\t\tvar latlngs = northEast ? [southWest, northEast] : southWest;\r\n\r\n\t\tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\tthis.extend(latlngs[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tL.LatLngBounds.prototype = {\r\n\t\t// extend the bounds to contain the given point or bounds\r\n\t\textend: function (obj) { // (LatLng) or (LatLngBounds)\r\n\t\t\tif (!obj) { return this; }\r\n\r\n\t\t\tvar latLng = L.latLng(obj);\r\n\t\t\tif (latLng !== null) {\r\n\t\t\t\tobj = latLng;\r\n\t\t\t} else {\r\n\t\t\t\tobj = L.latLngBounds(obj);\r\n\t\t\t}\r\n\r\n\t\t\tif (obj instanceof L.LatLng) {\r\n\t\t\t\tif (!this._southWest && !this._northEast) {\r\n\t\t\t\t\tthis._southWest = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\t\tthis._northEast = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._southWest.lat = Math.min(obj.lat, this._southWest.lat);\r\n\t\t\t\t\tthis._southWest.lng = Math.min(obj.lng, this._southWest.lng);\r\n\r\n\t\t\t\t\tthis._northEast.lat = Math.max(obj.lat, this._northEast.lat);\r\n\t\t\t\t\tthis._northEast.lng = Math.max(obj.lng, this._northEast.lng);\r\n\t\t\t\t}\r\n\t\t\t} else if (obj instanceof L.LatLngBounds) {\r\n\t\t\t\tthis.extend(obj._southWest);\r\n\t\t\t\tthis.extend(obj._northEast);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t// extend the bounds by a percentage\r\n\t\tpad: function (bufferRatio) { // (Number) -> LatLngBounds\r\n\t\t\tvar sw = this._southWest,\r\n\t\t\t\tne = this._northEast,\r\n\t\t\t\theightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n\t\t\t\twidthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n\t\t\treturn new L.LatLngBounds(\r\n\t\t\t\tnew L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n\t\t\t\tnew L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n\t\t},\r\n\r\n\t\tgetCenter: function () { // -> LatLng\r\n\t\t\treturn new L.LatLng(\r\n\t\t\t\t(this._southWest.lat + this._northEast.lat) / 2,\r\n\t\t\t\t(this._southWest.lng + this._northEast.lng) / 2);\r\n\t\t},\r\n\r\n\t\tgetSouthWest: function () {\r\n\t\t\treturn this._southWest;\r\n\t\t},\r\n\r\n\t\tgetNorthEast: function () {\r\n\t\t\treturn this._northEast;\r\n\t\t},\r\n\r\n\t\tgetNorthWest: function () {\r\n\t\t\treturn new L.LatLng(this.getNorth(), this.getWest());\r\n\t\t},\r\n\r\n\t\tgetSouthEast: function () {\r\n\t\t\treturn new L.LatLng(this.getSouth(), this.getEast());\r\n\t\t},\r\n\r\n\t\tgetWest: function () {\r\n\t\t\treturn this._southWest.lng;\r\n\t\t},\r\n\r\n\t\tgetSouth: function () {\r\n\t\t\treturn this._southWest.lat;\r\n\t\t},\r\n\r\n\t\tgetEast: function () {\r\n\t\t\treturn this._northEast.lng;\r\n\t\t},\r\n\r\n\t\tgetNorth: function () {\r\n\t\t\treturn this._northEast.lat;\r\n\t\t},\r\n\r\n\t\tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n\t\t\tif (typeof obj[0] === 'number' || obj instanceof L.LatLng) {\r\n\t\t\t\tobj = L.latLng(obj);\r\n\t\t\t} else {\r\n\t\t\t\tobj = L.latLngBounds(obj);\r\n\t\t\t}\r\n\r\n\t\t\tvar sw = this._southWest,\r\n\t\t\t\tne = this._northEast,\r\n\t\t\t\tsw2, ne2;\r\n\r\n\t\t\tif (obj instanceof L.LatLngBounds) {\r\n\t\t\t\tsw2 = obj.getSouthWest();\r\n\t\t\t\tne2 = obj.getNorthEast();\r\n\t\t\t} else {\r\n\t\t\t\tsw2 = ne2 = obj;\r\n\t\t\t}\r\n\r\n\t\t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n\t\t\t\t(sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n\t\t},\r\n\r\n\t\tintersects: function (bounds) { // (LatLngBounds)\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\t\tvar sw = this._southWest,\r\n\t\t\t\tne = this._northEast,\r\n\t\t\t\tsw2 = bounds.getSouthWest(),\r\n\t\t\t\tne2 = bounds.getNorthEast(),\r\n\r\n\t\t\t\tlatIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n\t\t\t\tlngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n\t\t\treturn latIntersects && lngIntersects;\r\n\t\t},\r\n\r\n\t\ttoBBoxString: function () {\r\n\t\t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n\t\t},\r\n\r\n\t\tequals: function (bounds) { // (LatLngBounds)\r\n\t\t\tif (!bounds) { return false; }\r\n\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\t\treturn this._southWest.equals(bounds.getSouthWest()) &&\r\n\t\t\t\tthis._northEast.equals(bounds.getNorthEast());\r\n\t\t},\r\n\r\n\t\tisValid: function () {\r\n\t\t\treturn !!(this._southWest && this._northEast);\r\n\t\t}\r\n\t};\r\n\r\n//TODO International date line?\r\n\r\n\tL.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)\r\n\t\tif (!a || a instanceof L.LatLngBounds) {\r\n\t\t\treturn a;\r\n\t\t}\r\n\t\treturn new L.LatLngBounds(a, b);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Projection contains various geographical projections used by CRS classes.\r\n\t */\r\n\r\n\tL.Projection = {};\r\n\r\n\r\n\t/*\r\n\t * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.\r\n\t */\r\n\r\n\tL.Projection.SphericalMercator = {\r\n\t\tMAX_LATITUDE: 85.0511287798,\r\n\r\n\t\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t\t\tmax = this.MAX_LATITUDE,\r\n\t\t\t\tlat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t\t\tx = latlng.lng * d,\r\n\t\t\t\ty = lat * d;\r\n\r\n\t\t\ty = Math.log(Math.tan((Math.PI / 4) + (y / 2)));\r\n\r\n\t\t\treturn new L.Point(x, y);\r\n\t\t},\r\n\r\n\t\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t\t\tlng = point.x * d,\r\n\t\t\t\tlat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;\r\n\r\n\t\t\treturn new L.LatLng(lat, lng);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.\r\n\t */\r\n\r\n\tL.Projection.LonLat = {\r\n\t\tproject: function (latlng) {\r\n\t\t\treturn new L.Point(latlng.lng, latlng.lat);\r\n\t\t},\r\n\r\n\t\tunproject: function (point) {\r\n\t\t\treturn new L.LatLng(point.y, point.x);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.\r\n\t */\r\n\r\n\tL.CRS = {\r\n\t\tlatLngToPoint: function (latlng, zoom) { // (LatLng, Number) -> Point\r\n\t\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t\t\tscale = this.scale(zoom);\r\n\r\n\t\t\treturn this.transformation._transform(projectedPoint, scale);\r\n\t\t},\r\n\r\n\t\tpointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) -> LatLng\r\n\t\t\tvar scale = this.scale(zoom),\r\n\t\t\t\tuntransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n\t\t\treturn this.projection.unproject(untransformedPoint);\r\n\t\t},\r\n\r\n\t\tproject: function (latlng) {\r\n\t\t\treturn this.projection.project(latlng);\r\n\t\t},\r\n\r\n\t\tscale: function (zoom) {\r\n\t\t\treturn 256 * Math.pow(2, zoom);\r\n\t\t},\r\n\r\n\t\tgetSize: function (zoom) {\r\n\t\t\tvar s = this.scale(zoom);\r\n\t\t\treturn L.point(s, s);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.\r\n\t */\r\n\r\n\tL.CRS.Simple = L.extend({}, L.CRS, {\r\n\t\tprojection: L.Projection.LonLat,\r\n\t\ttransformation: new L.Transformation(1, 0, -1, 0),\r\n\r\n\t\tscale: function (zoom) {\r\n\t\t\treturn Math.pow(2, zoom);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping\r\n\t * and is used by Leaflet by default.\r\n\t */\r\n\r\n\tL.CRS.EPSG3857 = L.extend({}, L.CRS, {\r\n\t\tcode: 'EPSG:3857',\r\n\r\n\t\tprojection: L.Projection.SphericalMercator,\r\n\t\ttransformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),\r\n\r\n\t\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t\t\tearthRadius = 6378137;\r\n\t\t\treturn projectedPoint.multiplyBy(earthRadius);\r\n\t\t}\r\n\t});\r\n\r\n\tL.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {\r\n\t\tcode: 'EPSG:900913'\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.\r\n\t */\r\n\r\n\tL.CRS.EPSG4326 = L.extend({}, L.CRS, {\r\n\t\tcode: 'EPSG:4326',\r\n\r\n\t\tprojection: L.Projection.LonLat,\r\n\t\ttransformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.Map is the central class of the API - it is used to create a map.\r\n\t */\r\n\r\n\tL.Map = L.Class.extend({\r\n\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\tcrs: L.CRS.EPSG3857,\r\n\r\n\t\t\t/*\r\n\t\t\t center: LatLng,\r\n\t\t\t zoom: Number,\r\n\t\t\t layers: Array,\r\n\t\t\t */\r\n\r\n\t\t\tfadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,\r\n\t\t\ttrackResize: true,\r\n\t\t\tmarkerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d\r\n\t\t},\r\n\r\n\t\tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n\t\t\toptions = L.setOptions(this, options);\r\n\r\n\r\n\t\t\tthis._initContainer(id);\r\n\t\t\tthis._initLayout();\r\n\r\n\t\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n\t\t\tthis._onResize = L.bind(this._onResize, this);\r\n\r\n\t\t\tthis._initEvents();\r\n\r\n\t\t\tif (options.maxBounds) {\r\n\t\t\t\tthis.setMaxBounds(options.maxBounds);\r\n\t\t\t}\r\n\r\n\t\t\tif (options.center && options.zoom !== undefined) {\r\n\t\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\r\n\t\t\t}\r\n\r\n\t\t\tthis._handlers = [];\r\n\r\n\t\t\tthis._layers = {};\r\n\t\t\tthis._zoomBoundLayers = {};\r\n\t\t\tthis._tileLayersNum = 0;\r\n\r\n\t\t\tthis.callInitHooks();\r\n\r\n\t\t\tthis._addLayers(options.layers);\r\n\t\t},\r\n\r\n\r\n\t\t// public methods that modify map state\r\n\r\n\t\t// replaced by animation-powered implementation in Map.PanAnimation.js\r\n\t\tsetView: function (center, zoom) {\r\n\t\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\r\n\t\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetZoom: function (zoom, options) {\r\n\t\t\tif (!this._loaded) {\r\n\t\t\t\tthis._zoom = this._limitZoom(zoom);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n\t\t},\r\n\r\n\t\tzoomIn: function (delta, options) {\r\n\t\t\treturn this.setZoom(this._zoom + (delta || 1), options);\r\n\t\t},\r\n\r\n\t\tzoomOut: function (delta, options) {\r\n\t\t\treturn this.setZoom(this._zoom - (delta || 1), options);\r\n\t\t},\r\n\r\n\t\tsetZoomAround: function (latlng, zoom, options) {\r\n\t\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t\t\tviewHalf = this.getSize().divideBy(2),\r\n\t\t\t\tcontainerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n\t\t\t\tcenterOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n\t\t\t\tnewCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n\t\t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n\t\t},\r\n\r\n\t\tfitBounds: function (bounds, options) {\r\n\r\n\t\t\toptions = options || {};\r\n\t\t\tbounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);\r\n\r\n\t\t\tvar paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),\r\n\t\t\t\tpaddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n\t\t\t\tzoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR)),\r\n\t\t\t\tpaddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n\t\t\t\tswPoint = this.project(bounds.getSouthWest(), zoom),\r\n\t\t\t\tnePoint = this.project(bounds.getNorthEast(), zoom),\r\n\t\t\t\tcenter = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n\t\t\tzoom = options && options.maxZoom ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n\t\t\treturn this.setView(center, zoom, options);\r\n\t\t},\r\n\r\n\t\tfitWorld: function (options) {\r\n\t\t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n\t\t},\r\n\r\n\t\tpanTo: function (center, options) { // (LatLng)\r\n\t\t\treturn this.setView(center, this._zoom, {pan: options});\r\n\t\t},\r\n\r\n\t\tpanBy: function (offset) { // (Point)\r\n\t\t\t// replaced with animated panBy in Map.PanAnimation.js\r\n\t\t\tthis.fire('movestart');\r\n\r\n\t\t\tthis._rawPanBy(L.point(offset));\r\n\r\n\t\t\tthis.fire('move');\r\n\t\t\treturn this.fire('moveend');\r\n\t\t},\r\n\r\n\t\tsetMaxBounds: function (bounds) {\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\t\tthis.options.maxBounds = bounds;\r\n\r\n\t\t\tif (!bounds) {\r\n\t\t\t\treturn this.off('moveend', this._panInsideMaxBounds, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tthis._panInsideMaxBounds();\r\n\t\t\t}\r\n\r\n\t\t\treturn this.on('moveend', this._panInsideMaxBounds, this);\r\n\t\t},\r\n\r\n\t\tpanInsideBounds: function (bounds, options) {\r\n\t\t\tvar center = this.getCenter(),\r\n\t\t\t\tnewCenter = this._limitCenter(center, this._zoom, bounds);\r\n\r\n\t\t\tif (center.equals(newCenter)) { return this; }\r\n\r\n\t\t\treturn this.panTo(newCenter, options);\r\n\t\t},\r\n\r\n\t\taddLayer: function (layer) {\r\n\t\t\t// TODO method is too big, refactor\r\n\r\n\t\t\tvar id = L.stamp(layer);\r\n\r\n\t\t\tif (this._layers[id]) { return this; }\r\n\r\n\t\t\tthis._layers[id] = layer;\r\n\r\n\t\t\t// TODO getMaxZoom, getMinZoom in ILayer (instead of options)\r\n\t\t\tif (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {\r\n\t\t\t\tthis._zoomBoundLayers[id] = layer;\r\n\t\t\t\tthis._updateZoomLevels();\r\n\t\t\t}\r\n\r\n\t\t\t// TODO looks ugly, refactor!!!\r\n\t\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\t\tthis._tileLayersNum++;\r\n\t\t\t\tthis._tileLayersToLoad++;\r\n\t\t\t\tlayer.on('load', this._onTileLayerLoad, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tthis._layerAdd(layer);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveLayer: function (layer) {\r\n\t\t\tvar id = L.stamp(layer);\r\n\r\n\t\t\tif (!this._layers[id]) { return this; }\r\n\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tlayer.onRemove(this);\r\n\t\t\t}\r\n\r\n\t\t\tdelete this._layers[id];\r\n\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tthis.fire('layerremove', {layer: layer});\r\n\t\t\t}\r\n\r\n\t\t\tif (this._zoomBoundLayers[id]) {\r\n\t\t\t\tdelete this._zoomBoundLayers[id];\r\n\t\t\t\tthis._updateZoomLevels();\r\n\t\t\t}\r\n\r\n\t\t\t// TODO looks ugly, refactor\r\n\t\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\t\tthis._tileLayersNum--;\r\n\t\t\t\tthis._tileLayersToLoad--;\r\n\t\t\t\tlayer.off('load', this._onTileLayerLoad, this);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\thasLayer: function (layer) {\r\n\t\t\tif (!layer) { return false; }\r\n\r\n\t\t\treturn (L.stamp(layer) in this._layers);\r\n\t\t},\r\n\r\n\t\teachLayer: function (method, context) {\r\n\t\t\tfor (var i in this._layers) {\r\n\t\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tinvalidateSize: function (options) {\r\n\t\t\tif (!this._loaded) { return this; }\r\n\r\n\t\t\toptions = L.extend({\r\n\t\t\t\tanimate: false,\r\n\t\t\t\tpan: true\r\n\t\t\t}, options === true ? {animate: true} : options);\r\n\r\n\t\t\tvar oldSize = this.getSize();\r\n\t\t\tthis._sizeChanged = true;\r\n\t\t\tthis._initialCenter = null;\r\n\r\n\t\t\tvar newSize = this.getSize(),\r\n\t\t\t\toldCenter = oldSize.divideBy(2).round(),\r\n\t\t\t\tnewCenter = newSize.divideBy(2).round(),\r\n\t\t\t\toffset = oldCenter.subtract(newCenter);\r\n\r\n\t\t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n\t\t\tif (options.animate && options.pan) {\r\n\t\t\t\tthis.panBy(offset);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif (options.pan) {\r\n\t\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.fire('move');\r\n\r\n\t\t\t\tif (options.debounceMoveend) {\r\n\t\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fire('moveend');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.fire('resize', {\r\n\t\t\t\toldSize: oldSize,\r\n\t\t\t\tnewSize: newSize\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// TODO handler.addTo\r\n\t\taddHandler: function (name, HandlerClass) {\r\n\t\t\tif (!HandlerClass) { return this; }\r\n\r\n\t\t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n\t\t\tthis._handlers.push(handler);\r\n\r\n\t\t\tif (this.options[name]) {\r\n\t\t\t\thandler.enable();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremove: function () {\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tthis.fire('unload');\r\n\t\t\t}\r\n\r\n\t\t\tthis._initEvents('off');\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// throws error in IE6-8\r\n\t\t\t\tdelete this._container._leaflet;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis._container._leaflet = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tthis._clearPanes();\r\n\t\t\tif (this._clearControlPos) {\r\n\t\t\t\tthis._clearControlPos();\r\n\t\t\t}\r\n\r\n\t\t\tthis._clearHandlers();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\r\n\t\t// public methods for getting map state\r\n\r\n\t\tgetCenter: function () { // (Boolean) -> LatLng\r\n\t\t\tthis._checkIfLoaded();\r\n\r\n\t\t\tif (this._initialCenter && !this._moved()) {\r\n\t\t\t\treturn this._initialCenter;\r\n\t\t\t}\r\n\t\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n\t\t},\r\n\r\n\t\tgetZoom: function () {\r\n\t\t\treturn this._zoom;\r\n\t\t},\r\n\r\n\t\tgetBounds: function () {\r\n\t\t\tvar bounds = this.getPixelBounds(),\r\n\t\t\t\tsw = this.unproject(bounds.getBottomLeft()),\r\n\t\t\t\tne = this.unproject(bounds.getTopRight());\r\n\r\n\t\t\treturn new L.LatLngBounds(sw, ne);\r\n\t\t},\r\n\r\n\t\tgetMinZoom: function () {\r\n\t\t\treturn this.options.minZoom === undefined ?\r\n\t\t\t\t(this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :\r\n\t\t\t\tthis.options.minZoom;\r\n\t\t},\r\n\r\n\t\tgetMaxZoom: function () {\r\n\t\t\treturn this.options.maxZoom === undefined ?\r\n\t\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n\t\t\t\tthis.options.maxZoom;\r\n\t\t},\r\n\r\n\t\tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\t\tvar zoom = this.getMinZoom() - (inside ? 1 : 0),\r\n\t\t\t\tmaxZoom = this.getMaxZoom(),\r\n\t\t\t\tsize = this.getSize(),\r\n\r\n\t\t\t\tnw = bounds.getNorthWest(),\r\n\t\t\t\tse = bounds.getSouthEast(),\r\n\r\n\t\t\t\tzoomNotFound = true,\r\n\t\t\t\tboundsSize;\r\n\r\n\t\t\tpadding = L.point(padding || [0, 0]);\r\n\r\n\t\t\tdo {\r\n\t\t\t\tzoom++;\r\n\t\t\t\tboundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);\r\n\t\t\t\tzoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x < size.x || boundsSize.y < size.y;\r\n\r\n\t\t\t} while (zoomNotFound && zoom <= maxZoom);\r\n\r\n\t\t\tif (zoomNotFound && inside) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn inside ? zoom : zoom - 1;\r\n\t\t},\r\n\r\n\t\tgetSize: function () {\r\n\t\t\tif (!this._size || this._sizeChanged) {\r\n\t\t\t\tthis._size = new L.Point(\r\n\t\t\t\t\tthis._container.clientWidth,\r\n\t\t\t\t\tthis._container.clientHeight);\r\n\r\n\t\t\t\tthis._sizeChanged = false;\r\n\t\t\t}\r\n\t\t\treturn this._size.clone();\r\n\t\t},\r\n\r\n\t\tgetPixelBounds: function () {\r\n\t\t\tvar topLeftPoint = this._getTopLeftPoint();\r\n\t\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n\t\t},\r\n\r\n\t\tgetPixelOrigin: function () {\r\n\t\t\tthis._checkIfLoaded();\r\n\t\t\treturn this._initialTopLeftPoint;\r\n\t\t},\r\n\r\n\t\tgetPanes: function () {\r\n\t\t\treturn this._panes;\r\n\t\t},\r\n\r\n\t\tgetContainer: function () {\r\n\t\t\treturn this._container;\r\n\t\t},\r\n\r\n\r\n\t\t// TODO replace with universal implementation after refactoring projections\r\n\r\n\t\tgetZoomScale: function (toZoom) {\r\n\t\t\tvar crs = this.options.crs;\r\n\t\t\treturn crs.scale(toZoom) / crs.scale(this._zoom);\r\n\t\t},\r\n\r\n\t\tgetScaleZoom: function (scale) {\r\n\t\t\treturn this._zoom + (Math.log(scale) / Math.LN2);\r\n\t\t},\r\n\r\n\r\n\t\t// conversion methods\r\n\r\n\t\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\r\n\t\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\t\treturn this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\r\n\t\t},\r\n\r\n\t\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\r\n\t\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\r\n\t\t},\r\n\r\n\t\tlayerPointToLatLng: function (point) { // (Point)\r\n\t\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\r\n\t\t\treturn this.unproject(projectedPoint);\r\n\t\t},\r\n\r\n\t\tlatLngToLayerPoint: function (latlng) { // (LatLng)\r\n\t\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\r\n\t\t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n\t\t},\r\n\r\n\t\tcontainerPointToLayerPoint: function (point) { // (Point)\r\n\t\t\treturn L.point(point).subtract(this._getMapPanePos());\r\n\t\t},\r\n\r\n\t\tlayerPointToContainerPoint: function (point) { // (Point)\r\n\t\t\treturn L.point(point).add(this._getMapPanePos());\r\n\t\t},\r\n\r\n\t\tcontainerPointToLatLng: function (point) {\r\n\t\t\tvar layerPoint = this.containerPointToLayerPoint(L.point(point));\r\n\t\t\treturn this.layerPointToLatLng(layerPoint);\r\n\t\t},\r\n\r\n\t\tlatLngToContainerPoint: function (latlng) {\r\n\t\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\r\n\t\t},\r\n\r\n\t\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\r\n\t\t\treturn L.DomEvent.getMousePosition(e, this._container);\r\n\t\t},\r\n\r\n\t\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\r\n\t\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n\t\t},\r\n\r\n\t\tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n\t\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n\t\t},\r\n\r\n\r\n\t\t// map initialization methods\r\n\r\n\t\t_initContainer: function (id) {\r\n\t\t\tvar container = this._container = L.DomUtil.get(id);\r\n\r\n\t\t\tif (!container) {\r\n\t\t\t\tthrow new Error('Map container not found.');\r\n\t\t\t} else if (container._leaflet) {\r\n\t\t\t\tthrow new Error('Map container is already initialized.');\r\n\t\t\t}\r\n\r\n\t\t\tcontainer._leaflet = true;\r\n\t\t},\r\n\r\n\t\t_initLayout: function () {\r\n\t\t\tvar container = this._container;\r\n\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-container' +\r\n\t\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\r\n\t\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\r\n\t\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n\t\t\t\t(this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));\r\n\r\n\t\t\tvar position = L.DomUtil.getStyle(container, 'position');\r\n\r\n\t\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\r\n\t\t\t\tcontainer.style.position = 'relative';\r\n\t\t\t}\r\n\r\n\t\t\tthis._initPanes();\r\n\r\n\t\t\tif (this._initControlPos) {\r\n\t\t\t\tthis._initControlPos();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_initPanes: function () {\r\n\t\t\tvar panes = this._panes = {};\r\n\r\n\t\t\tthis._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);\r\n\r\n\t\t\tthis._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);\r\n\t\t\tpanes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);\r\n\t\t\tpanes.shadowPane = this._createPane('leaflet-shadow-pane');\r\n\t\t\tpanes.overlayPane = this._createPane('leaflet-overlay-pane');\r\n\t\t\tpanes.markerPane = this._createPane('leaflet-marker-pane');\r\n\t\t\tpanes.popupPane = this._createPane('leaflet-popup-pane');\r\n\r\n\t\t\tvar zoomHide = ' leaflet-zoom-hide';\r\n\r\n\t\t\tif (!this.options.markerZoomAnimation) {\r\n\t\t\t\tL.DomUtil.addClass(panes.markerPane, zoomHide);\r\n\t\t\t\tL.DomUtil.addClass(panes.shadowPane, zoomHide);\r\n\t\t\t\tL.DomUtil.addClass(panes.popupPane, zoomHide);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_createPane: function (className, container) {\r\n\t\t\treturn L.DomUtil.create('div', className, container || this._panes.objectsPane);\r\n\t\t},\r\n\r\n\t\t_clearPanes: function () {\r\n\t\t\tthis._container.removeChild(this._mapPane);\r\n\t\t},\r\n\r\n\t\t_addLayers: function (layers) {\r\n\t\t\tlayers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];\r\n\r\n\t\t\tfor (var i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t// private methods that modify map state\r\n\r\n\t\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\r\n\r\n\t\t\tvar zoomChanged = (this._zoom !== zoom);\r\n\r\n\t\t\tif (!afterZoomAnim) {\r\n\t\t\t\tthis.fire('movestart');\r\n\r\n\t\t\t\tif (zoomChanged) {\r\n\t\t\t\t\tthis.fire('zoomstart');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._zoom = zoom;\r\n\t\t\tthis._initialCenter = center;\r\n\r\n\t\t\tthis._initialTopLeftPoint = this._getNewTopLeftPoint(center);\r\n\r\n\t\t\tif (!preserveMapOffset) {\r\n\t\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\r\n\t\t\t} else {\r\n\t\t\t\tthis._initialTopLeftPoint._add(this._getMapPanePos());\r\n\t\t\t}\r\n\r\n\t\t\tthis._tileLayersToLoad = this._tileLayersNum;\r\n\r\n\t\t\tvar loading = !this._loaded;\r\n\t\t\tthis._loaded = true;\r\n\r\n\t\t\tif (loading) {\r\n\t\t\t\tthis.fire('load');\r\n\t\t\t\tthis.eachLayer(this._layerAdd, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\r\n\r\n\t\t\tthis.fire('move');\r\n\r\n\t\t\tif (zoomChanged || afterZoomAnim) {\r\n\t\t\t\tthis.fire('zoomend');\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('moveend', {hard: !preserveMapOffset});\r\n\t\t},\r\n\r\n\t\t_rawPanBy: function (offset) {\r\n\t\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n\t\t},\r\n\r\n\t\t_getZoomSpan: function () {\r\n\t\t\treturn this.getMaxZoom() - this.getMinZoom();\r\n\t\t},\r\n\r\n\t\t_updateZoomLevels: function () {\r\n\t\t\tvar i,\r\n\t\t\t\tminZoom = Infinity,\r\n\t\t\t\tmaxZoom = -Infinity,\r\n\t\t\t\toldZoomSpan = this._getZoomSpan();\r\n\r\n\t\t\tfor (i in this._zoomBoundLayers) {\r\n\t\t\t\tvar layer = this._zoomBoundLayers[i];\r\n\t\t\t\tif (!isNaN(layer.options.minZoom)) {\r\n\t\t\t\t\tminZoom = Math.min(minZoom, layer.options.minZoom);\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(layer.options.maxZoom)) {\r\n\t\t\t\t\tmaxZoom = Math.max(maxZoom, layer.options.maxZoom);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (i === undefined) { // we have no tilelayers\r\n\t\t\t\tthis._layersMaxZoom = this._layersMinZoom = undefined;\r\n\t\t\t} else {\r\n\t\t\t\tthis._layersMaxZoom = maxZoom;\r\n\t\t\t\tthis._layersMinZoom = minZoom;\r\n\t\t\t}\r\n\r\n\t\t\tif (oldZoomSpan !== this._getZoomSpan()) {\r\n\t\t\t\tthis.fire('zoomlevelschange');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_panInsideMaxBounds: function () {\r\n\t\t\tthis.panInsideBounds(this.options.maxBounds);\r\n\t\t},\r\n\r\n\t\t_checkIfLoaded: function () {\r\n\t\t\tif (!this._loaded) {\r\n\t\t\t\tthrow new Error('Set map center and zoom first.');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// map events\r\n\r\n\t\t_initEvents: function (onOff) {\r\n\t\t\tif (!L.DomEvent) { return; }\r\n\r\n\t\t\tonOff = onOff || 'on';\r\n\r\n\t\t\tL.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\tvar events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',\r\n\t\t\t\t\t'mouseleave', 'mousemove', 'contextmenu'],\r\n\t\t\t\ti, len;\r\n\r\n\t\t\tfor (i = 0, len = events.length; i < len; i++) {\r\n\t\t\t\tL.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.trackResize) {\r\n\t\t\t\tL.DomEvent[onOff](window, 'resize', this._onResize, this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onResize: function () {\r\n\t\t\tL.Util.cancelAnimFrame(this._resizeRequest);\r\n\t\t\tthis._resizeRequest = L.Util.requestAnimFrame(\r\n\t\t\t\tfunction () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\r\n\t\t},\r\n\r\n\t\t_onMouseClick: function (e) {\r\n\t\t\tif (!this._loaded || (!e._simulated &&\r\n\t\t\t\t((this.dragging && this.dragging.moved()) ||\r\n\t\t\t\t(this.boxZoom  && this.boxZoom.moved()))) ||\r\n\t\t\t\tL.DomEvent._skipped(e)) { return; }\r\n\r\n\t\t\tthis.fire('preclick');\r\n\t\t\tthis._fireMouseEvent(e);\r\n\t\t},\r\n\r\n\t\t_fireMouseEvent: function (e) {\r\n\t\t\tif (!this._loaded || L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\t\tvar type = e.type;\r\n\r\n\t\t\ttype = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));\r\n\r\n\t\t\tif (!this.hasEventListeners(type)) { return; }\r\n\r\n\t\t\tif (type === 'contextmenu') {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t}\r\n\r\n\t\t\tvar containerPoint = this.mouseEventToContainerPoint(e),\r\n\t\t\t\tlayerPoint = this.containerPointToLayerPoint(containerPoint),\r\n\t\t\t\tlatlng = this.layerPointToLatLng(layerPoint);\r\n\r\n\t\t\tthis.fire(type, {\r\n\t\t\t\tlatlng: latlng,\r\n\t\t\t\tlayerPoint: layerPoint,\r\n\t\t\t\tcontainerPoint: containerPoint,\r\n\t\t\t\toriginalEvent: e\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onTileLayerLoad: function () {\r\n\t\t\tthis._tileLayersToLoad--;\r\n\t\t\tif (this._tileLayersNum && !this._tileLayersToLoad) {\r\n\t\t\t\tthis.fire('tilelayersload');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearHandlers: function () {\r\n\t\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n\t\t\t\tthis._handlers[i].disable();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\twhenReady: function (callback, context) {\r\n\t\t\tif (this._loaded) {\r\n\t\t\t\tcallback.call(context || this, this);\r\n\t\t\t} else {\r\n\t\t\t\tthis.on('load', callback, context);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_layerAdd: function (layer) {\r\n\t\t\tlayer.onAdd(this);\r\n\t\t\tthis.fire('layeradd', {layer: layer});\r\n\t\t},\r\n\r\n\r\n\t\t// private methods for getting map state\r\n\r\n\t\t_getMapPanePos: function () {\r\n\t\t\treturn L.DomUtil.getPosition(this._mapPane);\r\n\t\t},\r\n\r\n\t\t_moved: function () {\r\n\t\t\tvar pos = this._getMapPanePos();\r\n\t\t\treturn pos && !pos.equals([0, 0]);\r\n\t\t},\r\n\r\n\t\t_getTopLeftPoint: function () {\r\n\t\t\treturn this.getPixelOrigin().subtract(this._getMapPanePos());\r\n\t\t},\r\n\r\n\t\t_getNewTopLeftPoint: function (center, zoom) {\r\n\t\t\tvar viewHalf = this.getSize()._divideBy(2);\r\n\t\t\t// TODO round on display, not calculation to increase precision?\r\n\t\t\treturn this.project(center, zoom)._subtract(viewHalf)._round();\r\n\t\t},\r\n\r\n\t\t_latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {\r\n\t\t\tvar topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());\r\n\t\t\treturn this.project(latlng, newZoom)._subtract(topLeft);\r\n\t\t},\r\n\r\n\t\t// layer point of the current center\r\n\t\t_getCenterLayerPoint: function () {\r\n\t\t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n\t\t},\r\n\r\n\t\t// offset of the specified place to the current center in pixels\r\n\t\t_getCenterOffset: function (latlng) {\r\n\t\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n\t\t},\r\n\r\n\t\t// adjust center for view to get inside bounds\r\n\t\t_limitCenter: function (center, zoom, bounds) {\r\n\r\n\t\t\tif (!bounds) { return center; }\r\n\r\n\t\t\tvar centerPoint = this.project(center, zoom),\r\n\t\t\t\tviewHalf = this.getSize().divideBy(2),\r\n\t\t\t\tviewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n\t\t\t\toffset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n\t\t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n\t\t},\r\n\r\n\t\t// adjust offset for view to get inside bounds\r\n\t\t_limitOffset: function (offset, bounds) {\r\n\t\t\tif (!bounds) { return offset; }\r\n\r\n\t\t\tvar viewBounds = this.getPixelBounds(),\r\n\t\t\t\tnewBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n\t\t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n\t\t},\r\n\r\n\t\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n\t\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n\t\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\r\n\t\t\t\tseOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\r\n\r\n\t\t\t\tdx = this._rebound(nwOffset.x, -seOffset.x),\r\n\t\t\t\tdy = this._rebound(nwOffset.y, -seOffset.y);\r\n\r\n\t\t\treturn new L.Point(dx, dy);\r\n\t\t},\r\n\r\n\t\t_rebound: function (left, right) {\r\n\t\t\treturn left + right > 0 ?\r\n\t\t\tMath.round(left - right) / 2 :\r\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n\t\t},\r\n\r\n\t\t_limitZoom: function (zoom) {\r\n\t\t\tvar min = this.getMinZoom(),\r\n\t\t\t\tmax = this.getMaxZoom();\r\n\r\n\t\t\treturn Math.max(min, Math.min(max, zoom));\r\n\t\t}\r\n\t});\r\n\r\n\tL.map = function (id, options) {\r\n\t\treturn new L.Map(id, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * Mercator projection that takes into account that the Earth is not a perfect sphere.\r\n\t * Less popular than spherical mercator; used by projections like EPSG:3395.\r\n\t */\r\n\r\n\tL.Projection.Mercator = {\r\n\t\tMAX_LATITUDE: 85.0840591556,\r\n\r\n\t\tR_MINOR: 6356752.314245179,\r\n\t\tR_MAJOR: 6378137,\r\n\r\n\t\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t\t\tmax = this.MAX_LATITUDE,\r\n\t\t\t\tlat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t\t\tr = this.R_MAJOR,\r\n\t\t\t\tr2 = this.R_MINOR,\r\n\t\t\t\tx = latlng.lng * d * r,\r\n\t\t\t\ty = lat * d,\r\n\t\t\t\ttmp = r2 / r,\r\n\t\t\t\teccent = Math.sqrt(1.0 - tmp * tmp),\r\n\t\t\t\tcon = eccent * Math.sin(y);\r\n\r\n\t\t\tcon = Math.pow((1 - con) / (1 + con), eccent * 0.5);\r\n\r\n\t\t\tvar ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;\r\n\t\t\ty = -r * Math.log(ts);\r\n\r\n\t\t\treturn new L.Point(x, y);\r\n\t\t},\r\n\r\n\t\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t\t\tr = this.R_MAJOR,\r\n\t\t\t\tr2 = this.R_MINOR,\r\n\t\t\t\tlng = point.x * d / r,\r\n\t\t\t\ttmp = r2 / r,\r\n\t\t\t\teccent = Math.sqrt(1 - (tmp * tmp)),\r\n\t\t\t\tts = Math.exp(- point.y / r),\r\n\t\t\t\tphi = (Math.PI / 2) - 2 * Math.atan(ts),\r\n\t\t\t\tnumIter = 15,\r\n\t\t\t\ttol = 1e-7,\r\n\t\t\t\ti = numIter,\r\n\t\t\t\tdphi = 0.1,\r\n\t\t\t\tcon;\r\n\r\n\t\t\twhile ((Math.abs(dphi) > tol) && (--i > 0)) {\r\n\t\t\t\tcon = eccent * Math.sin(phi);\r\n\t\t\t\tdphi = (Math.PI / 2) - 2 * Math.atan(ts *\r\n\t\t\t\t\t\tMath.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;\r\n\t\t\t\tphi += dphi;\r\n\t\t\t}\r\n\r\n\t\t\treturn new L.LatLng(phi * d, lng);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\tL.CRS.EPSG3395 = L.extend({}, L.CRS, {\r\n\t\tcode: 'EPSG:3395',\r\n\r\n\t\tprojection: L.Projection.Mercator,\r\n\r\n\t\ttransformation: (function () {\r\n\t\t\tvar m = L.Projection.Mercator,\r\n\t\t\t\tr = m.R_MAJOR,\r\n\t\t\t\tscale = 0.5 / (Math.PI * r);\r\n\r\n\t\t\treturn new L.Transformation(scale, 0.5, -scale, 0.5);\r\n\t\t}())\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.TileLayer is used for standard xyz-numbered tile layers.\r\n\t */\r\n\r\n\tL.TileLayer = L.Class.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\tminZoom: 0,\r\n\t\t\tmaxZoom: 18,\r\n\t\t\ttileSize: 256,\r\n\t\t\tsubdomains: 'abc',\r\n\t\t\terrorTileUrl: '',\r\n\t\t\tattribution: '',\r\n\t\t\tzoomOffset: 0,\r\n\t\t\topacity: 1,\r\n\t\t\t/*\r\n\t\t\t maxNativeZoom: null,\r\n\t\t\t zIndex: null,\r\n\t\t\t tms: false,\r\n\t\t\t continuousWorld: false,\r\n\t\t\t noWrap: false,\r\n\t\t\t zoomReverse: false,\r\n\t\t\t detectRetina: false,\r\n\t\t\t reuseTiles: false,\r\n\t\t\t bounds: false,\r\n\t\t\t */\r\n\t\t\tunloadInvisibleTiles: L.Browser.mobile,\r\n\t\t\tupdateWhenIdle: L.Browser.mobile\r\n\t\t},\r\n\r\n\t\tinitialize: function (url, options) {\r\n\t\t\toptions = L.setOptions(this, options);\r\n\r\n\t\t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n\t\t\tif (options.detectRetina && L.Browser.retina && options.maxZoom > 0) {\r\n\r\n\t\t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\t\t\t\toptions.zoomOffset++;\r\n\r\n\t\t\t\tif (options.minZoom > 0) {\r\n\t\t\t\t\toptions.minZoom--;\r\n\t\t\t\t}\r\n\t\t\t\tthis.options.maxZoom--;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.bounds) {\r\n\t\t\t\toptions.bounds = L.latLngBounds(options.bounds);\r\n\t\t\t}\r\n\r\n\t\t\tthis._url = url;\r\n\r\n\t\t\tvar subdomains = this.options.subdomains;\r\n\r\n\t\t\tif (typeof subdomains === 'string') {\r\n\t\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\t\t\tthis._animated = map._zoomAnimated;\r\n\r\n\t\t\t// create a container div for tiles\r\n\t\t\tthis._initContainer();\r\n\r\n\t\t\t// set up events\r\n\t\t\tmap.on({\r\n\t\t\t\t'viewreset': this._reset,\r\n\t\t\t\t'moveend': this._update\r\n\t\t\t}, this);\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tmap.on({\r\n\t\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\r\n\t\t\t\tmap.on('move', this._limitedUpdate, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._reset();\r\n\t\t\tthis._update();\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tthis._container.parentNode.removeChild(this._container);\r\n\r\n\t\t\tmap.off({\r\n\t\t\t\t'viewreset': this._reset,\r\n\t\t\t\t'moveend': this._update\r\n\t\t\t}, this);\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tmap.off({\r\n\t\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\t\tmap.off('move', this._limitedUpdate, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._container = null;\r\n\t\t\tthis._map = null;\r\n\t\t},\r\n\r\n\t\tbringToFront: function () {\r\n\t\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\t\tif (this._container) {\r\n\t\t\t\tpane.appendChild(this._container);\r\n\t\t\t\tthis._setAutoZIndex(pane, Math.max);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tbringToBack: function () {\r\n\t\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\t\tif (this._container) {\r\n\t\t\t\tpane.insertBefore(this._container, pane.firstChild);\r\n\t\t\t\tthis._setAutoZIndex(pane, Math.min);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetAttribution: function () {\r\n\t\t\treturn this.options.attribution;\r\n\t\t},\r\n\r\n\t\tgetContainer: function () {\r\n\t\t\treturn this._container;\r\n\t\t},\r\n\r\n\t\tsetOpacity: function (opacity) {\r\n\t\t\tthis.options.opacity = opacity;\r\n\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetZIndex: function (zIndex) {\r\n\t\t\tthis.options.zIndex = zIndex;\r\n\t\t\tthis._updateZIndex();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetUrl: function (url, noRedraw) {\r\n\t\t\tthis._url = url;\r\n\r\n\t\t\tif (!noRedraw) {\r\n\t\t\t\tthis.redraw();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tredraw: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._reset({hard: true});\r\n\t\t\t\tthis._update();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_updateZIndex: function () {\r\n\t\t\tif (this._container && this.options.zIndex !== undefined) {\r\n\t\t\t\tthis._container.style.zIndex = this.options.zIndex;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_setAutoZIndex: function (pane, compare) {\r\n\r\n\t\t\tvar layers = pane.children,\r\n\t\t\t\tedgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min\r\n\t\t\t\tzIndex, i, len;\r\n\r\n\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\r\n\t\t\t\tif (layers[i] !== this._container) {\r\n\t\t\t\t\tzIndex = parseInt(layers[i].style.zIndex, 10);\r\n\r\n\t\t\t\t\tif (!isNaN(zIndex)) {\r\n\t\t\t\t\t\tedgeZIndex = compare(edgeZIndex, zIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.options.zIndex = this._container.style.zIndex =\r\n\t\t\t\t(isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);\r\n\t\t},\r\n\r\n\t\t_updateOpacity: function () {\r\n\t\t\tvar i,\r\n\t\t\t\ttiles = this._tiles;\r\n\r\n\t\t\tif (L.Browser.ielt9) {\r\n\t\t\t\tfor (i in tiles) {\r\n\t\t\t\t\tL.DomUtil.setOpacity(tiles[i], this.options.opacity);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.setOpacity(this._container, this.options.opacity);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_initContainer: function () {\r\n\t\t\tvar tilePane = this._map._panes.tilePane;\r\n\r\n\t\t\tif (!this._container) {\r\n\t\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-layer');\r\n\r\n\t\t\t\tthis._updateZIndex();\r\n\r\n\t\t\t\tif (this._animated) {\r\n\t\t\t\t\tvar className = 'leaflet-tile-container';\r\n\r\n\t\t\t\t\tthis._bgBuffer = L.DomUtil.create('div', className, this._container);\r\n\t\t\t\t\tthis._tileContainer = L.DomUtil.create('div', className, this._container);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._tileContainer = this._container;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttilePane.appendChild(this._container);\r\n\r\n\t\t\t\tif (this.options.opacity < 1) {\r\n\t\t\t\t\tthis._updateOpacity();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_reset: function (e) {\r\n\t\t\tfor (var key in this._tiles) {\r\n\t\t\t\tthis.fire('tileunload', {tile: this._tiles[key]});\r\n\t\t\t}\r\n\r\n\t\t\tthis._tiles = {};\r\n\t\t\tthis._tilesToLoad = 0;\r\n\r\n\t\t\tif (this.options.reuseTiles) {\r\n\t\t\t\tthis._unusedTiles = [];\r\n\t\t\t}\r\n\r\n\t\t\tthis._tileContainer.innerHTML = '';\r\n\r\n\t\t\tif (this._animated && e && e.hard) {\r\n\t\t\t\tthis._clearBgBuffer();\r\n\t\t\t}\r\n\r\n\t\t\tthis._initContainer();\r\n\t\t},\r\n\r\n\t\t_getTileSize: function () {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tzoom = map.getZoom() + this.options.zoomOffset,\r\n\t\t\t\tzoomN = this.options.maxNativeZoom,\r\n\t\t\t\ttileSize = this.options.tileSize;\r\n\r\n\t\t\tif (zoomN && zoom > zoomN) {\r\n\t\t\t\ttileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);\r\n\t\t\t}\r\n\r\n\t\t\treturn tileSize;\r\n\t\t},\r\n\r\n\t\t_update: function () {\r\n\r\n\t\t\tif (!this._map) { return; }\r\n\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tbounds = map.getPixelBounds(),\r\n\t\t\t\tzoom = map.getZoom(),\r\n\t\t\t\ttileSize = this._getTileSize();\r\n\r\n\t\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar tileBounds = L.bounds(\r\n\t\t\t\tbounds.min.divideBy(tileSize)._floor(),\r\n\t\t\t\tbounds.max.divideBy(tileSize)._floor());\r\n\r\n\t\t\tthis._addTilesFromCenterOut(tileBounds);\r\n\r\n\t\t\tif (this.options.unloadInvisibleTiles || this.options.reuseTiles) {\r\n\t\t\t\tthis._removeOtherTiles(tileBounds);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addTilesFromCenterOut: function (bounds) {\r\n\t\t\tvar queue = [],\r\n\t\t\t\tcenter = bounds.getCenter();\r\n\r\n\t\t\tvar j, i, point;\r\n\r\n\t\t\tfor (j = bounds.min.y; j <= bounds.max.y; j++) {\r\n\t\t\t\tfor (i = bounds.min.x; i <= bounds.max.x; i++) {\r\n\t\t\t\t\tpoint = new L.Point(i, j);\r\n\r\n\t\t\t\t\tif (this._tileShouldBeLoaded(point)) {\r\n\t\t\t\t\t\tqueue.push(point);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar tilesToLoad = queue.length;\r\n\r\n\t\t\tif (tilesToLoad === 0) { return; }\r\n\r\n\t\t\t// load tiles in order of their distance to center\r\n\t\t\tqueue.sort(function (a, b) {\r\n\t\t\t\treturn a.distanceTo(center) - b.distanceTo(center);\r\n\t\t\t});\r\n\r\n\t\t\tvar fragment = document.createDocumentFragment();\r\n\r\n\t\t\t// if its the first batch of tiles to load\r\n\t\t\tif (!this._tilesToLoad) {\r\n\t\t\t\tthis.fire('loading');\r\n\t\t\t}\r\n\r\n\t\t\tthis._tilesToLoad += tilesToLoad;\r\n\r\n\t\t\tfor (i = 0; i < tilesToLoad; i++) {\r\n\t\t\t\tthis._addTile(queue[i], fragment);\r\n\t\t\t}\r\n\r\n\t\t\tthis._tileContainer.appendChild(fragment);\r\n\t\t},\r\n\r\n\t\t_tileShouldBeLoaded: function (tilePoint) {\r\n\t\t\tif ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {\r\n\t\t\t\treturn false; // already loaded\r\n\t\t\t}\r\n\r\n\t\t\tvar options = this.options;\r\n\r\n\t\t\tif (!options.continuousWorld) {\r\n\t\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t\t// don't load if exceeds world bounds\r\n\t\t\t\tif ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||\r\n\t\t\t\t\ttilePoint.y < 0 || tilePoint.y >= limit.y) { return false; }\r\n\t\t\t}\r\n\r\n\t\t\tif (options.bounds) {\r\n\t\t\t\tvar tileSize = options.tileSize,\r\n\t\t\t\t\tnwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t\t\tsePoint = nwPoint.add([tileSize, tileSize]),\r\n\t\t\t\t\tnw = this._map.unproject(nwPoint),\r\n\t\t\t\t\tse = this._map.unproject(sePoint);\r\n\r\n\t\t\t\t// TODO temporary hack, will be removed after refactoring projections\r\n\t\t\t\t// https://github.com/Leaflet/Leaflet/issues/1618\r\n\t\t\t\tif (!options.continuousWorld && !options.noWrap) {\r\n\t\t\t\t\tnw = nw.wrap();\r\n\t\t\t\t\tse = se.wrap();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!options.bounds.intersects([nw, se])) { return false; }\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t_removeOtherTiles: function (bounds) {\r\n\t\t\tvar kArr, x, y, key;\r\n\r\n\t\t\tfor (key in this._tiles) {\r\n\t\t\t\tkArr = key.split(':');\r\n\t\t\t\tx = parseInt(kArr[0], 10);\r\n\t\t\t\ty = parseInt(kArr[1], 10);\r\n\r\n\t\t\t\t// remove tile if it's out of bounds\r\n\t\t\t\tif (x < bounds.min.x || x > bounds.max.x || y < bounds.min.y || y > bounds.max.y) {\r\n\t\t\t\t\tthis._removeTile(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_removeTile: function (key) {\r\n\t\t\tvar tile = this._tiles[key];\r\n\r\n\t\t\tthis.fire('tileunload', {tile: tile, url: tile.src});\r\n\r\n\t\t\tif (this.options.reuseTiles) {\r\n\t\t\t\tL.DomUtil.removeClass(tile, 'leaflet-tile-loaded');\r\n\t\t\t\tthis._unusedTiles.push(tile);\r\n\r\n\t\t\t} else if (tile.parentNode === this._tileContainer) {\r\n\t\t\t\tthis._tileContainer.removeChild(tile);\r\n\t\t\t}\r\n\r\n\t\t\t// for https://github.com/CloudMade/Leaflet/issues/137\r\n\t\t\tif (!L.Browser.android) {\r\n\t\t\t\ttile.onload = null;\r\n\t\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\t\t\t}\r\n\r\n\t\t\tdelete this._tiles[key];\r\n\t\t},\r\n\r\n\t\t_addTile: function (tilePoint, container) {\r\n\t\t\tvar tilePos = this._getTilePos(tilePoint);\r\n\r\n\t\t\t// get unused tile - or create a new tile\r\n\t\t\tvar tile = this._getTile();\r\n\r\n\t\t\t/*\r\n\t\t\t Chrome 20 layouts much faster with top/left (verify with timeline, frames)\r\n\t\t\t Android 4 browser has display issues with top/left and requires transform instead\r\n\t\t\t (other browsers don't currently care) - see debug/hacks/jitter.html for an example\r\n\t\t\t */\r\n\t\t\tL.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);\r\n\r\n\t\t\tthis._tiles[tilePoint.x + ':' + tilePoint.y] = tile;\r\n\r\n\t\t\tthis._loadTile(tile, tilePoint);\r\n\r\n\t\t\tif (tile.parentNode !== this._tileContainer) {\r\n\t\t\t\tcontainer.appendChild(tile);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getZoomForUrl: function () {\r\n\r\n\t\t\tvar options = this.options,\r\n\t\t\t\tzoom = this._map.getZoom();\r\n\r\n\t\t\tif (options.zoomReverse) {\r\n\t\t\t\tzoom = options.maxZoom - zoom;\r\n\t\t\t}\r\n\r\n\t\t\tzoom += options.zoomOffset;\r\n\r\n\t\t\treturn options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;\r\n\t\t},\r\n\r\n\t\t_getTilePos: function (tilePoint) {\r\n\t\t\tvar origin = this._map.getPixelOrigin(),\r\n\t\t\t\ttileSize = this._getTileSize();\r\n\r\n\t\t\treturn tilePoint.multiplyBy(tileSize).subtract(origin);\r\n\t\t},\r\n\r\n\t\t// image-specific code (override to implement e.g. Canvas or SVG tile layer)\r\n\r\n\t\tgetTileUrl: function (tilePoint) {\r\n\t\t\treturn L.Util.template(this._url, L.extend({\r\n\t\t\t\ts: this._getSubdomain(tilePoint),\r\n\t\t\t\tz: tilePoint.z,\r\n\t\t\t\tx: tilePoint.x,\r\n\t\t\t\ty: tilePoint.y\r\n\t\t\t}, this.options));\r\n\t\t},\r\n\r\n\t\t_getWrapTileNum: function () {\r\n\t\t\tvar crs = this._map.options.crs,\r\n\t\t\t\tsize = crs.getSize(this._map.getZoom());\r\n\t\t\treturn size.divideBy(this._getTileSize())._floor();\r\n\t\t},\r\n\r\n\t\t_adjustTilePoint: function (tilePoint) {\r\n\r\n\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t// wrap tile coordinates\r\n\t\t\tif (!this.options.continuousWorld && !this.options.noWrap) {\r\n\t\t\t\ttilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.tms) {\r\n\t\t\t\ttilePoint.y = limit.y - tilePoint.y - 1;\r\n\t\t\t}\r\n\r\n\t\t\ttilePoint.z = this._getZoomForUrl();\r\n\t\t},\r\n\r\n\t\t_getSubdomain: function (tilePoint) {\r\n\t\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n\t\t\treturn this.options.subdomains[index];\r\n\t\t},\r\n\r\n\t\t_getTile: function () {\r\n\t\t\tif (this.options.reuseTiles && this._unusedTiles.length > 0) {\r\n\t\t\t\tvar tile = this._unusedTiles.pop();\r\n\t\t\t\tthis._resetTile(tile);\r\n\t\t\t\treturn tile;\r\n\t\t\t}\r\n\t\t\treturn this._createTile();\r\n\t\t},\r\n\r\n\t\t// Override if data stored on a tile needs to be cleaned up before reuse\r\n\t\t_resetTile: function (/*tile*/) {},\r\n\r\n\t\t_createTile: function () {\r\n\t\t\tvar tile = L.DomUtil.create('img', 'leaflet-tile');\r\n\t\t\ttile.style.width = tile.style.height = this._getTileSize() + 'px';\r\n\t\t\ttile.galleryimg = 'no';\r\n\r\n\t\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\r\n\t\t\tif (L.Browser.ielt9 && this.options.opacity !== undefined) {\r\n\t\t\t\tL.DomUtil.setOpacity(tile, this.options.opacity);\r\n\t\t\t}\r\n\t\t\t// without this hack, tiles disappear after zoom on Chrome for Android\r\n\t\t\t// https://github.com/Leaflet/Leaflet/issues/2078\r\n\t\t\tif (L.Browser.mobileWebkit3d) {\r\n\t\t\t\ttile.style.WebkitBackfaceVisibility = 'hidden';\r\n\t\t\t}\r\n\t\t\treturn tile;\r\n\t\t},\r\n\r\n\t\t_loadTile: function (tile, tilePoint) {\r\n\t\t\ttile._layer  = this;\r\n\t\t\ttile.onload  = this._tileOnLoad;\r\n\t\t\ttile.onerror = this._tileOnError;\r\n\r\n\t\t\tthis._adjustTilePoint(tilePoint);\r\n\t\t\ttile.src     = this.getTileUrl(tilePoint);\r\n\r\n\t\t\tthis.fire('tileloadstart', {\r\n\t\t\t\ttile: tile,\r\n\t\t\t\turl: tile.src\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_tileLoaded: function () {\r\n\t\t\tthis._tilesToLoad--;\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tL.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._tilesToLoad) {\r\n\t\t\t\tthis.fire('load');\r\n\r\n\t\t\t\tif (this._animated) {\r\n\t\t\t\t\t// clear scaled tiles after all new tiles are loaded (for performance)\r\n\t\t\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t\t\t\tthis._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_tileOnLoad: function () {\r\n\t\t\tvar layer = this._layer;\r\n\r\n\t\t\t//Only if we are loading an actual image\r\n\t\t\tif (this.src !== L.Util.emptyImageUrl) {\r\n\t\t\t\tL.DomUtil.addClass(this, 'leaflet-tile-loaded');\r\n\r\n\t\t\t\tlayer.fire('tileload', {\r\n\t\t\t\t\ttile: this,\r\n\t\t\t\t\turl: this.src\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tlayer._tileLoaded();\r\n\t\t},\r\n\r\n\t\t_tileOnError: function () {\r\n\t\t\tvar layer = this._layer;\r\n\r\n\t\t\tlayer.fire('tileerror', {\r\n\t\t\t\ttile: this,\r\n\t\t\t\turl: this.src\r\n\t\t\t});\r\n\r\n\t\t\tvar newUrl = layer.options.errorTileUrl;\r\n\t\t\tif (newUrl) {\r\n\t\t\t\tthis.src = newUrl;\r\n\t\t\t}\r\n\r\n\t\t\tlayer._tileLoaded();\r\n\t\t}\r\n\t});\r\n\r\n\tL.tileLayer = function (url, options) {\r\n\t\treturn new L.TileLayer(url, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.TileLayer.WMS is used for putting WMS tile layers on the map.\r\n\t */\r\n\r\n\tL.TileLayer.WMS = L.TileLayer.extend({\r\n\r\n\t\tdefaultWmsParams: {\r\n\t\t\tservice: 'WMS',\r\n\t\t\trequest: 'GetMap',\r\n\t\t\tversion: '1.1.1',\r\n\t\t\tlayers: '',\r\n\t\t\tstyles: '',\r\n\t\t\tformat: 'image/jpeg',\r\n\t\t\ttransparent: false\r\n\t\t},\r\n\r\n\t\tinitialize: function (url, options) { // (String, Object)\r\n\r\n\t\t\tthis._url = url;\r\n\r\n\t\t\tvar wmsParams = L.extend({}, this.defaultWmsParams),\r\n\t\t\t\ttileSize = options.tileSize || this.options.tileSize;\r\n\r\n\t\t\tif (options.detectRetina && L.Browser.retina) {\r\n\t\t\t\twmsParams.width = wmsParams.height = tileSize * 2;\r\n\t\t\t} else {\r\n\t\t\t\twmsParams.width = wmsParams.height = tileSize;\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i in options) {\r\n\t\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\t\tif (!this.options.hasOwnProperty(i) && i !== 'crs') {\r\n\t\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\r\n\t\t\tthis._crs = this.options.crs || map.options.crs;\r\n\r\n\t\t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n\t\t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n\t\t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n\t\t\tL.TileLayer.prototype.onAdd.call(this, map);\r\n\t\t},\r\n\r\n\t\tgetTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n\t\t\tvar map = this._map,\r\n\t\t\t\ttileSize = this.options.tileSize,\r\n\r\n\t\t\t\tnwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t\tsePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t\t\tnw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n\t\t\t\tse = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n\t\t\t\tbbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n\t\t\t\t\t[se.y, nw.x, nw.y, se.x].join(',') :\r\n\t\t\t\t\t[nw.x, se.y, se.x, nw.y].join(','),\r\n\r\n\t\t\t\turl = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n\t\t\treturn url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\t\t},\r\n\r\n\t\tsetParams: function (params, noRedraw) {\r\n\r\n\t\t\tL.extend(this.wmsParams, params);\r\n\r\n\t\t\tif (!noRedraw) {\r\n\t\t\t\tthis.redraw();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\tL.tileLayer.wms = function (url, options) {\r\n\t\treturn new L.TileLayer.WMS(url, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.TileLayer.Canvas is a class that you can use as a base for creating\r\n\t * dynamically drawn Canvas-based tile layers.\r\n\t */\r\n\r\n\tL.TileLayer.Canvas = L.TileLayer.extend({\r\n\t\toptions: {\r\n\t\t\tasync: false\r\n\t\t},\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tredraw: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._reset({hard: true});\r\n\t\t\t\tthis._update();\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i in this._tiles) {\r\n\t\t\t\tthis._redrawTile(this._tiles[i]);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_redrawTile: function (tile) {\r\n\t\t\tthis.drawTile(tile, tile._tilePoint, this._map._zoom);\r\n\t\t},\r\n\r\n\t\t_createTile: function () {\r\n\t\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\t\ttile.width = tile.height = this.options.tileSize;\r\n\t\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\t\t\treturn tile;\r\n\t\t},\r\n\r\n\t\t_loadTile: function (tile, tilePoint) {\r\n\t\t\ttile._layer = this;\r\n\t\t\ttile._tilePoint = tilePoint;\r\n\r\n\t\t\tthis._redrawTile(tile);\r\n\r\n\t\t\tif (!this.options.async) {\r\n\t\t\t\tthis.tileDrawn(tile);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdrawTile: function (/*tile, tilePoint*/) {\r\n\t\t\t// override with rendering code\r\n\t\t},\r\n\r\n\t\ttileDrawn: function (tile) {\r\n\t\t\tthis._tileOnLoad.call(tile);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tL.tileLayer.canvas = function (options) {\r\n\t\treturn new L.TileLayer.Canvas(options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).\r\n\t */\r\n\r\n\tL.ImageOverlay = L.Class.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\topacity: 1\r\n\t\t},\r\n\r\n\t\tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n\t\t\tthis._url = url;\r\n\t\t\tthis._bounds = L.latLngBounds(bounds);\r\n\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tif (!this._image) {\r\n\t\t\t\tthis._initImage();\r\n\t\t\t}\r\n\r\n\t\t\tmap._panes.overlayPane.appendChild(this._image);\r\n\r\n\t\t\tmap.on('viewreset', this._reset, this);\r\n\r\n\t\t\tif (map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._reset();\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap.getPanes().overlayPane.removeChild(this._image);\r\n\r\n\t\t\tmap.off('viewreset', this._reset, this);\r\n\r\n\t\t\tif (map.options.zoomAnimation) {\r\n\t\t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetOpacity: function (opacity) {\r\n\t\t\tthis.options.opacity = opacity;\r\n\t\t\tthis._updateOpacity();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t// TODO remove bringToFront/bringToBack duplication from TileLayer/Path\r\n\t\tbringToFront: function () {\r\n\t\t\tif (this._image) {\r\n\t\t\t\tthis._map._panes.overlayPane.appendChild(this._image);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tbringToBack: function () {\r\n\t\t\tvar pane = this._map._panes.overlayPane;\r\n\t\t\tif (this._image) {\r\n\t\t\t\tpane.insertBefore(this._image, pane.firstChild);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetUrl: function (url) {\r\n\t\t\tthis._url = url;\r\n\t\t\tthis._image.src = this._url;\r\n\t\t},\r\n\r\n\t\tgetAttribution: function () {\r\n\t\t\treturn this.options.attribution;\r\n\t\t},\r\n\r\n\t\t_initImage: function () {\r\n\t\t\tthis._image = L.DomUtil.create('img', 'leaflet-image-layer');\r\n\r\n\t\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-animated');\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-hide');\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateOpacity();\r\n\r\n\t\t\t//TODO createImage util method to remove duplication\r\n\t\t\tL.extend(this._image, {\r\n\t\t\t\tgalleryimg: 'no',\r\n\t\t\t\tonselectstart: L.Util.falseFn,\r\n\t\t\t\tonmousemove: L.Util.falseFn,\r\n\t\t\t\tonload: L.bind(this._onImageLoad, this),\r\n\t\t\t\tsrc: this._url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_animateZoom: function (e) {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\timage = this._image,\r\n\t\t\t\tscale = map.getZoomScale(e.zoom),\r\n\t\t\t\tnw = this._bounds.getNorthWest(),\r\n\t\t\t\tse = this._bounds.getSouthEast(),\r\n\r\n\t\t\t\ttopLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),\r\n\t\t\t\tsize = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),\r\n\t\t\t\torigin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));\r\n\r\n\t\t\timage.style[L.DomUtil.TRANSFORM] =\r\n\t\t\t\tL.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';\r\n\t\t},\r\n\r\n\t\t_reset: function () {\r\n\t\t\tvar image   = this._image,\r\n\t\t\t\ttopLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n\t\t\t\tsize = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);\r\n\r\n\t\t\tL.DomUtil.setPosition(image, topLeft);\r\n\r\n\t\t\timage.style.width  = size.x + 'px';\r\n\t\t\timage.style.height = size.y + 'px';\r\n\t\t},\r\n\r\n\t\t_onImageLoad: function () {\r\n\t\t\tthis.fire('load');\r\n\t\t},\r\n\r\n\t\t_updateOpacity: function () {\r\n\t\t\tL.DomUtil.setOpacity(this._image, this.options.opacity);\r\n\t\t}\r\n\t});\r\n\r\n\tL.imageOverlay = function (url, bounds, options) {\r\n\t\treturn new L.ImageOverlay(url, bounds, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.\r\n\t */\r\n\r\n\tL.Icon = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\t/*\r\n\t\t\t iconUrl: (String) (required)\r\n\t\t\t iconRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\t\t iconSize: (Point) (can be set through CSS)\r\n\t\t\t iconAnchor: (Point) (centered by default, can be set in CSS with negative margins)\r\n\t\t\t popupAnchor: (Point) (if not specified, popup opens in the anchor point)\r\n\t\t\t shadowUrl: (String) (no shadow by default)\r\n\t\t\t shadowRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\t\t shadowSize: (Point)\r\n\t\t\t shadowAnchor: (Point)\r\n\t\t\t */\r\n\t\t\tclassName: ''\r\n\t\t},\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tcreateIcon: function (oldIcon) {\r\n\t\t\treturn this._createIcon('icon', oldIcon);\r\n\t\t},\r\n\r\n\t\tcreateShadow: function (oldIcon) {\r\n\t\t\treturn this._createIcon('shadow', oldIcon);\r\n\t\t},\r\n\r\n\t\t_createIcon: function (name, oldIcon) {\r\n\t\t\tvar src = this._getIconUrl(name);\r\n\r\n\t\t\tif (!src) {\r\n\t\t\t\tif (name === 'icon') {\r\n\t\t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar img;\r\n\t\t\tif (!oldIcon || oldIcon.tagName !== 'IMG') {\r\n\t\t\t\timg = this._createImg(src);\r\n\t\t\t} else {\r\n\t\t\t\timg = this._createImg(src, oldIcon);\r\n\t\t\t}\r\n\t\t\tthis._setIconStyles(img, name);\r\n\r\n\t\t\treturn img;\r\n\t\t},\r\n\r\n\t\t_setIconStyles: function (img, name) {\r\n\t\t\tvar options = this.options,\r\n\t\t\t\tsize = L.point(options[name + 'Size']),\r\n\t\t\t\tanchor;\r\n\r\n\t\t\tif (name === 'shadow') {\r\n\t\t\t\tanchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n\t\t\t} else {\r\n\t\t\t\tanchor = L.point(options.iconAnchor);\r\n\t\t\t}\r\n\r\n\t\t\tif (!anchor && size) {\r\n\t\t\t\tanchor = size.divideBy(2, true);\r\n\t\t\t}\r\n\r\n\t\t\timg.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n\t\t\tif (anchor) {\r\n\t\t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n\t\t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tif (size) {\r\n\t\t\t\timg.style.width  = size.x + 'px';\r\n\t\t\t\timg.style.height = size.y + 'px';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_createImg: function (src, el) {\r\n\t\t\tel = el || document.createElement('img');\r\n\t\t\tel.src = src;\r\n\t\t\treturn el;\r\n\t\t},\r\n\r\n\t\t_getIconUrl: function (name) {\r\n\t\t\tif (L.Browser.retina && this.options[name + 'RetinaUrl']) {\r\n\t\t\t\treturn this.options[name + 'RetinaUrl'];\r\n\t\t\t}\r\n\t\t\treturn this.options[name + 'Url'];\r\n\t\t}\r\n\t});\r\n\r\n\tL.icon = function (options) {\r\n\t\treturn new L.Icon(options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Icon.Default is the blue marker icon used by default in Leaflet.\r\n\t */\r\n\r\n\tL.Icon.Default = L.Icon.extend({\r\n\r\n\t\toptions: {\r\n\t\t\ticonSize: [25, 41],\r\n\t\t\ticonAnchor: [12, 41],\r\n\t\t\tpopupAnchor: [1, -34],\r\n\r\n\t\t\tshadowSize: [41, 41]\r\n\t\t},\r\n\r\n\t\t_getIconUrl: function (name) {\r\n\t\t\tvar key = name + 'Url';\r\n\r\n\t\t\tif (this.options[key]) {\r\n\t\t\t\treturn this.options[key];\r\n\t\t\t}\r\n\r\n\t\t\tif (L.Browser.retina && name === 'icon') {\r\n\t\t\t\tname += '-2x';\r\n\t\t\t}\r\n\r\n\t\t\tvar path = L.Icon.Default.imagePath;\r\n\r\n\t\t\tif (!path) {\r\n\t\t\t\tthrow new Error('Couldn\\'t autodetect L.Icon.Default.imagePath, set it manually.');\r\n\t\t\t}\r\n\r\n\t\t\treturn path + '/marker-' + name + '.png';\r\n\t\t}\r\n\t});\r\n\r\n\tL.Icon.Default.imagePath = (function () {\r\n\t\tvar scripts = document.getElementsByTagName('script'),\r\n\t\t\tleafletRe = /[\\/^]BZ[\\-\\._]?([\\w\\-\\._]*)\\.js\\??/;\r\n\r\n\t\tvar i, len, src, matches, path;\r\n\r\n\t\tfor (i = 0, len = scripts.length; i < len; i++) {\r\n\t\t\tsrc = scripts[i].src;\r\n\t\t\tmatches = src.match(leafletRe);\r\n\r\n\t\t\tif (matches) {\r\n\t\t\t\tpath = src.split(leafletRe)[0];\r\n\t\t\t\treturn (path ? path + '/' : '') + 'images';\r\n\t\t\t}\r\n\t\t}\r\n\t}());\r\n\r\n\r\n\t/*\r\n\t * L.Marker is used to display clickable/draggable icons on the map.\r\n\t */\r\n\r\n\tL.Marker = L.Class.extend({\r\n\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\ticon: new L.Icon.Default(),\r\n\t\t\ttitle: '',\r\n\t\t\talt: '',\r\n\t\t\tclickable: true,\r\n\t\t\tdraggable: false,\r\n\t\t\tkeyboard: true,\r\n\t\t\tzIndexOffset: 0,\r\n\t\t\topacity: 1,\r\n\t\t\triseOnHover: false,\r\n\t\t\triseOffset: 250\r\n\t\t},\r\n\r\n\t\tinitialize: function (latlng, options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t\tthis._latlng = L.latLng(latlng);\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tmap.on('viewreset', this.update, this);\r\n\r\n\t\t\tthis._initIcon();\r\n\t\t\tthis.update();\r\n\t\t\tthis.fire('add');\r\n\r\n\t\t\tif (map.options.zoomAnimation && map.options.markerZoomAnimation) {\r\n\t\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tif (this.dragging) {\r\n\t\t\t\tthis.dragging.disable();\r\n\t\t\t}\r\n\r\n\t\t\tthis._removeIcon();\r\n\t\t\tthis._removeShadow();\r\n\r\n\t\t\tthis.fire('remove');\r\n\r\n\t\t\tmap.off({\r\n\t\t\t\t'viewreset': this.update,\r\n\t\t\t\t'zoomanim': this._animateZoom\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._map = null;\r\n\t\t},\r\n\r\n\t\tgetLatLng: function () {\r\n\t\t\treturn this._latlng;\r\n\t\t},\r\n\r\n\t\tsetLatLng: function (latlng) {\r\n\t\t\tthis._latlng = L.latLng(latlng);\r\n\r\n\t\t\tthis.update();\r\n\r\n\t\t\treturn this.fire('move', { latlng: this._latlng });\r\n\t\t},\r\n\r\n\t\tsetZIndexOffset: function (offset) {\r\n\t\t\tthis.options.zIndexOffset = offset;\r\n\t\t\tthis.update();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetIcon: function (icon) {\r\n\r\n\t\t\tthis.options.icon = icon;\r\n\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._initIcon();\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis.bindPopup(this._popup);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tupdate: function () {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\t\t\t\tthis._setPos(pos);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_initIcon: function () {\r\n\t\t\tvar options = this.options,\r\n\t\t\t\tmap = this._map,\r\n\t\t\t\tanimation = (map.options.zoomAnimation && map.options.markerZoomAnimation),\r\n\t\t\t\tclassToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';\r\n\r\n\t\t\tvar icon = options.icon.createIcon(this._icon),\r\n\t\t\t\taddIcon = false;\r\n\r\n\t\t\t// if we're not reusing the icon, remove the old one and init new one\r\n\t\t\tif (icon !== this._icon) {\r\n\t\t\t\tif (this._icon) {\r\n\t\t\t\t\tthis._removeIcon();\r\n\t\t\t\t}\r\n\t\t\t\taddIcon = true;\r\n\r\n\t\t\t\tif (options.title) {\r\n\t\t\t\t\ticon.title = options.title;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (options.alt) {\r\n\t\t\t\t\ticon.alt = options.alt;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tL.DomUtil.addClass(icon, classToAdd);\r\n\r\n\t\t\tif (options.keyboard) {\r\n\t\t\t\ticon.tabIndex = '0';\r\n\t\t\t}\r\n\r\n\t\t\tthis._icon = icon;\r\n\r\n\t\t\tthis._initInteraction();\r\n\r\n\t\t\tif (options.riseOnHover) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t\t.on(icon, 'mouseover', this._bringToFront, this)\r\n\t\t\t\t\t.on(icon, 'mouseout', this._resetZIndex, this);\r\n\t\t\t}\r\n\r\n\t\t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n\t\t\t\taddShadow = false;\r\n\r\n\t\t\tif (newShadow !== this._shadow) {\r\n\t\t\t\tthis._removeShadow();\r\n\t\t\t\taddShadow = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (newShadow) {\r\n\t\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\r\n\t\t\t}\r\n\t\t\tthis._shadow = newShadow;\r\n\r\n\r\n\t\t\tif (options.opacity < 1) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar panes = this._map._panes;\r\n\r\n\t\t\tif (addIcon) {\r\n\t\t\t\tpanes.markerPane.appendChild(this._icon);\r\n\t\t\t}\r\n\r\n\t\t\tif (newShadow && addShadow) {\r\n\t\t\t\tpanes.shadowPane.appendChild(this._shadow);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_removeIcon: function () {\r\n\t\t\tif (this.options.riseOnHover) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t\t.off(this._icon, 'mouseover', this._bringToFront)\r\n\t\t\t\t\t.off(this._icon, 'mouseout', this._resetZIndex);\r\n\t\t\t}\r\n\r\n\t\t\tthis._map._panes.markerPane.removeChild(this._icon);\r\n\r\n\t\t\tthis._icon = null;\r\n\t\t},\r\n\r\n\t\t_removeShadow: function () {\r\n\t\t\tif (this._shadow) {\r\n\t\t\t\tthis._map._panes.shadowPane.removeChild(this._shadow);\r\n\t\t\t}\r\n\t\t\tthis._shadow = null;\r\n\t\t},\r\n\r\n\t\t_setPos: function (pos) {\r\n\t\t\tL.DomUtil.setPosition(this._icon, pos);\r\n\r\n\t\t\tif (this._shadow) {\r\n\t\t\t\tL.DomUtil.setPosition(this._shadow, pos);\r\n\t\t\t}\r\n\r\n\t\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n\t\t\tthis._resetZIndex();\r\n\t\t},\r\n\r\n\t\t_updateZIndex: function (offset) {\r\n\t\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n\t\t},\r\n\r\n\t\t_animateZoom: function (opt) {\r\n\t\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\t\tthis._setPos(pos);\r\n\t\t},\r\n\r\n\t\t_initInteraction: function () {\r\n\r\n\t\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n\t\t\tvar icon = this._icon,\r\n\t\t\t\tevents = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\r\n\t\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n\t\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\r\n\t\t\tif (L.Handler.MarkerDrag) {\r\n\t\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n\t\t\t\tif (this.options.draggable) {\r\n\t\t\t\t\tthis.dragging.enable();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onMouseClick: function (e) {\r\n\t\t\tvar wasDragged = this.dragging && this.dragging.moved();\r\n\r\n\t\t\tif (this.hasEventListeners(e.type) || wasDragged) {\r\n\t\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t\t}\r\n\r\n\t\t\tif (wasDragged) { return; }\r\n\r\n\t\t\tif ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\t\tthis.fire(e.type, {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onKeyPress: function (e) {\r\n\t\t\tif (e.keyCode === 13) {\r\n\t\t\t\tthis.fire('click', {\r\n\t\t\t\t\toriginalEvent: e,\r\n\t\t\t\t\tlatlng: this._latlng\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fireMouseEvent: function (e) {\r\n\r\n\t\t\tthis.fire(e.type, {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\r\n\t\t\t// TODO proper custom event propagation\r\n\t\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t}\r\n\t\t\tif (e.type !== 'mousedown') {\r\n\t\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t\t} else {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetOpacity: function (opacity) {\r\n\t\t\tthis.options.opacity = opacity;\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_updateOpacity: function () {\r\n\t\t\tL.DomUtil.setOpacity(this._icon, this.options.opacity);\r\n\t\t\tif (this._shadow) {\r\n\t\t\t\tL.DomUtil.setOpacity(this._shadow, this.options.opacity);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_bringToFront: function () {\r\n\t\t\tthis._updateZIndex(this.options.riseOffset);\r\n\t\t},\r\n\r\n\t\t_resetZIndex: function () {\r\n\t\t\tthis._updateZIndex(0);\r\n\t\t}\r\n\t});\r\n\r\n\tL.marker = function (latlng, options) {\r\n\t\treturn new L.Marker(latlng, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)\r\n\t * to use with L.Marker.\r\n\t */\r\n\r\n\tL.DivIcon = L.Icon.extend({\r\n\t\toptions: {\r\n\t\t\ticonSize: [12, 12], // also can be set through CSS\r\n\t\t\t/*\r\n\t\t\t iconAnchor: (Point)\r\n\t\t\t popupAnchor: (Point)\r\n\t\t\t html: (String)\r\n\t\t\t bgPos: (Point)\r\n\t\t\t */\r\n\t\t\tclassName: 'leaflet-div-icon',\r\n\t\t\thtml: false\r\n\t\t},\r\n\r\n\t\tcreateIcon: function (oldIcon) {\r\n\t\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\r\n\t\t\t\toptions = this.options;\r\n\r\n\t\t\tif (options.html !== false) {\r\n\t\t\t\tdiv.innerHTML = options.html;\r\n\t\t\t} else {\r\n\t\t\t\tdiv.innerHTML = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (options.bgPos) {\r\n\t\t\t\tdiv.style.backgroundPosition =\r\n\t\t\t\t\t(-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tthis._setIconStyles(div, 'icon');\r\n\t\t\treturn div;\r\n\t\t},\r\n\r\n\t\tcreateShadow: function () {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t});\r\n\r\n\tL.divIcon = function (options) {\r\n\t\treturn new L.DivIcon(options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Popup is used for displaying popups on the map.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tclosePopupOnClick: true\r\n\t});\r\n\r\n\tL.Popup = L.Class.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\tminWidth: 50,\r\n\t\t\tmaxWidth: 300,\r\n\t\t\t// maxHeight: null,\r\n\t\t\tautoPan: true,\r\n\t\t\tcloseButton: true,\r\n\t\t\toffset: [0, 7],\r\n\t\t\tautoPanPadding: [5, 5],\r\n\t\t\t// autoPanPaddingTopLeft: null,\r\n\t\t\t// autoPanPaddingBottomRight: null,\r\n\t\t\tkeepInView: false,\r\n\t\t\tclassName: '',\r\n\t\t\tzoomAnimation: true\r\n\t\t},\r\n\r\n\t\tinitialize: function (options, source) {\r\n\t\t\tL.setOptions(this, options);\r\n\r\n\t\t\tthis._source = source;\r\n\t\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\t\tthis._isOpen = false;\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tif (!this._container) {\r\n\t\t\t\tthis._initLayout();\r\n\t\t\t}\r\n\r\n\t\t\tvar animFade = map.options.fadeAnimation;\r\n\r\n\t\t\tif (animFade) {\r\n\t\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t\t}\r\n\t\t\tmap._panes.popupPane.appendChild(this._container);\r\n\r\n\t\t\tmap.on(this._getEvents(), this);\r\n\r\n\t\t\tthis.update();\r\n\r\n\t\t\tif (animFade) {\r\n\t\t\t\tL.DomUtil.setOpacity(this._container, 1);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('open');\r\n\r\n\t\t\tmap.fire('popupopen', {popup: this});\r\n\r\n\t\t\tif (this._source) {\r\n\t\t\t\tthis._source.fire('popupopen', {popup: this});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\topenOn: function (map) {\r\n\t\t\tmap.openPopup(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap._panes.popupPane.removeChild(this._container);\r\n\r\n\t\t\tL.Util.falseFn(this._container.offsetWidth); // force reflow\r\n\r\n\t\t\tmap.off(this._getEvents(), this);\r\n\r\n\t\t\tif (map.options.fadeAnimation) {\r\n\t\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t\t}\r\n\r\n\t\t\tthis._map = null;\r\n\r\n\t\t\tthis.fire('close');\r\n\r\n\t\t\tmap.fire('popupclose', {popup: this});\r\n\r\n\t\t\tif (this._source) {\r\n\t\t\t\tthis._source.fire('popupclose', {popup: this});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetLatLng: function () {\r\n\t\t\treturn this._latlng;\r\n\t\t},\r\n\r\n\t\tsetLatLng: function (latlng) {\r\n\t\t\tthis._latlng = L.latLng(latlng);\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._updatePosition();\r\n\t\t\t\tthis._adjustPan();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetContent: function () {\r\n\t\t\treturn this._content;\r\n\t\t},\r\n\r\n\t\tsetContent: function (content) {\r\n\t\t\tthis._content = content;\r\n\t\t\tthis.update();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tupdate: function () {\r\n\t\t\tif (!this._map) { return; }\r\n\r\n\t\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\t\tthis._updateContent();\r\n\t\t\tthis._updateLayout();\r\n\t\t\tthis._updatePosition();\r\n\r\n\t\t\tthis._container.style.visibility = '';\r\n\r\n\t\t\tthis._adjustPan();\r\n\t\t},\r\n\r\n\t\t_getEvents: function () {\r\n\t\t\tvar events = {\r\n\t\t\t\tviewreset: this._updatePosition\r\n\t\t\t};\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tevents.zoomanim = this._zoomAnimation;\r\n\t\t\t}\r\n\t\t\tif ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n\t\t\t\tevents.preclick = this._close;\r\n\t\t\t}\r\n\t\t\tif (this.options.keepInView) {\r\n\t\t\t\tevents.moveend = this._adjustPan;\r\n\t\t\t}\r\n\r\n\t\t\treturn events;\r\n\t\t},\r\n\r\n\t\t_close: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._map.closePopup(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_initLayout: function () {\r\n\t\t\tvar prefix = 'leaflet-popup',\r\n\t\t\t\tcontainerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +\r\n\t\t\t\t\t(this._animated ? 'animated' : 'hide'),\r\n\t\t\t\tcontainer = this._container = L.DomUtil.create('div', containerClass),\r\n\t\t\t\tcloseButton;\r\n\r\n\t\t\tif (this.options.closeButton) {\r\n\t\t\t\tcloseButton = this._closeButton =\r\n\t\t\t\t\tL.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\t\tcloseButton.href = '#close';\r\n\t\t\t\tcloseButton.innerHTML = '&#215;';\r\n\t\t\t\tL.DomEvent.disableClickPropagation(closeButton);\r\n\r\n\t\t\t\tL.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);\r\n\t\t\t}\r\n\r\n\t\t\tvar wrapper = this._wrapper =\r\n\t\t\t\tL.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\t\tL.DomEvent.disableClickPropagation(wrapper);\r\n\r\n\t\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\t\tL.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\t\t},\r\n\r\n\t\t_updateContent: function () {\r\n\t\t\tif (!this._content) { return; }\r\n\r\n\t\t\tif (typeof this._content === 'string') {\r\n\t\t\t\tthis._contentNode.innerHTML = this._content;\r\n\t\t\t} else {\r\n\t\t\t\twhile (this._contentNode.hasChildNodes()) {\r\n\t\t\t\t\tthis._contentNode.removeChild(this._contentNode.firstChild);\r\n\t\t\t\t}\r\n\t\t\t\tthis._contentNode.appendChild(this._content);\r\n\t\t\t}\r\n\t\t\tthis.fire('contentupdate');\r\n\t\t},\r\n\r\n\t\t_updateLayout: function () {\r\n\t\t\tvar container = this._contentNode,\r\n\t\t\t\tstyle = container.style;\r\n\r\n\t\t\tstyle.width = '';\r\n\t\t\tstyle.whiteSpace = 'nowrap';\r\n\r\n\t\t\tvar width = container.offsetWidth;\r\n\t\t\twidth = Math.min(width, this.options.maxWidth);\r\n\t\t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n\t\t\tstyle.width = (width + 1) + 'px';\r\n\t\t\tstyle.whiteSpace = '';\r\n\r\n\t\t\tstyle.height = '';\r\n\r\n\t\t\tvar height = container.offsetHeight,\r\n\t\t\t\tmaxHeight = this.options.maxHeight,\r\n\t\t\t\tscrolledClass = 'leaflet-popup-scrolled';\r\n\r\n\t\t\tif (maxHeight && height > maxHeight) {\r\n\t\t\t\tstyle.height = maxHeight + 'px';\r\n\t\t\t\tL.DomUtil.addClass(container, scrolledClass);\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.removeClass(container, scrolledClass);\r\n\t\t\t}\r\n\r\n\t\t\tthis._containerWidth = this._container.offsetWidth;\r\n\t\t},\r\n\r\n\t\t_updatePosition: function () {\r\n\t\t\tif (!this._map) { return; }\r\n\r\n\t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t\t\tanimated = this._animated,\r\n\t\t\t\toffset = L.point(this.options.offset);\r\n\r\n\t\t\tif (animated) {\r\n\t\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t\t}\r\n\r\n\t\t\tthis._containerBottom = -offset.y - (animated ? 0 : pos.y);\r\n\t\t\tthis._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);\r\n\r\n\t\t\t// bottom position the popup in case the height of the popup changes (images loading etc)\r\n\t\t\tthis._container.style.bottom = this._containerBottom + 'px';\r\n\t\t\tthis._container.style.left = this._containerLeft + 'px';\r\n\t\t},\r\n\r\n\t\t_zoomAnimation: function (opt) {\r\n\t\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);\r\n\r\n\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t},\r\n\r\n\t\t_adjustPan: function () {\r\n\t\t\tif (!this.options.autoPan) { return; }\r\n\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tcontainerHeight = this._container.offsetHeight,\r\n\t\t\t\tcontainerWidth = this._containerWidth,\r\n\r\n\t\t\t\tlayerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tlayerPos._add(L.DomUtil.getPosition(this._container));\r\n\t\t\t}\r\n\r\n\t\t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n\t\t\t\tpadding = L.point(this.options.autoPanPadding),\r\n\t\t\t\tpaddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t\t\tpaddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t\t\t\tsize = map.getSize(),\r\n\t\t\t\tdx = 0,\r\n\t\t\t\tdy = 0;\r\n\r\n\t\t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n\t\t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n\t\t\t}\r\n\t\t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n\t\t\t\tdx = containerPos.x - paddingTL.x;\r\n\t\t\t}\r\n\t\t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n\t\t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n\t\t\t}\r\n\t\t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n\t\t\t\tdy = containerPos.y - paddingTL.y;\r\n\t\t\t}\r\n\r\n\t\t\tif (dx || dy) {\r\n\t\t\t\tmap\r\n\t\t\t\t\t.fire('autopanstart')\r\n\t\t\t\t\t.panBy([dx, dy]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onCloseButtonClick: function (e) {\r\n\t\t\tthis._close();\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t}\r\n\t});\r\n\r\n\tL.popup = function (options, source) {\r\n\t\treturn new L.Popup(options, source);\r\n\t};\r\n\r\n\r\n\tL.Map.include({\r\n\t\topenPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])\r\n\t\t\tthis.closePopup();\r\n\r\n\t\t\tif (!(popup instanceof L.Popup)) {\r\n\t\t\t\tvar content = popup;\r\n\r\n\t\t\t\tpopup = new L.Popup(options)\r\n\t\t\t\t\t.setLatLng(latlng)\r\n\t\t\t\t\t.setContent(content);\r\n\t\t\t}\r\n\t\t\tpopup._isOpen = true;\r\n\r\n\t\t\tthis._popup = popup;\r\n\t\t\treturn this.addLayer(popup);\r\n\t\t},\r\n\r\n\t\tclosePopup: function (popup) {\r\n\t\t\tif (!popup || popup === this._popup) {\r\n\t\t\t\tpopup = this._popup;\r\n\t\t\t\tthis._popup = null;\r\n\t\t\t}\r\n\t\t\tif (popup) {\r\n\t\t\t\tthis.removeLayer(popup);\r\n\t\t\t\tpopup._isOpen = false;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Popup extension to L.Marker, adding popup-related methods.\r\n\t */\r\n\r\n\tL.Marker.include({\r\n\t\topenPopup: function () {\r\n\t\t\tif (this._popup && this._map && !this._map.hasLayer(this._popup)) {\r\n\t\t\t\tthis._popup.setLatLng(this._latlng);\r\n\t\t\t\tthis._map.openPopup(this._popup);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tclosePopup: function () {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis._popup._close();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\ttogglePopup: function () {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tif (this._popup._isOpen) {\r\n\t\t\t\t\tthis.closePopup();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.openPopup();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tbindPopup: function (content, options) {\r\n\t\t\tvar anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);\r\n\r\n\t\t\tanchor = anchor.add(L.Popup.prototype.options.offset);\r\n\r\n\t\t\tif (options && options.offset) {\r\n\t\t\t\tanchor = anchor.add(options.offset);\r\n\t\t\t}\r\n\r\n\t\t\toptions = L.extend({offset: anchor}, options);\r\n\r\n\t\t\tif (!this._popupHandlersAdded) {\r\n\t\t\t\tthis\r\n\t\t\t\t\t.on('click', this.togglePopup, this)\r\n\t\t\t\t\t.on('remove', this.closePopup, this)\r\n\t\t\t\t\t.on('move', this._movePopup, this);\r\n\t\t\t\tthis._popupHandlersAdded = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (content instanceof L.Popup) {\r\n\t\t\t\tL.setOptions(content, options);\r\n\t\t\t\tthis._popup = content;\r\n\t\t\t} else {\r\n\t\t\t\tthis._popup = new L.Popup(options, this)\r\n\t\t\t\t\t.setContent(content);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetPopupContent: function (content) {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis._popup.setContent(content);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tunbindPopup: function () {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis._popup = null;\r\n\t\t\t\tthis\r\n\t\t\t\t\t.off('click', this.togglePopup, this)\r\n\t\t\t\t\t.off('remove', this.closePopup, this)\r\n\t\t\t\t\t.off('move', this._movePopup, this);\r\n\t\t\t\tthis._popupHandlersAdded = false;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetPopup: function () {\r\n\t\t\treturn this._popup;\r\n\t\t},\r\n\r\n\t\t_movePopup: function (e) {\r\n\t\t\tthis._popup.setLatLng(e.latlng);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.LayerGroup is a class to combine several layers into one so that\r\n\t * you can manipulate the group (e.g. add/remove it) as one layer.\r\n\t */\r\n\r\n\tL.LayerGroup = L.Class.extend({\r\n\t\tinitialize: function (layers) {\r\n\t\t\tthis._layers = {};\r\n\r\n\t\t\tvar i, len;\r\n\r\n\t\t\tif (layers) {\r\n\t\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddLayer: function (layer) {\r\n\t\t\tvar id = this.getLayerId(layer);\r\n\r\n\t\t\tthis._layers[id] = layer;\r\n\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._map.addLayer(layer);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveLayer: function (layer) {\r\n\t\t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n\t\t\tif (this._map && this._layers[id]) {\r\n\t\t\t\tthis._map.removeLayer(this._layers[id]);\r\n\t\t\t}\r\n\r\n\t\t\tdelete this._layers[id];\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\thasLayer: function (layer) {\r\n\t\t\tif (!layer) { return false; }\r\n\r\n\t\t\treturn (layer in this._layers || this.getLayerId(layer) in this._layers);\r\n\t\t},\r\n\r\n\t\tclearLayers: function () {\r\n\t\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tinvoke: function (methodName) {\r\n\t\t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n\t\t\t\ti, layer;\r\n\r\n\t\t\tfor (i in this._layers) {\r\n\t\t\t\tlayer = this._layers[i];\r\n\r\n\t\t\t\tif (layer[methodName]) {\r\n\t\t\t\t\tlayer[methodName].apply(layer, args);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\t\t\tthis.eachLayer(map.addLayer, map);\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tthis.eachLayer(map.removeLayer, map);\r\n\t\t\tthis._map = null;\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\teachLayer: function (method, context) {\r\n\t\t\tfor (var i in this._layers) {\r\n\t\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetLayer: function (id) {\r\n\t\t\treturn this._layers[id];\r\n\t\t},\r\n\r\n\t\tgetLayers: function () {\r\n\t\t\tvar layers = [];\r\n\r\n\t\t\tfor (var i in this._layers) {\r\n\t\t\t\tlayers.push(this._layers[i]);\r\n\t\t\t}\r\n\t\t\treturn layers;\r\n\t\t},\r\n\r\n\t\tsetZIndex: function (zIndex) {\r\n\t\t\treturn this.invoke('setZIndex', zIndex);\r\n\t\t},\r\n\r\n\t\tgetLayerId: function (layer) {\r\n\t\t\treturn L.stamp(layer);\r\n\t\t}\r\n\t});\r\n\r\n\tL.layerGroup = function (layers) {\r\n\t\treturn new L.LayerGroup(layers);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods\r\n\t * shared between a group of interactive layers (like vectors or markers).\r\n\t */\r\n\r\n\tL.FeatureGroup = L.LayerGroup.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\tstatics: {\r\n\t\t\tEVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\r\n\t\t},\r\n\r\n\t\taddLayer: function (layer) {\r\n\t\t\tif (this.hasLayer(layer)) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif ('on' in layer) {\r\n\t\t\t\tlayer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t\t}\r\n\r\n\t\t\tL.LayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n\t\t\tif (this._popupContent && layer.bindPopup) {\r\n\t\t\t\tlayer.bindPopup(this._popupContent, this._popupOptions);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.fire('layeradd', {layer: layer});\r\n\t\t},\r\n\r\n\t\tremoveLayer: function (layer) {\r\n\t\t\tif (!this.hasLayer(layer)) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tif (layer in this._layers) {\r\n\t\t\t\tlayer = this._layers[layer];\r\n\t\t\t}\r\n\r\n\t\t\tlayer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\r\n\t\t\tL.LayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n\t\t\tif (this._popupContent) {\r\n\t\t\t\tthis.invoke('unbindPopup');\r\n\t\t\t}\r\n\r\n\t\t\treturn this.fire('layerremove', {layer: layer});\r\n\t\t},\r\n\r\n\t\tbindPopup: function (content, options) {\r\n\t\t\tthis._popupContent = content;\r\n\t\t\tthis._popupOptions = options;\r\n\t\t\treturn this.invoke('bindPopup', content, options);\r\n\t\t},\r\n\r\n\t\topenPopup: function (latlng) {\r\n\t\t\t// open popup on the first layer\r\n\t\t\tfor (var id in this._layers) {\r\n\t\t\t\tthis._layers[id].openPopup(latlng);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetStyle: function (style) {\r\n\t\t\treturn this.invoke('setStyle', style);\r\n\t\t},\r\n\r\n\t\tbringToFront: function () {\r\n\t\t\treturn this.invoke('bringToFront');\r\n\t\t},\r\n\r\n\t\tbringToBack: function () {\r\n\t\t\treturn this.invoke('bringToBack');\r\n\t\t},\r\n\r\n\t\tgetBounds: function () {\r\n\t\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tbounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());\r\n\t\t\t});\r\n\r\n\t\t\treturn bounds;\r\n\t\t},\r\n\r\n\t\t_propagateEvent: function (e) {\r\n\t\t\te = L.extend({\r\n\t\t\t\tlayer: e.target,\r\n\t\t\t\ttarget: this\r\n\t\t\t}, e);\r\n\t\t\tthis.fire(e.type, e);\r\n\t\t}\r\n\t});\r\n\r\n\tL.featureGroup = function (layers) {\r\n\t\treturn new L.FeatureGroup(layers);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.\r\n\t */\r\n\r\n\tL.Path = L.Class.extend({\r\n\t\tincludes: [L.Mixin.Events],\r\n\r\n\t\tstatics: {\r\n\t\t\t// how much to extend the clip area around the map view\r\n\t\t\t// (relative to its size, e.g. 0.5 is half the screen in each direction)\r\n\t\t\t// set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)\r\n\t\t\tCLIP_PADDING: (function () {\r\n\t\t\t\tvar max = L.Browser.mobile ? 1280 : 2000,\r\n\t\t\t\t\ttarget = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;\r\n\t\t\t\treturn Math.max(0, Math.min(0.5, target));\r\n\t\t\t})()\r\n\t\t},\r\n\r\n\t\toptions: {\r\n\t\t\tstroke: true,\r\n\t\t\tcolor: '#0033ff',\r\n\t\t\tdashArray: null,\r\n\t\t\tlineCap: null,\r\n\t\t\tlineJoin: null,\r\n\t\t\tweight: 5,\r\n\t\t\topacity: 0.5,\r\n\r\n\t\t\tfill: false,\r\n\t\t\tfillColor: null, //same as color by default\r\n\t\t\tfillOpacity: 0.2,\r\n\r\n\t\t\tclickable: true\r\n\t\t},\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tif (!this._container) {\r\n\t\t\t\tthis._initElements();\r\n\t\t\t\tthis._initEvents();\r\n\t\t\t}\r\n\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._updatePath();\r\n\r\n\t\t\tif (this._container) {\r\n\t\t\t\tthis._map._pathRoot.appendChild(this._container);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('add');\r\n\r\n\t\t\tmap.on({\r\n\t\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t\t'moveend': this._updatePath\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap._pathRoot.removeChild(this._container);\r\n\r\n\t\t\t// Need to fire remove event before we set _map to null as the event hooks might need the object\r\n\t\t\tthis.fire('remove');\r\n\t\t\tthis._map = null;\r\n\r\n\t\t\tif (L.Browser.vml) {\r\n\t\t\t\tthis._container = null;\r\n\t\t\t\tthis._stroke = null;\r\n\t\t\t\tthis._fill = null;\r\n\t\t\t}\r\n\r\n\t\t\tmap.off({\r\n\t\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t\t'moveend': this._updatePath\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\tprojectLatlngs: function () {\r\n\t\t\t// do all projection stuff here\r\n\t\t},\r\n\r\n\t\tsetStyle: function (style) {\r\n\t\t\tL.setOptions(this, style);\r\n\r\n\t\t\tif (this._container) {\r\n\t\t\t\tthis._updateStyle();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tredraw: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis.projectLatlngs();\r\n\t\t\t\tthis._updatePath();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.include({\r\n\t\t_updatePathViewport: function () {\r\n\t\t\tvar p = L.Path.CLIP_PADDING,\r\n\t\t\t\tsize = this.getSize(),\r\n\t\t\t\tpanePos = L.DomUtil.getPosition(this._mapPane),\r\n\t\t\t\tmin = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),\r\n\t\t\t\tmax = min.add(size.multiplyBy(1 + p * 2)._round());\r\n\r\n\t\t\tthis._pathViewport = new L.Bounds(min, max);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.Path with SVG-specific rendering code.\r\n\t */\r\n\r\n\tL.Path.SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\n\tL.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);\r\n\r\n\tL.Path = L.Path.extend({\r\n\t\tstatics: {\r\n\t\t\tSVG: L.Browser.svg\r\n\t\t},\r\n\r\n\t\tbringToFront: function () {\r\n\t\t\tvar root = this._map._pathRoot,\r\n\t\t\t\tpath = this._container;\r\n\r\n\t\t\tif (path && root.lastChild !== path) {\r\n\t\t\t\troot.appendChild(path);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tbringToBack: function () {\r\n\t\t\tvar root = this._map._pathRoot,\r\n\t\t\t\tpath = this._container,\r\n\t\t\t\tfirst = root.firstChild;\r\n\r\n\t\t\tif (path && first !== path) {\r\n\t\t\t\troot.insertBefore(path, first);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetPathString: function () {\r\n\t\t\t// form path string here\r\n\t\t},\r\n\r\n\t\t_createElement: function (name) {\r\n\t\t\treturn document.createElementNS(L.Path.SVG_NS, name);\r\n\t\t},\r\n\r\n\t\t_initElements: function () {\r\n\t\t\tthis._map._initPathRoot();\r\n\t\t\tthis._initPath();\r\n\t\t\tthis._initStyle();\r\n\t\t},\r\n\r\n\t\t_initPath: function () {\r\n\t\t\tthis._container = this._createElement('g');\r\n\r\n\t\t\tthis._path = this._createElement('path');\r\n\r\n\t\t\tif (this.options.className) {\r\n\t\t\t\tL.DomUtil.addClass(this._path, this.options.className);\r\n\t\t\t}\r\n\r\n\t\t\tthis._container.appendChild(this._path);\r\n\t\t},\r\n\r\n\t\t_initStyle: function () {\r\n\t\t\tif (this.options.stroke) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linejoin', 'round');\r\n\t\t\t\tthis._path.setAttribute('stroke-linecap', 'round');\r\n\t\t\t}\r\n\t\t\tif (this.options.fill) {\r\n\t\t\t\tthis._path.setAttribute('fill-rule', 'evenodd');\r\n\t\t\t}\r\n\t\t\tif (this.options.pointerEvents) {\r\n\t\t\t\tthis._path.setAttribute('pointer-events', this.options.pointerEvents);\r\n\t\t\t}\r\n\t\t\tif (!this.options.clickable && !this.options.pointerEvents) {\r\n\t\t\t\tthis._path.setAttribute('pointer-events', 'none');\r\n\t\t\t}\r\n\t\t\tthis._updateStyle();\r\n\t\t},\r\n\r\n\t\t_updateStyle: function () {\r\n\t\t\tif (this.options.stroke) {\r\n\t\t\t\tthis._path.setAttribute('stroke', this.options.color);\r\n\t\t\t\tthis._path.setAttribute('stroke-opacity', this.options.opacity);\r\n\t\t\t\tthis._path.setAttribute('stroke-width', this.options.weight);\r\n\t\t\t\tif (this.options.dashArray) {\r\n\t\t\t\t\tthis._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._path.removeAttribute('stroke-dasharray');\r\n\t\t\t\t}\r\n\t\t\t\tif (this.options.lineCap) {\r\n\t\t\t\t\tthis._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.options.lineJoin) {\r\n\t\t\t\t\tthis._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.setAttribute('stroke', 'none');\r\n\t\t\t}\r\n\t\t\tif (this.options.fill) {\r\n\t\t\t\tthis._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n\t\t\t\tthis._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.setAttribute('fill', 'none');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updatePath: function () {\r\n\t\t\tvar str = this.getPathString();\r\n\t\t\tif (!str) {\r\n\t\t\t\t// fix webkit empty string parsing bug\r\n\t\t\t\tstr = 'M0 0';\r\n\t\t\t}\r\n\t\t\tthis._path.setAttribute('d', str);\r\n\t\t},\r\n\r\n\t\t// TODO remove duplication with L.Map\r\n\t\t_initEvents: function () {\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover',\r\n\t\t\t\t\t'mouseout', 'mousemove', 'contextmenu'];\r\n\t\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onMouseClick: function (e) {\r\n\t\t\tif (this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\t\tthis._fireMouseEvent(e);\r\n\t\t},\r\n\r\n\t\t_fireMouseEvent: function (e) {\r\n\t\t\tif (!this.hasEventListeners(e.type)) { return; }\r\n\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tcontainerPoint = map.mouseEventToContainerPoint(e),\r\n\t\t\t\tlayerPoint = map.containerPointToLayerPoint(containerPoint),\r\n\t\t\t\tlatlng = map.layerPointToLatLng(layerPoint);\r\n\r\n\t\t\tthis.fire(e.type, {\r\n\t\t\t\tlatlng: latlng,\r\n\t\t\t\tlayerPoint: layerPoint,\r\n\t\t\t\tcontainerPoint: containerPoint,\r\n\t\t\t\toriginalEvent: e\r\n\t\t\t});\r\n\r\n\t\t\tif (e.type === 'contextmenu') {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t}\r\n\t\t\tif (e.type !== 'mousemove') {\r\n\t\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.include({\r\n\t\t_initPathRoot: function () {\r\n\t\t\tif (!this._pathRoot) {\r\n\t\t\t\tthis._pathRoot = L.Path.prototype._createElement('svg');\r\n\t\t\t\tthis._panes.overlayPane.appendChild(this._pathRoot);\r\n\r\n\t\t\t\tif (this.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');\r\n\r\n\t\t\t\t\tthis.on({\r\n\t\t\t\t\t\t'zoomanim': this._animatePathZoom,\r\n\t\t\t\t\t\t'zoomend': this._endPathZoom\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.on('moveend', this._updateSvgViewport);\r\n\t\t\t\tthis._updateSvgViewport();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_animatePathZoom: function (e) {\r\n\t\t\tvar scale = this.getZoomScale(e.zoom),\r\n\t\t\t\toffset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);\r\n\r\n\t\t\tthis._pathRoot.style[L.DomUtil.TRANSFORM] =\r\n\t\t\t\tL.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';\r\n\r\n\t\t\tthis._pathZooming = true;\r\n\t\t},\r\n\r\n\t\t_endPathZoom: function () {\r\n\t\t\tthis._pathZooming = false;\r\n\t\t},\r\n\r\n\t\t_updateSvgViewport: function () {\r\n\r\n\t\t\tif (this._pathZooming) {\r\n\t\t\t\t// Do not update SVGs while a zoom animation is going on otherwise the animation will break.\r\n\t\t\t\t// When the zoom animation ends we will be updated again anyway\r\n\t\t\t\t// This fixes the case where you do a momentum move and zoom while the move is still ongoing.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._updatePathViewport();\r\n\r\n\t\t\tvar vp = this._pathViewport,\r\n\t\t\t\tmin = vp.min,\r\n\t\t\t\tmax = vp.max,\r\n\t\t\t\twidth = max.x - min.x,\r\n\t\t\t\theight = max.y - min.y,\r\n\t\t\t\troot = this._pathRoot,\r\n\t\t\t\tpane = this._panes.overlayPane;\r\n\r\n\t\t\t// Hack to make flicker on drag end on mobile webkit less irritating\r\n\t\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\t\tpane.removeChild(root);\r\n\t\t\t}\r\n\r\n\t\t\tL.DomUtil.setPosition(root, min);\r\n\t\t\troot.setAttribute('width', width);\r\n\t\t\troot.setAttribute('height', height);\r\n\t\t\troot.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));\r\n\r\n\t\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\t\tpane.appendChild(root);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.\r\n\t */\r\n\r\n\tL.Path.include({\r\n\r\n\t\tbindPopup: function (content, options) {\r\n\r\n\t\t\tif (content instanceof L.Popup) {\r\n\t\t\t\tthis._popup = content;\r\n\t\t\t} else {\r\n\t\t\t\tif (!this._popup || options) {\r\n\t\t\t\t\tthis._popup = new L.Popup(options, this);\r\n\t\t\t\t}\r\n\t\t\t\tthis._popup.setContent(content);\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._popupHandlersAdded) {\r\n\t\t\t\tthis\r\n\t\t\t\t\t.on('click', this._openPopup, this)\r\n\t\t\t\t\t.on('remove', this.closePopup, this);\r\n\r\n\t\t\t\tthis._popupHandlersAdded = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tunbindPopup: function () {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis._popup = null;\r\n\t\t\t\tthis\r\n\t\t\t\t\t.off('click', this._openPopup)\r\n\t\t\t\t\t.off('remove', this.closePopup);\r\n\r\n\t\t\t\tthis._popupHandlersAdded = false;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\topenPopup: function (latlng) {\r\n\r\n\t\t\tif (this._popup) {\r\n\t\t\t\t// open the popup from one of the path's points if not specified\r\n\t\t\t\tlatlng = latlng || this._latlng ||\r\n\t\t\t\t\tthis._latlngs[Math.floor(this._latlngs.length / 2)];\r\n\r\n\t\t\t\tthis._openPopup({latlng: latlng});\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tclosePopup: function () {\r\n\t\t\tif (this._popup) {\r\n\t\t\t\tthis._popup._close();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_openPopup: function (e) {\r\n\t\t\tthis._popup.setLatLng(e.latlng);\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Vector rendering for IE6-8 through VML.\r\n\t * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\r\n\t */\r\n\r\n\tL.Browser.vml = !L.Browser.svg && (function () {\r\n\t\t\ttry {\r\n\t\t\t\tvar div = document.createElement('div');\r\n\t\t\t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n\t\t\t\tvar shape = div.firstChild;\r\n\t\t\t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n\t\t\t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}());\r\n\r\n\tL.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({\r\n\t\tstatics: {\r\n\t\t\tVML: true,\r\n\t\t\tCLIP_PADDING: 0.02\r\n\t\t},\r\n\r\n\t\t_createElement: (function () {\r\n\t\t\ttry {\r\n\t\t\t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\r\n\t\t\t\treturn function (name) {\r\n\t\t\t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\r\n\t\t\t\t};\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn function (name) {\r\n\t\t\t\t\treturn document.createElement(\r\n\t\t\t\t\t\t'<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}()),\r\n\r\n\t\t_initPath: function () {\r\n\t\t\tvar container = this._container = this._createElement('shape');\r\n\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-vml-shape' +\r\n\t\t\t\t(this.options.className ? ' ' + this.options.className : ''));\r\n\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.coordsize = '1 1';\r\n\r\n\t\t\tthis._path = this._createElement('path');\r\n\t\t\tcontainer.appendChild(this._path);\r\n\r\n\t\t\tthis._map._pathRoot.appendChild(container);\r\n\t\t},\r\n\r\n\t\t_initStyle: function () {\r\n\t\t\tthis._updateStyle();\r\n\t\t},\r\n\r\n\t\t_updateStyle: function () {\r\n\t\t\tvar stroke = this._stroke,\r\n\t\t\t\tfill = this._fill,\r\n\t\t\t\toptions = this.options,\r\n\t\t\t\tcontainer = this._container;\r\n\r\n\t\t\tcontainer.stroked = options.stroke;\r\n\t\t\tcontainer.filled = options.fill;\r\n\r\n\t\t\tif (options.stroke) {\r\n\t\t\t\tif (!stroke) {\r\n\t\t\t\t\tstroke = this._stroke = this._createElement('stroke');\r\n\t\t\t\t\tstroke.endcap = 'round';\r\n\t\t\t\t\tcontainer.appendChild(stroke);\r\n\t\t\t\t}\r\n\t\t\t\tstroke.weight = options.weight + 'px';\r\n\t\t\t\tstroke.color = options.color;\r\n\t\t\t\tstroke.opacity = options.opacity;\r\n\r\n\t\t\t\tif (options.dashArray) {\r\n\t\t\t\t\tstroke.dashStyle = L.Util.isArray(options.dashArray) ?\r\n\t\t\t\t\t\toptions.dashArray.join(' ') :\r\n\t\t\t\t\t\toptions.dashArray.replace(/( *, *)/g, ' ');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstroke.dashStyle = '';\r\n\t\t\t\t}\r\n\t\t\t\tif (options.lineCap) {\r\n\t\t\t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\r\n\t\t\t\t}\r\n\t\t\t\tif (options.lineJoin) {\r\n\t\t\t\t\tstroke.joinstyle = options.lineJoin;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (stroke) {\r\n\t\t\t\tcontainer.removeChild(stroke);\r\n\t\t\t\tthis._stroke = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.fill) {\r\n\t\t\t\tif (!fill) {\r\n\t\t\t\t\tfill = this._fill = this._createElement('fill');\r\n\t\t\t\t\tcontainer.appendChild(fill);\r\n\t\t\t\t}\r\n\t\t\t\tfill.color = options.fillColor || options.color;\r\n\t\t\t\tfill.opacity = options.fillOpacity;\r\n\r\n\t\t\t} else if (fill) {\r\n\t\t\t\tcontainer.removeChild(fill);\r\n\t\t\t\tthis._fill = null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updatePath: function () {\r\n\t\t\tvar style = this._container.style;\r\n\r\n\t\t\tstyle.display = 'none';\r\n\t\t\tthis._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug\r\n\t\t\tstyle.display = '';\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {\r\n\t\t_initPathRoot: function () {\r\n\t\t\tif (this._pathRoot) { return; }\r\n\r\n\t\t\tvar root = this._pathRoot = document.createElement('div');\r\n\t\t\troot.className = 'leaflet-vml-container';\r\n\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\tthis.on('moveend', this._updatePathViewport);\r\n\t\t\tthis._updatePathViewport();\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Vector rendering for all browsers that support canvas.\r\n\t */\r\n\r\n\tL.Browser.canvas = (function () {\r\n\t\treturn !!document.createElement('canvas').getContext;\r\n\t}());\r\n\r\n\tL.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({\r\n\t\tstatics: {\r\n\t\t\t//CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value\r\n\t\t\tCANVAS: true,\r\n\t\t\tSVG: false\r\n\t\t},\r\n\r\n\t\tredraw: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis.projectLatlngs();\r\n\t\t\t\tthis._requestUpdate();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetStyle: function (style) {\r\n\t\t\tL.setOptions(this, style);\r\n\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._updateStyle();\r\n\t\t\t\tthis._requestUpdate();\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap\r\n\t\t\t\t.off('viewreset', this.projectLatlngs, this)\r\n\t\t\t\t.off('moveend', this._updatePath, this);\r\n\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\tthis._map.off('click', this._onClick, this);\r\n\t\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._requestUpdate();\r\n\r\n\t\t\tthis._map = null;\r\n\t\t},\r\n\r\n\t\t_requestUpdate: function () {\r\n\t\t\tif (this._map && !L.Path._updateRequest) {\r\n\t\t\t\tL.Path._updateRequest = L.Util.requestAnimFrame(this._fireMapMoveEnd, this._map);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fireMapMoveEnd: function () {\r\n\t\t\tL.Path._updateRequest = null;\r\n\t\t\tthis.fire('moveend');\r\n\t\t},\r\n\r\n\t\t_initElements: function () {\r\n\t\t\tthis._map._initPathRoot();\r\n\t\t\tthis._ctx = this._map._canvasCtx;\r\n\t\t},\r\n\r\n\t\t_updateStyle: function () {\r\n\t\t\tvar options = this.options;\r\n\r\n\t\t\tif (options.stroke) {\r\n\t\t\t\tthis._ctx.lineWidth = options.weight;\r\n\t\t\t\tthis._ctx.strokeStyle = options.color;\r\n\t\t\t}\r\n\t\t\tif (options.fill) {\r\n\t\t\t\tthis._ctx.fillStyle = options.fillColor || options.color;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_drawPath: function () {\r\n\t\t\tvar i, j, len, len2, point, drawMethod;\r\n\r\n\t\t\tthis._ctx.beginPath();\r\n\r\n\t\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\t\tfor (j = 0, len2 = this._parts[i].length; j < len2; j++) {\r\n\t\t\t\t\tpoint = this._parts[i][j];\r\n\t\t\t\t\tdrawMethod = (j === 0 ? 'move' : 'line') + 'To';\r\n\r\n\t\t\t\t\tthis._ctx[drawMethod](point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t\t// TODO refactor ugly hack\r\n\t\t\t\tif (this instanceof L.Polygon) {\r\n\t\t\t\t\tthis._ctx.closePath();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_checkIfEmpty: function () {\r\n\t\t\treturn !this._parts.length;\r\n\t\t},\r\n\r\n\t\t_updatePath: function () {\r\n\t\t\tif (this._checkIfEmpty()) { return; }\r\n\r\n\t\t\tvar ctx = this._ctx,\r\n\t\t\t\toptions = this.options;\r\n\r\n\t\t\tthis._drawPath();\r\n\t\t\tctx.save();\r\n\t\t\tthis._updateStyle();\r\n\r\n\t\t\tif (options.fill) {\r\n\t\t\t\tctx.globalAlpha = options.fillOpacity;\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\r\n\t\t\tif (options.stroke) {\r\n\t\t\t\tctx.globalAlpha = options.opacity;\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\r\n\t\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\r\n\t\t},\r\n\r\n\t\t_initEvents: function () {\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\t// TODO dblclick\r\n\t\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t\t\tthis._map.on('click', this._onClick, this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onClick: function (e) {\r\n\t\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\t\tthis.fire('click', e);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onMouseMove: function (e) {\r\n\t\t\tif (!this._map || this._map._animatingZoom) { return; }\r\n\r\n\t\t\t// TODO don't do on each move\r\n\t\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\t\tthis._ctx.canvas.style.cursor = 'pointer';\r\n\t\t\t\tthis._mouseInside = true;\r\n\t\t\t\tthis.fire('mouseover', e);\r\n\r\n\t\t\t} else if (this._mouseInside) {\r\n\t\t\t\tthis._ctx.canvas.style.cursor = '';\r\n\t\t\t\tthis._mouseInside = false;\r\n\t\t\t\tthis.fire('mouseout', e);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {\r\n\t\t_initPathRoot: function () {\r\n\t\t\tvar root = this._pathRoot,\r\n\t\t\t\tctx;\r\n\r\n\t\t\tif (!root) {\r\n\t\t\t\troot = this._pathRoot = document.createElement('canvas');\r\n\t\t\t\troot.style.position = 'absolute';\r\n\t\t\t\tctx = this._canvasCtx = root.getContext('2d');\r\n\r\n\t\t\t\tctx.lineCap = 'round';\r\n\t\t\t\tctx.lineJoin = 'round';\r\n\r\n\t\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\t\tif (this.options.zoomAnimation) {\r\n\t\t\t\t\tthis._pathRoot.className = 'leaflet-zoom-animated';\r\n\t\t\t\t\tthis.on('zoomanim', this._animatePathZoom);\r\n\t\t\t\t\tthis.on('zoomend', this._endPathZoom);\r\n\t\t\t\t}\r\n\t\t\t\tthis.on('moveend', this._updateCanvasViewport);\r\n\t\t\t\tthis._updateCanvasViewport();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateCanvasViewport: function () {\r\n\t\t\t// don't redraw while zooming. See _updateSvgViewport for more details\r\n\t\t\tif (this._pathZooming) { return; }\r\n\t\t\tthis._updatePathViewport();\r\n\r\n\t\t\tvar vp = this._pathViewport,\r\n\t\t\t\tmin = vp.min,\r\n\t\t\t\tsize = vp.max.subtract(min),\r\n\t\t\t\troot = this._pathRoot;\r\n\r\n\t\t\t//TODO check if this works properly on mobile webkit\r\n\t\t\tL.DomUtil.setPosition(root, min);\r\n\t\t\troot.width = size.x;\r\n\t\t\troot.height = size.y;\r\n\t\t\troot.getContext('2d').translate(-min.x, -min.y);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.LineUtil contains different utility functions for line segments\r\n\t * and polylines (clipping, simplification, distances, etc.)\r\n\t */\r\n\r\n\t/*jshint bitwise:false */ // allow bitwise operations for this file\r\n\r\n\tL.LineUtil = {\r\n\r\n\t\t// Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n\t\t// Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n\t\tsimplify: function (/*Point[]*/ points, /*Number*/ tolerance) {\r\n\t\t\tif (!tolerance || !points.length) {\r\n\t\t\t\treturn points.slice();\r\n\t\t\t}\r\n\r\n\t\t\tvar sqTolerance = tolerance * tolerance;\r\n\r\n\t\t\t// stage 1: vertex reduction\r\n\t\t\tpoints = this._reducePoints(points, sqTolerance);\r\n\r\n\t\t\t// stage 2: Douglas-Peucker simplification\r\n\t\t\tpoints = this._simplifyDP(points, sqTolerance);\r\n\r\n\t\t\treturn points;\r\n\t\t},\r\n\r\n\t\t// distance from a point to a segment between two points\r\n\t\tpointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\t\treturn Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));\r\n\t\t},\r\n\r\n\t\tclosestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\t\treturn this._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t},\r\n\r\n\t\t// Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm\r\n\t\t_simplifyDP: function (points, sqTolerance) {\r\n\r\n\t\t\tvar len = points.length,\r\n\t\t\t\tArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n\t\t\t\tmarkers = new ArrayConstructor(len);\r\n\r\n\t\t\tmarkers[0] = markers[len - 1] = 1;\r\n\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n\t\t\tvar i,\r\n\t\t\t\tnewPoints = [];\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\tif (markers[i]) {\r\n\t\t\t\t\tnewPoints.push(points[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn newPoints;\r\n\t\t},\r\n\r\n\t\t_simplifyDPStep: function (points, markers, sqTolerance, first, last) {\r\n\r\n\t\t\tvar maxSqDist = 0,\r\n\t\t\t\tindex, i, sqDist;\r\n\r\n\t\t\tfor (i = first + 1; i <= last - 1; i++) {\r\n\t\t\t\tsqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n\t\t\t\tif (sqDist > maxSqDist) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tmaxSqDist = sqDist;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (maxSqDist > sqTolerance) {\r\n\t\t\t\tmarkers[index] = 1;\r\n\r\n\t\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, first, index);\r\n\t\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, index, last);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// reduce points that are too close to each other to a single point\r\n\t\t_reducePoints: function (points, sqTolerance) {\r\n\t\t\tvar reducedPoints = [points[0]];\r\n\r\n\t\t\tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n\t\t\t\tif (this._sqDist(points[i], points[prev]) > sqTolerance) {\r\n\t\t\t\t\treducedPoints.push(points[i]);\r\n\t\t\t\t\tprev = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (prev < len - 1) {\r\n\t\t\t\treducedPoints.push(points[len - 1]);\r\n\t\t\t}\r\n\t\t\treturn reducedPoints;\r\n\t\t},\r\n\r\n\t\t// Cohen-Sutherland line clipping algorithm.\r\n\t\t// Used to avoid rendering parts of a polyline that are not currently visible.\r\n\r\n\t\tclipSegment: function (a, b, bounds, useLastCode) {\r\n\t\t\tvar codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),\r\n\t\t\t\tcodeB = this._getBitCode(b, bounds),\r\n\r\n\t\t\t\tcodeOut, p, newCode;\r\n\r\n\t\t\t// save 2nd code to avoid calculating it on the next segment\r\n\t\t\tthis._lastCode = codeB;\r\n\r\n\t\t\twhile (true) {\r\n\t\t\t\t// if a,b is inside the clip window (trivial accept)\r\n\t\t\t\tif (!(codeA | codeB)) {\r\n\t\t\t\t\treturn [a, b];\r\n\t\t\t\t\t// if a,b is outside the clip window (trivial reject)\r\n\t\t\t\t} else if (codeA & codeB) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t\t// other cases\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcodeOut = codeA || codeB;\r\n\t\t\t\t\tp = this._getEdgeIntersection(a, b, codeOut, bounds);\r\n\t\t\t\t\tnewCode = this._getBitCode(p, bounds);\r\n\r\n\t\t\t\t\tif (codeOut === codeA) {\r\n\t\t\t\t\t\ta = p;\r\n\t\t\t\t\t\tcodeA = newCode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tb = p;\r\n\t\t\t\t\t\tcodeB = newCode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getEdgeIntersection: function (a, b, code, bounds) {\r\n\t\t\tvar dx = b.x - a.x,\r\n\t\t\t\tdy = b.y - a.y,\r\n\t\t\t\tmin = bounds.min,\r\n\t\t\t\tmax = bounds.max;\r\n\r\n\t\t\tif (code & 8) { // top\r\n\t\t\t\treturn new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);\r\n\t\t\t} else if (code & 4) { // bottom\r\n\t\t\t\treturn new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);\r\n\t\t\t} else if (code & 2) { // right\r\n\t\t\t\treturn new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);\r\n\t\t\t} else if (code & 1) { // left\r\n\t\t\t\treturn new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getBitCode: function (/*Point*/ p, bounds) {\r\n\t\t\tvar code = 0;\r\n\r\n\t\t\tif (p.x < bounds.min.x) { // left\r\n\t\t\t\tcode |= 1;\r\n\t\t\t} else if (p.x > bounds.max.x) { // right\r\n\t\t\t\tcode |= 2;\r\n\t\t\t}\r\n\t\t\tif (p.y < bounds.min.y) { // bottom\r\n\t\t\t\tcode |= 4;\r\n\t\t\t} else if (p.y > bounds.max.y) { // top\r\n\t\t\t\tcode |= 8;\r\n\t\t\t}\r\n\r\n\t\t\treturn code;\r\n\t\t},\r\n\r\n\t\t// square distance (to avoid unnecessary Math.sqrt calls)\r\n\t\t_sqDist: function (p1, p2) {\r\n\t\t\tvar dx = p2.x - p1.x,\r\n\t\t\t\tdy = p2.y - p1.y;\r\n\t\t\treturn dx * dx + dy * dy;\r\n\t\t},\r\n\r\n\t\t// return closest point on segment or distance to that point\r\n\t\t_sqClosestPointOnSegment: function (p, p1, p2, sqDist) {\r\n\t\t\tvar x = p1.x,\r\n\t\t\t\ty = p1.y,\r\n\t\t\t\tdx = p2.x - x,\r\n\t\t\t\tdy = p2.y - y,\r\n\t\t\t\tdot = dx * dx + dy * dy,\r\n\t\t\t\tt;\r\n\r\n\t\t\tif (dot > 0) {\r\n\t\t\t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n\t\t\t\tif (t > 1) {\r\n\t\t\t\t\tx = p2.x;\r\n\t\t\t\t\ty = p2.y;\r\n\t\t\t\t} else if (t > 0) {\r\n\t\t\t\t\tx += dx * t;\r\n\t\t\t\t\ty += dy * t;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdx = p.x - x;\r\n\t\t\tdy = p.y - y;\r\n\r\n\t\t\treturn sqDist ? dx * dx + dy * dy : new L.Point(x, y);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Polyline is used to display polylines on a map.\r\n\t */\r\n\r\n\tL.Polyline = L.Path.extend({\r\n\t\tinitialize: function (latlngs, options) {\r\n\t\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\t},\r\n\r\n\t\toptions: {\r\n\t\t\t// how much to simplify the polyline on each zoom level\r\n\t\t\t// more = better performance and smoother look, less = more accurate\r\n\t\t\tsmoothFactor: 1.0,\r\n\t\t\tnoClip: false\r\n\t\t},\r\n\r\n\t\tprojectLatlngs: function () {\r\n\t\t\tthis._originalPoints = [];\r\n\r\n\t\t\tfor (var i = 0, len = this._latlngs.length; i < len; i++) {\r\n\t\t\t\tthis._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetPathString: function () {\r\n\t\t\tfor (var i = 0, len = this._parts.length, str = ''; i < len; i++) {\r\n\t\t\t\tstr += this._getPathPartStr(this._parts[i]);\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t},\r\n\r\n\t\tgetLatLngs: function () {\r\n\t\t\treturn this._latlngs;\r\n\t\t},\r\n\r\n\t\tsetLatLngs: function (latlngs) {\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\t\treturn this.redraw();\r\n\t\t},\r\n\r\n\t\taddLatLng: function (latlng) {\r\n\t\t\tthis._latlngs.push(L.latLng(latlng));\r\n\t\t\treturn this.redraw();\r\n\t\t},\r\n\r\n\t\tspliceLatLngs: function () { // (Number index, Number howMany)\r\n\t\t\tvar removed = [].splice.apply(this._latlngs, arguments);\r\n\t\t\tthis._convertLatLngs(this._latlngs, true);\r\n\t\t\tthis.redraw();\r\n\t\t\treturn removed;\r\n\t\t},\r\n\r\n\t\tclosestLayerPoint: function (p) {\r\n\t\t\tvar minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;\r\n\r\n\t\t\tfor (var j = 0, jLen = parts.length; j < jLen; j++) {\r\n\t\t\t\tvar points = parts[j];\r\n\t\t\t\tfor (var i = 1, len = points.length; i < len; i++) {\r\n\t\t\t\t\tp1 = points[i - 1];\r\n\t\t\t\t\tp2 = points[i];\r\n\t\t\t\t\tvar sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);\r\n\t\t\t\t\tif (sqDist < minDistance) {\r\n\t\t\t\t\t\tminDistance = sqDist;\r\n\t\t\t\t\t\tminPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (minPoint) {\r\n\t\t\t\tminPoint.distance = Math.sqrt(minDistance);\r\n\t\t\t}\r\n\t\t\treturn minPoint;\r\n\t\t},\r\n\r\n\t\tgetBounds: function () {\r\n\t\t\treturn new L.LatLngBounds(this.getLatLngs());\r\n\t\t},\r\n\r\n\t\t_convertLatLngs: function (latlngs, overwrite) {\r\n\t\t\tvar i, len, target = overwrite ? latlngs : [];\r\n\r\n\t\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\t\tif (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttarget[i] = L.latLng(latlngs[i]);\r\n\t\t\t}\r\n\t\t\treturn target;\r\n\t\t},\r\n\r\n\t\t_initEvents: function () {\r\n\t\t\tL.Path.prototype._initEvents.call(this);\r\n\t\t},\r\n\r\n\t\t_getPathPartStr: function (points) {\r\n\t\t\tvar round = L.Path.VML;\r\n\r\n\t\t\tfor (var j = 0, len2 = points.length, str = '', p; j < len2; j++) {\r\n\t\t\t\tp = points[j];\r\n\t\t\t\tif (round) {\r\n\t\t\t\t\tp._round();\r\n\t\t\t\t}\r\n\t\t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t},\r\n\r\n\t\t_clipPoints: function () {\r\n\t\t\tvar points = this._originalPoints,\r\n\t\t\t\tlen = points.length,\r\n\t\t\t\ti, k, segment;\r\n\r\n\t\t\tif (this.options.noClip) {\r\n\t\t\t\tthis._parts = [points];\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._parts = [];\r\n\r\n\t\t\tvar parts = this._parts,\r\n\t\t\t\tvp = this._map._pathViewport,\r\n\t\t\t\tlu = L.LineUtil;\r\n\r\n\t\t\tfor (i = 0, k = 0; i < len - 1; i++) {\r\n\t\t\t\tsegment = lu.clipSegment(points[i], points[i + 1], vp, i);\r\n\t\t\t\tif (!segment) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparts[k] = parts[k] || [];\r\n\t\t\t\tparts[k].push(segment[0]);\r\n\r\n\t\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\r\n\t\t\t\tif ((segment[1] !== points[i + 1]) || (i === len - 2)) {\r\n\t\t\t\t\tparts[k].push(segment[1]);\r\n\t\t\t\t\tk++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// simplify each clipped part of the polyline\r\n\t\t_simplifyPoints: function () {\r\n\t\t\tvar parts = this._parts,\r\n\t\t\t\tlu = L.LineUtil;\r\n\r\n\t\t\tfor (var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\t\tparts[i] = lu.simplify(parts[i], this.options.smoothFactor);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updatePath: function () {\r\n\t\t\tif (!this._map) { return; }\r\n\r\n\t\t\tthis._clipPoints();\r\n\t\t\tthis._simplifyPoints();\r\n\r\n\t\t\tL.Path.prototype._updatePath.call(this);\r\n\t\t}\r\n\t});\r\n\r\n\tL.polyline = function (latlngs, options) {\r\n\t\treturn new L.Polyline(latlngs, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.PolyUtil contains utility functions for polygons (clipping, etc.).\r\n\t */\r\n\r\n\t/*jshint bitwise:false */ // allow bitwise operations here\r\n\r\n\tL.PolyUtil = {};\r\n\r\n\t/*\r\n\t * Sutherland-Hodgeman polygon clipping algorithm.\r\n\t * Used to avoid rendering parts of a polygon that are not currently visible.\r\n\t */\r\n\tL.PolyUtil.clipPolygon = function (points, bounds) {\r\n\t\tvar clippedPoints,\r\n\t\t\tedges = [1, 4, 2, 8],\r\n\t\t\ti, j, k,\r\n\t\t\ta, b,\r\n\t\t\tlen, edge, p,\r\n\t\t\tlu = L.LineUtil;\r\n\r\n\t\tfor (i = 0, len = points.length; i < len; i++) {\r\n\t\t\tpoints[i]._code = lu._getBitCode(points[i], bounds);\r\n\t\t}\r\n\r\n\t\t// for each edge (left, bottom, right, top)\r\n\t\tfor (k = 0; k < 4; k++) {\r\n\t\t\tedge = edges[k];\r\n\t\t\tclippedPoints = [];\r\n\r\n\t\t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n\t\t\t\ta = points[i];\r\n\t\t\t\tb = points[j];\r\n\r\n\t\t\t\t// if a is inside the clip window\r\n\t\t\t\tif (!(a._code & edge)) {\r\n\t\t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n\t\t\t\t\tif (b._code & edge) {\r\n\t\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclippedPoints.push(a);\r\n\r\n\t\t\t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n\t\t\t\t} else if (!(b._code & edge)) {\r\n\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpoints = clippedPoints;\r\n\t\t}\r\n\r\n\t\treturn points;\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Polygon is used to display polygons on a map.\r\n\t */\r\n\r\n\tL.Polygon = L.Polyline.extend({\r\n\t\toptions: {\r\n\t\t\tfill: true\r\n\t\t},\r\n\r\n\t\tinitialize: function (latlngs, options) {\r\n\t\t\tL.Polyline.prototype.initialize.call(this, latlngs, options);\r\n\t\t\tthis._initWithHoles(latlngs);\r\n\t\t},\r\n\r\n\t\t_initWithHoles: function (latlngs) {\r\n\t\t\tvar i, len, hole;\r\n\t\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\t\tthis._latlngs = this._convertLatLngs(latlngs[0]);\r\n\t\t\t\tthis._holes = latlngs.slice(1);\r\n\r\n\t\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\t\thole = this._holes[i] = this._convertLatLngs(this._holes[i]);\r\n\t\t\t\t\tif (hole[0].equals(hole[hole.length - 1])) {\r\n\t\t\t\t\t\thole.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// filter out last point if its equal to the first one\r\n\t\t\tlatlngs = this._latlngs;\r\n\r\n\t\t\tif (latlngs.length >= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {\r\n\t\t\t\tlatlngs.pop();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tprojectLatlngs: function () {\r\n\t\t\tL.Polyline.prototype.projectLatlngs.call(this);\r\n\r\n\t\t\t// project polygon holes points\r\n\t\t\t// TODO move this logic to Polyline to get rid of duplication\r\n\t\t\tthis._holePoints = [];\r\n\r\n\t\t\tif (!this._holes) { return; }\r\n\r\n\t\t\tvar i, j, len, len2;\r\n\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\tthis._holePoints[i] = [];\r\n\r\n\t\t\t\tfor (j = 0, len2 = this._holes[i].length; j < len2; j++) {\r\n\t\t\t\t\tthis._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetLatLngs: function (latlngs) {\r\n\t\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\t\tthis._initWithHoles(latlngs);\r\n\t\t\t\treturn this.redraw();\r\n\t\t\t} else {\r\n\t\t\t\treturn L.Polyline.prototype.setLatLngs.call(this, latlngs);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clipPoints: function () {\r\n\t\t\tvar points = this._originalPoints,\r\n\t\t\t\tnewParts = [];\r\n\r\n\t\t\tthis._parts = [points].concat(this._holePoints);\r\n\r\n\t\t\tif (this.options.noClip) { return; }\r\n\r\n\t\t\tfor (var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\t\tvar clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);\r\n\t\t\t\tif (clipped.length) {\r\n\t\t\t\t\tnewParts.push(clipped);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._parts = newParts;\r\n\t\t},\r\n\r\n\t\t_getPathPartStr: function (points) {\r\n\t\t\tvar str = L.Polyline.prototype._getPathPartStr.call(this, points);\r\n\t\t\treturn str + (L.Browser.svg ? 'z' : 'x');\r\n\t\t}\r\n\t});\r\n\r\n\tL.polygon = function (latlngs, options) {\r\n\t\treturn new L.Polygon(latlngs, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * Contains L.MultiPolyline and L.MultiPolygon layers.\r\n\t */\r\n\r\n\t(function () {\r\n\t\tfunction createMulti(Klass) {\r\n\r\n\t\t\treturn L.FeatureGroup.extend({\r\n\r\n\t\t\t\tinitialize: function (latlngs, options) {\r\n\t\t\t\t\tthis._layers = {};\r\n\t\t\t\t\tthis._options = options;\r\n\t\t\t\t\tthis.setLatLngs(latlngs);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tsetLatLngs: function (latlngs) {\r\n\t\t\t\t\tvar i = 0,\r\n\t\t\t\t\t\tlen = latlngs.length;\r\n\r\n\t\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\t\tif (i < len) {\r\n\t\t\t\t\t\t\tlayer.setLatLngs(latlngs[i++]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.removeLayer(layer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this);\r\n\r\n\t\t\t\t\twhile (i < len) {\r\n\t\t\t\t\t\tthis.addLayer(new Klass(latlngs[i++], this._options));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\r\n\t\t\t\tgetLatLngs: function () {\r\n\t\t\t\t\tvar latlngs = [];\r\n\r\n\t\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\t\tlatlngs.push(layer.getLatLngs());\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn latlngs;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tL.MultiPolyline = createMulti(L.Polyline);\r\n\t\tL.MultiPolygon = createMulti(L.Polygon);\r\n\r\n\t\tL.multiPolyline = function (latlngs, options) {\r\n\t\t\treturn new L.MultiPolyline(latlngs, options);\r\n\t\t};\r\n\r\n\t\tL.multiPolygon = function (latlngs, options) {\r\n\t\t\treturn new L.MultiPolygon(latlngs, options);\r\n\t\t};\r\n\t}());\r\n\r\n\r\n\t/*\r\n\t * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\r\n\t */\r\n\r\n\tL.Rectangle = L.Polygon.extend({\r\n\t\tinitialize: function (latLngBounds, options) {\r\n\t\t\tL.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\r\n\t\t},\r\n\r\n\t\tsetBounds: function (latLngBounds) {\r\n\t\t\tthis.setLatLngs(this._boundsToLatLngs(latLngBounds));\r\n\t\t},\r\n\r\n\t\t_boundsToLatLngs: function (latLngBounds) {\r\n\t\t\tlatLngBounds = L.latLngBounds(latLngBounds);\r\n\t\t\treturn [\r\n\t\t\t\tlatLngBounds.getSouthWest(),\r\n\t\t\t\tlatLngBounds.getNorthWest(),\r\n\t\t\t\tlatLngBounds.getNorthEast(),\r\n\t\t\t\tlatLngBounds.getSouthEast()\r\n\t\t\t];\r\n\t\t}\r\n\t});\r\n\r\n\tL.rectangle = function (latLngBounds, options) {\r\n\t\treturn new L.Rectangle(latLngBounds, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Circle is a circle overlay (with a certain radius in meters).\r\n\t */\r\n\r\n\tL.Circle = L.Path.extend({\r\n\t\tinitialize: function (latlng, radius, options) {\r\n\t\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\t\tthis._latlng = L.latLng(latlng);\r\n\t\t\tthis._mRadius = radius;\r\n\t\t},\r\n\r\n\t\toptions: {\r\n\t\t\tfill: true\r\n\t\t},\r\n\r\n\t\tsetLatLng: function (latlng) {\r\n\t\t\tthis._latlng = L.latLng(latlng);\r\n\t\t\treturn this.redraw();\r\n\t\t},\r\n\r\n\t\tsetRadius: function (radius) {\r\n\t\t\tthis._mRadius = radius;\r\n\t\t\treturn this.redraw();\r\n\t\t},\r\n\r\n\t\tprojectLatlngs: function () {\r\n\t\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t\t\tlatlng = this._latlng,\r\n\t\t\t\tpointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);\r\n\r\n\t\t\tthis._point = this._map.latLngToLayerPoint(latlng);\r\n\t\t\tthis._radius = Math.max(this._point.x - pointLeft.x, 1);\r\n\t\t},\r\n\r\n\t\tgetBounds: function () {\r\n\t\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t\t\tlatRadius = (this._mRadius / 40075017) * 360,\r\n\t\t\t\tlatlng = this._latlng;\r\n\r\n\t\t\treturn new L.LatLngBounds(\r\n\t\t\t\t[latlng.lat - latRadius, latlng.lng - lngRadius],\r\n\t\t\t\t[latlng.lat + latRadius, latlng.lng + lngRadius]);\r\n\t\t},\r\n\r\n\t\tgetLatLng: function () {\r\n\t\t\treturn this._latlng;\r\n\t\t},\r\n\r\n\t\tgetPathString: function () {\r\n\t\t\tvar p = this._point,\r\n\t\t\t\tr = this._radius;\r\n\r\n\t\t\tif (this._checkIfEmpty()) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\r\n\t\t\tif (L.Browser.svg) {\r\n\t\t\t\treturn 'M' + p.x + ',' + (p.y - r) +\r\n\t\t\t\t\t'A' + r + ',' + r + ',0,1,1,' +\r\n\t\t\t\t\t(p.x - 0.1) + ',' + (p.y - r) + ' z';\r\n\t\t\t} else {\r\n\t\t\t\tp._round();\r\n\t\t\t\tr = Math.round(r);\r\n\t\t\t\treturn 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRadius: function () {\r\n\t\t\treturn this._mRadius;\r\n\t\t},\r\n\r\n\t\t// TODO Earth hardcoded, move into projection code!\r\n\r\n\t\t_getLatRadius: function () {\r\n\t\t\treturn (this._mRadius / 40075017) * 360;\r\n\t\t},\r\n\r\n\t\t_getLngRadius: function () {\r\n\t\t\treturn this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);\r\n\t\t},\r\n\r\n\t\t_checkIfEmpty: function () {\r\n\t\t\tif (!this._map) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar vp = this._map._pathViewport,\r\n\t\t\t\tr = this._radius,\r\n\t\t\t\tp = this._point;\r\n\r\n\t\t\treturn p.x - r > vp.max.x || p.y - r > vp.max.y ||\r\n\t\t\t\tp.x + r < vp.min.x || p.y + r < vp.min.y;\r\n\t\t}\r\n\t});\r\n\r\n\tL.circle = function (latlng, radius, options) {\r\n\t\treturn new L.Circle(latlng, radius, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.CircleMarker is a circle overlay with a permanent pixel radius.\r\n\t */\r\n\r\n\tL.CircleMarker = L.Circle.extend({\r\n\t\toptions: {\r\n\t\t\tradius: 10,\r\n\t\t\tweight: 2\r\n\t\t},\r\n\r\n\t\tinitialize: function (latlng, options) {\r\n\t\t\tL.Circle.prototype.initialize.call(this, latlng, null, options);\r\n\t\t\tthis._radius = this.options.radius;\r\n\t\t},\r\n\r\n\t\tprojectLatlngs: function () {\r\n\t\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t\t},\r\n\r\n\t\t_updateStyle : function () {\r\n\t\t\tL.Circle.prototype._updateStyle.call(this);\r\n\t\t\tthis.setRadius(this.options.radius);\r\n\t\t},\r\n\r\n\t\tsetLatLng: function (latlng) {\r\n\t\t\tL.Circle.prototype.setLatLng.call(this, latlng);\r\n\t\t\tif (this._popup && this._popup._isOpen) {\r\n\t\t\t\tthis._popup.setLatLng(latlng);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetRadius: function (radius) {\r\n\t\t\tthis.options.radius = this._radius = radius;\r\n\t\t\treturn this.redraw();\r\n\t\t},\r\n\r\n\t\tgetRadius: function () {\r\n\t\t\treturn this._radius;\r\n\t\t}\r\n\t});\r\n\r\n\tL.circleMarker = function (latlng, options) {\r\n\t\treturn new L.CircleMarker(latlng, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.\r\n\t */\r\n\r\n\tL.Polyline.include(!L.Path.CANVAS ? {} : {\r\n\t\t_containsPoint: function (p, closed) {\r\n\t\t\tvar i, j, k, len, len2, dist, part,\r\n\t\t\t\tw = this.options.weight / 2;\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tw += 10; // polyline click tolerance on touch devices\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\t\tpart = this._parts[i];\r\n\t\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\t\tif (!closed && (j === 0)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);\r\n\r\n\t\t\t\t\tif (dist <= w) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.\r\n\t */\r\n\r\n\tL.Polygon.include(!L.Path.CANVAS ? {} : {\r\n\t\t_containsPoint: function (p) {\r\n\t\t\tvar inside = false,\r\n\t\t\t\tpart, p1, p2,\r\n\t\t\t\ti, j, k,\r\n\t\t\t\tlen, len2;\r\n\r\n\t\t\t// TODO optimization: check if within bounds first\r\n\r\n\t\t\tif (L.Polyline.prototype._containsPoint.call(this, p, true)) {\r\n\t\t\t\t// click on polygon border\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// ray casting algorithm for detecting if point is in polygon\r\n\r\n\t\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\t\tpart = this._parts[i];\r\n\r\n\t\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\t\tp1 = part[j];\r\n\t\t\t\t\tp2 = part[k];\r\n\r\n\t\t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) &&\r\n\t\t\t\t\t\t(p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n\t\t\t\t\t\tinside = !inside;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn inside;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.Circle with Canvas-specific code.\r\n\t */\r\n\r\n\tL.Circle.include(!L.Path.CANVAS ? {} : {\r\n\t\t_drawPath: function () {\r\n\t\t\tvar p = this._point;\r\n\t\t\tthis._ctx.beginPath();\r\n\t\t\tthis._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);\r\n\t\t},\r\n\r\n\t\t_containsPoint: function (p) {\r\n\t\t\tvar center = this._point,\r\n\t\t\t\tw2 = this.options.stroke ? this.options.weight / 2 : 0;\r\n\r\n\t\t\treturn (p.distanceTo(center) <= this._radius + w2);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * CircleMarker canvas specific drawing parts.\r\n\t */\r\n\r\n\tL.CircleMarker.include(!L.Path.CANVAS ? {} : {\r\n\t\t_updateStyle: function () {\r\n\t\t\tL.Path.prototype._updateStyle.call(this);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.GeoJSON turns any GeoJSON data into a Leaflet layer.\r\n\t */\r\n\r\n\tL.GeoJSON = L.FeatureGroup.extend({\r\n\r\n\t\tinitialize: function (geojson, options) {\r\n\t\t\tL.setOptions(this, options);\r\n\r\n\t\t\tthis._layers = {};\r\n\r\n\t\t\tif (geojson) {\r\n\t\t\t\tthis.addData(geojson);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddData: function (geojson) {\r\n\t\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t\t\ti, len, feature;\r\n\r\n\t\t\tif (features) {\r\n\t\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\t\tfeature = features[i];\r\n\t\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tvar options = this.options;\r\n\r\n\t\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\t\tvar layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);\r\n\t\t\tlayer.feature = L.GeoJSON.asFeature(geojson);\r\n\r\n\t\t\tlayer.defaultOptions = layer.options;\r\n\t\t\tthis.resetStyle(layer);\r\n\r\n\t\t\tif (options.onEachFeature) {\r\n\t\t\t\toptions.onEachFeature(geojson, layer);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.addLayer(layer);\r\n\t\t},\r\n\r\n\t\tresetStyle: function (layer) {\r\n\t\t\tvar style = this.options.style;\r\n\t\t\tif (style) {\r\n\t\t\t\t// reset any custom styles\r\n\t\t\t\tL.Util.extend(layer.options, layer.defaultOptions);\r\n\r\n\t\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetStyle: function (style) {\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\t_setLayerStyle: function (layer, style) {\r\n\t\t\tif (typeof style === 'function') {\r\n\t\t\t\tstyle = style(layer.feature);\r\n\t\t\t}\r\n\t\t\tif (layer.setStyle) {\r\n\t\t\t\tlayer.setStyle(style);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.extend(L.GeoJSON, {\r\n\t\tgeometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {\r\n\t\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t\t\tcoords = geometry.coordinates,\r\n\t\t\t\tlayers = [],\r\n\t\t\t\tlatlng, latlngs, i, len;\r\n\r\n\t\t\tcoordsToLatLng = coordsToLatLng || this.coordsToLatLng;\r\n\r\n\t\t\tswitch (geometry.type) {\r\n\t\t\t\tcase 'Point':\r\n\t\t\t\t\tlatlng = coordsToLatLng(coords);\r\n\t\t\t\t\treturn pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);\r\n\r\n\t\t\t\tcase 'MultiPoint':\r\n\t\t\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\t\t\tlatlng = coordsToLatLng(coords[i]);\r\n\t\t\t\t\t\tlayers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tlatlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);\r\n\t\t\t\t\treturn new L.Polyline(latlngs, vectorOptions);\r\n\r\n\t\t\t\tcase 'Polygon':\r\n\t\t\t\t\tif (coords.length === 2 && !coords[1].length) {\r\n\t\t\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\t\t\treturn new L.Polygon(latlngs, vectorOptions);\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\t\t\treturn new L.MultiPolyline(latlngs, vectorOptions);\r\n\r\n\t\t\t\tcase 'MultiPolygon':\r\n\t\t\t\t\tlatlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);\r\n\t\t\t\t\treturn new L.MultiPolygon(latlngs, vectorOptions);\r\n\r\n\t\t\t\tcase 'GeometryCollection':\r\n\t\t\t\t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n\r\n\t\t\t\t\t\tlayers.push(this.geometryToLayer({\r\n\t\t\t\t\t\t\tgeometry: geometry.geometries[i],\r\n\t\t\t\t\t\t\ttype: 'Feature',\r\n\t\t\t\t\t\t\tproperties: geojson.properties\r\n\t\t\t\t\t\t}, pointToLayer, coordsToLatLng, vectorOptions));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t\t},\r\n\r\n\t\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\t\tvar latlng, i, len,\r\n\t\t\t\tlatlngs = [];\r\n\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = levelsDeep ?\r\n\t\t\t\t\tthis.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t\t\t(coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\t\tlatlngs.push(latlng);\r\n\t\t\t}\r\n\r\n\t\t\treturn latlngs;\r\n\t\t},\r\n\r\n\t\tlatLngToCoords: function (latlng) {\r\n\t\t\tvar coords = [latlng.lng, latlng.lat];\r\n\r\n\t\t\tif (latlng.alt !== undefined) {\r\n\t\t\t\tcoords.push(latlng.alt);\r\n\t\t\t}\r\n\t\t\treturn coords;\r\n\t\t},\r\n\r\n\t\tlatLngsToCoords: function (latLngs) {\r\n\t\t\tvar coords = [];\r\n\r\n\t\t\tfor (var i = 0, len = latLngs.length; i < len; i++) {\r\n\t\t\t\tcoords.push(L.GeoJSON.latLngToCoords(latLngs[i]));\r\n\t\t\t}\r\n\r\n\t\t\treturn coords;\r\n\t\t},\r\n\r\n\t\tgetFeature: function (layer, newGeometry) {\r\n\t\t\treturn layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);\r\n\t\t},\r\n\r\n\t\tasFeature: function (geoJSON) {\r\n\t\t\tif (geoJSON.type === 'Feature') {\r\n\t\t\t\treturn geoJSON;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'Feature',\r\n\t\t\t\tproperties: {},\r\n\t\t\t\tgeometry: geoJSON\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tvar PointToGeoJSON = {\r\n\t\ttoGeoJSON: function () {\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: 'Point',\r\n\t\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tL.Marker.include(PointToGeoJSON);\r\n\tL.Circle.include(PointToGeoJSON);\r\n\tL.CircleMarker.include(PointToGeoJSON);\r\n\r\n\tL.Polyline.include({\r\n\t\ttoGeoJSON: function () {\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: 'LineString',\r\n\t\t\t\tcoordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tL.Polygon.include({\r\n\t\ttoGeoJSON: function () {\r\n\t\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t\t\ti, len, hole;\r\n\r\n\t\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\t\tif (this._holes) {\r\n\t\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\t\thole.push(hole[0]);\r\n\t\t\t\t\tcoords.push(hole);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: 'Polygon',\r\n\t\t\t\tcoordinates: coords\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t(function () {\r\n\t\tfunction multiToGeoJSON(type) {\r\n\t\t\treturn function () {\r\n\t\t\t\tvar coords = [];\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tcoords.push(layer.toGeoJSON().geometry.coordinates);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tcoordinates: coords\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tL.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});\r\n\t\tL.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});\r\n\r\n\t\tL.LayerGroup.include({\r\n\t\t\ttoGeoJSON: function () {\r\n\r\n\t\t\t\tvar geometry = this.feature && this.feature.geometry,\r\n\t\t\t\t\tjsons = [],\r\n\t\t\t\t\tjson;\r\n\r\n\t\t\t\tif (geometry && geometry.type === 'MultiPoint') {\r\n\t\t\t\t\treturn multiToGeoJSON('MultiPoint').call(this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tif (layer.toGeoJSON) {\r\n\t\t\t\t\t\tjson = layer.toGeoJSON();\r\n\t\t\t\t\t\tjsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (isGeometryCollection) {\r\n\t\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\t\tgeometries: jsons,\r\n\t\t\t\t\t\ttype: 'GeometryCollection'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: 'FeatureCollection',\r\n\t\t\t\t\tfeatures: jsons\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t}());\r\n\r\n\tL.geoJson = function (geojson, options) {\r\n\t\treturn new L.GeoJSON(geojson, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.DomEvent contains functions for working with DOM events.\r\n\t */\r\n\r\n\tL.DomEvent = {\r\n\t\t/* inspired by John Resig, Dean Edwards and YUI addEvent implementations */\r\n\t\taddListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])\r\n\r\n\t\t\tvar id = L.stamp(fn),\r\n\t\t\t\tkey = '_leaflet_' + type + id,\r\n\t\t\t\thandler, originalHandler, newType;\r\n\r\n\t\t\tif (obj[key]) { return this; }\r\n\r\n\t\t\thandler = function (e) {\r\n\t\t\t\treturn fn.call(context || obj, e || L.DomEvent._getEvent());\r\n\t\t\t};\r\n\r\n\t\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\t\treturn this.addPointerListener(obj, type, handler, id);\r\n\t\t\t}\r\n\t\t\tif (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {\r\n\t\t\t\tthis.addDoubleTapListener(obj, handler, id);\r\n\t\t\t}\r\n\r\n\t\t\tif ('addEventListener' in obj) {\r\n\r\n\t\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\t\tobj.addEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\t\tobj.addEventListener(type, handler, false);\r\n\r\n\t\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\r\n\t\t\t\t\toriginalHandler = handler;\r\n\t\t\t\t\tnewType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');\r\n\r\n\t\t\t\t\thandler = function (e) {\r\n\t\t\t\t\t\tif (!L.DomEvent._checkMouse(obj, e)) { return; }\r\n\t\t\t\t\t\treturn originalHandler(e);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tobj.addEventListener(newType, handler, false);\r\n\r\n\t\t\t\t} else if (type === 'click' && L.Browser.android) {\r\n\t\t\t\t\toriginalHandler = handler;\r\n\t\t\t\t\thandler = function (e) {\r\n\t\t\t\t\t\treturn L.DomEvent._filterClick(e, originalHandler);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ('attachEvent' in obj) {\r\n\t\t\t\tobj.attachEvent('on' + type, handler);\r\n\t\t\t}\r\n\r\n\t\t\tobj[key] = handler;\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveListener: function (obj, type, fn) {  // (HTMLElement, String, Function)\r\n\r\n\t\t\tvar id = L.stamp(fn),\r\n\t\t\t\tkey = '_leaflet_' + type + id,\r\n\t\t\t\thandler = obj[key];\r\n\r\n\t\t\tif (!handler) { return this; }\r\n\r\n\t\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\t\tthis.removePointerListener(obj, type, id);\r\n\t\t\t} else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {\r\n\t\t\t\tthis.removeDoubleTapListener(obj, id);\r\n\r\n\t\t\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\t\tobj.removeEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\r\n\t\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\t\t\tobj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\t\t\t\t}\r\n\t\t\t} else if ('detachEvent' in obj) {\r\n\t\t\t\tobj.detachEvent('on' + type, handler);\r\n\t\t\t}\r\n\r\n\t\t\tobj[key] = null;\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tstopPropagation: function (e) {\r\n\r\n\t\t\tif (e.stopPropagation) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t} else {\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t}\r\n\t\t\tL.DomEvent._skipped(e);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tdisableScrollPropagation: function (el) {\r\n\t\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\t\treturn L.DomEvent\r\n\t\t\t\t.on(el, 'mousewheel', stop)\r\n\t\t\t\t.on(el, 'MozMousePixelScroll', stop);\r\n\t\t},\r\n\r\n\t\tdisableClickPropagation: function (el) {\r\n\t\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\t\tL.DomEvent.on(el, L.Draggable.START[i], stop);\r\n\t\t\t}\r\n\r\n\t\t\treturn L.DomEvent\r\n\t\t\t\t.on(el, 'click', L.DomEvent._fakeStop)\r\n\t\t\t\t.on(el, 'dblclick', stop);\r\n\t\t},\r\n\r\n\t\tpreventDefault: function (e) {\r\n\r\n\t\t\tif (e.preventDefault) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tstop: function (e) {\r\n\t\t\treturn L.DomEvent\r\n\t\t\t\t.preventDefault(e)\r\n\t\t\t\t.stopPropagation(e);\r\n\t\t},\r\n\r\n\t\tgetMousePosition: function (e, container) {\r\n\t\t\tif (!container) {\r\n\t\t\t\treturn new L.Point(e.clientX, e.clientY);\r\n\t\t\t}\r\n\r\n\t\t\tvar rect = container.getBoundingClientRect();\r\n\r\n\t\t\treturn new L.Point(\r\n\t\t\t\te.clientX - rect.left - container.clientLeft,\r\n\t\t\t\te.clientY - rect.top - container.clientTop);\r\n\t\t},\r\n\r\n\t\tgetWheelDelta: function (e) {\r\n\r\n\t\t\tvar delta = 0;\r\n\r\n\t\t\tif (e.wheelDelta) {\r\n\t\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t\t}\r\n\t\t\tif (e.detail) {\r\n\t\t\t\tdelta = -e.detail / 3;\r\n\t\t\t}\r\n\t\t\treturn delta;\r\n\t\t},\r\n\r\n\t\t_skipEvents: {},\r\n\r\n\t\t_fakeStop: function (e) {\r\n\t\t\t// fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)\r\n\t\t\tL.DomEvent._skipEvents[e.type] = true;\r\n\t\t},\r\n\r\n\t\t_skipped: function (e) {\r\n\t\t\tvar skipped = this._skipEvents[e.type];\r\n\t\t\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\t\t\tthis._skipEvents[e.type] = false;\r\n\t\t\treturn skipped;\r\n\t\t},\r\n\r\n\t\t// check if element really left/entered the event target (for mouseenter/mouseleave)\r\n\t\t_checkMouse: function (el, e) {\r\n\r\n\t\t\tvar related = e.relatedTarget;\r\n\r\n\t\t\tif (!related) { return true; }\r\n\r\n\t\t\ttry {\r\n\t\t\t\twhile (related && (related !== el)) {\r\n\t\t\t\t\trelated = related.parentNode;\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn (related !== el);\r\n\t\t},\r\n\r\n\t\t_getEvent: function () { // evil magic for IE\r\n\t\t\t/*jshint noarg:false */\r\n\t\t\tvar e = window.event;\r\n\t\t\tif (!e) {\r\n\t\t\t\tvar caller = arguments.callee.caller;\r\n\t\t\t\twhile (caller) {\r\n\t\t\t\t\te = caller['arguments'][0];\r\n\t\t\t\t\tif (e && window.Event === e.constructor) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcaller = caller.caller;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t},\r\n\r\n\t\t// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\n\t\t_filterClick: function (e, handler) {\r\n\t\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\r\n\t\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\r\n\r\n\t\t\t// are they closer together than 1000ms yet more than 100ms?\r\n\t\t\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t\t\t// on the same event should be triggered far faster;\r\n\t\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\t\t\tif ((elapsed && elapsed > 100 && elapsed < 1000) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\t\t\tL.DomEvent.stop(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tL.DomEvent._lastClick = timeStamp;\r\n\r\n\t\t\treturn handler(e);\r\n\t\t}\r\n\t};\r\n\r\n\tL.DomEvent.on = L.DomEvent.addListener;\r\n\tL.DomEvent.off = L.DomEvent.removeListener;\r\n\r\n\r\n\t/*\r\n\t * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.\r\n\t */\r\n\r\n\tL.Draggable = L.Class.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\tstatics: {\r\n\t\t\tSTART: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],\r\n\t\t\tEND: {\r\n\t\t\t\tmousedown: 'mouseup',\r\n\t\t\t\ttouchstart: 'touchend',\r\n\t\t\t\tpointerdown: 'touchend',\r\n\t\t\t\tMSPointerDown: 'touchend'\r\n\t\t\t},\r\n\t\t\tMOVE: {\r\n\t\t\t\tmousedown: 'mousemove',\r\n\t\t\t\ttouchstart: 'touchmove',\r\n\t\t\t\tpointerdown: 'touchmove',\r\n\t\t\t\tMSPointerDown: 'touchmove'\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitialize: function (element, dragStartTarget) {\r\n\t\t\tthis._element = element;\r\n\t\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t\t},\r\n\r\n\t\tenable: function () {\r\n\t\t\tif (this._enabled) { return; }\r\n\r\n\t\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\t\tL.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._enabled = true;\r\n\t\t},\r\n\r\n\t\tdisable: function () {\r\n\t\t\tif (!this._enabled) { return; }\r\n\r\n\t\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\t\tL.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._enabled = false;\r\n\t\t\tthis._moved = false;\r\n\t\t},\r\n\r\n\t\t_onDown: function (e) {\r\n\t\t\tthis._moved = false;\r\n\r\n\t\t\tif (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\r\n\t\t\tif (L.Draggable._disabled) { return; }\r\n\r\n\t\t\tL.DomUtil.disableImageDrag();\r\n\t\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\t\tif (this._moving) { return; }\r\n\r\n\t\t\tvar first = e.touches ? e.touches[0] : e;\r\n\r\n\t\t\tthis._startPoint = new L.Point(first.clientX, first.clientY);\r\n\t\t\tthis._startPos = this._newPos = L.DomUtil.getPosition(this._element);\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(document, L.Draggable.MOVE[e.type], this._onMove, this)\r\n\t\t\t\t.on(document, L.Draggable.END[e.type], this._onUp, this);\r\n\t\t},\r\n\r\n\t\t_onMove: function (e) {\r\n\t\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\t\tthis._moved = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n\t\t\t\tnewPoint = new L.Point(first.clientX, first.clientY),\r\n\t\t\t\toffset = newPoint.subtract(this._startPoint);\r\n\r\n\t\t\tif (!offset.x && !offset.y) { return; }\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\t\tif (!this._moved) {\r\n\t\t\t\tthis.fire('dragstart');\r\n\r\n\t\t\t\tthis._moved = true;\r\n\t\t\t\tthis._startPos = L.DomUtil.getPosition(this._element).subtract(offset);\r\n\r\n\t\t\t\tL.DomUtil.addClass(document.body, 'leaflet-dragging');\r\n\t\t\t\tL.DomUtil.addClass((e.target || e.srcElement), 'leaflet-drag-target');\r\n\t\t\t}\r\n\r\n\t\t\tthis._newPos = this._startPos.add(offset);\r\n\t\t\tthis._moving = true;\r\n\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\t\tthis._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);\r\n\t\t},\r\n\r\n\t\t_updatePosition: function () {\r\n\t\t\tthis.fire('predrag');\r\n\t\t\tL.DomUtil.setPosition(this._element, this._newPos);\r\n\t\t\tthis.fire('drag');\r\n\t\t},\r\n\r\n\t\t_onUp: function (e) {\r\n\t\t\tL.DomUtil.removeClass(document.body, 'leaflet-dragging');\r\n\t\t\tL.DomUtil.removeClass((e.target || e.srcElement), 'leaflet-drag-target');\r\n\r\n\t\t\tfor (var i in L.Draggable.MOVE) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t\t.off(document, L.Draggable.MOVE[i], this._onMove)\r\n\t\t\t\t\t.off(document, L.Draggable.END[i], this._onUp);\r\n\t\t\t}\r\n\r\n\t\t\tL.DomUtil.enableImageDrag();\r\n\t\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\t\tif (this._moved && this._moving) {\r\n\t\t\t\t// ensure drag is not fired after dragend\r\n\t\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\t\tthis.fire('dragend', {\r\n\t\t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis._moving = false;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t L.Handler is a base class for handler classes that are used internally to inject\r\n\t interaction features like dragging to classes like Map and Marker.\r\n\t */\r\n\r\n\tL.Handler = L.Class.extend({\r\n\t\tinitialize: function (map) {\r\n\t\t\tthis._map = map;\r\n\t\t},\r\n\r\n\t\tenable: function () {\r\n\t\t\tif (this._enabled) { return; }\r\n\r\n\t\t\tthis._enabled = true;\r\n\t\t\tthis.addHooks();\r\n\t\t},\r\n\r\n\t\tdisable: function () {\r\n\t\t\tif (!this._enabled) { return; }\r\n\r\n\t\t\tthis._enabled = false;\r\n\t\t\tthis.removeHooks();\r\n\t\t},\r\n\r\n\t\tenabled: function () {\r\n\t\t\treturn !!this._enabled;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tdragging: true,\r\n\r\n\t\tinertia: !L.Browser.android23,\r\n\t\tinertiaDeceleration: 3400, // px/s^2\r\n\t\tinertiaMaxSpeed: Infinity, // px/s\r\n\t\tinertiaThreshold: L.Browser.touch ? 32 : 18, // ms\r\n\t\teaseLinearity: 0.25,\r\n\r\n\t\t// TODO refactor, move to CRS\r\n\t\tworldCopyJump: false\r\n\t});\r\n\r\n\tL.Map.Drag = L.Handler.extend({\r\n\t\taddHooks: function () {\r\n\t\t\tif (!this._draggable) {\r\n\t\t\t\tvar map = this._map;\r\n\r\n\t\t\t\tthis._draggable = new L.Draggable(map._mapPane, map._container);\r\n\r\n\t\t\t\tthis._draggable.on({\r\n\t\t\t\t\t'dragstart': this._onDragStart,\r\n\t\t\t\t\t'drag': this._onDrag,\r\n\t\t\t\t\t'dragend': this._onDragEnd\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\tif (map.options.worldCopyJump) {\r\n\t\t\t\t\tthis._draggable.on('predrag', this._onPreDrag, this);\r\n\t\t\t\t\tmap.on('viewreset', this._onViewReset, this);\r\n\r\n\t\t\t\t\tmap.whenReady(this._onViewReset, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._draggable.enable();\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tthis._draggable.disable();\r\n\t\t},\r\n\r\n\t\tmoved: function () {\r\n\t\t\treturn this._draggable && this._draggable._moved;\r\n\t\t},\r\n\r\n\t\t_onDragStart: function () {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tif (map._panAnim) {\r\n\t\t\t\tmap._panAnim.stop();\r\n\t\t\t}\r\n\r\n\t\t\tmap\r\n\t\t\t\t.fire('movestart')\r\n\t\t\t\t.fire('dragstart');\r\n\r\n\t\t\tif (map.options.inertia) {\r\n\t\t\t\tthis._positions = [];\r\n\t\t\t\tthis._times = [];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onDrag: function () {\r\n\t\t\tif (this._map.options.inertia) {\r\n\t\t\t\tvar time = this._lastTime = +new Date(),\r\n\t\t\t\t\tpos = this._lastPos = this._draggable._newPos;\r\n\r\n\t\t\t\tthis._positions.push(pos);\r\n\t\t\t\tthis._times.push(time);\r\n\r\n\t\t\t\tif (time - this._times[0] > 200) {\r\n\t\t\t\t\tthis._positions.shift();\r\n\t\t\t\t\tthis._times.shift();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.fire('move')\r\n\t\t\t\t.fire('drag');\r\n\t\t},\r\n\r\n\t\t_onViewReset: function () {\r\n\t\t\t// TODO fix hardcoded Earth values\r\n\t\t\tvar pxCenter = this._map.getSize()._divideBy(2),\r\n\t\t\t\tpxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\r\n\r\n\t\t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\r\n\t\t\tthis._worldWidth = this._map.project([0, 180]).x;\r\n\t\t},\r\n\r\n\t\t_onPreDrag: function () {\r\n\t\t\t// TODO refactor to be able to adjust map pane position after zoom\r\n\t\t\tvar worldWidth = this._worldWidth,\r\n\t\t\t\thalfWidth = Math.round(worldWidth / 2),\r\n\t\t\t\tdx = this._initialWorldOffset,\r\n\t\t\t\tx = this._draggable._newPos.x,\r\n\t\t\t\tnewX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\r\n\t\t\t\tnewX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\r\n\t\t\t\tnewX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\r\n\r\n\t\t\tthis._draggable._newPos.x = newX;\r\n\t\t},\r\n\r\n\t\t_onDragEnd: function (e) {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\toptions = map.options,\r\n\t\t\t\tdelay = +new Date() - this._lastTime,\r\n\r\n\t\t\t\tnoInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];\r\n\r\n\t\t\tmap.fire('dragend', e);\r\n\r\n\t\t\tif (noInertia) {\r\n\t\t\t\tmap.fire('moveend');\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\r\n\t\t\t\t\tduration = (this._lastTime + delay - this._times[0]) / 1000,\r\n\t\t\t\t\tease = options.easeLinearity,\r\n\r\n\t\t\t\t\tspeedVector = direction.multiplyBy(ease / duration),\r\n\t\t\t\t\tspeed = speedVector.distanceTo([0, 0]),\r\n\r\n\t\t\t\t\tlimitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\r\n\t\t\t\t\tlimitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\r\n\r\n\t\t\t\t\tdecelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\r\n\t\t\t\t\toffset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\r\n\r\n\t\t\t\tif (!offset.x || !offset.y) {\r\n\t\t\t\t\tmap.fire('moveend');\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\r\n\r\n\t\t\t\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\t\t\t\tmap.panBy(offset, {\r\n\t\t\t\t\t\t\tduration: decelerationDuration,\r\n\t\t\t\t\t\t\teaseLinearity: ease,\r\n\t\t\t\t\t\t\tnoMoveStart: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);\r\n\r\n\r\n\t/*\r\n\t * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tdoubleClickZoom: true\r\n\t});\r\n\r\n\tL.Map.DoubleClickZoom = L.Handler.extend({\r\n\t\taddHooks: function () {\r\n\t\t\tthis._map.on('dblclick', this._onDoubleClick, this);\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tthis._map.off('dblclick', this._onDoubleClick, this);\r\n\t\t},\r\n\r\n\t\t_onDoubleClick: function (e) {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tzoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);\r\n\r\n\t\t\tif (map.options.doubleClickZoom === 'center') {\r\n\t\t\t\tmap.setZoom(zoom);\r\n\t\t\t} else {\r\n\t\t\t\tmap.setZoomAround(e.containerPoint, zoom);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);\r\n\r\n\r\n\t/*\r\n\t * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tscrollWheelZoom: true\r\n\t});\r\n\r\n\tL.Map.ScrollWheelZoom = L.Handler.extend({\r\n\t\taddHooks: function () {\r\n\t\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);\r\n\t\t\tL.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t\t\tthis._delta = 0;\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);\r\n\t\t\tL.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t\t},\r\n\r\n\t\t_onWheelScroll: function (e) {\r\n\t\t\tvar delta = L.DomEvent.getWheelDelta(e);\r\n\r\n\t\t\tthis._delta += delta;\r\n\t\t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\r\n\r\n\t\t\tif (!this._startTime) {\r\n\t\t\t\tthis._startTime = +new Date();\r\n\t\t\t}\r\n\r\n\t\t\tvar left = Math.max(40 - (+new Date() - this._startTime), 0);\r\n\r\n\t\t\tclearTimeout(this._timer);\r\n\t\t\tthis._timer = setTimeout(L.bind(this._performZoom, this), left);\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t},\r\n\r\n\t\t_performZoom: function () {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tdelta = this._delta,\r\n\t\t\t\tzoom = map.getZoom();\r\n\r\n\t\t\tdelta = delta > 0 ? Math.ceil(delta) : Math.floor(delta);\r\n\t\t\tdelta = Math.max(Math.min(delta, 4), -4);\r\n\t\t\tdelta = map._limitZoom(zoom + delta) - zoom;\r\n\r\n\t\t\tthis._delta = 0;\r\n\t\t\tthis._startTime = null;\r\n\r\n\t\t\tif (!delta) { return; }\r\n\r\n\t\t\tif (map.options.scrollWheelZoom === 'center') {\r\n\t\t\t\tmap.setZoom(zoom + delta);\r\n\t\t\t} else {\r\n\t\t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);\r\n\r\n\r\n\t/*\r\n\t * Extends the event handling code with double tap support for mobile browsers.\r\n\t */\r\n\r\n\tL.extend(L.DomEvent, {\r\n\r\n\t\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\r\n\t\t_touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',\r\n\r\n\t\t// inspired by Zepto touch code by Thomas Fuchs\r\n\t\taddDoubleTapListener: function (obj, handler, id) {\r\n\t\t\tvar last,\r\n\t\t\t\tdoubleTap = false,\r\n\t\t\t\tdelay = 250,\r\n\t\t\t\ttouch,\r\n\t\t\t\tpre = '_leaflet_',\r\n\t\t\t\ttouchstart = this._touchstart,\r\n\t\t\t\ttouchend = this._touchend,\r\n\t\t\t\ttrackedTouches = [];\r\n\r\n\t\t\tfunction onTouchStart(e) {\r\n\t\t\t\tvar count;\r\n\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\ttrackedTouches.push(e.pointerId);\r\n\t\t\t\t\tcount = trackedTouches.length;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcount = e.touches.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count > 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar now = Date.now(),\r\n\t\t\t\t\tdelta = now - (last || now);\r\n\r\n\t\t\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\t\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\t\t\tlast = now;\r\n\t\t\t}\r\n\r\n\t\t\tfunction onTouchEnd(e) {\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\tvar idx = trackedTouches.indexOf(e.pointerId);\r\n\t\t\t\t\tif (idx === -1) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttrackedTouches.splice(idx, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (doubleTap) {\r\n\t\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\t\t\tvar newTouch = { },\r\n\t\t\t\t\t\t\tprop;\r\n\r\n\t\t\t\t\t\t// jshint forin:false\r\n\t\t\t\t\t\tfor (var i in touch) {\r\n\t\t\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\t\t\tif (typeof prop === 'function') {\r\n\t\t\t\t\t\t\t\tnewTouch[i] = prop.bind(touch);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tnewTouch[i] = prop;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttouch = newTouch;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttouch.type = 'dblclick';\r\n\t\t\t\t\thandler(touch);\r\n\t\t\t\t\tlast = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tobj[pre + touchstart + id] = onTouchStart;\r\n\t\t\tobj[pre + touchend + id] = onTouchEnd;\r\n\r\n\t\t\t// on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen\r\n\t\t\t// will not come through to us, so we will lose track of how many touches are ongoing\r\n\t\t\tvar endElement = L.Browser.pointer ? document.documentElement : obj;\r\n\r\n\t\t\tobj.addEventListener(touchstart, onTouchStart, false);\r\n\t\t\tendElement.addEventListener(touchend, onTouchEnd, false);\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tendElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveDoubleTapListener: function (obj, id) {\r\n\t\t\tvar pre = '_leaflet_';\r\n\r\n\t\t\tobj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);\r\n\t\t\t(L.Browser.pointer ? document.documentElement : obj).removeEventListener(\r\n\t\t\t\tthis._touchend, obj[pre + this._touchend + id], false);\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tdocument.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],\r\n\t\t\t\t\tfalse);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\r\n\t */\r\n\r\n\tL.extend(L.DomEvent, {\r\n\r\n\t\t//static\r\n\t\tPOINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',\r\n\t\tPOINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',\r\n\t\tPOINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',\r\n\t\tPOINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\r\n\r\n\t\t_pointers: [],\r\n\t\t_pointerDocumentListener: false,\r\n\r\n\t\t// Provides a touch events wrapper for (ms)pointer events.\r\n\t\t// Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019\r\n\t\t//ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\r\n\r\n\t\taddPointerListener: function (obj, type, handler, id) {\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'touchstart':\r\n\t\t\t\t\treturn this.addPointerListenerStart(obj, type, handler, id);\r\n\t\t\t\tcase 'touchend':\r\n\t\t\t\t\treturn this.addPointerListenerEnd(obj, type, handler, id);\r\n\t\t\t\tcase 'touchmove':\r\n\t\t\t\t\treturn this.addPointerListenerMove(obj, type, handler, id);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow 'Unknown touch event type';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddPointerListenerStart: function (obj, type, handler, id) {\r\n\t\t\tvar pre = '_leaflet_',\r\n\t\t\t\tpointers = this._pointers;\r\n\r\n\t\t\tvar cb = function (e) {\r\n\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\t\t\tvar alreadyInArray = false;\r\n\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\talreadyInArray = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!alreadyInArray) {\r\n\t\t\t\t\tpointers.push(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\te.touches = pointers.slice();\r\n\t\t\t\te.changedTouches = [e];\r\n\r\n\t\t\t\thandler(e);\r\n\t\t\t};\r\n\r\n\t\t\tobj[pre + 'touchstart' + id] = cb;\r\n\t\t\tobj.addEventListener(this.POINTER_DOWN, cb, false);\r\n\r\n\t\t\t// need to also listen for end events to keep the _pointers list accurate\r\n\t\t\t// this needs to be on the body and never go away\r\n\t\t\tif (!this._pointerDocumentListener) {\r\n\t\t\t\tvar internalCb = function (e) {\r\n\t\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\t\tpointers.splice(i, 1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//We listen on the documentElement as any drags that end by moving the touch off the screen get fired there\r\n\t\t\t\tdocument.documentElement.addEventListener(this.POINTER_UP, internalCb, false);\r\n\t\t\t\tdocument.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);\r\n\r\n\t\t\t\tthis._pointerDocumentListener = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddPointerListenerMove: function (obj, type, handler, id) {\r\n\t\t\tvar pre = '_leaflet_',\r\n\t\t\t\ttouches = this._pointers;\r\n\r\n\t\t\tfunction cb(e) {\r\n\r\n\t\t\t\t// don't fire touch moves when mouse isn't down\r\n\t\t\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\r\n\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\ttouches[i] = e;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\te.touches = touches.slice();\r\n\t\t\t\te.changedTouches = [e];\r\n\r\n\t\t\t\thandler(e);\r\n\t\t\t}\r\n\r\n\t\t\tobj[pre + 'touchmove' + id] = cb;\r\n\t\t\tobj.addEventListener(this.POINTER_MOVE, cb, false);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddPointerListenerEnd: function (obj, type, handler, id) {\r\n\t\t\tvar pre = '_leaflet_',\r\n\t\t\t\ttouches = this._pointers;\r\n\r\n\t\t\tvar cb = function (e) {\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\ttouches.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\te.touches = touches.slice();\r\n\t\t\t\te.changedTouches = [e];\r\n\r\n\t\t\t\thandler(e);\r\n\t\t\t};\r\n\r\n\t\t\tobj[pre + 'touchend' + id] = cb;\r\n\t\t\tobj.addEventListener(this.POINTER_UP, cb, false);\r\n\t\t\tobj.addEventListener(this.POINTER_CANCEL, cb, false);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremovePointerListener: function (obj, type, id) {\r\n\t\t\tvar pre = '_leaflet_',\r\n\t\t\t\tcb = obj[pre + type + id];\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'touchstart':\r\n\t\t\t\t\tobj.removeEventListener(this.POINTER_DOWN, cb, false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'touchmove':\r\n\t\t\t\t\tobj.removeEventListener(this.POINTER_MOVE, cb, false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'touchend':\r\n\t\t\t\t\tobj.removeEventListener(this.POINTER_UP, cb, false);\r\n\t\t\t\t\tobj.removeEventListener(this.POINTER_CANCEL, cb, false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\ttouchZoom: L.Browser.touch && !L.Browser.android23,\r\n\t\tbounceAtZoomLimits: true\r\n\t});\r\n\r\n\tL.Map.TouchZoom = L.Handler.extend({\r\n\t\taddHooks: function () {\r\n\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t\t},\r\n\r\n\t\t_onTouchStart: function (e) {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\r\n\r\n\t\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t\t\tp2 = map.mouseEventToLayerPoint(e.touches[1]),\r\n\t\t\t\tviewCenter = map._getCenterLayerPoint();\r\n\r\n\t\t\tthis._startCenter = p1.add(p2)._divideBy(2);\r\n\t\t\tthis._startDist = p1.distanceTo(p2);\r\n\r\n\t\t\tthis._moved = false;\r\n\t\t\tthis._zooming = true;\r\n\r\n\t\t\tthis._centerOffset = viewCenter.subtract(this._startCenter);\r\n\r\n\t\t\tif (map._panAnim) {\r\n\t\t\t\tmap._panAnim.stop();\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(document, 'touchmove', this._onTouchMove, this)\r\n\t\t\t\t.on(document, 'touchend', this._onTouchEnd, this);\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t},\r\n\r\n\t\t_onTouchMove: function (e) {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\r\n\r\n\t\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t\t\tp2 = map.mouseEventToLayerPoint(e.touches[1]);\r\n\r\n\t\t\tthis._scale = p1.distanceTo(p2) / this._startDist;\r\n\t\t\tthis._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);\r\n\r\n\t\t\tif (this._scale === 1) { return; }\r\n\r\n\t\t\tif (!map.options.bounceAtZoomLimits) {\r\n\t\t\t\tif ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||\r\n\t\t\t\t\t(map.getZoom() === map.getMaxZoom() && this._scale > 1)) { return; }\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._moved) {\r\n\t\t\t\tL.DomUtil.addClass(map._mapPane, 'leaflet-touching');\r\n\r\n\t\t\t\tmap\r\n\t\t\t\t\t.fire('movestart')\r\n\t\t\t\t\t.fire('zoomstart');\r\n\r\n\t\t\t\tthis._moved = true;\r\n\t\t\t}\r\n\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\t\tthis._animRequest = L.Util.requestAnimFrame(\r\n\t\t\t\tthis._updateOnMove, this, true, this._map._container);\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t},\r\n\r\n\t\t_updateOnMove: function () {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\torigin = this._getScaleOrigin(),\r\n\t\t\t\tcenter = map.layerPointToLatLng(origin),\r\n\t\t\t\tzoom = map.getScaleZoom(this._scale);\r\n\r\n\t\t\tmap._animateZoom(center, zoom, this._startCenter, this._scale, this._delta);\r\n\t\t},\r\n\r\n\t\t_onTouchEnd: function () {\r\n\t\t\tif (!this._moved || !this._zooming) {\r\n\t\t\t\tthis._zooming = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tthis._zooming = false;\r\n\t\t\tL.DomUtil.removeClass(map._mapPane, 'leaflet-touching');\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.off(document, 'touchmove', this._onTouchMove)\r\n\t\t\t\t.off(document, 'touchend', this._onTouchEnd);\r\n\r\n\t\t\tvar origin = this._getScaleOrigin(),\r\n\t\t\t\tcenter = map.layerPointToLatLng(origin),\r\n\r\n\t\t\t\toldZoom = map.getZoom(),\r\n\t\t\t\tfloatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,\r\n\t\t\t\troundZoomDelta = (floatZoomDelta > 0 ?\r\n\t\t\t\t\tMath.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),\r\n\r\n\t\t\t\tzoom = map._limitZoom(oldZoom + roundZoomDelta),\r\n\t\t\t\tscale = map.getZoomScale(zoom) / this._scale;\r\n\r\n\t\t\tmap._animateZoom(center, zoom, origin, scale);\r\n\t\t},\r\n\r\n\t\t_getScaleOrigin: function () {\r\n\t\t\tvar centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);\r\n\t\t\treturn this._startCenter.add(centerOffset);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);\r\n\r\n\r\n\t/*\r\n\t * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\ttap: true,\r\n\t\ttapTolerance: 15\r\n\t});\r\n\r\n\tL.Map.Tap = L.Handler.extend({\r\n\t\taddHooks: function () {\r\n\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);\r\n\t\t},\r\n\r\n\t\t_onDown: function (e) {\r\n\t\t\tif (!e.touches) { return; }\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\t\tthis._fireClick = true;\r\n\r\n\t\t\t// don't simulate click or track longpress if more than 1 touch\r\n\t\t\tif (e.touches.length > 1) {\r\n\t\t\t\tthis._fireClick = false;\r\n\t\t\t\tclearTimeout(this._holdTimeout);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar first = e.touches[0],\r\n\t\t\t\tel = first.target;\r\n\r\n\t\t\tthis._startPos = this._newPos = new L.Point(first.clientX, first.clientY);\r\n\r\n\t\t\t// if touching a link, highlight it\r\n\t\t\tif (el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\t\tL.DomUtil.addClass(el, 'leaflet-active');\r\n\t\t\t}\r\n\r\n\t\t\t// simulate long hold but setting a timeout\r\n\t\t\tthis._holdTimeout = setTimeout(L.bind(function () {\r\n\t\t\t\tif (this._isTapValid()) {\r\n\t\t\t\t\tthis._fireClick = false;\r\n\t\t\t\t\tthis._onUp();\r\n\t\t\t\t\tthis._simulateEvent('contextmenu', first);\r\n\t\t\t\t}\r\n\t\t\t}, this), 1000);\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(document, 'touchmove', this._onMove, this)\r\n\t\t\t\t.on(document, 'touchend', this._onUp, this);\r\n\t\t},\r\n\r\n\t\t_onUp: function (e) {\r\n\t\t\tclearTimeout(this._holdTimeout);\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.off(document, 'touchmove', this._onMove, this)\r\n\t\t\t\t.off(document, 'touchend', this._onUp, this);\r\n\r\n\t\t\tif (this._fireClick && e && e.changedTouches) {\r\n\r\n\t\t\t\tvar first = e.changedTouches[0],\r\n\t\t\t\t\tel = first.target;\r\n\r\n\t\t\t\tif (el && el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\t\t\tL.DomUtil.removeClass(el, 'leaflet-active');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// simulate click if the touch didn't move too much\r\n\t\t\t\tif (this._isTapValid()) {\r\n\t\t\t\t\tthis._simulateEvent('click', first);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_isTapValid: function () {\r\n\t\t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\r\n\t\t},\r\n\r\n\t\t_onMove: function (e) {\r\n\t\t\tvar first = e.touches[0];\r\n\t\t\tthis._newPos = new L.Point(first.clientX, first.clientY);\r\n\t\t},\r\n\r\n\t\t_simulateEvent: function (type, e) {\r\n\t\t\tvar simulatedEvent = document.createEvent('MouseEvents');\r\n\r\n\t\t\tsimulatedEvent._simulated = true;\r\n\t\t\te.target._simulatedClick = true;\r\n\r\n\t\t\tsimulatedEvent.initMouseEvent(\r\n\t\t\t\ttype, true, true, window, 1,\r\n\t\t\t\te.screenX, e.screenY,\r\n\t\t\t\te.clientX, e.clientY,\r\n\t\t\t\tfalse, false, false, false, 0, null);\r\n\r\n\t\t\te.target.dispatchEvent(simulatedEvent);\r\n\t\t}\r\n\t});\r\n\r\n\tif (L.Browser.touch && !L.Browser.pointer) {\r\n\t\tL.Map.addInitHook('addHandler', 'tap', L.Map.Tap);\r\n\t}\r\n\r\n\r\n\t/*\r\n\t * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map\r\n\t * (zoom to a selected bounding box), enabled by default.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tboxZoom: true\r\n\t});\r\n\r\n\tL.Map.BoxZoom = L.Handler.extend({\r\n\t\tinitialize: function (map) {\r\n\t\t\tthis._map = map;\r\n\t\t\tthis._container = map._container;\r\n\t\t\tthis._pane = map._panes.overlayPane;\r\n\t\t\tthis._moved = false;\r\n\t\t},\r\n\r\n\t\taddHooks: function () {\r\n\t\t\tL.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tL.DomEvent.off(this._container, 'mousedown', this._onMouseDown);\r\n\t\t\tthis._moved = false;\r\n\t\t},\r\n\r\n\t\tmoved: function () {\r\n\t\t\treturn this._moved;\r\n\t\t},\r\n\r\n\t\t_onMouseDown: function (e) {\r\n\t\t\tthis._moved = false;\r\n\r\n\t\t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\r\n\r\n\t\t\tL.DomUtil.disableTextSelection();\r\n\t\t\tL.DomUtil.disableImageDrag();\r\n\r\n\t\t\tthis._startLayerPoint = this._map.mouseEventToLayerPoint(e);\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(document, 'mousemove', this._onMouseMove, this)\r\n\t\t\t\t.on(document, 'mouseup', this._onMouseUp, this)\r\n\t\t\t\t.on(document, 'keydown', this._onKeyDown, this);\r\n\t\t},\r\n\r\n\t\t_onMouseMove: function (e) {\r\n\t\t\tif (!this._moved) {\r\n\t\t\t\tthis._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);\r\n\t\t\t\tL.DomUtil.setPosition(this._box, this._startLayerPoint);\r\n\r\n\t\t\t\t//TODO refactor: move cursor to styles\r\n\t\t\t\tthis._container.style.cursor = 'crosshair';\r\n\t\t\t\tthis._map.fire('boxzoomstart');\r\n\t\t\t}\r\n\r\n\t\t\tvar startPoint = this._startLayerPoint,\r\n\t\t\t\tbox = this._box,\r\n\r\n\t\t\t\tlayerPoint = this._map.mouseEventToLayerPoint(e),\r\n\t\t\t\toffset = layerPoint.subtract(startPoint),\r\n\r\n\t\t\t\tnewPos = new L.Point(\r\n\t\t\t\t\tMath.min(layerPoint.x, startPoint.x),\r\n\t\t\t\t\tMath.min(layerPoint.y, startPoint.y));\r\n\r\n\t\t\tL.DomUtil.setPosition(box, newPos);\r\n\r\n\t\t\tthis._moved = true;\r\n\r\n\t\t\t// TODO refactor: remove hardcoded 4 pixels\r\n\t\t\tbox.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';\r\n\t\t\tbox.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';\r\n\t\t},\r\n\r\n\t\t_finish: function () {\r\n\t\t\tif (this._moved) {\r\n\t\t\t\tthis._pane.removeChild(this._box);\r\n\t\t\t\tthis._container.style.cursor = '';\r\n\t\t\t}\r\n\r\n\t\t\tL.DomUtil.enableTextSelection();\r\n\t\t\tL.DomUtil.enableImageDrag();\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.off(document, 'mousemove', this._onMouseMove)\r\n\t\t\t\t.off(document, 'mouseup', this._onMouseUp)\r\n\t\t\t\t.off(document, 'keydown', this._onKeyDown);\r\n\t\t},\r\n\r\n\t\t_onMouseUp: function (e) {\r\n\r\n\t\t\tthis._finish();\r\n\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tlayerPoint = map.mouseEventToLayerPoint(e);\r\n\r\n\t\t\tif (this._startLayerPoint.equals(layerPoint)) { return; }\r\n\r\n\t\t\tvar bounds = new L.LatLngBounds(\r\n\t\t\t\tmap.layerPointToLatLng(this._startLayerPoint),\r\n\t\t\t\tmap.layerPointToLatLng(layerPoint));\r\n\r\n\t\t\tmap.fitBounds(bounds);\r\n\r\n\t\t\tmap.fire('boxzoomend', {\r\n\t\t\t\tboxZoomBounds: bounds\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onKeyDown: function (e) {\r\n\t\t\tif (e.keyCode === 27) {\r\n\t\t\t\tthis._finish();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);\r\n\r\n\r\n\t/*\r\n\t * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tkeyboard: true,\r\n\t\tkeyboardPanOffset: 80,\r\n\t\tkeyboardZoomOffset: 1\r\n\t});\r\n\r\n\tL.Map.Keyboard = L.Handler.extend({\r\n\r\n\t\tkeyCodes: {\r\n\t\t\tleft:    [37],\r\n\t\t\tright:   [39],\r\n\t\t\tdown:    [40],\r\n\t\t\tup:      [38],\r\n\t\t\tzoomIn:  [187, 107, 61, 171],\r\n\t\t\tzoomOut: [189, 109, 173]\r\n\t\t},\r\n\r\n\t\tinitialize: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tthis._setPanOffset(map.options.keyboardPanOffset);\r\n\t\t\tthis._setZoomOffset(map.options.keyboardZoomOffset);\r\n\t\t},\r\n\r\n\t\taddHooks: function () {\r\n\t\t\tvar container = this._map._container;\r\n\r\n\t\t\t// make the container focusable by tabbing\r\n\t\t\tif (container.tabIndex === -1) {\r\n\t\t\t\tcontainer.tabIndex = '0';\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(container, 'focus', this._onFocus, this)\r\n\t\t\t\t.on(container, 'blur', this._onBlur, this)\r\n\t\t\t\t.on(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.on('focus', this._addHooks, this)\r\n\t\t\t\t.on('blur', this._removeHooks, this);\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tthis._removeHooks();\r\n\r\n\t\t\tvar container = this._map._container;\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.off(container, 'focus', this._onFocus, this)\r\n\t\t\t\t.off(container, 'blur', this._onBlur, this)\r\n\t\t\t\t.off(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.off('focus', this._addHooks, this)\r\n\t\t\t\t.off('blur', this._removeHooks, this);\r\n\t\t},\r\n\r\n\t\t_onMouseDown: function () {\r\n\t\t\tif (this._focused) { return; }\r\n\r\n\t\t\tvar body = document.body,\r\n\t\t\t\tdocEl = document.documentElement,\r\n\t\t\t\ttop = body.scrollTop || docEl.scrollTop,\r\n\t\t\t\tleft = body.scrollLeft || docEl.scrollLeft;\r\n\r\n\t\t\tthis._map._container.focus();\r\n\r\n\t\t\twindow.scrollTo(left, top);\r\n\t\t},\r\n\r\n\t\t_onFocus: function () {\r\n\t\t\tthis._focused = true;\r\n\t\t\tthis._map.fire('focus');\r\n\t\t},\r\n\r\n\t\t_onBlur: function () {\r\n\t\t\tthis._focused = false;\r\n\t\t\tthis._map.fire('blur');\r\n\t\t},\r\n\r\n\t\t_setPanOffset: function (pan) {\r\n\t\t\tvar keys = this._panKeys = {},\r\n\t\t\t\tcodes = this.keyCodes,\r\n\t\t\t\ti, len;\r\n\r\n\t\t\tfor (i = 0, len = codes.left.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.left[i]] = [-1 * pan, 0];\r\n\t\t\t}\r\n\t\t\tfor (i = 0, len = codes.right.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.right[i]] = [pan, 0];\r\n\t\t\t}\r\n\t\t\tfor (i = 0, len = codes.down.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.down[i]] = [0, pan];\r\n\t\t\t}\r\n\t\t\tfor (i = 0, len = codes.up.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.up[i]] = [0, -1 * pan];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_setZoomOffset: function (zoom) {\r\n\t\t\tvar keys = this._zoomKeys = {},\r\n\t\t\t\tcodes = this.keyCodes,\r\n\t\t\t\ti, len;\r\n\r\n\t\t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.zoomIn[i]] = zoom;\r\n\t\t\t}\r\n\t\t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\r\n\t\t\t\tkeys[codes.zoomOut[i]] = -zoom;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addHooks: function () {\r\n\t\t\tL.DomEvent.on(document, 'keydown', this._onKeyDown, this);\r\n\t\t},\r\n\r\n\t\t_removeHooks: function () {\r\n\t\t\tL.DomEvent.off(document, 'keydown', this._onKeyDown, this);\r\n\t\t},\r\n\r\n\t\t_onKeyDown: function (e) {\r\n\t\t\tvar key = e.keyCode,\r\n\t\t\t\tmap = this._map;\r\n\r\n\t\t\tif (key in this._panKeys) {\r\n\r\n\t\t\t\tif (map._panAnim && map._panAnim._inProgress) { return; }\r\n\r\n\t\t\t\tmap.panBy(this._panKeys[key]);\r\n\r\n\t\t\t\tif (map.options.maxBounds) {\r\n\t\t\t\t\tmap.panInsideBounds(map.options.maxBounds);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (key in this._zoomKeys) {\r\n\t\t\t\tmap.setZoom(map.getZoom() + this._zoomKeys[key]);\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);\r\n\r\n\r\n\t/*\r\n\t * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\r\n\t */\r\n\r\n\tL.Handler.MarkerDrag = L.Handler.extend({\r\n\t\tinitialize: function (marker) {\r\n\t\t\tthis._marker = marker;\r\n\t\t},\r\n\r\n\t\taddHooks: function () {\r\n\t\t\tvar icon = this._marker._icon;\r\n\t\t\tif (!this._draggable) {\r\n\t\t\t\tthis._draggable = new L.Draggable(icon, icon);\r\n\t\t\t}\r\n\r\n\t\t\tthis._draggable\r\n\t\t\t\t.on('dragstart', this._onDragStart, this)\r\n\t\t\t\t.on('drag', this._onDrag, this)\r\n\t\t\t\t.on('dragend', this._onDragEnd, this);\r\n\t\t\tthis._draggable.enable();\r\n\t\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tthis._draggable\r\n\t\t\t\t.off('dragstart', this._onDragStart, this)\r\n\t\t\t\t.off('drag', this._onDrag, this)\r\n\t\t\t\t.off('dragend', this._onDragEnd, this);\r\n\r\n\t\t\tthis._draggable.disable();\r\n\t\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t\t},\r\n\r\n\t\tmoved: function () {\r\n\t\t\treturn this._draggable && this._draggable._moved;\r\n\t\t},\r\n\r\n\t\t_onDragStart: function () {\r\n\t\t\tthis._marker\r\n\t\t\t\t.closePopup()\r\n\t\t\t\t.fire('movestart')\r\n\t\t\t\t.fire('dragstart');\r\n\t\t},\r\n\r\n\t\t_onDrag: function () {\r\n\t\t\tvar marker = this._marker,\r\n\t\t\t\tshadow = marker._shadow,\r\n\t\t\t\ticonPos = L.DomUtil.getPosition(marker._icon),\r\n\t\t\t\tlatlng = marker._map.layerPointToLatLng(iconPos);\r\n\r\n\t\t\t// update shadow position\r\n\t\t\tif (shadow) {\r\n\t\t\t\tL.DomUtil.setPosition(shadow, iconPos);\r\n\t\t\t}\r\n\r\n\t\t\tmarker._latlng = latlng;\r\n\r\n\t\t\tmarker\r\n\t\t\t\t.fire('move', {latlng: latlng})\r\n\t\t\t\t.fire('drag');\r\n\t\t},\r\n\r\n\t\t_onDragEnd: function (e) {\r\n\t\t\tthis._marker\r\n\t\t\t\t.fire('moveend')\r\n\t\t\t\t.fire('dragend', e);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.Control is a base class for implementing map controls. Handles positioning.\r\n\t * All other controls extend from this class.\r\n\t */\r\n\r\n\tL.Control = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\tposition: 'topright'\r\n\t\t},\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tgetPosition: function () {\r\n\t\t\treturn this.options.position;\r\n\t\t},\r\n\r\n\t\tsetPosition: function (position) {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tif (map) {\r\n\t\t\t\tmap.removeControl(this);\r\n\t\t\t}\r\n\r\n\t\t\tthis.options.position = position;\r\n\r\n\t\t\tif (map) {\r\n\t\t\t\tmap.addControl(this);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetContainer: function () {\r\n\t\t\treturn this._container;\r\n\t\t},\r\n\r\n\t\taddTo: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tvar container = this._container = this.onAdd(map),\r\n\t\t\t\tpos = this.getPosition(),\r\n\t\t\t\tcorner = map._controlCorners[pos];\r\n\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\r\n\t\t\tif (pos.indexOf('bottom') !== -1) {\r\n\t\t\t\tcorner.insertBefore(container, corner.firstChild);\r\n\t\t\t} else {\r\n\t\t\t\tcorner.appendChild(container);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveFrom: function (map) {\r\n\t\t\tvar pos = this.getPosition(),\r\n\t\t\t\tcorner = map._controlCorners[pos];\r\n\r\n\t\t\tcorner.removeChild(this._container);\r\n\t\t\tthis._map = null;\r\n\r\n\t\t\tif (this.onRemove) {\r\n\t\t\t\tthis.onRemove(map);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_refocusOnMap: function () {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._map.getContainer().focus();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.control = function (options) {\r\n\t\treturn new L.Control(options);\r\n\t};\r\n\r\n\r\n// adds control-related methods to L.Map\r\n\r\n\tL.Map.include({\r\n\t\taddControl: function (control) {\r\n\t\t\tcontrol.addTo(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveControl: function (control) {\r\n\t\t\tcontrol.removeFrom(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_initControlPos: function () {\r\n\t\t\tvar corners = this._controlCorners = {},\r\n\t\t\t\tl = 'leaflet-',\r\n\t\t\t\tcontainer = this._controlContainer =\r\n\t\t\t\t\tL.DomUtil.create('div', l + 'control-container', this._container);\r\n\r\n\t\t\tfunction createCorner(vSide, hSide) {\r\n\t\t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n\t\t\t\tcorners[vSide + hSide] = L.DomUtil.create('div', className, container);\r\n\t\t\t}\r\n\r\n\t\t\tcreateCorner('top', 'left');\r\n\t\t\tcreateCorner('top', 'right');\r\n\t\t\tcreateCorner('bottom', 'left');\r\n\t\t\tcreateCorner('bottom', 'right');\r\n\t\t},\r\n\r\n\t\t_clearControlPos: function () {\r\n\t\t\tthis._container.removeChild(this._controlContainer);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.Control.Zoom is used for the default zoom buttons on the map.\r\n\t */\r\n\r\n\tL.Control.Zoom = L.Control.extend({\r\n\t\toptions: {\r\n\t\t\tposition: 'topleft',\r\n\t\t\tzoomInText: '+',\r\n\t\t\tzoomInTitle: 'Zoom in',\r\n\t\t\tzoomOutText: '-',\r\n\t\t\tzoomOutTitle: 'Zoom out'\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tvar zoomName = 'leaflet-control-zoom',\r\n\t\t\t\tcontainer = L.DomUtil.create('div', zoomName + ' leaflet-bar');\r\n\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tthis._zoomInButton  = this._createButton(\r\n\t\t\t\tthis.options.zoomInText, this.options.zoomInTitle,\r\n\t\t\t\tzoomName + '-in',  container, this._zoomIn,  this);\r\n\t\t\tthis._zoomOutButton = this._createButton(\r\n\t\t\t\tthis.options.zoomOutText, this.options.zoomOutTitle,\r\n\t\t\t\tzoomName + '-out', container, this._zoomOut, this);\r\n\r\n\t\t\tthis._updateDisabled();\r\n\t\t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n\t\t\treturn container;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\t\t},\r\n\r\n\t\t_zoomIn: function (e) {\r\n\t\t\tthis._map.zoomIn(e.shiftKey ? 3 : 1);\r\n\t\t},\r\n\r\n\t\t_zoomOut: function (e) {\r\n\t\t\tthis._map.zoomOut(e.shiftKey ? 3 : 1);\r\n\t\t},\r\n\r\n\t\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\t\tlink.innerHTML = html;\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = title;\r\n\r\n\t\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(link, 'click', stop)\r\n\t\t\t\t.on(link, 'mousedown', stop)\r\n\t\t\t\t.on(link, 'dblclick', stop)\r\n\t\t\t\t.on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t\t.on(link, 'click', fn, context)\r\n\t\t\t\t.on(link, 'click', this._refocusOnMap, context);\r\n\r\n\t\t\treturn link;\r\n\t\t},\r\n\r\n\t\t_updateDisabled: function () {\r\n\t\t\tvar map = this._map,\r\n\t\t\t\tclassName = 'leaflet-disabled';\r\n\r\n\t\t\tL.DomUtil.removeClass(this._zoomInButton, className);\r\n\t\t\tL.DomUtil.removeClass(this._zoomOutButton, className);\r\n\r\n\t\t\tif (map._zoom === map.getMinZoom()) {\r\n\t\t\t\tL.DomUtil.addClass(this._zoomOutButton, className);\r\n\t\t\t}\r\n\t\t\tif (map._zoom === map.getMaxZoom()) {\r\n\t\t\t\tL.DomUtil.addClass(this._zoomInButton, className);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tzoomControl: true\r\n\t});\r\n\r\n\tL.Map.addInitHook(function () {\r\n\t\tif (this.options.zoomControl) {\r\n\t\t\tthis.zoomControl = new L.Control.Zoom();\r\n\t\t\tthis.addControl(this.zoomControl);\r\n\t\t}\r\n\t});\r\n\r\n\tL.control.zoom = function (options) {\r\n\t\treturn new L.Control.Zoom(options);\r\n\t};\r\n\r\n\r\n\r\n\t/*\r\n\t * L.Control.Attribution is used for displaying attribution on the map (added by default).\r\n\t */\r\n\r\n\tL.Control.Attribution = L.Control.extend({\r\n\t\toptions: {\r\n\t\t\tposition: 'bottomright',\r\n\t\t\tprefix: '<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>'\r\n\t\t},\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.setOptions(this, options);\r\n\r\n\t\t\tthis._attributions = {};\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-attribution');\r\n\t\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\r\n\t\t\tfor (var i in map._layers) {\r\n\t\t\t\tif (map._layers[i].getAttribution) {\r\n\t\t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tmap\r\n\t\t\t\t.on('layeradd', this._onLayerAdd, this)\r\n\t\t\t\t.on('layerremove', this._onLayerRemove, this);\r\n\r\n\t\t\tthis._update();\r\n\r\n\t\t\treturn this._container;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap\r\n\t\t\t\t.off('layeradd', this._onLayerAdd)\r\n\t\t\t\t.off('layerremove', this._onLayerRemove);\r\n\r\n\t\t},\r\n\r\n\t\tsetPrefix: function (prefix) {\r\n\t\t\tthis.options.prefix = prefix;\r\n\t\t\tthis._update();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddAttribution: function (text) {\r\n\t\t\tif (!text) { return; }\r\n\r\n\t\t\tif (!this._attributions[text]) {\r\n\t\t\t\tthis._attributions[text] = 0;\r\n\t\t\t}\r\n\t\t\tthis._attributions[text]++;\r\n\r\n\t\t\tthis._update();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveAttribution: function (text) {\r\n\t\t\tif (!text) { return; }\r\n\r\n\t\t\tif (this._attributions[text]) {\r\n\t\t\t\tthis._attributions[text]--;\r\n\t\t\t\tthis._update();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_update: function () {\r\n\t\t\tif (!this._map) { return; }\r\n\r\n\t\t\tvar attribs = [];\r\n\r\n\t\t\tfor (var i in this._attributions) {\r\n\t\t\t\tif (this._attributions[i]) {\r\n\t\t\t\t\tattribs.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar prefixAndAttribs = [];\r\n\r\n\t\t\tif (this.options.prefix) {\r\n\t\t\t\tprefixAndAttribs.push(this.options.prefix);\r\n\t\t\t}\r\n\t\t\tif (attribs.length) {\r\n\t\t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n\t\t\t}\r\n\r\n\t\t\tthis._container.innerHTML = prefixAndAttribs.join(' | ');\r\n\t\t},\r\n\r\n\t\t_onLayerAdd: function (e) {\r\n\t\t\tif (e.layer.getAttribution) {\r\n\t\t\t\tthis.addAttribution(e.layer.getAttribution());\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onLayerRemove: function (e) {\r\n\t\t\tif (e.layer.getAttribution) {\r\n\t\t\t\tthis.removeAttribution(e.layer.getAttribution());\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tattributionControl: true\r\n\t});\r\n\r\n\tL.Map.addInitHook(function () {\r\n\t\tif (this.options.attributionControl) {\r\n\t\t\tthis.attributionControl = (new L.Control.Attribution()).addTo(this);\r\n\t\t}\r\n\t});\r\n\r\n\tL.control.attribution = function (options) {\r\n\t\treturn new L.Control.Attribution(options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Control.Scale is used for displaying metric/imperial scale on the map.\r\n\t */\r\n\r\n\tL.Control.Scale = L.Control.extend({\r\n\t\toptions: {\r\n\t\t\tposition: 'bottomleft',\r\n\t\t\tmaxWidth: 100,\r\n\t\t\tmetric: true,\r\n\t\t\timperial: true,\r\n\t\t\tupdateWhenIdle: false\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._map = map;\r\n\r\n\t\t\tvar className = 'leaflet-control-scale',\r\n\t\t\t\tcontainer = L.DomUtil.create('div', className),\r\n\t\t\t\toptions = this.options;\r\n\r\n\t\t\tthis._addScales(options, className, container);\r\n\r\n\t\t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t\t\tmap.whenReady(this._update, this);\r\n\r\n\t\t\treturn container;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t\t},\r\n\r\n\t\t_addScales: function (options, className, container) {\r\n\t\t\tif (options.metric) {\r\n\t\t\t\tthis._mScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t\t}\r\n\t\t\tif (options.imperial) {\r\n\t\t\t\tthis._iScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_update: function () {\r\n\t\t\tvar bounds = this._map.getBounds(),\r\n\t\t\t\tcenterLat = bounds.getCenter().lat,\r\n\t\t\t\thalfWorldMeters = 6378137 * Math.PI * Math.cos(centerLat * Math.PI / 180),\r\n\t\t\t\tdist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,\r\n\r\n\t\t\t\tsize = this._map.getSize(),\r\n\t\t\t\toptions = this.options,\r\n\t\t\t\tmaxMeters = 0;\r\n\r\n\t\t\tif (size.x > 0) {\r\n\t\t\t\tmaxMeters = dist * (options.maxWidth / size.x);\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateScales(options, maxMeters);\r\n\t\t},\r\n\r\n\t\t_updateScales: function (options, maxMeters) {\r\n\t\t\tif (options.metric && maxMeters) {\r\n\t\t\t\tthis._updateMetric(maxMeters);\r\n\t\t\t}\r\n\r\n\t\t\tif (options.imperial && maxMeters) {\r\n\t\t\t\tthis._updateImperial(maxMeters);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateMetric: function (maxMeters) {\r\n\t\t\tvar meters = this._getRoundNum(maxMeters);\r\n\r\n\t\t\tthis._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';\r\n\t\t\tthis._mScale.innerHTML = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\r\n\t\t},\r\n\r\n\t\t_updateImperial: function (maxMeters) {\r\n\t\t\tvar maxFeet = maxMeters * 3.2808399,\r\n\t\t\t\tscale = this._iScale,\r\n\t\t\t\tmaxMiles, miles, feet;\r\n\r\n\t\t\tif (maxFeet > 5280) {\r\n\t\t\t\tmaxMiles = maxFeet / 5280;\r\n\t\t\t\tmiles = this._getRoundNum(maxMiles);\r\n\r\n\t\t\t\tscale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';\r\n\t\t\t\tscale.innerHTML = miles + ' mi';\r\n\r\n\t\t\t} else {\r\n\t\t\t\tfeet = this._getRoundNum(maxFeet);\r\n\r\n\t\t\t\tscale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';\r\n\t\t\t\tscale.innerHTML = feet + ' ft';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getScaleWidth: function (ratio) {\r\n\t\t\treturn Math.round(this.options.maxWidth * ratio) - 10;\r\n\t\t},\r\n\r\n\t\t_getRoundNum: function (num) {\r\n\t\t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\r\n\t\t\t\td = num / pow10;\r\n\r\n\t\t\td = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;\r\n\r\n\t\t\treturn pow10 * d;\r\n\t\t}\r\n\t});\r\n\r\n\tL.control.scale = function (options) {\r\n\t\treturn new L.Control.Scale(options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.Control.Layers is a control to allow users to switch between different layers on the map.\r\n\t */\r\n\r\n\tL.Control.Layers = L.Control.extend({\r\n\t\toptions: {\r\n\t\t\tcollapsed: true,\r\n\t\t\tposition: 'topright',\r\n\t\t\tautoZIndex: true\r\n\t\t},\r\n\r\n\t\tinitialize: function (baseLayers, overlays, options) {\r\n\t\t\tL.setOptions(this, options);\r\n\r\n\t\t\tthis._layers = {};\r\n\t\t\tthis._lastZIndex = 0;\r\n\t\t\tthis._handlingClick = false;\r\n\r\n\t\t\tfor (var i in baseLayers) {\r\n\t\t\t\tthis._addLayer(baseLayers[i], i);\r\n\t\t\t}\r\n\r\n\t\t\tfor (i in overlays) {\r\n\t\t\t\tthis._addLayer(overlays[i], i, true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tthis._initLayout();\r\n\t\t\tthis._update();\r\n\r\n\t\t\tmap\r\n\t\t\t\t.on('layeradd', this._onLayerChange, this)\r\n\t\t\t\t.on('layerremove', this._onLayerChange, this);\r\n\r\n\t\t\treturn this._container;\r\n\t\t},\r\n\r\n\t\tonRemove: function (map) {\r\n\t\t\tmap\r\n\t\t\t\t.off('layeradd', this._onLayerChange)\r\n\t\t\t\t.off('layerremove', this._onLayerChange);\r\n\t\t},\r\n\r\n\t\taddBaseLayer: function (layer, name) {\r\n\t\t\tthis._addLayer(layer, name);\r\n\t\t\tthis._update();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddOverlay: function (layer, name) {\r\n\t\t\tthis._addLayer(layer, name, true);\r\n\t\t\tthis._update();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tremoveLayer: function (layer) {\r\n\t\t\tvar id = L.stamp(layer);\r\n\t\t\tdelete this._layers[id];\r\n\t\t\tthis._update();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_initLayout: function () {\r\n\t\t\tvar className = 'leaflet-control-layers',\r\n\t\t\t\tcontainer = this._container = L.DomUtil.create('div', className);\r\n\r\n\t\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\t\tif (!L.Browser.touch) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t\t.disableClickPropagation(container)\r\n\t\t\t\t\t.disableScrollPropagation(container);\r\n\t\t\t} else {\r\n\t\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t\t}\r\n\r\n\t\t\tvar form = this._form = L.DomUtil.create('form', className + '-list');\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tif (!L.Browser.android) {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t\t\t.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t}\r\n\t\t\t\tvar link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);\r\n\t\t\t\tlink.href = '#';\r\n\t\t\t\tlink.title = 'Layers';\r\n\r\n\t\t\t\tif (L.Browser.touch) {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t\t\t.on(link, 'click', this._expand, this);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomEvent.on(link, 'focus', this._expand, this);\r\n\t\t\t\t}\r\n\t\t\t\t//Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033\r\n\t\t\t\tL.DomEvent.on(form, 'click', function () {\r\n\t\t\t\t\tsetTimeout(L.bind(this._onInputClick, this), 0);\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO keyboard accessibility\r\n\t\t\t} else {\r\n\t\t\t\tthis._expand();\r\n\t\t\t}\r\n\r\n\t\t\tthis._baseLayersList = L.DomUtil.create('div', className + '-base', form);\r\n\t\t\tthis._separator = L.DomUtil.create('div', className + '-separator', form);\r\n\t\t\tthis._overlaysList = L.DomUtil.create('div', className + '-overlays', form);\r\n\r\n\t\t\tcontainer.appendChild(form);\r\n\t\t},\r\n\r\n\t\t_addLayer: function (layer, name, overlay) {\r\n\t\t\tvar id = L.stamp(layer);\r\n\r\n\t\t\tthis._layers[id] = {\r\n\t\t\t\tlayer: layer,\r\n\t\t\t\tname: name,\r\n\t\t\t\toverlay: overlay\r\n\t\t\t};\r\n\r\n\t\t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n\t\t\t\tthis._lastZIndex++;\r\n\t\t\t\tlayer.setZIndex(this._lastZIndex);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_update: function () {\r\n\t\t\tif (!this._container) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._baseLayersList.innerHTML = '';\r\n\t\t\tthis._overlaysList.innerHTML = '';\r\n\r\n\t\t\tvar baseLayersPresent = false,\r\n\t\t\t\toverlaysPresent = false,\r\n\t\t\t\ti, obj;\r\n\r\n\t\t\tfor (i in this._layers) {\r\n\t\t\t\tobj = this._layers[i];\r\n\t\t\t\tthis._addItem(obj);\r\n\t\t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n\t\t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n\t\t\t}\r\n\r\n\t\t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\t\t},\r\n\r\n\t\t_onLayerChange: function (e) {\r\n\t\t\tvar obj = this._layers[L.stamp(e.layer)];\r\n\r\n\t\t\tif (!obj) { return; }\r\n\r\n\t\t\tif (!this._handlingClick) {\r\n\t\t\t\tthis._update();\r\n\t\t\t}\r\n\r\n\t\t\tvar type = obj.overlay ?\r\n\t\t\t\t(e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :\r\n\t\t\t\t(e.type === 'layeradd' ? 'baselayerchange' : null);\r\n\r\n\t\t\tif (type) {\r\n\t\t\t\tthis._map.fire(type, obj);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)\r\n\t\t_createRadioElement: function (name, checked) {\r\n\r\n\t\t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' + name + '\"';\r\n\t\t\tif (checked) {\r\n\t\t\t\tradioHtml += ' checked=\"checked\"';\r\n\t\t\t}\r\n\t\t\tradioHtml += '/>';\r\n\r\n\t\t\tvar radioFragment = document.createElement('div');\r\n\t\t\tradioFragment.innerHTML = radioHtml;\r\n\r\n\t\t\treturn radioFragment.firstChild;\r\n\t\t},\r\n\r\n\t\t_addItem: function (obj) {\r\n\t\t\tvar label = document.createElement('label'),\r\n\t\t\t\tinput,\r\n\t\t\t\tchecked = this._map.hasLayer(obj.layer);\r\n\r\n\t\t\tif (obj.overlay) {\r\n\t\t\t\tinput = document.createElement('input');\r\n\t\t\t\tinput.type = 'checkbox';\r\n\t\t\t\tinput.className = 'leaflet-control-layers-selector';\r\n\t\t\t\tinput.defaultChecked = checked;\r\n\t\t\t} else {\r\n\t\t\t\tinput = this._createRadioElement('leaflet-base-layers', checked);\r\n\t\t\t}\r\n\r\n\t\t\tinput.layerId = L.stamp(obj.layer);\r\n\r\n\t\t\tL.DomEvent.on(input, 'click', this._onInputClick, this);\r\n\r\n\t\t\tvar name = document.createElement('span');\r\n\t\t\tname.innerHTML = ' ' + obj.name;\r\n\r\n\t\t\tlabel.appendChild(input);\r\n\t\t\tlabel.appendChild(name);\r\n\r\n\t\t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n\t\t\tcontainer.appendChild(label);\r\n\r\n\t\t\treturn label;\r\n\t\t},\r\n\r\n\t\t_onInputClick: function () {\r\n\t\t\tvar i, input, obj,\r\n\t\t\t\tinputs = this._form.getElementsByTagName('input'),\r\n\t\t\t\tinputsLen = inputs.length;\r\n\r\n\t\t\tthis._handlingClick = true;\r\n\r\n\t\t\tfor (i = 0; i < inputsLen; i++) {\r\n\t\t\t\tinput = inputs[i];\r\n\t\t\t\tobj = this._layers[input.layerId];\r\n\r\n\t\t\t\tif (input.checked && !this._map.hasLayer(obj.layer)) {\r\n\t\t\t\t\tthis._map.addLayer(obj.layer);\r\n\r\n\t\t\t\t} else if (!input.checked && this._map.hasLayer(obj.layer)) {\r\n\t\t\t\t\tthis._map.removeLayer(obj.layer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._handlingClick = false;\r\n\r\n\t\t\tthis._refocusOnMap();\r\n\t\t},\r\n\r\n\t\t_expand: function () {\r\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');\r\n\t\t},\r\n\r\n\t\t_collapse: function () {\r\n\t\t\tthis._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');\r\n\t\t}\r\n\t});\r\n\r\n\tL.control.layers = function (baseLayers, overlays, options) {\r\n\t\treturn new L.Control.Layers(baseLayers, overlays, options);\r\n\t};\r\n\r\n\r\n\t/*\r\n\t * L.PosAnimation is used by Leaflet internally for pan animations.\r\n\t */\r\n\r\n\tL.PosAnimation = L.Class.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\t\tthis.stop();\r\n\r\n\t\t\tthis._el = el;\r\n\t\t\tthis._inProgress = true;\r\n\t\t\tthis._newPos = newPos;\r\n\r\n\t\t\tthis.fire('start');\r\n\r\n\t\t\tel.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +\r\n\t\t\t\t's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';\r\n\r\n\t\t\tL.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\t\t\tL.DomUtil.setPosition(el, newPos);\r\n\r\n\t\t\t// toggle reflow, Chrome flickers for some reason if you don't do this\r\n\t\t\tL.Util.falseFn(el.offsetWidth);\r\n\r\n\t\t\t// there's no native way to track value updates of transitioned properties, so we imitate this\r\n\t\t\tthis._stepTimer = setInterval(L.bind(this._onStep, this), 50);\r\n\t\t},\r\n\r\n\t\tstop: function () {\r\n\t\t\tif (!this._inProgress) { return; }\r\n\r\n\t\t\t// if we just removed the transition property, the element would jump to its final position,\r\n\t\t\t// so we need to make it stay at the current position\r\n\r\n\t\t\tL.DomUtil.setPosition(this._el, this._getPos());\r\n\t\t\tthis._onTransitionEnd();\r\n\t\t\tL.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation\r\n\t\t},\r\n\r\n\t\t_onStep: function () {\r\n\t\t\tvar stepPos = this._getPos();\r\n\t\t\tif (!stepPos) {\r\n\t\t\t\tthis._onTransitionEnd();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// jshint camelcase: false\r\n\t\t\t// make L.DomUtil.getPosition return intermediate position value during animation\r\n\t\t\tthis._el._leaflet_pos = stepPos;\r\n\r\n\t\t\tthis.fire('step');\r\n\t\t},\r\n\r\n\t\t// you can't easily get intermediate values of properties animated with CSS3 Transitions,\r\n\t\t// we need to parse computed style (in case of transform it returns matrix string)\r\n\r\n\t\t_transformRe: /([-+]?(?:\\d*\\.)?\\d+)\\D*, ([-+]?(?:\\d*\\.)?\\d+)\\D*\\)/,\r\n\r\n\t\t_getPos: function () {\r\n\t\t\tvar left, top, matches,\r\n\t\t\t\tel = this._el,\r\n\t\t\t\tstyle = window.getComputedStyle(el);\r\n\r\n\t\t\tif (L.Browser.any3d) {\r\n\t\t\t\tmatches = style[L.DomUtil.TRANSFORM].match(this._transformRe);\r\n\t\t\t\tif (!matches) { return; }\r\n\t\t\t\tleft = parseFloat(matches[1]);\r\n\t\t\t\ttop  = parseFloat(matches[2]);\r\n\t\t\t} else {\r\n\t\t\t\tleft = parseFloat(style.left);\r\n\t\t\t\ttop  = parseFloat(style.top);\r\n\t\t\t}\r\n\r\n\t\t\treturn new L.Point(left, top, true);\r\n\t\t},\r\n\r\n\t\t_onTransitionEnd: function () {\r\n\t\t\tL.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\r\n\t\t\tif (!this._inProgress) { return; }\r\n\t\t\tthis._inProgress = false;\r\n\r\n\t\t\tthis._el.style[L.DomUtil.TRANSITION] = '';\r\n\r\n\t\t\t// jshint camelcase: false\r\n\t\t\t// make sure L.DomUtil.getPosition returns the final position value after animation\r\n\t\t\tthis._el._leaflet_pos = this._newPos;\r\n\r\n\t\t\tclearInterval(this._stepTimer);\r\n\r\n\t\t\tthis.fire('step').fire('end');\r\n\t\t}\r\n\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.Map to handle panning animations.\r\n\t */\r\n\r\n\tL.Map.include({\r\n\r\n\t\tsetView: function (center, zoom, options) {\r\n\r\n\t\t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\r\n\t\t\tcenter = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tif (this._panAnim) {\r\n\t\t\t\tthis._panAnim.stop();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._loaded && !options.reset && options !== true) {\r\n\r\n\t\t\t\tif (options.animate !== undefined) {\r\n\t\t\t\t\toptions.zoom = L.extend({animate: options.animate}, options.zoom);\r\n\t\t\t\t\toptions.pan = L.extend({animate: options.animate}, options.pan);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// try animating pan or zoom\r\n\t\t\t\tvar animated = (this._zoom !== zoom) ?\r\n\t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\r\n\t\t\t\t\tthis._tryAnimatedPan(center, options.pan);\r\n\r\n\t\t\t\tif (animated) {\r\n\t\t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\r\n\t\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// animation didn't start, just reset the map view\r\n\t\t\tthis._resetView(center, zoom);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tpanBy: function (offset, options) {\r\n\t\t\toffset = L.point(offset).round();\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tif (!offset.x && !offset.y) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._panAnim) {\r\n\t\t\t\tthis._panAnim = new L.PosAnimation();\r\n\r\n\t\t\t\tthis._panAnim.on({\r\n\t\t\t\t\t'step': this._onPanTransitionStep,\r\n\t\t\t\t\t'end': this._onPanTransitionEnd\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\r\n\t\t\t// don't fire movestart if animating inertia\r\n\t\t\tif (!options.noMoveStart) {\r\n\t\t\t\tthis.fire('movestart');\r\n\t\t\t}\r\n\r\n\t\t\t// animate pan unless animate: false specified\r\n\t\t\tif (options.animate !== false) {\r\n\t\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');\r\n\r\n\t\t\t\tvar newPos = this._getMapPanePos().subtract(offset);\r\n\t\t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\r\n\t\t\t} else {\r\n\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t\tthis.fire('move').fire('moveend');\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_onPanTransitionStep: function () {\r\n\t\t\tthis.fire('move');\r\n\t\t},\r\n\r\n\t\t_onPanTransitionEnd: function () {\r\n\t\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');\r\n\t\t\tthis.fire('moveend');\r\n\t\t},\r\n\r\n\t\t_tryAnimatedPan: function (center, options) {\r\n\t\t\t// difference between the new and current centers in pixels\r\n\t\t\tvar offset = this._getCenterOffset(center)._floor();\r\n\r\n\t\t\t// don't animate too far unless animate: true specified in options\r\n\t\t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\t\tthis.panBy(offset, options);\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * L.PosAnimation fallback implementation that powers Leaflet pan animations\r\n\t * in browsers that don't support CSS3 Transitions.\r\n\t */\r\n\r\n\tL.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({\r\n\r\n\t\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\t\tthis.stop();\r\n\r\n\t\t\tthis._el = el;\r\n\t\t\tthis._inProgress = true;\r\n\t\t\tthis._duration = duration || 0.25;\r\n\t\t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\r\n\r\n\t\t\tthis._startPos = L.DomUtil.getPosition(el);\r\n\t\t\tthis._offset = newPos.subtract(this._startPos);\r\n\t\t\tthis._startTime = +new Date();\r\n\r\n\t\t\tthis.fire('start');\r\n\r\n\t\t\tthis._animate();\r\n\t\t},\r\n\r\n\t\tstop: function () {\r\n\t\t\tif (!this._inProgress) { return; }\r\n\r\n\t\t\tthis._step();\r\n\t\t\tthis._complete();\r\n\t\t},\r\n\r\n\t\t_animate: function () {\r\n\t\t\t// animation loop\r\n\t\t\tthis._animId = L.Util.requestAnimFrame(this._animate, this);\r\n\t\t\tthis._step();\r\n\t\t},\r\n\r\n\t\t_step: function () {\r\n\t\t\tvar elapsed = (+new Date()) - this._startTime,\r\n\t\t\t\tduration = this._duration * 1000;\r\n\r\n\t\t\tif (elapsed < duration) {\r\n\t\t\t\tthis._runFrame(this._easeOut(elapsed / duration));\r\n\t\t\t} else {\r\n\t\t\t\tthis._runFrame(1);\r\n\t\t\t\tthis._complete();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_runFrame: function (progress) {\r\n\t\t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\r\n\t\t\tL.DomUtil.setPosition(this._el, pos);\r\n\r\n\t\t\tthis.fire('step');\r\n\t\t},\r\n\r\n\t\t_complete: function () {\r\n\t\t\tL.Util.cancelAnimFrame(this._animId);\r\n\r\n\t\t\tthis._inProgress = false;\r\n\t\t\tthis.fire('end');\r\n\t\t},\r\n\r\n\t\t_easeOut: function (t) {\r\n\t\t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Extends L.Map to handle zoom animations.\r\n\t */\r\n\r\n\tL.Map.mergeOptions({\r\n\t\tzoomAnimation: true,\r\n\t\tzoomAnimationThreshold: 4\r\n\t});\r\n\r\n\tif (L.DomUtil.TRANSITION) {\r\n\r\n\t\tL.Map.addInitHook(function () {\r\n\t\t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\r\n\t\t\tthis._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&\r\n\t\t\t\tL.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;\r\n\r\n\t\t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\r\n\t\t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\r\n\t\t\tif (this._zoomAnimated) {\r\n\t\t\t\tL.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tL.Map.include(!L.DomUtil.TRANSITION ? {} : {\r\n\r\n\t\t_catchTransitionEnd: function (e) {\r\n\t\t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\r\n\t\t\t\tthis._onZoomTransitionEnd();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_nothingToAnimate: function () {\r\n\t\t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\r\n\t\t},\r\n\r\n\t\t_tryAnimatedZoom: function (center, zoom, options) {\r\n\r\n\t\t\tif (this._animatingZoom) { return true; }\r\n\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\t// don't animate if disabled, not supported or zoom difference is too large\r\n\t\t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\r\n\t\t\t\tMath.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\r\n\r\n\t\t\t// offset is the pixel coords of the zoom origin relative to the current center\r\n\t\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t\t\toffset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),\r\n\t\t\t\torigin = this._getCenterLayerPoint()._add(offset);\r\n\r\n\t\t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\r\n\t\t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\t\tthis\r\n\t\t\t\t.fire('movestart')\r\n\t\t\t\t.fire('zoomstart');\r\n\r\n\t\t\tthis._animateZoom(center, zoom, origin, scale, null, true);\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t_animateZoom: function (center, zoom, origin, scale, delta, backwards) {\r\n\r\n\t\t\tthis._animatingZoom = true;\r\n\r\n\t\t\t// put transform transition on all layers with leaflet-zoom-animated class\r\n\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\t\t// remember what center/zoom to set after animation\r\n\t\t\tthis._animateToCenter = center;\r\n\t\t\tthis._animateToZoom = zoom;\r\n\r\n\t\t\t// disable any dragging during animation\r\n\t\t\tif (L.Draggable) {\r\n\t\t\t\tL.Draggable._disabled = true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('zoomanim', {\r\n\t\t\t\tcenter: center,\r\n\t\t\t\tzoom: zoom,\r\n\t\t\t\torigin: origin,\r\n\t\t\t\tscale: scale,\r\n\t\t\t\tdelta: delta,\r\n\t\t\t\tbackwards: backwards\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onZoomTransitionEnd: function () {\r\n\r\n\t\t\tthis._animatingZoom = false;\r\n\r\n\t\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\t\tthis._resetView(this._animateToCenter, this._animateToZoom, true, true);\r\n\r\n\t\t\tif (L.Draggable) {\r\n\t\t\t\tL.Draggable._disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t Zoom animation logic for L.TileLayer.\r\n\t */\r\n\r\n\tL.TileLayer.include({\r\n\t\t_animateZoom: function (e) {\r\n\t\t\tif (!this._animating) {\r\n\t\t\t\tthis._animating = true;\r\n\t\t\t\tthis._prepareBgBuffer();\r\n\t\t\t}\r\n\r\n\t\t\tvar bg = this._bgBuffer,\r\n\t\t\t\ttransform = L.DomUtil.TRANSFORM,\r\n\t\t\t\tinitialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],\r\n\t\t\t\tscaleStr = L.DomUtil.getScaleString(e.scale, e.origin);\r\n\r\n\t\t\tbg.style[transform] = e.backwards ?\r\n\t\t\tscaleStr + ' ' + initialTransform :\r\n\t\t\tinitialTransform + ' ' + scaleStr;\r\n\t\t},\r\n\r\n\t\t_endZoomAnim: function () {\r\n\t\t\tvar front = this._tileContainer,\r\n\t\t\t\tbg = this._bgBuffer;\r\n\r\n\t\t\tfront.style.visibility = '';\r\n\t\t\tfront.parentNode.appendChild(front); // Bring to fore\r\n\r\n\t\t\t// force reflow\r\n\t\t\tL.Util.falseFn(bg.offsetWidth);\r\n\r\n\t\t\tthis._animating = false;\r\n\t\t},\r\n\r\n\t\t_clearBgBuffer: function () {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tif (map && !map._animatingZoom && !map.touchZoom._zooming) {\r\n\t\t\t\tthis._bgBuffer.innerHTML = '';\r\n\t\t\t\tthis._bgBuffer.style[L.DomUtil.TRANSFORM] = '';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_prepareBgBuffer: function () {\r\n\r\n\t\t\tvar front = this._tileContainer,\r\n\t\t\t\tbg = this._bgBuffer;\r\n\r\n\t\t\t// if foreground layer doesn't have many tiles but bg layer does,\r\n\t\t\t// keep the existing bg layer and just zoom it some more\r\n\r\n\t\t\tvar bgLoaded = this._getLoadedTilesPercentage(bg),\r\n\t\t\t\tfrontLoaded = this._getLoadedTilesPercentage(front);\r\n\r\n\t\t\tif (bg && bgLoaded > 0.5 && frontLoaded < 0.5) {\r\n\r\n\t\t\t\tfront.style.visibility = 'hidden';\r\n\t\t\t\tthis._stopLoadingImages(front);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// prepare the buffer to become the front tile pane\r\n\t\t\tbg.style.visibility = 'hidden';\r\n\t\t\tbg.style[L.DomUtil.TRANSFORM] = '';\r\n\r\n\t\t\t// switch out the current layer to be the new bg layer (and vice-versa)\r\n\t\t\tthis._tileContainer = bg;\r\n\t\t\tbg = this._bgBuffer = front;\r\n\r\n\t\t\tthis._stopLoadingImages(bg);\r\n\r\n\t\t\t//prevent bg buffer from clearing right after zoom\r\n\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t},\r\n\r\n\t\t_getLoadedTilesPercentage: function (container) {\r\n\t\t\tvar tiles = container.getElementsByTagName('img'),\r\n\t\t\t\ti, len, count = 0;\r\n\r\n\t\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\t\tif (tiles[i].complete) {\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn count / len;\r\n\t\t},\r\n\r\n\t\t// stops loading all tiles in the background layer\r\n\t\t_stopLoadingImages: function (container) {\r\n\t\t\tvar tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),\r\n\t\t\t\ti, len, tile;\r\n\r\n\t\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\t\ttile = tiles[i];\r\n\r\n\t\t\t\tif (!tile.complete) {\r\n\t\t\t\t\ttile.onload = L.Util.falseFn;\r\n\t\t\t\t\ttile.onerror = L.Util.falseFn;\r\n\t\t\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\r\n\t\t\t\t\ttile.parentNode.removeChild(tile);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/*\r\n\t * Provides L.Map with convenient shortcuts for using browser geolocation features.\r\n\t */\r\n\r\n\tL.Map.include({\r\n\t\t_defaultLocateOptions: {\r\n\t\t\twatch: false,\r\n\t\t\tsetView: false,\r\n\t\t\tmaxZoom: Infinity,\r\n\t\t\ttimeout: 10000,\r\n\t\t\tmaximumAge: 0,\r\n\t\t\tenableHighAccuracy: false\r\n\t\t},\r\n\r\n\t\tlocate: function (/*Object*/ options) {\r\n\r\n\t\t\toptions = this._locateOptions = L.extend(this._defaultLocateOptions, options);\r\n\r\n\t\t\tif (!navigator.geolocation) {\r\n\t\t\t\tthis._handleGeolocationError({\r\n\t\t\t\t\tcode: 0,\r\n\t\t\t\t\tmessage: 'Geolocation not supported.'\r\n\t\t\t\t});\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tvar onResponse = L.bind(this._handleGeolocationResponse, this),\r\n\t\t\t\tonError = L.bind(this._handleGeolocationError, this);\r\n\r\n\t\t\tif (options.watch) {\r\n\t\t\t\tthis._locationWatchId =\r\n\t\t\t\t\tnavigator.geolocation.watchPosition(onResponse, onError, options);\r\n\t\t\t} else {\r\n\t\t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tstopLocate: function () {\r\n\t\t\tif (navigator.geolocation) {\r\n\t\t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n\t\t\t}\r\n\t\t\tif (this._locateOptions) {\r\n\t\t\t\tthis._locateOptions.setView = false;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_handleGeolocationError: function (error) {\r\n\t\t\tvar c = error.code,\r\n\t\t\t\tmessage = error.message ||\r\n\t\t\t\t\t(c === 1 ? 'permission denied' :\r\n\t\t\t\t\t\t(c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n\t\t\tif (this._locateOptions.setView && !this._loaded) {\r\n\t\t\t\tthis.fitWorld();\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('locationerror', {\r\n\t\t\t\tcode: c,\r\n\t\t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_handleGeolocationResponse: function (pos) {\r\n\t\t\tvar lat = pos.coords.latitude,\r\n\t\t\t\tlng = pos.coords.longitude,\r\n\t\t\t\tlatlng = new L.LatLng(lat, lng),\r\n\r\n\t\t\t\tlatAccuracy = 180 * pos.coords.accuracy / 40075017,\r\n\t\t\t\tlngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),\r\n\r\n\t\t\t\tbounds = L.latLngBounds(\r\n\t\t\t\t\t[lat - latAccuracy, lng - lngAccuracy],\r\n\t\t\t\t\t[lat + latAccuracy, lng + lngAccuracy]),\r\n\r\n\t\t\t\toptions = this._locateOptions;\r\n\r\n\t\t\tif (options.setView) {\r\n\t\t\t\tvar zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);\r\n\t\t\t\tthis.setView(latlng, zoom);\r\n\t\t\t}\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tlatlng: latlng,\r\n\t\t\t\tbounds: bounds,\r\n\t\t\t\ttimestamp: pos.timestamp\r\n\t\t\t};\r\n\r\n\t\t\tfor (var i in pos.coords) {\r\n\t\t\t\tif (typeof pos.coords[i] === 'number') {\r\n\t\t\t\t\tdata[i] = pos.coords[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('locationfound', data);\r\n\t\t}\r\n\t});\r\n\r\n\r\n}(window, document));\n/*\n\tLeaflet.draw, a plugin that adds drawing and editing tools to Leaflet powered maps.\n\t(c) 2012-2016, Jacob Toye, Smartrak, Leaflet\n\n\thttps://github.com/Leaflet/Leaflet.draw\n\thttp://leafletjs.com\n*/\n(function (window, document, undefined) {/*\n * Leaflet.draw assumes that you have already included the Leaflet library.\n */\n\nL.drawVersion = '0.3.0';\n\nL.drawLocal = {\n\tdraw: {\n\t\ttoolbar: {\n\t\t\tactions: {\n\t\t\t\ttitle: '取消描绘',\n\t\t\t\ttext: '取消'\n\t\t\t},\n\t\t\tfinish: {\n\t\t\t\ttitle: '完成描绘',\n\t\t\t\ttext: '完成'\n\t\t\t},\n\t\t\tundo: {\n\t\t\t\ttitle: '删除最后一个描点',\n\t\t\t\ttext: '删除最后一个描点'\n\t\t\t},\n\t\t\tbuttons: {\n\t\t\t\tpolyline: '描绘直线',\n\t\t\t\tpolygon: '描绘多边形',\n\t\t\t\trectangle: '描绘矩形',\n\t\t\t\tcircle: '描绘圆形',\n\t\t\t\tmarker: '设置标记'\n\t\t\t}\n\t\t},\n\t\thandlers: {\n\t\t\tcircle: {\n\t\t\t\ttooltip: {\n\t\t\t\t\tstart: '点击拖拽画圆'\n\t\t\t\t},\n\t\t\t\tradius: '直径'\n\t\t\t},\n\t\t\tmarker: {\n\t\t\t\ttooltip: {\n\t\t\t\t\tstart: '点击设置一个标记'\n\t\t\t\t}\n\t\t\t},\n\t\t\tpolygon: {\n\t\t\t\ttooltip: {\n\t\t\t\t\tstart: '点击开始画多边形',\n\t\t\t\t\tcont: '点击继续描绘',\n\t\t\t\t\tend: '点击第一点或工具栏完成'\n\t\t\t\t}\n\t\t\t},\n\t\t\tpolyline: {\n\t\t\t\terror: '<strong>错误:</strong> 形状不出超出!',\n\t\t\t\ttooltip: {\n\t\t\t\t\tstart: '点击开始画线.',\n\t\t\t\t\tcont: '点击继续画线.',\n\t\t\t\t\tend: '点击最后一点完成画线'\n\t\t\t\t}\n\t\t\t},\n\t\t\trectangle: {\n\t\t\t\ttooltip: {\n\t\t\t\t\tstart: '点击拖拽矩形'\n\t\t\t\t}\n\t\t\t},\n\t\t\tsimpleshape: {\n\t\t\t\ttooltip: {\n\t\t\t\t\tend: '松开鼠标完成.'\n\t\t\t\t}\n\t\t\t},\n\t\t\tline:{\n\t\t\t\ttooltip:{\n\t\t\t\t\tstart:'点击开始画线'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tedit: {\n\t\ttoolbar: {\n\t\t\tactions: {\n\t\t\t\tsave: {\n\t\t\t\t\ttitle: '保存.',\n\t\t\t\t\ttext: '保存'\n\t\t\t\t},\n\t\t\t\tcancel: {\n\t\t\t\t\ttitle: '取消编辑，并放弃所有修改.',\n\t\t\t\t\ttext: '取消'\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: {\n\t\t\t\tedit: '编辑.',\n\t\t\t\teditDisabled: '没有物件可用于编辑.',\n\t\t\t\tremove: '删除.',\n\t\t\t\tremoveDisabled: '没有物件可用于删除.'\n\t\t\t}\n\t\t},\n\t\thandlers: {\n\t\t\tedit: {\n\t\t\t\ttooltip: {\n\t\t\t\t\ttext: '拖拽节点进行编辑',\n\t\t\t\t\tsubtext: '点击取消撤消更改.'\n\t\t\t\t}\n\t\t\t},\n\t\t\tremove: {\n\t\t\t\ttooltip: {\n\t\t\t\t\ttext: '点击删除一点节点'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n\nL.Draw = {};\n\nL.Draw.Feature = L.Handler.extend({\n\tincludes: L.Mixin.Events,\n\n\tinitialize: function (map, options) {\n\t\tthis._map = map;\n\t\tthis._container = map._container;\n\t\tthis._overlayPane = map._panes.overlayPane;\n\t\tthis._popupPane = map._panes.popupPane;\n\n\t\t// Merge default shapeOptions options with custom shapeOptions\n\t\tif (options && options.shapeOptions) {\n\t\t\toptions.shapeOptions = L.Util.extend({}, this.options.shapeOptions, options.shapeOptions);\n\t\t}\n\t\tL.setOptions(this, options);\n\t},\n\n\tenable: function () {\n\t\tif (this._enabled) { return; }\n\n\t\tL.Handler.prototype.enable.call(this);\n\n\t\tthis.fire('enabled', { handler: this.type });\n\n\t\tthis._map.fire('draw:drawstart', { layerType: this.type });\n\t},\n\n\tdisable: function () {\n\t\tif (!this._enabled) { return; }\n\n\t\tL.Handler.prototype.disable.call(this);\n\n\t\tthis._map.fire('draw:drawstop', { layerType: this.type });\n\n\t\tthis.fire('disabled', { handler: this.type });\n\t},\n\n\taddHooks: function () {\n\t\tvar map = this._map;\n\n\t\tif (map) {\n\t\t\tL.DomUtil.disableTextSelection();\n\n\t\t\tmap.getContainer().focus();\n\n\t\t\tthis._tooltip = new L.Tooltip(this._map);\n\n\t\t\tL.DomEvent.on(this._container, 'keyup', this._cancelDrawing, this);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tif (this._map) {\n\t\t\tL.DomUtil.enableTextSelection();\n\n\t\t\tthis._tooltip.dispose();\n\t\t\tthis._tooltip = null;\n\n\t\t\tL.DomEvent.off(this._container, 'keyup', this._cancelDrawing, this);\n\t\t}\n\t},\n\n\tsetOptions: function (options) {\n\t\tL.setOptions(this, options);\n\t},\n\n\t_fireCreatedEvent: function (layer) {\n\t\tthis._map.fire('draw:created', { layer: layer, layerType: this.type });\n\t},\n\n\t// Cancel drawing when the escape key is pressed\n\t_cancelDrawing: function (e) {\n\t\tif (e.keyCode === 27) {\n\t\t\tthis.disable();\n\t\t}\n\t}\n});\n\nL.Draw.Polyline = L.Draw.Feature.extend({\n\tstatics: {\n\t\tTYPE: 'polyline'\n\t},\n\n\tPoly: L.Polyline,\n\n\toptions: {\n\t\tallowIntersection: true,\n\t\trepeatMode: false,\n\t\tdrawError: {\n\t\t\tcolor: '#b00b00',\n\t\t\ttimeout: 2500\n\t\t},\n\t\ticon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon'\n\t\t}),\n\t\ttouchIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-touch-icon'\n\t\t}),\n\t\tguidelineDistance: 20,\n\t\tmaxGuideLineLength: 4000,\n\t\tshapeOptions: {\n\t\t\tstroke: true,\n\t\t\tcolor: '#f06eaa',\n\t\t\tweight: 2,\n\t\t\topacity: 1,\n\t\t\tfill: false,\n\t\t\tclickable: true\n\t\t},\n\t\tmetric: true, // Whether to use the metric meaurement system or imperial\n\t\tfeet: true, // When not metric, to use feet instead of yards for display.\n\t\tshowLength: true, // Whether to display distance in the tooltip\n\t\tzIndexOffset: 2000 // This should be > than the highest z-index any map layers\n\t},\n\n\tinitialize: function (map, options) {\n\t\t// if touch, switch to touch icon\n\t\tif (L.Browser.touch) {\n\t\t\tthis.options.icon = this.options.touchIcon;\n\t\t}\n\n\t\t// Need to set this here to ensure the correct message is used.\n\t\tthis.options.drawError.message = L.drawLocal.draw.handlers.polyline.error;\n\n\t\t// Merge default drawError options with custom options\n\t\tif (options && options.drawError) {\n\t\t\toptions.drawError = L.Util.extend({}, this.options.drawError, options.drawError);\n\t\t}\n\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\n\t\tthis.type = L.Draw.Polyline.TYPE;\n\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\n\t},\n\n\taddHooks: function () {\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\n\t\tif (this._map) {\n\t\t\tthis._markers = [];\n\n\t\t\tthis._markerGroup = new L.LayerGroup();\n\t\t\tthis._map.addLayer(this._markerGroup);\n\n\t\t\tthis._poly = new L.Polyline([], this.options.shapeOptions);\n\n\t\t\tthis._tooltip.updateContent(this._getTooltipText());\n\n\t\t\t// Make a transparent marker that will used to catch click events. These click\n\t\t\t// events will create the vertices. We need to do this so we can ensure that\n\t\t\t// we can create vertices over other map layers (markers, vector layers). We\n\t\t\t// also do not want to trigger any click handlers of objects we are clicking on\n\t\t\t// while drawing.\n\t\t\tif (!this._mouseMarker) {\n\t\t\t\tthis._mouseMarker = L.marker(this._map.getCenter(), {\n\t\t\t\t\ticon: L.divIcon({\n\t\t\t\t\t\tclassName: 'leaflet-mouse-marker',\n\t\t\t\t\t\ticonAnchor: [20, 20],\n\t\t\t\t\t\ticonSize: [40, 40]\n\t\t\t\t\t}),\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tzIndexOffset: this.options.zIndexOffset\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._mouseMarker\n\t\t\t\t.on('mousedown', this._onMouseDown, this)\n\t\t\t\t.on('mouseout', this._onMouseOut, this)\n\t\t\t\t.on('mouseup', this._onMouseUp, this) // Necessary for 0.8 compatibility\n\t\t\t\t.on('mousemove', this._onMouseMove, this) // Necessary to prevent 0.8 stutter\n\t\t\t\t.addTo(this._map);\n\n\t\t\tthis._map\n\t\t\t\t.on('mouseup', this._onMouseUp, this) // Necessary for 0.7 compatibility\n\t\t\t\t.on('mousemove', this._onMouseMove, this)\n\t\t\t\t.on('zoomlevelschange', this._onZoomEnd, this)\n\t\t\t\t.on('click', this._onTouch, this)\n\t\t\t\t.on('zoomend', this._onZoomEnd, this);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\n\n\t\tthis._clearHideErrorTimeout();\n\n\t\tthis._cleanUpShape();\n\n\t\t// remove markers from map\n\t\tthis._map.removeLayer(this._markerGroup);\n\t\tdelete this._markerGroup;\n\t\tdelete this._markers;\n\n\t\tthis._map.removeLayer(this._poly);\n\t\tdelete this._poly;\n\n\t\tthis._mouseMarker\n\t\t\t.off('mousedown', this._onMouseDown, this)\n\t\t\t.off('mouseout', this._onMouseOut, this)\n\t\t\t.off('mouseup', this._onMouseUp, this)\n\t\t\t.off('mousemove', this._onMouseMove, this);\n\t\tthis._map.removeLayer(this._mouseMarker);\n\t\tdelete this._mouseMarker;\n\n\t\t// clean up DOM\n\t\tthis._clearGuides();\n\n\t\tthis._map\n\t\t\t.off('mouseup', this._onMouseUp, this)\n\t\t\t.off('mousemove', this._onMouseMove, this)\n\t\t\t.off('mouseup', this._onMouseUp, this)\n\t\t\t.off('zoomend', this._onZoomEnd, this)\n\t\t\t.off('click', this._onTouch, this);\n\t},\n\n\tdeleteLastVertex: function () {\n\t\tif (this._markers.length <= 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar lastMarker = this._markers.pop(),\n\t\t\tpoly = this._poly,\n\t\t\tlatlng = this._poly.spliceLatLngs(poly.getLatLngs().length - 1, 1)[0];\n\n\t\tthis._markerGroup.removeLayer(lastMarker);\n\n\t\tif (poly.getLatLngs().length < 2) {\n\t\t\tthis._map.removeLayer(poly);\n\t\t}\n\n\t\tthis._vertexChanged(latlng, false);\n\t},\n\n\taddVertex: function (latlng) {\n\t\tvar markersLength = this._markers.length;\n\n\t\tif (markersLength > 0 && !this.options.allowIntersection && this._poly.newLatLngIntersects(latlng)) {\n\t\t\tthis._showErrorTooltip();\n\t\t\treturn;\n\t\t}\n\t\telse if (this._errorShown) {\n\t\t\tthis._hideErrorTooltip();\n\t\t}\n\n\t\tthis._markers.push(this._createMarker(latlng));\n\n\t\tthis._poly.addLatLng(latlng);\n\n\t\tif (this._poly.getLatLngs().length === 2) {\n\t\t\tthis._map.addLayer(this._poly);\n\t\t}\n\n\t\tthis._vertexChanged(latlng, true);\n\t},\n\n\tcompleteShape: function () {\n\t\tif (this._markers.length <= 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fireCreatedEvent();\n\t\tthis.disable();\n\n\t\tif (this.options.repeatMode) {\n\t\t\tthis.enable();\n\t\t}\n\t},\n\n\t_finishShape: function () {\n\t\tvar intersects = this._poly.newLatLngIntersects(this._poly.getLatLngs()[0], true);\n\n\t\tif ((!this.options.allowIntersection && intersects) || !this._shapeIsValid()) {\n\t\t\tthis._showErrorTooltip();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fireCreatedEvent();\n\t\tthis.disable();\n\t\tif (this.options.repeatMode) {\n\t\t\tthis.enable();\n\t\t}\n\t},\n\n\t//Called to verify the shape is valid when the user tries to finish it\n\t//Return false if the shape is not valid\n\t_shapeIsValid: function () {\n\t\treturn true;\n\t},\n\n\t_onZoomEnd: function () {\n\t\tthis._updateGuide();\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tvar newPos = this._map.mouseEventToLayerPoint(e.originalEvent);\n\t\tif((e.originalEvent.altKey || e.originalEvent.ctrlKey) &&this._markers.length) {\n\t\t\tvar prevPos = this._map.latLngToLayerPoint(this._markers[this._markers.length - 1].getLatLng());\n\t\t\tif (e.originalEvent.altKey) {\n\t\t\t\tnewPos.x = prevPos.x;\n\t\t\t}\n\t\t\telse if (e.originalEvent.ctrlKey) {\n\t\t\t\tnewPos.y = prevPos.y;\n\t\t\t}\n\t\t}\n\t\tvar latlng = this._map.layerPointToLatLng(newPos);\n\n\t\t// Save latlng\n\t\t// should this be moved to _updateGuide() ?\n\t\tthis._currentLatLng = latlng;\n\n\t\tthis._updateTooltip(latlng);\n\n\t\t// Update the guide line\n\t\tthis._updateGuide(newPos);\n\n\t\t// Update the mouse marker position\n\t\tthis._mouseMarker.setLatLng(latlng);\n\n\t\tL.DomEvent.preventDefault(e.originalEvent);\n\t},\n\n\t_vertexChanged: function (latlng, added) {\n\t\tthis._map.fire('draw:drawvertex', { layers: this._markerGroup });\n\t\tthis._updateFinishHandler();\n\n\t\tthis._updateRunningMeasure(latlng, added);\n\n\t\tthis._clearGuides();\n\n\t\tthis._updateTooltip();\n\t},\n\n\t_onMouseDown: function (e) {\n\t\tvar originalEvent = e.originalEvent;\n\t\tthis._mouseDownOrigin = L.point(originalEvent.clientX, originalEvent.clientY);\n\t},\n\n\t_onMouseUp: function (e) {\n\t\tif (this._mouseDownOrigin) {\n\t\t\t// We detect clicks within a certain tolerance, otherwise let it\n\t\t\t// be interpreted as a drag by the map\n\t\t\tvar distance = L.point(e.originalEvent.clientX, e.originalEvent.clientY)\n\t\t\t\t.distanceTo(this._mouseDownOrigin);\n\t\t\tif (Math.abs(distance) < 9 * (window.devicePixelRatio || 1)) {\n\t\t\t\tif((e.originalEvent.altKey || e.originalEvent.ctrlKey) &&this._markers.length) {\n\t\t\t\t\tvar prevLatLng = this._markers[this._markers.length - 1].getLatLng();\n\t\t\t\t\tif (e.originalEvent.altKey) {\n\t\t\t\t\t\te.latlng.lng = prevLatLng.lng;\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.originalEvent.ctrlKey) {\n\t\t\t\t\t\te.latlng.lat = prevLatLng.lat;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.addVertex(e.latlng);\n\t\t\t}\n\t\t}\n\t\tthis._mouseDownOrigin = null;\n\t},\n\n\t_onTouch: function (e) {\n\t\t// #TODO: use touchstart and touchend vs using click(touch start & end).\n\t\tif (L.Browser.touch) { // #TODO: get rid of this once leaflet fixes their click/touch.\n\t\t\tthis._onMouseDown(e);\n\t\t\tthis._onMouseUp(e);\n\t\t}\n\t},\n\n\t_onMouseOut: function () {\n\t\tif (this._tooltip) {\n\t\t\tthis._tooltip._onMouseOut.call(this._tooltip);\n\t\t}\n\t},\n\n\t_updateFinishHandler: function () {\n\t\tvar markerCount = this._markers.length;\n\t\t// The last marker should have a click handler to close the polyline\n\t\tif (markerCount > 1) {\n\t\t\tthis._markers[markerCount - 1].on('click', this._finishShape, this);\n\t\t}\n\n\t\t// Remove the old marker click handler (as only the last point should close the polyline)\n\t\tif (markerCount > 2) {\n\t\t\tthis._markers[markerCount - 2].off('click', this._finishShape, this);\n\t\t}\n\t},\n\n\t_createMarker: function (latlng) {\n\t\tvar marker = new L.Marker(latlng, {\n\t\t\ticon: this.options.icon,\n\t\t\tzIndexOffset: this.options.zIndexOffset * 2\n\t\t});\n\n\t\tthis._markerGroup.addLayer(marker);\n\n\t\treturn marker;\n\t},\n\n\t_updateGuide: function (newPos) {\n\t\tvar markerCount = this._markers.length;\n\n\t\tif (markerCount > 0) {\n\t\t\tnewPos = newPos || this._map.latLngToLayerPoint(this._currentLatLng);\n\n\t\t\t// draw the guide line\n\t\t\tthis._clearGuides();\n\t\t\tthis._drawGuide(\n\t\t\t\tthis._map.latLngToLayerPoint(this._markers[markerCount - 1].getLatLng()),\n\t\t\t\tnewPos\n\t\t\t);\n\t\t}\n\t},\n\n\t_updateTooltip: function (latLng) {\n\t\tvar text = this._getTooltipText();\n\n\t\tif (latLng) {\n\t\t\tthis._tooltip.updatePosition(latLng);\n\t\t}\n\n\t\tif (!this._errorShown) {\n\t\t\tthis._tooltip.updateContent(text);\n\t\t}\n\t},\n\n\t_drawGuide: function (pointA, pointB) {\n\t\tvar length = Math.floor(Math.sqrt(Math.pow((pointB.x - pointA.x), 2) + Math.pow((pointB.y - pointA.y), 2))),\n\t\t\tguidelineDistance = this.options.guidelineDistance,\n\t\t\tmaxGuideLineLength = this.options.maxGuideLineLength,\n\t\t\t// Only draw a guideline with a max length\n\t\t\ti = length > maxGuideLineLength ? length - maxGuideLineLength : guidelineDistance,\n\t\t\tfraction,\n\t\t\tdashPoint,\n\t\t\tdash;\n\n\t\t//create the guides container if we haven't yet\n\t\tif (!this._guidesContainer) {\n\t\t\tthis._guidesContainer = L.DomUtil.create('div', 'leaflet-draw-guides', this._overlayPane);\n\t\t}\n\n\t\t//draw a dash every GuildeLineDistance\n\t\tfor (; i < length; i += this.options.guidelineDistance) {\n\t\t\t//work out fraction along line we are\n\t\t\tfraction = i / length;\n\n\t\t\t//calculate new x,y point\n\t\t\tdashPoint = {\n\t\t\t\tx: Math.floor((pointA.x * (1 - fraction)) + (fraction * pointB.x)),\n\t\t\t\ty: Math.floor((pointA.y * (1 - fraction)) + (fraction * pointB.y))\n\t\t\t};\n\n\t\t\t//add guide dash to guide container\n\t\t\tdash = L.DomUtil.create('div', 'leaflet-draw-guide-dash', this._guidesContainer);\n\t\t\tdash.style.backgroundColor =\n\t\t\t\t!this._errorShown ? this.options.shapeOptions.color : this.options.drawError.color;\n\n\t\t\tL.DomUtil.setPosition(dash, dashPoint);\n\t\t}\n\t},\n\n\t_updateGuideColor: function (color) {\n\t\tif (this._guidesContainer) {\n\t\t\tfor (var i = 0, l = this._guidesContainer.childNodes.length; i < l; i++) {\n\t\t\t\tthis._guidesContainer.childNodes[i].style.backgroundColor = color;\n\t\t\t}\n\t\t}\n\t},\n\n\t// removes all child elements (guide dashes) from the guides container\n\t_clearGuides: function () {\n\t\tif (this._guidesContainer) {\n\t\t\twhile (this._guidesContainer.firstChild) {\n\t\t\t\tthis._guidesContainer.removeChild(this._guidesContainer.firstChild);\n\t\t\t}\n\t\t}\n\t},\n\n\t_getTooltipText: function () {\n\t\tvar showLength = this.options.showLength,\n\t\t\tlabelText, distanceStr;\n\n\t\tif (this._markers.length === 0) {\n\t\t\tlabelText = {\n\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.start\n\t\t\t};\n\t\t} else {\n\t\t\tdistanceStr = showLength ? this._getMeasurementString() : '';\n\n\t\t\tif (this._markers.length === 1) {\n\t\t\t\tlabelText = {\n\t\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.cont,\n\t\t\t\t\tsubtext: distanceStr\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tlabelText = {\n\t\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.end,\n\t\t\t\t\tsubtext: distanceStr\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn labelText;\n\t},\n\n\t_updateRunningMeasure: function (latlng, added) {\n\t\tvar markersLength = this._markers.length,\n\t\t\tpreviousMarkerIndex, distance;\n\n\t\tif (this._markers.length === 1) {\n\t\t\tthis._measurementRunningTotal = 0;\n\t\t} else {\n\t\t\tpreviousMarkerIndex = markersLength - (added ? 2 : 1);\n\t\t\tdistance = latlng.distanceTo(this._markers[previousMarkerIndex].getLatLng());\n\n\t\t\tthis._measurementRunningTotal += distance * (added ? 1 : -1);\n\t\t}\n\t},\n\n\t_getMeasurementString: function () {\n\t\tvar currentLatLng = this._currentLatLng,\n\t\t\tpreviousLatLng = this._markers[this._markers.length - 1].getLatLng(),\n\t\t\tdistance;\n\n\t\t// calculate the distance from the last fixed point to the mouse position\n\t\tdistance = this._measurementRunningTotal + currentLatLng.distanceTo(previousLatLng);\n\n\t\treturn L.GeometryUtil.readableDistance(distance, this.options.metric, this.options.feet);\n\t},\n\n\t_showErrorTooltip: function () {\n\t\tthis._errorShown = true;\n\n\t\t// Update tooltip\n\t\tthis._tooltip\n\t\t\t.showAsError()\n\t\t\t.updateContent({ text: this.options.drawError.message });\n\n\t\t// Update shape\n\t\tthis._updateGuideColor(this.options.drawError.color);\n\t\tthis._poly.setStyle({ color: this.options.drawError.color });\n\n\t\t// Hide the error after 2 seconds\n\t\tthis._clearHideErrorTimeout();\n\t\tthis._hideErrorTimeout = setTimeout(L.Util.bind(this._hideErrorTooltip, this), this.options.drawError.timeout);\n\t},\n\n\t_hideErrorTooltip: function () {\n\t\tthis._errorShown = false;\n\n\t\tthis._clearHideErrorTimeout();\n\n\t\t// Revert tooltip\n\t\tthis._tooltip\n\t\t\t.removeError()\n\t\t\t.updateContent(this._getTooltipText());\n\n\t\t// Revert shape\n\t\tthis._updateGuideColor(this.options.shapeOptions.color);\n\t\tthis._poly.setStyle({ color: this.options.shapeOptions.color });\n\t},\n\n\t_clearHideErrorTimeout: function () {\n\t\tif (this._hideErrorTimeout) {\n\t\t\tclearTimeout(this._hideErrorTimeout);\n\t\t\tthis._hideErrorTimeout = null;\n\t\t}\n\t},\n\n\t_cleanUpShape: function () {\n\t\tif (this._markers.length > 1) {\n\t\t\tthis._markers[this._markers.length - 1].off('click', this._finishShape, this);\n\t\t}\n\t},\n\n\t_fireCreatedEvent: function () {\n\t\tvar poly = new this.Poly(this._poly.getLatLngs(), this.options.shapeOptions);\n\t\tL.Draw.Feature.prototype._fireCreatedEvent.call(this, poly);\n\t}\n});\n\n\nL.Draw.Polygon = L.Draw.Polyline.extend({\n\tstatics: {\n\t\tTYPE: 'polygon'\n\t},\n\n\tPoly: L.Polygon,\n\n\toptions: {\n\t\tshowArea: false,\n\t\tshapeOptions: {\n\t\t\tstroke: true,\n\t\t\tcolor: '#f06eaa',\n\t\t\tweight: 2,\n\t\t\topacity: 1,\n\t\t\tfill: true,\n\t\t\tfillColor: null, //same as color by default\n\t\t\tfillOpacity: 0.2,\n\t\t\tclickable: true\n\t\t}\n\t},\n\n\tinitialize: function (map, options) {\n\t\tL.Draw.Polyline.prototype.initialize.call(this, map, options);\n\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\n\t\tthis.type = L.Draw.Polygon.TYPE;\n\t},\n\n\t_updateFinishHandler: function () {\n\t\tvar markerCount = this._markers.length;\n\n\t\t// The first marker should have a click handler to close the polygon\n\t\tif (markerCount === 1) {\n\t\t\tthis._markers[0].on('click', this._finishShape, this);\n\t\t}\n\n\t\t// Add and update the double click handler\n\t\tif (markerCount > 2) {\n\t\t\tthis._markers[markerCount - 1].on('dblclick', this._finishShape, this);\n\t\t\t// Only need to remove handler if has been added before\n\t\t\tif (markerCount > 3) {\n\t\t\t\tthis._markers[markerCount - 2].off('dblclick', this._finishShape, this);\n\t\t\t}\n\t\t}\n\t},\n\n\t_getTooltipText: function () {\n\t\tvar text, subtext;\n\n\t\tif (this._markers.length === 0) {\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.start;\n\t\t} else if (this._markers.length < 3) {\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.cont;\n\t\t} else {\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.end;\n\t\t\tsubtext = this._getMeasurementString();\n\t\t}\n\n\t\treturn {\n\t\t\ttext: text,\n\t\t\tsubtext: subtext\n\t\t};\n\t},\n\n\t_getMeasurementString: function () {\n\t\tvar area = this._area;\n\n\t\tif (!area) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn L.GeometryUtil.readableArea(area, this.options.metric);\n\t},\n\n\t_shapeIsValid: function () {\n\t\treturn this._markers.length >= 3;\n\t},\n\n\t_vertexChanged: function (latlng, added) {\n\t\tvar latLngs;\n\n\t\t// Check to see if we should show the area\n\t\tif (!this.options.allowIntersection && this.options.showArea) {\n\t\t\tlatLngs = this._poly.getLatLngs();\n\n\t\t\tthis._area = L.GeometryUtil.geodesicArea(latLngs);\n\t\t}\n\n\t\tL.Draw.Polyline.prototype._vertexChanged.call(this, latlng, added);\n\t},\n\n\t_cleanUpShape: function () {\n\t\tvar markerCount = this._markers.length;\n\n\t\tif (markerCount > 0) {\n\t\t\tthis._markers[0].off('click', this._finishShape, this);\n\n\t\t\tif (markerCount > 2) {\n\t\t\t\tthis._markers[markerCount - 1].off('dblclick', this._finishShape, this);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\nL.SimpleShape = {};\n\nL.Draw.SimpleShape = L.Draw.Feature.extend({\n\toptions: {\n\t\trepeatMode: false\n\t},\n\n\tinitialize: function (map, options) {\n\t\tthis._endLabelText = L.drawLocal.draw.handlers.simpleshape.tooltip.end;\n\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\n\t},\n\n\taddHooks: function () {\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\n\t\tif (this._map) {\n\t\t\tthis._mapDraggable = this._map.dragging.enabled();\n\n\t\t\tif (this._mapDraggable) {\n\t\t\t\tthis._map.dragging.disable();\n\t\t\t}\n\n\t\t\t//TODO refactor: move cursor to styles\n\t\t\tthis._container.style.cursor = 'crosshair';\n\n\t\t\tthis._tooltip.updateContent({ text: this._initialLabelText });\n\n\t\t\tthis._map\n\t\t\t\t.on('mousedown', this._onMouseDown, this)\n\t\t\t\t.on('mousemove', this._onMouseMove, this)\n\t\t\t\t.on('touchstart', this._onMouseDown, this)\n\t\t\t\t.on('touchmove', this._onMouseMove, this);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\n\t\tif (this._map) {\n\t\t\tif (this._mapDraggable) {\n\t\t\t\tthis._map.dragging.enable();\n\t\t\t}\n\n\t\t\t//TODO refactor: move cursor to styles\n\t\t\tthis._container.style.cursor = '';\n\n\t\t\tthis._map\n\t\t\t\t.off('mousedown', this._onMouseDown, this)\n\t\t\t\t.off('mousemove', this._onMouseMove, this)\n\t\t\t\t.off('touchstart', this._onMouseDown, this)\n\t\t\t\t.off('touchmove', this._onMouseMove, this);\n\n\t\t\tL.DomEvent.off(document, 'mouseup', this._onMouseUp, this);\n\t\t\tL.DomEvent.off(document, 'touchend', this._onMouseUp, this);\n\n\t\t\t// If the box element doesn't exist they must not have moved the mouse, so don't need to destroy/return\n\t\t\tif (this._shape) {\n\t\t\t\tthis._map.removeLayer(this._shape);\n\t\t\t\tdelete this._shape;\n\t\t\t}\n\t\t}\n\t\tthis._isDrawing = false;\n\t},\n\n\t_getTooltipText: function () {\n\t\treturn {\n\t\t\ttext: this._endLabelText\n\t\t};\n\t},\n\n\t_onMouseDown: function (e) {\n\t\tthis._isDrawing = true;\n\t\tthis._startLatLng = e.latlng;\n\t\tthis._dragEventCount = 0;\n\t\tL.DomEvent\n\t\t\t.on(document, 'mouseup', this._onMouseUp, this)\n\t\t\t.on(document, 'touchend', this._onMouseUp, this)\n\t\t\t.preventDefault(e.originalEvent);\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tvar latlng = e.latlng;\n\t\tif(e.originalEvent.altKey && this._startLatLng ){\n\t\t\tlatlng.lat = this._startLatLng.lat;\n\t\t}\n\t\telse if(e.originalEvent.ctrlKey && this._startLatLng ){\n\t\t\tlatlng.lng = this._startLatLng.lng;\n\t\t}\n\t\tthis._tooltip.updatePosition(latlng);\n\t\tif (this._isDrawing) {\n\t\t\t++this._dragEventCount;\n\t\t\tthis._tooltip.updateContent(this._getTooltipText());\n\t\t\tthis._drawShape(latlng);\n\t\t}\n\t},\n\n\t_onMouseUp: function (e) {\n\t\tif(this._clickToCreate) {\n\t\t\tthis._clickToCreate(e);\n\t\t\tif (this._shape) {\n\t\t\t\tthis._map.removeLayer(this._shape);\n\t\t\t\tthis._shape = null;\n\t\t\t}\n\t\t}\n\t\telse if (this._shape) {\n\t\t\tthis._fireCreatedEvent(e);\n\t\t}\n\n\t\tthis.disable();\n\t\tif (this.options.repeatMode) {\n\t\t\tthis.enable();\n\t\t}\n\t}\n});\n\nL.Draw.Rectangle = L.Draw.SimpleShape.extend({\n\tstatics: {\n\t\tTYPE: 'rectangle'\n\t},\n\n\toptions: {\n\t\tshapeOptions: {\n\t\t\tstroke: true,\n\t\t\tcolor: '#f06eaa',\n\t\t\tweight: 2,\n\t\t\topacity: 1,\n\t\t\tfill: true,\n\t\t\tfillColor: null, //same as color by default\n\t\t\tfillOpacity: 0.2,\n\t\t\tclickable: true\n\t\t},\n\t\tmetric: true // Whether to use the metric measurement system or imperial\n\t},\n\n\tinitialize: function (map, options) {\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\n\t\tthis.type = L.Draw.Rectangle.TYPE;\n\n\t\tthis._initialLabelText = L.drawLocal.draw.handlers.rectangle.tooltip.start;\n\n\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\n\t},\n\n\t_drawShape: function (latlng) {\n\t\tif (!this._shape) {\n\t\t\tthis._shape = new L.Rectangle(new L.LatLngBounds(this._startLatLng, latlng), this.options.shapeOptions);\n\t\t\tthis._map.addLayer(this._shape);\n\t\t} else {\n\t\t\tthis._shape.setBounds(new L.LatLngBounds(this._startLatLng, latlng));\n\t\t}\n\t},\n\n\t_fireCreatedEvent: function () {\n\t\tvar rectangle = new L.Rectangle(this._shape.getBounds(), this.options.shapeOptions);\n\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, rectangle);\n\t},\n\n\t_getTooltipText: function () {\n\t\tvar tooltipText = L.Draw.SimpleShape.prototype._getTooltipText.call(this),\n\t\t\tshape = this._shape,\n\t\t\tlatLngs, area, subtext;\n\n\t\tif (shape) {\n\t\t\tlatLngs = this._shape.getLatLngs();\n\t\t\tarea = L.GeometryUtil.geodesicArea(latLngs);\n\t\t\tsubtext = L.GeometryUtil.readableArea(area, this.options.metric);\n\t\t}\n\n\t\treturn {\n\t\t\ttext: tooltipText.text,\n\t\t\tsubtext: subtext\n\t\t};\n\t}\n});\n\n\nL.Draw.Circle = L.Draw.SimpleShape.extend({\n\tstatics: {\n\t\tTYPE: 'circle'\n\t},\n\n\toptions: {\n\t\tshapeOptions: {\n\t\t\tstroke: true,\n\t\t\tcolor: '#f06eaa',\n\t\t\tweight: 2,\n\t\t\topacity: 1,\n\t\t\tfill: true,\n\t\t\tfillColor: null, //same as color by default\n\t\t\tfillOpacity: 0.2,\n\t\t\tclickable: true\n\t\t},\n\t\tshowRadius: true,\n\t\tmetric: true, // Whether to use the metric meaurement system or imperial\n\t\tfeet: true // When not metric, use feet instead of yards for display\n\t},\n\n\tinitialize: function (map, options) {\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\n\t\tthis.type = L.Draw.Circle.TYPE;\n\n\t\tthis._initialLabelText = L.drawLocal.draw.handlers.circle.tooltip.start;\n\n\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\n\t},\n\n\t_drawShape: function (latlng) {\n\t\tif (!this._shape) {\n\t\t\tthis._shape = new L.Circle(this._startLatLng, this._startLatLng.distanceTo(latlng), this.options.shapeOptions);\n\t\t\tthis._map.addLayer(this._shape);\n\t\t} else {\n\t\t\tthis._shape.setRadius(this._startLatLng.distanceTo(latlng));\n\t\t}\n\t},\n\n\t_fireCreatedEvent: function () {\n\t\tvar circle = new L.Circle(this._startLatLng, this._shape.getRadius(), this.options.shapeOptions);\n\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, circle);\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tvar latlng = e.latlng,\n\t\t\tshowRadius = this.options.showRadius,\n\t\t\tuseMetric = this.options.metric,\n\t\t\tradius;\n\n\t\tthis._tooltip.updatePosition(latlng);\n\t\tif (this._isDrawing) {\n\t\t\tthis._drawShape(latlng);\n\n\t\t\t// Get the new radius (rounded to 1 dp)\n\t\t\tradius = this._shape.getRadius().toFixed(1);\n\n\t\t\tthis._tooltip.updateContent({\n\t\t\t\ttext: this._endLabelText,\n\t\t\t\tsubtext: showRadius ? L.drawLocal.draw.handlers.circle.radius + ': ' +\n\t\t\t\t\tL.GeometryUtil.readableDistance(radius, useMetric, this.options.feet) : ''\n\t\t\t});\n\t\t}\n\t}\n});\n\n\nL.Draw.Marker = L.Draw.Feature.extend({\n\tstatics: {\n\t\tTYPE: 'marker'\n\t},\n\n\toptions: {\n\t\ticon: new L.Icon.Default(),\n\t\trepeatMode: false,\n\t\tzIndexOffset: 2000 // This should be > than the highest z-index any markers\n\t},\n\n\tinitialize: function (map, options) {\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\n\t\tthis.type = L.Draw.Marker.TYPE;\n\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\n\t},\n\n\taddHooks: function () {\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\n\n\t\tif (this._map) {\n\t\t\tthis._tooltip.updateContent({ text: L.drawLocal.draw.handlers.marker.tooltip.start });\n\n\t\t\t// Same mouseMarker as in Draw.Polyline\n\t\t\tif (!this._mouseMarker) {\n\t\t\t\tthis._mouseMarker = L.marker(this._map.getCenter(), {\n\t\t\t\t\ticon: L.divIcon({\n\t\t\t\t\t\tclassName: 'leaflet-mouse-marker',\n\t\t\t\t\t\ticonAnchor: [20, 20],\n\t\t\t\t\t\ticonSize: [40, 40]\n\t\t\t\t\t}),\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tzIndexOffset: this.options.zIndexOffset\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._mouseMarker\n\t\t\t\t.on('click', this._onClick, this)\n\t\t\t\t.addTo(this._map);\n\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\n\t\t\tthis._map.on('click', this._onTouch, this);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\n\n\t\tif (this._map) {\n\t\t\tif (this._marker) {\n\t\t\t\tthis._marker.off('click', this._onClick, this);\n\t\t\t\tthis._map\n\t\t\t\t\t.off('click', this._onClick, this)\n\t\t\t\t\t.off('click', this._onTouch, this)\n\t\t\t\t\t.removeLayer(this._marker);\n\t\t\t\tdelete this._marker;\n\t\t\t}\n\n\t\t\tthis._mouseMarker.off('click', this._onClick, this);\n\t\t\tthis._map.removeLayer(this._mouseMarker);\n\t\t\tdelete this._mouseMarker;\n\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\n\t\t}\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tvar latlng = e.latlng;\n\n\t\tthis._tooltip.updatePosition(latlng);\n\t\tthis._mouseMarker.setLatLng(latlng);\n\n\t\tif (!this._marker) {\n\t\t\tthis._marker = new L.Marker(latlng, {\n\t\t\t\ticon: this.options.icon,\n\t\t\t\tzIndexOffset: this.options.zIndexOffset\n\t\t\t});\n\t\t\t// Bind to both marker and map to make sure we get the click event.\n\t\t\tthis._marker.on('click', this._onClick, this);\n\t\t\tthis._map\n\t\t\t\t.on('click', this._onClick, this)\n\t\t\t\t.addLayer(this._marker);\n\t\t}\n\t\telse {\n\t\t\tlatlng = this._mouseMarker.getLatLng();\n\t\t\tthis._marker.setLatLng(latlng);\n\t\t}\n\t},\n\n\t_onClick: function () {\n\t\tthis._fireCreatedEvent();\n\n\t\tthis.disable();\n\t\tif (this.options.repeatMode) {\n\t\t\tthis.enable();\n\t\t}\n\t},\n\n\t_onTouch: function (e) {\n\t\t// called on click & tap, only really does any thing on tap\n\t\tthis._onMouseMove(e); // creates & places marker\n\t\tthis._onClick(); // permanently places marker & ends interaction\n\t},\n\n\t_fireCreatedEvent: function () {\n\t\tvar marker = new L.Marker.Touch(this._marker.getLatLng(), { icon: this.options.icon });\n\t\tL.Draw.Feature.prototype._fireCreatedEvent.call(this, marker);\n\t}\n});\n\n\nL.Edit = L.Edit || {};\n\nL.Edit.Marker = L.Handler.extend({\n\tinitialize: function (marker, options) {\n\t\tthis._marker = marker;\n\t\tL.setOptions(this, options);\n\t},\n\n\taddHooks: function () {\n\t\tvar marker = this._marker;\n\n\t\tmarker.dragging.enable();\n\t\tmarker.on('dragend', this._onDragEnd, this);\n\t\tthis._openPopover();\n\t\tthis._toggleMarkerHighlight();\n\t\tmarker._map.on('preclick',this._onMouseClick,this);\n\t},\n\n\tremoveHooks: function () {\n\t\tvar marker = this._marker;\n\n\t\tmarker.dragging.disable();\n\t\tmarker.off('dragend', this._onDragEnd, this);\n\t\tthis._toggleMarkerHighlight();\n\t\tthis._closePopover();\n\t\tmarker._map.off('preclick',this._onMouseClick,this);\n\t},\n\n\t_onMouseClick:function(){\n\t\tthis.disable();\n\t},\n\t_onDragEnd: function (e) {\n\t\tvar layer = e.target;\n\t\tlayer.edited = true;\n\t\tthis._openPopover();\n\t},\n\n\t_toggleMarkerHighlight: function () {\n\t\tvar icon = this._marker._icon;\n\n\n\t\t// Don't do anything if this layer is a marker but doesn't have an icon. Markers\n\t\t// should usually have icons. If using Leaflet.draw with Leaflet.markercluster there\n\t\t// is a chance that a marker doesn't.\n\t\tif (!icon) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// This is quite naughty, but I don't see another way of doing it. (short of setting a new icon)\n\t\ticon.style.display = 'none';\n\n\t\tif (L.DomUtil.hasClass(icon, 'leaflet-edit-marker-selected')) {\n\t\t\tL.DomUtil.removeClass(icon, 'leaflet-edit-marker-selected');\n\t\t\t// Offset as the border will make the icon move.\n\t\t\tthis._offsetMarker(icon, -4);\n\n\t\t} else {\n\t\t\tL.DomUtil.addClass(icon, 'leaflet-edit-marker-selected');\n\t\t\t// Offset as the border will make the icon move.\n\t\t\tthis._offsetMarker(icon, 4);\n\t\t}\n\n\t\ticon.style.display = '';\n\t},\n\n\t_offsetMarker: function (icon, offset) {\n\t\tvar iconMarginTop = parseInt(icon.style.marginTop, 10) - offset,\n\t\t\ticonMarginLeft = parseInt(icon.style.marginLeft, 10) - offset;\n\n\t\ticon.style.marginTop = iconMarginTop + 'px';\n\t\ticon.style.marginLeft = iconMarginLeft + 'px';\n\t},\n\n\t_openPopover:function(){\n\t\tthis._createPopover();\n\t},\n\t_createPopover:function() {\n\t\tvar self = this,\n\t\t\tcontainer = L.SvFeatureGroup.bindPopupContainer(self._marker,self);\n\n\t\tif(container) {\n\t\t\tself._marker.bindPopup(container, {\n\t\t\t\tcloseButton: false,\n\t\t\t\toffset: new L.Point(0, -self._marker.options.icon.options.iconAnchor[1])\n\t\t\t});\n\t\t\tself._marker.openPopup();\n\t\t\tself._marker._popup.setLatLng(self._marker._latlng);\n\t\t}\n\t},\n\t_closePopover:function() {\n\t\tvar self = this;\n\t\tself._marker.closePopup();\n\t\tself._marker.unbindPopup();\n\t},\n\tclosePopup:function(){\n\t\tthis._closePopover();\n\t}\n});\n\nL.Marker.addInitHook(function () {\n\tif (L.Edit.Marker) {\n\t\tthis.editing = new L.Edit.Marker(this);\n\n\t\tif (this.options.editable) {\n\t\t\t//this.editing.enable();\n\t\t}\n\t}\n});\n\n\nL.Edit = L.Edit || {};\n\n/*\n * L.Edit.Poly is an editing handler for polylines and polygons.\n */\nL.Edit.Poly = L.Handler.extend({\n\toptions: {},\n\n\tinitialize: function (poly, options) {\n\n\t\tthis.latlngs = [poly._latlngs];\n\t\tif (poly._holes) {\n\t\t\tthis.latlngs = this.latlngs.concat(poly._holes);\n\t\t}\n\n\t\tthis._verticesHandlers = [];\n\t\tfor (var i = 0; i < this.latlngs.length; i++) {\n\t\t\tthis._verticesHandlers.push(new L.Edit.PolyVerticesEdit(poly, this.latlngs[i], options));\n\t\t}\n\n\t\tthis._poly = poly;\n\t\tL.setOptions(this, options);\n\t},\n\n\t_eachVertexHandler: function (callback) {\n\t\tfor (var i = 0; i < this._verticesHandlers.length; i++) {\n\t\t\tcallback(this._verticesHandlers[i]);\n\t\t}\n\t},\n\n\taddHooks: function () {\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.addHooks();\n\t\t});\n\t\tthis._openPopover();\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.removeHooks();\n\t\t});\n\t\tthis._closePopover();\n\t},\n\n\tupdateMarkers: function () {\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.updateMarkers();\n\t\t});\n\t},\n\t_openPopover:function(){\n\t\tthis._createPopover();\n\t},\n\t_createPopover:function() {\n\t\tvar self = this,\n\t\t\tcontainer = L.SvFeatureGroup.bindPopupContainer(self._poly,self);\n\n\t\tif(container) {\n\t\t\tself._poly.bindPopup(container, {\n\t\t\t\tcloseButton: false,\n\t\t\t\toffset: new L.Point(0, 0)\n\t\t\t});\n\t\t\tself._poly.openPopup();\n\t\t\tvar bs = self._poly.getBounds();\n\t\t\tself._poly._popup.setLatLng(new L.LatLng(bs._southWest.lat, bs._southWest.lng+(bs._northEast.lng-bs._southWest.lng)/2));\n\t\t}\n\t},\n\t_closePopover:function() {\n\t\tvar self = this;\n\t\tself._poly.closePopup();\n\t\tself._poly.unbindPopup();\n\t},\n\tclosePopup:function(){\n\t\tthis._closePopover();\n\t}\n\n});\n\nL.Edit.PolyVerticesEdit = L.Handler.extend({\n\toptions: {\n\t\ticon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon'\n\t\t}),\n\t\ttouchIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-touch-icon'\n\t\t}),\n\t},\n\n\tinitialize: function (poly, latlngs, options) {\n\t\t// if touch, switch to touch icon\n\t\tif (L.Browser.touch) {\n\t\t\tthis.options.icon = this.options.touchIcon;\n\t\t}\n\t\tthis._poly = poly;\n\t\tthis._latlngs = latlngs;\n\n\t\tL.setOptions(this, options);\n\t},\n\n\taddHooks: function () {\n\t\tvar poly = this._poly;\n\n\t\tif (!(poly instanceof L.Polygon)) {\n\t\t\tpoly.editing.options.fill = false;\n\t\t}\n\n\t\tpoly.setStyle(poly.editing.options);\n\n\t\tif (this._poly._map) {\n\n\t\t\tthis._map = this._poly._map; // Set map\n\n\t\t\tif (!this._markerGroup) {\n\t\t\t\tthis._initMarkers();\n\t\t\t}\n\t\t\tthis._poly._map.addLayer(this._markerGroup);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tvar poly = this._poly;\n\n\t\tpoly.setStyle(poly.options.original);\n\n\t\tif (poly._map) {\n\t\t\tpoly._map.removeLayer(this._markerGroup);\n\t\t\tdelete this._markerGroup;\n\t\t\tdelete this._markers;\n\t\t}\n\t},\n\n\tupdateMarkers: function () {\n\t\tthis._markerGroup.clearLayers();\n\t\tthis._initMarkers();\n\t},\n\n\t_initMarkers: function () {\n\t\tif (!this._markerGroup) {\n\t\t\tthis._markerGroup = new L.LayerGroup();\n\t\t}\n\t\tthis._markers = [];\n\n\t\tvar latlngs = this._latlngs,\n\t\t\ti, j, len, marker;\n\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\n\n\t\t\tmarker = this._createMarker(latlngs[i], i);\n\t\t\tmarker.on('click', this._onMarkerClick, this);\n\t\t\tthis._markers.push(marker);\n\t\t}\n\n\t\tvar markerLeft, markerRight;\n\n\t\tfor (i = 0, j = len - 1; i < len; j = i++) {\n\t\t\tif (i === 0 && !(L.Polygon && (this._poly instanceof L.Polygon))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmarkerLeft = this._markers[j];\n\t\t\tmarkerRight = this._markers[i];\n\n\t\t\tthis._createMiddleMarker(markerLeft, markerRight);\n\t\t\tthis._updatePrevNext(markerLeft, markerRight);\n\t\t}\n\t},\n\n\t_createMarker: function (latlng, index) {\n\t\t// Extending L.Marker in TouchEvents.js to include touch.\n\t\tvar marker = new L.Marker.Touch(latlng, {\n\t\t\tdraggable: true,\n\t\t\ticon: this.options.icon,\n\t\t});\n\n\t\tmarker._origLatLng = latlng;\n\t\tmarker._index = index;\n\n\t\tmarker\n\t\t\t.on('dragstart', this._onMarkerDragStart, this)\n\t\t\t.on('drag', this._onMarkerDrag, this)\n\t\t\t.on('dragend', this._fireEdit, this)\n\t\t\t.on('touchmove', this._onTouchMove, this)\n\t\t\t.on('MSPointerMove', this._onTouchMove, this)\n\t\t\t.on('touchend', this._fireEdit, this)\n\t\t\t.on('MSPointerUp', this._fireEdit, this);\n\n\t\tthis._markerGroup.addLayer(marker);\n\n\t\treturn marker;\n\t},\n\n\t_onMarkerDragStart: function () {\n\t\tthis._poly.fire('editstart');\n\t},\n\n\t_spliceLatLngs: function () {\n\t\tvar removed = [].splice.apply(this._latlngs, arguments);\n\t\tthis._poly._convertLatLngs(this._latlngs, true);\n\t\tthis._poly.redraw();\n\t\treturn removed;\n\t},\n\n\t_removeMarker: function (marker) {\n\t\tvar i = marker._index;\n\n\t\tthis._markerGroup.removeLayer(marker);\n\t\tthis._markers.splice(i, 1);\n\t\tthis._spliceLatLngs(i, 1);\n\t\tthis._updateIndexes(i, -1);\n\n\t\tmarker\n\t\t\t.off('dragstart', this._onMarkerDragStart, this)\n\t\t\t.off('drag', this._onMarkerDrag, this)\n\t\t\t.off('dragend', this._fireEdit, this)\n\t\t\t.off('touchmove', this._onMarkerDrag, this)\n\t\t\t.off('touchend', this._fireEdit, this)\n\t\t\t.off('click', this._onMarkerClick, this);\n\t},\n\n\t_fireEdit: function () {\n\t\tthis._poly.edited = true;\n\t\tthis._poly.fire('edit');\n\t\tthis._poly._map.fire('draw:editvertex', { layers: this._markerGroup });\n\t},\n\n\t_onMarkerDrag: function (e) {\n\t\tvar marker = e.target;\n\n\t\tL.extend(marker._origLatLng, marker._latlng);\n\n\t\tif (marker._middleLeft) {\n\t\t\tmarker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tmarker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));\n\t\t}\n\n\t\tthis._poly.redraw();\n\t\tthis._poly.fire('editdrag');\n\t},\n\n\t_onMarkerClick: function (e) {\n\n\t\tvar minPoints = L.Polygon && (this._poly instanceof L.Polygon) ? 4 : 3,\n\t\t\tmarker = e.target;\n\n\t\t// If removing this point would create an invalid polyline/polygon don't remove\n\t\tif (this._latlngs.length < minPoints) {\n\t\t\treturn;\n\t\t}\n\n\t\t// remove the marker\n\t\tthis._removeMarker(marker);\n\n\t\t// update prev/next links of adjacent markers\n\t\tthis._updatePrevNext(marker._prev, marker._next);\n\n\t\t// remove ghost markers near the removed marker\n\t\tif (marker._middleLeft) {\n\t\t\tthis._markerGroup.removeLayer(marker._middleLeft);\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tthis._markerGroup.removeLayer(marker._middleRight);\n\t\t}\n\n\t\t// create a ghost marker in place of the removed one\n\t\tif (marker._prev && marker._next) {\n\t\t\tthis._createMiddleMarker(marker._prev, marker._next);\n\n\t\t} else if (!marker._prev) {\n\t\t\tmarker._next._middleLeft = null;\n\n\t\t} else if (!marker._next) {\n\t\t\tmarker._prev._middleRight = null;\n\t\t}\n\n\t\tthis._fireEdit();\n\t},\n\n\t_onTouchMove: function (e) {\n\n\t\tvar layerPoint = this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tmarker = e.target;\n\n\t\tL.extend(marker._origLatLng, latlng);\n\n\t\tif (marker._middleLeft) {\n\t\t\tmarker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tmarker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));\n\t\t}\n\n\t\tthis._poly.redraw();\n\t\tthis.updateMarkers();\n\t},\n\n\t_updateIndexes: function (index, delta) {\n\t\tthis._markerGroup.eachLayer(function (marker) {\n\t\t\tif (marker._index > index) {\n\t\t\t\tmarker._index += delta;\n\t\t\t}\n\t\t});\n\t},\n\n\t_createMiddleMarker: function (marker1, marker2) {\n\t\tvar latlng = this._getMiddleLatLng(marker1, marker2),\n\t\t\tmarker = this._createMarker(latlng),\n\t\t\tonClick,\n\t\t\tonDragStart,\n\t\t\tonDragEnd;\n\n\t\tmarker.setOpacity(0.6);\n\n\t\tmarker1._middleRight = marker2._middleLeft = marker;\n\n\t\tonDragStart = function () {\n\t\t\tvar i = marker2._index;\n\n\t\t\tmarker._index = i;\n\n\t\t\tmarker\n\t\t\t\t.off('click', onClick, this)\n\t\t\t\t.on('click', this._onMarkerClick, this);\n\n\t\t\tlatlng.lat = marker.getLatLng().lat;\n\t\t\tlatlng.lng = marker.getLatLng().lng;\n\t\t\tthis._spliceLatLngs(i, 0, latlng);\n\t\t\tthis._markers.splice(i, 0, marker);\n\n\t\t\tmarker.setOpacity(1);\n\n\t\t\tthis._updateIndexes(i, 1);\n\t\t\tmarker2._index++;\n\t\t\tthis._updatePrevNext(marker1, marker);\n\t\t\tthis._updatePrevNext(marker, marker2);\n\n\t\t\tthis._poly.fire('editstart');\n\t\t};\n\n\t\tonDragEnd = function () {\n\t\t\tmarker.off('dragstart', onDragStart, this);\n\t\t\tmarker.off('dragend', onDragEnd, this);\n\t\t\tmarker.off('touchmove', onDragStart, this);\n\n\t\t\tthis._createMiddleMarker(marker1, marker);\n\t\t\tthis._createMiddleMarker(marker, marker2);\n\t\t};\n\n\t\tonClick = function () {\n\t\t\tonDragStart.call(this);\n\t\t\tonDragEnd.call(this);\n\t\t\tthis._fireEdit();\n\t\t};\n\n\t\tmarker\n\t\t\t.on('click', onClick, this)\n\t\t\t.on('dragstart', onDragStart, this)\n\t\t\t.on('dragend', onDragEnd, this)\n\t\t\t.on('touchmove', onDragStart, this);\n\n\t\tthis._markerGroup.addLayer(marker);\n\t},\n\n\t_updatePrevNext: function (marker1, marker2) {\n\t\tif (marker1) {\n\t\t\tmarker1._next = marker2;\n\t\t}\n\t\tif (marker2) {\n\t\t\tmarker2._prev = marker1;\n\t\t}\n\t},\n\n\t_getMiddleLatLng: function (marker1, marker2) {\n\t\tvar map = this._poly._map,\n\t\t\tp1 = map.project(marker1.getLatLng()),\n\t\t\tp2 = map.project(marker2.getLatLng());\n\n\t\treturn map.unproject(p1._add(p2)._divideBy(2));\n\t}\n});\n\nL.Polyline.addInitHook(function () {\n\n\t// Check to see if handler has already been initialized. This is to support versions of Leaflet that still have L.Handler.PolyEdit\n\tif (this.editing) {\n\t\treturn;\n\t}\n\n\tif (L.Edit.Poly) {\n\t\tthis.editing = new L.Edit.Poly(this);\n\n\t\tif (this.options.editable) {\n\t\t\tthis.editing.enable();\n\t\t}\n\t}\n\n\tthis.on('add', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.addHooks();\n\t\t}\n\t});\n\n\tthis.on('remove', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.removeHooks();\n\t\t}\n\t});\n});\n\nL.Edit = L.Edit || {};\n\nL.Edit.SimpleShape = L.Handler.extend({\n\toptions: {\n\t\tmoveIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move'\n\t\t}),\n\t\tresizeIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize'\n\t\t}),\n\t\ttouchMoveIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon'\n\t\t}),\n\t\ttouchResizeIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon'\n\t\t})\n\t},\n\n\tinitialize: function (shape, options) {\n\t\t// if touch, switch to touch icon\n\t\tif (L.Browser.touch) {\n\t\t\tthis.options.moveIcon = this.options.touchMoveIcon;\n\t\t\tthis.options.resizeIcon = this.options.touchResizeIcon;\n\t\t}\n\n\t\tthis._shape = shape;\n\t\tL.Util.setOptions(this, options);\n\t},\n\n\taddHooks: function () {\n\t\tvar shape = this._shape;\n\t\tif (this._shape._map) {\n\t\t\tthis._map = this._shape._map;\n\t\t\tshape.setStyle(shape.options.editing);\n\n\t\t\tif (shape._map) {\n\t\t\t\tthis._map = shape._map;\n\t\t\t\tif (!this._markerGroup) {\n\t\t\t\t\tthis._initMarkers();\n\t\t\t\t}\n\t\t\t\tthis._map.addLayer(this._markerGroup);\n\t\t\t}\n\t\t}\n\t\tthis._openPopover();\n\t\tthis._map.on('preclick',this._onMouseClick,this)\n\t},\n\n\tremoveHooks: function () {\n\t\tvar shape = this._shape;\n\n\t\tshape.setStyle(shape.options.original);\n\n\t\tif (shape._map) {\n\t\t\tthis._unbindMarker(this._moveMarker);\n\n\t\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\n\t\t\t\tthis._unbindMarker(this._resizeMarkers[i]);\n\t\t\t}\n\t\t\tthis._resizeMarkers = null;\n\n\t\t\tthis._map.removeLayer(this._markerGroup);\n\t\t\tdelete this._markerGroup;\n\t\t}\n\t\tthis._closePopover();\n\t\tthis._map.off('preclick',this._onMouseClick,this);\n\t\tthis._map = null;\n\t},\n\t_onMouseClick:function(e){\n\t\tthis.disable();\n\t},\n\tupdateMarkers: function () {\n\t\tthis._markerGroup.clearLayers();\n\t\tthis._initMarkers();\n\t},\n\n\t_initMarkers: function () {\n\t\tif (!this._markerGroup) {\n\t\t\tthis._markerGroup = new L.LayerGroup();\n\t\t}\n\n\t\t// Create center marker\n\t\tthis._createMoveMarker();\n\n\t\t// Create edge marker\n\t\tthis._createResizeMarker();\n\t},\n\n\t_createMoveMarker: function () {\n\t\t// Children override\n\t},\n\n\t_createResizeMarker: function () {\n\t\t// Children override\n\t},\n\n\t_createMarker: function (latlng, icon) {\n\t\t// Extending L.Marker in TouchEvents.js to include touch.\n\t\tvar marker = new L.Marker.Touch(latlng, {\n\t\t\tdraggable: true,\n\t\t\ticon: icon,\n\t\t\tzIndexOffset: 10\n\t\t});\n\n\t\tthis._bindMarker(marker);\n\n\t\tthis._markerGroup.addLayer(marker);\n\n\t\treturn marker;\n\t},\n\n\t_bindMarker: function (marker) {\n\t\tmarker\n\t\t\t.on('dragstart', this._onMarkerDragStart, this)\n\t\t\t.on('drag', this._onMarkerDrag, this)\n\t\t\t.on('dragend', this._onMarkerDragEnd, this)\n\t\t\t.on('touchstart', this._onTouchStart, this)\n\t\t\t.on('touchmove', this._onTouchMove, this)\n\t\t\t.on('MSPointerMove', this._onTouchMove, this)\n\t\t\t.on('touchend', this._onTouchEnd, this)\n\t\t\t.on('MSPointerUp', this._onTouchEnd, this);\n\t},\n\n\t_unbindMarker: function (marker) {\n\t\tmarker\n\t\t\t.off('dragstart', this._onMarkerDragStart, this)\n\t\t\t.off('drag', this._onMarkerDrag, this)\n\t\t\t.off('dragend', this._onMarkerDragEnd, this)\n\t\t\t.off('touchstart', this._onTouchStart, this)\n\t\t\t.off('touchmove', this._onTouchMove, this)\n\t\t\t.off('MSPointerMove', this._onTouchMove, this)\n\t\t\t.off('touchend', this._onTouchEnd, this)\n\t\t\t.off('MSPointerUp', this._onTouchEnd, this);\n\t},\n\n\t_onMarkerDragStart: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(0);\n\n\t\tthis._shape.fire('editstart');\n\t},\n\n\t_fireEdit: function () {\n\t\tthis._shape.edited = true;\n\t\tthis._shape.fire('edit');\n\t\tL.SvFeatureGroup.onUpdate(this._shape);\n\t},\n\n\t_onMarkerDrag: function (e) {\n\t\tvar marker = e.target,\n\t\t\tlatlng = marker.getLatLng();\n\n\t\tthis._closePopover();\n\n\t\tif (marker === this._moveMarker) {\n\t\t\tthis._move(latlng);\n\t\t} else {\n\t\t\tthis._resize(latlng);\n\t\t}\n\n\t\tthis._shape.redraw();\n\t\tthis._shape.fire('editdrag');\n\t},\n\n\t_onMarkerDragEnd: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(1);\n\t\tthis._openPopover();\n\t\tthis._fireEdit();\n\t},\n\n\t_onTouchStart: function (e) {\n\t\tthis.isOnTouchStart = true;\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\n\n\t\tif (typeof(this._getCorners) === 'function') {\n\t\t\t// Save a reference to the opposite point\n\t\t\tvar corners = this._getCorners(),\n\t\t\t\tmarker = e.target,\n\t\t\t\tcurrentCornerIndex = marker._cornerIndex;\n\n\t\t\tmarker.setOpacity(0);\n\n\t\t\t// Copyed from Edit.Rectangle.js line 23 _onMarkerDragStart()\n\t\t\t// Latlng is null otherwise.\n\t\t\tthis._oppositeCorner = corners[(currentCornerIndex + 2) % 4];\n\t\t\tthis._toggleCornerMarkers(0, currentCornerIndex);\n\t\t}\n\n\t\tthis._shape.fire('editstart');\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tif(!this.isOnTouchStart){\n\t\t\tthis._onTouchStart(e);\n\t\t}\n\t\tthis.isOnTouchStart = false;\n\t\tvar layerPoint = this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tmarker = e.target;\n\t\tthis._closePopover()\n\t\tif (marker === this._moveMarker) {\n\t\t\tthis._move(latlng);\n\t\t} else {\n\t\t\tthis._resize(latlng);\n\t\t}\n\n\t\tthis._shape.redraw();\n\t\t\n\t\t// prevent touchcancel in IOS\n\t\t// e.preventDefault();\n\t\treturn false;\n\t},\n\n\t_onTouchEnd: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(1);\n\t\tthis.updateMarkers();\n\t\tthis._openPopover();\n\t\tthis._fireEdit();\n\t},\n\n\t_move: function () {\n\t\t// Children override\n\t},\n\n\t_resize: function () {\n\t\t// Children override\n\t},\n\n\t_openPopover:function(){\n\t\tthis._createPopover();\n\t},\n\t_createPopover:function() {\n\t\tvar self = this,\n\t\t\tcontainer = L.SvFeatureGroup.bindPopupContainer(self._shape,self);\n\n\t\tif(container) {\n\t\t\tthis._shape.bindPopup(container,{\n\t\t\t\tcloseButton:false,\n\t\t\t\toffset: this._getPopupOffset()\n\t\t\t});\n\t\t\tvar t = this._shape._boundsToLatLngs(this._shape.getBounds()),\n\t\t\t\tn = t[0].lng + (t[2].lng - t[0].lng) / 2;\n\t\t\tthis._shape.openPopup(new L.LatLng(t[0].lat, n));\n\t\t}\n\n\n\t},\n\t_getPopupOffset:function(){\n\t\treturn new L.Point(0,0);\n\t},\n\t_closePopover:function() {\n\t\tthis._shape.closePopup();\n\t\tthis._shape.unbindPopup();\n\t},\n\tclosePopup:function(){\n\t\tthis._closePopover();\n\t}\n});\n\n\nL.Edit = L.Edit || {};\n\nL.Edit.Rectangle = L.Edit.SimpleShape.extend({\n\t_createMoveMarker: function () {\n\t\tvar bounds = this._shape.getBounds(),\n\t\t\tcenter = bounds.getCenter();\n\n\t\tthis._moveMarker = this._createMarker(center, this.options.moveIcon);\n\t},\n\n\t_createResizeMarker: function () {\n\t\tvar corners = this._getCorners();\n\n\t\tthis._resizeMarkers = [];\n\n\t\tfor (var i = 0, l = corners.length; i < l; i++) {\n\t\t\tthis._resizeMarkers.push(this._createMarker(corners[i], this.options.resizeIcon));\n\t\t\t// Monkey in the corner index as we will need to know this for dragging\n\t\t\tthis._resizeMarkers[i]._cornerIndex = i;\n\t\t}\n\t},\n\n\t_onMarkerDragStart: function (e) {\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\n\n\t\t// Save a reference to the opposite point\n\t\tvar corners = this._getCorners(),\n\t\t\tmarker = e.target,\n\t\t\tcurrentCornerIndex = marker._cornerIndex;\n\n\t\tthis._oppositeCorner = corners[(currentCornerIndex + 2) % 4];\n\n\t\tthis._toggleCornerMarkers(0, currentCornerIndex);\n\t},\n\n\t_onMarkerDragEnd: function (e) {\n\t\tvar marker = e.target,\n\t\t\tbounds, center;\n\n\t\t// Reset move marker position to the center\n\t\tif (marker === this._moveMarker) {\n\t\t\tbounds = this._shape.getBounds();\n\t\t\tcenter = bounds.getCenter();\n\n\t\t\tmarker.setLatLng(center);\n\t\t}\n\n\t\tthis._toggleCornerMarkers(1);\n\n\t\tthis._repositionCornerMarkers();\n\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this, e);\n\t},\n\n\t_move: function (newCenter) {\n\t\tvar latlngs = this._shape.getLatLngs(),\n\t\t\tbounds = this._shape.getBounds(),\n\t\t\tcenter = bounds.getCenter(),\n\t\t\toffset, newLatLngs = [];\n\n\t\t// Offset the latlngs to the new center\n\t\tfor (var i = 0, l = latlngs.length; i < l; i++) {\n\t\t\toffset = [latlngs[i].lat - center.lat, latlngs[i].lng - center.lng];\n\t\t\tnewLatLngs.push([newCenter.lat + offset[0], newCenter.lng + offset[1]]);\n\t\t}\n\n\t\tthis._shape.setLatLngs(newLatLngs);\n\n\t\t// Reposition the resize markers\n\t\tthis._repositionCornerMarkers();\n\t},\n\n\t_resize: function (latlng) {\n\t\tvar bounds;\n\n\t\t// Update the shape based on the current position of this corner and the opposite point\n\t\tthis._shape.setBounds(L.latLngBounds(latlng, this._oppositeCorner));\n\n\t\t// Reposition the move marker\n\t\tbounds = this._shape.getBounds();\n\t\tthis._moveMarker.setLatLng(bounds.getCenter());\n\t},\n\n\t_getCorners: function () {\n\t\tvar bounds = this._shape.getBounds(),\n\t\t\tnw = bounds.getNorthWest(),\n\t\t\tne = bounds.getNorthEast(),\n\t\t\tse = bounds.getSouthEast(),\n\t\t\tsw = bounds.getSouthWest();\n\n\t\treturn [nw, ne, se, sw];\n\t},\n\n\t_toggleCornerMarkers: function (opacity) {\n\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\n\t\t\tthis._resizeMarkers[i].setOpacity(opacity);\n\t\t}\n\t},\n\n\t_repositionCornerMarkers: function () {\n\t\tvar corners = this._getCorners();\n\n\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\n\t\t\tthis._resizeMarkers[i].setLatLng(corners[i]);\n\t\t}\n\t}\n});\n\nL.Rectangle.addInitHook(function () {\n\tif (L.Edit.Rectangle) {\n\t\tthis.editing = new L.Edit.Rectangle(this);\n\n\t\tif (this.options.editable) {\n\t\t\t//this.editing.enable();\n\t\t}\n\t}\n});\n\n\nL.Edit = L.Edit || {};\n\nL.Edit.Circle = L.Edit.SimpleShape.extend({\n\t_createMoveMarker: function () {\n\t\tvar center = this._shape.getLatLng();\n\n\t\tthis._moveMarker = this._createMarker(center, this.options.moveIcon);\n\t},\n\n\t_createResizeMarker: function () {\n\t\tvar center = this._shape.getLatLng(),\n\t\t\tresizemarkerPoint = this._getResizeMarkerPoint(center);\n\n\t\tthis._resizeMarkers = [];\n\t\tthis._resizeMarkers.push(this._createMarker(resizemarkerPoint, this.options.resizeIcon));\n\t},\n\n\t_getResizeMarkerPoint: function (latlng) {\n\t\t// From L.shape.getBounds()\n\t\tvar delta = this._shape._radius * Math.cos(Math.PI / 4),\n\t\t\tpoint = this._map.project(latlng);\n\t\treturn this._map.unproject([point.x + delta, point.y - delta]);\n\t},\n\n\t_move: function (latlng) {\n\t\tvar resizemarkerPoint = this._getResizeMarkerPoint(latlng);\n\n\t\t// Move the resize marker\n\t\tthis._resizeMarkers[0].setLatLng(resizemarkerPoint);\n\n\t\t// Move the circle\n\t\tthis._shape.setLatLng(latlng);\n\t},\n\n\t_resize: function (latlng) {\n\t\tvar moveLatLng = this._moveMarker.getLatLng(),\n\t\t\tradius = moveLatLng.distanceTo(latlng);\n\n\t\tthis._shape.setRadius(radius);\n\t}\n});\n\nL.Circle.addInitHook(function () {\n\tif (L.Edit.Circle) {\n\t\tthis.editing = new L.Edit.Circle(this);\n\n\t\tif (this.options.editable) {\n\t\t\t//this.editing.enable();\n\t\t}\n\t}\n\n\tthis.on('add', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.addHooks();\n\t\t}\n\t});\n\n\tthis.on('remove', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.removeHooks();\n\t\t}\n\t});\n});\n\nL.Map.mergeOptions({\n\ttouchExtend: true\n});\n\nL.Map.TouchExtend = L.Handler.extend({\n\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\tthis._container = map._container;\n\t\tthis._pane = map._panes.overlayPane;\n\t},\n\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._container, 'touchstart', this._onTouchStart, this);\n\t\tL.DomEvent.on(this._container, 'touchend', this._onTouchEnd, this);\n\t\tL.DomEvent.on(this._container, 'touchmove', this._onTouchMove, this);\n\t\tif (this._detectIE()) {\n\t\t\tL.DomEvent.on(this._container, 'MSPointerDown', this._onTouchStart, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerUp', this._onTouchEnd, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerMove', this._onTouchMove, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerCancel', this._onTouchCancel, this);\n\n\t\t} else {\n\t\t\tL.DomEvent.on(this._container, 'touchcancel', this._onTouchCancel, this);\n\t\t\tL.DomEvent.on(this._container, 'touchleave', this._onTouchLeave, this);\n\t\t}\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._container, 'touchstart', this._onTouchStart);\n\t\tL.DomEvent.off(this._container, 'touchend', this._onTouchEnd);\n\t\tL.DomEvent.off(this._container, 'touchmove', this._onTouchMove);\n\t\tif (this._detectIE()) {\n\t\t\tL.DomEvent.off(this._container, 'MSPointerDowm', this._onTouchStart);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerUp', this._onTouchEnd);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerMove', this._onTouchMove);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerCancel', this._onTouchCancel);\n\t\t} else {\n\t\t\tL.DomEvent.off(this._container, 'touchcancel', this._onTouchCancel);\n\t\t\tL.DomEvent.off(this._container, 'touchleave', this._onTouchLeave);\n\t\t}\n\t},\n\n\t_touchEvent: function (e, type) {\n\t\t// #TODO: fix the pageX error that is do a bug in Android where a single touch triggers two click events\n\t\t// _filterClick is what leaflet uses as a workaround.\n\t\t// This is a problem with more things than just android. Another problem is touchEnd has no touches in\n\t\t// its touch list.\n\t\tvar touchEvent = {};\n\t\tif (typeof e.touches !== 'undefined') {\n\t\t\tif (!e.touches.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttouchEvent = e.touches[0];\n\t\t} else if (e.pointerType === 'touch') {\n\t\t\ttouchEvent = e;\n            if (!this._filterClick(e)) {\n                return;\n            }\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tvar containerPoint = this._map.mouseEventToContainerPoint(touchEvent),\n\t\t\tlayerPoint = this._map.mouseEventToLayerPoint(touchEvent),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint);\n\n\t\tthis._map.fire(type, {\n\t\t\tlatlng: latlng,\n\t\t\tlayerPoint: layerPoint,\n\t\t\tcontainerPoint: containerPoint,\n\t\t\tpageX: touchEvent.pageX,\n\t\t\tpageY: touchEvent.pageY,\n\t\t\toriginalEvent: e\n\t\t});\n\t},\n\n    /** Borrowed from Leaflet and modified for bool ops **/\n    _filterClick: function (e) {\n        var timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\n            elapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\n\n        // are they closer together than 500ms yet more than 100ms?\n        // Android typically triggers them ~300ms apart while multiple listeners\n        // on the same event should be triggered far faster;\n        // or check if click is simulated on the element, and if it is, reject any non-simulated events\n        if ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\n            L.DomEvent.stop(e);\n            return false;\n        }\n        L.DomEvent._lastClick = timeStamp;\n        return true;\n    },\n\n\t_onTouchStart: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchstart';\n\t\tthis._touchEvent(e, type);\n\n\t},\n\n\t_onTouchEnd: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchend';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchCancel: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchcancel';\n\t\tif (this._detectIE()) {\n\t\t\ttype = 'pointercancel';\n\t\t}\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchLeave: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchleave';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchmove';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_detectIE: function () {\n\t\tvar ua = window.navigator.userAgent;\n\n\t\tvar msie = ua.indexOf('MSIE ');\n\t\tif (msie > 0) {\n\t\t\t// IE 10 or older => return version number\n\t\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n\t\t}\n\n\t\tvar trident = ua.indexOf('Trident/');\n\t\tif (trident > 0) {\n\t\t\t// IE 11 => return version number\n\t\t\tvar rv = ua.indexOf('rv:');\n\t\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n\t\t}\n\n\t\tvar edge = ua.indexOf('Edge/');\n\t\tif (edge > 0) {\n\t\t\t// IE 12 => return version number\n\t\t\treturn parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n\t\t}\n\n\t\t// other browser\n\t\treturn false;\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'touchExtend', L.Map.TouchExtend);\n\n// This isn't full Touch support. This is just to get makers to also support dom touch events after creation\n// #TODO: find a better way of getting markers to support touch.\nL.Marker.Touch = L.Marker.extend({\n\n\t// This is an exact copy of https://github.com/Leaflet/Leaflet/blob/v0.7/src/layer/marker/Marker.js\n\t// with the addition of the touch event son line 15.\n\t_initInteraction: function () {\n\n\t\tif (!this.options.clickable) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\n\n\t\tvar icon = this._icon,\n\t\t\tevents = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu', 'touchstart', 'touchend', 'touchmove'];\n\t\tif (this._detectIE()) {\n\t\t\tevents.concat(['MSPointerDown', 'MSPointerUp', 'MSPointerMove', 'MSPointerCancel']);\n\t\t} else {\n\t\t\tevents.concat(['touchcancel']);\n\t\t}\n\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\n\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\n\t\t}\n\n\t\tif (L.Handler.MarkerDrag) {\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\n\n\t\t\tif (this.options.draggable) {\n\t\t\t\tthis.dragging.enable();\n\t\t\t}\n\t\t}\n\t},\n\t_detectIE: function () {\n\t\tvar ua = window.navigator.userAgent;\n\n\t\tvar msie = ua.indexOf('MSIE ');\n\t\tif (msie > 0) {\n\t\t\t// IE 10 or older => return version number\n\t\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n\t\t}\n\n\t\tvar trident = ua.indexOf('Trident/');\n\t\tif (trident > 0) {\n\t\t\t// IE 11 => return version number\n\t\t\tvar rv = ua.indexOf('rv:');\n\t\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n\t\t}\n\n\t\tvar edge = ua.indexOf('Edge/');\n\t\tif (edge > 0) {\n\t\t\t// IE 12 => return version number\n\t\t\treturn parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n\t\t}\n\n\t\t// other browser\n\t\treturn false;\n\t}\n});\n\n\n/*\n * L.LatLngUtil contains different utility functions for LatLngs.\n */\n\nL.LatLngUtil = {\n\t// Clones a LatLngs[], returns [][]\n\tcloneLatLngs: function (latlngs) {\n\t\tvar clone = [];\n\t\tfor (var i = 0, l = latlngs.length; i < l; i++) {\n\t\t\tclone.push(this.cloneLatLng(latlngs[i]));\n\t\t}\n\t\treturn clone;\n\t},\n\n\tcloneLatLng: function (latlng) {\n\t\treturn L.latLng(latlng.lat, latlng.lng);\n\t}\n};\n\nL.GeometryUtil = L.extend(L.GeometryUtil || {}, {\n\t// Ported from the OpenLayers implementation. See https://github.com/openlayers/openlayers/blob/master/lib/OpenLayers/Geometry/LinearRing.js#L270\n\tgeodesicArea: function (latLngs) {\n\t\tvar pointsCount = latLngs.length,\n\t\t\tarea = 0.0,\n\t\t\td2r = L.LatLng.DEG_TO_RAD,\n\t\t\tp1, p2;\n\n\t\tif (pointsCount > 2) {\n\t\t\tfor (var i = 0; i < pointsCount; i++) {\n\t\t\t\tp1 = latLngs[i];\n\t\t\t\tp2 = latLngs[(i + 1) % pointsCount];\n\t\t\t\tarea += ((p2.lng - p1.lng) * d2r) *\n\t\t\t\t\t\t(2 + Math.sin(p1.lat * d2r) + Math.sin(p2.lat * d2r));\n\t\t\t}\n\t\t\tarea = area * 6378137.0 * 6378137.0 / 2.0;\n\t\t}\n\n\t\treturn Math.abs(area);\n\t},\n\n\treadableArea: function (area, isMetric) {\n\t\tvar areaStr;\n\n\t\tif (isMetric) {\n\t\t\tif (area >= 10000) {\n\t\t\t\tareaStr = (area * 0.0001).toFixed(2) + ' ha';\n\t\t\t} else {\n\t\t\t\tareaStr = area.toFixed(2) + ' m&sup2;';\n\t\t\t}\n\t\t} else {\n\t\t\tarea /= 0.836127; // Square yards in 1 meter\n\n\t\t\tif (area >= 3097600) { //3097600 square yards in 1 square mile\n\t\t\t\tareaStr = (area / 3097600).toFixed(2) + ' mi&sup2;';\n\t\t\t} else if (area >= 4840) {//48040 square yards in 1 acre\n\t\t\t\tareaStr = (area / 4840).toFixed(2) + ' acres';\n\t\t\t} else {\n\t\t\t\tareaStr = Math.ceil(area) + ' yd&sup2;';\n\t\t\t}\n\t\t}\n\n\t\treturn areaStr;\n\t},\n\n\treadableDistance: function (distance, isMetric, useFeet) {\n\t\tvar distanceStr;\n\n\t\tif (isMetric) {\n\t\t\t// show metres when distance is < 1km, then show km\n\t\t\tif (distance > 1000) {\n\t\t\t\tdistanceStr = (distance  / 1000).toFixed(2) + ' km';\n\t\t\t} else {\n\t\t\t\tdistanceStr = Math.ceil(distance) + ' m';\n\t\t\t}\n\t\t} else {\n\t\t\tdistance *= 1.09361;\n\n\t\t\tif (distance > 1760) {\n\t\t\t\tdistanceStr = (distance / 1760).toFixed(2) + ' miles';\n\t\t\t} else {\n\t\t\t\tvar suffix = ' yd';\n\t\t\t\tif (useFeet) {\n\t\t\t\t\tdistance = distance * 3;\n\t\t\t\t\tsuffix = ' ft';\n\t\t\t\t}\n\t\t\t\tdistanceStr = Math.ceil(distance) + suffix;\n\t\t\t}\n\t\t}\n\n\t\treturn distanceStr;\n\t}\n});\n\n\nL.Util.extend(L.LineUtil, {\n\t// Checks to see if two line segments intersect. Does not handle degenerate cases.\n\t// http://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf\n\tsegmentsIntersect: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2, /*Point*/ p3) {\n\t\treturn\tthis._checkCounterclockwise(p, p2, p3) !==\n\t\t\t\tthis._checkCounterclockwise(p1, p2, p3) &&\n\t\t\t\tthis._checkCounterclockwise(p, p1, p2) !==\n\t\t\t\tthis._checkCounterclockwise(p, p1, p3);\n\t},\n\n\t// check to see if points are in counterclockwise order\n\t_checkCounterclockwise: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\n\t\treturn (p2.y - p.y) * (p1.x - p.x) > (p1.y - p.y) * (p2.x - p.x);\n\t}\n});\n\nL.Polyline.include({\n\t// Check to see if this polyline has any linesegments that intersect.\n\t// NOTE: does not support detecting intersection for degenerate cases.\n\tintersects: function () {\n\t\tvar points = this._originalPoints,\n\t\t\tlen = points ? points.length : 0,\n\t\t\ti, p, p1;\n\n\t\tif (this._tooFewPointsForIntersection()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (i = len - 1; i >= 3; i--) {\n\t\t\tp = points[i - 1];\n\t\t\tp1 = points[i];\n\n\n\t\t\tif (this._lineSegmentsIntersectsRange(p, p1, i - 2)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t// Check for intersection if new latlng was added to this polyline.\n\t// NOTE: does not support detecting intersection for degenerate cases.\n\tnewLatLngIntersects: function (latlng, skipFirst) {\n\t\t// Cannot check a polyline for intersecting lats/lngs when not added to the map\n\t\tif (!this._map) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.newPointIntersects(this._map.latLngToLayerPoint(latlng), skipFirst);\n\t},\n\n\t// Check for intersection if new point was added to this polyline.\n\t// newPoint must be a layer point.\n\t// NOTE: does not support detecting intersection for degenerate cases.\n\tnewPointIntersects: function (newPoint, skipFirst) {\n\t\tvar points = this._originalPoints,\n\t\t\tlen = points ? points.length : 0,\n\t\t\tlastPoint = points ? points[len - 1] : null,\n\t\t\t// The previous previous line segment. Previous line segment doesn't need testing.\n\t\t\tmaxIndex = len - 2;\n\n\t\tif (this._tooFewPointsForIntersection(1)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._lineSegmentsIntersectsRange(lastPoint, newPoint, maxIndex, skipFirst ? 1 : 0);\n\t},\n\n\t// Polylines with 2 sides can only intersect in cases where points are collinear (we don't support detecting these).\n\t// Cannot have intersection when < 3 line segments (< 4 points)\n\t_tooFewPointsForIntersection: function (extraPoints) {\n\t\tvar points = this._originalPoints,\n\t\t\tlen = points ? points.length : 0;\n\t\t// Increment length by extraPoints if present\n\t\tlen += extraPoints || 0;\n\n\t\treturn !this._originalPoints || len <= 3;\n\t},\n\n\t// Checks a line segment intersections with any line segments before its predecessor.\n\t// Don't need to check the predecessor as will never intersect.\n\t_lineSegmentsIntersectsRange: function (p, p1, maxIndex, minIndex) {\n\t\tvar points = this._originalPoints,\n\t\t\tp2, p3;\n\n\t\tminIndex = minIndex || 0;\n\n\t\t// Check all previous line segments (beside the immediately previous) for intersections\n\t\tfor (var j = maxIndex; j > minIndex; j--) {\n\t\t\tp2 = points[j - 1];\n\t\t\tp3 = points[j];\n\n\t\t\tif (L.LineUtil.segmentsIntersect(p, p1, p2, p3)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n});\n\n\nL.Polygon.include({\n\t// Checks a polygon for any intersecting line segments. Ignores holes.\n\tintersects: function () {\n\t\tvar polylineIntersects,\n\t\t\tpoints = this._originalPoints,\n\t\t\tlen, firstPoint, lastPoint, maxIndex;\n\n\t\tif (this._tooFewPointsForIntersection()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tpolylineIntersects = L.Polyline.prototype.intersects.call(this);\n\n\t\t// If already found an intersection don't need to check for any more.\n\t\tif (polylineIntersects) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlen = points.length;\n\t\tfirstPoint = points[0];\n\t\tlastPoint = points[len - 1];\n\t\tmaxIndex = len - 2;\n\n\t\t// Check the line segment between last and first point. Don't need to check the first line segment (minIndex = 1)\n\t\treturn this._lineSegmentsIntersectsRange(lastPoint, firstPoint, maxIndex, 1);\n\t}\n});\n\nL.Map.addInitHook(function () {\n\tif (this.options.drawControl) {\n\t\tthis.drawControl = new L.Control.Draw();\n\t\tthis.addControl(this.drawControl);\n\t}\n});\n\n\nL.Toolbar = L.Class.extend({\n\tincludes: [L.Mixin.Events],\n\n\tinitialize: function (options) {\n\t\tL.setOptions(this, options);\n\n\t\tthis._modes = {};\n\t\tthis._actionButtons = [];\n\t\tthis._activeMode = null;\n\t},\n\n\tenabled: function () {\n\t\treturn this._activeMode !== null;\n\t},\n\n\tdisable: function () {\n\t\tif (!this.enabled()) { return; }\n\n\t\tthis._activeMode.handler.disable();\n\t},\n\n\taddToolbar: function (map) {\n\t\tvar container = L.DomUtil.create('div', 'leaflet-draw-section'),\n\t\t\tbuttonIndex = 0,\n\t\t\tbuttonClassPrefix = this._toolbarClass || '',\n\t\t\tmodeHandlers = this.getModeHandlers(map),\n\t\t\ti;\n\n\t\tthis._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');\n\t\tthis._map = map;\n\n\t\tfor (i = 0; i < modeHandlers.length; i++) {\n\t\t\tif (modeHandlers[i].enabled) {\n\t\t\t\tif(modeHandlers[i].menus) {\n\t\t\t\t\tthis._initMenuModeHandler(\n\t\t\t\t\t\tmodeHandlers[i],\n\t\t\t\t\t\tthis._toolbarContainer,\n\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\treturn buttonIndex++;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttonClassPrefix\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._initModeHandler(\n\t\t\t\t\t\tmodeHandlers[i].handler,\n\t\t\t\t\t\tthis._toolbarContainer,\n\t\t\t\t\t\tbuttonIndex++,\n\t\t\t\t\t\tbuttonClassPrefix,\n\t\t\t\t\t\tmodeHandlers[i].title,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// if no buttons were added, do not add the toolbar\n\t\tif (!buttonIndex) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Save button index of the last button, -1 as we would have ++ after the last button\n\t\tthis._lastButtonIndex = --buttonIndex;\n\n\t\t// Create empty actions part of the toolbar\n\t\tthis._actionsContainer = L.DomUtil.create('ul', 'leaflet-draw-actions');\n\n\t\t// Add draw and cancel containers to the control container\n\t\tcontainer.appendChild(this._toolbarContainer);\n\t\tcontainer.appendChild(this._actionsContainer);\n\n\t\treturn container;\n\t},\n\n\tremoveToolbar: function () {\n\t\t// Dispose each handler\n\t\tfor (var handlerId in this._modes) {\n\t\t\tif (this._modes.hasOwnProperty(handlerId)) {\n\t\t\t\t// Unbind handler button\n\t\t\t\tthis._disposeButton(\n\t\t\t\t\tthis._modes[handlerId].button,\n\t\t\t\t\tthis._modes[handlerId].handler.enable,\n\t\t\t\t\tthis._modes[handlerId].handler\n\t\t\t\t);\n\n\t\t\t\t// Make sure is disabled\n\t\t\t\tthis._modes[handlerId].handler.disable();\n\n\t\t\t\t// Unbind handler\n\t\t\t\tthis._modes[handlerId].handler\n\t\t\t\t\t.off('enabled', this._handlerActivated, this)\n\t\t\t\t\t.off('disabled', this._handlerDeactivated, this);\n\t\t\t}\n\t\t}\n\t\tthis._modes = {};\n\n\t\t// Dispose the actions toolbar\n\t\tfor (var i = 0, l = this._actionButtons.length; i < l; i++) {\n\t\t\tthis._disposeButton(\n\t\t\t\tthis._actionButtons[i].button,\n\t\t\t\tthis._actionButtons[i].callback,\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\t\tthis._actionButtons = [];\n\t\tthis._actionsContainer = null;\n\t},\n\n\t_initMenuModeHandler:function(sub, container, buttonIndexFn, classNamePredix){\n\t\tvar subDiv = L.DomUtil.create('div', 'leaflet-draw-subbuttom', container);\n\t\tvar button = this._createButton({\n\t\t\tcontainer:container,\n\t\t\ttitle:sub.text,\n\t\t\tclassName:classNamePredix + '-' + sub.type,\n\t\t\tcallback:function(){\n\t\t\t\tthis._showMenuToolbar(subDiv,button);\n\t\t\t},\n\t\t\tcontext:this\n\t\t})\n\t\tvar ul = L.DomUtil.create('ul', '', subDiv);\n\t\tfor (var i = 0; i < sub.menus.length; i++) {\n\t\t\tvar m = sub.menus[i],li = L.DomUtil.create('li', '', ul) ;\n\t\t\tif (m.enabled) {\n\t\t\t\tthis._initModeHandler(\n\t\t\t\t\tm.handler,\n\t\t\t\t\tli,\n\t\t\t\t\tbuttonIndexFn(),\n\t\t\t\t\tclassNamePredix,\n\t\t\t\t\tm.title\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\t_initModeHandler: function (handler, container, buttonIndex, classNamePredix, buttonTitle,hideMenu) {\n\t\tvar type = handler.type;\n\n\t\tthis._modes[type] = {};\n\n\t\tthis._modes[type].handler = handler;\n\n\t\tthis._modes[type].button = this._createButton({\n\t\t\ttype: type,\n\t\t\ttitle: buttonTitle,\n\t\t\tclassName: classNamePredix + '-' + type,\n\t\t\tcontainer: container,\n\t\t\tcallback: this._modes[type].handler.enable,\n\t\t\tcontext: this._modes[type].handler\n\t\t});\n\n\t\tthis._modes[type].buttonIndex = buttonIndex;\n\n\t\tif(hideMenu)\n\t\t\tthis._modes[type].handler.on('enabled',this._hideMenuToolbar,this);\n\n\t\tthis._modes[type].handler\n\t\t\t.on('enabled', this._handlerActivated, this)\n\t\t\t.on('disabled', this._handlerDeactivated, this);\n\t},\n\t_createButton: function (options) {\n\n\t\tvar link = L.DomUtil.create('a', options.className || '', options.container);\n\t\tlink.href = '#';\n\n\t\tif (options.text) {\n\t\t\tlink.innerHTML = options.text;\n\t\t}\n\n\t\tif (options.title) {\n\t\t\tlink.title = options.title;\n\t\t}\n\n\t\tL.DomEvent\n\t\t\t.on(link, 'click', L.DomEvent.stopPropagation)\n\t\t\t.on(link, 'mousedown', L.DomEvent.stopPropagation)\n\t\t\t.on(link, 'dblclick', L.DomEvent.stopPropagation)\n\t\t\t.on(link, 'click', L.DomEvent.preventDefault)\n\t\t\t.on(link, 'click', options.callback, options.context);\n\n\t\treturn link;\n\t},\n\n\t_disposeButton: function (button, callback) {\n\t\tL.DomEvent\n\t\t\t.off(button, 'click', L.DomEvent.stopPropagation)\n\t\t\t.off(button, 'mousedown', L.DomEvent.stopPropagation)\n\t\t\t.off(button, 'dblclick', L.DomEvent.stopPropagation)\n\t\t\t.off(button, 'click', L.DomEvent.preventDefault)\n\t\t\t.off(button, 'click', callback);\n\t},\n\n\t_handlerActivated: function (e) {\n\t\t// Disable active mode (if present)\n\t\tthis.disable();\n\n\t\t// Cache new active feature\n\t\tthis._activeMode = this._modes[e.handler];\n\n\t\tL.DomUtil.addClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\n\n\t\tthis._showActionsToolbar();\n\n\t\tthis.fire('enable');\n\t},\n\n\t_handlerDeactivated: function () {\n\t\tthis._hideActionsToolbar();\n\n\t\tL.DomUtil.removeClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\n\n\t\tthis._activeMode = null;\n\n\t\tthis.fire('disable');\n\t},\n\n\t_createActions: function (handler) {\n\t\tvar container = this._actionsContainer,\n\t\t\tbuttons = this.getActions(handler),\n\t\t\tl = buttons.length,\n\t\t\tli, di, dl, button;\n\n\t\t// Dispose the actions toolbar (todo: dispose only not used buttons)\n\t\tfor (di = 0, dl = this._actionButtons.length; di < dl; di++) {\n\t\t\tthis._disposeButton(this._actionButtons[di].button, this._actionButtons[di].callback);\n\t\t}\n\t\tthis._actionButtons = [];\n\n\t\t// Remove all old buttons\n\t\twhile (container.firstChild) {\n\t\t\tcontainer.removeChild(container.firstChild);\n\t\t}\n\n\t\tfor (var i = 0; i < l; i++) {\n\t\t\tif ('enabled' in buttons[i] && !buttons[i].enabled) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tli = L.DomUtil.create('li', '', container);\n\n\t\t\tbutton = this._createButton({\n\t\t\t\ttitle: buttons[i].title,\n\t\t\t\ttext: buttons[i].text,\n\t\t\t\tcontainer: li,\n\t\t\t\tcallback: buttons[i].callback,\n\t\t\t\tcontext: buttons[i].context\n\t\t\t});\n\n\t\t\tthis._actionButtons.push({\n\t\t\t\tbutton: button,\n\t\t\t\tcallback: buttons[i].callback\n\t\t\t});\n\t\t}\n\t},\n\t_showMenuToolbar: function (menuDiv,button) {\n\t\tif(this._menuToolbar){\n\t\t\tthis._hideMenuToolbar();\n\t\t}\n\t\telse {\n\t\t\tthis.disable();\n\t\t\tthis._menuToolbar = menuDiv;\n\t\t\tthis._menuButton = button;\n\t\t\tmenuDiv.style.display = 'block';\n\t\t\tmenuDiv.style.top = (button.offsetTop - 1) + 'px';\n\t\t}\n\t},\n\t_hideMenuToolbar:function(){\n\t\tif(this._menuToolbar){\n\t\t\tthis._menuToolbar.style.display = 'none';\n\t\t\tthis._menuToolbar = null;\n\t\t\tthis._menuButton = null;\n\t\t}\n\t},\n\t_showActionsToolbar: function () {\n\n\t\tvar buttonIndex = this._activeMode.buttonIndex,\n\t\t\tlastButtonIndex = this._lastButtonIndex,\n\t\t\ttoolbarPosition = this._activeMode.button.offsetTop - 1;\n\t\tif(this._menuToolbar) {\n\t\t\tthis._menuToolbar.style.display = 'none';\n\t\t}\n\t\tif(this._menuButton) {\n\t\t\ttoolbarPosition = this._menuButton.offsetTop - 1;\n\t\t}\n\t\tthis._hideMenuToolbar();\n\t\t// Recreate action buttons on every click\n\t\tthis._createActions(this._activeMode.handler);\n\n\t\t// Correctly position the cancel button\n\t\tthis._actionsContainer.style.top = toolbarPosition + 'px';\n\n\t\tif (buttonIndex === 0) {\n\t\t\tL.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\n\t\t\tL.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-top');\n\t\t}\n\n\t\tif (buttonIndex === lastButtonIndex) {\n\t\t\tL.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\n\t\t\tL.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\n\t\t}\n\n\t\tthis._actionsContainer.style.display = 'block';\n\t},\n\n\t_hideActionsToolbar: function () {\n\t\tthis._actionsContainer.style.display = 'none';\n\n\t\tL.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\n\t\tL.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\n\t\tL.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-top');\n\t\tL.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\n\t}\n});\n\n\nL.Tooltip = L.Class.extend({\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\tthis._popupPane = map._panes.popupPane;\n\n\t\tthis._container = map.options.drawControlTooltips ? L.DomUtil.create('div', 'leaflet-draw-tooltip', this._popupPane) : null;\n\t\tthis._singleLineLabel = false;\n\n\t\tthis._map.on('mouseout', this._onMouseOut, this);\n\t},\n\n\tdispose: function () {\n\t\tthis._map.off('mouseout', this._onMouseOut, this);\n\n\t\tif (this._container) {\n\t\t\tthis._popupPane.removeChild(this._container);\n\t\t\tthis._container = null;\n\t\t}\n\t},\n\n\tupdateContent: function (labelText) {\n\t\tif (!this._container) {\n\t\t\treturn this;\n\t\t}\n\t\tlabelText.subtext = labelText.subtext || '';\n\n\t\t// update the vertical position (only if changed)\n\t\tif (labelText.subtext.length === 0 && !this._singleLineLabel) {\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-draw-tooltip-single');\n\t\t\tthis._singleLineLabel = true;\n\t\t}\n\t\telse if (labelText.subtext.length > 0 && this._singleLineLabel) {\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-draw-tooltip-single');\n\t\t\tthis._singleLineLabel = false;\n\t\t}\n\n\t\tthis._container.innerHTML =\n\t\t\t(labelText.subtext.length > 0 ? '<span class=\"leaflet-draw-tooltip-subtext\">' + labelText.subtext + '</span>' + '<br />' : '') +\n\t\t\t'<span>' + labelText.text + '</span>';\n\n\t\treturn this;\n\t},\n\n\tupdatePosition: function (latlng) {\n\t\tvar pos = this._map.latLngToLayerPoint(latlng),\n\t\t\ttooltipContainer = this._container;\n\n\t\tif (this._container) {\n\t\t\ttooltipContainer.style.visibility = 'inherit';\n\t\t\tL.DomUtil.setPosition(tooltipContainer, pos);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\tshowAsError: function () {\n\t\tif (this._container) {\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-error-draw-tooltip');\n\t\t}\n\t\treturn this;\n\t},\n\n\tremoveError: function () {\n\t\tif (this._container) {\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-error-draw-tooltip');\n\t\t}\n\t\treturn this;\n\t},\n\n\t_onMouseOut: function () {\n\t\tif (this._container) {\n\t\t\tthis._container.style.visibility = 'hidden';\n\t\t}\n\t}\n});\n\n\nL.DrawToolbar = L.Toolbar.extend({\n\n\tstatics: {\n\t\tTYPE: 'draw'\n\t},\n\n\toptions: {\n\t\tpolyline: {},\n\t\tpolygon: {},\n\t\trectangle: {},\n\t\tcircle: {},\n\t\tmarker: {},\n\t\tnumber:{},\n\t\tline:{},\n\t\tarrow:{},\n\t\tlineGroup:{},\n\t\tstamp:{}\n\t},\n\n\tinitialize: function (options) {\n\t\t// Ensure that the options are merged correctly since L.extend is only shallow\n\t\tfor (var type in this.options) {\n\t\t\tif (this.options.hasOwnProperty(type)) {\n\t\t\t\tif (options[type]) {\n\t\t\t\t\toptions[type] = L.extend({}, this.options[type], options[type]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._toolbarClass = 'leaflet-draw-draw';\n\t\tL.Toolbar.prototype.initialize.call(this, options);\n\t},\n\n\tgetModeHandlers: function (map) {\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tenabled: this.options.rectangle,\n\t\t\t\thandler: new L.Draw.AreaGroup(map, this.options.rectangle),\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.rectangle\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.rectangle,\n\t\t\t\thandler: new L.Draw.Rectangle(map, this.options.rectangle),\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.rectangle\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.stamp,\n\t\t\t\thandler: new L.Draw.Stamp(map, this.options.stamp),\n\t\t\t\ttitle: 'L.drawLocal.draw.toolbar.buttons.stamp'\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled:true,\n\t\t\t\ttext:'形状',\n\t\t\t\ttype:'sharp',\n\t\t\t\tmenus:[{\n\t\t\t\t\tenabled: this.options.polyline,\n\t\t\t\t\thandler: new L.Draw.Polyline(map, this.options.polyline),\n\t\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.polyline\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tenabled: this.options.polygon,\n\t\t\t\t\thandler: new L.Draw.Polygon(map, this.options.polygon),\n\t\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.polygon\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tenabled: this.options.circle,\n\t\t\t\t\thandler: new L.Draw.Circle(map, this.options.circle),\n\t\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.circle\n\t\t\t\t}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.marker,\n\t\t\t\thandler: new L.Draw.Marker(map, this.options.marker),\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.marker\n\t\t\t},{\n\t\t\t\tenabled: this.options.number,\n\t\t\t\thandler: new L.Draw.NumberMarker(map,this.options.number),\n\t\t\t\ttitle:'添加测量'\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.line,\n\t\t\t\thandler: new L.Draw.Line(map,this.options.line),\n\t\t\t\ttitle:'画线'\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.arrow,\n\t\t\t\thandler: new L.Draw.Arrow(map,this.options.arrow),\n\t\t\t\ttitle:'箭头'\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: this.options.lineGroup,\n\t\t\t\thandler: new L.Draw.LineGroup(map,this.options.lineGroup),\n\t\t\t\ttitle:'测试组'\n\t\t\t}\n\t\t];\n\t},\n\n\t// Get the actions part of the toolbar\n\tgetActions: function (handler) {\n\t\treturn [\n\t\t\t{\n\t\t\t\tenabled: handler.completeShape,\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.finish.title,\n\t\t\t\ttext: L.drawLocal.draw.toolbar.finish.text,\n\t\t\t\tcallback: handler.completeShape,\n\t\t\t\tcontext: handler\n\t\t\t},\n\t\t\t{\n\t\t\t\tenabled: handler.deleteLastVertex,\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.undo.title,\n\t\t\t\ttext: L.drawLocal.draw.toolbar.undo.text,\n\t\t\t\tcallback: handler.deleteLastVertex,\n\t\t\t\tcontext: handler\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.actions.title,\n\t\t\t\ttext: L.drawLocal.draw.toolbar.actions.text,\n\t\t\t\tcallback: this.disable,\n\t\t\t\tcontext: this\n\t\t\t}\n\t\t];\n\t},\n\n\tsetOptions: function (options) {\n\t\tL.setOptions(this, options);\n\n\t\tfor (var type in this._modes) {\n\t\t\tif (this._modes.hasOwnProperty(type) && options.hasOwnProperty(type)) {\n\t\t\t\tthis._modes[type].handler.setOptions(options[type]);\n\t\t\t}\n\t\t}\n\t}\n});\n\nL.Control.Draw = L.Control.extend({\n\n\t\toptions: {\n\t\t\tposition: 'topright',\n\t\t\tdraw: false,\n\t\t\tgroup:{},\n\t\t\tedit: true,\n\t\t\tfeatureGroup:null\n\t\t},\n\n\t\tinitialize: function (options) {\n\n\t\t\tL.Control.prototype.initialize.call(this, options);\n\t\t\tthis._toolbars = {};\n\n\t\t\t// Initialize toolbars\n\t\t\tif (L.DrawToolbar && this.options.draw) {\n\t\t\t\tthis._toolbars[L.DrawToolbar.TYPE] = new L.DrawToolbar(this.options.draw);\n\t\t\t\tthis._toolbars[L.DrawToolbar.TYPE].on('enable', this._toolbarEnabled, this);\n\t\t\t}\n\t\t\tif (L.DrawToolbar && this.options.group) {\n\t\t\t\tthis._toolbars['lineGroup'] = new L.SXT.GroupToolbar(this.options.group);\n\t\t\t\tthis._toolbars['lineGroup'].on('enable', this._toolbarEnabled, this);\n\t\t\t}\n\n\t\t\t//L.toolbar = this; //set global var for editing the toolbar\n\t\t},\n\n\t\tonAdd: function (map) {\n\t\t\tthis._map = map;\n\t\t\tvar container = L.DomUtil.create('div', 'leaflet-draw'),\n\t\t\t\taddedTopClass = false,\n\t\t\t\ttopClassName = 'leaflet-draw-toolbar-top',\n\t\t\t\ttoolbarContainer;\n\n\t\t\tfor (var toolbarId in this._toolbars) {\n\t\t\t\tif (this._toolbars.hasOwnProperty(toolbarId)) {\n\t\t\t\t\ttoolbarContainer = this._toolbars[toolbarId].addToolbar(map);\n\n\t\t\t\t\tif (toolbarContainer) {\n\t\t\t\t\t\t// Add class to the first toolbar to remove the margin\n\t\t\t\t\t\tif (!addedTopClass) {\n\t\t\t\t\t\t\tif (!L.DomUtil.hasClass(toolbarContainer, topClassName)) {\n\t\t\t\t\t\t\t\tL.DomUtil.addClass(toolbarContainer.childNodes[0], topClassName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddedTopClass = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.appendChild(toolbarContainer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(this.options.edit){\n\t\t\t\tthis.fg = this.options.featureGroup || new L.SvFeatureGroup();\n\t\t\t\tmap.addLayer(this.fg);\n\t\t\t\tmap.on('draw:created',this.onLayerCreated,this);\n\t\t\t}\n\t\t\treturn container;\n\t\t},\n\n\t\tonLayerCreated:function(e){\n\t\t\tthis.fg.addLayer(e.layer);\n\t\t},\n\n\t\tonRemove: function () {\n\t\t\tfor (var toolbarId in this._toolbars) {\n\t\t\t\tif (this._toolbars.hasOwnProperty(toolbarId)) {\n\t\t\t\t\tthis._toolbars[toolbarId].removeToolbar();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tsetDrawingOptions: function (options) {\n\t\t\tfor (var toolbarId in this._toolbars) {\n\t\t\t\tif (this._toolbars[toolbarId] instanceof L.DrawToolbar) {\n\t\t\t\t\tthis._toolbars[toolbarId].setOptions(options);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_toolbarEnabled: function (e) {\n\t\t\tvar enabledToolbar = e.target;\n\n\t\t\tfor (var toolbarId in this._toolbars) {\n\t\t\t\tif (this._toolbars[toolbarId] !== enabledToolbar) {\n\t\t\t\t\tthis._toolbars[toolbarId].disable();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\nL.Map.mergeOptions({\n\t\tdrawControlTooltips: true,\n\t\tdrawControl: false\n\t});\n\n}(window, document));\n(function (window, document, undefined) {\r\n\r\n\t//重新定位pop位置\r\n\tL.Path.include({\r\n\t\tgetValue:function(){\r\n\t\t\treturn this._value;\r\n\t\t},\r\n\t\tsetValue:function(value){\r\n\t\t\tthis._value = value;\r\n\t\t},\r\n\t\tupdateValue:function(value){\r\n\t\t\tthis._value = L.extend(this._value||{},value);\r\n\t\t\tthis.redraw();\r\n\t\t\tthis._updateStyle && this._updateStyle();\r\n\t\t},\r\n\t\t_boundsToLatLngs:function(bounds) {\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\t\t\treturn [ bounds.getSouthWest(), bounds.getNorthWest(), bounds.getNorthEast(), bounds.getSouthEast() ];\r\n\t\t},\r\n\t\tbindPopup:function(content, lagLng) {\r\n\t\t\tif(!this._popup || lagLng)\r\n\t\t\t\tthis._popup = new L.Popup(lagLng, this);\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t\tif(!this._popupHandlersAdded)\r\n\t\t\t{\r\n\t\t\t\tthis.on(\"remove\", this.closePopup, this);\r\n\t\t\t\tthis._popupHandlersAdded = true;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tgetBounds:function() {\r\n\t\t\treturn this._bounds;\r\n\t\t}\r\n\t\t/*_initEvents: function () {\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu', 'touchstart', 'touchend', 'touchmove'];\r\n\r\n\t\t\t\tevents.concat(['touchcancel']);\r\n\r\n\t\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent_Touch, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fireMouseEvent_Touch:function(e){\r\n\t\t\tif(e.changedTouches){\r\n\t\t\t\te.clientX = e.changedTouches[0].clientX;\r\n\t\t\t\te.clientY = e.changedTouches[0].clientY;\r\n\t\t\t}\r\n\t\t\tthis._fireMouseEvent(e);\r\n\t\t}*/\r\n/*\t\t_openPopup: function (e) {\r\n\t\t\tvar bs = this.getBounds();\r\n\t\t\tthis._popup.setLatLng(new L.LatLng(bs._northEast.lat, bs._southWest.lng+(bs._northEast.lng-bs._southWest.lng)/2));\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}*/\r\n\t});\r\n\tL.Marker.include({\r\n\t\tgetValue:function(){\r\n\t\t\treturn this._value;\r\n\t\t},\r\n\t\tsetValue:function(value){\r\n\t\t\tthis._value = value;\r\n\t\t},\r\n\t\tgetBounds:function() {\r\n\t\t\treturn this._bounds;\r\n\t\t},\r\n\t\t_boundsToLatLngs:function(bounds) {\r\n\t\t\tbounds = L.latLngBounds(bounds);\r\n\t\t\treturn [ bounds.getSouthWest(), bounds.getNorthWest(), bounds.getNorthEast(), bounds.getSouthEast() ];\r\n\t\t},\r\n\t\tbindPopup:function(content, options) {\r\n\t\t\tvar point = L.point(this.options.icon.options.popupAnchor || [ 0, 0 ]);\r\n\t\t\tpoint = point.add(L.Popup.prototype.options.offset);\r\n\t\t\tif(options && options.offset)\r\n\t\t\t\tpoint = point.add(options.offset);\r\n\t\t\toptions = L.extend({\r\n\t\t\t\toffset:point\r\n\t\t\t}, options);\r\n\t\t\tif(!this._popupHandlersAdded){\r\n\t\t\t\tthis.on(\"remove\", this.closePopup, this)\r\n\t\t\t\t\t.on(\"move\", this._movePopup, this);\r\n\t\t\t\tthis._popupHandlersAdded = true;\r\n\t\t\t}\r\n\t\t\tif(content instanceof L.Popup) {\r\n\t\t\t\tL.setOptions(content, options);\r\n\t\t\t\tthis._popup = content;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._popup = new L.Popup(options, this).setContent(content);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Draggable.include({\r\n\t\tinitialize: function (element, dragStartTarget) {\r\n\t\t\tthis._element = element;\r\n\t\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t\t\tthis._initInteraction();\r\n\t\t},\r\n\t\t_fireMouseEvent: function (e) {\r\n\t\t\tvar self = this;\r\n\t\t\tif(e.type == 'touchmove' || e.type=='touchend') {\r\n\t\t\t\tif(self._touchEnd_timer)\r\n\t\t\t\t\tclearTimeout(self._touchEnd_timer);\r\n\t\t\t\tif(e.type == 'touchmove') {\r\n\t\t\t\t\tself._touchEnd_timer = setTimeout(function () {\r\n\t\t\t\t\t\tconsole.log('fire touchend');\r\n\t\t\t\t\t\tself.fire('touchend', {originalEvent: e});\r\n\t\t\t\t\t}, 200);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tself.fire(e.type, {originalEvent:e});\r\n\t\t},\r\n\t\t_initInteraction: function () {\r\n\r\n\t\t\tvar element = this._element,\r\n\t\t\t\tevents = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu', 'touchstart', 'touchend', 'touchmove'];\r\n\t\t\tif (this._detectIE()) {\r\n\t\t\t\tevents.concat(['MSPointerDown', 'MSPointerUp', 'MSPointerMove', 'MSPointerCancel']);\r\n\t\t\t} else {\r\n\t\t\t\tevents.concat(['touchcancel']);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(element, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_detectIE: function () {\r\n\t\t\tvar ua = window.navigator.userAgent;\r\n\r\n\t\t\tvar msie = ua.indexOf('MSIE ');\r\n\t\t\tif (msie > 0) {\r\n\t\t\t\t// IE 10 or older => return version number\r\n\t\t\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n\t\t\t}\r\n\r\n\t\t\tvar trident = ua.indexOf('Trident/');\r\n\t\t\tif (trident > 0) {\r\n\t\t\t\t// IE 11 => return version number\r\n\t\t\t\tvar rv = ua.indexOf('rv:');\r\n\t\t\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n\t\t\t}\r\n\r\n\t\t\tvar edge = ua.indexOf('Edge/');\r\n\t\t\tif (edge > 0) {\r\n\t\t\t\t// IE 12 => return version number\r\n\t\t\t\treturn parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n\t\t\t}\r\n\r\n\t\t\t// other browser\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Handler.MarkerDrag.include({\r\n\r\n\t\taddHooks: function () {\r\n\t\t\tvar icon = this._marker._icon;\r\n\t\t\tif (!this._draggable) {\r\n\t\t\t\tthis._draggable = new L.Draggable(icon, icon);\r\n\t\t\t}\r\n\r\n\t\t\tthis._draggable\r\n\t\t\t\t.on('dragstart', this._onDragStart, this)\r\n\t\t\t\t.on('drag', this._onDrag, this)\r\n\t\t\t\t.on('dragend', this._onDragEnd, this)\r\n\t\t\t\t.on('touchstart', this._onTouchStart, this)\r\n\t\t\t\t.on('touchstart', this._onTouchStart, this)\r\n\t\t\t\t.on('touchmove', this._onTouchMove, this)\r\n\t\t\t\t.on('MSPointerMove', this._onTouchMove, this)\r\n\t\t\t\t.on('touchend', this._onTouchEnd, this)\r\n\t\t\t\t.on('touchcancel', this._onTouchEnd, this)\r\n\t\t\t\t.on('MSPointerUp', this._onTouchEnd, this);\r\n\t\t\tthis._draggable.enable();\r\n\t\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t\t},\r\n\r\n\t\tremoveHooks: function () {\r\n\t\t\tthis._draggable\r\n\t\t\t\t.off('dragstart', this._onDragStart, this)\r\n\t\t\t\t.off('drag', this._onDrag, this)\r\n\t\t\t\t.off('dragend', this._onDragEnd, this)\r\n\t\t\t\t.off('touchstart', this._onTouchStart, this)\r\n\t\t\t\t.off('touchmove', this._onTouchMove, this)\r\n\t\t\t\t.off('MSPointerMove', this._onTouchMove, this)\r\n\t\t\t\t.off('touchend', this._onTouchEnd, this)\r\n\t\t\t\t.off('MSPointerUp', this._onTouchEnd, this);\r\n\r\n\t\t\tthis._draggable.disable();\r\n\t\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t\t},\r\n\r\n\t\t_onTouchStart: function (e) {\r\n\t\t\tthis.isOnTouchStart = true;\r\n\t\t\tthis._onDragStart(e);\r\n\t\t\t//e.originalEvent.preventDefault();\r\n\t\t},\r\n\r\n\t\t_onTouchMove: function (e) {\r\n\t\t\tif(!this.isOnTouchStart){\r\n\t\t\t\tthis._onTouchStart(e);\r\n\t\t\t}\r\n\t\t\tthis.isOnTouchStart = false;\r\n\t\t\tvar marker = this._marker,\r\n\t\t\t\tlayerPoint = marker._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),\r\n\t\t\t\tlatlng = marker._map.layerPointToLatLng(layerPoint);\r\n\t\t\tmarker.setLatLng(latlng);\r\n\t\t\t//e.originalEvent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_onTouchEnd: function (e) {\r\n\t\t\tthis._onDragEnd(e);\r\n\t\t}\r\n\t})\r\n\r\n\tL.Icon.Number = L.DivIcon.extend({\r\n\t\toptions: {\r\n\t\t\ticonSize: [20, 20],\r\n\t\t\ticonAnchor: [10, 10],\r\n\t\t\tclassName: 'leaflet-div-numberMarker'\r\n\t\t},\r\n\r\n\t\tcreateIcon: function (oldIcon) {\r\n\t\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\r\n\t\t\t\toptions = this.options;\r\n\r\n\t\t\tvar text = document.createElement('span');\r\n\t\t\tdiv.appendChild(text);\r\n\r\n\t\t\tvar tooltip = L.DomUtil.create('div', 'leaflet-div-numberMarker-tip');\r\n\t\t\ttooltip.style.display ='none';\r\n\t\t\tdiv.appendChild(tooltip);\r\n\r\n\r\n\t\t\tif (options.bgPos) {\r\n\t\t\t\tdiv.style.backgroundPosition =\r\n\t\t\t\t\t(-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tthis._setIconStyles(div, 'icon');\r\n\t\t\treturn div;\r\n\t\t}\r\n\t});\r\n\r\n\tL.NumberMarker = L.Marker.Touch.extend({\r\n\t\tinitialize: function (latlng, options) {\r\n\t\t\tL.Marker.prototype.initialize.call(this,latlng,options);\r\n\t\t\tthis.options.icon = new L.Icon.Number();\r\n\t\t},\r\n\t\tsetData:function(data){\r\n\t\t\tthis.data = data;\r\n\t\t\tthis._updateData();\r\n\t\t},\r\n\t\tupdate: function () {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\t\t\t\tthis._setPos(pos);\r\n\t\t\t\tthis._updateData();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_updateData:function(){\r\n\t\t\tif(this._icon && this.data){\r\n\t\t\t\tvar tooltip = this._icon.getElementsByTagName('div')[0];\r\n\t\t\t\tif(tooltip && this.data.tooltip)\r\n\t\t\t\t\ttooltip.innerHTML = this.data.tooltip;\r\n\t\t\t\tvar text = this._icon.getElementsByTagName('span')[0];\r\n\t\t\t\ttext && this.data.number && (text.innerHTML = this.data.number);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tL.Draw.NumberMarker = L.Draw.Marker.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'markerNumber'\r\n\t\t},\r\n\r\n\t\toptions: {\r\n\t\t\trepeatMode: false,\r\n\t\t\tzIndexOffset: 2000 // This should be > than the highest z-index any markers\r\n\t\t},\r\n\r\n\t\tinitialize: function (map, options) {\r\n\t\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\r\n\t\t\tL.Draw.Marker.prototype.initialize.call(this, map, options);\r\n\t\t\tthis.type = L.Draw.NumberMarker.TYPE;\r\n\t\t},\r\n\r\n\t\t_onMouseMove: function (e) {\r\n\t\t\tvar latlng = e.latlng;\r\n\r\n\t\t\tthis._tooltip.updatePosition(latlng);\r\n\t\t\tthis._mouseMarker.setLatLng(latlng);\r\n\r\n\t\t\tif (!this._marker) {\r\n\t\t\t\tthis._marker = new L.NumberMarker(latlng, {\r\n\t\t\t\t\tzIndexOffset: this.options.zIndexOffset\r\n\t\t\t\t});\r\n\t\t\t\t// Bind to both marker and map to make sure we get the click event.\r\n\t\t\t\tthis._marker.on('click', this._onClick, this);\r\n\t\t\t\tthis._map\r\n\t\t\t\t\t.on('click', this._onClick, this)\r\n\t\t\t\t\t.addLayer(this._marker);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlatlng = this._mouseMarker.getLatLng();\r\n\t\t\t\tthis._marker.setLatLng(latlng);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fireCreatedEvent: function () {\r\n\t\t\tvar marker = new L.NumberMarker(this._marker.getLatLng());\r\n\t\t\tL.Draw.Feature.prototype._fireCreatedEvent.call(this, marker);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Edit.NumberMarker = L.Edit.Marker.extend({\r\n\t\t_offsetMarker: function (icon, offset) {\r\n\r\n\t\t}\r\n\t})\r\n\r\n\tL.NumberMarker.addInitHook(function () {\r\n\t\tif (L.Edit.Marker) {\r\n\t\t\tthis.editing = new L.Edit.NumberMarker(this);\r\n\t\t\tif (this.options.editable) {\r\n\t\t\t\t//this.editing.enable();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n\tL.DragPath = L.Path.extend({\r\n\t\timpostorOptions:{\r\n\t\t\tstroke:\"#ff0000\",\r\n\t\t\t\"stroke-linejoin\":\"round\",\r\n\t\t\t\"stroke-linecap\":\"round\",\r\n\t\t\t\"stroke-opacity\":0,\r\n\t\t\t\"stroke-width\":2,\r\n\t\t\tfill:\"none\"\r\n\t\t},\r\n\t\t_initElements:function() {\r\n\t\t\tL.Path.prototype._initElements.call(this);\r\n\t\t\t//var path = this._dragImpostor = this._createElement(\"path\");\r\n\t\t\t//for (var attr in this.impostorOptions) path.setAttribute(attr, this.impostorOptions[attr]);\r\n\t\t\t//this._container.appendChild(path);\r\n\t\t},\r\n\t\t_updatePath:function() {\r\n\t\t\tL.Path.prototype._updatePath.call(this);\r\n\t\t\tvar d = this._path.getAttribute(\"d\");\r\n\t\t\t//this._dragImpostor.setAttribute(\"d\", d);\r\n\t\t},\r\n\t\t_initEvents:function() {\r\n\t\t\tL.Path.prototype._initEvents.call(this);\r\n\t\t\tif (this.options.clickable) {\r\n\t\t\t\t//this._dragImpostor.setAttribute(\"class\", \"leaflet-clickable\");\r\n\t\t\t\tL.DomEvent.on(this._container, \"click\", this._onMouseClick, this);\r\n\t\t\t\tvar events = [ \"dblclick\", \"mousedown\", \"mouseover\", \"mouseout\", \"mousemove\", \"contextmenu\" ];\r\n\t\t\t\tfor (var i = 0; i < events.length; i++)\r\n\t\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Line = L.DragPath.extend({\r\n\t\tinitialize:function(start, end, options) {\r\n\t\t\tL.Path.prototype.initialize.call(this, options);\r\n\t\t\tthis._start = start;\r\n\t\t\tthis._end = end;\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\tfillOpacity:1\r\n\t\t},\r\n\t\tprojectLatlngs:function() {\r\n\t\t\tthis._startPoint = this._map.latLngToLayerPoint(this._start);\r\n\t\t\tthis._endPoint = this._map.latLngToLayerPoint(this._end);\r\n\t\t},\r\n\t\tgetBounds:function() {\r\n\t\t\treturn new L.LatLngBounds(this._start, this._end);\r\n\t\t},\r\n\t\tsetEndpoints:function(start, end) {\r\n\t\t\tthis._start = start, this._end = end, this.redraw();\r\n\t\t},\r\n\t\tgetPathString:function() {\r\n\t\t\tif (!L.Browser.svg) return \"\";\r\n\t\t\tvar s = this._startPoint,\r\n\t\t\t\te = this._endPoint,\r\n\t\t\t\tstr = \"M\" + s.x + \",\" + s.y;\r\n\t\t\tstr += \"L\" + e.x + \",\" + e.y;\r\n\t\t\treturn str;\r\n\t\t},\r\n\t\ttoGeoJSON: function () {\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype:'Feature',\r\n\t\t\t\tproperties:this.getValue(),\r\n\t\t\t\toptions:this.options,\r\n\t\t\t\tgeometry: {\r\n\t\t\t\t\ttype: 'line',\r\n\t\t\t\t\tcoordinates: L.GeoJSON.latLngsToCoords([this._start, this._end])\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tL.Draw.Line = L.Draw.SimpleShape.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'pen'\r\n\t\t},\r\n\r\n\t\toptions:{\r\n\t\t\tshapeOptions: {\r\n\t\t\t\tstroke: true,\r\n\t\t\t\tcolor: '#f06eaa',\r\n\t\t\t\tweight: 2,\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tfill: false,\r\n\t\t\t\tclickable: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitialize:function(map, options) {\r\n\t\t\tthis.type = L.Draw.Line.TYPE;\r\n\t\t\tthis._initialLabelText = L.drawLocal.draw.handlers.line.tooltip.start;\r\n\t\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\r\n\t\t},\r\n\t\t_drawShape:function(e) {\r\n\t\t\tif(this._shape)\r\n\t\t\t\tthis._shape.setEndpoints(this._startLatLng, e)\r\n\t\t\telse {\r\n\t\t\t\t//this.options.color = PG.SelectedColor;\r\n\t\t\t\tthis._shape = new L.Line(this._startLatLng, e, this._makeShapeOptions());\r\n\t\t\t\tthis._map.addLayer(this._shape);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_fireCreatedEvent:function() {\r\n\t\t\tvar e = new L.Line(this._startLatLng, this._shape._end, this._makeShapeOptions());\r\n\t\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, e);\r\n\t\t},\r\n\t\t_makeShapeOptions:function(){\r\n\t\t\treturn this.options.shapeOptions;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Edit.Line = L.Edit.Rectangle.extend({\r\n\t\t_onMarkerDragStart:function(e) {\r\n\t\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\r\n\t\t\tvar t = this._getCorners(),\r\n\t\t\t\ttarget = e.target,\r\n\t\t\t\tcornerIndex = target._cornerIndex;\r\n\t\t\tthis._oppositeCorner = t[(cornerIndex + 1) % 2];\r\n\t\t\tthis._toggleCornerMarkers(0, cornerIndex);\r\n\t\t\t//$(this._map._container).addClass(\"leaflet-drawing\");\r\n\t\t},\r\n\t\t_onTouchStart: function (e) {\r\n\t\t\t//L.Edit.Rectangle.prototype._onMarkerDragStart.call(this, e);\r\n\r\n\t\t\tif (typeof(this._getCorners) === 'function') {\r\n\t\t\t\t// Save a reference to the opposite point\r\n\t\t\t\tvar corners = this._getCorners(),\r\n\t\t\t\t\tmarker = e.target,\r\n\t\t\t\t\tcornerIndex = marker._cornerIndex;\r\n\t\t\t\tmarker.setOpacity(0);\r\n\t\t\t\tthis._oppositeCorner = corners[(cornerIndex + 1) % 2];\r\n\t\t\t\tthis._toggleCornerMarkers(0, cornerIndex);\r\n\t\t\t}\r\n\r\n\t\t\tthis._shape.fire('editstart');\r\n\t\t},\r\n\t\t_onMarkerDragEnd:function(e) {\r\n\t\t\tL.Edit.Rectangle.prototype._onMarkerDragEnd.call(this, e);\r\n\t\t\t//$(this._map._container).removeClass(\"leaflet-drawing\");\r\n\t\t},\r\n\t\t_getCenter:function() {\r\n\t\t\tvar e = this._shape._start,\r\n\t\t\t\tt = this._shape._end,\r\n\t\t\t\ti = -(e.lat - t.lat) / 2,\r\n\t\t\t\ts = -(e.lng - t.lng) / 2;\r\n\t\t\treturn new L.LatLng(e.lat + i, e.lng + s);\r\n\t\t},\r\n\t\t_move:function(e) {\r\n\t\t\tvar start = this._shape._start,\r\n\t\t\t\tend = this._shape._end,\r\n\t\t\t\tcenter = this._getCenter(),\r\n\t\t\t\tql = [ e.lat - center.lat, e.lng - center.lng ],\r\n\t\t\t\tnewStart = new L.LatLng(start.lat + ql[0], start.lng + ql[1]),\r\n\t\t\t\tnewEnd = new L.LatLng(end.lat + ql[0], end.lng + ql[1]);\r\n\t\t\tthis._shape.setEndpoints(newStart, newEnd);\r\n\t\t\tthis._repositionCornerMarkers();\r\n\t\t\tthis._toggleCornerMarkers(true);\r\n\t\t\t//this._openPopover();\r\n\t\t},\r\n\t\t_resize:function(point) {\r\n/*\t\t\tvar t = this._getCorners(),\r\n\t\t\t\ttarget = e.target,\r\n\t\t\t\tcornerIndex = target._cornerIndex;\r\n\t\t\tthis._oppositeCorner = t[(cornerIndex + 1) % 2];*/\r\n\t\t\tthis._oppositeCorner == this._shape._start ?\r\n\t\t\t\tthis._shape.setEndpoints(this._shape._start, point) :\r\n\t\t\t\tthis._shape.setEndpoints(point, this._shape._end);\r\n\t\t\tvar bounds = this._shape.getBounds();\r\n\t\t\tthis._moveMarker.setLatLng(bounds.getCenter());\r\n\t\t},\r\n\t\t_getCorners:function() {\r\n\t\t\treturn [ this._shape._start, this._shape._end ];\r\n\t\t},\r\n\t\t_createPopover:function() {\r\n\t\t\tL.Edit.SimpleShape.prototype._createPopover.call(this);\r\n\t\t\tvar start = this._shape._start,\r\n\t\t\t\tend = this._shape._end,\r\n\t\t\t\tpos = start.lat < end.lat ?  start : end;\r\n\t\t\tthis._shape.openPopup(pos);\r\n\t\t}\r\n\t});\r\n\tL.Line.addInitHook(function () {\r\n\t\tthis.editing = new L.Edit.Line(this);\r\n\t\t//this.options.editable && this.editing.enable();\r\n\t});\r\n\r\n\tL.Arrow = L.Line.extend({\r\n\t\tinitialize:function(start, end, options) {\r\n\t\t\tL.Line.prototype.initialize.call(this, start, end, options);\r\n\t\t\tthis.arrowBounds = new L.LatLngBounds(new L.LatLng(.0055, .0055), new L.LatLng(0, 0));\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\tfillOpacity:1\r\n\t\t},\r\n\t\tfillable:function() {\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tprojectLatlngs:function() {\r\n\t\t\tL.Line.prototype.projectLatlngs.call(this);\r\n\t\t\tvar e = this._map.latLngToLayerPoint(this.arrowBounds.getSouthWest()),\r\n\t\t\t\tt = this._map.latLngToLayerPoint(this.arrowBounds.getNorthEast());\r\n\t\t\tthis._arrHeadWidth = Math.abs(e.x - t.x);\r\n\t\t\tthis._arrHeadLen = Math.abs(e.y - t.y);\r\n\t\t},\r\n\t\tgetPathString:function() {\r\n\t\t\tif (!L.Browser.svg) return \"\";\r\n\t\t\tvar start = this._startPoint,\r\n\t\t\t\tend = this._endPoint,\r\n\t\t\t\theadLen = this._arrHeadLen,\r\n\t\t\t\theadWidth = this._arrHeadWidth,\r\n\t\t\t\tn = Math.atan2(start.y - end.y, start.x - end.x),\r\n\t\t\t\ta = Math.cos(n),\r\n\t\t\t\tr = Math.sin(n),\r\n\t\t\t\tstr = L.Line.prototype.getPathString.call(this);\r\n\t\t\t    str += \"M\" + (end.x + (headLen * a - headWidth / 2 * r)) + \",\" + (end.y + (headLen * r + headWidth / 2 * a));\r\n\t\t\t    str += \"L\" + end.x + \",\" + end.y;\r\n\t\t\t\tstr += \"M\" + (end.x + (headLen * a + headWidth / 2 * r)) + \",\" + (end.y - (headWidth / 2 * a - headLen * r));\r\n\t\t\t    str += \"L\" + end.x + \",\" + end.y;\r\n\t\t\treturn str;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Draw.Arrow = L.Draw.SimpleShape.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'arrow'\r\n\t\t},\r\n\r\n\t\toptions:{\r\n\t\t\tshapeOptions: {\r\n\t\t\t\tstroke: true,\r\n\t\t\t\tcolor: '#f06eaa',\r\n\t\t\t\tweight: 2,\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tfill: false,\r\n\t\t\t\tclickable: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitialize:function(map, options) {\r\n\t\t\tthis.type = L.Draw.Arrow.TYPE;\r\n\t\t\tthis._initialLabelText = L.drawLocal.draw.handlers.line.tooltip.start;;\r\n\t\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\r\n\t\t},\r\n\t\t_drawShape:function(latlng) {\r\n\t\t\tif(this._shape){\r\n\t\t\t\tthis._shape.setEndpoints(this._startLatLng, latlng) ;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis._shape = new L.Arrow(this._startLatLng, latlng, this._makeShapeOptions());\r\n\t\t\t\tthis._map.addLayer(this._shape);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fireCreatedEvent:function() {\r\n\t\t\tvar e = new L.Arrow(this._startLatLng, this._shape._end, this._makeShapeOptions());\r\n\t\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, e);\r\n\t\t},\r\n\t\t_makeShapeOptions:function(){\r\n\t\t\treturn this.options.shapeOptions;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Edit.Arrow = L.Edit.Line.extend({\r\n\r\n\t});\r\n\r\n\tL.Arrow.addInitHook(function () {\r\n\t\tthis.editing = new L.Edit.Arrow(this);\r\n\t\t//if(this.options.editable)\r\n\t\t//\tthis.editing.enable();\r\n\t});\r\n\r\n\tL.LineGroup = L.Line.extend({\r\n\t\tinitialize:function(start, end, options) {\r\n\t\t\tL.Line.prototype.initialize.call(this, start, end, options);\r\n\t\t\t//this.fg = new L.FeatureGroup();\r\n\t\t\t//this.arrowBounds = new L.LatLngBounds(new L.LatLng(.0055, .0055), new L.LatLng(0, 0));\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\tfillOpacity:1\r\n\t\t},\r\n\t\tfillable:function() {\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tprojectLatlngs:function() {\r\n\t\t\tL.Line.prototype.projectLatlngs.call(this);\r\n/*\t\t\tvar sw = this._map.latLngToLayerPoint(this.arrowBounds.getSouthWest()),\r\n\t\t\t\tne = this._map.latLngToLayerPoint(this.arrowBounds.getNorthEast());\r\n\t\t\tthis._arrHeadWidth = Math.abs(sw.x - ne.x);\r\n\t\t\tthis._arrHeadLen = Math.abs(sw.y - ne.y);*/\r\n\t\t},\r\n\t\tgetPathString:function() {\r\n\t\t\tif (!L.Browser.svg) return \"\";\r\n\t\t\tvar start = this._startPoint,\r\n\t\t\t\tend = this._endPoint,\r\n\t\t\t\tlineAbs = 10,//与未端距离\r\n\t\t\t\tlineLen = 10,//长度\r\n\t\t\t\tn = Math.atan2(start.y - end.y, start.x - end.x),\r\n\t\t\t\ta = Math.cos(n),\r\n\t\t\t\tr = Math.sin(n),\r\n\t\t\t\tstr = L.Line.prototype.getPathString.call(this);\r\n\r\n\t\t\tstr += \"M\" + (start.x - (lineAbs * a - lineLen / 2 * r)) + \",\" + (start.y - (lineAbs * r + lineLen / 2 * a));\r\n\t\t\tstr += \"L\" + (start.x - (lineAbs * a + lineLen / 2 * r)) + \",\" + (start.y + (lineLen / 2 * a - lineAbs * r));\r\n\r\n\t\t\tstr += \"M\" + (end.x + (lineAbs * a - lineLen / 2 * r)) + \",\" + (end.y + (lineAbs * r + lineLen / 2 * a));\r\n\t\t\tstr += \"L\" + (end.x + (lineAbs * a + lineLen / 2 * r)) + \",\" + (end.y - (lineLen / 2 * a - lineAbs * r));\r\n\r\n\t\t\treturn str;\r\n\t\t},\r\n\t\tonAdd:function(map) {\r\n\t\t\tL.Line.prototype.onAdd.call(this, map);\r\n/*\t\t\tthis.fg = new L.FeatureGroup();\r\n\t\t\tthis.fg.addTo(map);\r\n\t\t\tvar start = this._startPoint,\r\n\t\t\t\tend = this._endPoint,\r\n\t\t\t\tlineAbs = 10,//与未端距离\r\n\t\t\t\tlineLen = 30,//长度\r\n\t\t\t\tn = Math.atan2(start.y - end.y, start.x - end.x),\r\n\t\t\t\ta = Math.cos(n),\r\n\t\t\t\tr = Math.sin(n);*/\r\n/*\t\t\tvar p1 = map.layerPointToLatLng(L.point(start.x - (lineAbs * a + lineLen / 2 * r),start.y + (lineLen / 2 * a - lineAbs * r)));\r\n\t\t\tvar p2 = map.layerPointToLatLng(L.point(end.x + (lineAbs * a - lineLen / 2 * r),end.y + (lineAbs * r + lineLen / 2 * a)));\r\n\t\t\tvar marker = new L.NumberMarker(p1, { icon: new L.Icon.Number() });\r\n\t\t\tvar marker2 = new L.NumberMarker(p2, { icon: new L.Icon.Number() });\r\n\t\t\tthis.fg.addLayer(marker);\r\n\t\t\tthis.fg.addLayer(marker2);*/\r\n\t\t},\r\n\t\tonRemove:function(map){\r\n\t\t\tL.Line.prototype.onRemove.call(this,map);\r\n/*\t\t\tmap.removeLayer(this.fg);*/\r\n\t\t},\r\n\t\ttoGeoJSON: function () {\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: 'Feature',\r\n\t\t\t\tproperties: this.getValue(),\r\n\t\t\t\toptions: this.options,\r\n\t\t\t\tgeometry: {\r\n\t\t\t\t\ttype: 'LineGroup',\r\n\t\t\t\t\tcoordinates: L.GeoJSON.latLngsToCoords([this._start, this._end])\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tL.Draw.LineGroup = L.Draw.SimpleShape.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'lineGroup'\r\n\t\t},\r\n\r\n\t\toptions:{\r\n\t\t\tshapeOptions: {\r\n\t\t\t\tstroke: true,\r\n\t\t\t\tcolor: '#f06eaa',\r\n\t\t\t\tweight: 2,\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tfill: false,\r\n\t\t\t\tclickable: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitialize:function(map, options) {\r\n\t\t\tthis.type = L.Draw.LineGroup.TYPE;\r\n\t\t\tthis._initialLabelText = L.drawLocal.draw.handlers.line.tooltip.start;;\r\n\t\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\r\n\t\t},\r\n\t\t_drawShape:function(latlng) {\r\n\t\t\tif(this._shape){\r\n\t\t\t\tthis._shape.setEndpoints(this._startLatLng, latlng) ;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis._shape = new L.LineGroup(this._startLatLng, latlng, this._makeShapeOptions());\r\n\t\t\t\tthis._map.addLayer(this._shape);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fireCreatedEvent:function() {\r\n\t\t\tvar e = new L.LineGroup(this._startLatLng, this._shape._end, this._makeShapeOptions());\r\n\t\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, e);\r\n\t\t},\r\n\t\t_makeShapeOptions:function(){\r\n\t\t\treturn this.options.shapeOptions;\r\n\t\t}\r\n\t});\r\n\tL.Edit.LineGroup = L.Edit.Line.extend({\r\n\r\n\t});\r\n\r\n\tL.LineGroup.addInitHook(function () {\r\n\t\tthis.editing = new L.Edit.LineGroup(this);\r\n\t\t//if(this.options.editable)\r\n\t\t//\tthis.editing.enable();\r\n\t});\r\n\r\n\tL.AreaGroup = L.Rectangle.extend({\r\n\t\toptions:{\r\n\t\t\tshapeOptions:{\r\n\t\t\t\tfillOpacity:0.1\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoGeoJSON: function () {\r\n\t\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t\t\ti, len, hole;\r\n\r\n\t\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\t\tif (this._holes) {\r\n\t\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\t\thole.push(hole[0]);\r\n\t\t\t\t\tcoords.push(hole);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: 'Feature',\r\n\t\t\t\tproperties: this.getValue(),\r\n\t\t\t\toptions: this.options,\r\n\t\t\t\tgeometry: {\r\n\t\t\t\t\ttype: 'AreaGroup',\r\n\t\t\t\t\tcoordinates: coords\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t})\r\n\tL.Draw.AreaGroup = L.Draw.Rectangle.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'areaGroup'\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\tshapeOptions:{\r\n\t\t\t\tstroke: true,\r\n\t\t\t\tcolor: '#f06eaa',\r\n\t\t\t\tweight: 2,\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tfillColor: null,\r\n\t\t\t\tfillOpacity:0.1\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitialize:function(map, options) {\r\n\t\t\tL.Draw.Rectangle.prototype.initialize.call(this, map, options);\r\n\t\t\tthis.type = L.Draw.AreaGroup.TYPE;\r\n\t\t},\r\n\t\t_fireCreatedEvent: function () {\r\n\t\t\tvar rectangle = new L.AreaGroup(this._shape.getBounds(), this.options.shapeOptions);\r\n\t\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, rectangle);\r\n\t\t}\r\n\t});\r\n\tL.Edit.AreaGroup = L.Edit.Rectangle.extend({\r\n\r\n\t});\r\n\tL.AreaGroup.addInitHook(function(){\r\n\t\tthis.editing = new L.Edit.AreaGroup(this);\r\n\t});\r\n\r\n\tL.NumberMarker.include({\r\n\t\ttoData:function(){\r\n\t\t\treturn L.SvFeatureGroup.getData(this,{\r\n\t\t\t\ttype:'numberMarker'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tL.Stamp = L.Path.extend({\r\n\t\tstatics:{\r\n\t\t\tSVG:L.Browser.svg\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\t\"font-family\":\"Helvetica\",\r\n\t\t\t\"font-style\":\"normal\",\r\n\t\t\tcolor:\"black\",\r\n\t\t\t\"font-weight\":\"bold\",\r\n\t\t\t\"letter-spacing\":\"0.05em\",\r\n\t\t\tstroke:\"black\",\r\n\t\t\t\"stroke-width\":2,\r\n\t\t\t\"text-decoration\":\"none\",\r\n\t\t\tdashArray:\"\",\r\n\t\t\tmultiSelect:false\r\n\t\t},\r\n\t\tinitialize:function(latlng, options) {\r\n\t\t\tvar self = this;\r\n\t\t\tL.Path.prototype.initialize.call(self, options);\r\n\t\t\tself._latlng = latlng;\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tself._updateStyle();\r\n\t\t\t\tself.projectLatlngs();\r\n\t\t\t}, 10);\r\n\t\t},\r\n\t\tgetBounds: function () {\r\n\t\t\tL.Path.prototype.getBounds.call(this);\r\n\r\n\t\t\tvar e = this._radius,\r\n\t\t\t\tt = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t\t\ti = this._map.layerPointToLatLng(new L.Point(t.x - e, t.y - e)),\r\n\t\t\t\ts = this._map.layerPointToLatLng(new L.Point(t.x + e, t.y + e));\r\n\t\t\treturn new L.LatLngBounds(i, s);\r\n\r\n\t\t},\r\n\t\tprojectLatlngs:function() {\r\n\t\t\tif (this._map) {\r\n\t\t\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t\t\t\tvar radius, fontSize, strokeWidth, zoom = this._map.getZoom();\r\n\t\t\t\tswitch (zoom) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tradius = 10;\r\n\t\t\t\t\t\tfontSize = 7;\r\n\t\t\t\t\t\tstrokeWidth = 1.5;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tradius = 15;\r\n\t\t\t\t\t\tfontSize = 12;\r\n\t\t\t\t\t\tstrokeWidth = 2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tradius = 20;\r\n\t\t\t\t\t\tfontSize = 15;\r\n\t\t\t\t\t\tstrokeWidth = 2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tradius = 30;\r\n\t\t\t\t\t\tfontSize = 20;\r\n\t\t\t\t\t\tstrokeWidth = 3;\r\n\t\t\t\t}\r\n\t\t\t\tthis._radius = radius;\r\n\t\t\t\tthis._text.setAttribute(\"font-size\", fontSize);\r\n\t\t\t\tthis._path.setAttribute(\"stroke-width\", strokeWidth);\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetLatLngs:function(laglng){\r\n\t\t\tthis._latlng = laglng;\r\n\t\t},\r\n\t\tgetLatLng:function(){\r\n\t\t\treturn this._latlng;\r\n\t\t},\r\n\t\tgetPathString:function() {\r\n\t\t\tvar point = this._point,\r\n\t\t\t\tdata = this.getValue();\r\n\t\t\treturn {\r\n\t\t\t\tradius:this._radius,\r\n\t\t\t\tx:point.x,\r\n\t\t\t\ty:point.y,\r\n\t\t\t\tstr:data?data.seq||'':''\r\n\t\t\t};\r\n\t\t},\r\n\t\t_createElement:function(e) {\r\n\t\t\treturn document.createElementNS(L.Path.SVG_NS, e);\r\n\t\t},\r\n\t\t_initElements:function() {\r\n\t\t\tthis._map._initPathRoot(), this._initPath(), this._initStyle();\r\n\t\t},\r\n\t\t_initPath:function() {\r\n\t\t\tthis._container = this._createElement(\"g\");\r\n\t\t\tthis._path = this._createElement(\"circle\");\r\n\t\t\tthis._container.appendChild(this._path);\r\n\t\t\tthis._text = this._createElement(\"text\");\r\n\t\t\tthis._text.appendChild(document.createTextNode(\"\"));\r\n\t\t\tthis._text.appendChild(document.createTextNode(\"\"));\r\n\t\t\tthis._container.appendChild(this._text);\r\n\t\t},\r\n\t\t_initStyle:function() {\r\n\t\t\tthis._updateStyle();\r\n\t\t\tvar text = this._text;\r\n\t\t\ttext.setAttribute(\"letter-spacing\", this.options[\"letter-spacing\"]);\r\n\t\t\ttext.setAttribute(\"font-family\", this.options[\"font-family\"]);\r\n\t\t\ttext.setAttribute(\"fill\", this.options.color);\r\n\t\t\ttext.setAttribute(\"font-style\", this.options[\"font-style\"]);\r\n\t\t\ttext.setAttribute(\"font-weight\", this.options[\"font-weight\"]);\r\n\t\t\ttext.setAttribute(\"text-anchor\", \"middle\");\r\n\t\t\ttext.setAttribute(\"dominant-baseline\", \"central\");\r\n\t\t\ttext.setAttribute(\"text-decoration\", this.options[\"text-decoration\"]);\r\n\t\t\ttext.setAttribute(\"stroke\", this.options.color);\r\n\t\t\ttext.setAttribute(\"fill-opacity\", 1);\r\n\t\t\tif (\"review\" === this._status || \"pending\" === this._status) {\r\n\t\t\t\tthis._path.setAttribute(\"stroke-dasharray\", \"5, 2\");\r\n\t\t\t\tthis.options.dashArray = \"5, 2\";\r\n\t\t\t}\r\n\r\n\t\t\ttext.className = 'leaflet-clickable';\r\n\t\t\ttext.setAttribute('fill', this.options.color);\r\n\t\t\ttext.setAttribute('pointer-events', 'none');\r\n\t\t\ttext.setAttribute('style', 'white-space: pre');\r\n\t\t\ttext.setAttribute('xml:space', 'preserve');\r\n\t\t\ttext.setAttribute('letter-spacing', this.options['letter-spacing']);\r\n\t\t\tvar attrs = 'letter-spacing font-family font-style font-size font-weight text-decoration'.split(' '),\r\n\t\t\t\toptions = this.options;\r\n\t\t\tfor (var attr in attrs) {\r\n\t\t\t\ttext.setAttribute(attrs[attr], options[attrs[attr]]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_updatePath:function() {\r\n\t\t\tvar e = this.getPathString();\r\n\t\t\tthis._text.setAttribute(\"x\", e.x);\r\n\t\t\tif (L.Browser.ie) {\r\n\t\t\t\tthis._text.setAttribute(\"y\", e.y + 3 + this._map._zoom)\r\n\t\t\t} else {\r\n\t\t\t\tthis._text.setAttribute(\"y\", e.y + this._map._zoom - 2);\r\n\t\t\t}\r\n\t\t\tthis._text.textContent = e.str || this.string;\r\n\t\t\tthis._path.setAttribute(\"cx\", e.x);\r\n\t\t\tthis._path.setAttribute(\"cy\", e.y);\r\n\t\t\tthis._path.setAttribute(\"r\", e.radius);\r\n\t\t},\r\n\t\t_updateStyle:function() {\r\n\t\t\tL.Path.prototype._updateStyle.call(this);\r\n\t\t\tthis._path.removeAttribute(\"stroke-dasharray\");\r\n\t\t\tthis._path.removeAttribute(\"fill-opacity\");\r\n\t\t\tthis._text.setAttribute(\"letter-spacing\", this.options[\"letter-spacing\"]);\r\n\t\t\tthis._text.setAttribute(\"font-family\", this.options[\"font-family\"]);\r\n\t\t\tthis._text.setAttribute(\"fill\", this.options.color);\r\n\t\t\tthis._text.setAttribute(\"font-style\", this.options[\"font-style\"]);\r\n\t\t\tthis._text.setAttribute(\"font-weight\", this.options[\"font-weight\"]);\r\n\t\t\tthis._text.setAttribute(\"text-anchor\", \"middle\");\r\n\t\t\tthis._text.setAttribute(\"dominant-baseline\", \"central\");\r\n\t\t\tthis._text.setAttribute(\"text-decoration\", this.options[\"text-decoration\"]);\r\n\t\t\tthis._path.setAttribute(\"stroke\", this.options.color);\r\n\t\t\tthis._path.setAttribute(\"fill-opacity\", 0.1);\r\n\t\t\tif(this._value && this._value.$groupId)\r\n\t\t\t\tthis._path.setAttribute(\"stroke-dasharray\", \"5, 2\");\r\n\t\t},\r\n\t\ttoGeoJSON: function () {\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype:'Feature',\r\n\t\t\t\tproperties:this.getValue(),\r\n\t\t\t\toptions:this.options,\r\n\t\t\t\tgeometry: {\r\n\t\t\t\t\ttype: 'Stamp',\r\n\t\t\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tL.Draw.Stamp = L.Draw.SimpleShape.extend({\r\n\t\tstatics: {\r\n\t\t\tTYPE: 'stamp'\r\n\t\t},\r\n\t\toptions:{\r\n\t\t\tstroke:true,\r\n\t\t\tcolor:\"#f06eaa\",\r\n\t\t\tweight:2,\r\n\t\t\topacity:1,\r\n\t\t\tfill:true,\r\n\t\t\tfillOpacity:.2,\r\n\t\t\tclickable:true\r\n\t\t},\r\n\t\tinitialize:function(e, t) {\r\n\t\t\tthis.type = L.Draw.Stamp.TYPE;\r\n\t\t\tthis._initialLabelText = '点击位置进行测量';\r\n\t\t\tL.Draw.SimpleShape.prototype.initialize.call(this, e, t);\r\n\t\t},\r\n\t\tenable:function(button) {\r\n\t\t\tif (!this._enabled) {\r\n\t\t\t\tL.Handler.prototype.enable.call(this);\r\n\t\t\t\tthis.fire(\"enabled\", {\r\n\t\t\t\t\thandler: this.type,\r\n\t\t\t\t\tbutton: button\r\n\t\t\t\t});\r\n\t\t\t\tthis._map.fire(\"draw:drawstart\", {\r\n\t\t\t\t\tlayerType: this.type\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t_makeShapeOptions:function() {\r\n\t\t\tthis.options.text = this.text;\r\n\t\t\tthis.options.title = this.title;\r\n\t\t\tthis.options.stamp = this.text;\r\n\t\t\treturn this.options;\r\n\t\t},\r\n\t\t_drawShape:function(e) {\r\n\t\t\tif (this._shape) {\r\n\t\t\t\tthis._shape.setBounds(new L.LatLngBounds(this._startLatLng, e));\r\n\t\t\t} else {\r\n\t\t\t\tthis._shape = new L.Stamp(this._startLatLng, this._makeShapeOptions());\r\n\t\t\t\tthis._map.addLayer(this._shape)\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fireCreatedEvent:function(e) {\r\n\t\t\tvar stamp = new L.Stamp(this._shape._latlng, this._makeShapeOptions());\r\n\t\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, stamp);\r\n\t\t},\r\n\t\t_clickToCreate:function(e) {\r\n\t\t\tif(e.changedTouches){\r\n\t\t\t\te.clientX = e.changedTouches[0].clientX;\r\n\t\t\t\te.clientY = e.changedTouches[0].clientY;\r\n\t\t\t}\r\n\t\t\tvar t = this._map.mouseEventToLayerPoint(e),\r\n\t\t\t\ti = new L.Point(0, 6);\r\n\t\t\tthis._startLatLng = this._map.layerPointToLatLng(t.subtract(i));\r\n\t\t\tthis._drawShape(this._map.layerPointToLatLng(t.add(i)));\r\n\t\t\tthis._fireCreatedEvent();\r\n\t\t},\r\n\t\t_onMouseMove:function(e) {\r\n\t\t\tvar latlng = e.latlng;\r\n\t\t\tthis._tooltip.updatePosition(latlng);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Edit.Stamp = L.Edit.SimpleShape.extend({\r\n\t\toptions:{\r\n\t\t\tdismissOnDone:false\r\n\t\t},\r\n\t\t_createMoveMarker: function () {\r\n/*\t\t\tvar bounds = this._shape.getBounds(),\r\n\t\t\t\tcenter = bounds.getCenter();*/\r\n\r\n\t\t\tthis._moveMarker = this._createMarker(this._shape._latlng, new L.DivIcon({\r\n\t\t\t\ticonSize: new L.Point(this._shape._radius, this._shape._radius),\r\n\t\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move'\r\n\t\t\t}));\r\n\t\t\tthis._moveMarker.setOpacity(0);\r\n\t\t},\r\n\t\t_fireEdit:function(){\r\n\t\t\tL.Edit.SimpleShape.prototype._fireEdit.call(this);\r\n\t\t\tthis._moveMarker.setOpacity(0);\r\n\t\t},\r\n\t\t_onMarkerDragStart: function (e) {\r\n\t\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\r\n\t\t},\r\n\t\t_createResizeMarker: function () {\r\n\t\t\tthis._resizeMarkers = [];\r\n\t\t},\r\n\t\t_move:function(latlng){\r\n\t\t\tthis._shape.setLatLngs(latlng);\r\n\t\t\tthis._shape.redraw();\r\n\t\t\tthis._shape.fire('editdrag');\r\n\t\t},\r\n\t\t_onMarkerDrag: function (e) {\r\n\t\t\tvar marker = e.target,\r\n\t\t\t\tlatlng = marker.getLatLng();\r\n\r\n\t\t\tthis._closePopover();\r\n\r\n\t\t\tif (marker === this._moveMarker) {\r\n\t\t\t\tthis._move(latlng);\r\n\t\t\t} else {\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tL.Stamp.addInitHook(function () {\r\n\t\tthis.editing = new L.Edit.Stamp(this);\r\n\t\t//if(this.options.editable)\r\n\t\t//\tthis.editing.enable();\r\n\t});\r\n\r\n\tL.SvFeatureGroup = L.FeatureGroup.extend({\r\n\t\toptions: {\r\n\r\n\t\t},\r\n\t\tinitialize: function (options) {\r\n\t\t\tvar self = this;\r\n\t\t\tself._layers = {};\r\n\t\t\tL.Util.setOptions(self, options);\r\n\t\t},\r\n\t\tonAdd: function (map) {\r\n\t\t\tvar self = this;\r\n\t\t\tL.FeatureGroup.prototype.onAdd.call(this,map);\r\n\r\n\t\t\tmap.on('click',self._onClick,self);\r\n\t\t\t//self.on('layeradd',self._onAdd,self);\r\n\t\t\t//self.on('layerremove',self._onRemove,self);\r\n\t\t},\r\n\t\t_onAdd:function(layer,callback){\r\n\t\t\tif(!this.options.onAdd || this.options.onAdd.call(this,layer,callback)!==false){\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t\t//console.log('add',JSON.stringify(layer.toGeoJSON()));\r\n\r\n\t\t},\r\n\t\t_onClick:function(e){\r\n\t\t\tvar self = this;\r\n\t\t\tif(e.target instanceof L.Marker){\r\n\t\t\t\tself._fireEditLayer(e.target);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar p = e.latlng,// this._map.mouseEventToLatLng(e),\r\n\t\t\t\toverLayers = [],\r\n\t\t\t\teb;\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif(layer.editing && layer.editing._enabled)\r\n\t\t\t\t\teb = layer;\r\n\t\t\t\tvar bounds = layer.getBounds();\r\n\t\t\t\tconsole.log(bounds,p);\r\n\t\t\t\tif(bounds && L.SvFeatureGroup.isMiddleNumber(bounds._southWest.lat, bounds._northEast.lat, p.lat, 1) &&\r\n\t\t\t\t\tL.SvFeatureGroup.isMiddleNumber(bounds._southWest.lng, bounds._northEast.lng, p.lng, 1)\r\n\t\t\t\t){\r\n\t\t\t\t\toverLayers.push(layer);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(overLayers.length == 1){\r\n\t\t\t\tthis._fireEditLayer(overLayers[0]);\r\n\t\t\t}\r\n\t\t\telse if(overLayers.length>1){\r\n\t\t\t\tif(eb)\r\n\t\t\t\t\teb.editing.disable();\r\n\t\t\t\tvar toolbar = L.DomUtil.create('div','leaflet-draw-subbuttom'),\r\n\t\t\t\t\tul = L.DomUtil.create('ul','',toolbar);\r\n\t\t\t\toverLayers.forEach(function(layer){\r\n\t\t\t\t\tvar li =  L.DomUtil.create('li','',ul),\r\n\t\t\t\t\t\ta = L.DomUtil.create('a','',li);\r\n\t\t\t\t\ta.setAttribute('href','javascript:void(0)');\r\n\t\t\t\t\tif(layer instanceof L.Stamp) {\r\n\t\t\t\t\t\ta.innerHTML = '点'+(layer.getValue() && layer.getValue().seq);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(layer instanceof L.LineGroup){\r\n\t\t\t\t\t\ta.innerHTML = '测量组'\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(layer instanceof L.AreaGroup){\r\n\t\t\t\t\t\ta.innerHTML = '区域组';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tL.DomEvent.on(a,'click',function(e){\r\n\t\t\t\t\t\tself._map.closePopup();\r\n\t\t\t\t\t\tself._fireEditLayer(layer);\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\tself._map.openPopup(toolbar,p,{\r\n\t\t\t\t\tcloseButton:false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//alert(e);\r\n\t\t},\r\n\t\t_fireEditLayer: function(layer) {\r\n\t\t\tif(layer.editing && layer.editing._enabled)return;\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif (layer.editing && layer.editing._enabled)\r\n\t\t\t\t\tlayer.editing.disable();\r\n\t\t\t});\r\n\t\t\tif (layer.editing && !layer.editing._enabled)\r\n\t\t\t\tlayer.editing.enable();\r\n\t\t},\r\n\t\taddLayer: function (layer,edit) {\r\n\t\t\tvar self = this;\r\n\t\t\tL.FeatureGroup.prototype.addLayer.call(self,layer);\r\n\t\t\tlayer.on('click',self._onClick,self);\r\n\t\t\tsetTimeout(function(){\r\n\r\n\t\t\t\t//self._onAdd(layer,function(){\r\n\t\t\t\t\tlayer._fg = self;\r\n\t\t\t\t\tif(!layer._value || !layer._value.$id){\r\n\t\t\t\t\t\tlayer.setValue({\r\n\t\t\t\t\t\t\t$id:L.SvFeatureGroup.uuid()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tL.SvFeatureGroup.onUpdate(layer,true);\r\n\t\t\t\t\tif(edit!==false) {\r\n\t\t\t\t\t\tself._fireEditLayer(layer);\r\n\t\t\t\t\t}\r\n\t\t\t\t//});\r\n\t\t\t},100);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\taddData: function (geojson) {\r\n\t\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t\t\ti, len, feature;\r\n\r\n\t\t\tif (features) {\r\n\t\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\t\tfeature = features[i];\r\n\t\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tvar options = this.options;\r\n\r\n\t\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t\t\tcoords = geometry.coordinates,layer,latlng;\r\n\t\t\tswitch (geometry.type) {\r\n\t\t\t\tcase 'Stamp':\r\n\t\t\t\t\tlatlng = this.coordsToLatLng(coords);\r\n\t\t\t\t\tlayer = new L.Stamp(latlng,geojson.options);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'LineGroup':\r\n\t\t\t\t\tlatlng = this.coordsToLatLngs(coords);\r\n\t\t\t\t\tlayer = new L.LineGroup(latlng[0],latlng[1],geojson.options);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'AreaGroup':\r\n\t\t\t\t\tlatlng = this.coordsToLatLngs(coords, 1);\r\n\t\t\t\t\tlayer = new L.AreaGroup(latlng, geojson.options);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tlayer.setValue && layer.setValue(geojson.properties);\r\n\t\t\treturn this.addLayer(layer,false);\r\n\t\t},\r\n\t\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t\t},\r\n\t\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\t\tvar latlng, i, len,\r\n\t\t\t\tlatlngs = [];\r\n\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = levelsDeep ?\r\n\t\t\t\t\tthis.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t\t\t(coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\t\tlatlngs.push(latlng);\r\n\t\t\t}\r\n\t\t\treturn latlngs;\r\n\t\t},\r\n\t\tremoveLayer:function(layer){\r\n\t\t\tif(layer instanceof L.LineGroup){\r\n\t\t\t\tvar fg = layer._fg;\r\n\t\t\t\tif(fg){\r\n\t\t\t\t\tvar groupId = layer.getValue().$id;\r\n\t\t\t\t\tfg.eachLayer(function(ly){\r\n\t\t\t\t\t\tif(ly instanceof L.Stamp || ly instanceof L.AreaGroup){\r\n\t\t\t\t\t\t\tif(ly.getValue().$groupId==groupId){\r\n\t\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t\t$groupId: null\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tly._fg.options.onUpdate && ly._fg.options.onUpdate.call(ly._fg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(ly instanceof L.Stamp){\r\n\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t$groupId: null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tly._fg.options.onUpdate && ly._fg.options.onUpdate.call(ly._fg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlayer._fg.options.onDelete && layer._fg.options.onDelete.call(layer._fg);\r\n\t\t\tL.FeatureGroup.prototype.removeLayer(layer);\r\n\t\t}\r\n\t});\r\n\tL.extend(L.SvFeatureGroup,{\r\n\t\tuuid:function(){\r\n\t\t\tvar d = new Date().getTime();\r\n\t\t\tif(window.performance && typeof window.performance.now === \"function\"){\r\n\t\t\t\td += performance.now();\r\n\t\t\t}\r\n\t\t\tvar uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n\t\t\t\tvar r = (d + Math.random()*16)%16 | 0;\r\n\t\t\t\td = Math.floor(d/16);\r\n\t\t\t\treturn (c=='x' ? r : (r&0x3|0x8)).toString(16);\r\n\t\t\t});\r\n\t\t\treturn uuid;\r\n\t\t},\r\n\t\tonUpdate:function(layer,isNew){\r\n\t\t\tif(layer instanceof L.LineGroup){\r\n\t\t\t\tvar fg = layer._fg;\r\n\t\t\t\tif(fg){\r\n\t\t\t\t\tvar groupId = layer.getValue().$id;\r\n\t\t\t\t\tfg.eachLayer(function(ly){\r\n\t\t\t\t\t\tif(ly instanceof L.Stamp){\r\n\t\t\t\t\t\t\tvar isInline = L.SvFeatureGroup.circleLineIntersection(layer._startPoint,layer._endPoint,ly._point,ly._radius);\r\n\t\t\t\t\t\t\tif(isInline) {\r\n\t\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t\t$groupId: groupId\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if(ly.getValue().$groupId==groupId) {\r\n\t\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t\t$groupId: null\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(layer instanceof L.Stamp){\r\n\t\t\t\tvar fg = layer._fg;\r\n\t\t\t\tif(fg){\r\n\t\t\t\t\tvar groupId = null;\r\n\t\t\t\t\tfg.eachLayer(function(ly){\r\n\t\t\t\t\t\tif(!groupId && ly instanceof L.LineGroup){\r\n\t\t\t\t\t\t\tvar isInline = L.SvFeatureGroup.circleLineIntersection(ly._startPoint,ly._endPoint,layer._point,layer._radius);\r\n\t\t\t\t\t\t\tif(isInline) {\r\n\t\t\t\t\t\t\t\tgroupId = ly.getValue().$id;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.log(isInline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(ly instanceof L.AreaGroup){\r\n\t\t\t\t\t\t\tvar b = ly.getBounds();\r\n\t\t\t\t\t\t\tif(L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat,layer._latlng.lat)\r\n\t\t\t\t\t\t\t&& L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng,layer._latlng.lng)){\r\n\t\t\t\t\t\t\t\tgroupId = ly.getValue().$id;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//console.log('b',b,layer)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlayer.updateValue({\r\n\t\t\t\t\t\t$groupId:groupId\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(layer instanceof L.AreaGroup){\r\n\t\t\t\tvar fg = layer._fg;\r\n\t\t\t\tif(fg){\r\n\t\t\t\t\tvar groupId = layer.getValue().$id;\r\n\t\t\t\t\tfg.eachLayer(function(ly){\r\n\t\t\t\t\t\tif(ly instanceof L.Stamp){\r\n\t\t\t\t\t\t\tvar b = layer.getBounds();\r\n\t\t\t\t\t\t\tif(L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat,ly._latlng.lat)\r\n\t\t\t\t\t\t\t\t&& L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng,ly._latlng.lng)){\r\n\t\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t\t$groupId: groupId\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if(ly.getValue().$groupId==groupId) {\r\n\t\t\t\t\t\t\t\tly.updateValue({\r\n\t\t\t\t\t\t\t\t\t$groupId: null\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlayer._fg && layer._fg.options.onUpdate && layer._fg.options.onUpdate.call(layer._fg,layer,isNew);\r\n\t\t\t//console.log('serve',layer);\r\n\t\t},\r\n\t\tgetData: function (layer, newData) {\r\n\t\t\treturn L.extend({\r\n\t\t\t\toptions:layer.options\r\n\t\t\t}, newData);\r\n\t\t},\r\n\t\tbindPopupContainer:function(layer,edit) {\r\n\t\t\tvar fg = layer._fg;\r\n\t\t\treturn fg.options.onPopup && fg.options.onPopup({\r\n\t\t\t\t\tlayer: layer,\r\n\t\t\t\t\tfeatureGroup: fg,\r\n\t\t\t\t\tedit: edit\r\n\t\t\t\t});\r\n/*\t\t\tvar self = this;\r\n\t\t\t//console.log('layer',layer)\r\n\t\t\tvar toolbar = L.DomUtil.create('div', 'leaflet-draw-subbuttom'),\r\n\t\t\t\tul = L.DomUtil.create('ul', '', toolbar);\r\n\t\t\tvar li = L.DomUtil.create('li', '', ul),\r\n\t\t\t\ta = L.DomUtil.create('a', '', li);\r\n\t\t\ta.setAttribute('href', 'javascript:void(0)');\r\n\t\t\ta.innerHTML = 'delete';\r\n\t\t\tL.DomEvent.on(a, 'click', function (e) {\r\n\t\t\t\tvar fg = layer._fg;\r\n\t\t\t\tif (fg) {\r\n\t\t\t\t\tdelete layer._fg\r\n\t\t\t\t\tlayer.editing && layer.editing.disable();\r\n\t\t\t\t\tfg.removeLayer(layer);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t\treturn toolbar;*/\r\n\t\t},\r\n\t\tcircleLineIntersection:function(p1,p2,rp,r){\r\n\t\t\tvar x1 = p1.x,x2 = p2.x,\r\n\t\t\t\ty1 = p1.y,y2 = p2.y,\r\n\t\t\t\tx = rp.x,y = rp.y;\r\n\r\n\t\t\tvar lib = Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2));\r\n\t\t\tvar dx = (x1-x2)/lib,\r\n\t\t\t    dy = (y1-y2)/lib;\r\n\t\t\tvar t = dx*(x-x2) + dy*(y-y2);\r\n\t\t\tvar ex = t*dx+x2,\r\n\t\t\t\tey = t*dy+y2;\r\n\t\t\tvar lec = Math.sqrt(Math.pow(ex-x,2)+Math.pow(ey-y,2));\r\n\t\t\tif( lec < r )//两点\r\n\t\t\t{\r\n\t\t\t\tvar dt = Math.sqrt(Math.pow(r,2) - Math.pow(lec,2));\r\n\t\t\t\tvar fx = (t-dt)*dx + x2,\r\n\t\t\t\t\tfy = (t-dt)*dy + y2;\r\n\r\n\t\t\t\tvar gx = (t+dt)*dx + x2,\r\n\t\t\t\t\tgy = (t+dt)*dy + y2;\r\n\r\n\t\t\t\treturn this.pointIsInLine(p1,p2,[{x:fx,y:fy},{x:gx,y:gy}]);\r\n\t\t\t}\r\n\t\t\telse if(lec == r) { //切线\r\n\t\t\t\treturn this.pointIsInLine(p1,p2,[{x:ex,y:ey}]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointIsInLine:function(p1,p2,ps){\r\n\t\t\tfor(var i= 0,l=ps.length;i<l;i++) {\r\n\t\t\t\tvar p = ps[i];\r\n\t\t\t\tif (this.isMiddleNumber(p1.x, p2.x, p.x) && this.isMiddleNumber(p1.y, p2.y, p.y))\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},//判断点是否在线上\r\n\t\tisMiddleNumber:function(n1,n2,n, f) {\r\n\t\t\tif(f){ //修正线难被点到的问题\r\n\t\t\t\tif(Math.abs(n1-n2)<0.02){\r\n\t\t\t\t\tif(n1>n2)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tn1+=0.01;\r\n\t\t\t\t\t\tn2-=0.01;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tn1-=0.01;\r\n\t\t\t\t\t\tn2+=0.01;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn n1 > n2 ?\r\n\t\t\tn1 >= n && n >= n2 :\r\n\t\t\tn2 >= n && n >= n1;\r\n\t\t}//判断数字是否在两值中间\r\n\t});\r\n})(window,document);\n/**\r\n * Created by jiuyuong on 2016/4/2.\r\n */\r\n(function(window,document){\r\n    'use strict';\r\n\r\n    L.SXTCRS = L.extend({}, L.CRS, {\r\n        projection: L.Projection.LonLat,\r\n        transformation: new L.Transformation(1, 0, 1, 0),\r\n        scale: function (e) {\r\n            return 512 * Math.pow(2, e);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    var sc = L.SXT = {};\r\n    sc.GroupToolbar = L.DrawToolbar.extend({\r\n        options:{\r\n            stamp:{},\r\n            lineGroup:{},\r\n            areaGroup:{}\r\n        },\r\n        getModeHandlers:function(map){\r\n            return [\r\n                {\r\n                    enabled: this.options.stamp,\r\n                    handler: new L.Draw.Stamp(map, this.options.stamp),\r\n                    title: '实测'\r\n                },\r\n                {\r\n                    enabled: this.options.lineGroup,\r\n                    handler: new L.Draw.LineGroup(map,this.options.lineGroup),\r\n                    title:'测试组'\r\n                },\r\n                {\r\n                    enabled: this.options.areaGroup,\r\n                    handler: new L.Draw.AreaGroup(map,this.options.areaGroup),\r\n                    title:'区域测量'\r\n                }\r\n            ];\r\n        }\r\n    });\r\n    sc.SXTCRS = L.extend({}, L.CRS, {\r\n        projection: L.Projection.LonLat,\r\n        transformation: new L.Transformation(1, 0, 1, 0),\r\n        scale: function (e) {\r\n            return 512 * Math.pow(2, e);\r\n        }\r\n    });\r\n\r\n    sc.Project = L.Class.extend({\r\n        includes: L.Mixin.Events,\r\n        options: {\r\n            tileLayers: {},\r\n            featureGroups:{}\r\n        },\r\n        initialize:function(id,options){\r\n            var self = this,fg = false;\r\n            options = L.setOptions(self, options);\r\n            self._map = L.map(id,{\r\n                crs: sc.SXTCRS,\r\n                center: [.3, .2],\r\n                zoom: 2,\r\n                minZoom: 0,\r\n                maxZoom: 3,\r\n                scrollWheelZoom: true,\r\n                annotationBar: false,\r\n                attributionControl: false\r\n            });\r\n            self._tileLayer = {};\r\n\r\n            for(var tile in options.tileLayers){\r\n                self._tileLayer[tile] = {\r\n                    url: options.tileLayers[tile].url,\r\n                    layer: L.tileLayer(options.tileLayers[tile].url, L.Util.extend({attribution: false},options.tileLayers[tile].options))\r\n                }\r\n                if(!fg){\r\n                    self.swipeTile(tile);\r\n                    fg = true;\r\n                }\r\n            }\r\n            fg = false;\r\n            self._featureGroups={};\r\n            for(var tile in options.featureGroups){\r\n                var svFg = new L.SvFeatureGroup(options.featureGroups[tile].options);\r\n                self._featureGroups[tile] = {\r\n                    layer: svFg,\r\n                    toolbar:new L.Control.Draw(L.extend(options.featureGroups[tile].toolbar,{\r\n                        featureGroup:svFg\r\n                    }))\r\n                }\r\n                if(!fg){\r\n                    self.swipeFeature(tile,true);\r\n                    fg = true;\r\n                }\r\n            }\r\n        },\r\n        swipeTile:function(k){\r\n            var self = this,map = self._map;\r\n            if(self._currentTile){\r\n                map.removeLayer(self._currentTile);\r\n            }\r\n            console.log('add k',k);\r\n            self._currentTile = self._tileLayer[k].layer.addTo(map);\r\n        },\r\n        swipeFeature:function(k,isAdd){\r\n            var self = this,\r\n                fs = self._fs = (self._fs ||{}),\r\n                map = self._map;\r\n            if(fs[k]){\r\n                if(!isAdd)\r\n                {\r\n                    map.removeLayer(fs[k].layer);\r\n                    map.removeControl(fs[k].toolbar);\r\n                }\r\n                delete fs[k];\r\n                return;\r\n            }\r\n            else if(isAdd){\r\n                fs[k] = self._featureGroups[k];\r\n                if(fs[k]){\r\n                    fs[k].layer.addTo(map);\r\n                    fs[k].toolbar.addTo(map);\r\n                }\r\n            }\r\n        },\r\n    })\r\n\r\n})(window,document);\n//# sourceMappingURL=maps/BZ.js.map\n"],"sourceRoot":"/source/"}