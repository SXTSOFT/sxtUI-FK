/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc', ['app.core','angular-echarts','ngCordova','JPushPlugin'])
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    $stateProvider
      .state('app.xhsc', {
        abstract:true
      })
      .state('app.xhsc.application',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        showgrzx:true,
        title :'应用',
        url   :'/application',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/home/application.html',
            controller:'applicationController as vm'
          }
        }
      })
      .state('app.xhsc.mcenter',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        opBtn:true,
        title :'消息中心',
        url   :'/mcenter',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/mcenter.html',
            controller:'mcenterController as vm'
          }
        }
      })
      .state('app.xhsc.pcenter',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'个人中心',
        url   :'/pcenter',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/pcenter.html',
            controller:'pcenterController as vm'
          }
        }
      })
      .state('app.xhsc.pcmain',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        showgrzx:true,
        title :'个人中心',
        url   :'/pcmain',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/pcenter_main.html',
            controller:'pcenter_mainController as vm'
          }
        }
      })
      .state('app.xhsc.person',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'个人信息',
        url   :'/person',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/person.html',
            controller:'personController as vm'
          }
        }
      })
      .state('app.xhsc.message',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :' ',
        url   :'/message',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/message.html',
            controller:'messageController as vm'
          }
        }
      })
      .state('app.xhsc.scPiclst',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测图纸列表',
        url   :'/scPiclst/{projectID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/scPiclst.html',
            controller:'scPiclstController as vm'
          }
        }
      })
      .state('app.xhsc.standarRegion',{
        noBack:true,
        sendBt:true,
        rightArrow:false,
        leftArrow:false,
        title :'标准化区域',
        url   :'/standarRegion/{projectID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/standarRegion.html',
            controller:'standarRegionController as vm'
          }
        }
      })
      .state('app.xhsc.sc_standar',{
        noBack:true,
        sendBt:true,
        rightArrow:false,
        leftArrow:false,
        title :'实测标准化',
        url   :'/sc_standar/{AcceptanceItemID}/{DrawingID}/{AcceptanceIndexID}/{projectID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/center/sc_standar.html',
            controller:'sc_standarController as vm'
          }
        }
      })
  }
})();

/**
 * Created by shaoshun on 2017/3/7.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  safeSelfMainController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$mdBottomSheet", "$stateParams", "remote", "$q", "utils", "xhUtils", "api", "xhscService", "sxt"];
  angular
    .module('app.xhsc')
    .controller('safeSelfMainController',safeSelfMainController);

  /** @ngInject */
  function safeSelfMainController($state,$rootScope,$scope,$mdDialog,$mdBottomSheet,$stateParams,remote,$q,utils,xhUtils,api,xhscService,sxt){
    var vm = this;
    vm.procedure=[];
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];

    function projectTask(regionIDs, acceptanceItemIDs,_filter) {
      var filter=_filter;
      if (!filter){
        var regions=regionIDs?regionIDs.split(','):[];
        var  areaID=regions[0].substr(0,10);
        var acceptanceItems=acceptanceItemIDs?acceptanceItemIDs.split(','):[];
        filter=  function filter(item) {
          return  regions.find(function (n) {
              return  item.RegionId.toString().indexOf(n)>-1
            })&& acceptanceItems.indexOf(item.AcceptanceItemID.toString())>-1
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("Acceptances",areaID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(areaID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function getbasinfo(item) {
      return [
        function (tasks) {
          return remote.self.getBaseInfo("safe",item.Id).then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Ponits; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.safe.pointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecords; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.safe.problemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.fileQuery(t.FileID).then(function (r) {
                      t.FileContent=r.data.Base64;
                      return remote.self.safe.problemRecordFileCreate(t)
                    });
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.Extends.RegionID,item.Extends.AcceptanceItemID))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(getbasinfo(item))
                .concat(function () {
                  return remote.self.getSafePointGeo("safe",item.Id);
                })
                .concat(function () {
                  return remote.offline.create({Id: 'selfSafe' + item.Id});
                })
              api.task(tasks, {
                event: 'selfSafe',
                target: item.Id
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('selfSafe', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.Id == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);


    function up() {
      this.uploadInfo={};
      this.uploadInfo.uploading=false;
      this.dbs=[];
    }

    up.prototype.doneUp=function () {
      var  self=this;
      api.setNetwork(0).then(function () {
        self.uploadInfo.uploading=true;
        self.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog){
            $scope.uploadInfo = self.uploadInfo;
            self._firstStepUp().then(function (task) {
              if(task&&task.length){
                api.task(task)(function (percent, current, total) {
                  self.progress(percent,current,total);
                }, function () {
                  self.success(function () {
                    self.clear();
                    $mdDialog.hide();
                  })
                }, function (timeout) {
                  self.fail(function () {
                    $mdDialog.hide();
                  })
                });
              }else {
                utils.alert("没有要上传的数据!");
              }
            });
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      })
    }
    up.prototype._firstStepUp=function () {
      var tasks=[];
      var  self=this;
      return $q(function (resolve,reject) {
        self.getPostParams().then(function (params) {
          if (params.InspectionPoint){
            params.InspectionPoint.forEach(function (t) {
              if (t.geometry) {
                t.Geometry = t.geometry;
              }
              if (typeof t.Geometry === 'string') {
                t.Geometry = JSON.parse(t.Geometry);
              }
              tasks.push(function () {
                return remote.Procedure.InspectionPoint.create(t)
              });
            });
          }
          if(params.ProblemRecordFileInput){
            params.ProblemRecordFileInput.forEach(function (k) {
              tasks.push(function () {
                return remote.safe.inserFile({
                  FileName:k.FileID,
                  Base64:k.FileContent
                }).then(function (res) {
                  if(res&&res.data&&res.data.ID){
                    k.FileID=res.data.ID;
                  }
                  delete k.FileContent;
                })
              });
            });
          }
          delete params.InspectionPoint;
          var t= self._nextStepUp(tasks,params);
          resolve(t);
        }).catch(function () {
          resolve([]);
        });
      })
    }

    up.prototype._nextStepUp=function (tasks,params) {
      var data=this.buildData(params);
      var inspectionsIds=[];
      if (data&&data.length){
        data.forEach(function (k) {
          if (inspectionsIds.indexOf(k.InspectionID)==-1){
            inspectionsIds.push(k.InspectionID);
          }
          tasks.push(function () {
            return remote.self.self_upload("safe",k);
          })
        });
      }
      inspectionsIds.forEach(function (o) {
        tasks.push(function () {
          return remote.self.updateStatus("safe",o);
        })
      })
      return tasks;
    }

    up.prototype.buildData=function (params) {
      var areas=[];
      var checkpointInput=params.CheckpointInput;
      if (checkpointInput&&checkpointInput.length){
        checkpointInput.forEach(function (q) {
          if (!areas.find(function (k) {
              return q.RegionID==k.RegionID&&q.AcceptanceItemID==k.AcceptanceItemID&&k.InspectionID==q.InspectionID;
            })){
            areas.push({
              Id:sxt.uuid(),
              RegionID:q.RegionID,
              AcceptanceItemID:q.AcceptanceItemID,
              InspectionID:q.InspectionID,
              SelfCheckType:"safe"
            })
          }
        });
        areas.forEach(function (k) {
          var Status=2;
          k.CheckPoint=checkpointInput.filter(function (q) {
            return q.RegionID==k.RegionID&&q.AcceptanceItemID==k.AcceptanceItemID&&k.InspectionID==q.InspectionID;
          })
          if (k.CheckPoint&&k.CheckPoint.length){
            k.CheckPoint.forEach(function (n) {
              if (n.Status==1){
                Status=1;
              }
              n.ProblemRecordInput=params.ProblemRecordInput.filter(function (q) {
                return  q.CheckpointID==n.CheckpointID
              })
              if (n.ProblemRecordInput&&n.ProblemRecordInput.length){
                n.ProblemRecordInput.forEach(function (t) {
                  t.ProblemRecordFileInput=params.ProblemRecordFileInput.filter(function (q) {
                    return q.ProblemRecordID==t.ProblemRecordID;
                  })
                })
              }
            })
          }
          k.Status=Status;
        })
        return areas;
      }
    }

    up.prototype.getPostParams=function () {
      var self=this;
      self.dbs=[];
      function convert(pa,ignore) {
        if (pa&&pa.vals&&pa.db){
          self.dbs.push(pa.db);
          if (!ignore){
            return  self.filterData(pa.vals);
          }
        }
        return pa.vals;
      }
      return $q(function (resolve,reject) {
        api.getUploadData(function (cfg) {
          return cfg.mark == "selfSafeUp"||cfg.mark =="allUp";
        }).then(function (val) {
          var params={},t;
          if (val&&val.length){
            t=val.find(function (o) {
              return o.key == "InspectionPoint";
            });
            params.InspectionPoint=convert(t);
            t = val.find(function (o) {
              return o.key == "selfSafePoints";
            });
            params.CheckpointInput=convert(t,true);
            t = val.find(function (o) {
              return o.key == "selfSafeProblemRecord";
            });
            params.ProblemRecordInput=convert(t);
            t = val.find(function (o) {
              return o.key == "selfSafeInspectionProblemRecordFile";
            });
            params.ProblemRecordFileInput=convert(t);
          }
          resolve(params);
        }).catch(function () {
          resolve({});
        })
      })
    }

    up.prototype.filterData=function (arr) {
      if (angular.isArray(arr)){
        return arr.filter(function (t) {
          return !t.isUpload;
        })
      }
      return [];
    }

    up.prototype.clear=function () {
      var self=this;
      self.dbs.forEach(function (db) {
        db.destroy();
      })
    }
    up.prototype.progress=function (percent,current,total) {
      this.uploadInfo.percent = parseInt(percent * 100) + ' %';
      this.uploadInfo.current = current;
      this.uploadInfo.total = total;
    }

    up.prototype.success=function (callback) {
      var self=this;
      if (callback){
        callback();
      }
      utils.alert("上传成功!");
      load();
      remote.offline.query().then(function(m){
        if(angular.isArray(m.data)){
          m.data.forEach(function(n){
            if(n.Id&&(n.Id.indexOf("selfSafe")>-1||n.Id.indexOf("selfSafe")>-1)){
              remote.offline.delete({Id:n.Id});
            }
          });
        }
      });
      self.uploadInfo.uploading = false;
    }

    up.prototype.fail=function (callback) {
      if (callback){
        callback();
      }
      utils.alert('上传失败,请检查网络');
      this.uploadInfo.uploaded = 0;
      this.uploadInfo.uploading = false;
    }


    vm.upload = function () {
      api.setNetwork(0).then(function () {
        var post=new up();
        post.doneUp();
      })
    }

    function load() {
      return remote.self.getInspection.cfgSet({
        mode:2
      })("safe").then(function (r) {
        var  data=r.data
        vm.Inspections = [];
        if (data&&angular.isArray(data.data)) {
          var ys = [];
          data.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (r&&angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "selfSafe" + k.Id;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
            vm.isOver=true;
          })
        }
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go("app.xhsc.gx.selfAccept",{inspectionID:item.Id});
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go("app.xhsc.gx.selfAccept",{inspectionID:item.Id});
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

  }
})();

/**
 * Created by shaoshun on 2017/3/7.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  safeSelfItemController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils"];
  angular
    .module('app.xhsc')
    .controller('safeSelfItemController',safeSelfItemController);

  /** @ngInject */
  function safeSelfItemController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils){
    var vm = this;
    $rootScope.ok=true;
    vm.isOver=true;
    vm.selected=[];
    var ok = $rootScope.$on('ok',function(){
      if (!vm.selected.length){
        utils.alert("至少应该选择一个验收项!");
        return;
      }
      var acceptanceitemIDs=vm.selected.map(function (o) {
        return o.AcceptanceItemID;
      }).join(",");
      $state.go("app.xhsc.sf.selfRegion",{
        acceptanceitemIDs:acceptanceitemIDs
      });
    });

    $scope.$on('$destroy', function () {
      ok()
      ok = null;
    })

  }
})();


(function(){
  'use strict';

  safeSelfAcceptController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils", "$mdSidenav", "$timeout", "xhscService", "api"];
  angular
    .module('app.xhsc')
    .controller('safeSelfAcceptController',safeSelfAcceptController);

  /** @ngInject */
  function safeSelfAcceptController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils,$mdSidenav,$timeout,xhscService,api){
    var vm = this;
    vm.num=0;

    vm.getMaxR=function (item) {
      if (!item){
        return;
      }
      var ApplicableArea=item.ApplicableArea.split(',');
      ApplicableArea=ApplicableArea.sort();
      if (ApplicableArea.length){
        $scope.maxRegion=ApplicableArea[ApplicableArea.length-1];
        if($scope.maxRegion){
          $scope.maxRegion=parseInt($scope.maxRegion);
        }
      }
    }

    vm.selectItem=function (item) {
      $scope.current.procedure=item;
      vm.getMaxR(item);
      $mdSidenav("acceptItem").close();
      if(!$scope.current.region&&!$mdSidenav("region").isOpen()){
        vm.open("region");
      }
    }

    vm.selectRegion=function (item) {
      $scope.current.region=item;
      $mdSidenav("region").close()
      if(!$scope.current.procedure&&!$mdSidenav("acceptItem").isOpen()){
        vm.open("acceptItem");
      }
    }

    api.setNetwork(1).then(function () {
      vm.inspectionID=$stateParams.inspectionID;
      vm.inspection=null;
      $scope.current={};
      vm.procedure=[];

      vm.zk=function (item) {
        item.show=!item.show;
      }
      //初始化左侧工序栏
      function initgx(res) {
        return  remote.safe.getSecurityItem.cfgSet({
          offline: true
        })().then(function (r) {
          var acceptItemIds="";
          if (res&&res.Extends&&res.Extends.AcceptanceItemID){
            acceptItemIds=res.Extends.AcceptanceItemID;
          }
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
            vm.procedure= vm.procedure.filter(function (o) {
              return acceptItemIds.indexOf(o.AcceptanceItemID)>-1;
            })
            if (vm.procedure.length>1){
              if(!$mdSidenav("region").isOpen()){
                vm.open("acceptItem");
              }
            }else {
              $scope.current.procedure=vm.procedure[0];
              $scope.maxRegion=16;
              vm.getMaxR(vm.procedure[0]);
            }
          }
        });
      }
      //初始化右边区域
      function initRegion(res) {
        var regionIds="";
        if (res&&res.Extends&&res.Extends.RegionID){
          regionIds=res.Extends.RegionID;
        }
        return   xhscService.getRegionTreeOffline("", 31,1).then(function (r) {
          vm.loaded=true;
          vm.houses=[];
          vm.building=[];
          vm.num=0;
          var regions=regionIds.split(',');
          if (r.length){
            r.forEach(function (k) {
              if (k.Children&&k.Children.length){
                k.Children.forEach(function (m) {
                  if (regions.find(function (t) {
                      return t.indexOf(m.RegionID)>-1
                    })){
                    vm.houses.push(m)
                  }
                })
              }
            });
            vm.houses.forEach(function (o) {
              if (o.Children&&o.Children.length){
                o.Children.forEach(function (m) {
                  if (regions.find(function (t) {
                      return t==m.RegionID;
                    })) {
                    vm.building.push(m);
                  }
                });
              }
            })
          }
        })
      }

      (function init(berfor) {
        berfor().then(function (res) {
          initgx(res);
          initRegion(res);
        })
      })(function () {
        return remote.self.getInspection("safe").then(function (r) {
          var data=r.data;
          if (data&&angular.isArray(data.data)){
            vm.inspection=data.data.find(function (o) {
              return o.Id==vm.inspectionID;
            });
          }
          return vm.inspection;
        });
      });

      vm.open=function (id) {
        if (id=="region"){
          setRegionStatus();
        }
        $mdSidenav(id).open();
      }
    })

    function setRegionStatus() {
      function ConvertClass(status){
        var style;
        switch (status){
          case 1:
            style="ng";
            break;
          case 2:
            style="pass";
            break;
          default:
            break;
        }
        return style;
      }

      (function (befor) {
        befor().then(function (points) {
          if($scope.maxRegion&&vm.building&&vm.building.length){  //设置状态
            var areaList=vm.inspection&&vm.inspection.AreaList?vm.inspection.AreaList:[];
            vm.num=0;
            vm.wy_num=0; //未验
            vm.bhg_num=0; //已验
            vm.hg_num=0;
            switch ($scope.maxRegion){
              case 8:
                vm.building.forEach(function (k) {
                  if (k.Children&&k.Children.length){
                    k.Children.forEach(function (u) {
                      vm.num++;
                      var area=areaList.find(function (q) {
                        return q.RegionID==u.RegionID;
                      })
                      if (area){
                        u.Status=area.Status;
                        u.style=ConvertClass(u.Status);
                        if (u.Status==1){
                          vm.bhg_num++;
                        }else {
                          vm.hg_num++;
                        }
                      }else {
                        if (points.find(function (q) {
                            if ($scope.current.procedure){
                              return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                            }
                            return false;
                          })){
                          u.checked=true;
                        }else {
                          u.checked=false;
                        }
                        vm.wy_num++;
                      }
                    });
                  }
                })
                break;
              default:
                vm.building.forEach(function (k) {
                  if (k.Children&&k.Children.length){
                    k.Children.forEach(function (u) {
                      vm.num++;
                      var area=areaList.find(function (q) {
                        return q.RegionID==u.RegionID;
                      })
                      if (area){
                        u.Status=area.Status;
                        u.style=ConvertClass(u.Status);
                        if (u.Status==1){
                          vm.bhg_num++;
                        }else {
                          vm.hg_num++;
                        }
                      }else {
                        if (points.find(function (q) {
                            if ($scope.current.procedure){
                              return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                            }
                            return false;
                          })){
                          u.checked=true;
                        }else {
                          u.checked=false;
                        }
                        vm.wy_num++;
                      }
                      if (u.Children&&u.Children.length){
                        u.Children.forEach(function (n) {
                          vm.num++;
                          area=areaList.find(function (q) {
                            return q.RegionID==n.RegionID;
                          })
                          if (area){
                            u.Status=area.Status;
                            u.style=ConvertClass(u.Status);
                            if (u.Status==1){
                              vm.bhg_num++;
                            }else {
                              vm.hg_num++;
                            }
                          }else {
                            if (points.find(function (q) {
                                if ($scope.current.procedure){
                                  return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                                }
                                return false;
                              })){
                              u.checked=true;
                            }else {
                              u.checked=false;
                            }
                            vm.wy_num++;
                          }
                        })
                      }
                    });
                  }
                })
                break;
            }
          }
        })
      })(function () {
        return  $q(function (resolve,reject) {
          return remote.self.safe.pointQuery().then(function (r) {
            if (r&&r.data){
              resolve(r.data);
            }else {
              resolve([]);
            }
          });
        });
      });
    }

    vm.info = {
      current:null,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };

    vm.cancelCurrent = function ($event) {
      vm.info.current = null;
    }

    var sendResult = $rootScope.$on('sendGxResult',function(){
      utils.alert("提交成功，请稍后离线上传数据！",null,function () {
        $state.go('app.xhsc.sf.selfMain');
      });
    })
    $scope.$on("$destroy",function(){
      sendResult();
      sendResult = null;
    });


    $scope.$watch("current.region",function (v,o) {
      if (v){
        if ($scope.current.procedure){
          vm.info.show=true;
        }else {
          vm.info.show=false;
        }
      }
    })
    $scope.$watch("current.procedure",function (v,o) {
      if (v){
        if ($scope.current.region){
          vm.info.show=true;
        }else {
          vm.info.show=false;
        }
        vm.procedureData=[v];
        vm.procedureData.forEach(function(t){
          t.SpecialtyChildren = t.ProblemClassifyList;
          t.ProblemClassifyList.forEach(function(_t){
            _t.WPAcceptanceList = _t.ProblemLibraryList;
            _t.SpecialtyName = _t.ProblemClassifyName;
            _t.ProblemLibraryList.forEach(function(_tt){
              _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
            })
          })
        })
      }
    })
  }
})();
/**
 * Created by shaoshun on 2017/3/7.
 */

/**
 * Created by shaoshun on 2017/3/7.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  safeSelfRegionController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils", "xhscService", "sxt", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('safeSelfRegionController',safeSelfRegionController);

  /** @ngInject */
  function safeSelfRegionController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils,xhscService,sxt,$timeout){
    var vm = this;
    vm.isOver=true;
    vm.selected=[];
    vm.acceptanceitemIDs=  $stateParams.acceptanceitemIDs;
    var ok = $rootScope.$on('ok',function(){
      function submit(before) {
        if (!vm.selected.length){
          utils.alert("至少应该选择一个区域!");
          return;
        }
        var regionIds=vm.selected.map(function (o) {
          return o.RegionID;
        }).join(",");

        var date=new Date();
        var day=date.getDay();
        var year=date.getFullYear();
        var month=date.getMonth()+1;
        var hour=date.getHours();
        hour=hour.toString().length==1?("0"+hour):hour;
        var min=date.getMinutes();
        var defaultDes=year+"年"+month+"月"+day+"日"+hour+":"+min+"安全自检";
        before(defaultDes).then(function (res) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              res=res?res:defaultDes;
              remote.self.insertInspection({
                ProjectID :vm.selected[0].RegionID.substr(0,5),
                Describe :res,
                Status: 1,
                Extends:{
                  RegionID:regionIds,
                  AcceptanceItemID:vm.acceptanceitemIDs
                }
              },"safe").then(function () {
                $mdDialog.hide();
                $state.go("app.xhsc.sf.selfMain");
              })
            }],
            template: '<md-dialog aria-label="正在提交"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在提交数据...</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      }
      submit(function (defaultDes) {
        return $q(function (resolve,reject) {
          utils.confirm("您需要为本次自检输入一些描述信息吗?").then(function () {
            $timeout(function () {
              $mdDialog.show({
                controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
                  $scope.describe=defaultDes;
                  $scope.ok=function () {
                    $mdDialog.hide();
                    resolve( $scope.describe);
                  }
                  $scope.cancel=function () {
                    $mdDialog.cancel();
                    reject();
                  }
                }],
                templateUrl: 'app/main/xhsc/procedure/self/selfRegionTemp.html',
                parent: angular.element(document.body),
                clickOutsideToClose: true,
                fullscreen: false
              })
            })
          }).catch(function () {
            resolve();
          })
        })
      });
    });

    $scope.$on('$destroy', function () {
      ok()
      ok = null;
    })

  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  selfRegionController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils", "xhscService", "sxt", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('selfRegionController',selfRegionController);

  /** @ngInject */
  function selfRegionController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils,xhscService,sxt,$timeout){
    var vm = this;
    vm.isOver=true;
    vm.selected=[];
    vm.acceptanceitemIDs=  $stateParams.acceptanceitemIDs;
    var ok = $rootScope.$on('ok',function(){
      function submit(before) {
        if (!vm.selected.length){
          utils.alert("至少应该选择一个区域!");
          return;
        }
        var regionIds=vm.selected.map(function (o) {
          return o.RegionID;
        }).join(",");

        var date=new Date();
        var day=date.getDay();
        var year=date.getFullYear();
        var month=date.getMonth()+1;
        var hour=date.getHours();
        hour=hour.toString().length==1?("0"+hour):hour;
        var min=date.getMinutes();
        var defaultDes=year+"年"+month+"月"+day+"日"+hour+":"+min+"总包自检";
        before(defaultDes).then(function (res) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              res=res?res:defaultDes;
              remote.self.insertInspection({
                ProjectID :vm.selected[0].RegionID.substr(0,5),
                Describe :res,
                Status: 1,
                Extends:{
                  RegionID:regionIds,
                  AcceptanceItemID:vm.acceptanceitemIDs
                }
              },"Inspection").then(function () {
                $mdDialog.hide();
                $state.go("app.xhsc.gx.selfMain");
              })
            }],
            template: '<md-dialog aria-label="正在提交"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在提交数据...</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      }
      submit(function (defaultDes) {
        return $q(function (resolve,reject) {
          utils.confirm("您需要为本次自检输入一些描述信息吗?").then(function () {
            $timeout(function () {
              $mdDialog.show({
                controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
                  $scope.describe=defaultDes;
                  $scope.ok=function () {
                    $mdDialog.hide();
                    resolve( $scope.describe);
                  }
                  $scope.cancel=function () {
                    $mdDialog.cancel();
                    reject();
                  }
                }],
                templateUrl: 'app/main/xhsc/procedure/self/selfRegionTemp.html',
                parent: angular.element(document.body),
                clickOutsideToClose: true,
                fullscreen: false
              })
            })
          }).catch(function () {
            resolve();
          })
        })
      });
    });

    $scope.$on('$destroy', function () {
      ok()
      ok = null;
    })

  }
})();


(function(){
  'use strict';

  selfPictureController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils", "$mdSidenav", "$timeout", "xhscService", "api"];
  angular
    .module('app.xhsc')
    .controller('selfPictureController',selfPictureController);

  /** @ngInject */
  function selfPictureController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils,$mdSidenav,$timeout,xhscService,api){
    var vm = this;
    vm.num=0;

    vm.getMaxR=function (item) {
      if (!item){
        return;
      }
      var ApplicableArea=item.ApplicableArea.split(',');
      ApplicableArea=ApplicableArea.sort();
      if (ApplicableArea.length){
        $scope.maxRegion=ApplicableArea[ApplicableArea.length-1];
        if($scope.maxRegion){
          $scope.maxRegion=parseInt($scope.maxRegion);
        }
      }
    }

    vm.selectItem=function (item) {
      $scope.current.procedure=item;
      vm.getMaxR(item);
      $mdSidenav("acceptItem").close();
      if(!$scope.current.region&&!$mdSidenav("region").isOpen()){
        vm.open("region");
      }
    }

    vm.selectRegion=function (item) {
      $scope.current.region=item;
      $mdSidenav("region").close()
      if(!$scope.current.procedure&&!$mdSidenav("acceptItem").isOpen()){
        vm.open("acceptItem");
      }
    }

    api.setNetwork(1).then(function () {
      vm.inspectionID=$stateParams.inspectionID;
      vm.inspection=null;
      $scope.current={};
      vm.procedure=[];

      vm.zk=function (item) {
        item.show=!item.show;
      }
      //初始化左侧工序栏
      function initgx(res) {
        return  remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("cycle").then(function (r) {
          var acceptItemIds="";
          if (res&&res.Extends&&res.Extends.AcceptanceItemID){
            acceptItemIds=res.Extends.AcceptanceItemID;
          }
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
            vm.procedure= vm.procedure.filter(function (o) {
              return acceptItemIds.indexOf(o.AcceptanceItemID)>-1;
            })
            if (vm.procedure.length>1){
              if(!$mdSidenav("region").isOpen()){
                vm.open("acceptItem");
              }
            }else {
              $scope.current.procedure=vm.procedure[0];
              $scope.maxRegion=16;
              vm.getMaxR(vm.procedure[0]);
            }
          }
        });
      }
      //初始化右边区域
      function initRegion(res) {
        var regionIds="";
        if (res&&res.Extends&&res.Extends.RegionID){
          regionIds=res.Extends.RegionID;
        }
        return   xhscService.getRegionTreeOffline("", 31,1).then(function (r) {
          vm.loaded=true;
          vm.houses=[];
          vm.building=[];
          vm.num=0;
          var regions=regionIds.split(',');
          if (r.length){
            r.forEach(function (k) {
              if (k.Children&&k.Children.length){
                k.Children.forEach(function (m) {
                  if (regions.find(function (t) {
                      return t.indexOf(m.RegionID)>-1
                    })){
                    vm.houses.push(m)
                  }
                })
              }
            });
            vm.houses.forEach(function (o) {
              if (o.Children&&o.Children.length){
                o.Children.forEach(function (m) {
                  if (regions.find(function (t) {
                      return t==m.RegionID;
                    })) {
                    vm.building.push(m);
                  }
                });
              }
            })
          }
        })
      }

      (function init(berfor) {
        berfor().then(function (res) {
          initgx(res);
          initRegion(res);
        })
      })(function () {
        return remote.self.getInspection("Inspection").then(function (r) {
          var data=r.data;
          if (data&&angular.isArray(data.data)){
            vm.inspection=data.data.find(function (o) {
              return o.Id==vm.inspectionID;
            });
          }
          return vm.inspection;
        });
      });

      vm.open=function (id) {
        if (id=="region"){
          setRegionStatus();
        }
        $mdSidenav(id).open();
      }
    })

    function setRegionStatus() {
      function ConvertClass(status){
        var style;
        switch (status){
          case 1:
            style="ng";
            break;
          case 2:
            style="pass";
            break;
          default:
            break;
        }
        return style;
      }

      (function (befor) {
        befor().then(function (points) {
          if($scope.maxRegion&&vm.building&&vm.building.length){  //设置状态
            var areaList=vm.inspection&&vm.inspection.AreaList?vm.inspection.AreaList:[];
            vm.num=0;
            vm.wy_num=0; //未验
            vm.bhg_num=0; //已验
            vm.hg_num=0;
            switch ($scope.maxRegion){
              case 8:
                vm.building.forEach(function (k) {
                  if (k.Children&&k.Children.length){
                    k.Children.forEach(function (u) {
                      vm.num++;
                      u.style=null;
                      var area=areaList.find(function (q) {
                        return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                      })
                      if (area){
                        u.Status=area.Status;
                        u.style=ConvertClass(u.Status);
                        if (u.Status==1){
                          vm.bhg_num++;
                        }else {
                          vm.hg_num++;
                        }
                      }else {
                        if (points.find(function (q) {
                          if ($scope.current.procedure){
                            return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                          }
                          return false;
                          })){
                          u.checked=true;
                        }else {
                          u.checked=false;
                        }
                        vm.wy_num++;
                      }
                    });
                  }
                })
                break;
              default:
                vm.building.forEach(function (k) {
                  if (k.Children&&k.Children.length){
                    k.Children.forEach(function (u) {
                      vm.num++;
                      u.style=null;
                      var area=areaList.find(function (q) {
                        return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                      })
                      if (area){
                        u.Status=area.Status;
                        u.style=ConvertClass(u.Status);
                        if (u.Status==1){
                          vm.bhg_num++;
                        }else {
                          vm.hg_num++;
                        }
                      }else {
                        if (points.find(function (q) {
                            if ($scope.current.procedure){
                              return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                            }
                            return false;
                          })){
                          u.checked=true;
                        }else {
                          u.checked=false;
                        }
                        vm.wy_num++;
                      }
                      if (u.Children&&u.Children.length){
                        u.Children.forEach(function (n) {
                          vm.num++;
                          u.style=null;
                          area=areaList.find(function (q) {
                            return q.RegionID==n.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                          })
                          if (area){
                            u.Status=area.Status;
                            u.style=ConvertClass(u.Status);
                            if (u.Status==1){
                              vm.bhg_num++;
                            }else {
                              vm.hg_num++;
                            }
                          }else {
                            if (points.find(function (q) {
                                if ($scope.current.procedure){
                                  return q.RegionID==u.RegionID&&q.AcceptanceItemID==$scope.current.procedure.AcceptanceItemID;
                                }
                                return false;
                              })){
                              u.checked=true;
                            }else {
                              u.checked=false;
                            }
                            vm.wy_num++;
                          }
                        })
                      }
                    });
                  }
                })
                break;
            }
          }
        })
      })(function () {
        return  $q(function (resolve,reject) {
          return remote.self.zb.pointQuery().then(function (r) {
            if (r&&r.data){
              resolve(r.data);
            }else {
              resolve([]);
            }
          });
        });
      });
    }

    vm.info = {
      current:null,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };

    vm.cancelCurrent = function ($event) {
      vm.info.current = null;
    }

      var sendResult = $rootScope.$on('sendGxResult',function(){
        utils.alert("提交成功，请稍后离线上传数据！",null,function () {
          $state.go('app.xhsc.gx.selfMain');
        });
      })
      $scope.$on("$destroy",function(){
        sendResult();
        sendResult = null;
      });


      $scope.$watch("current.region",function (v,o) {
        if (v){
          if ($scope.current.procedure){
            vm.info.show=true;
          }else {
            vm.info.show=false;
          }
        }
      })
      $scope.$watch("current.procedure",function (v,o) {
        if (v){
          if ($scope.current.region){
            vm.info.show=true;
          }else {
            vm.info.show=false;
          }
          vm.procedureData=[v];
          vm.procedureData.forEach(function(t){
            t.SpecialtyChildren = t.ProblemClassifyList;
            t.ProblemClassifyList.forEach(function(_t){
              _t.WPAcceptanceList = _t.ProblemLibraryList;
              _t.SpecialtyName = _t.ProblemClassifyName;
              _t.ProblemLibraryList.forEach(function(_tt){
                _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
              })
            })
          })
        }
      })
  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  selfMainController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$mdBottomSheet", "$stateParams", "remote", "$q", "utils", "xhUtils", "api", "xhscService", "sxt"];
  angular
    .module('app.xhsc')
    .controller('selfMainController',selfMainController);

  /** @ngInject */
  function selfMainController($state,$rootScope,$scope,$mdDialog,$mdBottomSheet,$stateParams,remote,$q,utils,xhUtils,api,xhscService,sxt){
    var vm = this;
    vm.procedure=[];
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("cycle").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];

    function projectTask(regionIDs, acceptanceItemIDs,_filter) {
      var filter=_filter;
      if (!filter){
        var regions=regionIDs?regionIDs.split(','):[];
        var  areaID=regions[0].substr(0,10);
        var acceptanceItems=acceptanceItemIDs?acceptanceItemIDs.split(','):[];
        filter=  function filter(item) {
           return  regions.find(function (n) {
                return  item.RegionId.toString().indexOf(n)>-1
           })&& acceptanceItems.indexOf(item.AcceptanceItemID.toString())>-1
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("cycle",areaID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(areaID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function getbasinfo(item) {
      return [
        function (tasks) {
          return remote.self.getBaseInfo("Inspection",item.Id).then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Ponits; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.zb.pointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecords; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.zb.problemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.self.fileQuery(t.FileID).then(function (r) {
                      t.FileContent=r.data.Base64;
                      return remote.self.zb.problemRecordFileCreate(t)
                    });
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.Extends.RegionID,item.Extends.AcceptanceItemID))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(getbasinfo(item))
                .concat(function () {
                  return remote.self.getSafePointGeo("Inspection",item.Id);
                })
                .concat(function () {
                  return remote.offline.create({Id: 'selfZb' + item.Id});
                })
              api.task(tasks, {
                event: 'selfZbys',
                target: item.Id
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('selfZbys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.Id == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);


    function up() {
      this.uploadInfo={};
      this.uploadInfo.uploading=false;
      this.dbs=[];
    }

    up.prototype.doneUp=function () {
      var  self=this;
      api.setNetwork(0).then(function () {
        self.uploadInfo.uploading=true;
        self.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog){
            $scope.uploadInfo = self.uploadInfo;
            self._firstStepUp().then(function (task) {
              if(task&&task.length){
                api.task(task)(function (percent, current, total) {
                  self.progress(percent,current,total);
                }, function () {
                  self.success(function () {
                    self.clear();
                    $mdDialog.hide();
                  })
                }, function (timeout) {
                  self.fail(function () {
                    $mdDialog.hide();
                  })
                });
              }else {
                  utils.alert("没有要上传的数据!");
              }
            });
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      })
    }
    up.prototype._firstStepUp=function () {
      var tasks=[];
      var  self=this;
      return $q(function (resolve,reject) {
        self.getPostParams().then(function (params) {
          if (params.InspectionPoint){
            params.InspectionPoint.forEach(function (t) {
              if (t.geometry) {
                t.Geometry = t.geometry;
              }
              if (typeof t.Geometry === 'string') {
                t.Geometry = JSON.parse(t.Geometry);
              }
              tasks.push(function () {
                return remote.Procedure.InspectionPoint.create(t)
              });
            });
          }
          if(params.ProblemRecordFileInput){
            params.ProblemRecordFileInput.forEach(function (k) {
              tasks.push(function () {
                return remote.safe.inserFile({
                  FileName:k.FileID,
                  Base64:k.FileContent
                }).then(function (res) {
                  if(res&&res.data&&res.data.ID){
                    k.FileID=res.data.ID;
                  }
                  delete k.FileContent;
                })
              });
            });
          }
          delete params.InspectionPoint;
          var t= self._nextStepUp(tasks,params);
          resolve(t);
        }).catch(function () {
          resolve([]);
        });
      })
    }

    up.prototype._nextStepUp=function (tasks,params) {
        var data=this.buildData(params);
        var inspectionsIds=[];
        if (data&&data.length){
            data.forEach(function (k) {
              if (inspectionsIds.indexOf(k.InspectionID)==-1){
                inspectionsIds.push(k.InspectionID);
              }
              tasks.push(function () {
                  return remote.self.self_upload("Inspection",k);
              })
          });
        }
        inspectionsIds.forEach(function (o) {
          tasks.push(function () {
            return remote.self.updateStatus("Inspection",o);
          })
        })
        return tasks;
    }

    up.prototype.buildData=function (params) {
        var areas=[];
        var checkpointInput=params.CheckpointInput;
        if (checkpointInput&&checkpointInput.length){
          checkpointInput.forEach(function (q) {
              if (!areas.find(function (k) {
                  return q.RegionID==k.RegionID&&q.AcceptanceItemID==k.AcceptanceItemID&&k.InspectionID==q.InspectionID;
                })){
                areas.push({
                  Id:sxt.uuid(),
                  RegionID:q.RegionID,
                  AcceptanceItemID:q.AcceptanceItemID,
                  InspectionID:q.InspectionID,
                  SelfCheckType:"Inspection"
                })
              }
          });
          areas.forEach(function (k) {
            var Status=2;
            k.CheckPoint=checkpointInput.filter(function (q) {
              return q.RegionID==k.RegionID&&q.AcceptanceItemID==k.AcceptanceItemID&&k.InspectionID==q.InspectionID;
            })
            if (k.CheckPoint&&k.CheckPoint.length){
              k.CheckPoint.forEach(function (n) {
                if (n.Status==1){
                  Status=1;
                }
                n.ProblemRecordInput=params.ProblemRecordInput.filter(function (q) {
                   return  q.CheckpointID==n.CheckpointID
                })
                if (n.ProblemRecordInput&&n.ProblemRecordInput.length){
                  n.ProblemRecordInput.forEach(function (t) {
                      t.ProblemRecordFileInput=params.ProblemRecordFileInput.filter(function (q) {
                        return q.ProblemRecordID==t.ProblemRecordID;
                      })
                  })
                }
              })
            }
            k.Status=Status;
          })
          return areas;
        }
    }

    up.prototype.getPostParams=function () {
      var self=this;
      self.dbs=[];
      function convert(pa,ignore) {
        if (pa&&pa.vals&&pa.db){
          self.dbs.push(pa.db);
          if (!ignore){
            return  self.filterData(pa.vals);
          }
        }
        return pa.vals;
      }
      return $q(function (resolve,reject) {
        api.getUploadData(function (cfg) {
          return cfg.mark == "selfZbUp"||cfg.mark =="allUp";
        }).then(function (val) {
            var params={},t;
            if (val&&val.length){
              t=val.find(function (o) {
                return o.key == "InspectionPoint";
              });
              params.InspectionPoint=convert(t);
              t = val.find(function (o) {
                return o.key == "selfZbPoints";
              });
              params.CheckpointInput=convert(t,true);
              t = val.find(function (o) {
                return o.key == "selfZbProblemRecord";
              });
              params.ProblemRecordInput=convert(t);
              t = val.find(function (o) {
                return o.key == "selfZbInspectionProblemRecordFile";
              });
              params.ProblemRecordFileInput=convert(t);
            }
            resolve(params);
        }).catch(function () {
          resolve({});
        })
      })
    }

    up.prototype.filterData=function (arr) {
      if (angular.isArray(arr)){
        return arr.filter(function (t) {
          return !t.isUpload;
        })
      }
      return [];
    }

    up.prototype.clear=function () {
      var self=this;
      self.dbs.forEach(function (db) {
         db.destroy();
      })
    }
    up.prototype.progress=function (percent,current,total) {
      this.uploadInfo.percent = parseInt(percent * 100) + ' %';
      this.uploadInfo.current = current;
      this.uploadInfo.total = total;
    }

    up.prototype.success=function (callback) {
      var self=this;
      if (callback){
        callback();
      }
      utils.alert("上传成功!");
      load();
      remote.offline.query().then(function(m){
        if(angular.isArray(m.data)){
          m.data.forEach(function(n){
            if(n.Id&&(n.Id.indexOf("selfZb")>-1||n.Id.indexOf("selfZb")>-1)){
              remote.offline.delete({Id:n.Id});
            }
          });
        }
      });
      self.uploadInfo.uploading = false;
    }

    up.prototype.fail=function (callback) {
      if (callback){
        callback();
      }
      utils.alert('上传失败,请检查网络');
      this.uploadInfo.uploaded = 0;
      this.uploadInfo.uploading = false;
    }


    vm.upload = function () {
      api.setNetwork(0).then(function () {
        var post=new up();
        post.doneUp();
      })
    }

    function load() {
      return remote.self.getInspection.cfgSet({
        mode:2
      })("Inspection").then(function (r) {
        var  data=r.data
        vm.Inspections = [];
        if (data&&angular.isArray(data.data)) {
          var ys = [];
          data.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (r&&angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "selfZb" + k.Id;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
            vm.isOver=true;
          })
        }
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go("app.xhsc.gx.selfPicture",{inspectionID:item.Id});
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go("app.xhsc.gx.selfPicture",{inspectionID:item.Id});
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  selfGxController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils"];
  angular
    .module('app.xhsc')
    .controller('selfGxController',selfGxController);

  /** @ngInject */
  function selfGxController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils){
    var vm = this;
    $rootScope.ok=true;
    vm.isOver=true;
    vm.selected=[];

    var ok = $rootScope.$on('ok',function(){
        if (!vm.selected.length){
          utils.alert("至少应该选择一个工序!");
          return;
        }
        var acceptanceitemIDs=vm.selected.map(function (o) {
          return o.AcceptanceItemID;
        }).join(",");
        $state.go("app.xhsc.gx.selfRegion",{
          acceptanceitemIDs:acceptanceitemIDs
        });
    });

    $scope.$on('$destroy', function () {
      ok()
      ok = null;
    })

  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  xjRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('xjRecheckPopup',xjRecheckPopup);
  /** @ngInject */
  function xjRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/xj/xjRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.cycleLook.cycleProblemRecordQuery(scope.data.value.CheckpointID).then(function(r){
          scope.images={
            zb:[],
            jl:[]
          }

          r.data.forEach(function (p) {
            remote.cycleLook.cycleProblemRecordFileQuery(p.ProblemRecordID).then(function (r2) {
              if (p.DescRole=="jl"){
                scope.images.jl=scope.images.jl.concat(r2.data)
              }else{
                scope.images.zb=scope.images.zb.concat(r2.data);
              }
            });
          });

          var zb=r.data.find(function (p) {
            return p.DescRole=='zb'&&p.Remark
          })
          if (!zb){
            zb=r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          }

          var jl=r.data.find(function (p) {
            return p.DescRole=='jl'&&p.Remark
          })

          if (!jl){
            jl=r.data.find(function (p) {
              return p.DescRole=='jl'
            })
          }

          scope.Record = {
            jl:jl,
            zb:zb
          };

          if(!scope.Record.jl){
            scope.Record.jl = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"jl",
              Remark:''
            };
          }
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"zb",
              Remark:''
            };
          }
        })

        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }

      function createZb(update) {
        return $q(function (resolve,reject) {
          remote.cycleLook.cycleProblemRecordQuery.cfgSet({
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="zb";
            },
          })(scope.data.value.CheckpointID).then(function (r) {
            if (!r||!r.data||!r.data.length){
              // scope.Record.zb.ProblemRecordID = sxt.uuid()
              var rec={
                CheckpointID:scope.data.value.CheckpointID,
                RectificationID:scope.data.item,
                Describe:'',
                DescRole:"zb",
                Remark:''
              };
              rec.ProblemRecordID = sxt.uuid();
              rec._id=rec.ProblemRecordID;
              remote.cycleLook.cycleProblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }else {
              var rec=r.data[0];
              rec.Describe=rec.Remark=scope.Record.zb.Remark;
              rec.Remark=rec.Remark=scope.Record.zb.Remark;
              rec.DescRole="zb";
              remote.cycleLook.cycleProblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }

          });
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function (res) {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:res.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.cycleLook.cycleProblemRecordFileCreate(img).then(function () {
                // var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                scope.images.zb=scope.images.zb.concat([img]);
              })

            })
            scope.data.value.Status = 16;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }
      scope.submit = function(){
        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }
        if(scope.role=='zb'){
          if(convert(scope.data.value.Status)==8 &&(!scope.images.zb || scope.images.zb.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.cycleLook.cyclePointCreate(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.cycleLook.cyclePointCreate(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
          }).then(function () {
            remote.cycleLook.cycleProblemRecordQuery.cfgSet({
              filter: function (item, CheckpointID) {
                return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="jl";
              },
            })(scope.data.value.CheckpointID).then(function (r) {
              if (!r||!r.data||!r.data.length){
                var rec={
                  CheckpointID:scope.data.value.CheckpointID,
                  RectificationID:scope.data.item,
                  Describe:scope.Record.zb.Remark,
                  DescRole:"jl",
                  Remark:scope.Record.zb.Remark
                };
                rec.ProblemRecordID = sxt.uuid();
                rec._id=rec.ProblemRecordID;
                remote.cycleLook.cycleProblemRecordCreate(rec)
              }else {
                var rec=r.data[0];
                // rec.Describe=rec.Remark=scope.Record.zb.Remark;
                rec.DescRole="jl";
                remote.cycleLook.cycleProblemRecordCreate(rec);
              }
            });
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('xjRecheckPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('xjRecheckPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  xjRecheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils", "$q"];
  angular
    .module('app.xhsc')
    .directive('xjRecheck',xjRecheck);
  /** @ngInject */
  function xjRecheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils,$q) {
    return {
      scope:{
        item:'=xjRecheck',
        sxtMapShow:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        points:"=",
        ct:'=',
        info:"="
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;

      function convert(status) {
        switch (status){
          case 8:
          case 4:
            return 1;
          case 16:
            return 8;
        }
        return status;
      }

      var install =function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              $("#inspect").css("display","none");
              $q.all([
                remote.cycleLook.cyclePointQuery.cfgSet({
                  filter:function (item,inspectionId) {
                    if (scope.info&&scope.info.isGj){
                      return item.AreaID == scope.regionId&&item.AcceptanceItemID==scope.info.AcceptanceItemID&&item.InspectionExtendID==inspectionId;
                    }
                    return  item.AreaID==scope.regionId&&item.InspectionExtendID==inspectionId;
                  }
                })(scope.inspectionId),
                remote.cycleLook.cyclePointGeo()
              ]).then(function (res) {
                var fs = [];
                fg.data = res[0].data;
                res[0].data.forEach(function (item) {
                  var p = res[1].data.find(function (pt) {
                    return pt.MeasurePointID == item.PositionID;
                  });
                  if (p && p.Geometry) {
                    var geo = $window.JSON.parse(p.Geometry);
                    if(geo && geo.geometry) {
                      if (geo.geometry.type == 'Stamp')
                        geo.geometry.type = 'Point';
                      geo.properties.Status = item.Status;
                      geo.properties.v = item;
                      geo.properties.seq = item.ProblemSortName;
                      fs.push(geo);
                    }
                  }
                })
                fg.addData(fs, false);
                scope.points=fg.data;
                cb();
                fs.forEach(function (t) {
                  fg.updateStatus(t.properties.v.PositionID,convert(t.properties.Status))
                })
                scope.ct && (scope.ct.loading = false);
              })

            },
            onUpdate: function (layer, isNew, group,cb) {
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('xjRecheckPopup');
              if (edit) {
                scope.sxtMapShow = true;
                edit.scope.context = fg;
                edit.scope.data = {
                  item: scope.item,
                  value: layer.properties.v
                }
                edit.scope.apply && edit.scope.apply();
              }
            }
          });
          $timeout(function () {
            remote.safe.getDrawingRelate.cfgSet({
              offline: true
            })("cycle",scope.regionId).then(function (result) {
              var imgId = result.data.find(function (item) {
                if (scope.info&&scope.info.isGj){
                    return item.RegionId == scope.regionId&&item.AcceptanceItemID==scope.info.AcceptanceItemID;
                }
                return item.Type==7&& item.RegionId == scope.regionId;
              });
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID==item.DrawingID
                        })){
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                  //scope.ct && (scope.ct.loading = false);
                })
              }
              else {
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('info', function () {
          if(scope.regionId) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  xjAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('xjAcceptPopup',xjAcceptPopup);
  /** @ngInject */
  function xjAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/xj/xjAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.cycleLook.cycleProblemRecordQuery(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            p.action="Insert";
            remote.cycleLook.cycleProblemRecordCreate(p);
          }
          scope.data.p = p;
          remote.cycleLook.cycleProblemRecordFileQuery(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            img.action="Insert";
            remote.cycleLook.cycleProblemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('xjAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('xjAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  xjAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('xjAccept',xjAccept);
  /** @ngInject */
  function xjAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils) {
    return {
      scope:{
        item:'=xjAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        inspectionAreaId:"=",
        imgId:"=",
        ct:'=',
        disableInspect:'@',
        disableDrag:'@',
        gx:"="
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        scope.identity=0;
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              remote.cycleLook.cyclePointQuery.cfgSet({
                filter:function (item){
                  if (scope.gx&&scope.gx.isGj){
                    return item.AreaID==scope.regionId&&item.InspectionExtendID==scope.inspectionId&&item.AcceptanceItemID==scope.gx.AcceptanceItemID;
                  }
                  return item.AreaID==scope.regionId&&item.InspectionExtendID==scope.inspectionId;
                }
              })().then(function (r) {
                remote.cycleLook.cycleGeoQuery().then(function (r1) {
                  fg.data = r.data,fs=[];
                  r.data.forEach(function (c) {
                    var p = r1.data.find(function (p1) {
                      return p1.MeasurePointID == c.PositionID;
                    });
                    if (p && p) {
                      if(p.Geometry){
                        p.geometry = $window.JSON.parse(p.Geometry);
                      }else{
                        p.geometry = p.geometry;
                      }
                      if(p.geometry && p.geometry.properties) {
                        if ($.isNumeric(c.ProblemSortName)){
                          var  t=parseInt(c.ProblemSortName);
                          scope.identity=scope.identity<t?t:scope.identity;
                        }
                        p.geometry.properties.seq = c.ProblemSortName;
                        if (p.geometry.geometry.type == 'Stamp')
                          p.geometry.geometry.type = 'Point';
                        p.geometry.properties.Status = c.Status;
                        fs.push(p.geometry);
                      }
                    }
                  });
                  scope.item = null;
                  fg.addData(fs,false);
                  cb();
                  scope.ct && (scope.ct.loading = false);
                  scope.excuted=false;
                })
              })
            },
            onUpdate: function (layer, isNew, group,cb) {
              if(isNew){
                layer.properties.seq = scope.item.ProblemSortName;
                layer.properties.seq =++scope.identity;
                layer.properties.Status = scope.item.ProblemID?1:2;
              }
              var point = {
                MeasurePointID:layer.properties.$id,
                geometry:layer
              };
              remote.cycleLook.cycleGeoCreate(point);
              if(isNew || !fg.data.find(function (d) {
                  return d.PositionID == point.MeasurePointID;
                })) {
                var v = {
                  DrawingID:scope.imgId,
                  InspectionExtendID:scope.inspectionId,
                  CheckpointID:sxt.uuid(),
                  IndexPointID:scope.item.ProblemID,
                  AreaID:scope.regionId,
                  AcceptanceItemID:scope.procedure,
                  PositionID:point.MeasurePointID,
                  MeasureValue:0,
                  Status:1,
                  ProblemSortName:layer.properties.seq,
                  ProblemDescription:scope.item.ProblemDescription,
                  isNew:true
                }
                if(!v.IndexPointID){
                  v.Status = 2;
                  point.geometry.properties.Status = 2;
                }
                v.action="Insert";
                fg.data.push(v);
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                remote.cycleLook.cyclePointCreate(v);

              }
              cb(layer);
            },
            onPopupClose: function (cb) {
              var self = this;
              var edit = mapPopupSerivce.get('xjAcceptPopup'),
                scope = edit.scope;
              if(scope.data && scope.isSaveData!==false){
                scope.isSaveData = false;
                self.options.onUpdateData(scope.context,scope.data,scope);
              }
              cb();
            },
            onUpdateData: function (context, data, editScope) {
              if(data.v.ProblemSortName == 'T'){
                data.v.action="Insert";
                remote.cycleLook.cyclePointCreate(data.v);
              }
            },
            onDelete: function (layer,cb) {
              var id = layer.properties.$id;
              //删除几何点
              remote.cycleLook.cycleGeoDelete.delete({MeasurePointID:id}).then(function (r) {
                var v = fg.data.find(function (d) {
                  return d.PositionID == id;
                }),ix = fg.data.indexOf(v);
                fg.data.splice(ix,1);
                //删除检查点
                remote.cycleLook.cyclePointDelete({CheckpointID:v.CheckpointID}).then(function () {
                  //删除记录
                  remote.cycleLook.cycleProblemRecordQuery(v.CheckpointID).then(function (k) {
                    if (angular.isArray(k.data)){
                      k.data.forEach(function (w) {
                        //删除照片
                        remote.cycleLook.cycleProblemRecordDelete(w).then(function () {
                          remote.cycleLook.cycleProblemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                            if (angular.isArray(m.data)){
                              m.data.forEach(function (q) {
                                remote.cycleLook.cycleProblemRecordFileDelete(q);
                              })
                            }
                          })
                        })
                      });

                    }
                  })
                });
              });
              cb(layer);
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('xjAcceptPopup');
              if(edit) {
                edit.scope.context = {
                  fg:fg,
                  layer:layer
                };
                edit.scope.data = {
                  item:scope.item,
                  procedure:scope.procedure,
                  regionId:scope.regionId,
                  v:fg.data.find(function (d) {
                    return d.PositionID == layer.properties.$id;
                  })
                };
                edit.scope.readonly = scope.readonly;
                edit.scope.apply && edit.scope.apply();
                cb(edit.el[0]);
              }
            }
          });
          $timeout(function () {
            if (scope.imgId){
              remote.Project.getDrawing(scope.imgId).then(function (result2) {
                scope.asyn=false;
                if(!result2.data.DrawingContent){
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(2)');
                  return;
                }
                map.loadSvgXml(result2.data.DrawingContent);
                map.map.addControl(fg);
              }).catch(function () {
              })
            }
          }, 300);
        }
      };
      scope.$watch('regionId', function () {
        if(!scope.loading&&scope.regionId&&scope.imgId) {
          if(map){
            map.remove();
            map = null;
          }
          install();
          scope.loading=true;
          $timeout(function () {
            scope.loading=false;
          },300)
        }
      });
      scope.$watch('imgId', function () {
        if(!scope.loading&&scope.imgId) {
          if(map){
            map.remove();
            map = null;
          }
          install();
          scope.loading=true;
          $timeout(function () {
            scope.loading=false;
          },300)
        }
      });
      scope.$watch('item',function () {
        if(fg) {
          if (scope.item) {
            fg.changeMode('inspect',scope.item);
          }
          else {
            fg.changeMode();
          }
        }
      })


      // $timeout(function () {
      //
      // }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtScStandarPop.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "db"];
  angular
    .module('app.xhsc')
    .directive('sxtScStandarPop',sxtScStandarPop);
  /** @ngInject */
  function sxtScStandarPop(mapPopupSerivce,$timeout,sxt,xhUtils,db){
    return {
      restrict:'E',
      scope:{
        readonly:'='
      },
      templateUrl:'app/main/xhsc/directive/sc/sxtScStandarPop.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.ct ={
      };
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      //scope.apply = function() {
      //  scope.isSaveData = null;
      //  var context = scope.context,p = context.layer.getValue();
      //  var singleEdit=[],mutiEdit=[],floorEdit=[],sjzEdit=[],materEidt=[],group= null,groupEdit=[];
      //  scope.data.updates = [];
      //  var ms = [];
      //  scope.data.measureIndexes&&scope.data.measureIndexes.forEach(function(m){
      //    if(m.Children && m.Children.length){
      //      var m0 = m.Children.find(function(m2){
      //        return m2.QSKey=='2';
      //      });
      //      m.Children.forEach(function (it) {
      //        it.QSKey = m0?'2': m.QSKey;
      //        ms.push(it);
      //      });
      //    }
      //    else{
      //      ms.push(m);
      //    }
      //  });
      //
      //  ms.forEach(function (m) {
      //    var o = {
      //      m: m,
      //      v: scope.data.values.find(function (o) {
      //        return o.MeasurePointID == p.$id
      //          && o.AcceptanceIndexID == m.AcceptanceIndexID;
      //      })
      //    };
      //    o.v=o.v? o.v:{};
      //    scope.data.updates.push(o);
      //    if (m.IndexType == 'SelectMaterial') {
      //
      //    } else if (context.layer instanceof L.LineGroup || context.layer instanceof L.AreaGroup) {
      //      //o.v.children = [];
      //      group = o;
      //      o.v.children = xhUtils.findAll(scope.data.values, function (v) {
      //        return v.ParentMeasureValueID == o.v._id;
      //      });
      //    }
      //    else {
      //      switch (m.QSKey) {
      //        case '1':
      //        case '4':
      //          mutiEdit.push(o);
      //          break;
      //        case '2':
      //          sjzEdit.push(o);
      //          break;
      //        case '3':
      //          groupEdit.push(o);
      //          break;
      //        case '5':
      //          floorEdit.push(o)
      //          break;
      //      }
      //    }
      //  });
      //  if (mutiEdit.length == 1) {
      //    singleEdit = mutiEdit;
      //    mutiEdit = [];
      //  }
      //  scope.edit ={
      //    plasterDepth:sjzEdit.find(function (item) {
      //      return !!item.m.plasterDepth
      //    }),
      //    singleEdit:singleEdit,
      //    mutiEdit:mutiEdit,
      //    floorEdit:floorEdit,
      //    sjzEdit:sjzEdit,
      //    materEidt:materEidt,
      //    group:group,
      //    groupEdit:groupEdit
      //  }
      //  if(scope.PointType=='LineGroup' || scope.PointType=='AreaGroup') {
      //    var ps = [];
      //    context.featureGroup.eachLayer(function (layer) {
      //      if (layer._value && layer._value.$groupId == scope.value.$id) {
      //        ps.push(layer._value);
      //      }
      //      scope.values = ps;
      //    });
      //  }
      //  $timeout(function(){scope.ct.show && scope.ct.show();},300);
      //  scope.$apply();
      //};
      //scope.getCalculatedValue = function (item) {
      //  if( (item.v.DesignValue || item.v.DesignValue==0) &&( item.v.MeasureValue||item.v.MeasureValue==0)){
      //    if(item.m.plasterDepth){
      //      item.v.CalculatedValue = parseInt(item.v.MeasureValue)+(2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth)) - item.v.DesignValue;
      //    }
      //    else {
      //      item.v.CalculatedValue = item.v.MeasureValue - item.v.DesignValue;
      //    }
      //  }
      //  else{
      //    item.v.CalculatedValue = null;
      //  }
      //  return item.v.CalculatedValue;
      //}
      //scope.onMeasureValueChange = function (v,item) {
      //  if(v.isDesignValueInput)return;
      //  $timeout(function () {
      //    if(v && v.MeasureValue){
      //      var str = v.MeasureValue.toString();
      //      if(str.length>1) {
      //        var sv = parseInt(v.MeasureValue);
      //        if(item.m.plasterDepth){
      //          sv+=2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth);
      //        }
      //        str = sv.toString();
      //        var xs = str.substr(str.length - 2, 2),
      //          n = parseInt(xs),
      //          l = str.substr(0,str.length-2);
      //        if(!isNaN(n)){
      //          if(n<25){
      //            v.DesignValue = l+'00';
      //          }
      //          else if(n<75){
      //            v.DesignValue = l+'50';
      //          }
      //          else{
      //            v.DesignValue = l.length?(parseInt(l)+1)*100:100;
      //          }
      //        }
      //        else{
      //          v.DesignValue='';
      //        }
      //      }
      //      else{
      //        v.DesignValue = 0;
      //      }
      //    }
      //    else{
      //      v.DesignValue= null;
      //    }
      //  },0);
      //
      //}
      //scope.onDesignValueToggle = function (v,item) {
      //  v.isDesignValueInput = true;
      //}
      //scope.distinct = function(array){
      //  if(!array || !array.forEach)return;
      //  var min=100000,max=-100000;
      //  array.forEach(function(item){
      //    if(item.MeasureValue) {
      //      if (item.MeasureValue < min)
      //        min = item.MeasureValue;
      //      if (item.MeasureValue > max)
      //        max = item.MeasureValue;
      //    }
      //    else {
      //      if (item < min)
      //        min = item;
      //      if (item > max)
      //        max = item;
      //    }
      //  })
      //  return max-min;
      //}
      //scope.distinct2 = function(){
      //  scope.distinct(Array.prototype.splice.call(arguments));
      //}
      scope.removeLayer = function(){
        scope.isSaveData = false;
        var layer = scope.context.layer;
        if(layer  instanceof L.AreaGroup){
          var $id=layer._value.$id;
          if ($id){
            var key,v;
            for (key in  layer._fg._layers){
              if( layer._fg._layers.hasOwnProperty(key)){
                v= layer._fg._layers[key];
                if (v._value.$groupId&&v._value.$groupId==$id){
                  layer._fg.removeLayer(v);
                }
              }
            }
          }
        }
        layer._fg.removeLayer(layer);

      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      mapPopupSerivce.set('mapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapPopup');
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function () {
  'use strict';

  sxtScStandar.$inject = ["$timeout", "mapPopupSerivce", "db", "sxt", "xhUtils", "pack", "remote", "utils", "$q", "api", "$rootScope"];
  angular
    .module('app.xhsc')
    .directive('sxtScStandar', sxtScStandar);

  /** @Inject */
  function sxtScStandar($timeout, mapPopupSerivce, db, sxt, xhUtils, pack, remote, utils, $q, api, $rootScope) {
    function now() {
      return new Date().toISOString();
    }

    return {
      scope: {
        acceptanceItem: '=',//实测项
        measureIndexes: '=', //实测指标
        drawing: '=',//图纸id
        readonly: '=',//只读
        tooltip: '=',
        projectId:"="
      },
      link: link
    }

    function link(scope, element, attr, ctrl) {
      var map, fg, toolbar;
      var install = function () {
        if (!scope.measureIndexes || !scope.measureIndexes.length){
          return;
        }
        if (!map) {
          map = new L.SXT.Project(element[0]);
        }
        if (fg)
          map._map.removeLayer(fg);

        if (scope.measureIndexes.find(function (o) {
            return o.completed;
          })){
          scope.model="completed";
        }else {
          scope.model="no";
        }

        // if (toolbar)
        //   map._map.removeControl(toolbar);
        //渲染几何点
        function historydata(layer, index) {
          //var layer = layer;
          if (layer && layer.loaded)return;
          layer.loaded = true;
          remote.PQMeasureStandard.GetListByWhere(scope.drawing.data.DrawingID).then(function (req) {
            //图纸
            $timeout(function () {
              if (scope.drawing && scope.drawing.data && scope.drawing.data.DrawingContent) {
                map.loadSvgXml(scope.drawing.data.DrawingContent, {
                  filterLine: function (line) {
                    line.attrs.stroke = 'black';
                    line.options = line.options || {};
                    line.attrs['stroke-width'] = line.attrs['stroke-width'] * 6;
                  }
                });
                map.center();
                scope.tooltip = '';
              }
              else {
                utils.alert('未找到图纸,请与管理员联系!');
                scope.ct && (scope.ct.loading = false);
              }
            },300);
            var t = req.data ?req.data : [];
            var points = [];
            // t.forEach(function (o) {
            //   if (!points.find(function (k) {
            //       return  k.MeasurePointID == o.MeasurePointID;
            //     })) {
            //     points.push(o)
            //   }
            // });
            var po;

            function addData(layData, index, color) {
              if (!layData.geometry && layData.Geometry) {
                layData.geometry = JSON.parse(layData.Geometry);
              }
              if (!layData.geometry) return;
              layData.geometry.options = {
                color: color,
                v: index,
                seq: layData.geometry.properties.seq,
                customSeq: true,
                move: false
              }
              layer.addData(layData.geometry);
            }

            function find(index,source) {
              if (source){
                if (source.find(function (n) {
                    return n.AcceptanceIndexID==index.AcceptanceIndexID;
                  })){
                  return true;
                }else {
                  for (var i=0;i<source.length;i++){
                    if (find(index,source[i].Children)){
                      return true;
                    }
                  }
                  return false;
                }
              }else {
                return false;
              }
            }
            if (t && t.length) {
              var g;
              if (scope.drawing && scope.drawing.data) {
                t.forEach(function (m) {
                  if (m.DrawingID == scope.drawing.data.DrawingID && find(m,scope.measureIndexes)&&!points.find(function (n) {
                      return n.MeasurePointID==m.MeasurePointID;
                    })) {
                    points.push(m);
                    var color = "green"
                    addData(m, index, color);
                    index++;
                  }
                });
              }
            }
          });
        }

        fg = new L.SvFeatureGroup({
          onLoad: function () {
            settoolbar(this);
            var index = 0;
            historydata(this, index);
          },
          onUpdate: function (layer, isNew, group) {
            //这里是修正用户点的位置,尽可能在最近点的同一水平或竖直线上
            if (layer instanceof L.Stamp) {
              var neaser = null,
                p0 = layer.getLatLng();
              layer._fg.eachLayer(function (ly) {
                if (ly != layer && ly instanceof L.Stamp) {
                  if (!neaser ||
                    Math.pow(neaser._latlng.lat - p0.lat, 2) + Math.pow(neaser._latlng.lng - p0.lng, 2) >
                    Math.pow(ly._latlng.lat - p0.lat, 2) + Math.pow(ly._latlng.lat - p0.lat, 2)) {
                    neaser = ly;
                  }
                }
              });
              if (neaser) {
                var p1 = neaser.getLatLng(),
                  point0 = neaser._map.latLngToLayerPoint(p0),
                  point1 = neaser._map.latLngToLayerPoint(p1),
                  radius = neaser._radius,
                  dx = Math.abs(point0.x - point1.x),
                  dy = Math.abs(point0.y - point1.y),
                  min = Math.min(dx, dy);
                if (min < radius) {
                  if (dx < dy) {
                    p0.lng = p1.lng;
                  }
                  else {
                    p0.lat = p1.lat;
                  }
                  layer.setLatLng(p0);
                }
              }
            }
            var point = layer.toGeoJSON();

            point = {
              _id: point.properties.$id,
              geometry: point
            };
            var arr = []
            scope.measureIndexes.forEach(function (m) {
              var ms = [];
              if (m.Children && m.Children.length) {
                m.Children.forEach(function (m1) {
                  ms.push(m1);
                });
              }
              else {
                ms.push(m);
              }

              ms.forEach(function (m) {
                //实测标准化
                arr.push({
                  AcceptanceIndexID: m.AcceptanceIndexID,
                  AcceptanceItemID: scope.acceptanceItem,
                  DrawingID: scope.drawing.data.DrawingID,
                  MeasurePointID: point._id,
                  Extend:scope.projectId
                });
              });
            })
            remote.PQMeasureStandard.UpdatePoint_tran({
              MeasurePointID: point._id,
              Geometry: JSON.stringify(point.geometry)
            }, arr).catch(function () {
              utils.alert("由于网络或者后台服务异常，导致更新或插入失败！", null, function () {
                $timeout(function () {
                  install()
                }, 300)
              });
            });

            //如果是画区域,而区域内没有点的话,默认生成9点或5个点
            if (isNew && layer instanceof L.AreaGroup) {
              var p = null, b = layer.getBounds();
              fg.eachLayer(function (ly) {
                if (p === null && ly instanceof L.Stamp) {
                  if (L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat, ly._latlng.lat)
                    && L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng, ly._latlng.lng)) {
                    p = ly;
                  }
                }
              });
              if (p == null) {
                var b = layer.getBounds(),
                  x1 = b._northEast.lat,
                  y1 = b._northEast.lng,
                  x2 = b._southWest.lat,
                  y2 = b._southWest.lng;
                var ps = [], ps1 = [];
                var offsetX = Math.abs(x2 - x1) / 8,
                  minX = Math.min(x2, x1),
                  offsetY = Math.abs(y2 - y1) / 8,
                  minY = Math.min(y2, y2);
                for (var i = 1; i <= 3; i++) {
                  for (var j = 1; j <= 3; j++) {
                    ps.push([minX + offsetX * (i == 1 ? 1 : i == 2 ? 4 : 7), minY + offsetY * (j == 1 ? 1 : j == 2 ? 4 : 7)]);
                  }
                }
                ps1[0] = ps[0];
                ps1[1] = ps[1];
                ps1[2] = ps[2];
                ps1[3] = ps[5];
                ps1[4] = ps[8];
                ps1[5] = ps[7];
                ps1[6] = ps[6];
                ps1[7] = ps[3];
                ps1[8] = ps[4];
                if (!scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '9'
                  }) && scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '5';
                  })) {
                  ps1.splice(7, 1);
                  ps1.splice(5, 1);
                  ps1.splice(3, 1);
                  ps1.splice(1, 1);
                }
                ps1.forEach(function (p) {
                  fg.addLayer(new L.Stamp(p), false);
                });
              }
            }
          },
          onPopupClose: function (e) {

          },
          onUpdateData: function (context, updates, editScope) {

          },
          onDelete: function (layer) {
            var id = layer.getValue().$id;
            remote.PQMeasureStandard.DeletePoin(id).catch(function () {
              utils.alert("由于网络或者后台服务异常，导致更新或插入失败！", null, function () {
                $timeout(function () {
                  install()
                }, 300)
              });
            });
          },
          onPopup: function (e) {
            if (scope.model=="completed"){
              return false;
            }
            if (e.layer instanceof L.Stamp
              || e.layer instanceof L.AreaGroup
              || e.layer instanceof L.LineGroup)
              var edit = mapPopupSerivce.get('mapPopup');
            if (edit) {
              if (e.layer instanceof L.Stamp) {
                $timeout(function () {
                  var center = fg._map.getCenter();
                  fg._map.setView([center.lat, e.layer._latlng.lng]);
                }, 300);
              }
              ;
              edit.scope.context = e;

              edit.scope.data = {
                measureIndexes: scope.measureIndexes,
                regionId: scope.regionId,
                regionType: scope.regionType,
                acceptanceItem: scope.acceptanceItem,
                values: fg.data ? fg.data : []
              };

              edit.scope.readonly = scope.readonly;
              return edit.el[0];
            }
          }
        }).addTo(map._map);

        function  settoolbar(fg) {
          if (toolbar){
            map._map.removeControl(toolbar);
            toolbar=null;
          }
          if (scope.model=="no"){
            toolbar = new L.Control.Draw({
              featureGroup: fg,
              group: {
                lineGroup: false,
                areaGroup: scope.measureIndexes.length && !!scope.measureIndexes.find(function (m) {
                  return m.QSKey == '4'
                })
              }
            }).addTo(map._map);
          }
        }

        // toolbar = new L.Control.Draw({
        //   featureGroup: fg,
        //   group: {
        //     lineGroup: false,
        //     areaGroup: scope.measureIndexes.length && !!scope.measureIndexes.find(function (m) {
        //       return m.QSKey == '4'
        //     })
        //   }
        // }).addTo(map._map);
      }

      $timeout(function () {
        scope.$watchCollection('measureIndexes', function () {
          install();
        }, true);
      }, 500);
    }
  }
})();

/**
 * Created by shaoshun on 2017/3/2.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  safeSelfAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('safeSelfAcceptPopup',safeSelfAcceptPopup);
  /** @ngInject */
  function safeSelfAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_self/safeSelfAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        if (scope.data.v){
          scope.status=scope.data.v.Status==1?false:true;
        }
        scope.$apply();
        remote.self.safe.problemRecordQuery(scope.data.v.Id).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            var Id=sxt.uuid();
            p = {
              Id:Id,
              inspectionId:scope.inspectionId,
              ProblemRecordID: Id,
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'zb'
            };
            remote.self.safe.problemRecordCreate(p);
          }
          scope.data.p = p;
          remote.self.safe.problemRecordFileQuery(p.Id).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };
      scope.onChange=function (status) {
       if (status){
         scope.data.v.Status=2;
       }else {
         scope.data.v.Status=1;
       }
        scope.context.fg.updateStatus(scope.data.v.PositionID,scope.data.v.Status);
        remote.self.safe.pointCreate(scope.data.v);
      }

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var Id=sxt.uuid();
            var img = {
              Id:Id,
              inspectionId:scope.inspectionId,
              ProblemRecordFileID:Id,
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            remote.self.safe.problemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('safeSelfAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('safeSelfAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  safeSelfAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "$q"];
  angular
    .module('app.xhsc')
    .directive('safeSelfAccept',safeSelfAccept);
  /** @ngInject */
  function safeSelfAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils,$q) {
    return {
      scope:{
        item:'=safeSelfAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        imgId:"=",
        ct:'=',
        disableInspect:'@',
        disableDrag:'@',
        gx:"="
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;

      function loadingPic(regionId,gx) {
       return  $q(function (resolve,reject) {
         scope.asy=true;
          var imgId="";
          if(scope.regionId){
            var areaID=scope.regionId.substr(0,10);
            remote.safe.getDrawingRelate.cfgSet({
              offline: true
            })("Acceptances",areaID).then(function (result) {
              imgId = result.data.find(function (item) {
                return item.AcceptanceItemID==scope.procedure && item.RegionId ==scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId){
                imgId=imgId.DrawingID;
              }
              resolve(imgId);
            }).catch(function () {
              resolve(imgId);
            })
          }
        })
      }

      var install =function () {
        loadingPic().then(function (imgId) {
          scope.identity=0;
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                remote.self.safe.pointQuery.cfgSet({
                  filter:function (item){
                    return item.RegionID==scope.regionId&&item.AcceptanceItemID==scope.procedure;
                  }
                })().then(function (r) {
                  remote.Procedure.InspectionPoint.query().then(function (r1) {
                    fg.data = r.data,fs=[];
                    r.data.forEach(function (c) {
                      var p = r1.data.find(function (p1) {
                        return p1.MeasurePointID == c.PositionID;
                      });
                      if (p && p) {
                        if(p.Geometry){
                          p.geometry = $window.JSON.parse(p.Geometry);
                        }else{
                          p.geometry = p.geometry;
                        }
                        if(p.geometry && p.geometry.properties) {
                          if ($.isNumeric(c.ProblemSortName)){
                            var  t=parseInt(c.ProblemSortName);
                            scope.identity=scope.identity<t?t:scope.identity;
                          }
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      }
                    });
                    scope.item = null;
                    fg.addData(fs,false);
                    cb();
                    scope.ct && (scope.ct.loading = false);
                  })
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
                if(isNew){
                  layer.properties.seq = scope.item.ProblemSortName;
                  layer.properties.seq =++scope.identity;
                  layer.properties.Status = scope.item.ProblemID?1:2;
                }
                var point = {
                  MeasurePointID:layer.properties.$id,
                  geometry:layer
                };
                remote.Procedure.InspectionPoint.create(point);
                if(isNew || !fg.data.find(function (d) {
                    return d.PositionID == point.MeasurePointID;
                  })) {
                  var Id=sxt.uuid();
                  var v = {
                    Id:Id,
                    Drawing:scope.imgId,
                    InspectionID:scope.inspectionId,
                    CheckpointID:Id,
                    IndexPointID:scope.item.ProblemID,
                    RegionID:scope.regionId,
                    AcceptanceItemID:scope.procedure,
                    PositionID:point.MeasurePointID,
                    MeasureValue:0,
                    Status:1,
                    ProblemSortName:layer.properties.seq,
                    ProblemDescription:scope.item.ProblemDescription,
                    isNew:true
                  }
                  if(!v.IndexPointID){
                    v.Status = 2;
                    point.geometry.properties.Status = 2;
                  }
                  fg.data.push(v);
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  remote.self.safe.pointCreate(v);

                }
                cb(layer);
              },
              onPopupClose: function (cb) {
                var self = this;
                var edit = mapPopupSerivce.get('safeSelfAcceptPopup'),
                  scope = edit.scope;
                if(scope.data && scope.isSaveData!==false){
                  scope.isSaveData = false;
                  self.options.onUpdateData(scope.context,scope.data,scope);
                }
                cb();
              },
              onUpdateData: function (context, data, editScope) {
                if(data.v.ProblemSortName == 'T'){
                  remote.self.safe.pointCreate(data.v);
                }
              },
              onDelete: function (layer,cb) {
                var id = layer.properties.$id;
                //删除几何点
                remote.Procedure.InspectionPoint.delete({MeasurePointID:id}).then(function (r) {
                  var v = fg.data.find(function (d) {
                    return d.PositionID == id;
                  }),ix = fg.data.indexOf(v);
                  fg.data.splice(ix,1);
                  //删除检查点
                  remote.self.safe.pointDelete({CheckpointID:v.CheckpointID}).then(function () {
                    //删除记录
                    remote.self.safe.problemRecordQuery(v.CheckpointID).then(function (k) {
                      if (angular.isArray(k.data)){
                        k.data.forEach(function (w) {
                          //删除照片
                          remote.self.safe.problemRecordDelete(w).then(function () {
                            remote.self.safe.problemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                              if (angular.isArray(m.data)){
                                m.data.forEach(function (q) {
                                  remote.self.safe.problemRecordFileDelete(q);
                                })
                              }
                            })
                          })
                        });
                      }
                    })
                  });
                });
                cb(layer);
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('safeSelfAcceptPopup');
                if(edit) {
                  edit.scope.context = {
                    fg:fg,
                    layer:layer
                  };
                  edit.scope.inspectionId=scope.inspectionId;
                  edit.scope.data = {
                    item:scope.item,
                    procedure:scope.procedure,
                    regionId:scope.regionId,
                    v:fg.data.find(function (d) {
                      return d.PositionID == layer.properties.$id;
                    })
                  };
                  edit.scope.readonly = scope.readonly;
                  edit.scope.apply && edit.scope.apply();
                  cb(edit.el[0]);
                }
              }
            });
            $timeout(function () {
              if (imgId){
                remote.Project.getDrawing(imgId).then(function (result2) {
                  scope.asy=false;
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                }).catch(function () {
                  scope.asy=false;
                })
              }else {
                scope.asy=false;
                utils.alert('未找到图纸,请与管理员联系!');
              }
            });
          }
        })
      };

      // scope.$watch('procedure', function () {
      //   if(!scope.asy&&scope.regionId&&scope.procedure) {
      //     if(map){
      //       map.remove();
      //       fg=map = null;
      //     }
      //     install();
      //   }
      // });

      scope.$watch('regionId', function () {
        if(!scope.asy&&scope.regionId&&scope.procedure) {
          if(map){
            map.remove();
            fg=map = null;
          }
          install();
        }
      });

      scope.$watch('item',function () {
        if(fg) {
          if (scope.item) {
            fg.changeMode('inspect',scope.item);
          }
          else {
            fg.changeMode();
          }
        }
      })

      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  safeItemSelet.$inject = ["remote"];
  angular
    .module('app.xhsc')
    .directive('safeItemSelet',safeItemSelet);
  /** @ngInject */
  function safeItemSelet(remote){
    return {
      restrict:'E',
      scope:{
        model:'=',
        selected:'='
      },
      templateUrl:'app/main/xhsc/directive/safe_self/safe-item-select.html',
      link:link
    }
    function link(scope,element,attr,ctrl){
      switch (scope.model){
        case "single":
          scope.model="single";
          scope.singleVal=null;
          break;
        case "multil":
          scope.model="multil"
      }
      scope.selected=[];
      remote.safe.getSecurityItem().then(function(result){
        scope.data=result.data;
        scope.data.sort(function(a,b){
          return a.SpecialtyName.localeCompare(b.SpecialtyName);
        });
        scope.data.forEach(function (k) {
          if (k.SpecialtyChildren){
            k.SpecialtyChildren.forEach(function (q) {
                if (q.WPAcceptanceList){
                  q.WPAcceptanceList.forEach(function (m) {
                    m.checked=true;
                    scope.selected.push(m);
                  })
                }
            })

          }
        });
        scope.show=true;
      })
      scope.showTab=function(item){
        if (!item.SpecialtyChildren||!item.SpecialtyChildren.length){
          return false;
        }
        var gx= item.SpecialtyChildren;
        for (var  i=0;i<gx.length;i++){
          if (gx[i].WPAcceptanceList&&gx[i].WPAcceptanceList.length){
            return true;
          }
        }
        return false;
      }

      scope.checked=function (item) {
         if(!item.checked){
           if (!scope.selected.find(function (o) {
               return o.AcceptanceItemID==item.AcceptanceItemID;
             })){
             scope.selected.push(item);
           }
         }else {
           var obj= scope.selected.find(function (o) {
             return o.AcceptanceItemID==item.AcceptanceItemID;
           })
           if (obj!=null){
             var  index=scope.selected.indexOf(obj);

             scope.selected.splice (index,1);
           }
         }
      }
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtWeekRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtWeekRecheckPopup',sxtWeekRecheckPopup);
  /** @ngInject */
  function sxtWeekRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtWeekRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.safe.weekproblemRecordQuery(scope.data.value.CheckpointID).then(function(r){
          scope.images={
            zb:[],
            jl:[]
          }

          r.data.forEach(function (p) {
            remote.safe.weekProblemRecordFileQuery(p.ProblemRecordID).then(function (r2) {
              if (p.DescRole=="jl"){
                scope.images.jl=scope.images.jl.concat(r2.data)
              }else{
                scope.images.zb=scope.images.zb.concat(r2.data);
              }
            });
          });

          var zb=r.data.find(function (p) {
            return p.DescRole=='zb'&&p.Remark
          })
          if (!zb){
            zb=r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          }

          var jl=r.data.find(function (p) {
            return p.DescRole=='jl'&&p.Remark
          })
          if (!jl){
            jl=r.data.find(function (p) {
              return p.DescRole=='jl'
            })
          }


          scope.Record = {
            jl:jl,
            zb:zb
          };

          if(!scope.Record.jl){
            scope.Record.jl = {
              CheckpointID:scope.data.value.CheckpointID,
              Describe:'',
              DescRole:"jl",
              Remark:''
            };
          }
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              Describe:'',
              DescRole:"zb",
              Remark:''
            };
          }
        })

        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }

      function createZb(update) {
        return $q(function (resolve,reject) {
          var rec="";
          remote.safe.weekproblemRecordQuery.cfgSet({
            filter: function (item, CheckpointID) {
              var t=item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="zb";
              if (t){
                rec=rec?rec:item.RectificationID;
              }
              return t;
            },
          })(scope.data.value.CheckpointID).then(function (r) {
            if (!r||!r.data||!r.data.length){
              // scope.Record.zb.ProblemRecordID = sxt.uuid()
              var rec={
                CheckpointID:scope.data.value.CheckpointID,
                RectificationID:rec,
                Describe:scope.Record.zb.Remark,
                DescRole:"zb",
                Remark:scope.Record.zb.Remark
              };
              rec.ProblemRecordID = sxt.uuid();
              rec._id=rec.ProblemRecordID;
              remote.safe.weekproblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }else {
              var rec=r.data[0];
              rec.Describe=rec.Remark=scope.Record.zb.Remark;
              rec.Remark=rec.Remark=scope.Record.zb.Remark;
              rec.DescRole="zb";
              remote.safe.weekproblemRecordCreate(rec).then(function () {

                resolve(rec);
              })
            }

          });
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function (res) {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:res.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.safe.weekProblemRecordFileCreate(img).then(function () {
                // var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                scope.images.zb=scope.images.zb.concat([img]);
              })

            })
            scope.data.value.Status = 16;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }
      scope.submit = function(){
        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }
        if(scope.role=='zb'){
          if(convert(scope.data.value.Status)==8 &&(!scope.images.zb || scope.images.zb.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.safe.weekPointCreate(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.safe.weekPointCreate(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
          }).then(function () {
            var rec="";
            remote.safe.weekproblemRecordQuery.cfgSet({
              filter: function (item, CheckpointID) {
                var t=item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="jl";
                if (t){
                  rec=rec?rec:item.RectificationID;
                }
                return t;
              },
            })(scope.data.value.CheckpointID).then(function (r) {
              if (!r||!r.data||!r.data.length){
                var rec={
                  CheckpointID:scope.data.value.CheckpointID,
                  RectificationID:rec,
                  Describe:'',
                  DescRole:"jl",
                  Remark:''
                };
                rec.ProblemRecordID = sxt.uuid();
                rec._id=rec.ProblemRecordID;
                remote.safe.weekproblemRecordCreate(rec)
              }else {
                var rec=r.data[0];
                // rec.Describe=rec.Remark=scope.Record.zb.Remark;
                rec.DescRole="jl";
                remote.safe.weekproblemRecordCreate(rec);
              }
            });
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('weekRecheckPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('weekRecheckPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtWeekRecheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('sxtWeekRecheck',sxtWeekRecheck);
  /** @ngInject */
  function sxtWeekRecheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils,api) {
    return {
      scope:{
        item:'=sxtSafeRecheck',
        sxtMapShow:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        points:"=",
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.ct && (scope.ct.loading = true);
        var map,fg;

        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }

        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                $("#inspect").css("display","none");
                $q.all([
                  remote.safe.weekPointQuery.cfgSet({
                    filter:function (item,inspectionId) {
                      return  item.AreaID==scope.regionId&&item.InspectionExtendID==inspectionId;
                    }
                  })(scope.inspectionId),
                  remote.safe.weekGetSafePointGeo()
                ]).then(function (res) {
                  var fs = [];
                  fg.data = res[0].data;
                  res[0].data.forEach(function (item) {
                    var p = res[1].data.find(function (pt) {
                      return pt.MeasurePointID == item.PositionID;
                    });
                    if (p && p.Geometry) {
                      var geo = $window.JSON.parse(p.Geometry);
                      if(geo && geo.geometry) {
                        if (geo.geometry.type == 'Stamp')
                          geo.geometry.type = 'Point';
                        geo.properties.Status = item.Status;
                        geo.properties.v = item;
                        geo.properties.seq = item.ProblemSortName;
                        fs.push(geo);
                      }
                    }
                  })
                  fg.addData(fs, false);
                  scope.points=fg.data;
                  cb();
                  fs.forEach(function (t) {
                    fg.updateStatus(t.properties.v.PositionID,convert(t.properties.Status))
                  })
                  scope.ct && (scope.ct.loading = false);
                })

              },
              onUpdate: function (layer, isNew, group,cb) {
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('weekRecheckPopup');
                if (edit) {
                  scope.sxtMapShow = true;
                  edit.scope.context = fg;
                  edit.scope.data = {
                    value: layer.properties.v
                  }
                  edit.scope.apply && edit.scope.apply();
                }
              }
            });
            $timeout(function () {
              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("WeekInspects",scope.regionId).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.Type==7&& item.RegionId == scope.regionId;
                });
                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.Type==13&&item.RegionId == scope.regionId;
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    btn.click(function () {
                      var mapList = [];
                      result.data.forEach(function (item) {
                        if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                            return f.DrawingID==item.DrawingID
                          })){
                          mapList.push(item);
                        }
                      });

                      xhUtils.openLinks(mapList);
                    });
                    element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                    //scope.ct && (scope.ct.loading = false);
                  })
                }
                else {
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })

    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtWeekAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('sxtWeekAcceptPopup',sxtWeekAcceptPopup);
  /** @ngInject */
  function sxtWeekAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtWeekAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.safe.weekproblemRecordQuery(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            p.action="Insert";
            remote.safe.weekproblemRecordCreate(p);
          }
          scope.data.p = p;
          remote.safe.weekProblemRecordFileQuery(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            img.action="Insert";
            remote.safe.weekProblemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('weekAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('weekAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtWeekAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('sxtWeekAccept',sxtWeekAccept);
  /** @ngInject */
  function sxtWeekAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils,api) {
    return {
      scope:{
        item:'=sxtWeekAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        ct:'=',
        disableInspect:'@',
        disableDrag:'@'
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.identity=0;
        scope.ct && (scope.ct.loading = true);
        var map,fg;
        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                remote.safe.weekPointQuery.cfgSet({
                  filter:function (item,AcceptanceItemID,AreaID,inspectionId){
                    return item.AreaID==AreaID&&item.InspectionExtendID==inspectionId;
                  }
                })(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                  remote.safe.weekPointGeoQuery(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                    fg.data = r.data,fs=[];
                    r.data.forEach(function (c) {
                      var p = r1.data.find(function (p1) {
                        return p1.MeasurePointID == c.PositionID;
                      });
                      if (p && p) {
                        if(p.Geometry){
                          p.geometry = $window.JSON.parse(p.Geometry);
                        }else{
                          p.geometry = p.geometry;
                        }
                        if(p.geometry && p.geometry.properties) {
                          if ($.isNumeric(c.ProblemSortName)){
                            var  t=parseInt(c.ProblemSortName);
                            scope.identity=scope.identity<t?t:scope.identity;
                          }
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      }
                    });
                    scope.item = null;
                    fg.addData(fs,false);
                    cb();
                    scope.ct && (scope.ct.loading = false);
                  })
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
                if(isNew){
                  layer.properties.seq =++scope.identity;
                  layer.properties.Status = scope.item.ProblemID?1:2;
                }
                var point = {
                  MeasurePointID:layer.properties.$id,
                  geometry:layer
                };
                remote.safe.weekPointGeoCreate(point);
                if(isNew || !fg.data.find(function (d) {
                    return d.PositionID == point.MeasurePointID;
                  })) {
                  var v = {
                    // InspectionID:scope.inspectionId,
                    // InspectionAreaID:scope.inspectionAreaId,
                    InspectionExtendID:scope.inspectionId,
                    CheckpointID:sxt.uuid(),
                    IndexPointID:scope.item.ProblemID,
                    AreaID:scope.regionId,
                    AcceptanceItemID:scope.procedure,
                    PositionID:point.MeasurePointID,
                    MeasureValue:0,
                    Status:1,
                    ProblemSortName:layer.properties.seq,
                    ProblemDescription:scope.item.ProblemDescription,
                    isNew:true
                  }
                  if(!v.IndexPointID){
                    v.Status = 2;
                    point.geometry.properties.Status = 2;
                  }
                  v.action="Insert";
                  fg.data.push(v);
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  remote.safe.weekPointCreate(v);

                }
                cb(layer);
              },
              onPopupClose: function (cb) {
                var self = this;
                var edit = mapPopupSerivce.get('weekAcceptPopup'),
                  scope = edit.scope;
                if(scope.data && scope.isSaveData!==false){
                  scope.isSaveData = false;
                  self.options.onUpdateData(scope.context,scope.data,scope);
                }
                cb();
              },
              onUpdateData: function (context, data, editScope) {
                if(data.v.ProblemSortName == 'T'){
                  data.v.action="Insert";
                  remote.safe.weekPointCreate(data.v);
                }
              },
              onDelete: function (layer,cb) {
                var id = layer.properties.$id;
                //删除几何点
                remote.safe.weekpointGeoDelete({MeasurePointID:id}).then(function (r) {
                  var v = fg.data.find(function (d) {
                    return d.PositionID == id;
                  }),ix = fg.data.indexOf(v);
                  fg.data.splice(ix,1);
                  //删除检查点
                  remote.safe.weekPointDelete({CheckpointID:v.CheckpointID}).then(function () {
                    //删除记录
                    remote.safe.weekproblemRecordQuery(v.CheckpointID).then(function (k) {
                      if (angular.isArray(k.data)){
                        k.data.forEach(function (w) {
                          //删除照片
                          remote.safe.weekproblemRecordDelete(w).then(function () {
                            remote.safe.weekProblemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                              if (angular.isArray(m.data)){
                                m.data.forEach(function (q) {
                                  remote.safe.weekProblemRecordFileDelete(q);
                                })
                              }
                            })
                          })
                        });

                      }
                    })
                  });
                });
                cb(layer);
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('weekAcceptPopup');
                if(edit) {
                  edit.scope.context = {
                    fg:fg,
                    layer:layer
                  };
                  edit.scope.data = {
                    item:scope.item,
                    procedure:scope.procedure,
                    regionId:scope.regionId,
                    v:fg.data.find(function (d) {
                      return d.PositionID == layer.properties.$id;
                    })
                  };
                  edit.scope.readonly = scope.readonly;
                  edit.scope.apply && edit.scope.apply();
                  cb(edit.el[0]);
                }
              }
            });
            $timeout(function () {
              var areaID=scope.regionId.substr(0,10);
              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("WeekInspects",areaID).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.Type==7&& item.RegionId == scope.regionId;
                });
                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.Type==13&&item.RegionId == scope.regionId;
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    // var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    // btn.click(function () {
                    //   var mapList = [];
                    //   result.data.forEach(function (item) {
                    //     if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                    //         return f.DrawingID==item.DrawingID
                    //       })){
                    //       mapList.push(item);
                    //     }
                    //   });
                    //
                    //   xhUtils.openLinks(mapList);
                    // });
                    // element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                  }).catch(function () {
                  })
                }
                else{
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              }).catch(function () {
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId && scope.procedure) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })

    }
  }
})();

/**
 * Created by shaoshun on 2016/11/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtSafeRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtSafeRecheckPopup',sxtSafeRecheckPopup);
  /** @ngInject */
  function sxtSafeRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtSafeRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.safe.problemRecordQuery(scope.data.value.CheckpointID).then(function(r){
           scope.images={
            zb:[],
            jl:[]
          }

          r.data.forEach(function (p) {
            remote.safe.ProblemRecordFileQuery(p.ProblemRecordID).then(function (r2) {
              if (p.DescRole=="jl"){
                scope.images.jl=scope.images.jl.concat(r2.data)
              }else{
                scope.images.zb=scope.images.zb.concat(r2.data);
              }
            });
          });


          var zb=r.data.find(function (p) {
            return p.DescRole=='zb'&&p.Remark
          })
          if (!zb){
            zb=r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          }

          var jl=r.data.find(function (p) {
            return p.DescRole=='jl'&&p.Remark
          })

          if (!jl){
            jl=r.data.find(function (p) {
              return p.DescRole=='jl'
            })
          }

          scope.Record = {
            jl:jl,
            zb:zb
          };



          if(!scope.Record.jl){
            scope.Record.jl = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"jl",
              Remark:''
            };
          }
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"zb",
              Remark:''
            };
          }
        })

        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }

      function createZb(update) {
        return $q(function (resolve,reject) {
          remote.safe.problemRecordQuery.cfgSet({
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="zb";
            },
          })(scope.data.value.CheckpointID).then(function (r) {
            if (!r||!r.data||!r.data.length){
              // scope.Record.zb.ProblemRecordID = sxt.uuid()
              var rec={
                CheckpointID:scope.data.value.CheckpointID,
                RectificationID:scope.data.item,
                Describe:'',
                DescRole:"zb",
                Remark:''
              };
              rec.ProblemRecordID = sxt.uuid();
              rec._id=rec.ProblemRecordID;
              remote.safe.problemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }else {
              var rec=r.data[0];
              rec.Describe=rec.Remark=scope.Record.zb.Remark;
              rec.Remark=rec.Remark=scope.Record.zb.Remark;
              rec.DescRole="zb";
              remote.safe.problemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }


          });
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function (res) {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:res.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.safe.ProblemRecordFileCreate(img).then(function () {
                // var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                scope.images.zb=scope.images.zb.concat([img]);
              })

            })
            scope.data.value.Status = 16;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }
      scope.submit = function(){
        function convert(status) {
          switch (status){
            case 8:
            case 4:
                  return 1;
            case 16:
                  return 8;
          }
          return status;
        }
        if(scope.role=='zb'){
          if(convert(scope.data.value.Status)==8 &&(!scope.images.zb || scope.images.zb.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.safe.ckPointCreate(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.safe.ckPointCreate(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
          }).then(function () {
            remote.safe.problemRecordQuery.cfgSet({
              filter: function (item, CheckpointID) {
                return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="jl";
              },
            })(scope.data.value.CheckpointID).then(function (r) {
              if (!r||!r.data||!r.data.length){
                var rec={
                  CheckpointID:scope.data.value.CheckpointID,
                  RectificationID:scope.data.item,
                  Describe:'',
                  DescRole:"jl",
                  Remark:''
                };
                rec.ProblemRecordID = sxt.uuid();
                rec._id=rec.ProblemRecordID;
                remote.safe.problemRecordCreate(rec)
              }else {
                var rec=r.data[0];
                // rec.Describe=rec.Remark=scope.Record.zb.Remark;
                rec.DescRole="jl";
                remote.safe.problemRecordCreate(rec);
              }
            });
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('sxtSafeRecheckPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('sxtSafeRecheckPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtSafeRecheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('sxtSafeRecheck',sxtSafeRecheck);
  /** @ngInject */
  function sxtSafeRecheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils,api) {
    return {
      scope:{
        item:'=sxtSafeRecheck',
        sxtMapShow:'=',
        items:'=',
        procedure:'=',
        regionId:'=',
        points:"=",
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.ct && (scope.ct.loading = true);
        var map,fg;

        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }

        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                $("#inspect").css("display","none");
                $q.all([
                  remote.safe.ckPointQuery.cfgSet({
                    filter:function (item,inspectionId) {
                      return item.InspectionID==inspectionId&&scope.regionId==item.AreaID;
                    }
                  })(scope.inspectionId),
                  remote.safe.safePointGeo()
                ]).then(function (res) {
                  var fs = [];
                  fg.data = res[0].data;
                  res[0].data.forEach(function (item) {
                    var p = res[1].data.find(function (pt) {
                      return pt.MeasurePointID == item.PositionID;
                    });
                    if (p && p.Geometry) {
                      var geo = $window.JSON.parse(p.Geometry);
                      if(geo && geo.geometry) {
                        if (geo.geometry.type == 'Stamp')
                          geo.geometry.type = 'Point';
                        geo.properties.Status = item.Status;
                        geo.properties.v = item;
                        geo.properties.seq = item.ProblemSortName;
                        fs.push(geo);
                      }
                    }
                  })
                  scope.points=fg.data;
                  fg.addData(fs, false);
                  cb();
                  fs.forEach(function (t) {
                    fg.updateStatus(t.properties.v.PositionID,convert(t.properties.Status))
                  })
                  scope.ct && (scope.ct.loading = false);
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('sxtSafeRecheckPopup');
                if (edit) {
                  scope.sxtMapShow = true;
                  edit.scope.context = fg;
                  edit.scope.data = {
                    item: scope.item,
                    value: layer.properties.v
                  }
                  edit.scope.apply && edit.scope.apply();
                }
              }
            });
            $timeout(function () {
              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("Acceptances",scope.regionId).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
                });
                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.RegionId == scope.regionId;
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    btn.click(function () {
                      var mapList = [];
                      result.data.forEach(function (item) {
                        if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                            return f.DrawingID==item.DrawingID
                          })){
                          mapList.push(item);
                        }
                      });

                      xhUtils.openLinks(mapList);
                    });
                    element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                    //scope.ct && (scope.ct.loading = false);
                  })
                }
                else {
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId && scope.procedure) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })

    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtMapAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('sxtMapAcceptPopup',sxtMapAcceptPopup);
  /** @ngInject */
  function sxtMapAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtMapAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.safe.problemRecordQuery(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            p.action="Insert";
            remote.safe.problemRecordCreate(p);
          }
          scope.data.p = p;
          remote.safe.ProblemRecordFileQuery(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            img.action="Insert";
            remote.safe.ProblemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('mapAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtMapAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('sxtMapAccept',sxtMapAccept);
  /** @ngInject */
  function sxtMapAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils,api) {
    return {
      scope:{
        item:'=sxtMapAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        inspectionAreaId:"=",
        ct:'=',
        disableInspect:'@',
        disableDrag:'@'
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.ct && (scope.ct.loading = true);
        var map,fg;
        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                remote.safe.ckPointQuery.cfgSet({
                  filter:function (item,AcceptanceItemID,AreaID,inspectionId){
                    return item.AcceptanceItemID==AcceptanceItemID && item.AreaID==AreaID&&item.InspectionID==inspectionId;
                  }
                })(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                  remote.safe.pointGeoQuery(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                    fg.data = r.data,fs=[];
                    r.data.forEach(function (c) {
                      var p = r1.data.find(function (p1) {
                        return p1.MeasurePointID == c.PositionID;
                      });
                      if (p && p) {
                        if(p.Geometry){
                          p.geometry = $window.JSON.parse(p.Geometry);
                        }else{
                          p.geometry = p.geometry;
                        }
                        if(p.geometry && p.geometry.properties) {
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      }
                    });
                    scope.item = null;
                    fg.addData(fs,false);
                    cb();
                    scope.ct && (scope.ct.loading = false);
                  })
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
                if(isNew){
                  layer.properties.seq = scope.item.ProblemSortName;
                  layer.properties.Status = scope.item.ProblemID?1:2;
                }
                var point = {
                  MeasurePointID:layer.properties.$id,
                  geometry:layer
                };
                remote.safe.pointGeoCreate(point);
                if(isNew || !fg.data.find(function (d) {
                    return d.PositionID == point.MeasurePointID;
                  })) {
                  var v = {
                    InspectionID:scope.inspectionId,
                    InspectionAreaID:scope.inspectionAreaId,
                    CheckpointID:sxt.uuid(),
                    IndexPointID:scope.item.ProblemID,
                    AreaID:scope.regionId,
                    AcceptanceItemID:scope.procedure,
                    PositionID:point.MeasurePointID,
                    MeasureValue:0,
                    Status:1,
                    ProblemSortName:scope.item.ProblemSortName,
                    ProblemDescription:scope.item.ProblemDescription,
                    isNew:true
                  }
                  if(!v.IndexPointID){
                    v.Status = 2;
                    point.geometry.properties.Status = 2;
                  }
                  v.action="Insert";
                  fg.data.push(v);
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  remote.safe.ckPointCreate(v);

                }
                cb(layer);
              },
              onPopupClose: function (cb) {
                var self = this;
                var edit = mapPopupSerivce.get('mapAcceptPopup'),
                  scope = edit.scope;
                if(scope.data && scope.isSaveData!==false){
                  scope.isSaveData = false;
                  self.options.onUpdateData(scope.context,scope.data,scope);
                }
                cb();
              },
              onUpdateData: function (context, data, editScope) {
                if(data.v.ProblemSortName == 'T'){
                  data.v.action="Insert";
                  remote.safe.ckPointCreate(data.v);
                }
              },
              onDelete: function (layer,cb) {
                var id = layer.properties.$id;
                //删除几何点
                remote.safe.pointGeoDelete({MeasurePointID:id}).then(function (r) {
                  var v = fg.data.find(function (d) {
                    return d.PositionID == id;
                  }),ix = fg.data.indexOf(v);
                  fg.data.splice(ix,1);
                  //删除检查点
                  remote.safe.ckPointDelete({CheckpointID:v.CheckpointID}).then(function () {
                    //删除记录
                    remote.safe.problemRecordQuery(v.CheckpointID).then(function (k) {
                      if (angular.isArray(k.data)){
                        k.data.forEach(function (w) {
                          //删除照片
                          remote.safe.problemRecordDelete(w).then(function () {
                            remote.safe.ProblemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                              if (angular.isArray(m.data)){
                                m.data.forEach(function (q) {
                                  remote.safe.ProblemRecordFileDelete(q);
                                })
                              }
                            })
                          })
                        });

                      }
                    })
                  });
                });
                cb(layer);
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('mapAcceptPopup');
                if(edit) {
                  edit.scope.context = {
                    fg:fg,
                    layer:layer
                  };
                  edit.scope.data = {
                    item:scope.item,
                    procedure:scope.procedure,
                    regionId:scope.regionId,
                    v:fg.data.find(function (d) {
                      return d.PositionID == layer.properties.$id;
                    })
                  };
                  edit.scope.readonly = scope.readonly;
                  edit.scope.apply && edit.scope.apply();
                  cb(edit.el[0]);
                }
              }
            });
            $timeout(function () {

              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("Acceptances",scope.regionId).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
                });
                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.RegionId == scope.regionId;
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    btn.click(function () {
                      var mapList = [];
                      result.data.forEach(function (item) {
                        if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                            return f.DrawingID==item.DrawingID
                          })){
                          mapList.push(item);
                        }
                      });

                      xhUtils.openLinks(mapList);
                    });
                    element.find('.mapboxgl-ctrl-bottom-left').append(btn);

                  })
                }
                else{
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId && scope.procedure) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })

    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtDynamicRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtDynamicRecheckPopup',sxtDynamicRecheckPopup);
  /** @ngInject */
  function sxtDynamicRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtDynamicRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.safe.dynProblemRecordQuery(scope.data.value.CheckpointID).then(function(r){
          scope.images={
            zb:[],
            jl:[]
          }

          r.data.forEach(function (p) {
            remote.safe.dynProblemRecordFileQuery(p.ProblemRecordID).then(function (r2) {
              if (p.DescRole=="jl"){
                scope.images.jl=scope.images.jl.concat(r2.data)
              }else{
                scope.images.zb=scope.images.zb.concat(r2.data);
              }
            });
          });

          scope.Record = {
            jl:r.data.find(function (p) {
              return p.DescRole=='jl'
            }),
            zb:r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          };

          if(!scope.Record.jl){
            scope.Record.jl = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"jl",
              Remark:''
            };
          }
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:"zb",
              Remark:''
            };
          }
        })

        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }

      function createZb(update) {
        return $q(function (resolve,reject) {
          remote.safe.dynProblemRecordQuery.cfgSet({
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="zb";
            },
          })(scope.data.value.CheckpointID).then(function (r) {
            if (!r||!r.data||!r.data.length){
              // scope.Record.zb.ProblemRecordID = sxt.uuid()
              var rec={
                CheckpointID:scope.data.value.CheckpointID,
                RectificationID:scope.data.item,
                Describe:'',
                DescRole:"zb",
                Remark:''
              };
              rec.ProblemRecordID = sxt.uuid();
              rec._id=rec.ProblemRecordID;
              remote.safe.dynProblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }else {
              resolve(r.data[0]);
            }

          });
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function (res) {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:res.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.safe.dynProblemRecordFileCreate(img).then(function () {
                // var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                scope.images.zb=scope.images.zb.concat([img]);
              })

            })
            scope.data.value.Status = 8;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }
      scope.submit = function(){
        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }
        if(scope.role=='zb'){
          scope.data.value.Status = scope.data.value.Status==16?16:8;
          if(scope.data.value.Status==8 &&(!scope.Record.zb.images || scope.Record.zb.images.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.safe.dynPointCreate(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.safe.dynPointCreate(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
          }).then(function () {
            remote.safe.dynProblemRecordQuery.cfgSet({
              filter: function (item, CheckpointID) {
                return item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="jl";
              },
            })(scope.data.value.CheckpointID).then(function (r) {
              if (!r||!r.data||!r.data.length){
                var rec={
                  CheckpointID:scope.data.value.CheckpointID,
                  RectificationID:scope.data.item,
                  Describe:'',
                  DescRole:"jl",
                  Remark:''
                };
                rec.ProblemRecordID = sxt.uuid();
                rec._id=rec.ProblemRecordID;
                remote.safe.dynProblemRecordCreate(rec)
              }
            });
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('dynamicRecheck',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('dynamicRecheck');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtDynamicRecheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtDynamicRecheck',sxtDynamicRecheck);
  /** @ngInject */
  function sxtDynamicRecheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtSafeRecheck',
        sxtMapShow:'=',
        items:'=',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;

      function convert(status) {
        switch (status){
          case 8:
          case 4:
            return 1;
          case 16:
            return 8;
        }
        return status;
      }

      var install =function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              $("#inspect").css("display","none");
              $q.all([
                remote.safe.dynPointQuery.cfgSet({
                  filter:function (item,inspectionId) {
                    return item.InspectionID==inspectionId&&item.AcceptanceItemID==scope.procedure&&item.AreaID==scope.regionId;
                  }
                })(scope.inspectionId),
                remote.safe.getSafePointGeo()
              ]).then(function (res) {
                var fs = [];
                fg.data = res[0].data;
                res[0].data.forEach(function (item) {
                  var p = res[1].data.find(function (pt) {
                    return pt.MeasurePointID == item.PositionID;
                  });
                  if (p && p.Geometry) {
                    var geo = $window.JSON.parse(p.Geometry);
                    if(geo && geo.geometry) {
                      if (geo.geometry.type == 'Stamp')
                        geo.geometry.type = 'Point';
                      geo.properties.Status = item.Status;
                      geo.properties.v = item;
                      geo.properties.seq = item.ProblemSortName;
                      fs.push(geo);
                    }
                  }
                })
                fg.addData(fs, false);
                cb();
                fs.forEach(function (t) {
                  fg.updateStatus(t.properties.v.PositionID,convert(t.properties.Status))
                })
                scope.ct && (scope.ct.loading = false);
              })

            },
            onUpdate: function (layer, isNew, group,cb) {
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('dynamicRecheck');
              if (edit) {
                scope.sxtMapShow = true;
                edit.scope.context = fg;
                edit.scope.data = {
                  item: scope.item,
                  value: layer.properties.v
                }
                edit.scope.apply && edit.scope.apply();
              }
            }
          });
          $timeout(function () {
            remote.safe.getDrawingRelate.cfgSet({
              offline: true
            })("DayInspects",scope.regionId).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID==item.DrawingID
                        })){
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                  //scope.ct && (scope.ct.loading = false);
                })
              }
              else {
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtDynamicAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('sxtDynamicAcceptPopup',sxtDynamicAcceptPopup);
  /** @ngInject */
  function sxtDynamicAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/sxtDynamicAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.safe.dynProblemRecordQuery(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            p.action="Insert";
            remote.safe.dynProblemRecordCreate(p);
          }
          scope.data.p = p;
          remote.safe.dynProblemRecordFileQuery(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            img.action="Insert";
            remote.safe.dynProblemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('dynamicAccept',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('dynamicAccept');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtDynamicAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtDynamicAccept',sxtDynamicAccept);
  /** @ngInject */
  function sxtDynamicAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtDynamicAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        inspectionAreaId:"=",
        ct:'=',
        disableInspect:'@',
        disableDrag:'@'
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              if (scope.asyload){
                return;
              }
              scope.asyload=true;
              remote.safe.dynPointQuery.cfgSet({
                filter:function (item,AcceptanceItemID,AreaID,inspectionId){
                  return item.AcceptanceItemID==AcceptanceItemID && item.AreaID==AreaID&&item.InspectionExtendID==inspectionId;
                }
              })(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                remote.Procedure.InspectionPoint.query(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                  fg.data = r.data,fs=[];
                  r.data.forEach(function (c) {
                    var p = r1.data.find(function (p1) {
                      return p1.MeasurePointID == c.PositionID;
                    });
                    if (p && p) {
                      if(p.Geometry){
                        p.geometry = $window.JSON.parse(p.Geometry);
                      }else{
                        p.geometry = p.geometry;
                      }
                      if(p.geometry && p.geometry.properties) {
                        p.geometry.properties.seq = c.ProblemSortName;
                        if (p.geometry.geometry.type == 'Stamp')
                          p.geometry.geometry.type = 'Point';
                        p.geometry.properties.Status = c.Status;
                        fs.push(p.geometry);
                      }
                    }
                  });
                  scope.item = null;
                  fg.addData(fs,false);
                  cb();
                  scope.asyload=false;
                  scope.ct && (scope.ct.loading = false);
                })
              })
            },
            onUpdate: function (layer, isNew, group,cb) {
              if(isNew){
                layer.properties.seq = scope.item.ProblemSortName;
                layer.properties.Status = scope.item.ProblemID?1:2;
              }
              var point = {
                MeasurePointID:layer.properties.$id,
                geometry:layer
              };
              remote.Procedure.InspectionPoint.create(point);
              if(isNew || !fg.data.find(function (d) {
                  return d.PositionID == point.MeasurePointID;
                })) {
                var v = {
                  // InspectionID:scope.inspectionId,
                  // InspectionAreaID:scope.inspectionAreaId,
                  InspectionExtendID:scope.inspectionId,
                  CheckpointID:sxt.uuid(),
                  IndexPointID:scope.item.ProblemID,
                  AreaID:scope.regionId,
                  AcceptanceItemID:scope.procedure,
                  PositionID:point.MeasurePointID,
                  MeasureValue:0,
                  Status:1,
                  ProblemSortName:scope.item.ProblemSortName,
                  ProblemDescription:scope.item.ProblemDescription,
                  isNew:true
                }
                if(!v.IndexPointID){
                  v.Status = 2;
                  point.geometry.properties.Status = 2;
                }
                v.action="Insert";
                fg.data.push(v);
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                remote.safe.dynPointCreate(v);

              }
              cb(layer);
            },
            onPopupClose: function (cb) {
              var self = this;
              var edit = mapPopupSerivce.get('dynamicAccept'),
                scope = edit.scope;
              if(scope.data && scope.isSaveData!==false){
                scope.isSaveData = false;
                self.options.onUpdateData(scope.context,scope.data,scope);
              }
              cb();
            },
            onUpdateData: function (context, data, editScope) {
              if(data.v.ProblemSortName == 'T'){
                data.v.action="Insert";
                remote.safe.dynPointCreate(data.v);
              }
            },
            onDelete: function (layer,cb) {
              var id = layer.properties.$id;
              //删除几何点
              remote.Procedure.InspectionPoint.delete({MeasurePointID:id}).then(function (r) {
                var v = fg.data.find(function (d) {
                  return d.PositionID == id;
                }),ix = fg.data.indexOf(v);
                fg.data.splice(ix,1);
                //删除检查点
                remote.safe.dynPointDelete({CheckpointID:v.CheckpointID}).then(function () {
                  //删除记录
                  remote.safe.dynProblemRecordQuery(v.CheckpointID).then(function (k) {
                    if (angular.isArray(k.data)){
                      k.data.forEach(function (w) {
                        //删除照片
                        remote.safe.dynProblemRecordDelete(w).then(function () {
                          remote.safe.dynProblemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                            if (angular.isArray(m.data)){
                              m.data.forEach(function (q) {
                                remote.safe.dynProblemRecordFileDelete(q);
                              })
                            }
                          })
                        })
                      });

                    }
                  })
                });
              });
              cb(layer);
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('dynamicAccept');
              if(edit) {
                edit.scope.context = {
                  fg:fg,
                  layer:layer
                };
                edit.scope.data = {
                  item:scope.item,
                  procedure:scope.procedure,
                  regionId:scope.regionId,
                  v:fg.data.find(function (d) {
                    return d.PositionID == layer.properties.$id;
                  })
                };
                edit.scope.readonly = scope.readonly;
                edit.scope.apply && edit.scope.apply();
                cb(edit.el[0]);
              }
            }
          });
          $timeout(function () {
            var areaID=scope.regionId.substr(0,10);
            remote.safe.getDrawingRelate.cfgSet({
              offline: true
            })("DayInspects",areaID).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  // var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  // btn.click(function () {
                  //   var mapList = [];
                  //   result.data.forEach(function (item) {
                  //     if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                  //         return f.DrawingID==item.DrawingID
                  //       })){
                  //       mapList.push(item);
                  //     }
                  //   });
                  //
                  //   xhUtils.openLinks(mapList);
                  // });
                  // element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                }).catch(function () {
                })
              }
              else{
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            }).catch(function () {
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(!scope.excuted&&scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            scope.excuted=true;
            $timeout(function () {
              scope.excuted=false;
            },5000)
            install();
          }
        });
        scope.$watch('procedure', function () {
          if(!scope.excuted&&scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            scope.excuted=true;
            $timeout(function () {
              scope.excuted=false;
            },5000)
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by emma on 2016/6/4.
 */
(function(){
  'use strict';

  safeSlideMenu.$inject = ["$state"];
  angular
    .module('app.xhsc')
    .directive('safeSlideMenu',safeSlideMenu);

  /**@ngInject*/
  function safeSlideMenu($state){
    return {
      scope:{
        slideData:'=',
        showCheck:'=',
        current:'='
      },
      templateUrl:'app/main/xhsc/directive/safe_civiliz/safeSlideMenu.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.info = {

      };
      scope.selectProcedure = function(item){
        scope.gxlevels = null;
        scope.slideData.forEach(function(t){
          t.SpecialtyChildren.forEach(function(_t){
            _t.checked = false;
          })
        })
        item.checked = true;
        scope.gxlevels = item.WPAcceptanceList;
      }
      scope.$watch('slideData',function(){
        if(!scope.slideData) return;
        if(!scope.slideData.length) return;
        if(scope.slideData[0].SpecialtyChildren.length)
          scope.selectProcedure(scope.slideData[0].SpecialtyChildren[0]);
      })

      scope.$watch('info.current',function () {
        scope.current = scope.info.current;
      });
      scope.$watch('current',function () {
        scope.info.current = scope.current;
      });
    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  safeDialog.$inject = ["$state", "$timeout", "remote", "utils", "auth", "sxt", "$mdDialog", "api"];
  angular
    .module('app.xhsc')
    .directive('safeDialog',safeDialog);

  /**@ngInject*/
  function safeDialog($state,$timeout,remote,utils,auth,sxt,$mdDialog,api){
    return {
      scope:{
        dialogShow:'=',
        dialogData:'=',
        dialogSure:'@',
        dialogMsg:'@',
        callBack:"&"
      },
      templateUrl:"app/main/xhsc/directive/safe_civiliz/safeDialog.html",
      link:link,
      controller:["$scope", function($scope){
        $scope.description="";
        $scope. percentage="";
      }]
    }
    function link(scope,element,attr,ctrl){
      $(element).appendTo('body');
      $('.my-dialog-mask',element).fadeOut();
      scope.$watch('dialogShow',function(){
        if(scope.dialogShow){
          $('.my-dialog-mask',element).fadeIn();
          scope.description="";
          scope. percentage=100;
        }
        if(scope.dialogSure != '报验'){
          scope.logOut= true;
        }
      })
      scope.$watch('dialogData',function(){
        if(!scope.dialogData) return;
        var msg='';
        scope.dialogData.Rows.forEach(function(t){
          msg += t.projectTree+'，';
        })
        scope.dialogMsg = msg + scope.dialogData.acceptanceItemName+ '安全已自检完毕，请监理验收';
      })
      scope.cancel= function(){
        scope.dialogShow = false;
        $('.my-dialog-mask',element).fadeOut();
      }
      scope.submit = function(evt){
        DialogController.$inject = ["$scope"];
        var parentEl = angular.element(document.body);
        $mdDialog.show({
          parent: parentEl,
          targetEvent: evt,
          template:'<md-dialog   ng-cloak><md-dialog-content> <md-progress-circular md-diameter="32" md-mode="indeterminate"></md-progress-circular> 正在提交数据，请稍候……</md-dialog-content></md-dialog>',
          controller: DialogController
        });
        function DialogController($scope) {
          scope.dialogShow = false;
          scope.areaIds=[];
          $('.my-dialog-mask',element).fadeOut();
          if(scope.dialogSure == '报验'){
            var percentage= scope.percentage?scope.percentage:100
            scope.dialogData.Rows.forEach(function(t){
              scope.areaIds.push( {
                AreaID:t.RegionID,
                Describe:scope.description,
                Percentage:percentage
              });
            })
            var params ={
              AcceptanceItemID:scope.dialogData.acceptanceItemID,
              AreaList:scope.areaIds,
              Describe:scope.description,
              Percentage:100,
              id:sxt.uuid()
            }
            api.setNetwork(0).then(function(){
              remote.safe.createSafeBatch(params).then(function(result){
                if (result.data) {
                  scope.callBack();
                }
              }).catch(function(){
                $mdDialog.cancel();
              });
            });
          }else{
            $mdDialog.hide();
          }
        }
      }
      scope.$on('$destroy', function () {
        $(element).remove()
      });
    }
  }
})();

/**
 * Created by shaoshun on 2017/3/2.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  selfAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('selfAcceptPopup',selfAcceptPopup);
  /** @ngInject */
  function selfAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/gx/selfAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        if (scope.data.v){
          scope.status=scope.data.v.Status==1?false:true;
        }
        scope.$apply();
        remote.self.zb.problemRecordQuery(scope.data.v.Id).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            var Id=sxt.uuid();
            p = {
              Id:Id,
              inspectionId:scope.inspectionId,
              ProblemRecordID: Id,
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'zb'
            };
            remote.self.zb.problemRecordCreate(p);
          }
          scope.data.p = p;
          remote.self.zb.problemRecordFileQuery(p.Id).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };
      scope.onChange=function (status) {
       if (status){
         scope.data.v.Status=2;
       }else {
         scope.data.v.Status=1;
       }
        scope.context.fg.updateStatus(scope.data.v.PositionID,scope.data.v.Status);
        remote.self.zb.pointCreate(scope.data.v);
      }

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var Id=sxt.uuid();
            var img = {
              Id:Id,
              inspectionId:scope.inspectionId,
              ProblemRecordFileID:Id,
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            remote.self.zb.problemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('selfAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('selfAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  selfAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "$q"];
  angular
    .module('app.xhsc')
    .directive('selfAccept',selfAccept);
  /** @ngInject */
  function selfAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils,$q) {
    return {
      scope:{
        item:'=selfAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        imgId:"=",
        ct:'=',
        disableInspect:'@',
        disableDrag:'@',
        gx:"="
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;

      function loadingPic(regionId,gx) {
       return  $q(function (resolve,reject) {
         scope.asy=true;
          var imgId="";
          if(scope.regionId){
            var areaID=scope.regionId.substr(0,10);
            remote.safe.getDrawingRelate.cfgSet({
              offline: true
            })("cycle",areaID).then(function (result) {
              imgId = result.data.find(function (item) {
                return item.AcceptanceItemID==scope.procedure && item.RegionId ==scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId){
                imgId=imgId.DrawingID;
              }
              resolve(imgId);
            }).catch(function () {
              resolve(imgId);
            })
          }
        })
      }

      var install =function () {
        loadingPic().then(function (imgId) {
          scope.identity=0;
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                remote.self.zb.pointQuery.cfgSet({
                  filter:function (item){
                    return item.RegionID==scope.regionId&&item.AcceptanceItemID==scope.procedure;
                  }
                })().then(function (r) {
                  remote.Procedure.InspectionPoint.query().then(function (r1) {
                    fg.data = r.data,fs=[];
                    r.data.forEach(function (c) {
                      var p = r1.data.find(function (p1) {
                        return p1.MeasurePointID == c.PositionID;
                      });
                      if (p && p) {
                        if(p.Geometry){
                          p.geometry = $window.JSON.parse(p.Geometry);
                        }else{
                          p.geometry = p.geometry;
                        }
                        if(p.geometry && p.geometry.properties) {
                          if ($.isNumeric(c.ProblemSortName)){
                            var  t=parseInt(c.ProblemSortName);
                            scope.identity=scope.identity<t?t:scope.identity;
                          }
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      }
                    });
                    scope.item = null;
                    fg.addData(fs,false);
                    cb();
                    scope.ct && (scope.ct.loading = false);
                  })
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
                if(isNew){
                  layer.properties.seq = scope.item.ProblemSortName;
                  layer.properties.seq =++scope.identity;
                  layer.properties.Status = scope.item.ProblemID?1:2;
                }
                var point = {
                  MeasurePointID:layer.properties.$id,
                  geometry:layer
                };
                remote.Procedure.InspectionPoint.create(point);
                if(isNew || !fg.data.find(function (d) {
                    return d.PositionID == point.MeasurePointID;
                  })) {
                  var Id=sxt.uuid();
                  var v = {
                    Id:Id,
                    Drawing:scope.imgId,
                    InspectionID:scope.inspectionId,
                    CheckpointID:Id,
                    IndexPointID:scope.item.ProblemID,
                    RegionID:scope.regionId,
                    AcceptanceItemID:scope.procedure,
                    PositionID:point.MeasurePointID,
                    MeasureValue:0,
                    Status:1,
                    ProblemSortName:layer.properties.seq,
                    ProblemDescription:scope.item.ProblemDescription,
                    isNew:true
                  }
                  if(!v.IndexPointID){
                    v.Status = 2;
                    point.geometry.properties.Status = 2;
                  }
                  fg.data.push(v);
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  remote.self.zb.pointCreate(v);

                }
                cb(layer);
              },
              onPopupClose: function (cb) {
                var self = this;
                var edit = mapPopupSerivce.get('selfAcceptPopup'),
                  scope = edit.scope;
                if(scope.data && scope.isSaveData!==false){
                  scope.isSaveData = false;
                  self.options.onUpdateData(scope.context,scope.data,scope);
                }
                cb();
              },
              onUpdateData: function (context, data, editScope) {
                if(data.v.ProblemSortName == 'T'){
                  remote.self.zb.pointCreate(data.v);
                }
              },
              onDelete: function (layer,cb) {
                var id = layer.properties.$id;
                //删除几何点
                remote.Procedure.InspectionPoint.delete({MeasurePointID:id}).then(function (r) {
                  var v = fg.data.find(function (d) {
                    return d.PositionID == id;
                  }),ix = fg.data.indexOf(v);
                  fg.data.splice(ix,1);
                  //删除检查点
                  remote.self.zb.pointDelete({CheckpointID:v.CheckpointID}).then(function () {
                    //删除记录
                    remote.self.zb.problemRecordQuery(v.CheckpointID).then(function (k) {
                      if (angular.isArray(k.data)){
                        k.data.forEach(function (w) {
                          //删除照片
                          remote.self.zb.problemRecordDelete(w).then(function () {
                            remote.self.zb.problemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                              if (angular.isArray(m.data)){
                                m.data.forEach(function (q) {
                                  remote.self.zb.problemRecordFileDelete(q);
                                })
                              }
                            })
                          })
                        });
                      }
                    })
                  });
                });
                cb(layer);
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('selfAcceptPopup');
                if(edit) {
                  edit.scope.context = {
                    fg:fg,
                    layer:layer
                  };
                  edit.scope.inspectionId=scope.inspectionId;
                  edit.scope.data = {
                    item:scope.item,
                    procedure:scope.procedure,
                    regionId:scope.regionId,
                    v:fg.data.find(function (d) {
                      return d.PositionID == layer.properties.$id;
                    })
                  };
                  edit.scope.readonly = scope.readonly;
                  edit.scope.apply && edit.scope.apply();
                  cb(edit.el[0]);
                }
              }
            });
            $timeout(function () {
              if (imgId){
                remote.Project.getDrawing(imgId).then(function (result2) {
                  scope.asy=false;
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                }).catch(function () {
                  scope.asy=false;
                })
              }else {
                scope.asy=false;
                utils.alert('未找到图纸,请与管理员联系!');
              }
            });
          }
        })
      };

      scope.$watch('procedure', function () {
        if(!scope.asy&&scope.regionId&&scope.procedure) {
          if(map){
            map.remove();
            fg=map = null;
          }
          install();
        }
      });

      scope.$watch('regionId', function () {
        if(!scope.asy&&scope.regionId&&scope.procedure) {
          if(map){
            map.remove();
            fg=map = null;
          }
          install();
        }
      });

      scope.$watch('item',function () {
        if(fg) {
          if (scope.item) {
            fg.changeMode('inspect',scope.item);
          }
          else {
            fg.changeMode();
          }
        }
      })

      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  gxSelet.$inject = ["remote"];
  angular
    .module('app.xhsc')
    .directive('gxSelet',gxSelet);
  /** @ngInject */
  function gxSelet(remote){
    return {
      restrict:'E',
      scope:{
        model:'=',
        selected:'='
      },
      templateUrl:'app/main/xhsc/directive/gx/gx-select.html',
      link:link
    }
    function link(scope,element,attr,ctrl){
      switch (scope.model){
        case "single":
          scope.model="single";
          scope.singleVal=null;
          break;
        case "multil":
          scope.model="multil"
      }
      remote.Procedure.queryProcedure().then(function(result){
        scope.data=result.data;
        scope.data.sort(function(a,b){
          return a.SpecialtyName.localeCompare(b.SpecialtyName);
        });
        scope.show=true;
      })
      scope.showTab=function(item){
        if (!item.SpecialtyChildren||!item.SpecialtyChildren.length){
          return false;
        }
        var gx= item.SpecialtyChildren;
        for (var  i=0;i<gx.length;i++){
          if (gx[i].WPAcceptanceList&&gx[i].WPAcceptanceList.length){
            return true;
          }
        }
        return false;
      }
      scope.selected=[];
      scope.checked=function (item) {
         if(!item.checked){
           if (!scope.selected.find(function (o) {
               return o.AcceptanceItemID==item.AcceptanceItemID;
             })){
             scope.selected.push(item);
           }
         }else {
           var obj= scope.selected.find(function (o) {
             return o.AcceptanceItemID==item.AcceptanceItemID;
           })
           if (obj!=null){
             var  index=scope.selected.indexOf(obj);

             scope.selected.splice (index,1);
           }
         }
      }

    }
  }
})();

/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by shaoshun on 2017/3/1.
 */
/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  buildingSelet.$inject = ["xhscService"];
  angular
    .module('app.xhsc')
    .directive('buildingSelet',buildingSelet);
  /** @ngInject */
  function buildingSelet(xhscService){
    return {
      restrict:'E',
      scope:{
        selected:'='
      },
      templateUrl:'app/main/xhsc/directive/gx/building-select.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.zk=function (item) {
        item.hide=!item.hide;
      }
      xhscService.getRegionTreeOffline("", 15,1,"scRigthRegions").then(function (r) {
        scope.data=r;
        scope.show=true;
      }).catch(function () {
        vm.show=true;
      });

      function setDisable(item) {
        scope.data.forEach(function (m) {
          m.Children.forEach(function (r) {
            if (r.RegionID==item.ParentID){
              r.Children.forEach(function (k) {
                if (!item.checked){
                  k.disable=false;
                }
              })
            }else {
              r.Children.forEach(function (k) {
                if(item.checked){
                  k.disable=true;
                }
              })
            }
          })
        });
      }



      scope.selected=[];
      scope.checked=function (item) {
        setDisable(item)
        if(!item.checked){
          if (!scope.selected.find(function (o) {
              return o.RegionID==item.RegionID;
            })){
            scope.selected.push(item);
          }
        }else {
          var obj= scope.selected.find(function (o) {
            return o.RegionID==item.RegionID;
          })
          if (obj!=null){
            var  index=scope.selected.indexOf(obj);
            scope.selected.splice (index,1);
          }
        }
      }
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  cycleRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('cycleRecheckPopup',cycleRecheckPopup);
  /** @ngInject */
  function cycleRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/cycle/cycleRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.yf.yfProblemRecordQuery(scope.data.value.CheckpointID).then(function(r){
          scope.images={
            zb:[],
            jl:[]
          }

          r.data.forEach(function (p) {
            remote.yf.yfProblemRecordFileQuery(p.ProblemRecordID).then(function (r2) {
              if (p.DescRole=="jl"){
                scope.images.jl=scope.images.jl.concat(r2.data)
              }else{
                scope.images.zb=scope.images.zb.concat(r2.data);
              }
            });
          });

          var zb=r.data.find(function (p) {
            return p.DescRole=='zb'&&p.Remark
          })
          if (!zb){
            zb=r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          }

          var jl=r.data.find(function (p) {
            return p.DescRole=='jl'&&p.Remark
          })
          if (!jl){
            jl=r.data.find(function (p) {
              return p.DescRole=='jl'
            })
          }


          scope.Record = {
            jl:jl,
            zb:zb
          };

          if(!scope.Record.jl){
            scope.Record.jl = {
              CheckpointID:scope.data.value.CheckpointID,
              Describe:'',
              DescRole:"jl",
              Remark:''
            };
          }
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              Describe:'',
              DescRole:"zb",
              Remark:''
            };
          }
        })

        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }

      function createZb(update) {
        return $q(function (resolve,reject) {
          var rec="";
          remote.yf.yfProblemRecordQuery.cfgSet({
            filter: function (item, CheckpointID) {
              var t=item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="zb";
              if (t){
                rec=rec?rec:item.RectificationID;
              }
              return t;
            },
          })(scope.data.value.CheckpointID).then(function (r) {
            if (!r||!r.data||!r.data.length){
              // scope.Record.zb.ProblemRecordID = sxt.uuid()
              var rec={
                CheckpointID:scope.data.value.CheckpointID,
                RectificationID:rec,
                Describe:scope.Record.zb.Remark,
                DescRole:"zb",
                Remark:scope.Record.zb.Remark
              };
              rec.ProblemRecordID = sxt.uuid();
              rec._id=rec.ProblemRecordID;
              remote.yf.yfProblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }else {
              var rec=r.data[0];
              rec.Describe=rec.Remark=scope.Record.zb.Remark;
              rec.Remark=rec.Remark=scope.Record.zb.Remark;
              rec.DescRole="zb";
              remote.yf.yfProblemRecordCreate(rec).then(function () {
                resolve(rec);
              })
            }

          });
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function (res) {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:res.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.yf.yfProblemRecordFileCreate(img).then(function () {
                // var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                scope.images.zb=scope.images.zb.concat([img]);
              })

            })
            scope.data.value.Status = 16;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }


      scope.convert=function (status) {
        switch (status){
          case 8:
          case 4:
            return 1;
          case 16:
            return 8;
        }
        return status;
      }

      scope.submit = function(){
        var  convert=scope.convert;

        if(scope.role=='zb'){
          if(convert(scope.data.value.Status)==8 &&(!scope.images.zb || scope.images.zb.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.yf.yfPointCreate(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.yf.yfPointCreate(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,convert(scope.data.value.Status));
          }).then(function () {
            var rec="";
            remote.yf.yfProblemRecordQuery.cfgSet({
              filter: function (item, CheckpointID) {
                var t=item.CheckpointID == CheckpointID&&!item.isUpload&&item.DescRole=="jl";
                if (t){
                  rec=rec?rec:item.RectificationID;
                }
                return t;
              },
            })(scope.data.value.CheckpointID).then(function (r) {
              if (!r||!r.data||!r.data.length){
                var rec={
                  CheckpointID:scope.data.value.CheckpointID,
                  RectificationID:rec,
                  Describe:'',
                  DescRole:"jl",
                  Remark:''
                };
                rec.ProblemRecordID = sxt.uuid();
                rec._id=rec.ProblemRecordID;
                remote.yf.yfProblemRecordCreate(rec)
              }else {
                var rec=r.data[0];
                // rec.Describe=rec.Remark=scope.Record.zb.Remark;
                rec.DescRole="jl";
                remote.yf.yfproblemRecordCreate(rec);
              }
            });
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('cycleRecheckPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('cycleRecheckPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  cycleRecheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('cycleRecheck',cycleRecheck);
  /** @ngInject */
  function cycleRecheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils,api) {
    return {
      scope:{
        item:'=cycleRecheck',
        sxtMapShow:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        points:"=",
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.ct && (scope.ct.loading = true);
        var map,fg;

        function convert(status) {
          switch (status){
            case 8:
            case 4:
              return 1;
            case 16:
              return 8;
          }
          return status;
        }

        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                $("#inspect").css("display","none");
                $q.all([
                  remote.yf.yfPointQuery.cfgSet({
                    filter:function (item,inspectionId) {
                      return  item.AreaID==scope.regionId&&item.InspectionExtendID==inspectionId;
                    }
                  })(scope.inspectionId),
                  remote.cycleLook.cyclePointGeo()
                ]).then(function (res) {
                  var fs = [];
                  fg.data = res[0].data;
                  res[0].data.forEach(function (item) {
                    var p = res[1].data.find(function (pt) {
                      return pt.MeasurePointID == item.PositionID;
                    });
                    if (p && p.Geometry) {
                      var geo = $window.JSON.parse(p.Geometry);
                      if(geo && geo.geometry) {
                        if (geo.geometry.type == 'Stamp')
                          geo.geometry.type = 'Point';
                        geo.properties.Status = item.Status;
                        geo.properties.v = item;
                        geo.properties.seq = item.ProblemSortName;
                        fs.push(geo);
                      }
                    }
                  })
                  fg.addData(fs, false);
                  scope.points=fg.data;
                  cb();
                  fs.forEach(function (t) {
                    fg.updateStatus(t.properties.v.PositionID,convert(t.properties.Status))
                  })
                  scope.ct && (scope.ct.loading = false);
                })

              },
              onUpdate: function (layer, isNew, group,cb) {
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('cycleRecheckPopup');
                if (edit) {
                  scope.sxtMapShow = true;
                  edit.scope.context = fg;
                  edit.scope.data = {
                    value: layer.properties.v
                  }
                  edit.scope.apply && edit.scope.apply();
                }
              }
            });
            $timeout(function () {
              var areaID=scope.regionId.substr(0,scope.regionId.length-5);
              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("house",areaID).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.Type==-3&&item.RegionId == scope.regionId;
                });

                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.Type==7&& item.RegionId == scope.regionId.substr(0,scope.regionId.length-5)
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    btn.click(function () {
                      var mapList = [];
                      result.data.forEach(function (item) {
                        if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                            return f.DrawingID==item.DrawingID
                          })){
                          mapList.push(item);
                        }
                      });

                      xhUtils.openLinks(mapList);
                    });
                    element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                    //scope.ct && (scope.ct.loading = false);
                  })
                }
                else {
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  cycleAcceptPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('cycleAcceptPopup',cycleAcceptPopup);
  /** @ngInject */
  function cycleAcceptPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/cycle/cycleAcceptPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.yf.yfProblemRecordQuery(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            p.action="Insert";
            remote.yf.yfProblemRecordCreate(p);
          }
          scope.data.p = p;
          remote.yf.yfProblemRecordFileQuery(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            img.action="Insert";
            remote.yf.yfProblemRecordFileCreate(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('cycleAcceptPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('cycleAcceptPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/24.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  cycleAccept.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .directive('cycleAccept',cycleAccept);
  /** @ngInject */
  function cycleAccept($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils,api) {
    return {
      scope:{
        ctr:"=",
        item:'=cycleAccept',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        ct:'=',
        set:"&",
        disableInspect:'@',
        disableDrag:'@'
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      api.setNetwork(1).then(function () {
        scope.identity=0;
        scope.ct && (scope.ct.loading = true);
        var map,fg;
        var install =function () {
          scope.ct && (scope.ct.loading = true);
          if (!map) {
            map = new $window.L.glProject(element[0], {
              map: {
                zoomControl: false
              }
            });
            fg = $window.mapboxgl.Plan({
              disableInspect:scope.disableInspect,
              disableDrag:scope.disableDrag,
              onChangeMode:function (mode,op,cb) {
                if(mode && !op){
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  scope.item = {
                    ProblemID:null,
                    ProblemSortName:'✔',//'',
                    ProblemDescription:''
                  };
                }
                cb();
              },
              onLoad: function (cb) {
                remote.yf.yfPointQuery.cfgSet({
                  filter:function (item,AcceptanceItemID,AreaID,inspectionId){
                    return item.AreaID==AreaID&&item.InspectionExtendID==inspectionId;
                  }
                })(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                  remote.cycleLook.cycleGeoQuery(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                    fg.data = r.data,fs=[];
                    r.data.forEach(function (c) {
                      var p = r1.data.find(function (p1) {
                        return p1.MeasurePointID == c.PositionID;
                      });
                      if (p && p) {
                        if(p.Geometry){
                          p.geometry = $window.JSON.parse(p.Geometry);
                        }else{
                          p.geometry = p.geometry;
                        }
                        if(p.geometry && p.geometry.properties) {
                          if ($.isNumeric(c.ProblemSortName)){
                            var  t=parseInt(c.ProblemSortName);
                            scope.identity=scope.identity<t?t:scope.identity;
                          }
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      }
                    });
                    scope.item = null;
                    fg.addData(fs,false);
                    cb();
                    scope.ct && (scope.ct.loading = false);
                  })
                })
              },
              onUpdate: function (layer, isNew, group,cb) {
                if(isNew){
                  layer.properties.seq =++scope.identity;
                  layer.properties.Status = scope.item.ProblemID?1:2;
                }
                var point = {
                  MeasurePointID:layer.properties.$id,
                  geometry:layer
                };
                remote.cycleLook.cycleGeoCreate(point);
                if(isNew || !fg.data.find(function (d) {
                    return d.PositionID == point.MeasurePointID;
                  })) {
                  var v = {
                    // InspectionID:scope.inspectionId,
                    // InspectionAreaID:scope.inspectionAreaId,
                    InspectionExtendID:scope.inspectionId,
                    CheckpointID:sxt.uuid(),
                    IndexPointID:scope.item.ProblemID,
                    AreaID:scope.regionId,
                    AcceptanceItemID:scope.procedure,
                    PositionID:point.MeasurePointID,
                    MeasureValue:0,
                    Status:1,
                    ProblemSortName:layer.properties.seq,
                    ProblemDescription:scope.item.ProblemDescription,
                    isNew:true
                  }
                  if(!v.IndexPointID){
                    v.Status = 2;
                    point.geometry.properties.Status = 2;
                  }
                  v.action="Insert";
                  fg.data.push(v);
                  scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                  remote.yf.yfPointCreate(v)
                }
                cb(layer);
              },
              onPopupClose: function (cb) {
                var self = this;
                var edit = mapPopupSerivce.get('cycleAcceptPopup'),
                  scope = edit.scope;
                if(scope.data && scope.isSaveData!==false){
                  scope.isSaveData = false;
                  self.options.onUpdateData(scope.context,scope.data,scope);
                }
                cb();
              },
              onUpdateData: function (context, data, editScope) {
                if(data.v.ProblemSortName == 'T'){
                  data.v.action="Insert";
                  remote.yf.yfPointCreate(data.v);
                }
              },
              onDelete: function (layer,cb) {
                var id = layer.properties.$id;
                //删除几何点
                remote.cycleLook.cycleGeoDelete({MeasurePointID:id}).then(function (r) {
                  var v = fg.data.find(function (d) {
                    return d.PositionID == id;
                  }),ix = fg.data.indexOf(v);
                  fg.data.splice(ix,1);
                  //删除检查点
                  remote.yf.yfPointDelete({CheckpointID:v.CheckpointID}).then(function () {
                    //删除记录
                    remote.yf.yfProblemRecordQuery(v.CheckpointID).then(function (k) {
                      if (angular.isArray(k.data)){
                        k.data.forEach(function (w) {
                          //删除照片
                          remote.yf.yfProblemRecordDelete(w).then(function () {
                            remote.yf.yfProblemRecordFileQuery(w.ProblemRecordID).then(function (m) {
                              if (angular.isArray(m.data)){
                                m.data.forEach(function (q) {
                                  remote.yf.yfProblemRecordFileDelete(q);
                                })
                              }
                            })
                          })
                        });

                      }
                    })
                  });
                });
                cb(layer);
              },
              onPopup: function (layer,cb) {
                var edit = mapPopupSerivce.get('cycleAcceptPopup');
                if(edit) {
                  edit.scope.context = {
                    fg:fg,
                    layer:layer
                  };
                  edit.scope.data = {
                    item:scope.item,
                    procedure:scope.procedure,
                    regionId:scope.regionId,
                    v:fg.data.find(function (d) {
                      return d.PositionID == layer.properties.$id;
                    })
                  };
                  edit.scope.readonly = scope.readonly;
                  edit.scope.apply && edit.scope.apply();
                  cb(edit.el[0]);
                }
              }
            });
            $timeout(function () {
              var areaID=scope.regionId.substr(0,10);
              remote.safe.getDrawingRelate.cfgSet({
                offline: true
              })("house",areaID).then(function (result) {
                var imgId = result.data.find(function (item) {
                  return item.Type==-3&&item.RegionId == scope.regionId;
                });

                if(!imgId){
                  imgId = result.data.find(function (item) {
                    return item.Type==7&& item.RegionId == scope.regionId.substr(0,scope.regionId.length-5)
                  });
                }
                if (imgId) {
                  remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                    if(!result2.data.DrawingContent){
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent);
                    map.map.addControl(fg);
                    // var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                    // btn.click(function () {
                    //   var mapList = [];
                    //   result.data.forEach(function (item) {
                    //     if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                    //         return f.DrawingID==item.DrawingID
                    //       })){
                    //       mapList.push(item);
                    //     }
                    //   });
                    //
                    //   xhUtils.openLinks(mapList);
                    // });
                    // element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                  }).catch(function () {
                  })
                }
                else{
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              }).catch(function () {
              });
            }, 300);
          }
        };
        $timeout(function () {
          scope.$watch('regionId', function () {
            if(scope.regionId && scope.procedure) {
              if(map){
                map.remove();
                map = null;
              }
              install();
            }
          });
          scope.$watch('item',function () {
            if(fg) {
              if (scope.item) {
                fg.changeMode('inspect',scope.item);
              }
              else {
                fg.changeMode();
              }
            }
          })
        }, 500);
        scope.$on('destroy',function () {
          if(map){
            map.remove();
            map = null;
          }
        })
      })

    }
  }
})();

/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
  module('app.pcReport_ys',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
    .state('app.pcReport_ys_gx',{
      title:"工序验收报表",
      url:'/pcReport_ys_gx',
      noBack:true,
      sendBt:false,
      views:{
        'content@app':{
          templateUrl: 'app/main/pcReport/ysReport/gxysFilter.html',
          controller : 'gxysFilterController as vm',
        }
      }
    })
    .state('app.pcReport_ys_rp',{
      noBack:true,
      sendBt:false,
      url:'/pcReport_ys_rp',
      views:{
        'content@app':{
          templateUrl: 'app/main/pcReport/ysReport/gxysReport.html',
          controller : 'gxysReportController as vm',
        }
      }
    })
      .state('app.pcReport_ys_hz',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_ys_hz/{areaId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/ysReport/hzProblem/hzProblem.html',
            controller : 'hzProblemController as vm',
          }
        }
      })
  }
})();

/**
 * Created by shaoshun on 2017/1/5.
 */
/**
 * Created by lss on 2016/9/12.
 */
(function(){
  'use strict';

  hzProblemController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_ys')
    .controller('hzProblemController',hzProblemController);

  /**@ngInject*/
  function hzProblemController($scope,$stateParams,remote){
    var vm = this;
    var areadId=$stateParams.areaId;
    remote.report.getReportFormInspection(areadId).then(function (d) {
      vm.source=d.data;
      wrap(vm.source);
      vm.loaded=true;
      if (!vm.source.Heads.length){
        vm.isShowbg=true;
      }
    });

    function wrap(source) {
      source.subTitle = [];
      if (source.Heads) {
          source.Heads.forEach(function (k) {
            k.Sub.forEach(function (n) {
              source.subTitle.push(n);
            });
          });

        if (source.Row){
          var index=1;
          source.Row.forEach(function (k) {
            k.num=index++;
          });
        }
      }
    }
  }
})();

/**
 * Created by lss on 2016/9/13.
 */

(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
    module('app.pcReport_sl',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_sl_sc',{
        title:"实测实量报表",
        url:'/pcReport_sl_sc',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/scReport/scslFilter.html',
            controller : 'scslFilterController as vm',
          }
        }
      })
      .state('app.pcReport_sl_rp',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_sl_rp/{scSelected}/{secSelected}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/scReport/scslReport.html',
            controller : 'scslReportController as vm',
          }
        }
      })
      .state('app.pcReport_sl_jt',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_sl_jt/{areaId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/scReport/jt/scJt.html',
            controller : 'scJtController as vm',
          }
        }
      })
  }
})();

/**
 * Created by shaoshun on 2017/1/5.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  scJtController.$inject = ["$scope", "remote", "$mdDialog", "$state", "$stateParams", "$rootScope", "$timeout", "$window", "sxt"];
  angular
    .module('app.pcReport_sl')
    .controller('scJtController',scJtController);

  /**@ngInject*/
  function scJtController($scope,remote,$mdDialog,$state,$stateParams,$rootScope,$timeout,$window,sxt){
    var vm = this;
    var areadId=$stateParams.areaId;
    remote.report.getJtReport().then(function (d) {
      // vm.source=d.data;
      vm.tilte={
        head:[],
        subHead:[],
        footHead:[],
      }
      var title=d.data&&d.data.Title;
      if (title&&angular.isArray(title)){
        title.forEach(function (o) {
             if (angular.isArray(o.Sections)&&o.Sections.length){
                vm.tilte.head.push({
                  ProjectName: o.ProjectName,
                  secNums:o.Sections.length
                })
               vm.tilte.subHead=vm.tilte.subHead.concat(o.Sections);
               o.Sections.forEach(function (q) {
                 vm.tilte.footHead=vm.tilte.footHead.concat([
                   { id:sxt.uuid(),des: "总包"},
                   { id:sxt.uuid(),des: "监理"},
                   { id:sxt.uuid(),des: "项目部"},
                 ])
               })
             }
          });
      }
      vm.vals=[];
      vm.leftNav=[]
      // vm.
      var body=d.data&&d.data.Result;
      if (angular.isArray(body)){
        body.forEach(function (q) {
           if (angular.isArray(q.Indexs)&&q.Indexs.length>0){
             // var f=[q.sco,q.name];
             vm.leftNav.push(q)
             var f=[];
             f.colSpan=q.Indexs.length;
             vm.vals.push(f);
             q.Indexs.forEach(function (m) {
               var row=[];
               vm.leftNav.push(m)
               // var row=[m.sco,m.name];
               if (angular.isArray(m.val)){
                 m.val.forEach(function (w) {
                   row=row.concat(w);
                 })
              }
               vm.vals.push(row);
             })

           }
        })
      }
      // wrap(vm.source);
      vm.loaded=true;
    });
  }
})();

/**
 * Created by shaoshun on 2017/3/26.
 */

/**
 * Created by 陆科桦 on 2016/10/14.
 */

(function (angular, undefined) {
  'use strict';

  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.insideYs', [])
    .config(config);
  /** @ngInject */
  function config($stateProvider, msNavigationServiceProvider) {
    $stateProvider
      .state('app.insideYs', {
        url: '/insideYs',
        views: {
          'content@app': {
            template: '<ui-view class="animate-slide-left" flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      .state('app.insideYs.list', {
        url:'/list',
        template:'<inside-ys-list flex layout="column"></inside-ys-list>'
      })

    msNavigationServiceProvider.saveItem('insideYs', {
      title: '内部验收',
      group: true,
      weight: 2
    });

    msNavigationServiceProvider.saveItem('insideYs.list', {
      title: '问题明细报表',
      icon: 'icon-view-list',
      state: 'app.insideYs.list',
      weight: 1
    });

  }
})(angular, undefined);


(function (angular, undefined) {
  'use strict';
  insideYs.$inject = ["$scope", "api", "utils"];
  angular
    .module('app.insideYs')
    .component('insideYsList', {
      templateUrl: 'app/main/pcReport/insideYs/component/insideYs-list.html',
      controller: insideYs,
      controllerAs: 'vm'
    });
  /** @ngInject */
  function insideYs($scope, api, utils) {
    var vm = this;
    load();
    vm.projectData = [];
    vm.selected = [];

    $scope.$watch("vm.selected", function () {
      vm.data = vm.lsData && vm.lsData.filter(function (f) {
        return vm.selected.length == 0 || vm.selected.find(function (select) { return f.status == select })
      });
    }, true);

    $scope.$watch("vm.project", function () {
      vm.data = vm.lsData && vm.lsData.filter(function (f) {
        return vm.project.length == 0 || vm.project.find(function (select) { return f.rectifyOu == select })
      });
    }, true);
    function load(rectifyOu, status) {
      api.insideYs.batch.getList({ rectifyOu: rectifyOu, status: status }).then(function (r) {
        vm.data = r.data;
        vm.lsData = vm.data;
        r.data.forEach(function (item) {
          if (!vm.projectData.find(function (f) { return f.rectifyOu == item.rectifyOu }) && item.rectifyOu) {
            vm.projectData.push({ rectifyOu: item.rectifyOu, rectifyOuName: item.rectifyOuName })
          }
        }, this);

      });
    };

    vm.toggle = function (item, list) {
      if (list == null) return;
      var idx = list.indexOf(item);
      if (idx > -1) {
        list.splice(idx, 1);
      }
      else {
        list.push(item);
      }
    };

  }
})(angular, undefined);

(function ()
{
    'use strict';

    config.$inject = ["$translatePartialLoaderProvider", "msApiProvider"];
    angular
        .module('app.quick-panel', [])
        .config(config);

    /** @ngInject */
    function config($translatePartialLoaderProvider, msApiProvider)
    {
        // Translation
        $translatePartialLoaderProvider.addPart('app/quick-panel');

        // Api
        msApiProvider.register('quickPanel.activities', ['app/data/quick-panel/activities.json']);
        msApiProvider.register('quickPanel.contacts', ['app/data/quick-panel/contacts.json']);
        msApiProvider.register('quickPanel.events', ['app/data/quick-panel/events.json']);
        msApiProvider.register('quickPanel.notes', ['app/data/quick-panel/notes.json']);
    }
})();

(function ()
{
    'use strict';

    ChatTabController.$inject = ["msApi", "$timeout"];
    angular
        .module('app.quick-panel')
        .controller('ChatTabController', ChatTabController);

    /** @ngInject */
    function ChatTabController(msApi, $timeout)
    {
        var vm = this;

        // Data
        vm.chat = {};
        vm.chatActive = false;
        vm.replyMessage = '';

        msApi.request('quickPanel.contacts@get', {},
            // Success
            function (response)
            {
                vm.contacts = response.data;
            }
        );

        // Methods
        vm.toggleChat = toggleChat;
        vm.reply = reply;

        //////////

        function toggleChat(contact)
        {
            vm.chatActive = !vm.chatActive;

            if ( vm.chatActive )
            {
                vm.replyMessage = '';
                vm.chat.contact = contact;
                scrollToBottomOfChat(0);
            }
        }

        function reply()
        {
            if ( vm.replyMessage === '' )
            {
                return;
            }

            if ( !vm.chat.contact.dialog )
            {
                vm.chat.contact.dialog = [];
            }

            vm.chat.contact.dialog.push({
                who    : 'user',
                message: vm.replyMessage,
                time   : 'Just now'
            });

            vm.replyMessage = '';

            scrollToBottomOfChat(400);
        }

        function scrollToBottomOfChat(speed)
        {
            var chatDialog = angular.element('#chat-dialog');

            $timeout(function ()
            {
                chatDialog.animate({
                    scrollTop: chatDialog[0].scrollHeight
                }, speed);
            }, 0);

        }
    }

})();
/**
 * Created by lss on 2016/5/19.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  xtzlChooseController.$inject = ["$scope", "$stateParams", "db", "$rootScope", "xhUtils", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('xtzlChooseController',xtzlChooseController);

  /** @ngInject */
  function xtzlChooseController($scope,$stateParams,db,$rootScope,xhUtils,$timeout){
    var vm=this,
      id = $stateParams.assessmentID,
      assessmentTypeID = $stateParams.AssessmentTypeID;
      vm.dareaId= $stateParams.areaID;
      vm.dareaName = $stateParams.areaName;
      //console.log('a',$stateParams)
    $rootScope.title = $stateParams.typename;
    vm.id = id;
    vm.assessmentTypeID= assessmentTypeID;
    vm.ms=[];
    var pk = db('xcpk');
    var data = db('pack'+id);
    data.get('GetRegionTreeInfo').then(function (result) {
      var  rr=xhUtils.wrapRegion(result.data);


      pk.get('xcpk').then(function (pk) {
        var item = pk.rows.find(function (it) {
          return it.AssessmentID == id;
        });

        if (angular.isArray(item.AssessmentClassifyRegions)&&item.AssessmentClassifyRegions.length){
            item.AssessmentClassifyRegions.forEach(function(o){
              var region = xhUtils.findRegion([rr], o.RegionID);

              vm.ms.push(angular.extend({
                AssessmentID:item.AssessmentID,
                AssessmentTypeID:assessmentTypeID,
                fullName: region.fullName
              },o));
           });
        }
        vm.fq = {
          RegionID:item.AreaID,
          RegionName:item.AreaName
        }
      })

    }).catch(function (r) {
      console.log(r)
    });
  }
})();

/**
 * Created by lss on 2016/5/20.
 */
/**
 * Created by emma on 2016/4/29.
 */
(function(){
  'use strict';
  stzlDetailController.$inject = ["$mdDialog", "$rootScope", "$scope", "utils", "$stateParams", "db", "sxt", "stzlServices"];
  angular
    .module('app.xhsc')
    .controller('stzlDetailController',stzlDetailController);

  /** @ngInject*/
  function stzlDetailController($mdDialog,$rootScope,$scope,utils,$stateParams,db,sxt,stzlServices){
    var vm = this;
    var params={
      AssessmentID:$stateParams.AssessmentID,
      RegionID:$stateParams.RegionID,
      RegionName:$stateParams.RegionName
    }
    stzlServices.getAssessment(params,null,function(item){
      if (item){
        item._id=params.AssessmentID+"_"+params.RegionID;
        item.data_Type="stzl_assessment";
        item.AssessmentClassifyRegions={
          RegionID:params.RegionID,
          RegionName:params.RegionName
        }
        delete item._rev;
        stzlServices.resultWrap(item,function(o){
          o._id = sxt.uuid();
          o.Assessment_uuid= item._id;
          o.data_Type="stzl_item"
          o.isCheck=false;
          o.lastScore=o.Weight; //最终得分
          o.regionID=params.RegionID; //区域Id
          o.AssessmentID=params.AssessmentID; //评估项id
          o.question=[]; //扣分记录
          o.image=[];  //图片记录
        });
      }
    }).then(function(item){
      vm.Assessment=item;
      vm.levels =item? getEvels(item,0):0;
    })
    vm.getWidth = function (level) {
      if(level==1){
        return 25.0/vm.levels;
      }
      else{
        return 25.0/vm.levels /(1 - vm.getWith(level-1));
      }
    }

    function getEvels(item,level) {
      item.level = level+1;
      if(item.AssessmentClassifys && item.AssessmentClassifys.length){
        var levels = [],max=0;
        item.AssessmentClassifys.forEach(function (item) {
          levels.push(getEvels(item,level));
        });
        levels.forEach(function (l) {
          if(max<l)
            max = l;
        });
        return max;
      }
      return level+1;
    }

    vm.images = [
      {url:'assets/images/etc/plug.png'},
      {url:'assets/images/etc/fallout.jpg'},
      {url:'assets/images/etc/fallout.jpg'}
    ];
    var deleteFn = function(d,data){
      //vm.images.splice(data,1);
      $scope.$apply();
      // console.log('a',vm.images)
    }
    $rootScope.$on('delete',deleteFn);
    vm.check = function(item,ev){
      DialogController.$inject = ["$scope", "$mdDialog"];
      $mdDialog.show({
        controller: DialogController,
        templateUrl:'app/main/xhsc/ys/evaluateQues.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        clickOutsideToClose:true
      })

      function DialogController($scope, $mdDialog) {
        $scope.Problems =item.Problems;
        $scope.answer = function(answer,ev) {
          item.question.push(angular.extend({
            _id : sxt.uuid(),
            data_Type:"stzl_question",
            createTime:new Date().toDateString(),
            AssessmentCheckItem_uuid:item._id,
            AssessmentCheckItemID:item.AssessmentCheckItemID
          },answer));
          stzlServices.setLastScore(item);
          item.isCheck=true;
          var _db= db('stzl_'+params.AssessmentID);
          _db.addOrUpdate(vm.Assessment).then(function(){
            utils.confirm('前往拍照或返回',ev,'拍照','').then(function(){
            },function(r){
            })
          },function(){
            utils.alert("数据保存失败!");
          })
        };
      }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/17.
 */
(function() {
  'use strict';

  sctbdetailController.$inject = ["$stateParams", "remote", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('sctbdetailController', sctbdetailController);

  /** @ngInject */
  function sctbdetailController($stateParams,remote,$rootScope) {
    var vm = this;
    remote.Assessment.GetMeasureIndexMeasureInfo_new($stateParams.recordId,$stateParams.itemId,$stateParams.MeasureRecordID).then(function (result) {
      vm.data = result.data;
      vm.procedure=$stateParams.AcceptanceItemID;
      if (vm.data.Region){
        $rootScope.title = vm.data.Region.FullRegionName + (vm.data.Region.HouseTypeName?'('+vm.data.Region.HouseTypeName+')':'');
        vm.regionId=$stateParams.recordId;
      }else {
        $rootScope.title="";
      }
    });
    vm.back = function () {
      history.go(-1);
    }
  }

})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  'use strict';

  scdController.$inject = ["$scope", "remote", "xhUtils", "$stateParams", "utils", "$mdDialog", "$state", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('scdController',scdController)
  /** @ngInject */
  function scdController($scope,remote,xhUtils,$stateParams,utils,$mdDialog,$state,$rootScope) {
    var vm = this;
    vm.info = {
      name: $stateParams.name,
      areaId:$stateParams.areaId,
      acceptanceItemID: $stateParams.acceptanceItemID,
      regionId: $stateParams.regionId,
      regionType: $stateParams.regionType,
      aItem:{
        MeasureItemName:$stateParams.pname,
        AcceptanceItemID:$stateParams.acceptanceItemID
      }
    };
    $rootScope.title = vm.info.aItem.MeasureItemName;
    remote.ProjectQuality.getNumber(vm.info.acceptanceItemID,vm.info.regionId).then(function(result){
      vm.info.Numbers = result.data;
      vm.info.t = result.data[0].MeasureRecordID;
    });

    $scope.$watch('vm.info.t',function(){
      if(vm.info.t){
        remote.ProjectQuality.getMeasureCheckResult(vm.info.t).then(function(rs){
          console.log('rs',rs);
          vm.alItem = rs.data;
          vm.person = rs.data[0].MeasureUserName;
          vm.time = rs.data[0].MeasureTime;
          vm.rowslength = rs.data.length;
          var cols=[];
          var l=0;
          rs.data.forEach(function(item){
            //console.log('rs',item);
            if(item.ResultStatus == 1){
              item.passText = "验收合格"
            }else if(item.ResultStatus == 2){
              item.passText = "验收不合格"
            }
            item.cols = item.Points.length;
            if(item.cols>l)l=item.cols;
          })

          rs.data.forEach(function(item){
              while(item.Points.length<l){
                item.Points.push({});
              }
          })
          vm.cols =l;
          if((vm.cols +5)%4 != 0){
            vm.twoCols = Math.floor((vm.cols +5)/4) +1;
            vm.oneCols =(vm.cols +5) -2*vm.twoCols;
          }else{
            vm.twoCols = (vm.cols +5)/4;
            vm.oneCols = 2*vm.twoCols;
          }
        })
      }
    })
  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  'use strict';

  scController.$inject = ["$scope", "remote", "xhUtils", "$stateParams", "utils", "$mdDialog", "$state", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('scController',scController)
  /** @ngInject */
  function scController($scope,remote,xhUtils,$stateParams,utils,$mdDialog,$state,$rootScope) {
    var vm = this;
    vm.info = {
      name: $stateParams.name,
      areaId:$stateParams.areaId,
      acceptanceItemID: $stateParams.acceptanceItemID,
      //regionId: $stateParams.regionId,
      //regionType: $stateParams.regionType,
      aItem:{
        MeasureItemName:$stateParams.pname,
        AcceptanceItemID:$stateParams.acceptanceItemID
      }
    };
    $rootScope.title = vm.info.aItem.MeasureItemName;
    vm.setRegionId = function(regionId,regionType){
      switch (regionType) {
        case '8':
          remote.Project.getFloorDrawing(regionId).then(function (r) {
            if(r.data.length) {
              vm.info.imageUrl = r.data[0].DrawingImageUrl;
              vm.info.regionId = regionId;
              vm.info.regionType = regionType;
            }
            else{
              utils.alert('未找到图纸');
            }
          });
          break;
        case '16':
          remote.Project.getHouseDrawing(regionId).then(function (r) {
            if(r.data.length) {
              vm.info.imageUrl = r.data[0].DrawingImageUrl;
              vm.info.regionId = regionId;
              vm.info.regionType = regionType;
            }
            else{
              utils.alert('未找到图纸');
            }
          });
          break;
      }
    }

    vm.nextRegion = function(prev){
      xhUtils.getRegion(vm.info.areaId,function(r){
        var find = r.find(vm.info.regionId);
        if(find){
          var next = prev?find.prev():find.next();
          if(next) {
            vm.info.name = next.FullName;
            //vm.info.regionId = next.RegionID;
            vm.setRegionId(next.RegionID,vm.info.regionType);
          }
          else{
            utils.alert('未找到'+(prev?'上':'下')+'一位置');
          }
        }
      });
    };
    //console.log('acceptanceItemID',vm.info.acceptanceItemID )
    remote.Measure.MeasureIndex.query (vm.info.acceptanceItemID).then (function (r) {
      var m=[];
      r.data.forEach(function(item){
        if(item.IndexName=='结构立面垂直度'|| item.IndexName=='结构表面平整度') {
          var fd = m.find(function (k) {
            return k.IndexName == '结构立面';
          });
          if (!fd) {
            fd = {
              AcceptanceIndexID: 'a',
              IndexName: '结构立面',
              cds: []
            }
            m.push(fd);
          }
          if(item.IndexName=='结构立面垂直度')
            item.IndexName='垂直度';
          if(item.IndexName=='结构表面平整度')
            item.IndexName='平整度';


          fd.cds.push(item);
        }
        else if(item.IndexName=='立面垂直度'|| item.IndexName=='表面平整度') {
          var fd = m.find(function (k) {
            return k.IndexName == '立面/表面';
          });
          if (!fd) {
            fd = {
              AcceptanceIndexID: 'a',
              IndexName: '立面/表面',
              cds: []
            }
            m.push(fd);
          }
          if (item.IndexName == '立面垂直度')
            item.IndexName = '立面';
          if (item.IndexName == '表面平整度')
            item.IndexName = '表面';
          fd.cds.push(item);
        }
        else if(item.IndexName=='阴阳角方正度度'|| item.IndexName=='阴阳角直线度度') {
          var fd = m.find(function (k) {
            return k.IndexName == '阴阳角';
          });
          if (!fd) {
            fd = {
              AcceptanceIndexID: 'a',
              IndexName: '阴阳角',
              cds: []
            }
            m.push(fd);
          }
          fd.cds.push(item);
        }
        else{
          m.push(item);
        }
      });
      vm.MeasureIndexes = m;
    });
    vm.submit = function(){
      if(vm.project){
        var items=[];
        for(var k in vm.project._featureGroups){
          var p = vm.project._featureGroups[k],
            o = p.layer.options;
          if(!items.find(function(t){return t.regionId== o.regionId})){
            items.push({
              regionId: o.regionId,
              regionName: o.regionName
            })
          }
        }
        $mdDialog.show({
            fullscreen:true,
            controller: ["$scope", "$mdDialog", "items", function($scope,$mdDialog,items){
              items.forEach(function(item){
                item.checked = true;
              })
              $scope.items = items;
              $scope.answer = function() {
                var vs=[];
                items.forEach(function(item){
                  if(item.checked){
                    vs.push({
                      AcceptanceItemID:vm.info.acceptanceItemID,
                      CheckRegionID:item.regionId,
                      RegionType:vm.info.regionType
                    })
                  }
                });
                if(vs.length) {
                  remote.ProjectQuality.MeasurePoint.submit(vs).then(function(r){
                    $mdDialog.hide();
                  });
                }
                else{
                  $mdDialog.hide();
                }

              };
              $scope.cancel = function() {
                $mdDialog.cancel();
              };
            }],
            locals:{
              items:items
            },
            template: '<md-dialog>\
            <md-toolbar>\
            <div class="md-toolbar-tools">\
          <h2>请选择提交项目</h2>\
          <span flex></span>\
          </div>\
          </md-toolbar>\
          <md-dialog-content style="min-width:320px;max-height:410px; ">\
          <md-list>\
          <md-list-item ng-repeat="topping in items">\
          <p> {{ topping.regionName }} </p>\
          <md-checkbox class="md-secondary" ng-model="topping.checked"></md-checkbox>\
          </md-list-item>\
          </md-list>\
          </md-dialog-content>\
            <md-dialog-actions layout="row">\
            <md-button ng-click="cancel()">取消</md-button>\
          <span flex></span>\
            <md-button ng-click="answer()" style="margin-right:20px;" >\
            提交\
          </md-button>\
          </md-dialog-actions>\
          </md-dialog>'
          })
          .then(function() {
            $state.go('app.xhsc.choose')
          }, function() {

          });
      }
    }
    vm.setRegionId($stateParams.regionId,$stateParams.regionType);
  }
})();

/**
 * Created by jiuyuong on 2016-5-3.
 */
(function(){
  'use strict';

  sc2Controller.$inject = ["$scope", "$rootScope", "xhUtils", "$stateParams", "utils", "$mdDialog", "db", "pack", "sxt", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('sc2Controller',sc2Controller)
  /** @ngInject */
  function sc2Controller($scope,$rootScope,xhUtils,$stateParams,utils,$mdDialog,db,pack,sxt,$timeout) {
    var vm = this;
    vm.info = {
      db:$stateParams.db,
      name: $stateParams.name,
      areaId:$stateParams.areaId,
      acceptanceItemID: $stateParams.measureItemID,
      regionId: $stateParams.regionId,
      regionType: $stateParams.regionType,
      aItem:{
        MeasureItemName:$stateParams.pname,
        AcceptanceItemID:$stateParams.measureItemID
      },
      tooltip:''
    };
    $rootScope.title = vm.info.aItem.MeasureItemName;
    var packdb = db('pack'+vm.info.db);
    packdb.get('GetMeasureItemInfoByAreaID').then (function (r) {
      //console.log('r',r)
      var find = r.data.find(function (it) {
        return it.AcceptanceItemID == vm.info.acceptanceItemID;
      });
      if(!find){ //TODO:一般不可能找不到,找不到肯定后台有问题,这里可能需要提示并去掉
        find = r.data.find(function () {
          return true;
        })
      }
      var m=[];
      find.MeasureIndexList.forEach(function(item) {
        m.push(item);
      });
      vm.MeasureIndexes = m;
      vm.MeasureIndexes.forEach(function(t){
        t._id = sxt.uuid();//指标结构表
        t.checked = false;
      })
      $timeout(function () {
        vm.scChoose();
      },500);

    },function(err){

    });

    //var docClick = function(e){
    //  var target = $(e.target);
    //  if(target.closest("#scchoose").length == 0){
    //    //$(element).find('.numberpanel').css('display','none');
    //    history.go(-1);
    //    $mdDialog.cancel();
    //  }
    //}
    vm.scChoose = function($event){
      $mdDialog.show({
          controller: ['$scope','$mdDialog',function($scope, $mdDialog) {
            $scope.checkSc = function(sc){
              vm.MeasureIndexes.forEach(function (it) {
                it.checked =false;
              })
              sc.checked = true;
              $scope.answer([sc]);
            };
            $scope.scList = vm.MeasureIndexes;
            $scope.getIsChecked = function () {
              return !$scope.scList.find(function (r) {
                return r.checked;
              })
            }
            $scope.hide = function () {
              $mdDialog.hide();
            };
            $scope.cancel = function () {
              $mdDialog.cancel();
            };
            $scope.answer = function (answer) {
              $mdDialog.hide(answer);
            };
          }],
          targetEvent:$event,
          templateUrl: 'app/main/xhsc/ys/scChoose.html',
          parent:angular.element('#content'),
        clickOutsideToClose:vm.info.MeasureIndexes//&&vm.info.MeasureIndexes[0].checked
        })
        .then(function(answer) {
          var scStr=[];
          answer.forEach(function(t){
            if(t.checked ==  true){
              scStr.push(t);
            }
          });
          vm.info.MeasureIndexes = scStr;
          var ms=[];

          vm.info.MeasureIndexes.forEach(function (m) {
            ms.push(m);
            if(m.Children && m.Children.length){
              m.Children.forEach(function (m1) {
                ms.push(m1);
              });
            }
          });
          ms.forEach(function (m) {
            //系统中仅有"门洞尺寸"的"厚"和"宽"需要处理抹灰厚度问题
            if(m.AcceptanceIndexID=='8043e1a4efa942babdb87c5ad5116737'||m.AcceptanceIndexID=='500dc59be8d44458b6fd7940d2c54adc'){
              m.plasterDepth = vm.plasterDepth;
              m.plasterDepthMethod = m.AcceptanceIndexID=='8043e1a4efa942babdb87c5ad5116737'?'+':'-'
            }
          });
          vm.submit();
         });
    }

    vm.setRegionId = function(regionId,regionType){
      packdb.get('GetRegionTreeInfo').then(function (result) {
        var region = xhUtils.findRegion([result.data],regionId),
          ld = xhUtils.findRegion([result.data],regionId.substring(0,15));
        vm.plasterDepth = ld?ld.PlasterDepth:0;
        vm.setRegion(region);
      });
    }
    vm.setRegion = function(region){
        vm.info.imageUrl = region.DrawingID;
        vm.info.regionId = region.RegionID;
        vm.info.regionType = region.RegionType;
        vm.info.name = region.fullName;
    }
    vm.submit = function (ev) {
/*      $mdDialog.show($mdDialog.confirm()
        .title('提交？')
        .textContent('确定完成提交当前指标测试数据吗？')
        .ariaLabel('提交？')
        .targetEvent(ev)
        .ok('确定')
        .cancel('取消')).then(function () {*/
        var indexs = pack.sc.up(vm.info.db).indexs.db;
        vm.info.MeasureIndexes.forEach(function (m) {
          var ms = [];
          if(m.Children && m.Children.length){
            m.Children.forEach(function (it) {
              ms.push(it);
            })
          }
          else{
            ms.push(m);
          }
          ms.forEach(function (m) {
            if(!m._id)
              m._id = sxt.uuid();

            indexs.addOrUpdate({
              _id: m._id,
              RegionId: vm.info.regionId,
              RegionType:vm.info.regionType,
              AcceptanceIndexID: m.AcceptanceIndexID,
              AcceptanceItemID: vm.info.acceptanceItemID,
              IndexResultID:m._id,
              RecordType:4,
              RelationID:vm.info.db,
              Status: 1
            });
          });
        })
/*      }, function () {

      });*/

    }

    vm.nextRegion = function(prev){
      //vm.info.regionId 当前
      packdb.get('GetRegionTreeInfo').then(function (result) {
        var  rr=xhUtils.wrapRegion(result.data);
        var region = xhUtils.findRegion([rr],vm.info.regionId);
        if (region){
          var next=prev?region.prev():region.next();
          if (!next){
            utils.alert("查无数据!");
            return;
          }
          vm.setRegion(next);
        }
      });
    };

    vm.setRegionId($stateParams.regionId);

  }
})();

/**
 * Created by emma on 2016/4/29.
 */
(function(){
  'use strict';

  glxwSettingController.$inject = ["$mdDialog", "$rootScope", "$scope", "utils", "$stateParams", "remote"];
  angular
    .module('app.xhsc')
    .controller('glxwSettingController',glxwSettingController);

  /** @ngInject*/
  function glxwSettingController($mdDialog,$rootScope,$scope,utils,$stateParams,remote){
    var vm = this;
    var params={
      AssessmentID:$stateParams.AssessmentID,
      AssessmentTypeID:$stateParams.AssessmentTypeID
    };
    remote.Assessment.query().then(function (result) {
      var item = result.data.find(function (a) {
        return a.AssessmentID==params.AssessmentID;
      });
      vm.items = {
        AssessmentClassifys:[]
      };
      vm.Assessment = item.AssessmentTypes.find(function (t) {
        return t.AssessmentTypeID== params.AssessmentTypeID;
      });
      vm.Assessment.AssessmentClassifys.forEach(function (cls) {
        vm.items.AssessmentClassifys.push({
          AssessmentClassificationName:cls.AssessmentClassificationName
        });
      });
      $scope.$watch('vm.selectedIndex',function () {
        if(typeof vm.selectedIndex!= 'undefined'){
          var k = vm.items.AssessmentClassifys[vm.selectedIndex];
          if(k.AssessmentClassifys==null){
            k.AssessmentClassifys = vm.Assessment.AssessmentClassifys[vm.selectedIndex].AssessmentClassifys;
          }
        }
      })
    }).catch(function () {
      utils.alert('失败：服务器返回错误');
    });

    vm.getW = function (level,t) {
      if(level==1){
        return 25.0/t;
      }
      else{
        return 25.0/t /(100 - vm.getW(level-1,t))*100;
      }
    }

    function getEvels(item,level) {
      if(item.AssessmentClassifys && item.AssessmentClassifys.length){
        var levels = [],max=0;
        item.AssessmentClassifys.forEach(function (item) {
          levels.push(getEvels(item,level));
        });
        //console.log('levels',levels)
        levels.forEach(function (l) {
          if(max<l)
            max = l;
        });
        return max;
      }
      return level+1;
    }

    vm.getDelValue = function (item) {
      //console.log('a')
      var s=0,time=0;
      if(item.regions){
        item.regions.forEach(function (r) {
          if(r.question){
            r.question.forEach(function (q) {
              s+=(q.DeductionScore||0);
              time++;
            });
          }
        });
        if(s >item.Weight)
          s=item.Weight;
      }
      if(item.MaxDeductNumber &&  time>=item.MaxDeductNumber){
        item.Score = 0;
        return item.Weight;
      }
      else if(s!=0) {
        item.Score = item.Weight - s;
        if (item.Score < 0)
          item.Score = 0;
        return s;
      }
      else if(item.done){
        item.Score = item.Weight;
        return 0;
      }
      item.Score = '';
      return ''
    }
  }
})();

/**
 * Created by emma on 2016/4/29.
 */
(function(){
  'use strict';

  evaluatelistPcController.$inject = ["$scope", "$stateParams", "xhUtils", "remote", "$mdDialog", "utils", "$q", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('evaluatelistPcController',evaluatelistPcController);

  /** @ngInject*/
  function evaluatelistPcController($scope,$stateParams,xhUtils,remote,$mdDialog,utils,$q,$timeout){
    var vm = this;
    var params={
      year:$stateParams.year,
      projectID:$stateParams.projectID,
      quarter:$stateParams.quarter,
      assessmentStage:$stateParams.assessmentStage
    };
    vm.params =params;
    $q.all([
      remote.Assessment.queryReport(params.year,params.quarter,params.projectID,params.assessmentStage),
      remote.Assessment.queryProjectRegionInfo(params.projectID)
    ]).then(function(result){
        var  r=result[0];
        var  prj=result[1];
        onQueryBase(r.data,prj.data);
    },function(error){

    })
    //remote.Assessment.queryReport(params.year,params.quarter,params.projectID).then(function(r){
    //   onQueryBase(r.data);
    //});
    remote.Assessment.queryTotalReport(params.year,params.quarter,params.projectID,params.assessmentStage).then(function(t){
        vm.toTalReport= t.data;
        setRoleScore();
    });
    function setRoleScore(){
      vm.prjScores=[];
      vm.jlScores=[];
      vm.zbScores=[];
      vm.toTalReport.Sections.sort(xhUtils.sort(function (s) {
        return s.SectionName;
      }));
      vm.toTalReport.Sections.forEach(function(r){
        vm.prjScores.push(findRole(4, r.SectionID));
        vm.prjScores.avg=avg(vm.prjScores);
        vm.jlScores.push(findRole(2, r.SectionID));
        vm.jlScores.avg=avg(vm.jlScores);
        vm.zbScores.push(findRole(1, r.SectionID));
        vm.zbScores.avg=avg(vm.zbScores);
        vm.toTalReport.AssessmentTypes.forEach(function(k){
          SetTypeScore(k, r.SectionID);
        });
      });
    }
    function SetTypeScore(assessmentCategory,sectionID){
        var sections=assessmentCategory.CategorySections;
        if (angular.isArray(sections)){
            var  z=[];
            if (angular.isArray(assessmentCategory.sectionScore)){
              z=assessmentCategory.sectionScore;
            }
            var  t=sections.find(function(t){
               return t.SectionID==sectionID;
            });
            if (!t){
              z.push({
                SectionID:sectionID
              });
            }else {
              z.push(t);
            }
            assessmentCategory.sectionScore=z;
        }
        if (angular.isArray(assessmentCategory.AssessmentCategorys)){
          assessmentCategory.AssessmentCategorys.forEach(function(k){
            SetTypeScore(k,sectionID);
          });
        }
    }

    function avg(arr){
      var score=0,l=0;
      if (angular.isArray(arr)){
        arr.forEach(function(t) {
          if (t.Score === 0)t.Score = '';
          if (t.Score) {
            l++;
            score = score ? score + t.Score : t.Score;
          }
        });
      }
      if (score){
        return (score/l).toFixed(4);
      }
      return "";
    }
    function findRole(roleType,sectionID){
        var role= vm.toTalReport.AssessmentRoles.find(function(t){
            return t.RoleType==roleType;
        });
        if (role){
            return role.SectionScores.find(function(t){
               return t.SectionID==sectionID;
            });
        }
        return {};
    }

    function onQueryBase(item,region) {
      //管理行为界面控制开关
      vm.showfitObj=false;
      item.Assessments.sort(xhUtils.sort(function (s) {
        return s.SectionName;
      }));
      vm.sections=item.Assessments;
      vm.items = {
        AssessmentClassifys:[]
      };
      vm.caches = {
        AssessmentClassifys:[]
      }

      function  setshow(o){
        o.show=false;
        if(angular.isArray(o.AssessmentItems)&& o.AssessmentItems.length>0){
          for(var i=0;i<o.AssessmentItems.length;i++){
            var x= o.AssessmentItems[i].AssessmentItemResults;
            if (angular.isArray(x)&& x.length>0){
              o.AssessmentItems[i].show=o.show=true;
            }
          }
        }else {
          if (angular.isArray(o.AssessmentClassifys)&& o.AssessmentClassifys.length>0){
              for (var i=0;i<o.AssessmentClassifys.length;i++){
                if (setshow(o.AssessmentClassifys[i])){
                  o.show=true;
                }
              }
          }
        }
        return o.show;
      }

      function  gl_setshow(o){
        o.show=false;
        if(angular.isArray(o.AssessmentItems)&& o.AssessmentItems.length>0){
          for(var i=0;i<o.AssessmentItems.length;i++){
             o.AssessmentItems[i].show=o.show=true;
          }
        }else {
          if (angular.isArray(o.AssessmentClassifys)&& o.AssessmentClassifys.length>0){
            for (var i=0;i<o.AssessmentClassifys.length;i++){
              if (gl_setshow(o.AssessmentClassifys[i])){
                o.show=true;
              }
            }
          }
        }
        return o.show;
      }

      item.AssessmentTypes.forEach(function (t) {
          t.AssessmentClassifys.forEach(function (cls) {
            vm.items.AssessmentClassifys.push({
              AssessmentClassificationName:cls.AssessmentClassificationName,
              show:true
            });
            cls.show=true;
            vm.caches.AssessmentClassifys.push(cls);
          });
      });
      fillRegion(vm.caches,item.Assessments,region);

      $scope.$watch('vm.selectedIndex',function () {
        vm.loading = true;
        vm.showfitObj =false;
        $timeout(function () {
          if(vm.selectedIndex>=0&&vm.selectedIndex<vm.items.AssessmentClassifys.length){
            var k = vm.items.AssessmentClassifys[vm.selectedIndex];

            vm.isAddScore=k.AssessmentClassificationName.indexOf("加分")!=-1;
            vm.isDScore = k.AssessmentClassificationName.indexOf("扣分")!=-1;
            vm.showfitObj= vm.isAddScore || vm.isDScore || k.AssessmentClassificationName.indexOf("管理行为")!=-1;
            if (!k.AssessmentClassifys){
              var assessmentClassifys= vm.caches.AssessmentClassifys[vm.selectedIndex].AssessmentClassifys;
              if (k.AssessmentClassificationName.indexOf("管理行为")!=-1
              ||k.AssessmentClassificationName.indexOf("加分")!=-1 ||k.AssessmentClassificationName.indexOf("扣分")!=-1
              ){
                assessmentClassifys.forEach(function(t){
                  gl_setshow(t);
                });
                //vm.showfitObj=true;
              }else {
                assessmentClassifys.forEach(function(t){
                  setshow(t);
                });
              }
              k.AssessmentClassifys =assessmentClassifys;
              k.level = getEvels(k,1);
            }
          }else {
            remote.Assessment.queryTotalReport(params.year,params.quarter,params.projectID,params.assessmentStage).then(function(t){
              vm.toTalReport= t.data;
              setRoleScore();
            });
          }
          $timeout(function () {
            vm.loading = false;
            if(!vm.inited)
              vm.inited = true;
          },200);
        },800);

      })
    }

    function setPath(item,_region,region){
        var parent= region.find(function(t){
            return _region.ParentID== t.RegionID&& t.RegionType>2;
        });
        if (parent){
            item.RegionName=parent.RegionName+">"+item.RegionName;
            setPath(item,parent,region);
        }
    }

    function fillRegion(k,sections,region) {
      if(k.AssessmentItems){
        k.AssessmentItems.forEach(function (item) {
          item.scoreList=[];
          var resultItem = item.AssessmentItemResults;
          var itemResult,tmp,sectionScore;
          sections.forEach(function(t){
            sectionScore={
              sectionID: t.SectionID,
              ModifyScore:"",
              DelScore:"",
              Description:""
            }
            //Description
            if (angular.isArray(resultItem)&&resultItem.length>0){
              itemResult=resultItem.find(function(k){
                return k.SectionID== t.SectionID;
              });
              if (itemResult){
                tmp=itemResult.ModifyScore;
                if (!tmp&&tmp!==0){
                  tmp=itemResult.TotalScore;
                }
                sectionScore.ModifyScore=tmp;
                tmp=item.Weight-sectionScore.ModifyScore;
                sectionScore.Weight = item.Weight;
                sectionScore.DelScore=tmp;
                sectionScore.Description=itemResult.Description;
                if (angular.isArray(itemResult.AssessmentRegionItemResults)){
                  var _region;
                  itemResult.AssessmentRegionItemResults.forEach(function(q){
                      _region=region.find(function(v){
                          return v.RegionID==q.RegionID;
                      })
                      if (_region){
                        setPath(q,_region,region);
                      }
                  })
                }
              }
            }else {
              sectionScore.ModifyScore= 0;
            }
            item.scoreList.push(sectionScore);
          });

        });
      }
      if(k.AssessmentClassifys){
        k.AssessmentClassifys.forEach(function (c) {
          fillRegion(c,sections,region);
        })
      }
    }
    vm.bindSectionScore=function(item,sectionID,field){
        var scoreList=item.scoreList;
        var score;
        if (angular.isArray(scoreList)&&scoreList.length>0){
          score= scoreList.find(function(t){
            return t.sectionID==sectionID;
          });
          if (score){
            if(field=='DelScore'){
              if(vm.isAddScore || vm.isDScore){
                field = 'ModifyScore';
              }
            }else if(field=='ModifyScore'){
              if(vm.isDScore) return '';
            }
            return score[field];
          }
        }
        return "";
    }

    vm.showkf=function(item,sectionID,field){
      var kf= vm.bindSectionScore(item,sectionID,field);
      return  angular.isNumber(kf);
    }
    vm.showfitlogol=function(item,sectionID,field){
      var kf= vm.bindSectionScore(item,sectionID,field);
      return  angular.isNumber(kf)&&kf!=0;
    }
    vm.getSectionName=function(sectionID){
        var section=vm.sections.find(function(o){
            return o.SectionID==sectionID;
        });
        return section?section.SectionName:"";
    }
    vm.getW = function (level,t) {
      if(level==1){
        return 10.0/t;
      }
      else{
        return 10.0/t /(100 - vm.getW(level-1,t))*100;
      }
    }

    function getEvels(item,level) {
      if(item.AssessmentClassifys && item.AssessmentClassifys.length){
        var levels = [],max=0;
        item.AssessmentClassifys.forEach(function (item) {
          levels.push(getEvels(item,level));
        });
        levels.forEach(function (l) {
            if(max<l)
              max = l;
        });
        return max;
      }
      return level+1;
    }

    vm.quesDetail = function(item,region,ev) {
      var images=[];
      region.DeductScoreItems.forEach(function(item){
        item.Images.forEach(function (img) {
          images.push({
            url:sxt.app.fs+img.ImageUrl,
            alt:item.ProblemDescription + (item.PartDescriptioin?'(部位:'+ item.PartDescriptioin+')':'')
          });
        })
      })

      if(images.length)
      {
        xhUtils.playPhoto(images);
      }
     else
      {
        $mdDialog.show({
          controller: ['$scope','$mdDialog',function ($scope, $mdDialog) {
            $scope.item=item;

            $scope.cancel = function(){
              $mdDialog.hide()
            }
          }],
          templateUrl:'app/main/xhsc/ys/pcQuestion.html',
          parent: angular.element(document.body),
          targetEvent: ev,
          clickOutsideToClose:true,
          focusOnOpen:false
        })
      }

    }

    vm.deleteScoreItem = function (q) {
      console.log('q',q)
    }
    vm.changeScore = function (item,k,$event) {
      console.log(item);
      var obj= item.scoreList.find(function(v){
        return v.sectionID== k.SectionID;
      });
      $mdDialog.show(
        {
          controller: ['$scope','$mdDialog','showfitObj',function ($scope, $mdDialog,showfitObj) {
            $scope.showfitObj = showfitObj;
            $scope.cancel = function(){
              $mdDialog.hide()
            }
            $scope.item= {
              value: (vm.isAddScore||vm.isDScore)?obj.ModifyScore: obj.DelScore,
              reason:obj.Description,
              isAddScore:vm.isAddScore,
              isDScore:vm.isDScore
            }
            $scope.delScore = function(result){
              $mdDialog.hide(result)
              item.kf = result.value;
              item.des = result.reason;
            }
            $scope.noScore = function(result){
              item.kf = result.value = 0;
              item.des = result.reason ='符合要求';
              $mdDialog.hide(result);
            }
          }],
          templateUrl:'app/main/xhsc/ys/glxwInput.html',
          parent: angular.element(document.body),
          targetEvent: $event,
          clickOutsideToClose:false,
          focusOnOpen:false,
          locals :{showfitObj:vm.showfitObj}
        }
      ).then(function (result) {
        if(result){
          var r = parseFloat(result.value),
          r1 = (vm.isAddScore || vm.isDScore) ?r :  item.Weight -r
          if(!isNaN(result.value)){
            if(item.Weight<result.value || result.value<0){
              utils.alert('输入的值应该介于0 与 '+item.Weight + ' 之间');
              return;
            }
            remote.Assessment.modifyScore({
              AssessmentID:k.AssessmentID,
              AssessmentCheckItemID:item.AssessmentCheckItemID,
              ModifyScore: r1,
              Description:result.reason

            }).then(function (z) {
              if (z.data.ErrorCode==0){
                  obj.DelScore = r;
                  obj.ModifyScore = r1;
                obj.Description=result.reason;
              }else {
                utils.alert('失败：'+ z.data.ErrorMessage);
              }
            }).catch(function (z) {
              utils.alert('失败：服务器返回错误');
            })
          }
          else{
            utils.alert('应该输入半角数字');
          }
        }
      })
    }
  }
})();

/**
 * Created by emma on 2016/4/29.
 */
(function(){
  'use strict';

  evaluatelistController.$inject = ["$mdDialog", "$rootScope", "$scope", "utils", "$stateParams", "db", "sxt", "stzlServices", "xhUtils", "pack"];
  angular
    .module('app.xhsc')
    .controller('evaluatelistController',evaluatelistController);

  /** @ngInject*/
  function evaluatelistController($mdDialog,$rootScope,$scope,utils,$stateParams,db,sxt,stzlServices,xhUtils,pack){
    var vm = this;
    var params={
        AssessmentID:$stateParams.AssessmentID,
        RegionID:$stateParams.RegionID,
        RegionName:$stateParams.RegionName,
        AssessmentTypeID:$stateParams.AssessmentTypeID
    };
    var up = pack.sc.up(params.AssessmentID),
      upstzl_item = up.stzl_item.db,
      upstzl_question = up.stzl_question.db,
      upstzl_images = up.stzl_images.db;


    //vm.AssessmentTypeID = '7d179e8804a54819aad34b7a9398880d'
    vm.RegionName = $stateParams.RegionName;
    db('xcpk').get('xcpk').then(function (list) {

      var item = list.rows.find(function (it) {
        return it.AssessmentID == params.AssessmentID;
      });

      vm.items = {
        AssessmentClassifys:[]
      };
      vm.Assessment = item.AssessmentTypes.find(function (t) {
        return t.AssessmentTypeID== params.AssessmentTypeID;
      });
     if(vm.Assessment&&vm.Assessment.AssessmentClassifys){
        vm.Assessment.AssessmentClassifys.forEach(function (cls) {
          vm.items.AssessmentClassifys.push({
            AssessmentClassificationName:cls.AssessmentClassificationName
          });
        });
        $scope.$watch('vm.selectedIndex',function () {
          if(typeof vm.selectedIndex!= 'undefined'){
            var k = vm.items.AssessmentClassifys[vm.selectedIndex];
            if(k.AssessmentClassifys==null){
              k.AssessmentClassifys = vm.Assessment.AssessmentClassifys[vm.selectedIndex].AssessmentClassifys;
              upstzl_item.findAll(function (r) {
                return r.RegionID == params.RegionID;
              }).then(function (items) {
                upstzl_question.findAll(function (r) {
                  return !!items.rows.find(function (q) {
                    return q.AssessmentRegionItemResultID==r.AssessmentRegionItemResultID;
                  })
                }).then(function (questions) {
                  fillRegion(k,items,questions);
                });
              })
              //var
              //k.AssessmentClassifys.push({
              //
              //})
              k.level = getEvels(k,1);
            }
          }
        })
      }
    });

    function fillRegion(k,items,question) {
      if(k.AssessmentItems){
        k.AssessmentItems.forEach(function (item) {
          var q = items.rows.find(function (p) {
            return p.RegionID == params.RegionID
             && p.AssessmentCheckItemID==item.AssessmentCheckItemID
          });
          if(!q) {
            item.regions = [
              {
                _id: sxt.uuid(),
                RegionName: params.RegionName,
                RegionID: params.RegionID,
                question: []
              }
            ];
          }
          else{
            var qs = [];
            question.rows.forEach(function (item2) {
              var q = qs.find(function (q) {
                return q.ProblemID==item2.ProblemID
                && q.AssessmentCheckItemID == item2.AssessmentCheckItemID
                && q.RegionID == item2.RegionID
                  && q.DeducScoretItemID == item2.DeducScoretItemID;
              });
              if(!q && item2.AssessmentCheckItemID==item.AssessmentCheckItemID){
                qs.push(item2)
              }
              else if(q){
                q.DeductionScore+=item2.DeductionScore;
              }
            });
            item.regions = [
              {
                _id:q.AssessmentRegionItemResultID,
                RegionName: params.RegionName,
                RegionID: params.RegionID,
                question:qs
              }
            ]
            item.Score= q.Score;
            item.done= q.Score==item.Weight
          }
        });
      }
      if(k.AssessmentClassifys){
        k.AssessmentClassifys.forEach(function (c) {
          fillRegion(c,items,question);
        })
      }
    }




    vm.getW = function (level,t) {
      if(level==1){
        return 25.0/t;
      }
      else{
        return 25.0/t /(100 - vm.getW(level-1,t))*100;
      }
    }

    function getEvels(item,level) {
      if(item.AssessmentClassifys && item.AssessmentClassifys.length){
        var levels = [],max=0;
        item.AssessmentClassifys.forEach(function (item) {
          levels.push(getEvels(item,level));
        });
        //console.log('levels',levels)
        levels.forEach(function (l) {
            if(max<l)
              max = l;
        });
        return max;
      }
      return level+1;
    }

    //vm.images = [
    //  {url:'assets/images/etc/plug.png'},
    //  {url:'assets/images/etc/fallout.jpg'},
    //  {url:'assets/images/etc/fallout.jpg'}
    //];
    var deleteFn = function(d,data){
      //vm.images.splice(data,1);
      $scope.$apply();
     // console.log('a',vm.images)
    }
    vm.fit = function(item,it){
      it.done=true;
      var rn = it.regions.find(function (r) {
        return r.RegionID == params.RegionID;
      });
      upstzl_item.addOrUpdate({
        _id:rn._id,
        AssessmentRegionItemResultID:rn._id,
        AssessmentID:params.AssessmentID,
        RegionID:rn.RegionID,
        Score: it.Weight,
        AssessmentCheckItemID:it.AssessmentCheckItemID,
        done:it.done,
        CreateTime:new Date()
      });
    }
    vm.unfit = function(item,it){
      it.done=false;
      var rn = it.regions.find(function (r) {
        return r.RegionID == params.RegionID;
      });
      upstzl_item.delete(rn._id);
    }
    vm.getDelValue = function (item) {
      var s=0,time=0;
      if(item.regions){
        item.regions.forEach(function (r) {
          if(r.question){
            r.question.forEach(function (q) {
              s = utils.math.sum(parseFloat(q.DeductionScore)||0,s);
              time++;
            });
          }
        });
        if(s >item.Weight)
        s=item.Weight;
      }
      if(item.MaxDeductNumber &&  time>=item.MaxDeductNumber){
        item.Score = 0;
        return item.Weight;
      }
      else if(s!=0 || time!=0) {
        item.Score = item.Weight - s;
        if (item.Score < 0)
          item.Score = 0;
        return s;
      }
      else if(item.done){
        item.Score = item.Weight;
        return 0;
      }
      item.Score = '';
      return ''
    }
    $rootScope.$on('delete',deleteFn);
    vm.quesDetail = function(item,it,items){
      $mdDialog.show({
        controller:["$scope", function($scope){
          $scope.item = item;
          upstzl_question.findAll(function (q) {
            return q.AssessmentRegionItemResultID==item.AssessmentRegionItemResultID
            && q.ProblemID==item.ProblemID
              && q.DeducScoretItemID == item.DeducScoretItemID;
          }).then(function (r) {
            $scope.items = r.rows;
            $scope.images = [];
            upstzl_images.findAll(function (img) {
              return !!r.rows.find(function (r) {
                return r.DeducScoretItemID==img.RelationID;
              })
            }).then(function (imgs) {
              imgs.rows.forEach(function (img) {
                var f = r.rows.find(function (r1) {
                  return r1.DeducScoretItemID==img.RelationID;
                });
                f.images = f.images||[];
                f.images.push(img);
                $scope.images.push(img);
              });
            })
          });

          $scope.delete = function(d){
            //upstzl_question.delete(item);
            upstzl_question.findAll(function(it){
              return it.RegionID == d.RegionID
              && it.AssessmentRegionItemResultID== d.AssessmentRegionItemResultID
              && it.ProblemID== d.ProblemID
              && it.DeducScoretItemID == d.DeducScoretItemID;
            }).then(function(r){
             // upstzl_question.delete(r);
              r.rows.forEach(function(item){
                upstzl_question.delete(item._id).then(function(){
                  //console.log('ok')
                }).catch(function(){}
                )
              });
              var idx = items.indexOf(item);
              items.splice(idx,1);
            })

            //if($scope.question.length <=0){
              $mdDialog.hide()
           // }
          }
          $scope.cancel = function(){
            $mdDialog.hide()
          }
          $scope.addPhoto = function(q){
            xhUtils.photo().then(function (image) {
              if(image){
                var _id = sxt.uuid();
                upstzl_images.addOrUpdate({
                  _id:_id,
                  ImageID: sxt.uuid(),
                  RelationID: item.DeducScoretItemID,
                  ImageName:_id+".jpeg",
                  ImageUrl:_id+".jpeg",
                  ImageByte: image
                });
              }
            })
          }
        }],
        templateUrl:'app/main/xhsc/ys/evaluateQuesDetail.html',
        parent: angular.element(document.body),
        clickOutsideToClose:true,
        focusOnOpen:false
      })
    }
    vm.check = function(item,ev){
      $mdDialog.show({
        controller: ['$scope','$mdDialog',function ($scope, $mdDialog) {
          $scope.Problems =item.Problems;
          var pScope = $scope;
          $scope.addQuestion = function(){
            $mdDialog.show({
              controller:['$scope',function($scope){
                $scope.cancel = function(){
                  $mdDialog.hide();
                };
                $scope.data={
                  ProblemID:sxt.uuid()
                }
                $scope.submit = function(){
                  pScope.Problems.push($scope.data);
                  pScope.answer({
                    ProblemID:$scope.data.ProblemID,
                    ProblemDescription:$scope.data.ProblemDescription,
                    DeductValue:$scope.data.DeductValue || 0
                  });
                }
              }],
              templateUrl:'app/main/xhsc/ys/addQuestion.html'
            })
          }
          $scope.answer = function(answer,ev) {
            if(!item.regions){
              item.regions = [];
            }
            var rn = item.regions.find(function (r) {
              return r.RegionID == params.RegionID;
            });
            var question = rn.question.find(function (p) {
              return p.ProblemID==answer.ProblemID;
            });
            var _id=sxt.uuid();
            var dedu = {
              _id:_id,
              DeducScoretItemID:_id,
              AssessmentID:params.AssessmentID,
              AssessmentRegionItemResultID:rn._id,
              RegionID:rn.RegionID,
              AssessmentCheckItemID:item.AssessmentCheckItemID,
              ProblemDescription:answer.ProblemDescription,
              ProblemID:answer.ProblemID,
              DeductionScore:answer.DeductValue,
              CreateTime:new Date(),
              hasPic:false
            };
            question = angular.extend({},dedu);
            rn.question.push(question);
            upstzl_question.addOrUpdate(dedu);

            $mdDialog.show({
              controller:['$scope',function($scope){
                $scope.data ={

                };
                $scope.cancel = function(){
                  $scope.submit();
                }
                $scope.submit = function(){
                  vm.getDelValue(item);
                  dedu.PartDescriptioin = question.PartDescriptioin = $scope.data.PartDescriptioin;

                  upstzl_question.addOrUpdate(dedu);
                  upstzl_item.addOrUpdate({
                    _id:rn._id,
                    AssessmentRegionItemResultID:rn._id,
                    AssessmentID:params.AssessmentID,
                    RegionID:rn.RegionID,
                    Score:item.Score,
                    PartDescriptioin:$scope.data.PartDescriptioin,
                    AssessmentCheckItemID:item.AssessmentCheckItemID,
                    CreateTime:new Date()
                  });
                  item.isCheck = true;
                  $mdDialog.hide();
                }
              }],
              templateUrl:'app/main/xhsc/ys/addPartDescription.html'
            }).then(function () {
              xhUtils.photo().then(function ($base64Url) {
                if($base64Url) {
                  var _id=sxt.uuid();
                  upstzl_images.addOrUpdate({
                    _id:_id,
                    ImageID: sxt.uuid(),
                    RelationID: dedu.DeducScoretItemID,
                    ImageName:_id+".jpeg",
                    ImageUrl:_id+".jpeg",
                    ImageByte: $base64Url
                  }).then(function () {
                    question.hasPic = true;
                    dedu.hasPic = true;
                    upstzl_question.addOrUpdate(dedu);

                  }, function () {
                    utils.alert("数据保存失败!");
                  });
                }
              });
            });
          };
        }],
        templateUrl:'app/main/xhsc/ys/evaluateQues.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        clickOutsideToClose:true,
        focusOnOpen:false
        })
    }
  }
})();

/**
 * Created by emma on 2016/4/28.
 */
(function(){
  'use strcit';

  evaluateController.$inject = ["$mdDialog", "$timeout", "$state", "api", "$state"];
  angular
    .module('app.xhsc')
    .controller('evaluateController',evaluateController);

  /** @ngInject*/
  function evaluateController($mdDialog,$timeout,$state,api,$state){
    var vm = this;

    vm.showECs = function(ev) {
      //var useFullScreen = ($mdMedia('sm') || $mdMedia('xs'))  && vm.customFullscreen;
     // console.log('ev',parent)
      DialogController.$inject = ["$scope", "$mdDialog"];
      $mdDialog.show({
          controller: DialogController,
          templateUrl: 'app/main/xhsc/ys/evaluateChoose.html',
          parent: angular.element(document.body),
          targetEvent: ev,
          clickOutsideToClose:true
          //fullscreen: useFullScreen
        })
        .then(function(answer) {

        });
      function DialogController($scope, $mdDialog) {
        $scope.hide = function() {
          $mdDialog.hide();
        };
        $scope.cancel = function() {
          $mdDialog.cancel();
        };
        $scope.answer = function(answer) {
          $mdDialog.hide(answer);
        };
      }

      vm.goSC=function(item){
        api.setNetwork(1).then(function(){
          $state.go('app.xhsc.ch2',{areaID:item.AreaID,areaName:item.AreaName,assessmentID:item.AssessmentID});
        });
      }
      vm.goST=function(item){
        api.setNetwork(1).then(function(){
          $state.go('app.xhsc.ch1',{areaID:item.AreaID,areaName:item.AreaName,assessmentID:item.AssessmentID,AssessmentTypeID:'7d179e8804a54819aad34b7a9398880d',typename:'实体质量'});
        });
      }
      vm.goAQ=function(item){
        api.setNetwork(1).then(function(){
          $state.go('app.xhsc.ch1',{assessmentID:item.AssessmentID,AssessmentTypeID:'82666209a15647569f9bcaff50d324c2',typename:'安全文明'});
        });
      }

    };
  }
})();

/**
 * Created by emma on 2016/5/5.
 */
(function(){
  'use strict';

  downloadController.$inject = ["$mdDialog", "db", "remote", "$rootScope", "$scope", "pack", "utils", "api", "$q", "$state"];
  angular
    .module('app.xhsc')
    .controller('downloadController',downloadController);

  /** @ngInject*/
  function downloadController($mdDialog,db,remote,$rootScope,$scope,pack,utils,api,$q,$state){
    var vm = this;
    api.setNetwork(0).then(function(){
      var xcpk = db('xcpk'),dbpics=db('pics');
      xcpk.get('xcpk').then(function (result) {
        vm.data = result;
        queryOnline();
      }).catch(function (err) {
        vm.data = {
          _id:'xcpk',
          rows:[]
        };
        queryOnline();
      });

      function projectTask(region,assessmentID) {
        var projectId=region.substr(0,5);
        return [
          function (tasks) {
            return $q(function(resolve,reject) {
              var arr=[
                remote.Project.getDrawingRelations(region),
                dbpics.findAll(),
                remote.Assessment.getCheckArea(assessmentID)
              ];
              $q.all(arr).then(function(res){
                var result=res[0],offPics=res[1].rows,chooseArea=res[2].data;
                var pics = [];
                if (chooseArea&&chooseArea.length){
                  result.data.forEach(function (item) {
                    if (chooseArea.find(function(k){
                       return  k.RegionID==item.RegionId
                      })&&pics.indexOf(item.DrawingID) == -1&&!offPics.find(function(r){
                        return r._id==item.DrawingID;
                      })) {
                      pics.push(item.DrawingID);
                    }
                  });
                  chooseArea.forEach(function (k) {
                    if (k.DrawingID&&pics.indexOf(k.DrawingID) == -1&&!offPics.find(function(r){
                        return r._id==k.DrawingID;
                      })){
                      pics.push(k.DrawingID);
                    }
                  });

                  pics.forEach(function (drawingID) {
                    tasks.push(function () {
                      return remote.Project.getDrawing(drawingID).then(function(){
                        dbpics.addOrUpdate({
                          _id:drawingID
                        })
                      });
                    })
                  });
                }
                resolve(result);
              }).catch(function(){
                reject();
              });
            })
          }
        ]
      }


      vm.download=function(item,isReflsh){
        vm.current=item;
        //下载成功回掉
        function callBack(){
          remote.Assessment.queryById(item.AssessmentID).then(function (result) {
            var ix = vm.onlines.indexOf(item);
            if (ix != -1)
              vm.onlines.splice(ix, 1);
            ix = vm.offlines.indexOf(item);
            if(ix!=-1){
              vm.offlines.splice(ix, 1);
            }
            var it1 = vm.data.rows.find(function (it) {
              return it.AssessmentID==item.AssessmentID;
            }),ix=it1?vm.data.rows.indexOf(it1):-1;
            if(ix!=-1){
              vm.data.rows.splice(ix, 1);
            }
            delete item.pack;
            var fd = vm.data.rows.find(function (a) {
              return a.AssessmentID == result.data.AssessmentID;
            }),ix=fd?vm.data.rows.indexOf(fd):-1;
            if(ix==-1) {
              vm.data.rows.push(result.data);
              vm.offlines.push(item);
            }
            else{
              vm.data.rows[ix] = result.data;
            }
            xcpk.addOrUpdate(vm.data).then(function () {
              utils.alert('下载完成');
            })
          })
        }

        $mdDialog.show({
          controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
            $scope.item=item;
            var tasks=[];
            tasks.push(function () {
              return remote.Assessment.GetMeasureItemInfoByAreaID(item.ProjectID,"pack"+item.AssessmentID);
            });
            tasks.push(function () {
              return remote.Assessment.GetRegionTreeInfo(item.ProjectID,"pack"+item.AssessmentID);
            });
            tasks = tasks.concat(projectTask(item.AreaID,item.AssessmentID));
            item.percent = item.current =0; item.total = tasks.length;
            api.task(tasks,{
              event:'downloadxc',
              target:item
            })(null,function () {
              if (!isReflsh){
                callBack();
              }else {
                utils.alert("下载成功!");
              }
            }, function (timeout) {
              item.percent = item.current = item.total = null;
              var msg=timeout?'请求超时,任务下载失败!':'下载失败,请检查网络';
              $mdDialog.cancel();
              utils.alert(msg);
            })
          }],
          template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose:false,
          fullscreen: false
        });
      }

      api.event('downloadxc',function (s,e) {
        var current =vm.current;
        if(current) {
          switch (e.event) {
            case 'progress':
              current.percent = parseInt(e.percent * 100) + ' %';
              current.current = e.current;
              current.total = e.total;
              break;
          }
        }
      },$scope);

      vm.upload =function (item) {
        item.uploading = true;
        remote.Assessment.GetAssessmentStatus(item.AssessmentID).then(function (result) {
            if(result.data.ErrorCode==0){
              var pk = pack.sc.up(item.AssessmentID);
              pk.upload(function (proc) {
                item.progress = proc;
                if(proc==-1) {
                  item.completed = pk.completed;
                  if(item.completed)
                    remote.Assessment.sumReportTotal(item.AssessmentID).then(function(){
                      xcpk.addOrUpdate(vm.data);
                      item.progress = 100;
                      //utils.tips('同步完成');
                      utils.alert('同步完成');
                      item.uploading = true;
                    })
                  else {
                    utils.alert('同步未完成');
                    item.uploading = true;
                  }
                }
              });
            }
            else{
              utils.alert(result.data.ErrorMessage);
            }
          })
          .catch(function () {
            utils.alert('网络错误')
          })

      }
      vm.delete = function(item,ev){
        utils.confirm('确认删除?',ev,'','').then(function(){
          $mdDialog.show({
            controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
              pack.sc.remove(item.AssessmentID,function () {
                $mdDialog.hide();
                var idx = vm.data.rows.indexOf(item);
                vm.data.rows.splice(idx, 1);
                idx = vm.offlines.indexOf(item);
                vm.offlines.splice(idx, 1);
                xcpk.addOrUpdate(vm.data);
                queryOnline();
              })
            }],
            template: '<md-dialog aria-label="正在删除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在删除,请稍后...</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose:false,
            fullscreen: false
          });
        })
      }
      function queryOnline() {
        vm.onlines = [];
        vm.offlines = [];
        vm.data.rows.forEach(function (m) {
          m.progress = 0;
          vm.offlines.push(m);
        });
        remote.Assessment.query().then(function (result) {
          if(result.data==null||result.data.length==0){
            utils.alert('暂无待评估项目！');
          }
          else {
            result.data.forEach(function (m) {
              var fd = vm.data.rows.find(function (a) {
                return a.AssessmentID == m.AssessmentID;
              });
              if (fd) {

              }
              else {
                vm.onlines.push(m);
              }
            });
          }
        }).catch(function () {

        });
      }
      vm.searchText="";
      vm.querySearch=function(text){
        return vm.cache.filter(function (o) {
          var py=window.Pinyin.getPinyinArrayFirst(o.fullName)
          py=py.join("");
          return o.fullName.indexOf(text)>-1||py.toLowerCase().indexOf(text.toLowerCase())>-1;
        })
      }
      vm.changeItem=function (r) {
        if (!r){
          vm.projects=vm.cache;
        }else {
          vm.projects=vm.cache.filter(function (o) {
            return o.ProjectID==r.ProjectID;
          });
        }
      }


      remote.Assessment.queryItemResults().then(function(result){
        result.data&&result.data.forEach(function(t){
          t.fullName = ((t.Year+'年')||'') +'第'+t.Quarter +'季度'+ (t.ProjectName||'')+'项目得分汇总';
        })
        vm.projects=vm.cache = result.data;
      })
      vm.showECs = function(ev,item) {
        $mdDialog.show({
            controller: ['$scope', '$mdDialog','item', function DialogController($scope, $mdDialog,item) {
              $scope.item = item;
              $scope.hide = function () {
                $mdDialog.hide();
              };
              $scope.cancel = function () {
                $mdDialog.cancel();
              };
              $scope.answer = function (answer) {
                $mdDialog.hide(answer);
              };

              $scope.goSC=function(item){
                api.setNetwork(1).then(function(){
                  $state.go('app.xhsc.ch2',{areaID:item.AreaID,areaName:item.AreaName,assessmentID:item.AssessmentID});
                  $mdDialog.hide();
                });
              }
              $scope.goST=function(item){
                api.setNetwork(1).then(function(){
                  $state.go('app.xhsc.ch1',{areaID:item.AreaID,areaName:item.AreaName,assessmentID:item.AssessmentID,AssessmentTypeID:'7d179e8804a54819aad34b7a9398880d',typename:'实体质量'});
                  $mdDialog.hide();
                });
              }
              $scope.goAQ=function(item){
                api.setNetwork(1).then(function(){
                  $state.go('app.xhsc.ch1',{assessmentID:item.AssessmentID,AssessmentTypeID:'82666209a15647569f9bcaff50d324c2',typename:'安全文明'});
                  $mdDialog.hide();
                });
              }

            }],
            templateUrl: 'app/main/xhsc/ys/evaluateChoose.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            focusOnOpen:false,
            locals:{
              item:item
            },
            clickOutsideToClose: true
          })
          .then(function(answer) {
          });
      };
      vm.detail=function(ev,item){
        $mdDialog.show({
            controller: ['$scope', '$mdDialog','item', function DialogController($scope, $mdDialog,item) {
              $scope.item = item;
              $scope.hide = function () {
                $mdDialog.hide();
              };
              $scope.cancel = function () {
                $mdDialog.cancel();
              };
              $scope.answer = function (answer) {
                $mdDialog.hide(answer);
              };
            }],
            templateUrl: 'app/main/xhsc/ys/detailChoose.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            locals:{
              item:item
            },
            clickOutsideToClose: true
            //fullscreen: useFullScreen
          })
          .then(function(answer) {

          });
      }
    });
  }
})();

/**
 * Created by emma on 2016/5/5.
 */
(function(){
  'use strict';

  downdetailController.$inject = ["db", "remote"];
  angular
    .module('app.xhsc')
    .controller('downdetailController',downdetailController);

  /** @ngInject*/
  function downdetailController(db,remote){
    var vm = this;
    var pk = db('xcpk');
    pk.get('xcpk').then(function (result) {
      vm.offlines = result.rows;
      queryOnline();
    }).catch(function (err) {
      vm.offlines = [];
      queryOnline();
    });
    function queryOnline() {
      remote.Assessment.query().then(function (result) {
        pk.addOrUpdate({_id:'xcpk',rows:result.data});
        vm.onlines = result.data;
      }).catch(function () {
        
      });
    }


  }
})();

/**
 * Created by emma on 2016/5/11.
 */
(function(){
  'use strict';

  detailscController.$inject = ["$stateParams", "remote", "$rootScope", "$state"];
  angular
    .module('app.xhsc')
    .controller('detailscController',detailscController);

  /** @ngInject*/
  function detailscController($stateParams,remote,$rootScope,$state){
    var vm = this;
    var iMax = 20;
    vm.info={
      pname: $stateParams.pname,
      name:$stateParams.name
    };
    $rootScope.title = vm.info.name+'('+vm.info.pname+')';
    vm.back = function () {
      history.go(-1);
    }
    remote.Assessment.getMeasureNew({
      RegionID:$stateParams.regionId,
      AcceptanceItemID:$stateParams.measureItemID,
      RecordType:4,
      RelationID:$stateParams.db
    },"nodb").then(function (result){
      var newD = [];
      result.data.forEach(function (item) {
        if(!item.MeasureValueList.length){
          var rowSpan = 0,t1=0,t2 = 0;
          item.Children = result.data.filter(function (r) {
            if(r.ParentAcceptanceIndexID==item.AcceptanceIndexID){
              if(r.MeasureValueList.length==0)return false;
              r.rows = [];
              var ps=[];
              r.QualifiedRate = r.QualifiedRate * 100;
              r.allDot = r.QualifiedPointNum + r.UnqualifiedPointNum;
              t1 += r.QualifiedPointNum;
              t2 += r.allDot;
              r.MeasureValueList.forEach(function (m) {
                var p = ps.find(function (p1) {
                  return p1.ParentMeasureValueID == m.ParentMeasureValueID;
                });
                if(!p){
                  p = {
                    ParentMeasureValueID:m.ParentMeasureValueID,
                    ms:[]
                  };
                  ps.push(p);
                }
                p.ms.push(m);
              });
              ps.forEach(function (p) {
                if(p.ms.length<=20){
                  r.rows.push(p.ms);
                }
                else{
                  var ms = [];
                  p.ms.forEach(function (m) {
                    if(ms.length<20){
                      ms.push(m);
                    }
                    else{
                      item.rows.push(ms);
                      ms=[m];
                    }
                  });
                  r.rows.push(ms);
                }
              });
              r.rows.forEach(function (ms) {
                while (ms.length<20){
                  ms.push({});
                }
              });
              rowSpan+=r.rows.length;
              return true;
            }
            return false;
          });

          item.QualifiedPointNum = t1;
          item.rowSpan = rowSpan;
          item.allDot = t2;
          newD.push(item);
        }
        else if(!item.ParentAcceptanceIndexID){
          item.rows = [];
          var ps=[];
          item.QualifiedRate = item.QualifiedRate * 100;
          item.allDot = item.QualifiedPointNum + item.UnqualifiedPointNum;
          item.MeasureValueList.forEach(function (m) {
            var p = ps.find(function (p1) {
              return p1.ParentMeasureValueID == m.ParentMeasureValueID;
            });
            if(!p){
              p = {
                ParentMeasureValueID:m.ParentMeasureValueID,
                ms:[]
              };
              ps.push(p);
            }
            if(m.ExtendedField1 && m.ExtendedField1.indexOf(',')){
              var ms = m.ExtendedField1.split(',');
              ms.forEach(function (v) {
                p.ms.push({
                  MeasureStatus:m.MeasureStatus,
                  MeasureValue:v,
                  MeasureValueId:m.MeasureValueId
                });
              });
              p.ParentMeasureValueID = m.MeasureValueId;
            }
            else {
              p.ms.push(m);
              if (item.AcceptanceIndexName.indexOf('尺寸一致性') != -1) {
                m.MeasureValue = m.MeasureValue + '<br/>' + m.DesignValue;
              }
            }
          });
          ps.forEach(function (p) {
            if(p.ms.length<=20){
              item.rows.push(p.ms);
            }
            else{
              var ms = [];
              p.ms.forEach(function (m) {
                if(ms.length<20){
                  ms.push(m);
                }
                else{
                  item.rows.push(ms);
                  ms=[m];
                }
              });
              item.rows.push(ms);
            }
          });
          item.rows.forEach(function (ms) {
            while (ms.length<20){
              ms.push({});
            }
          })
          newD.push(item);
        }

      });

      vm.stateParams=$stateParams;
      vm.go=function(row,item){
        $state.go("app.pc.sctbdetail",{recordId:$stateParams.regionId,itemId:item.AcceptanceIndexID,
          AcceptanceItemID:$stateParams.measureItemID,MeasureRecordID:item.MeasureRecordID});
        //ui-sref="()"
      }
      vm.scData = newD;
    });
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  checkHouseController.$inject = ["$mdDialog"];
  angular
    .module('app.xhsc')
    .controller('checkHouseController',checkHouseController);

  /** @ngInject */
  function checkHouseController($mdDialog){
    var vm=this;
    vm.photo = function ($event) {
      $mdDialog.show({
        targetEvent: $event,
        controller:['$scope', '$mdDialog',function ($scope, $mdDialog) {
          $scope.cancel = function () {
            $mdDialog.cancel();
          }
          $scope.answer = function ($base64Url) {
            $mdDialog.hide($base64Url);
          }
        }],
        fullscreen:true,
        template: '<md-dialog style="width: 100%;max-width: 100%;height: 100%;max-height: 100%;" aria-label="List dialog">' +
        '  <md-dialog-content flex layout="column" style="padding: 0">' +
        '<photo-draw flex layout="column" on-cancel="cancel()" on-answer="answer($base64Url)"></photo-draw>' +
        '  </md-dialog-content>'+
        '</md-dialog>'
      }).then(function ($base64Url) {
        console.log('$base64Url',$base64Url)
      })
    }

  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  ChoosePcController.$inject = ["$scope", "$stateParams", "$rootScope", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .controller('ChoosePcController',ChoosePcController);

  /** @ngInject */
  function ChoosePcController($scope,$stateParams,$rootScope,xhUtils,remote){
    var vm=this;
    remote.Assessment.queryRegions($stateParams).then(function (result) {
      vm.sections = result.data;
    });
  }

})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  ChooseHouseController.$inject = ["$scope", "xhUtils", "remote", "$rootScope", "$stateParams", "$state"];
  angular
    .module('app.xhsc')
    .controller('ChooseHouseController',ChooseHouseController);

  /** @ngInject */
  function ChooseHouseController($scope,xhUtils,remote,$rootScope,$stateParams,$state){
    var vm=this;
    vm.areaId = $stateParams.areaId;
    vm.pname = $stateParams.pname;
    $rootScope.title = vm.pname;
    vm.search = function(){
      vm.showSearch = true;
    }
    vm.hideSearch = function(){
      vm.showSearch = false;
    }
    vm.open = function(id) {
      vm.current = id;
      //vm.floors = null;
      vm.Region.forEach(function (item) {
        item.showArr = false;
        item.actived = false;
        if (id.RegionName == item.RegionName) {
         // vm.floors = item.Children;
          id.showArr = true;
          item.actived = true;
        }
      })
    }
    vm.tabStatus = -1;
    vm.myFilter = function(num){
      vm.tabStatus = num;
      //console.log('floor',vm.floors)
    }
    vm.changeStat = function(item,items){

      if(!vm.muti){
        $state.go(item.status==2?'app.xhsc.scd':'app.xhsc.sc',{
          areaId:vm.areaId,
          acceptanceItemID:item.AcceptanceItemID,
          regionId:item.RegionID,
          regionType:item.RegionType,
          name:item.FullName,
          pname:vm.pname
        })
/*        $state.go('app.xhsc.scd',{
          areaId:vm.areaId,
          acceptanceItemID:item.AcceptanceItemID,
          regionId:item.RegionID,
          regionType:item.RegionType,
          name:item.FullName,
          pname:vm.pname
        })*/
      }
      else{
        item.selected=!item.selected;
      }

  }
    vm.loadCircle = true;
    xhUtils.getRegion( vm.areaId, function(data){
     // console.log('r',data)
     vm.Region = data.Children;
      remote.MeasureCheckBatch.getStatus($stateParams.id,$stateParams.areaId,1).then(function(result){
       //console.log('r',result)
        data.each(function(item){
          var find = result.data.find(function(r){return r.RegionID==item.RegionID;});
          if(find){
            item.AcceptanceItemID = find.AcceptanceItemID;
            item.status = find.Status;
          }
          else{
            item.status = -1;
          }
        })
        vm.loadCircle = false;
      })
      if(vm.Region.length) {
        vm.open(vm.Region[0]);
      }
    })

    vm.goMeasure = function(){
      //console.log('none')
    }

  }

})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  ChooseController.$inject = ["$scope", "$stateParams", "db", "$rootScope", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .controller('ChooseScController',ChooseController);

  /** @ngInject */
  function ChooseController($scope,$stateParams,db,$rootScope,xhUtils,remote){
    var vm=this,
      id = $stateParams.assessmentID;
    var pk = db('xcpk');
    var data = db('pack'+id);
    pk.get('xcpk').then(function (pk) {
      var item = pk.rows.find(function (it) {
        return it.AssessmentID == id;
      });
      data.get('GetRegionTreeInfo').then(function (result) {
        var ms=[];
        item.MeasureItems.forEach(function (m) {
          var m1 = ms.find(function (it) {
            return it.TemplateID==m.TemplateID;
          });
          if(!m1){
            m1 = {
              TemplateID:m.TemplateID,
              TemplateName:m.TemplateName,
              Regions:[]
            };
            ms.push(m1);
          }
          m.AssessmentAreas.forEach(function (area) {
            var room = xhUtils.findRegion([result.data],area.RegionID);
            if(room){
              vm.dmeasureItemID = m.MeasureItemID;
              vm.dmeasureItemName = m.MeasureItemName;
              m1.Regions.push({
                db:id,
                RegionName:room.RegionName,
                areaId:result.data.RegionID,
                regionId:room.RegionID,
                regionType:room.RegionType,
                name:room.fullName,
                measureItemID:m.MeasureItemID,
                pname:m.MeasureItemName,
                assessmentID:item.AssessmentID,
              });
            }
          })

        });
        vm.fq ={
          db:id,
          //areaId:$stateParams.areaID,
          areaId:item.AreaID,
          measureItemID:vm.dmeasureItemID,
          regionId:item.AreaID,
          //RegionName:$stateParams.areaName,
          //regionId:$stateParams.areaID,
          regionType:2,
          RegionName:item.AreaName,
          name:item.AreaName,
          //name:$stateParams.areaName,
          pname:vm.dmeasureItemName,
          assessmentID:item.AssessmentID,
        }
        vm.ms = ms;
      })
    })
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  yfRectifyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('yfRectifyController', yfRectifyController);

  /** @ngInject */
  function yfRectifyController($state, $rootScope, $scope, $mdDialog, remote, $timeout, $q, utils, xhUtils, api) {
    var vm = this;
    $rootScope.title = $state.params.Role == 'zb' ? '整改' : '复验';
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;

    remote.safe.getRectificationsWrap.cfgSet({
      offline:true,
      filter:function (item) {
        return item.InspectionExtendID==vm.InspectionID;
      }
    })("house").then(function (r) {
      var bacth=angular.isArray(r.data)?r.data[0]:null;
      vm.pareaList=[];
      if (bacth){
        bacth.Rectifications.forEach(function (k) {
          if (k.Children){
            k.Children.forEach(function (m) {
              if (!vm.pareaList.some(function (z) {
                  return z.AreaID==m.AreaID;
                }))
                vm.pareaList.push(m);
            })
          }
        });
        if (vm.pareaList.length>0){
          vm.regionSelect = vm.pareaList[0];
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemName=vm.regionSelect.AcceptanceItemName;
          vm.warter = vm.regionSelect.RegionName + bacth.Describe;;
        }
      }
    });

    api.setNetwork(1).then(function () {

      vm.info = {}

      vm.selectQy = function (item) {
        vm.regionSelect = item;
        vm.regionSelect.hasCheck = true;
        vm.AcceptanceItemID=item.AcceptanceItemID;
        vm.AcceptanceItemName=item.AcceptanceItemName;
        vm.qyslideShow = false;
      }
      vm.qyslide = function () {
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult', function () {
        function valid() {
          function next() {
            return  $q(function (resolve,reject) {
              var msg = [],noChecked=[];
              vm.pareaList.forEach(function (r) {
                if (!r.hasCheck) {
                  msg.push(r.RegionName);
                  noChecked.push(r);
                }
              });
              if (msg.length) {
                utils.confirm(msg.join(",") + '尚未查看,去看看?',null,"确定","取消").then(function () {
                  vm.selectQy(noChecked[0],true);
                }).catch(function () {
                });
              }else {
                resolve();
              }
            })
          }
          return  $q(function (resolve,reject) {
            if (vm.points.length){
              switch ($state.params.Role){
                case "zb":
                  if (vm.points.find(function (k) {
                      return k.Status!=16;
                    })){
                    utils.confirm("点位尚未全部整改,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
                default:
                  if (vm.points.find(function (k) {
                      return k.Status!=2;
                    })){
                    utils.confirm("点位尚未全部验收,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
              }
            }else {
              return next().then(function () {
                resolve();
              });
            }
          }).then(function () {
            $timeout(function () {
              utils.alert('提交成功，请稍后离线上传数据',null,function () {
                $state.go("app.xhsc.yf.Main");
              });
            })
          })
        }
        valid();
      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })
    });
  }
})();

/**
 * Created by shaoshun on 2016/11/28.
 */
/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  yfMainController.$inject = ["xhscService", "$mdDialog", "api", "$scope", "$q", "remote", "$state", "sxt", "utils", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('yfMainController', yfMainController);

  /** @ngInject */
  function yfMainController(xhscService,$mdDialog,api,$scope,$q,remote,$state,sxt,utils,$mdBottomSheet) {
    var vm = this;
    vm.procedure = [];
    vm.create=function () {
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.ok=function () {
            remote.safe.insertBatchWrap({
              InspectionID: sxt.uuid(),
              AreaID: $scope.currentArea.RegionID,
              Title: $scope.subject,
            },"house").then(function (r) {
              $mdDialog.hide(r);
            }).catch(function () {
              $mdDialog.hide();
            })
          }
          $scope.cancel=function () {
            $mdDialog.cancel();
          }

          function initTheme() {
            var projectName=$scope.currentProject?$scope.currentProject.RegionName:"";
            var area=$scope.currentArea?$scope.currentArea.RegionName:"";
            var date=new Date();
            var year=date.getFullYear();
            var month=date.getMonth()+1;
            var day=date.getDate();
            if (!area||!projectName){
              $scope.subject="";
            }else {
              $scope.subject= projectName+area+ year+"年"+month+"月第"+day+"日移动验房";
            }
          }
          xhscService.getRegionTreeOffline("",3,1).then(function (r) {
            $scope.projects=r;
            if(angular.isArray($scope.projects)&&$scope.projects.length){
              $scope.currentProject=$scope.projects[0];
              if ($scope.currentProject.Children.length){
                $scope.currentArea=$scope.currentProject.Children[0];
              }
            }
          })

          $scope.$watch("currentProject",function () {
            initTheme();
          })
          $scope.$watch("currentArea",function () {
            initTheme();
          })
        }],
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_createTemplate.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        fullscreen: false
      }).then(function (r) {
        if (r&&r.status==200){
          loadInspection();
        }
      });
    }
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
      load();
    });

    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("house").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];

    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7|| item.Type==-3)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("house",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"house").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.yf.yfPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.yf.yfProblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.yf.yfProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaID,null,null))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'yfYS' + item.InspectionID});
                })

              api.task(tasks, {
                event: 'downloadweek',
                target: item.InspectionID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadweek', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID.substr(0,o.AreaID.length-5), [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(getRectificationTask())
                .concat(function () {

                  return remote.offline.create({Id: 'yfZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);


    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;
            function buildTask() {
              function filterUpload(arr) {
                if (angular.isArray(arr)){
                  return arr.filter(function (t) {
                    return !t.isUpload;
                  })
                }
                return arr;
              }
              var tasks = [];
              return $q(function (resolve, reject) {
                api.getUploadData(function (cfg) {
                  return cfg.mark == "yfUp"||cfg.mark =="allUp";
                }).then(function (val) {
                  if (val && val.length) {
                    var points = val.find(function (o) {
                      return o.key == "InspectionPoint";
                    });
                    var ckpoints = val.find(function (o) {
                      return o.key == "yfPoints";
                    });
                    var ckpointsVal=ckpoints && ckpoints.vals ? ckpoints.vals : [];

                    var problemRecords = val.find(function (o) {
                      return o.key == "yfProblemRecord";
                    });
                    var problemRecordsVal=problemRecords && problemRecords.vals ? filterUpload(problemRecords.vals) : [];

                    var InspectionProblemRecordFiles = val.find(function (o) {
                      return o.key == "yfInspectionProblemRecordFile";
                    });
                    //文件上传
                    var InspectionProblemRecordFilesVal=InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals ?
                      filterUpload(InspectionProblemRecordFiles.vals): [];
                    InspectionProblemRecordFilesVal.forEach(function (k) {
                      tasks.push(function () {
                        return remote.safe.inserFile({
                          FileName:k.FileID,
                          Base64:k.FileContent
                        }).then(function () {
                          delete k.FileContent
                        })
                      });
                    });

                    //几何位置单独上传
                    if (points && points.vals) {
                      points.vals.forEach(function (t) {
                        if (t.geometry) {
                          t.Geometry = t.geometry;
                        }
                        if (typeof t.Geometry === 'string') {
                          t.Geometry = JSON.parse(t.Geometry);
                        }
                        tasks.push(function () {
                          return remote.Procedure.InspectionPoint.create(t)
                        });
                      });
                    }
                    //业务单独上传
                    var post={
                      "CheckpointInput": ckpointsVal,
                      "ProblemRecordInput": problemRecordsVal,
                      "ProblemRecordFileInput": InspectionProblemRecordFilesVal
                    }

                    tasks.push(function () {
                      function clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points) {

                        if (ckpoints&&ckpoints.db){
                          tasks.push(function () {
                            return  ckpoints.db.destroy()
                          })
                        }

                        if (problemRecords&&problemRecords.db){
                          tasks.push(function () {
                            return  problemRecords.db.destroy()
                          })
                        }
                        if (InspectionProblemRecordFiles&&InspectionProblemRecordFiles.db){
                          tasks.push(function () {
                            return  InspectionProblemRecordFiles.db.destroy()
                          })
                        }
                        if (points&&points.db){
                          tasks.push(function () {
                            return  points.db.destroy()
                          })
                        }
                        // if (ckpoints && ckpoints.vals) {
                        //   ckpoints.vals.forEach(function (m) {
                        //     tasks.push(function () {
                        //       return  ckpoints.db.delete(m._id);
                        //     })
                        //   });
                        // }
                        // if (problemRecords && problemRecords.vals) {
                        //   problemRecords.vals.forEach(function (m) {
                        //     tasks.push(function () {
                        //       return  problemRecords.db.delete(m._id);
                        //     })
                        //   });
                        // }
                        // if (InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals) {
                        //   InspectionProblemRecordFiles.vals.forEach(function (m) {
                        //     tasks.push(function () {
                        //       return  InspectionProblemRecordFiles.db.delete(m._id);
                        //     })
                        //   });
                        // }
                        // if (points && points.vals){
                        //   points.vals.forEach(function (t) {
                        //     tasks.push(function () {
                        //       return  points.db.delete(t._id)
                        //     })
                        //   })
                        // }
                      }
                      return remote.safe.safeUp(post,"house").then(function () {
                        clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points);
                      });
                    });
                  }
                  resolve(tasks);
                })
              }).catch(function () {
                reject(tasks);
              })
            }
            buildTask().then(function (tasks) {
              api.task(tasks)(function (percent, current, total) {
                vm.uploadInfo.percent = parseInt(percent * 100) + ' %';
                vm.uploadInfo.current = current;
                vm.uploadInfo.total = total;
              }, function () {
                utils.alert("上传成功!");
                $mdDialog.hide();
                load();
                remote.offline.query().then(function(m){
                  if(angular.isArray(m.data)){
                    m.data.forEach(function(n){
                      if(n.Id&&(n.Id.indexOf("yfZg")>-1||n.Id.indexOf("yfYS")>-1)){
                        remote.offline.delete({Id:n.Id});
                      }
                    });
                  }
                });
                vm.uploadInfo.uploading = false;
              }, function (timeout) {
                var msg = timeout ? '超时,任务上次失败!' : '上传失败,请检查网络';
                $mdDialog.cancel();
                utils.alert(msg);
                vm.uploadInfo.uploaded = 0;
                vm.uploadInfo.uploading = false;
              });
            })
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }


    function loadInspection() {
     return remote.safe.getBatchWrap.cfgSet({
       mode:2
     })("house").then(function (r) {
        vm.Inspections = [];
        if (angular.isArray(r.data)) {
          var ys = [];
          r.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "yfYS" + k.InspectionID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
          })
        }
      });
    }
    function loadZgLst() {
      return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
            return ret(vm.role);
          }).then(function (r) {
            resolve(r);
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
          params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("house",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "yfZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }
    }
    function load() {
      $q.all([
        loadInspection(),
        loadZgLst()
      ]).then(function () {
        vm.isOver = true;
      });
    }

    vm.setModule = function (val) {
      $state.go('app.xhsc.yf.yfBase', {yw: val})
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.yf.yfRectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.yf.yfRectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.yf.yfRectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.yf.yfRectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.yf.yfAccept', {
              projectId: item.ProjectID,
              areaId: item.AreaID,
              InspectionId: item.InspectionID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.yf.yfAccept', {
            projectId: item.ProjectID,
            areaId: item.AreaID,
            InspectionId: item.InspectionID
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  yfBaseController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('yfBaseController', yfBaseController);

  function yfBaseController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog,db, $mdBottomSheet, $stateParams, xhscService) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });

    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("house").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];

    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7|| item.Type==-3)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("house",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"house").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.yf.yfPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.yf.yfProblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.yf.yfProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(getRectificationTask())
                .concat(function () {
                  return remote.offline.create({Id: 'yfZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    function loadZgLst() {
      return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
          }).then(function () {
            ret(vm.role).then(function (r) {
              resolve(r);
            });
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
          params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("house",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "yfZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }
    }
    function load() {
      $q.all([
        loadZgLst()
      ]).then(function () {
        vm.f_isOver = true;
        if (!vm.zglist.length){
          vm.isShowbg=true;
        }

      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.yf.yfRectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.yf.yfRectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.yf.yfRectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.yf.yfRectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/6.
 */
(function () {
  'use strict';

  yfAcceptController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('yfAcceptController', yfAcceptController);

  /**@ngInject*/
  function yfAcceptController($scope, $stateParams, remote, xhUtils, $rootScope, $state, $q, utils, api, xhscService) {
    var vm = this;
    var projectId = $stateParams.projectId,
      areaId=vm.areaId = $stateParams.areaId ? $stateParams.areaId : $stateParams.regionId;
    vm.InspectionId = $stateParams.InspectionId;

    vm.info = {
      current: null,
      projectId: projectId,
      regionId: areaId,
      cancelMode: function () {
        vm.cancelCurrent(null);
      }
    };




    var sendResult = $rootScope.$on('sendGxResult', function () {
      utils.alert("提交成功，请稍后离线上传数据！", null, function () {
        $state.go('app.xhsc.yf.Main')
      });
    })
    $scope.$on("$destroy", function () {
      sendResult();
      sendResult = null;
    });
    api.setNetwork(1).then(function () {
      vm.cancelCurrent = function ($event) {
        vm.info.current = null;
      }
      $scope.areas = xhscService.getRegionTreeOffline("", 31, 1).then(function (r) {
        if (!angular.isArray(r)) {
          return r;
        }

        function hide(region) {

          if (region.Children&&region.Children.length){
            region.Children.forEach(function (o) {
              hide(o);
            });
          }
          if(region.RegionType<16){
             if (region.Children.every(function (k) {
                 return k.hide;
               })){
               region.hide=true;
             }
          }
        }

        var area = r.filter(function (k) {
          if (angular.isArray(k.Children)) {
            k.Children = k.Children.filter(function (m) {
              return m.RegionID == areaId;
            })
          }
          return k.RegionID == projectId;
        });
        area.forEach(function (o) {
          hide(o);
        });

        vm.setDraft=function (regionId,flag) {
          function findRoom(root) {
            if (root.RegionID==regionId){
              return root;
            }
            if (root.Children&&root.Children.length){
              var res;
              for (var  i=0;i<root.Children.length;i++){
                res=findRoom(root.Children[i]);
                // if (res){
                //   return res;
                // }
              }
            }
            return null;
          }
          var res;
          for (var i=0;i< area.length;i++){
            res=findRoom(area[i]);
            if (res){
              return res
            }
          }
          if (res){
            res.draft=flag;
          }
        }

        return area;
      });

      function convertData(source) {
        var ret = [];
        var accAcceptances = [];
        if (angular.isArray(source)) {
          source.forEach(function (t) {
            if (angular.isArray(t.WPAcceptanceList)){
              accAcceptances= accAcceptances.concat(t.WPAcceptanceList);
            }
            var k = t.SpecialtyChildren;
            if (angular.isArray(k)) {
              k.forEach(function (m) {
                if (angular.isArray(m.WPAcceptanceList)) {
                  accAcceptances = accAcceptances.concat(m.WPAcceptanceList);
                }
              })
            }
          })
        }

        if (accAcceptances.length) {
          accAcceptances.forEach(function (k) {
            k.ProblemClassifyList.forEach(function (o) {
              if (angular.isArray( o.ProblemLibraryList)&& o.ProblemLibraryList.length){
                o.ProblemLibraryList.sort(function (a,b) {
                  return a.ProblemSortName.localeCompare(b.ProblemSortName)
                })
              }
            });

            build(k);
          })
        }
        return ret;

        function build(ac) {
          var name = ac.AcceptanceItemName;
          if (name) {
            var nameArr = name.split("-");
            if (nameArr.length == 3) {
              var first = nameArr[0], second = nameArr[1], third = nameArr[2];
              ac.AcceptanceItemName = third;
              var type = ret.find(function (o) {
                return o.SpecialtyName.trim() == first.trim();
              })
              if (!type) {
                var entiy = {
                  SpecialtyName: first,
                  SpecialtyChildren: [{
                    SpecialtyName: second,
                    WPAcceptanceList: [ac]
                  }
                  ]
                }
                ret.push(entiy)
              }else {
                var subtype=type.SpecialtyChildren.find(function (o) {
                  return o.SpecialtyName.trim()==second.trim();
                })
                if (!subtype){
                  type.SpecialtyChildren.push({
                    SpecialtyName: second,
                    WPAcceptanceList: [ac]
                  });
                }else {
                   var gx=subtype.WPAcceptanceList.find(function (o) {
                     return o.AcceptanceItemName.trim()==third.trim();
                   })
                  if (!gx){
                    subtype.WPAcceptanceList.push(ac)
                  }
                }
              }
            }
          }
        }
      }

      $scope.procedure = remote.safe.getSecurityItem.cfgSet({
        offline: true
      })("house").then(function (r) {
        r.data=convertData(r.data);

        return r;
      });
      $scope.current = {};


      $scope.$watch("current.region", function (v, o) {
        if (v && $scope.current.procedure) {
          vm.info.show = true;
        } else {
          vm.info.show = false;
        }
      })
      $scope.$watch("current.procedure", function (v, o) {
        if (v) {
          if ($scope.current.region) {
            vm.info.show = true;
          } else {
            vm.info.show = false;
          }
          vm.procedureData = [v];
          vm.procedureData.forEach(function (t) {
            t.SpecialtyChildren = t.ProblemClassifyList;
            t.ProblemClassifyList.forEach(function (_t) {
              _t.WPAcceptanceList = _t.ProblemLibraryList;
              _t.SpecialtyName = _t.ProblemClassifyName;
              _t.ProblemLibraryList.forEach(function (_tt) {
                _tt.AcceptanceItemName = _tt.ProblemSortName + '.' + _tt.ProblemDescription;
              })
            })
          })
        }
      })
    });
  }
})();

/**
 * Created by emma on 2016/6/24.
 */
(function(){
  'use strict';

  xxjdmainController.$inject = ["$rootScope", "$stateParams", "sxt", "ys7"];
  angular
    .module('app.xhsc')
    .controller('xxjdmainController',xxjdmainController);

  /**@ngInject*/
  function xxjdmainController($rootScope,$stateParams,sxt,ys7){
    var vm = this;
    $rootScope.title=$stateParams.projectName;
    vm.project={
      projectId:$stateParams.projectId,
      projectName:$stateParams.projectName
    }
    vm.playSxt =function(){
      ys7.token().then(function (token) {
        sxt.plugin.playYs7([token,'0cb133b18135433780ff396683dbf8da']);
      });
    }
  }
})();

/**
 * Created by emma on 2016/6/24.
 */
(function(){
  'use strict';

  xxjdbuildingsController.$inject = ["remote", "$scope", "$stateParams", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('xxjdbuildingsController',xxjdbuildingsController);

  /**@ngInject*/
  function xxjdbuildingsController(remote,$scope,$stateParams,$rootScope){
    var vm = this;
    $rootScope.title = $stateParams.projectName
    vm.stageId = '0000100002';
    remote.Assessment.queryProcessBuildings(vm.stageId).then(function(result){
     vm.builds = result.data;

      vm.builds.floorNum = 0;
      vm.builds.forEach(function(t){
        if(vm.builds.floorNum < t.floors){
          vm.builds.floorNum = t.floors;
        }
      })
      vm.buildLen = vm.builds.length;
      console.log('res',vm.builds)
    })
    //vm.builds = builds;

    vm.setBuild = function(item){
      $scope.$parent.current = item;
    }
    //console.log('builds',vm.builds)
  }
})();

/**
 * Created by emma on 2016/6/24.
 */
(function(){
  'use strict';

  xxjdbuildingController.$inject = ["$scope", "$stateParams", "details"];
  angular
    .module('app.xhsc')
    .controller('xxjdbuildingController',xxjdbuildingController);

  /**@ngInject*/
  function xxjdbuildingController($scope,$stateParams,details){
    var vm = this;
    //vm.build = builds.builds[0];
    //vm.buildLen =builds.builds.length;
    //console.log($scope)
    vm.build = {
      name:$stateParams.name,
      id:$stateParams.id,
      gx1:$scope.$parent.current.gx1,
      floors:$scope.$parent.current.floors,
      sellLine:$scope.$parent.current.sellLine,
      summary:$scope.$parent.current.summary
    }

    vm.data= {
      config: {
        showXAxis: true,
        showYAxis: true,
        showLegend: false,
        width:'100%',
        debug: true,
        stack: false,
        dataZoom:{
          show:false
        },
        xAxis:{
          type: 'category'
        },
        yAxis: {
          type: 'value',
          min: 0,
          max: 50,
          axisLabel: {
            formatter: function (value, index) {
              return parseInt(value);//非真正解决
            }
          },
          yAxisIndex:0
        },
        series: {
          label: {
            normal: {
              show: true
            }
          }
        }
      },
      data:details
    };
    console.log('details',details)
  }
})();

/**
 * Created by jiuyuong on 2016/7/8.
 */
(function(){
  'use strict';

  ys7.$inject = ["$http", "$q", "xhUtils"];
  angular
    .module('app.xhsc')
    .factory('ys7',ys7);
  /** @ngInject */
  function ys7($http,$q,xhUtils){
   var accessToken,
     userId,
     id = 13823315505,
     api = 'https://open.ys7.com/api/method',
     appKey = '346249221d154bac9ba686873c2dffec',
     phone = '13823315505';

    function signData(time,method,params) {
      var p = [], v = [];

      for (var k in params) {
        p.push({key: k, value: params[k]});
      }
      p.sort(function (s1, s2) {
        return s1.key.localeCompare(s2.key);
      });
      p.push({key: 'method', value: method});
      p.push({key: 'time', value: time});
      p.push({key: 'secret', value: 'f637ad66df8d77133f43f28ddf9942d7'});
      p.forEach(function (m) {
        v.push(m.key + ':' + m.value);
      });
      return xhUtils.md5(v.join(','));
    }

    function request(method,params) {
      return $http({
        method: 'POST',
        url: 'https://open.ys7.com/api/time/get',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        transformRequest: function (obj) {
          var str = [];
          for (var p in obj)
            str.push (encodeURIComponent (p) + "=" + encodeURIComponent (obj[p]));
          return str.join ("&");
        },
        data: {
          id:id,
          appKey:appKey
        }
      }).then(function(result){
        var t = result.data.result.data.serverTime;
        return $http.post(api,{
          system:{
            ver:1.0,
            sign:signData(t,method,params),
            key:appKey,
            time:t
          },
          method:method,
          params:params,
          id:id
        });
      });
    }

    function getToken() {
      return $q(function (resolve) {
        if(accessToken)
          resolve(accessToken);
        else{
          request('token/getAccessToken',{
            phone:phone
          }).then(function (result) {
            accessToken = result.data.result.data.accessToken,
              userId = result.data.result.data.userId;
            resolve(accessToken);
          })
        }
      })
    }

    function post(method,params) {
      return getToken().then(function (token) {
         return request(method,angular.extend(params||{},{accessToken:token}));
      })
    }

    return {
      token:getToken,
      request:request,
      post:post,
      cameraList:function (args) {
        return post('cameraList',angular.extend({pageSize:1000,pageStart:0},args||{}));
      }
    };
  }
})();

(function ()
{
    'use strict';

    angular
        .module('app.core',
            [
                'ngAnimate',
                'ngAria',
                'ngCookies',
                'ngMessages',
                'ngResource',
                'ngSanitize',
                'ngMaterial',
                'pascalprecht.translate',
                'timer',
                'ui.router',
                'ui.sortable',
                'ng-sortable',
                'moment-picker',
                'chart.js'
            ]);
})();

/**
 * Created by leshuangshuang on 16/4/1.
 */
(function () {
  'use strict';
  xhscService.$inject = ["$rootScope", "remote", "api", "sxtlocaStorage", "$q"];
  angular
    .module('app.core')
    .factory('xhscService', xhscService);
  /** @ngInject */
  function xhscService($rootScope, remote, api, sxtlocaStorage, $q) {
    return {
      qualified: qualified,
      buildRegionTree: buildRegionTree,
      buildMutilRegionTree: buildMutilRegionTree,
      getZ: function (totalW, totalH, m, w, h) {
        var x;
        var y;
        var z;
        z = Math.sqrt((totalH * totalW) / (h * w * m));
        x = Math.ceil(totalW / (z * w));
        y = Math.ceil(totalH / (z * h));
        z = Math.sqrt((totalH * totalW) / (h * x * y * w));
        //console.log('result', x, y, z);
        return {
          x: x,
          y: y,
          z: z
        }
      },
      clear_Root_uglyVal: function () {
        $rootScope.pgReportFilter_load = null;
        $rootScope.pgDefault_load = null;
        $rootScope.scslFilter = null;
        $rootScope.scslReport_load = null;
        $rootScope.gxysFilter_load = null;
      },
      getProfile: function () {
        return $q(function (resolve, reject) {

            // var profile = sxtlocaStorage.getObj("profile");
            // if (profile) {
            //   resolve(profile);
            // } else {
            //   remote.profile().then(function (r) {
            //     profile = {
            //       role: r.data.Role.MemberType === 0 || r.data.Role.MemberType ? r.data.Role.MemberType : null,
            //       ouType: r.data.Role.OUType === 0 || r.data.Role.OUType ? r.data.Role.OUType : null,
            //       user: r.data,
            //       duties:r.data.Role.Duties
            //     }
            //     sxtlocaStorage.setObj("profile", profile)
            //     resolve(profile);
            //   }).catch(function () {
            //     reject(profile)
            //   });
            // }
            remote.profile().then(function (r) {
              var profile = {
                userId:r.data.UserId,
                userName:r.data.Name,
                role: r.data.Role.MemberType,
                roleDes:  r.data.Role.MemberTypeName,
                OUID: r.data.Role.OUID,
                OUName: r.data.Role.OUName,
                // user: r.data,
                permisses:r.data.Permisses,
                duties:r.data.Dutity
              }
              resolve(profile);
            }).catch(function () {
              reject(profile)
            });
        });
      },
      getRegionTreesOnline: function (rootId, regionSize, rootType) {
        var self = this;
        return $q(function (resove, reject) {
          return remote.Project.getAllRegionWithRight_no_db(rootId, regionSize).then(function (r) {
            if (r && r.data.length > 0) {
              rootType = rootType ? rootType : 1;
              var data = self.buildMutilRegionTree(r.data, 1);
              resove(data);
              return;
            }
            resove(null);
          }).catch(function (r) {
            reject(null);
          });
        });
      },
      getRegionTreeOffline:function (rootId, regionSize, rootType) {
        var self = this;
        return $q(function (resove, reject) {
          return remote.Project.getRegionWithRight_wrap(rootId, regionSize).then(function (r) {
            var data=r&&r.data&&r.data.data?r.data.data:[]
            if (data.length > 0) {
              rootType = rootType ? rootType : 1;
              var res = self.buildMutilRegionTree(data, rootType);
              resove(res);
              return;
            }
            resove(null);
          }).catch(function (r) {
            reject(null);
          });
        });
      },
      downloadPics: function (regionID, db, filter,relates) {
        return $q(function (resolve, reject) {
          var tasks = [];
          if (!filter) {
            filter = function (item) {
              return true;
            }
          }
          if (!relates){
            relates=remote.Project.getDrawingRelations(regionID, db);
          }
          relates.then(function (result) {
            var pics = [];

            function isDownload(drawingID) { //图片是否已经下载
              var _pics = sxtlocaStorage.getObj("pics");
              if (!_pics) {
                _pics = [];
              }
              if (_pics.indexOf(drawingID) > -1) {
                return true;
              }
              return false;
            }

            function isRepeat(DrawingID) { //是否重复的图片
              return pics.some(function (t) {
                return t == DrawingID
              })
            }

            result.data.forEach(function (item) {
              if (item.RegionId.indexOf(regionID) > -1 && !isRepeat(item.DrawingID) && !isDownload(item.DrawingID) && filter(item)) {
                pics.push(item.DrawingID);
              }
            });
            pics.forEach(function (drawingID) {
              tasks.push(function () {
                return remote.Project.getDrawing(drawingID).then(function () {
                  var _pics = sxtlocaStorage.getObj("pics");
                  if (!_pics) {
                    _pics = [];
                  }
                  _pics.push(drawingID);
                  sxtlocaStorage.setObj("pics", _pics);
                });
              })
            });
            resolve(tasks);
          }).catch(function () {
            reject(tasks);
          });
        });
      }
    };
    //单个测量点的
    function qualified(items) {
      items.qualified >= 80 && items.zdpc < items.yxpc;
      return items.qualified


    }

    function buildMutilRegionTree(regions, rootType) {
      var res = [];
      var roots = $.grep(regions, function (r) {
        return rootType == r.RegionType;
      });
      roots.forEach(function (r) {
        res.push(buildRegionTree($.grep(regions, function (k) {
          return k.RegionID.indexOf(r.RegionID) > -1
        }), rootType));
      });
      return res;
    }


    function buildRegionTree(regions, rootType) {
      function buildRegion(region,parenName) {
        if (region && region.RegionType < 16) {
          region.Children = [];
          regions.forEach(function (k) {
            if (k.RegionType == region.RegionType * 2 && k.RegionID.indexOf(region.RegionID) > -1) {
              if (!region.Children.find(function (o) {
                  return o.RegionID == k.RegionID
                })) {
                if (region.RegionType>2){
                  if (parenName){
                    region.fullName=parenName+region.RegionName;
                  }else {
                    region.fullName=region.RegionName;
                  }
                }
                var re=buildRegion(k,region.fullName?region.fullName:null);
                if (re){
                  re.fullName=!re.fullName?(region.fullName+re.RegionName):re.fullName;
                }
                region.Children.push(re)
              }
            }
          });
        }
        return region;
      }

      var root = regions.find(function (k) {
        return k.RegionType == rootType;
      })
      if (!root) {
        return null;
      }
      return buildRegion(root,null);

    }
  }
})();

/**
 * Created by emma on 2016/3/31.
 */
(function(){
  angular
    .module('app.xhsc')
    .service('mapPopupSerivce',mapPopupSerivce);

  /** @Inject */
  function mapPopupSerivce(){
    var popups = {};
    this.set = function(id,element){
      popups[id] = element;
    }
    this.get = function(id){
     return popups[id];
    }
    this.remove = function(id){
      delete popups[id];
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  'use strict';
  xhUtils.$inject = ["$mdDialog", "$q"];
  angular
    .module('app.xhsc')
    .factory('xhUtils',xhUtils);
  /** @ngInject */
  function xhUtils($mdDialog,$q){
    var _areaId, cP,region;
    var o = {
      getMapPic:getMapPic,
      findAll:findAll,
      findRegion:findRegion,
      wrapRegion:wrapRegion,
      photo:photo,
      when:when,
      playPhoto:playPhoto,
      sort:sort,
      showMessage:showMessage,
      md5:(function () {
        /*
         * Configurable variables. You may need to tweak these to be compatible with
         * the server-side, but the defaults work in most cases.
         */
        var hexcase = 0;  /* hex output format. 0 - lowercase; 1 - uppercase        */
        var b64pad  = ""; /* base-64 pad character. "=" for strict RFC compliance   */
        var chrsz   = 8;  /* bits per input character. 8 - ASCII; 16 - Unicode      */

        /*
         * These are the functions you'll usually want to call
         * They take string arguments and return either hex or base-64 encoded strings
         */
        function hex_md5(s){ return binl2hex(core_md5(str2binl(s), s.length * chrsz));}
        function b64_md5(s){ return binl2b64(core_md5(str2binl(s), s.length * chrsz));}
        function str_md5(s){ return binl2str(core_md5(str2binl(s), s.length * chrsz));}
        function hex_hmac_md5(key, data) { return binl2hex(core_hmac_md5(key, data)); }
        function b64_hmac_md5(key, data) { return binl2b64(core_hmac_md5(key, data)); }
        function str_hmac_md5(key, data) { return binl2str(core_hmac_md5(key, data)); }

        /*
         * Perform a simple self-test to see if the VM is working
         */
        function md5_vm_test()
        {
          return hex_md5("abc") == "900150983cd24fb0d6963f7d28e17f72";
        }

        /*
         * Calculate the MD5 of an array of little-endian words, and a bit length
         */
        function core_md5(x, len)
        {
          /* append padding */
          x[len >> 5] |= 0x80 << ((len) % 32);
          x[(((len + 64) >>> 9) << 4) + 14] = len;

          var a =  1732584193;
          var b = -271733879;
          var c = -1732584194;
          var d =  271733878;

          for(var i = 0; i < x.length; i += 16)
          {
            var olda = a;
            var oldb = b;
            var oldc = c;
            var oldd = d;

            a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
            d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
            c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);
            b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
            a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
            d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);
            c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
            b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
            a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);
            d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
            c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
            b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
            a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);
            d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
            c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
            b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);

            a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
            d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
            c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);
            b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
            a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
            d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);
            c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
            b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
            a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);
            d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
            c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
            b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);
            a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
            d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
            c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);
            b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);

            a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
            d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
            c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);
            b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
            a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
            d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);
            c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
            b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
            a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);
            d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
            c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
            b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);
            a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
            d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
            c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);
            b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);

            a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
            d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);
            c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
            b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
            a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);
            d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
            c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
            b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
            a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);
            d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
            c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
            b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);
            a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
            d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
            c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);
            b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);

            a = safe_add(a, olda);
            b = safe_add(b, oldb);
            c = safe_add(c, oldc);
            d = safe_add(d, oldd);
          }
          return Array(a, b, c, d);

        }

        /*
         * These functions implement the four basic operations the algorithm uses.
         */
        function md5_cmn(q, a, b, x, s, t)
        {
          return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
        }
        function md5_ff(a, b, c, d, x, s, t)
        {
          return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
        }
        function md5_gg(a, b, c, d, x, s, t)
        {
          return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
        }
        function md5_hh(a, b, c, d, x, s, t)
        {
          return md5_cmn(b ^ c ^ d, a, b, x, s, t);
        }
        function md5_ii(a, b, c, d, x, s, t)
        {
          return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
        }

        /*
         * Calculate the HMAC-MD5, of a key and some data
         */
        function core_hmac_md5(key, data)
        {
          var bkey = str2binl(key);
          if(bkey.length > 16) bkey = core_md5(bkey, key.length * chrsz);

          var ipad = Array(16), opad = Array(16);
          for(var i = 0; i < 16; i++)
          {
            ipad[i] = bkey[i] ^ 0x36363636;
            opad[i] = bkey[i] ^ 0x5C5C5C5C;
          }

          var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz);
          return core_md5(opad.concat(hash), 512 + 128);
        }

        /*
         * Add integers, wrapping at 2^32. This uses 16-bit operations internally
         * to work around bugs in some JS interpreters.
         */
        function safe_add(x, y)
        {
          var lsw = (x & 0xFFFF) + (y & 0xFFFF);
          var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
          return (msw << 16) | (lsw & 0xFFFF);
        }

        /*
         * Bitwise rotate a 32-bit number to the left.
         */
        function bit_rol(num, cnt)
        {
          return (num << cnt) | (num >>> (32 - cnt));
        }

        /*
         * Convert a string to an array of little-endian words
         * If chrsz is ASCII, characters >255 have their hi-byte silently ignored.
         */
        function str2binl(str)
        {
          var bin = Array();
          var mask = (1 << chrsz) - 1;
          for(var i = 0; i < str.length * chrsz; i += chrsz)
            bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);
          return bin;
        }

        /*
         * Convert an array of little-endian words to a string
         */
        function binl2str(bin)
        {
          var str = "";
          var mask = (1 << chrsz) - 1;
          for(var i = 0; i < bin.length * 32; i += chrsz)
            str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & mask);
          return str;
        }

        /*
         * Convert an array of little-endian words to a hex string.
         */
        function binl2hex(binarray)
        {
          var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
          var str = "";
          for(var i = 0; i < binarray.length * 4; i++)
          {
            str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +
              hex_tab.charAt((binarray[i>>2] >> ((i%4)*8  )) & 0xF);
          }
          return str;
        }

        /*
         * Convert an array of little-endian words to a base-64 string
         */
        function binl2b64(binarray)
        {
          var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
          var str = "";
          for(var i = 0; i < binarray.length * 4; i += 3)
          {
            var triplet = (((binarray[i   >> 2] >> 8 * ( i   %4)) & 0xFF) << 16)
              | (((binarray[i+1 >> 2] >> 8 * ((i+1)%4)) & 0xFF) << 8 )
              |  ((binarray[i+2 >> 2] >> 8 * ((i+2)%4)) & 0xFF);
            for(var j = 0; j < 4; j++)
            {
              if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;
              else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);
            }
          }
          return str;
        }

        return hex_md5;
      })(),
      zgDays:function () {
        return [{
          value:6,
          time:'6小时'
        },{
          value:12,
          time:'12小时'
        },{
          value:24,
          time:'1天'
        },{
          value:24*2,
          time:'2天'
        },{
          value:24*3,
          time:'3天'
        },{
          value:24*4,
          time:'4天'
        },{
          value:24*5,
          time:'5天'
        },{
          value:24*6,
          time:'6天'
        },{
          value:24*7,
          time:'7天'
        },{
          value:24*15,
          time:'15天'
        }]
      },
      openLinks:function (mapList) {
        return $mdDialog.show({
          controller:['$scope', '$mdDialog',function ($scope, $mdDialog) {
            $scope.mapList = mapList;
            $scope.cancel = function () {
              $mdDialog.cancel();
            }
            $scope.answer = function () {
              if($scope.sMap)
                $scope.sMap=false;
              else
                $mdDialog.cancel();
            }
            $scope.showMap = function (item) {
              $scope.sMap = true;
              $scope.imageId = item.DrawingID;
              $scope.mapName = item.DrawingName
            }
            $scope.info = {}
          }],
          fullscreen:true,
          template: '<md-dialog style="width: 100%;max-width: 100%;height: 100%;max-height: 100%;" aria-label="List dialog">' +
          '<md-toolbar>'+
          '<div class="md-toolbar-tools"><h2 style="font-size:16px">{{sMap?mapName:\'图纸列表\'}}</h2><span flex></span><md-button class="md-icon-button" ng-click="answer()"> <md-icon md-font-icon="icon-close" aria-label="Close dialog"></md-icon> </md-button> </div>'+
          '</md-toolbar>' +
          '<md-dialog-content flex layout="column" style="padding: 0">' +
          '<md-list ng-show="!sMap"><md-list-item ng-repeat="item in mapList" ng-click="showMap(item)">{{item.DrawingName}}</md-list-item></md-list>' +
          '<div flex ng-show="sMap" layout="column" ct="info" sxt-show-map="imageId"><div flex layout="row" layout-align="center center" ng-if="info.loading"><md-progress-circular md-mode="indeterminate" ></md-progress-circular></div></div>'+
          '</md-dialog-content></md-dialog>'
        });
      },
      getSiblingsRegionID:getSiblingsRegionID
    };
    return o;

    function getNumName(str) {
      str = str.replace('十', '10')
        .replace('九', '9')
        .replace('八', '8')
        .replace('七', '7')
        .replace('六', '6')
        .replace('五', '5')
        .replace('四', '4')
        .replace('三', '3')
        .replace('二', '2')
        .replace('一', '1')
        .replace('十一', '11')
        .replace('十二', '12')
        .replace('十三', '13')
        .replace('十四', '14')
        .replace('十五', '15')
        .replace('十六', '16')
        .replace('十七', '17')
        .replace('十八', '18')
        .replace('十九', '19')
        .replace('二十', '20');
      var n = parseInt(/[-]?\d+/.exec(str));
      return n;
    };
    function sort(fn) {
      return function (s1,s2) {
        var a1 = fn(s1),
          a2 = fn(s2);

        var n1 = getNumName(a1),
          n2 = getNumName(a2);
        if (!isNaN(n1) && !isNaN(n2))
          return n1 - n2;
        else if ((isNaN(n1) && !isNaN(n2)))
          return 1;
        else if ((!isNaN(n1) && isNaN(n2)))
          return -1;
        else
          return a1.localeCompare(a2);
      }
    }

    function wrapRegion(target){
        region = target;
        region.find = find;
        region.each = each;
        region.fullName = region.RegionName;
        //栋
        region.Children && region.Children.forEach(function(d){
          d.$parent = region;
          d.fullName = region.fullName+d.RegionName;
          d.find = find;
          d.next = next;
          d.prev = prev;
          d.each = each;
          d.Children && d.Children.forEach(function(l){
            l.$parent = d;
            l.fullName = d.fullName+l.RegionName;
            l.find = find;
            l.next = next;
            l.prev = prev;
            l.each = each;

            l.Children && l.Children.forEach(function(r){
              r.$parent = l;
              r.fullName = l.fullName+r.RegionName;
              r.find = find;
              r.next = next;
              r.prev = prev;
              r.each = each;
            })
          })});
        function each(fn){
          fn(this);
          this.Children && this.Children.forEach(function(item){
            item.each(fn);
          })
        }
        function find(id){
          if(this.RegionID==id ||(typeof id==='function' && id(this)===true))
            return this;

          if(this.Children){
            var fd;
            this.Children.forEach(function(c){
              if(!fd){
                fd = c.find(id);
              }
            });
            if(fd)
              return fd;
          }
        }
        function next(){
          if(this.$parent) {
            var ix = this.$parent.Children.indexOf(this);
            var next = this.$parent.Children[ix + 1];
            if (next)
              return next;
            var p = this.$parent.next && this.$parent.next();
            if(p&& p.Children){
              return p.Children[0];
            }
          }
        }
        function prev(){
          if(this.$parent) {
            var ix = this.$parent.Children.indexOf(this);
            var next = this.$parent.Children[ix - 1];
            if (next)
              return next;
            var p = this.$parent.prev &&  this.$parent.prev();
            if(p && p.Children){
              return p.Children[p.Children.length-1];
            }
          }
        }
        return region;
    }
//获取楼层，户型的兄弟id
    function getSiblingsRegionID(regionId,regions){
        if (!regionId||!regions){
          return null;
        }
        if ((regions.RegionID.length+5)==regionId.length&&regionId.indexOf(regions.RegionID)>-1){
            return regions.Children;
        }
        var val;
        if (regions.Children&&regions.Children.length){
          for (var i=0;i<regions.Children.length;i++){
            val=getSiblingsRegionID(regionId,regions.Children[i]);
            if (val){
                return val;
            }
          }
        }
        return null;
    }

    function getMapPic(maxZoom){
      //console.log('m',maxZoom,Math.pow(2,maxZoom))
      var pics = [];
      for(var z=0;z<=maxZoom;z++){
        for(var x= 0,xl = Math.pow(2,z);x<xl;x++){
          for(var y= 0,yl = xl;y<yl;y++){
            pics.push(z+'_'+x+'_'+y)
          }
        }
      }
      return pics;
    }

    function findAll(array,fn) {
      var buff=[];
      array.forEach(function (item) {
        if(fn(item)===true)
          buff.push(item);
      });
      return buff;
    }

    function findRegion(regions,id,appendName) {
      if(!regions)return null;
      if(!angular.isArray(regions)){
        regions=[regions];
      }
      var fd = regions.find(function (r) {
        var len = r.RegionID.length;
        return id.substring(0,len)==r.RegionID;
      });
      if(!fd)return null;
      if(fd.RegionID!=id)
        return findRegion(fd.Children,id,(appendName||'')+fd.RegionName);
      else {
        fd.fullName = (appendName||'')+fd.RegionName;
        return fd;
      }
    }

    function  upRegion(regions,current){
      if(this.$parent) {
        var ix = this.$parent.Children.indexOf(this);
        var next = this.$parent.Children[ix - 1];
        if (next)
          return next;
        var p = this.$parent.prev &&  this.$parent.prev();
        if(p && p.Children){
          return p.Children[p.Children.length-1];
        }
      }
    }

    function photo($event, waterText) {
      return $mdDialog.show({
        targetEvent: $event,
        controller:['$scope', '$mdDialog',function ($scope, $mdDialog) {
          $scope.cancel = function () {
            // $mdDialog.cancel();
            var url = 'data:image/png;base64,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'
             $scope.answer(url);
          };
          $scope.waterText=waterText?waterText:"";
          $scope.answer = function ($base64Url) {
            $mdDialog.hide($base64Url);
          }
        }],
        fullscreen:true,
        template: '<md-dialog style="width: 100%;max-width: 100%;height: 100%;max-height: 100%;" aria-label="List dialog">' +
        '  <md-dialog-content flex layout="column" style="padding: 0">' +
        '<photo-draw flex layout="column" water-text="waterText" on-cancel="cancel()" on-answer="answer($base64Url)"></photo-draw>' +
        '  </md-dialog-content>'+
        '</md-dialog>'
      });
    }

    function when(exec,result) {
      return exec().then(function (r) {
        if(result(r)!==false){
          return exec();
        }
        else
          return r;
      })
    }

    function playPhoto(images,options) {
      if(!images || !images.length)return;
      var str = [];
      str.push('<ul>')
      angular.forEach(images, function (data) {
        str.push('<li><img src="' + data.url + '" alt="'+data.alt+'"></li>');
      });
      str.push('</ul>');
      o = $(str.join('')).appendTo('body');

      var viewer = new Viewer(o[0],{
        button:true,
        scalable:false,
        hide:function(){
          viewer.destroy();
          o.remove();
          viewer = o=null;
        },
        build:function(){

        },
        view:function(){
        }
      });
      viewer.show();
      return viewer;
    }

    function showMessage(content,callback){
      var o='<div class="slideTop slidedown" ng-class="{\'slidedown\':showMessage}">\
    <md-list style="margin-top: 0">\
    <md-list-item>\
    <label>消息通知</label>\
    <p style="word-break: break-all;">'+content+'</p>\
    </md-list-item></md-list>\
    <div layout="row">\
        <md-button flex  style="padding:10px 0;margin:0;border-right:1px solid #dedede;border-radius:0;text-align:center;">我知道了</md-button>\
        <md-button flex  style="padding:10px 0;margin:0;text-align:center;">点击查看</md-button>\
        </div>';
      var oel = $(o);
      oel.find('md-button').eq(0).click(function(){

          oel.remove();
          callback && callback(true);


      })
      oel.find('md-button').eq(1).click(function(){

          oel.remove();
          callback && callback(false);

      })
      //console.log('aa',content);

      return oel.appendTo('body')
    }
  }
})();

/**
 * Created by leshuangshuang on 16/4/15.
 */
(function() {
  'use strict';

  versionUpdate.$inject = ["$mdDialog", "$cordovaFileTransfer", "$window", "$http", "sxt"];
  angular
    .module('app.xhsc')
    .service('versionUpdate', versionUpdate);

  function versionUpdate($mdDialog, $cordovaFileTransfer, $window,$http,sxt) {

    var self = this;
    var version = '1.3.0.0',
      versionOld = version;
    this.version = version;

    function versionToNumber(version) {
      var n = version.split('.');
      var s = toNum(n[0])+toNum(n[1])+toNum(n[2])+toNum(n[3]);
      return parseInt(s);
    }
    function versionToNumber2(version) {
      var n = version.split('.');
      var s = toNum(n[0])+toNum(n[1])+toNum(n[2]);
      return parseInt(s);
    }

    function toNum(n) {
      var r = parseInt(n);
      var s = '000'+new String(isNaN(r)?0:r)
      return s.substring(s.length-3);
    }

    this.check = function () {
      // return $http.get(sxt.app.version+'/version.json?r='+(new Date()).valueOf())
      //   .then(function (data) {
      //     var serverAppVersion = data.data.version || data.data.vankeVersion;
      //     if (versionToNumber2(version) < versionToNumber2(serverAppVersion)) {
      //       var confirm = $mdDialog.confirm()
      //         .title('发现新版本' + serverAppVersion)
      //         .htmlContent(data.data.vankeLog || '')
      //         .ok('更新!')
      //         .cancel('暂不更新');
      //       $mdDialog.show(confirm).then(function () {
      //         var u = $window.navigator.userAgent;
      //         var isAndroid = u.indexOf('Android') > -1 //|| u.indexOf('Linux') > -1; //android终端或者uc浏览器
      //         var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
      //         if (isAndroid) {
      //           window.location.replace("https://app.ricent.com/galaxy");
      //         }
      //         if (isiOS) {
      //           window.location.href = "sxt://update";
      //         }
      //       });
      //     }
      //     else if (versionToNumber(version) < versionToNumber(serverAppVersion)) {
      //       version = serverAppVersion;
      //       self.version = versionOld + '(' + serverAppVersion + '正在更新)';
      //       sxt.download(function () {
      //         self.version = versionOld + '(' + serverAppVersion + '重启生效)';
      //       },function () {
      //         version = versionOld;
      //       });
      //     }
      //   });
    }
  }
})();

/**
 * Created by lss on 2016/5/19.
 */
(function(){
  'use strict';

  stzlServices.$inject = ["db", "$q"];
  angular
    .module('app.xhsc')
    .factory('stzlServices',stzlServices);
  /** @ngInject */
  function stzlServices(db,$q){
    function  resultWrap(assessment,callback){
      function  wrap(target){
          if (target.AssessmentItems&&angular.isArray(target.AssessmentItems)){
            target.AssessmentItems.forEach(function(o){
              callback(o);
            })
          }
          if(target.AssessmentClassifys&&angular.isArray(target.AssessmentClassifys)){
            target.AssessmentClassifys.forEach(function(o){
              wrap(o);
            })
          }
      }
      var assessmentClassifys= assessment.AssessmentClassifys;
      if (assessmentClassifys&&angular.isArray(assessmentClassifys)){
        assessmentClassifys.forEach(function(o){
          wrap(o);
        })
      }
    }

    function setLastScore(item){
      if(angular.isArray(item.question)){
          if (item.question.length>2){
            item.TotalScore=0;
          }else {
            var  score=item.Weight;
            item.question.forEach(function(o){
              if (angular.isNumber(o.DeductValue)){
                score= score-o.DeductValue;
                if (score<0){
                  score=0;
                }
              }
            });
            item.TotalScore=score;
            item.delValue = item.Weight - score;
          }
      }
    }
    function setaddScore(item){
      if(angular.isArray(item.question)){
          var  score=item.Weight;
          item.question.forEach(function(o){
            if (angular.isNumber(o.DeductValue)){
              score= score-o.DeductValue;
            }
          });
          item.TotalScore=score;
          item.delValue = item.Weight- score;
        }

    }
    function  getAllAssessItem(assessment){
      var  arr=[];
      resultWrap(assessment,function(o){
        arr.push(o);
      })
      return arr;
    }
    function  getRegionAssessItem(assessment,regionID){
        var  arr=[];
        var r=getAllAssessItem(assessment);
        r.forEach(function(e){
           if (e.regionID==regionID&&!arr.find(function(t){return t.regionID== e.regionID})){
             arr.push(e);
           }
        })
       return arr;
    }
    function  groupAssessItem(db){
      var regionIdArr=[];
      var result={};
      var r=getAllAssessItem(assessment);
      r.forEach(function(e){
        if (!regionIdArr.find(function(t){
            return t== e.regionID;
        })){
          regionIdArr.push(e.regionID);
        }
        regionIdArr.forEach(function(o){
          result[o]=[];
          r.forEach(function(e){
            if (o==e.regionID &&!result[o].find(function(t){return t== e.regionID})){
              result[o].push(e);
            }
          });
        });
        return result;
      })
    }

    function getAssessment(params,call1,call2){
     var q= $q.defer()
      var _db= db('stzl_'+params.AssessmentID);
      _db.get(params.AssessmentID).then(function(r){
        if (angular.isFunction(call1)){
          call1(r);
        }
        q.resolve(r);
      }).catch(function(){
        var pk = db('xcpk');
        pk.get('xcpk').then(function (pk) {
          var item = pk.rows.find(function (it) {
            return it.AssessmentID == params.AssessmentID;
          });
          if (angular.isFunction(call2)){
            call2(item)
          }
          q.resolve(item);
        });
      })
      return q.promise;
    }


    function _convertItem(o){
       return {
         _id:o._id,
         AssessmentResultID:o._id,
         RegionID: o.regionID,
         AssessmentID: o.AssessmentID,
         AssessmentCheckItemID: o.AssessmentCheckItemID,
         TotalScore: o.TotalScore,
       }
    }

    function _convertQuestion(o){
      return{
        _id:o._id,
        DeducScoretItemID: o.DeducScoretItemID,
        AssessmentResultID: o.AssessmentResultID,
        ProblemID: o.ProblemID,
        DeductionScore: o.DeductValue
      }
    }

    function  preUpLoad(params){
      var q= $q.defer();
      var _db= db('stzl_'+params.AssessmentID);
      _db.get(params.AssessmentID).then(function(assment){
        var  items=[],images=[],questions=[];
        var  r_=getAllAssessItem(assment);
        var tmp_question,tmp_img;
        r_.forEach(function(r){
          items.push(_convertItem(r));
          tmp_question= r.question;
          if (angular.isArray(tmp_question)){
            tmp_question.forEach(function(t){
              questions.push(_convertQuestion(t));
              tmp_img= t.images;
              if (angular.isArray(tmp_img)){
                tmp_img.forEach(function(s){
                  images.push(s);
                })
              }
            })
          }
        });
        var _db_item=db('Pack'+params.AssessmentID+  'stzl_item');
        _db_item.bulkAddOrUpdate(items).then(function(r){
           var _db_question=db('Pack'+params.AssessmentID+ 'stzl_question');
          _db_question.bulkAddOrUpdate(questions).then(function(t){
            var _db_image=db('Pack'+params.AssessmentID+ 'stzl_images');
            _db_image.bulkAddOrUpdate(images).then(function(m){
               q.resolve(true);
            })
          })
        })

      }).catch(function(r){
          q.resolve(false);
      })
      return q.promise;
    }

    return  {
      resultWrap:resultWrap ,
      setLastScore:setLastScore,
      getAllAssessItem:getAllAssessItem,
      getRegionAssessItem:getRegionAssessItem,
      groupAssessItem:groupAssessItem,
      getAssessment:getAssessment,
      preUpLoad:preUpLoad,
      setaddScore:setaddScore
    }
  }
})();

/**
 * Created by lss on 2016/7/26.
 */
/**
 * Created by jiuyuong on 2016/5/6.
 */
(function () {
  'use strict';

  scRemotePack.$inject = ["db", "$q", "$http", "$rootScope", "$cordovaFileTransfer", "sxt"];
  angular
    .module('app.xhsc')
    .factory('scRemotePack',scRemotePack);

  /** @ngInject */
  function scRemotePack(db,$q,$http,$rootScope,$cordovaFileTransfer,sxt) {
    function Pack(config) {
      var self = this;
      self._id = config._id;
      self.db= {};
      self.max = config.max||20;
      self.status = 0;

      for(var k in config.db){
        self[k] = config.db[k];
        self[k].db = db('Pack'+config._id+k);
      }
    }
    Pack.prototype.upload = function (process) {
      var self = this;
      self.tasks = [];
      var when=[],dbs=[];
      for(var k in self){
        if(self.hasOwnProperty(k)) {
          var m = self[k];
          if (m.db) {
            dbs.push(m);
            when.push(m.db.findAll());
          }
        }
      }
      $q.all(when).then(function (results) {
        var i = 0;
        results.forEach(function (r) {
          r.rows.forEach(function (t) {
            self.tasks.push({
              type:dbs[i].type,
              data:t,
              // type:dbs[i].type,
              url:dbs[i].url,
              index:dbs[i].index||0
            })
          });
          i++;
        });
        self.tasks.sort(function (s1,s2) {
          return s1.index - s2.index;
        });
        self.upTask(process);
      }).catch(function(error){
        console.log(error);
      });
    };
    Pack.prototype.getNexts = function (process) {
      var self = this,
        url,tasks=[],type,p=0;
      self.tasks.forEach(function (task) {

        if(task.completed || (task.try && task.try>3 ) ||(type && type=='file') ||(type && type=='fileurl')) {
          p++;
          return;
        }
        if(!task.url)
          return;
        if(!url)
          url = task.url;


        if(url==task.url &&  tasks.length<self.max  && (!type || type==task.type)){
          //p++;
          tasks.push(task);
        }
        if(!type)
          type = task.type;

      });
      process && process(parseInt(p>0? p/self.tasks.length*100:0),p,self.tasks.length);
      return tasks;
    }
    Pack.prototype.upTask = function (process) {
      var self = this,
        tasks = self.getNexts(process);
      if(!tasks.length){
        //self.isUp = false;
        self.completed = !self.tasks.find(function (t) {
          return !t.completed;
        });
        if(self.completed){
          self.clear().then(function(){
            self.initDB();
            process && process(-1);
          });
          return;
        }
        process && process(-1);
      }

      var url=tasks[0].url,
        type = tasks[0].data.type;
      if(type === 'file'){
        $cordovaFileTransfer.upload(url,tasks[0].data.local).then(function () {
          tasks[0].completed = true;
          self.upTask(process);
        },function (err) {
          tasks[0].try = (tasks[0].try||0)+1;
          self.upTask();
        },function (progress) {
          tasks[0].progress = (progress.loaded / progress.total) * 100;
          // (progress.loaded / progress.total) * 100
        });
      }
      else{
        var data=[];
        tasks.forEach(function (item) {
          data.push(item.data);
        });
        $http.post(url,data).then(function (r) {
          if (r.status==200){
            tasks.forEach(function (task) {
              task.completed = true;
            });
            self.upTask(process);
          }else {
            process && process(-1);
          }
        }).catch(function (err) {
          tasks.forEach(function (task) {
            task.try = (task.try||0)+1;
          });
          self.upTask(process);
        });
      }
    }
    Pack.prototype.clear=function(){
      var self=this;
      var p=[];
      for(var k in self){
        if(self.hasOwnProperty(k)) {
          var m = self[k];
          if (m.db) {
            p.push(m.db.destroy());
            m.db = db('Pack'+self._id+k);
          }
        }
      }
      return $q.all(p);
    }
    Pack.prototype.initDB=function(){
      var self=this;
      //var p=[];
      for(var k in self){
        if(self.hasOwnProperty(k)) {
          var m = self[k];
          if (m.db) {
            m.db = db('Pack'+self._id+k);
          }
        }
      }
      //return $q.all(p);
    }
    var o = {
      packages:{},
      pack:function (config) {
        var pack = o.packages[config._id] = new Pack(config);
        return pack;
      },
      unPack:function (id) {
        delete o.packages[id];
      }
    }
    return o;
  }
})();

/**
 * Created by lss on 2016/7/24.
 */
/**
 * Created by jiuyuong on 2016/4/11.
 */
(function(){
  'use strict';

  scRemote.$inject = ["api"];
  angular
    .module('app.xhsc')
    .factory('scRemote',scRemote);
  /** @ngInject */
  function scRemote(api){
    return api.xhsc;
  }
})();

/**
 * Created by lss on 2016/7/24.
 */
/**
 * Created by jiuyuong on 2016/5/10.
 */
(function () {
  'use strict';

  scPack.$inject = ["scLocalPack", "scRemotePack", "sxt", "db", "$cordovaFile"];
  angular
    .module('app.xhsc')
    .factory('scPack',scPack);
  /** @ngInject */
  function scPack(scLocalPack, scRemotePack,sxt,db,$cordovaFile) {
    var  localPack=scLocalPack;
    var  remotePack=scRemotePack;
    var p ={
      sc:{
        down:function (item) {
          return localPack.pack({
            _id:item.AssessmentID,
            name:item.AssessmentSubject,
            tasks:[
              {
                _id:'GetMeasureItemInfoByAreaID',
                name:'获取分期下所有指标',
                url:'/Api/MeasureInfo/GetMeasureItemInfo?areaID='+item.ProjectID,
              },
              {
                _id:'GetRegionTreeInfo',
                name:'获取区域信息',
                url:'/Api/ProjectInfoApi/GetRegionTreeInfo?AreaID='+item.ProjectID,
                type:'data',
                item:angular.copy(item)
              },{
                _id:'GetBaseMeasure',
                name:'获取实测项',
                url:'/api/MeasureInfo/GetBaseMeasure',
                type:'data'
              }
            ]
          });
        },
        up:function (id) {
          return remotePack.pack({
            _id:id,
            max:200,
            db:{
              sc: {
                url:sxt.app.api+'/Api/MeasureValueApi/CreateMeasureValue',
                type: 'data'
              },
              point: {
                url:sxt.app.api+'/Api/MeasurePointApi/CreatePoint',
                type: 'data'
              },
              indexs:{
                url:sxt.app.api+'/Api/MeasureValueApi/MeasureIndexSubmit',
                type:'data'
              },
              stzl_item:{
                url:sxt.app.api+'/Api/AssessmentApi/SubmitAssessmentRegionItemResult',
                type:'data'
              },
              stzl_question:{
                url:sxt.app.api+'/Api/AssessmentApi/SubmitEductScoreItem',
                type:'data'
              },
              stzl_images:{
                url:sxt.app.api+'/Api/MeasureValueApi/SubmitImage',
                type:'fileurl'
              }
            }
          })
        },
        remove:function (id,cb,progress){
          localPack.unPack(id);
          remotePack.unPack(id);
          var totalStep = 9,
            fn = function (step) {
              progress && progress(parseInt(step/totalStep*100));
            };
          fn(0);
          p.destroyDb('pack'+id,function () {
            fn(1);
            p.destroyDb('Pack'+id+'sc',function () {
              fn(2);
              p.destroyDb('Pack'+id+'point',function () {
                fn(3);
                p.destroyDb('Pack'+id+'indexs',function () {
                  fn(4);
                  p.destroyDb('Pack'+id+'pics',function () {
                    fn(5);
                    p.destroyDir(id, function () {
                      fn(6);
                      p.destroyDb('Pack'+id+'stzl_item',function () {
                        fn(7);
                        p.destroyDb('Pack'+id+'stzl_question',function () {
                          fn(8);
                          p.destroyDb('Pack'+id+'stzl_images', function () {
                            fn(9);
                            cb();

                          });
                        });
                      })
                    });
                  });
                })
              })
            })
          })
        },
        removeSc:function (id,cb,progress){
          localPack.unPack(id);
          remotePack.unPack(id);
          var totalStep = 9,
            fn = function (step) {
              progress && progress(parseInt(step/totalStep*100));
            };
          fn(0);
          p.destroyDb('Pack'+id+'sc',function () {
            fn(1);
            p.destroyDb('Pack'+id+'point',function () {
              fn(2);
              p.destroyDb('Pack'+id+'indexs',function () {
                fn(3);
                p.destroyDb('Pack'+id+'pics',function () {
                  fn(4);
                  p.destroyDir(id, function () {
                    fn(5);
                    p.destroyDb('Pack'+id+'stzl_item',function () {
                      fn(6);
                      p.destroyDb('Pack'+id+'stzl_question',function () {
                        fn(7);
                        p.destroyDb('Pack'+id+'stzl_images', function () {
                          fn(8)
                          p.destroyDb("Pack"+id+"scStandar",function(){
                            fn(9)
                            cb();
                          })
                        });
                      });
                    })
                  });
                });
              })
            })
          })

        }

      },
      destroyDb:function (dbKey,cb) {
        db(dbKey).destroy().then(function () {
          cb();
        }).catch(function (err) {
          cb(err);
        })
      },
      destroyDir:function (path,cb) {
        if(typeof cordova !== 'undefined') {
          $cordovaFile.removeDir(cordova.file.dataDirectory, path)
            .then(function (success) {
              cb();
            }, function (error) {
              cb(error);
            });
        }
        else{
          cb();
        }
      }
    };
    return p;
  }
})();

/**
 * Created by lss on 2016/7/24.
 */
/**
 * Created by jiuyuong on 2016/5/5.
 */
(function () {
  'use strict';
  scLocalPack.$inject = ["db", "$http", "$rootScope", "$cordovaFileTransfer", "sxt", "xhUtils", "$timeout", "$q"];
  angular
    .module('app.xhsc')
    .factory('scLocalPack', scLocalPack);
  /** @ngInject */
  function scLocalPack(db,$http,$rootScope,$cordovaFileTransfer,sxt,xhUtils,$timeout,$q) {

    function Pack(config) {
      var self = this,
        pack = db('pack'+config._id);
      self.pack = pack;
      if(!self.config) {
        pack.getOrAdd(config).then(function (config) {
          self.config = config;
          self.down();
        });
      }
    }
    Pack.prototype.down = function () {
      var self = this;
      if(!self.config || self.isDown)return;
      self.isDown = true;
      self.downTask();
    }
    Pack.prototype.reDown = function () {
      var self = this;
      if(self.config){
        self.config.tasks.forEach(function (item) {
          item.try=0;
          item.completed =false;
        });
        self.down();
      }
    }
    Pack.prototype.downTask = function () {
      var self = this;
      var task = self.config.tasks.find(function (t) {
        return !t.completed && (!t.try || t.try<4);
      });
      if(!task){
        self.isDown = false;
        self.completed = self.getProgress().progress==100;
        $rootScope.$emit('pack' + self.config._id, {
          name: 'allcomplete',
          config: self.config
        });
        return;
      }
      if(task){
        task.try = (task.try||0)+1;
        /*        $rootScope.$emit('pack'+self.config._id,{
         name:'begin',
         task:task,
         config:this.config
         });*/
        if(task.type=='ExRegion'){
          task.callback = function (data,config,cb) {
            var gx=[],areas=[];//计算要需要的指标和图纸
            this.item.MeasureItems.forEach(function (m) {
              if(m.AssessmentAreas.length==0)return;

              //TODO: 当前是以项目下载整个测试包，其实可能许多实现项是不需要测试的，数据多余，可以进一步优化
              /*              if(!gx.find(function (it) {
               return it.MeasureItemID==m.MeasureItemID
               })){
               gx.push({
               MeasureItemID:m.MeasureItemID,
               MeasureItemName:m.MeasureItemName,
               TemplateID:m.TemplateID,
               TemplateName:m.TemplateName
               });
               };*/

              m.AssessmentAreas.forEach(function (a) {
                if(!areas.find(function (it) {
                    return it.RegionID==a.AreaID
                  })){
                  var am = xhUtils.findRegion([data],a.AreaID);
                  //临时测试要去掉
                  //am.DrawingImageUrl='/fs/UploadFiles/Framework/a744a033f5eeec56549c440de2ddfbae.jpg';
                  if(am && am.DrawingImageUrl && !areas.find(function (a) {
                      return a.DrawingImageUrl==am.DrawingImageUrl
                    })) {
                    areas.push({
                      RegionID: am.RegionID,
                      RegionName:am.RegionName,
                      DrawingID:am.DrawingID,
                      DrawingImageUrl:am.DrawingImageUrl,
                      RegionType:am.RegionType
                    });
                  };
                }
              });
            });


            /*            gx.forEach(function (g) {
             config.task.push({
             _id:'gx_'+g.MeasureItemID,
             url:sxt.app.api+'/Api/MeasureInfo/GetMeasureItemInfoByAreaID?areaID='+
             })
             });*/
            if(typeof cordova != 'undefined') {
              areas.forEach(function (area) {
                var pics = xhUtils.getMapPic(area.RegionType == 8 ? 4 : 3);
                pics.forEach(function (u) {
                  config.tasks.push({
                    _id: area.RegionID + '_p_' + u,
                    type: 'file',
                    url:sxt.app.fs+'/Api/Picture/Tile/'+u+'?path='+area.DrawingImageUrl + '&name=/' + area.DrawingID +'_'+ u + '.png'
                    //测试数据
                    //url: 'http://ggem.sxtsoft.com:9191/Api/Picture/Tile/' + u + '?path=' + area.DrawingImageUrl + '&name=/' + area.DrawingID + u + '.png'
                  });
                })
              });
            }
            $rootScope.$emit('pack'+self.config._id,{
              name:'taskchanged',
              task:task,
              config:self.config
            });
            cb();
          }
        }
        if(task.type == 'file') {
          try {
            //TODO: 下载的文章与业务ID做为目录，不能共享，需要共享优化
            var rootPath = cordova.file.dataDirectory+ self.config._id+'/',
              names = task.url.split('/'),
              name = names[names.length - 1];
            task.local = rootPath + name;
            $cordovaFileTransfer.download(task.url, task.local)
              .then(function (result) {
                task.completed = true;
                $rootScope.$emit('pack' + self.config._id, {
                  name: 'complete',
                  task: task,
                  config: self.config
                });
                self.downTask();
              }, function (err) {
                task.err = err;
                self.downTask();
              }, function (progress) {

              });
          }catch (ex){
            $rootScope.$emit('pack'+self.config._id,{
              name:'error',
              task:task,
              config:self.config
            });
          }
        }
        else{
          (task.api?task.api():$http.get(sxt.app.api + task.url)).then(function (result) {
            if(task.db){
              var taskDb = db(task.db);
              var updates = [];
              if(task.type=='rows'){
                result.data.forEach(function(row){
                  row._id = row._id||row[task.idField];
                  updates.push(taskDb.addOrUpdate(row));
                });
              }
              else{
                updates.push(taskDb.addOrUpdate(result.data));
              }
              $q.all(updates).then(function (r) {
                $rootScope.$emit('pack'+self.config._id,{
                  name:'complete',
                  task:task,
                  config:self.config
                });
                task.completed = true;
                if(task.callback && task.callback(result.data,self.config,function () {
                    self.downTask();
                  }));
                else
                  self.downTask();

              }).catch(function () {
                self.downTask();
              })

            }
            else{

              self.pack.addOrUpdate({_id:task._id,data:result.data}).then(function () {
                task.completed = true;
                $rootScope.$emit('pack'+self.config._id,{
                  name:'complete',
                  task:task,
                  config:self.config
                });
                if(task.callback && task.callback(result.data,self.config,function () {
                    self.downTask();
                  }));
                else
                  self.downTask();
              }).catch(function () {
                self.downTask();
              })
            }
          })
        }
      }
    }
    Pack.prototype.getProgress = function () {
      var completed = 0, total = this.config.tasks.length;
      this.config.tasks.forEach(function (task) {
        if (task.completed)
          completed++;
      });
      return {
        completed: completed,
        total: total,
        progress: parseInt(completed / total *100)
      }
    }

    var o ={
      packages:{},
      pack:pack,
      unPack:function (id) {
        delete o.packages[id];
      }
    };
    return o;
    function pack(config) {
      //if(!this.packages[config._id]) {
      //  this.packages[config._id] = new Pack(config);
      //}
      //else{
      //  this.packages[config._id].isDown=false;
      //  this.packages[config._id].reDown();
      //}
      //return  this.packages[config._id];
      return new Pack(config);
    }

  }
})();

/**
 * Created by jiuyuong on 2016/5/6.
 */
(function () {
  'use strict';

  remotePack.$inject = ["db", "$q", "$http", "$rootScope", "$cordovaFileTransfer", "sxt", "api"];
  angular
    .module('app.xhsc')
    .factory('remotePack',remotePack);

  /** @ngInject */
  function remotePack(db,$q,$http,$rootScope,$cordovaFileTransfer,sxt,api) {
    function Pack(config) {
      var self = this;
      self._id = config._id;
      self.db= {};
      self.max = config.max||20;
      self.status = 0;

      for(var k in config.db){
        self[k] = config.db[k];
        self[k].db = db('Pack'+config._id+k);// db('Pack'+config._id+k);
      }
    }
    Pack.prototype.upload = function (process) {
      var self = this;
      if(self.isUp)return;
      self.isUp = true;
      self.tasks = [];
      var when=[],dbs=[];
      for(var k in self){
        if(self.hasOwnProperty(k)) {
          var m = self[k];
          if (m.db) {
            dbs.push(m);
            when.push(m.db.findAll());
          }
        }
      }
      $q.all(when).then(function (results) {
        var i = 0;
        results.forEach(function (r) {
          r.rows.forEach(function (t) {
            self.tasks.push({
              type:dbs[i].type,
              data:t,
             // type:dbs[i].type,
              url:dbs[i].url,
              index:dbs[i].index||0
            })
          });
          i++;
        });
        self.tasks.sort(function (s1,s2) {
          return s1.index - s2.index;
        });
        self.upTask(process);
      });
    };
    Pack.prototype.getNexts = function (process) {
      var self = this,
        url,tasks=[],type,p=0;
      self.tasks.forEach(function (task) {

        if(task.completed || (task.try && task.try>3 ) ||(type && type=='file') ||(type && type=='fileurl')) {
          p++;
          return;
        }
        if(!task.url)
          return;
        if(!url)
          url = task.url;
        if(url==task.url &&  tasks.length<self.max  && (!type || type==task.type)){
          //p++;
          tasks.push(task);
        }
        if(!type)
          type = task.type;

      });
      process && process(parseInt( p/self.tasks.length*100),p,self.tasks.length);

      return tasks;
    }
    Pack.prototype.upTask = function (process) {
      var self = this,
        tasks = self.getNexts(process);
      if(!tasks.length){
        self.isUp = false;
        self.completed = !self.tasks.find(function (t) {
          return !t.completed;
        });
        process && process(-1);
        return;
      }

      var url=tasks[0].url,
        type = tasks[0].data.type;
      if(type === 'file'){
        $cordovaFileTransfer.upload(url,tasks[0].data.local).then(function () {
          tasks[0].completed = true;
          self.upTask(process);
        },function (err) {
          tasks[0].try = (tasks[0].try||0)+1;
          self.upTask();
        },function (progress) {
          tasks[0].progress = (progress.loaded / progress.total) * 100;
        });
      }
      else{
        var data=[];
        tasks.forEach(function (item) {
          data.push(item.data);
        });
        $http.post(url,data).then(function () {
          tasks.forEach(function (task) {
            task.completed = true;
          });
          self.upTask(process);
        }).catch(function (err) {
          tasks.forEach(function (task) {
            task.try = (task.try||0)+1;
          });
          self.upTask(process);
        });
      }
    }

    var o = {
      packages:{},
      pack:function (config) {
        var pack = o.packages[config._id] = new Pack(config);
        return pack;
      },
      unPack:function (id) {
        delete o.packages[id];
      }
    }
    return o;
  }
})();

/**
 * Created by jiuyuong on 2016/4/11.
 */
(function(){
  'use strict';

  remote.$inject = ["api"];
  angular
    .module('app.xhsc')
    .factory('remote',remote);
  /** @ngInject */
  function remote(api){
    return api.xhsc;
  }
})();

/**
 * Created by lss on 2016/9/9.
 */
(function(){
  'use strict';

  panel.$inject = ["$mdPanel"];
  angular
    .module('app.xhsc')
    .factory('panel',panel);
  /** @ngInject */
  function panel($mdPanel){
    function _panel(){
      this._mdPanel=$mdPanel;
      this._mdPaneldef=null;

      function nulnfn(){

      }
      this.default={
        attachTo: angular.element(document.body),
        controller:nulnfn,
        controllerAs: 'ctrl',
        clickOutsideToClose: true,
        escapeToClose: true,
        trapFocus: true,
        focusOnOpen: true,
        hasBackdrop:true,
        disableParentScroll:true
      }
    }
    _panel.prototype.create=function(options){
      var self=this;
      var panelPosition = $mdPanel.newPanelPosition()
        .absolute()
        .center();
      //var animation = $mdPanel.newPanelAnimation();
      //animation.withAnimation($mdPanel.animation.SLIDE);
      if (options&&angular.isObject(options)){
        angular.extend(self.default,options,{
          position: panelPosition
          //animation: animation
        });
      }
      self._mdPanel.open(self.default)
        .then(function(result) {
          self._mdPaneldef=result;
        });
    }
    _panel.prototype.close=function(){
      this._mdPaneldef.close();
    }
    var p=new _panel();
    return{
      create:function(options){
        p.create(options);
      },
      close: function(){
        p.close();
      }
    }
  }
})();

 /**
 * Created by jiuyuong on 2016/5/10.
 */
(function () {
  'use strict';

  pack.$inject = ["localPack", "remotePack", "sxt", "db", "$cordovaFile", "$q"];
  angular
    .module('app.xhsc')
    .factory('pack',pack);
  /** @ngInject */
  function pack(localPack, remotePack,sxt,db,$cordovaFile,$q) {
    var p ={
      sc:{
        down:function (item) {
          return localPack.pack({
            _id:item.AssessmentID,
            name:item.AssessmentSubject,
            tasks:[
              {
                _id:'GetMeasureItemInfoByAreaID',
                name:'获取分期下所有指标',
                url:'/Api/MeasureInfo/GetMeasureItemInfo?areaID='+item.AreaID
              },
              {
                _id:'GetRegionTreeInfo',
                name:'获取区域信息',
                url:'/Api/ProjectInfoApi/GetRegionTreeInfoNotUser?AreaID='+item.AreaID,
                type:'data',
                item:angular.copy(item)
              }
            ]
          });
        },
        up:function (id) {
          return remotePack.pack({
            _id:id,
            max:400,
            db:{
              sc: {
                url:sxt.app.api+'/Api/MeasureValueApi/CreateMeasureValue',
                type: 'data'
              },
              point: {
                url:sxt.app.api+'/Api/MeasurePointApi/CreatePoint',
                type: 'data'
              },
              indexs:{
                url:sxt.app.api+'/Api/MeasureValueApi/MeasureIndexSubmit',
                type:'data'
              },
              stzl_item:{
                url:sxt.app.api+'/Api/AssessmentApi/SubmitAssessmentRegionItemResult',
                type:'data'
              },
              stzl_question:{
                url:sxt.app.api+'/Api/AssessmentApi/SubmitEductScoreItem',
                type:'data'
              },
              stzl_images:{
                url:sxt.app.api+'/Api/MeasureValueApi/SubmitImage',
                type:'fileurl'
              }
            }
          })
        },
        remove:function (id,cb,progress){
          return $q(function(resolve,reject){
            localPack.unPack(id);
            remotePack.unPack(id);
            var totalStep = 9,
              fn = function (step) {
                progress && progress(parseInt(step/totalStep*100));
              };
            fn(0);
            p.destroyDb('pack'+id,function () {
              fn(1);
              p.destroyDb('Pack'+id+'sc',function () {
                fn(2);
                p.destroyDb('Pack'+id+'point',function () {
                  fn(3);
                  p.destroyDb('Pack'+id+'indexs',function () {
                    fn(4);
                    p.destroyDb('Pack'+id+'pics',function () {
                      fn(5);
                      p.destroyDir(id, function () {
                        fn(6);
                        p.destroyDb('Pack'+id+'stzl_item',function () {
                          fn(7);
                          p.destroyDb('Pack'+id+'stzl_question',function () {
                            fn(8);
                            p.destroyDb('Pack'+id+'stzl_images', function () {
                              fn(9);
                              cb();
                            });
                          });
                        })
                      });
                    });
                  })
                })
              })
            })
          });
        }

      },
      destroyDb:function (dbKey,cb) {
        db(dbKey).destroy().then(function () {
          cb();
        }).catch(function (err) {
          cb(err);
        })
      },
      destroyDir:function (path,cb) {
        if(typeof cordova !== 'undefined') {
          $cordovaFile.removeDir(cordova.file.dataDirectory, path)
            .then(function (success) {
              cb();
            }, function (error) {
              cb(error);
            });
        }
        else{
          cb();
        }
      }
    };
    return p;
  }
})();

/**
 * Created by leshuangshuang on 16/6/24.
 */
(function(){
  'use strict';
  notification.$inject = ["JPushPlugin"];
  angular
    .module('app.xhsc')
    .factory('notification',notification);
  /** @ngInject */
  function notification(JPushPlugin){

    return{
      receiveMessage:receiveMessage
    }
    //获取自定义消息推送内容
    function receiveMessage(){
    }

  }

})();

/**
 * Created by emma on 2016/4/14.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .filter('myFilter',myFilter);

  function myFilter(){
    return function(items,status) {
      var output = [];
      if (!items)return output;
      if (status == -1) {
        items.forEach(function(item){
          if( item.find(function (it) {
              return it.status != -1;
            })){
            output.push(item);
          }
        })
        return output;
      }
      //console.log('a',args)
      items.forEach(function (item) {
        if (
          item.find(function (it) {
            return it.status == status
          })
        ) {
          output.push(item)
        }
      })
      return output;
    }
  }


})();

/**
 * Created by jiuyuong on 2016/3/15.
 */
(function(){
  'use strict';
  angular
    .module('app.xhsc')
    .factory('markerCulster',function(){
      (function (window, document, undefined) {/*
       * L.MarkerClusterGroup extends L.FeatureGroup by clustering the markers contained within
       */

        L.MarkerClusterGroup = L.FeatureGroup.extend({

          options: {
            maxClusterRadius: 80, //A cluster will cover at most this many pixels from its center
            iconCreateFunction: null,

            spiderfyOnMaxZoom: true,
            showCoverageOnHover: true,
            zoomToBoundsOnClick: true,
            singleMarkerMode: false,

            disableClusteringAtZoom: null,

            // Setting this to false prevents the removal of any clusters outside of the viewpoint, which
            // is the default behaviour for performance reasons.
            removeOutsideVisibleBounds: true,

            //Whether to animate adding markers after adding the MarkerClusterGroup to the map
            // If you are adding individual markers set to true, if adding bulk markers leave false for massive performance gains.
            animateAddingMarkers: false,

            //Increase to increase the distance away that spiderfied markers appear from the center
            spiderfyDistanceMultiplier: 1,

            // When bulk adding layers, adds markers in chunks. Means addLayers may not add all the layers in the call, others will be loaded during setTimeouts
            chunkedLoading: false,
            chunkInterval: 200, // process markers for a maximum of ~ n milliseconds (then trigger the chunkProgress callback)
            chunkDelay: 50, // at the end of each interval, give n milliseconds back to system/browser
            chunkProgress: null, // progress callback: function(processed, total, elapsed) (e.g. for a progress indicator)

            //Options to pass to the L.Polygon constructor
            polygonOptions: {}
          },

          initialize: function (options) {
            L.Util.setOptions(this, options);
            if (!this.options.iconCreateFunction) {
              this.options.iconCreateFunction = this._defaultIconCreateFunction;
            }

            this._featureGroup = L.featureGroup();
            this._featureGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);

            this._nonPointGroup = L.featureGroup();
            this._nonPointGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);

            this._inZoomAnimation = 0;
            this._needsClustering = [];
            this._needsRemoving = []; //Markers removed while we aren't on the map need to be kept track of
            //The bounds of the currently shown area (from _getExpandedVisibleBounds) Updated on zoom/move
            this._currentShownBounds = null;

            this._queue = [];
          },

          addLayer: function (layer) {

            if (layer instanceof L.LayerGroup) {
              var array = [];
              for (var i in layer._layers) {
                array.push(layer._layers[i]);
              }
              return this.addLayers(array);
            }

            //Don't cluster non point data
            if (!layer.getLatLng) {
              this._nonPointGroup.addLayer(layer);
              return this;
            }

            if (!this._map) {
              this._needsClustering.push(layer);
              return this;
            }

            if (this.hasLayer(layer)) {
              return this;
            }


            //If we have already clustered we'll need to add this one to a cluster

            if (this._unspiderfy) {
              this._unspiderfy();
            }

            this._addLayer(layer, this._maxZoom);

            //Work out what is visible
            var visibleLayer = layer,
              currentZoom = this._map.getZoom();
            if (layer.__parent) {
              while (visibleLayer.__parent._zoom >= currentZoom) {
                visibleLayer = visibleLayer.__parent;
              }
            }

            if (this._currentShownBounds.contains(visibleLayer.getLatLng())) {
              if (this.options.animateAddingMarkers) {
                this._animationAddLayer(layer, visibleLayer);
              } else {
                this._animationAddLayerNonAnimated(layer, visibleLayer);
              }
            }
            return this;
          },

          removeLayer: function (layer) {

            if (layer instanceof L.LayerGroup) {
              var array = [];
              for (var i in layer._layers) {
                array.push(layer._layers[i]);
              }
              return this.removeLayers(array);
            }

            //Non point layers
            if (!layer.getLatLng) {
              this._nonPointGroup.removeLayer(layer);
              return this;
            }

            if (!this._map) {
              if (!this._arraySplice(this._needsClustering, layer) && this.hasLayer(layer)) {
                this._needsRemoving.push(layer);
              }
              return this;
            }

            if (!layer.__parent) {
              return this;
            }

            if (this._unspiderfy) {
              this._unspiderfy();
              this._unspiderfyLayer(layer);
            }

            //Remove the marker from clusters
            this._removeLayer(layer, true);

            if (this._featureGroup.hasLayer(layer)) {
              this._featureGroup.removeLayer(layer);
              if (layer.setOpacity) {
                layer.setOpacity(1);
              }
            }

            return this;
          },

          //Takes an array of markers and adds them in bulk
          addLayers: function (layersArray) {
            var fg = this._featureGroup,
              npg = this._nonPointGroup,
              chunked = this.options.chunkedLoading,
              chunkInterval = this.options.chunkInterval,
              chunkProgress = this.options.chunkProgress,
              newMarkers, i, l, m;

            if (this._map) {
              var offset = 0,
                started = (new Date()).getTime();
              var process = L.bind(function () {
                var start = (new Date()).getTime();
                for (; offset < layersArray.length; offset++) {
                  if (chunked && offset % 200 === 0) {
                    // every couple hundred markers, instrument the time elapsed since processing started:
                    var elapsed = (new Date()).getTime() - start;
                    if (elapsed > chunkInterval) {
                      break; // been working too hard, time to take a break :-)
                    }
                  }

                  m = layersArray[offset];

                  //Not point data, can't be clustered
                  if (!m.getLatLng) {
                    npg.addLayer(m);
                    continue;
                  }

                  if (this.hasLayer(m)) {
                    continue;
                  }

                  this._addLayer(m, this._maxZoom);

                  //If we just made a cluster of size 2 then we need to remove the other marker from the map (if it is) or we never will
                  if (m.__parent) {
                    if (m.__parent.getChildCount() === 2) {
                      var markers = m.__parent.getAllChildMarkers(),
                        otherMarker = markers[0] === m ? markers[1] : markers[0];
                      fg.removeLayer(otherMarker);
                    }
                  }
                }

                if (chunkProgress) {
                  // report progress and time elapsed:
                  chunkProgress(offset, layersArray.length, (new Date()).getTime() - started);
                }

                if (offset === layersArray.length) {
                  //Update the icons of all those visible clusters that were affected
                  this._featureGroup.eachLayer(function (c) {
                    if (c instanceof L.MarkerCluster && c._iconNeedsUpdate) {
                      c._updateIcon();
                    }
                  });

                  this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);
                } else {
                  setTimeout(process, this.options.chunkDelay);
                }
              }, this);

              process();
            } else {
              newMarkers = [];
              for (i = 0, l = layersArray.length; i < l; i++) {
                m = layersArray[i];

                //Not point data, can't be clustered
                if (!m.getLatLng) {
                  npg.addLayer(m);
                  continue;
                }

                if (this.hasLayer(m)) {
                  continue;
                }

                newMarkers.push(m);
              }
              this._needsClustering = this._needsClustering.concat(newMarkers);
            }
            return this;
          },

          //Takes an array of markers and removes them in bulk
          removeLayers: function (layersArray) {
            var i, l, m,
              fg = this._featureGroup,
              npg = this._nonPointGroup;

            if (!this._map) {
              for (i = 0, l = layersArray.length; i < l; i++) {
                m = layersArray[i];
                this._arraySplice(this._needsClustering, m);
                npg.removeLayer(m);
              }
              return this;
            }

            for (i = 0, l = layersArray.length; i < l; i++) {
              m = layersArray[i];

              if (!m.__parent) {
                npg.removeLayer(m);
                continue;
              }

              this._removeLayer(m, true, true);

              if (fg.hasLayer(m)) {
                fg.removeLayer(m);
                if (m.setOpacity) {
                  m.setOpacity(1);
                }
              }
            }

            //Fix up the clusters and markers on the map
            this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);

            fg.eachLayer(function (c) {
              if (c instanceof L.MarkerCluster) {
                c._updateIcon();
              }
            });

            return this;
          },

          //Removes all layers from the MarkerClusterGroup
          clearLayers: function () {
            //Need our own special implementation as the LayerGroup one doesn't work for us

            //If we aren't on the map (yet), blow away the markers we know of
            if (!this._map) {
              this._needsClustering = [];
              delete this._gridClusters;
              delete this._gridUnclustered;
            }

            if (this._noanimationUnspiderfy) {
              this._noanimationUnspiderfy();
            }

            //Remove all the visible layers
            this._featureGroup.clearLayers();
            this._nonPointGroup.clearLayers();

            this.eachLayer(function (marker) {
              delete marker.__parent;
            });

            if (this._map) {
              //Reset _topClusterLevel and the DistanceGrids
              this._generateInitialClusters();
            }

            return this;
          },

          //Override FeatureGroup.getBounds as it doesn't work
          getBounds: function () {
            var bounds = new L.LatLngBounds();

            if (this._topClusterLevel) {
              bounds.extend(this._topClusterLevel._bounds);
            }

            for (var i = this._needsClustering.length - 1; i >= 0; i--) {
              bounds.extend(this._needsClustering[i].getLatLng());
            }

            bounds.extend(this._nonPointGroup.getBounds());

            return bounds;
          },

          //Overrides LayerGroup.eachLayer
          eachLayer: function (method, context) {
            var markers = this._needsClustering.slice(),
              i;

            if (this._topClusterLevel) {
              this._topClusterLevel.getAllChildMarkers(markers);
            }

            for (i = markers.length - 1; i >= 0; i--) {
              method.call(context, markers[i]);
            }

            this._nonPointGroup.eachLayer(method, context);
          },

          //Overrides LayerGroup.getLayers
          getLayers: function () {
            var layers = [];
            this.eachLayer(function (l) {
              layers.push(l);
            });
            return layers;
          },

          //Overrides LayerGroup.getLayer, WARNING: Really bad performance
          getLayer: function (id) {
            var result = null;

            this.eachLayer(function (l) {
              if (L.stamp(l) === id) {
                result = l;
              }
            });

            return result;
          },

          //Returns true if the given layer is in this MarkerClusterGroup
          hasLayer: function (layer) {
            if (!layer) {
              return false;
            }

            var i, anArray = this._needsClustering;

            for (i = anArray.length - 1; i >= 0; i--) {
              if (anArray[i] === layer) {
                return true;
              }
            }

            anArray = this._needsRemoving;
            for (i = anArray.length - 1; i >= 0; i--) {
              if (anArray[i] === layer) {
                return false;
              }
            }

            return !!(layer.__parent && layer.__parent._group === this) || this._nonPointGroup.hasLayer(layer);
          },

          //Zoom down to show the given layer (spiderfying if necessary) then calls the callback
          zoomToShowLayer: function (layer, callback) {

            var showMarker = function () {
              if ((layer._icon || layer.__parent._icon) && !this._inZoomAnimation) {
                this._map.off('moveend', showMarker, this);
                this.off('animationend', showMarker, this);

                if (layer._icon) {
                  callback();
                } else if (layer.__parent._icon) {
                  var afterSpiderfy = function () {
                    this.off('spiderfied', afterSpiderfy, this);
                    callback();
                  };

                  this.on('spiderfied', afterSpiderfy, this);
                  layer.__parent.spiderfy();
                }
              }
            };

            if (layer._icon && this._map.getBounds().contains(layer.getLatLng())) {
              //Layer is visible ond on screen, immediate return
              callback();
            } else if (layer.__parent._zoom < this._map.getZoom()) {
              //Layer should be visible at this zoom level. It must not be on screen so just pan over to it
              this._map.on('moveend', showMarker, this);
              this._map.panTo(layer.getLatLng());
            } else {
              var moveStart = function () {
                this._map.off('movestart', moveStart, this);
                moveStart = null;
              };

              this._map.on('movestart', moveStart, this);
              this._map.on('moveend', showMarker, this);
              this.on('animationend', showMarker, this);
              layer.__parent.zoomToBounds();

              if (moveStart) {
                //Never started moving, must already be there, probably need clustering however
                showMarker.call(this);
              }
            }
          },

          //Overrides FeatureGroup.onAdd
          onAdd: function (map) {
            this._map = map;
            var i, l, layer;

            if (!isFinite(this._map.getMaxZoom())) {
              throw "Map has no maxZoom specified";
            }

            this._featureGroup.onAdd(map);
            this._nonPointGroup.onAdd(map);

            if (!this._gridClusters) {
              this._generateInitialClusters();
            }

            for (i = 0, l = this._needsRemoving.length; i < l; i++) {
              layer = this._needsRemoving[i];
              this._removeLayer(layer, true);
            }
            this._needsRemoving = [];

            //Remember the current zoom level and bounds
            this._zoom = this._map.getZoom();
            this._currentShownBounds = this._getExpandedVisibleBounds();

            this._map.on('zoomend', this._zoomEnd, this);
            this._map.on('moveend', this._moveEnd, this);

            if (this._spiderfierOnAdd) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely
              this._spiderfierOnAdd();
            }

            this._bindEvents();

            //Actually add our markers to the map:
            l = this._needsClustering;
            this._needsClustering = [];
            this.addLayers(l);
          },

          //Overrides FeatureGroup.onRemove
          onRemove: function (map) {
            map.off('zoomend', this._zoomEnd, this);
            map.off('moveend', this._moveEnd, this);

            this._unbindEvents();

            //In case we are in a cluster animation
            this._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');

            if (this._spiderfierOnRemove) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely
              this._spiderfierOnRemove();
            }



            //Clean up all the layers we added to the map
            this._hideCoverage();
            this._featureGroup.onRemove(map);
            this._nonPointGroup.onRemove(map);

            this._featureGroup.clearLayers();

            this._map = null;
          },

          getVisibleParent: function (marker) {
            var vMarker = marker;
            while (vMarker && !vMarker._icon) {
              vMarker = vMarker.__parent;
            }
            return vMarker || null;
          },

          //Remove the given object from the given array
          _arraySplice: function (anArray, obj) {
            for (var i = anArray.length - 1; i >= 0; i--) {
              if (anArray[i] === obj) {
                anArray.splice(i, 1);
                return true;
              }
            }
          },

          //Internal function for removing a marker from everything.
          //dontUpdateMap: set to true if you will handle updating the map manually (for bulk functions)
          _removeLayer: function (marker, removeFromDistanceGrid, dontUpdateMap) {
            var gridClusters = this._gridClusters,
              gridUnclustered = this._gridUnclustered,
              fg = this._featureGroup,
              map = this._map;

            //Remove the marker from distance clusters it might be in
            if (removeFromDistanceGrid) {
              for (var z = this._maxZoom; z >= 0; z--) {
                if (!gridUnclustered[z].removeObject(marker, map.project(marker.getLatLng(), z))) {
                  break;
                }
              }
            }

            //Work our way up the clusters removing them as we go if required
            var cluster = marker.__parent,
              markers = cluster._markers,
              otherMarker;

            //Remove the marker from the immediate parents marker list
            this._arraySplice(markers, marker);

            while (cluster) {
              cluster._childCount--;

              if (cluster._zoom < 0) {
                //Top level, do nothing
                break;
              } else if (removeFromDistanceGrid && cluster._childCount <= 1) { //Cluster no longer required
                //We need to push the other marker up to the parent
                otherMarker = cluster._markers[0] === marker ? cluster._markers[1] : cluster._markers[0];

                //Update distance grid
                gridClusters[cluster._zoom].removeObject(cluster, map.project(cluster._cLatLng, cluster._zoom));
                gridUnclustered[cluster._zoom].addObject(otherMarker, map.project(otherMarker.getLatLng(), cluster._zoom));

                //Move otherMarker up to parent
                this._arraySplice(cluster.__parent._childClusters, cluster);
                cluster.__parent._markers.push(otherMarker);
                otherMarker.__parent = cluster.__parent;

                if (cluster._icon) {
                  //Cluster is currently on the map, need to put the marker on the map instead
                  fg.removeLayer(cluster);
                  if (!dontUpdateMap) {
                    fg.addLayer(otherMarker);
                  }
                }
              } else {
                cluster._recalculateBounds();
                if (!dontUpdateMap || !cluster._icon) {
                  cluster._updateIcon();
                }
              }

              cluster = cluster.__parent;
            }

            delete marker.__parent;
          },

          _isOrIsParent: function (el, oel) {
            while (oel) {
              if (el === oel) {
                return true;
              }
              oel = oel.parentNode;
            }
            return false;
          },

          _propagateEvent: function (e) {
            if (e.layer instanceof L.MarkerCluster) {
              //Prevent multiple clustermouseover/off events if the icon is made up of stacked divs (Doesn't work in ie <= 8, no relatedTarget)
              if (e.originalEvent && this._isOrIsParent(e.layer._icon, e.originalEvent.relatedTarget)) {
                return;
              }
              e.type = 'cluster' + e.type;
            }

            this.fire(e.type, e);
          },

          //Default functionality
          _defaultIconCreateFunction: function (cluster) {
            var childCount = cluster.getChildCount();

            var c = ' marker-cluster-';
            if (childCount < 10) {
              c += 'small';
            } else if (childCount < 100) {
              c += 'medium';
            } else {
              c += 'large';
            }

            return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(40, 40) });
          },

          _bindEvents: function () {
            var map = this._map,
              spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,
              showCoverageOnHover = this.options.showCoverageOnHover,
              zoomToBoundsOnClick = this.options.zoomToBoundsOnClick;

            //Zoom on cluster click or spiderfy if we are at the lowest level
            if (spiderfyOnMaxZoom || zoomToBoundsOnClick) {
              this.on('clusterclick', this._zoomOrSpiderfy, this);
            }

            //Show convex hull (boundary) polygon on mouse over
            if (showCoverageOnHover) {
              this.on('clustermouseover', this._showCoverage, this);
              this.on('clustermouseout', this._hideCoverage, this);
              map.on('zoomend', this._hideCoverage, this);
            }
          },

          _zoomOrSpiderfy: function (e) {
            var map = this._map;
            if (map.getMaxZoom() === map.getZoom()) {
              if (this.options.spiderfyOnMaxZoom) {
                e.layer.spiderfy();
              }
            } else if (this.options.zoomToBoundsOnClick) {
              e.layer.zoomToBounds();
            }

            // Focus the map again for keyboard users.
            if (e.originalEvent && e.originalEvent.keyCode === 13) {
              map._container.focus();
            }
          },

          _showCoverage: function (e) {
            var map = this._map;
            if (this._inZoomAnimation) {
              return;
            }
            if (this._shownPolygon) {
              map.removeLayer(this._shownPolygon);
            }
            if (e.layer.getChildCount() > 2 && e.layer !== this._spiderfied) {
              this._shownPolygon = new L.Polygon(e.layer.getConvexHull(), this.options.polygonOptions);
              map.addLayer(this._shownPolygon);
            }
          },

          _hideCoverage: function () {
            if (this._shownPolygon) {
              this._map.removeLayer(this._shownPolygon);
              this._shownPolygon = null;
            }
          },

          _unbindEvents: function () {
            var spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,
              showCoverageOnHover = this.options.showCoverageOnHover,
              zoomToBoundsOnClick = this.options.zoomToBoundsOnClick,
              map = this._map;

            if (spiderfyOnMaxZoom || zoomToBoundsOnClick) {
              this.off('clusterclick', this._zoomOrSpiderfy, this);
            }
            if (showCoverageOnHover) {
              this.off('clustermouseover', this._showCoverage, this);
              this.off('clustermouseout', this._hideCoverage, this);
              map.off('zoomend', this._hideCoverage, this);
            }
          },

          _zoomEnd: function () {
            if (!this._map) { //May have been removed from the map by a zoomEnd handler
              return;
            }
            this._mergeSplitClusters();

            this._zoom = this._map._zoom;
            this._currentShownBounds = this._getExpandedVisibleBounds();
          },

          _moveEnd: function () {
            if (this._inZoomAnimation) {
              return;
            }

            var newBounds = this._getExpandedVisibleBounds();

            this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, newBounds);
            this._topClusterLevel._recursivelyAddChildrenToMap(null, this._map._zoom, newBounds);

            this._currentShownBounds = newBounds;
            return;
          },

          _generateInitialClusters: function () {
            var maxZoom = this._map.getMaxZoom(),
              radius = this.options.maxClusterRadius,
              radiusFn = radius;

            //If we just set maxClusterRadius to a single number, we need to create
            //a simple function to return that number. Otherwise, we just have to
            //use the function we've passed in.
            if (typeof radius !== "function") {
              radiusFn = function () { return radius; };
            }

            if (this.options.disableClusteringAtZoom) {
              maxZoom = this.options.disableClusteringAtZoom - 1;
            }
            this._maxZoom = maxZoom;
            this._gridClusters = {};
            this._gridUnclustered = {};

            //Set up DistanceGrids for each zoom
            for (var zoom = maxZoom; zoom >= 0; zoom--) {
              this._gridClusters[zoom] = new L.DistanceGrid(radiusFn(zoom));
              this._gridUnclustered[zoom] = new L.DistanceGrid(radiusFn(zoom));
            }

            this._topClusterLevel = new L.MarkerCluster(this, -1);
          },

          //Zoom: Zoom to start adding at (Pass this._maxZoom to start at the bottom)
          _addLayer: function (layer, zoom) {
            var gridClusters = this._gridClusters,
              gridUnclustered = this._gridUnclustered,
              markerPoint, z;

            if (this.options.singleMarkerMode) {
              layer.options.icon = this.options.iconCreateFunction({
                getChildCount: function () {
                  return 1;
                },
                getAllChildMarkers: function () {
                  return [layer];
                }
              });
            }

            //Find the lowest zoom level to slot this one in
            for (; zoom >= 0; zoom--) {
              markerPoint = this._map.project(layer.getLatLng(), zoom); // calculate pixel position

              //Try find a cluster close by
              var closest = gridClusters[zoom].getNearObject(markerPoint);
              if (closest) {
                closest._addChild(layer);
                layer.__parent = closest;
                return;
              }

              //Try find a marker close by to form a new cluster with
              closest = gridUnclustered[zoom].getNearObject(markerPoint);
              if (closest) {
                var parent = closest.__parent;
                if (parent) {
                  this._removeLayer(closest, false);
                }

                //Create new cluster with these 2 in it

                var newCluster = new L.MarkerCluster(this, zoom, closest, layer);
                gridClusters[zoom].addObject(newCluster, this._map.project(newCluster._cLatLng, zoom));
                closest.__parent = newCluster;
                layer.__parent = newCluster;

                //First create any new intermediate parent clusters that don't exist
                var lastParent = newCluster;
                for (z = zoom - 1; z > parent._zoom; z--) {
                  lastParent = new L.MarkerCluster(this, z, lastParent);
                  gridClusters[z].addObject(lastParent, this._map.project(closest.getLatLng(), z));
                }
                parent._addChild(lastParent);

                //Remove closest from this zoom level and any above that it is in, replace with newCluster
                for (z = zoom; z >= 0; z--) {
                  if (!gridUnclustered[z].removeObject(closest, this._map.project(closest.getLatLng(), z))) {
                    break;
                  }
                }

                return;
              }

              //Didn't manage to cluster in at this zoom, record us as a marker here and continue upwards
              gridUnclustered[zoom].addObject(layer, markerPoint);
            }

            //Didn't get in anything, add us to the top
            this._topClusterLevel._addChild(layer);
            layer.__parent = this._topClusterLevel;
            return;
          },

          //Enqueue code to fire after the marker expand/contract has happened
          _enqueue: function (fn) {
            this._queue.push(fn);
            if (!this._queueTimeout) {
              this._queueTimeout = setTimeout(L.bind(this._processQueue, this), 300);
            }
          },
          _processQueue: function () {
            for (var i = 0; i < this._queue.length; i++) {
              this._queue[i].call(this);
            }
            this._queue.length = 0;
            clearTimeout(this._queueTimeout);
            this._queueTimeout = null;
          },

          //Merge and split any existing clusters that are too big or small
          _mergeSplitClusters: function () {

            //Incase we are starting to split before the animation finished
            this._processQueue();

            if (this._zoom < this._map._zoom && this._currentShownBounds.intersects(this._getExpandedVisibleBounds())) { //Zoom in, split
              this._animationStart();
              //Remove clusters now off screen
              this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, this._getExpandedVisibleBounds());

              this._animationZoomIn(this._zoom, this._map._zoom);

            } else if (this._zoom > this._map._zoom) { //Zoom out, merge
              this._animationStart();

              this._animationZoomOut(this._zoom, this._map._zoom);
            } else {
              this._moveEnd();
            }
          },

          //Gets the maps visible bounds expanded in each direction by the size of the screen (so the user cannot see an area we do not cover in one pan)
          _getExpandedVisibleBounds: function () {
            if (!this.options.removeOutsideVisibleBounds) {
              return this.getBounds();
            }

            var map = this._map,
              bounds = map.getBounds(),
              sw = bounds._southWest,
              ne = bounds._northEast,
              latDiff = L.Browser.mobile ? 0 : Math.abs(sw.lat - ne.lat),
              lngDiff = L.Browser.mobile ? 0 : Math.abs(sw.lng - ne.lng);

            return new L.LatLngBounds(
              new L.LatLng(sw.lat - latDiff, sw.lng - lngDiff, true),
              new L.LatLng(ne.lat + latDiff, ne.lng + lngDiff, true));
          },

          //Shared animation code
          _animationAddLayerNonAnimated: function (layer, newCluster) {
            if (newCluster === layer) {
              this._featureGroup.addLayer(layer);
            } else if (newCluster._childCount === 2) {
              newCluster._addToMap();

              var markers = newCluster.getAllChildMarkers();
              this._featureGroup.removeLayer(markers[0]);
              this._featureGroup.removeLayer(markers[1]);
            } else {
              newCluster._updateIcon();
            }
          }
        });

        L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION ? {

          //Non Animated versions of everything
          _animationStart: function () {
            //Do nothing...
          },
          _animationZoomIn: function (previousZoomLevel, newZoomLevel) {
            this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);
            this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());

            //We didn't actually animate, but we use this event to mean "clustering animations have finished"
            this.fire('animationend');
          },
          _animationZoomOut: function (previousZoomLevel, newZoomLevel) {
            this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);
            this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());

            //We didn't actually animate, but we use this event to mean "clustering animations have finished"
            this.fire('animationend');
          },
          _animationAddLayer: function (layer, newCluster) {
            this._animationAddLayerNonAnimated(layer, newCluster);
          }
        } : {

          //Animated versions here
          _animationStart: function () {
            this._map._mapPane.className += ' leaflet-cluster-anim';
            this._inZoomAnimation++;
          },
          _animationEnd: function () {
            if (this._map) {
              this._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');
            }
            this._inZoomAnimation--;
            this.fire('animationend');
          },
          _animationZoomIn: function (previousZoomLevel, newZoomLevel) {
            var bounds = this._getExpandedVisibleBounds(),
              fg = this._featureGroup,
              i;

            //Add all children of current clusters to map and remove those clusters from map
            this._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {
              var startPos = c._latlng,
                markers = c._markers,
                m;

              if (!bounds.contains(startPos)) {
                startPos = null;
              }

              if (c._isSingleParent() && previousZoomLevel + 1 === newZoomLevel) { //Immediately add the new child and remove us
                fg.removeLayer(c);
                c._recursivelyAddChildrenToMap(null, newZoomLevel, bounds);
              } else {
                //Fade out old cluster
                c.setOpacity(0);
                c._recursivelyAddChildrenToMap(startPos, newZoomLevel, bounds);
              }

              //Remove all markers that aren't visible any more
              //TODO: Do we actually need to do this on the higher levels too?
              for (i = markers.length - 1; i >= 0; i--) {
                m = markers[i];
                if (!bounds.contains(m._latlng)) {
                  fg.removeLayer(m);
                }
              }

            });

            this._forceLayout();

            //Update opacities
            this._topClusterLevel._recursivelyBecomeVisible(bounds, newZoomLevel);
            //TODO Maybe? Update markers in _recursivelyBecomeVisible
            fg.eachLayer(function (n) {
              if (!(n instanceof L.MarkerCluster) && n._icon) {
                n.setOpacity(1);
              }
            });

            //update the positions of the just added clusters/markers
            this._topClusterLevel._recursively(bounds, previousZoomLevel, newZoomLevel, function (c) {
              c._recursivelyRestoreChildPositions(newZoomLevel);
            });

            //Remove the old clusters and close the zoom animation
            this._enqueue(function () {
              //update the positions of the just added clusters/markers
              this._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {
                fg.removeLayer(c);
                c.setOpacity(1);
              });

              this._animationEnd();
            });
          },

          _animationZoomOut: function (previousZoomLevel, newZoomLevel) {
            this._animationZoomOutSingle(this._topClusterLevel, previousZoomLevel - 1, newZoomLevel);

            //Need to add markers for those that weren't on the map before but are now
            this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());
            //Remove markers that were on the map before but won't be now
            this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel, this._getExpandedVisibleBounds());
          },
          _animationZoomOutSingle: function (cluster, previousZoomLevel, newZoomLevel) {
            var bounds = this._getExpandedVisibleBounds();

            //Animate all of the markers in the clusters to move to their cluster center point
            cluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds, previousZoomLevel + 1, newZoomLevel);

            var me = this;

            //Update the opacity (If we immediately set it they won't animate)
            this._forceLayout();
            cluster._recursivelyBecomeVisible(bounds, newZoomLevel);

            //TODO: Maybe use the transition timing stuff to make this more reliable
            //When the animations are done, tidy up
            this._enqueue(function () {

              //This cluster stopped being a cluster before the timeout fired
              if (cluster._childCount === 1) {
                var m = cluster._markers[0];
                //If we were in a cluster animation at the time then the opacity and position of our child could be wrong now, so fix it
                m.setLatLng(m.getLatLng());
                if (m.setOpacity) {
                  m.setOpacity(1);
                }
              } else {
                cluster._recursively(bounds, newZoomLevel, 0, function (c) {
                  c._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel + 1);
                });
              }
              me._animationEnd();
            });
          },
          _animationAddLayer: function (layer, newCluster) {
            var me = this,
              fg = this._featureGroup;

            fg.addLayer(layer);
            if (newCluster !== layer) {
              if (newCluster._childCount > 2) { //Was already a cluster

                newCluster._updateIcon();
                this._forceLayout();
                this._animationStart();

                layer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng()));
                layer.setOpacity(0);

                this._enqueue(function () {
                  fg.removeLayer(layer);
                  layer.setOpacity(1);

                  me._animationEnd();
                });

              } else { //Just became a cluster
                this._forceLayout();

                me._animationStart();
                me._animationZoomOutSingle(newCluster, this._map.getMaxZoom(), this._map.getZoom());
              }
            }
          },

          //Force a browser layout of stuff in the map
          // Should apply the current opacity and location to all elements so we can update them again for an animation
          _forceLayout: function () {
            //In my testing this works, infact offsetWidth of any element seems to work.
            //Could loop all this._layers and do this for each _icon if it stops working

            L.Util.falseFn(document.body.offsetWidth);
          }
        });

        L.markerClusterGroup = function (options) {
          return new L.MarkerClusterGroup(options);
        };


        L.MarkerCluster = L.Marker.extend({
          initialize: function (group, zoom, a, b) {

            L.Marker.prototype.initialize.call(this, a ? (a._cLatLng || a.getLatLng()) : new L.LatLng(0, 0), { icon: this });


            this._group = group;
            this._zoom = zoom;

            this._markers = [];
            this._childClusters = [];
            this._childCount = 0;
            this._iconNeedsUpdate = true;

            this._bounds = new L.LatLngBounds();

            if (a) {
              this._addChild(a);
            }
            if (b) {
              this._addChild(b);
            }
          },

          //Recursively retrieve all child markers of this cluster
          getAllChildMarkers: function (storageArray) {
            storageArray = storageArray || [];

            for (var i = this._childClusters.length - 1; i >= 0; i--) {
              this._childClusters[i].getAllChildMarkers(storageArray);
            }

            for (var j = this._markers.length - 1; j >= 0; j--) {
              storageArray.push(this._markers[j]);
            }

            return storageArray;
          },

          //Returns the count of how many child markers we have
          getChildCount: function () {
            return this._childCount;
          },

          //Zoom to the minimum of showing all of the child markers, or the extents of this cluster
          zoomToBounds: function () {
            var childClusters = this._childClusters.slice(),
              map = this._group._map,
              boundsZoom = map.getBoundsZoom(this._bounds),
              zoom = this._zoom + 1,
              mapZoom = map.getZoom(),
              i;

            //calculate how far we need to zoom down to see all of the markers
            while (childClusters.length > 0 && boundsZoom > zoom) {
              zoom++;
              var newClusters = [];
              for (i = 0; i < childClusters.length; i++) {
                newClusters = newClusters.concat(childClusters[i]._childClusters);
              }
              childClusters = newClusters;
            }

            if (boundsZoom > zoom) {
              this._group._map.setView(this._latlng, zoom);
            } else if (boundsZoom <= mapZoom) { //If fitBounds wouldn't zoom us down, zoom us down instead
              this._group._map.setView(this._latlng, mapZoom + 1);
            } else {
              this._group._map.fitBounds(this._bounds);
            }
          },

          getBounds: function () {
            var bounds = new L.LatLngBounds();
            bounds.extend(this._bounds);
            return bounds;
          },

          _updateIcon: function () {
            this._iconNeedsUpdate = true;
            if (this._icon) {
              this.setIcon(this);
            }
          },

          //Cludge for Icon, we pretend to be an icon for performance
          createIcon: function () {
            if (this._iconNeedsUpdate) {
              this._iconObj = this._group.options.iconCreateFunction(this);
              this._iconNeedsUpdate = false;
            }
            return this._iconObj.createIcon();
          },
          createShadow: function () {
            return this._iconObj.createShadow();
          },


          _addChild: function (new1, isNotificationFromChild) {

            this._iconNeedsUpdate = true;
            this._expandBounds(new1);

            if (new1 instanceof L.MarkerCluster) {
              if (!isNotificationFromChild) {
                this._childClusters.push(new1);
                new1.__parent = this;
              }
              this._childCount += new1._childCount;
            } else {
              if (!isNotificationFromChild) {
                this._markers.push(new1);
              }
              this._childCount++;
            }

            if (this.__parent) {
              this.__parent._addChild(new1, true);
            }
          },

          //Expand our bounds and tell our parent to
          _expandBounds: function (marker) {
            var addedCount,
              addedLatLng = marker._wLatLng || marker._latlng;

            if (marker instanceof L.MarkerCluster) {
              this._bounds.extend(marker._bounds);
              addedCount = marker._childCount;
            } else {
              this._bounds.extend(addedLatLng);
              addedCount = 1;
            }

            if (!this._cLatLng) {
              // when clustering, take position of the first point as the cluster center
              this._cLatLng = marker._cLatLng || addedLatLng;
            }

            // when showing clusters, take weighted average of all points as cluster center
            var totalCount = this._childCount + addedCount;

            //Calculate weighted latlng for display
            if (!this._wLatLng) {
              this._latlng = this._wLatLng = new L.LatLng(addedLatLng.lat, addedLatLng.lng);
            } else {
              this._wLatLng.lat = (addedLatLng.lat * addedCount + this._wLatLng.lat * this._childCount) / totalCount;
              this._wLatLng.lng = (addedLatLng.lng * addedCount + this._wLatLng.lng * this._childCount) / totalCount;
            }
          },

          //Set our markers position as given and add it to the map
          _addToMap: function (startPos) {
            if (startPos) {
              this._backupLatlng = this._latlng;
              this.setLatLng(startPos);
            }
            this._group._featureGroup.addLayer(this);
          },

          _recursivelyAnimateChildrenIn: function (bounds, center, maxZoom) {
            this._recursively(bounds, 0, maxZoom - 1,
              function (c) {
                var markers = c._markers,
                  i, m;
                for (i = markers.length - 1; i >= 0; i--) {
                  m = markers[i];

                  //Only do it if the icon is still on the map
                  if (m._icon) {
                    m._setPos(center);
                    m.setOpacity(0);
                  }
                }
              },
              function (c) {
                var childClusters = c._childClusters,
                  j, cm;
                for (j = childClusters.length - 1; j >= 0; j--) {
                  cm = childClusters[j];
                  if (cm._icon) {
                    cm._setPos(center);
                    cm.setOpacity(0);
                  }
                }
              }
            );
          },

          _recursivelyAnimateChildrenInAndAddSelfToMap: function (bounds, previousZoomLevel, newZoomLevel) {
            this._recursively(bounds, newZoomLevel, 0,
              function (c) {
                c._recursivelyAnimateChildrenIn(bounds, c._group._map.latLngToLayerPoint(c.getLatLng()).round(), previousZoomLevel);

                //TODO: depthToAnimateIn affects _isSingleParent, if there is a multizoom we may/may not be.
                //As a hack we only do a animation free zoom on a single level zoom, if someone does multiple levels then we always animate
                if (c._isSingleParent() && previousZoomLevel - 1 === newZoomLevel) {
                  c.setOpacity(1);
                  c._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel); //Immediately remove our children as we are replacing them. TODO previousBounds not bounds
                } else {
                  c.setOpacity(0);
                }

                c._addToMap();
              }
            );
          },

          _recursivelyBecomeVisible: function (bounds, zoomLevel) {
            this._recursively(bounds, 0, zoomLevel, null, function (c) {
              c.setOpacity(1);
            });
          },

          _recursivelyAddChildrenToMap: function (startPos, zoomLevel, bounds) {
            this._recursively(bounds, -1, zoomLevel,
              function (c) {
                if (zoomLevel === c._zoom) {
                  return;
                }

                //Add our child markers at startPos (so they can be animated out)
                for (var i = c._markers.length - 1; i >= 0; i--) {
                  var nm = c._markers[i];

                  if (!bounds.contains(nm._latlng)) {
                    continue;
                  }

                  if (startPos) {
                    nm._backupLatlng = nm.getLatLng();

                    nm.setLatLng(startPos);
                    if (nm.setOpacity) {
                      nm.setOpacity(0);
                    }
                  }

                  c._group._featureGroup.addLayer(nm);
                }
              },
              function (c) {
                c._addToMap(startPos);
              }
            );
          },

          _recursivelyRestoreChildPositions: function (zoomLevel) {
            //Fix positions of child markers
            for (var i = this._markers.length - 1; i >= 0; i--) {
              var nm = this._markers[i];
              if (nm._backupLatlng) {
                nm.setLatLng(nm._backupLatlng);
                delete nm._backupLatlng;
              }
            }

            if (zoomLevel - 1 === this._zoom) {
              //Reposition child clusters
              for (var j = this._childClusters.length - 1; j >= 0; j--) {
                this._childClusters[j]._restorePosition();
              }
            } else {
              for (var k = this._childClusters.length - 1; k >= 0; k--) {
                this._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel);
              }
            }
          },

          _restorePosition: function () {
            if (this._backupLatlng) {
              this.setLatLng(this._backupLatlng);
              delete this._backupLatlng;
            }
          },

          //exceptBounds: If set, don't remove any markers/clusters in it
          _recursivelyRemoveChildrenFromMap: function (previousBounds, zoomLevel, exceptBounds) {
            var m, i;
            this._recursively(previousBounds, -1, zoomLevel - 1,
              function (c) {
                //Remove markers at every level
                for (i = c._markers.length - 1; i >= 0; i--) {
                  m = c._markers[i];
                  if (!exceptBounds || !exceptBounds.contains(m._latlng)) {
                    c._group._featureGroup.removeLayer(m);
                    if (m.setOpacity) {
                      m.setOpacity(1);
                    }
                  }
                }
              },
              function (c) {
                //Remove child clusters at just the bottom level
                for (i = c._childClusters.length - 1; i >= 0; i--) {
                  m = c._childClusters[i];
                  if (!exceptBounds || !exceptBounds.contains(m._latlng)) {
                    c._group._featureGroup.removeLayer(m);
                    if (m.setOpacity) {
                      m.setOpacity(1);
                    }
                  }
                }
              }
            );
          },

          //Run the given functions recursively to this and child clusters
          // boundsToApplyTo: a L.LatLngBounds representing the bounds of what clusters to recurse in to
          // zoomLevelToStart: zoom level to start running functions (inclusive)
          // zoomLevelToStop: zoom level to stop running functions (inclusive)
          // runAtEveryLevel: function that takes an L.MarkerCluster as an argument that should be applied on every level
          // runAtBottomLevel: function that takes an L.MarkerCluster as an argument that should be applied at only the bottom level
          _recursively: function (boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel) {
            var childClusters = this._childClusters,
              zoom = this._zoom,
              i, c;

            if (zoomLevelToStart > zoom) { //Still going down to required depth, just recurse to child clusters
              for (i = childClusters.length - 1; i >= 0; i--) {
                c = childClusters[i];
                if (boundsToApplyTo.intersects(c._bounds)) {
                  c._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);
                }
              }
            } else { //In required depth

              if (runAtEveryLevel) {
                runAtEveryLevel(this);
              }
              if (runAtBottomLevel && this._zoom === zoomLevelToStop) {
                runAtBottomLevel(this);
              }

              //TODO: This loop is almost the same as above
              if (zoomLevelToStop > zoom) {
                for (i = childClusters.length - 1; i >= 0; i--) {
                  c = childClusters[i];
                  if (boundsToApplyTo.intersects(c._bounds)) {
                    c._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);
                  }
                }
              }
            }
          },

          _recalculateBounds: function () {
            var markers = this._markers,
              childClusters = this._childClusters,
              i;

            this._bounds = new L.LatLngBounds();
            delete this._wLatLng;

            for (i = markers.length - 1; i >= 0; i--) {
              this._expandBounds(markers[i]);
            }
            for (i = childClusters.length - 1; i >= 0; i--) {
              this._expandBounds(childClusters[i]);
            }
          },


          //Returns true if we are the parent of only one cluster and that cluster is the same as us
          _isSingleParent: function () {
            //Don't need to check this._markers as the rest won't work if there are any
            return this._childClusters.length > 0 && this._childClusters[0]._childCount === this._childCount;
          }
        });



        L.DistanceGrid = function (cellSize) {
          this._cellSize = cellSize;
          this._sqCellSize = cellSize * cellSize;
          this._grid = {};
          this._objectPoint = {};
        };

        L.DistanceGrid.prototype = {

          addObject: function (obj, point) {
            var x = this._getCoord(point.x),
              y = this._getCoord(point.y),
              grid = this._grid,
              row = grid[y] = grid[y] || {},
              cell = row[x] = row[x] || [],
              stamp = L.Util.stamp(obj);

            this._objectPoint[stamp] = point;

            cell.push(obj);
          },

          updateObject: function (obj, point) {
            this.removeObject(obj);
            this.addObject(obj, point);
          },

          //Returns true if the object was found
          removeObject: function (obj, point) {
            var x = this._getCoord(point.x),
              y = this._getCoord(point.y),
              grid = this._grid,
              row = grid[y] = grid[y] || {},
              cell = row[x] = row[x] || [],
              i, len;

            delete this._objectPoint[L.Util.stamp(obj)];

            for (i = 0, len = cell.length; i < len; i++) {
              if (cell[i] === obj) {

                cell.splice(i, 1);

                if (len === 1) {
                  delete row[x];
                }

                return true;
              }
            }

          },

          eachObject: function (fn, context) {
            var i, j, k, len, row, cell, removed,
              grid = this._grid;

            for (i in grid) {
              row = grid[i];

              for (j in row) {
                cell = row[j];

                for (k = 0, len = cell.length; k < len; k++) {
                  removed = fn.call(context, cell[k]);
                  if (removed) {
                    k--;
                    len--;
                  }
                }
              }
            }
          },

          getNearObject: function (point) {
            var x = this._getCoord(point.x),
              y = this._getCoord(point.y),
              i, j, k, row, cell, len, obj, dist,
              objectPoint = this._objectPoint,
              closestDistSq = this._sqCellSize,
              closest = null;

            for (i = y - 1; i <= y + 1; i++) {
              row = this._grid[i];
              if (row) {

                for (j = x - 1; j <= x + 1; j++) {
                  cell = row[j];
                  if (cell) {

                    for (k = 0, len = cell.length; k < len; k++) {
                      obj = cell[k];
                      dist = this._sqDist(objectPoint[L.Util.stamp(obj)], point);
                      if (dist < closestDistSq) {
                        closestDistSq = dist;
                        closest = obj;
                      }
                    }
                  }
                }
              }
            }
            return closest;
          },

          _getCoord: function (x) {
            return Math.floor(x / this._cellSize);
          },

          _sqDist: function (p, p2) {
            var dx = p2.x - p.x,
              dy = p2.y - p.y;
            return dx * dx + dy * dy;
          }
        };


        /* Copyright (c) 2012 the authors listed at the following URL, and/or
         the authors of referenced articles or incorporated external code:
         http://en.literateprograms.org/Quickhull_(Javascript)?action=history&offset=20120410175256

         Permission is hereby granted, free of charge, to any person obtaining
         a copy of this software and associated documentation files (the
         "Software"), to deal in the Software without restriction, including
         without limitation the rights to use, copy, modify, merge, publish,
         distribute, sublicense, and/or sell copies of the Software, and to
         permit persons to whom the Software is furnished to do so, subject to
         the following conditions:

         The above copyright notice and this permission notice shall be
         included in all copies or substantial portions of the Software.

         THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
         EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
         MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
         IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
         CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
         TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
         SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

         Retrieved from: http://en.literateprograms.org/Quickhull_(Javascript)?oldid=18434
         */

        (function () {
          L.QuickHull = {

            /*
             * @param {Object} cpt a point to be measured from the baseline
             * @param {Array} bl the baseline, as represented by a two-element
             *   array of latlng objects.
             * @returns {Number} an approximate distance measure
             */
            getDistant: function (cpt, bl) {
              var vY = bl[1].lat - bl[0].lat,
                vX = bl[0].lng - bl[1].lng;
              return (vX * (cpt.lat - bl[0].lat) + vY * (cpt.lng - bl[0].lng));
            },

            /*
             * @param {Array} baseLine a two-element array of latlng objects
             *   representing the baseline to project from
             * @param {Array} latLngs an array of latlng objects
             * @returns {Object} the maximum point and all new points to stay
             *   in consideration for the hull.
             */
            findMostDistantPointFromBaseLine: function (baseLine, latLngs) {
              var maxD = 0,
                maxPt = null,
                newPoints = [],
                i, pt, d;

              for (i = latLngs.length - 1; i >= 0; i--) {
                pt = latLngs[i];
                d = this.getDistant(pt, baseLine);

                if (d > 0) {
                  newPoints.push(pt);
                } else {
                  continue;
                }

                if (d > maxD) {
                  maxD = d;
                  maxPt = pt;
                }
              }

              return { maxPoint: maxPt, newPoints: newPoints };
            },


            /*
             * Given a baseline, compute the convex hull of latLngs as an array
             * of latLngs.
             *
             * @param {Array} latLngs
             * @returns {Array}
             */
            buildConvexHull: function (baseLine, latLngs) {
              var convexHullBaseLines = [],
                t = this.findMostDistantPointFromBaseLine(baseLine, latLngs);

              if (t.maxPoint) { // if there is still a point "outside" the base line
                convexHullBaseLines =
                  convexHullBaseLines.concat(
                    this.buildConvexHull([baseLine[0], t.maxPoint], t.newPoints)
                  );
                convexHullBaseLines =
                  convexHullBaseLines.concat(
                    this.buildConvexHull([t.maxPoint, baseLine[1]], t.newPoints)
                  );
                return convexHullBaseLines;
              } else {  // if there is no more point "outside" the base line, the current base line is part of the convex hull
                return [baseLine[0]];
              }
            },

            /*
             * Given an array of latlngs, compute a convex hull as an array
             * of latlngs
             *
             * @param {Array} latLngs
             * @returns {Array}
             */
            getConvexHull: function (latLngs) {
              // find first baseline
              var maxLat = false, minLat = false,
                maxPt = null, minPt = null,
                i;

              for (i = latLngs.length - 1; i >= 0; i--) {
                var pt = latLngs[i];
                if (maxLat === false || pt.lat > maxLat) {
                  maxPt = pt;
                  maxLat = pt.lat;
                }
                if (minLat === false || pt.lat < minLat) {
                  minPt = pt;
                  minLat = pt.lat;
                }
              }
              var ch = [].concat(this.buildConvexHull([minPt, maxPt], latLngs),
                this.buildConvexHull([maxPt, minPt], latLngs));
              return ch;
            }
          };
        }());

        L.MarkerCluster.include({
          getConvexHull: function () {
            var childMarkers = this.getAllChildMarkers(),
              points = [],
              p, i;

            for (i = childMarkers.length - 1; i >= 0; i--) {
              p = childMarkers[i].getLatLng();
              points.push(p);
            }

            return L.QuickHull.getConvexHull(points);
          }
        });


        //This code is 100% based on https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
        //Huge thanks to jawj for implementing it first to make my job easy :-)

        L.MarkerCluster.include({

          _2PI: Math.PI * 2,
          _circleFootSeparation: 25, //related to circumference of circle
          _circleStartAngle: Math.PI / 6,

          _spiralFootSeparation: 28, //related to size of spiral (experiment!)
          _spiralLengthStart: 11,
          _spiralLengthFactor: 5,

          _circleSpiralSwitchover: 9, //show spiral instead of circle from this marker count upwards.
          // 0 -> always spiral; Infinity -> always circle

          spiderfy: function () {
            if (this._group._spiderfied === this || this._group._inZoomAnimation) {
              return;
            }

            var childMarkers = this.getAllChildMarkers(),
              group = this._group,
              map = group._map,
              center = map.latLngToLayerPoint(this._latlng),
              positions;

            this._group._unspiderfy();
            this._group._spiderfied = this;

            //TODO Maybe: childMarkers order by distance to center

            if (childMarkers.length >= this._circleSpiralSwitchover) {
              positions = this._generatePointsSpiral(childMarkers.length, center);
            } else {
              center.y += 10; //Otherwise circles look wrong
              positions = this._generatePointsCircle(childMarkers.length, center);
            }

            this._animationSpiderfy(childMarkers, positions);
          },

          unspiderfy: function (zoomDetails) {
            /// <param Name="zoomDetails">Argument from zoomanim if being called in a zoom animation or null otherwise</param>
            if (this._group._inZoomAnimation) {
              return;
            }
            this._animationUnspiderfy(zoomDetails);

            this._group._spiderfied = null;
          },

          _generatePointsCircle: function (count, centerPt) {
            var circumference = this._group.options.spiderfyDistanceMultiplier * this._circleFootSeparation * (2 + count),
              legLength = circumference / this._2PI,  //radius from circumference
              angleStep = this._2PI / count,
              res = [],
              i, angle;

            res.length = count;

            for (i = count - 1; i >= 0; i--) {
              angle = this._circleStartAngle + i * angleStep;
              res[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();
            }

            return res;
          },

          _generatePointsSpiral: function (count, centerPt) {
            var legLength = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthStart,
              separation = this._group.options.spiderfyDistanceMultiplier * this._spiralFootSeparation,
              lengthFactor = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthFactor,
              angle = 0,
              res = [],
              i;

            res.length = count;

            for (i = count - 1; i >= 0; i--) {
              angle += separation / legLength + i * 0.0005;
              res[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();
              legLength += this._2PI * lengthFactor / angle;
            }
            return res;
          },

          _noanimationUnspiderfy: function () {
            var group = this._group,
              map = group._map,
              fg = group._featureGroup,
              childMarkers = this.getAllChildMarkers(),
              m, i;

            this.setOpacity(1);
            for (i = childMarkers.length - 1; i >= 0; i--) {
              m = childMarkers[i];

              fg.removeLayer(m);

              if (m._preSpiderfyLatlng) {
                m.setLatLng(m._preSpiderfyLatlng);
                delete m._preSpiderfyLatlng;
              }
              if (m.setZIndexOffset) {
                m.setZIndexOffset(0);
              }

              if (m._spiderLeg) {
                map.removeLayer(m._spiderLeg);
                delete m._spiderLeg;
              }
            }

            group._spiderfied = null;
          }
        });

        L.MarkerCluster.include(!L.DomUtil.TRANSITION ? {
          //Non Animated versions of everything
          _animationSpiderfy: function (childMarkers, positions) {
            var group = this._group,
              map = group._map,
              fg = group._featureGroup,
              i, m, leg, newPos;

            for (i = childMarkers.length - 1; i >= 0; i--) {
              newPos = map.layerPointToLatLng(positions[i]);
              m = childMarkers[i];

              m._preSpiderfyLatlng = m._latlng;
              m.setLatLng(newPos);
              if (m.setZIndexOffset) {
                m.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING
              }

              fg.addLayer(m);


              leg = new L.Polyline([this._latlng, newPos], { weight: 1.5, color: '#222' });
              map.addLayer(leg);
              m._spiderLeg = leg;
            }
            this.setOpacity(0.3);
            group.fire('spiderfied');
          },

          _animationUnspiderfy: function () {
            this._noanimationUnspiderfy();
          }
        } : {
          //Animated versions here
          SVG_ANIMATION: (function () {
            return document.createElementNS('http://www.w3.org/2000/svg', 'animate').toString().indexOf('SVGAnimate') > -1;
          }()),

          _animationSpiderfy: function (childMarkers, positions) {
            var me = this,
              group = this._group,
              map = group._map,
              fg = group._featureGroup,
              thisLayerPos = map.latLngToLayerPoint(this._latlng),
              i, m, leg, newPos;

            //Add markers to map hidden at our center point
            for (i = childMarkers.length - 1; i >= 0; i--) {
              m = childMarkers[i];

              //If it is a marker, add it now and we'll animate it out
              if (m.setOpacity) {
                m.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING
                m.setOpacity(0);

                fg.addLayer(m);

                m._setPos(thisLayerPos);
              } else {
                //Vectors just get immediately added
                fg.addLayer(m);
              }
            }

            group._forceLayout();
            group._animationStart();

            var initialLegOpacity = L.Path.SVG ? 0 : 0.3,
              xmlns = L.Path.SVG_NS;


            for (i = childMarkers.length - 1; i >= 0; i--) {
              newPos = map.layerPointToLatLng(positions[i]);
              m = childMarkers[i];

              //Move marker to new position
              m._preSpiderfyLatlng = m._latlng;
              m.setLatLng(newPos);

              if (m.setOpacity) {
                m.setOpacity(1);
              }


              //Add Legs.
              leg = new L.Polyline([me._latlng, newPos], { weight: 1.5, color: '#222', opacity: initialLegOpacity });
              map.addLayer(leg);
              m._spiderLeg = leg;

              //Following animations don't work for canvas
              if (!L.Path.SVG || !this.SVG_ANIMATION) {
                continue;
              }

              //How this works:
              //http://stackoverflow.com/questions/5924238/how-do-you-animate-an-svg-path-in-ios
              //http://dev.opera.com/articles/view/advanced-svg-animation-techniques/

              //Animate length
              var length = leg._path.getTotalLength();
              leg._path.setAttribute("stroke-dasharray", length + "," + length);

              var anim = document.createElementNS(xmlns, "animate");
              anim.setAttribute("attributeName", "stroke-dashoffset");
              anim.setAttribute("begin", "indefinite");
              anim.setAttribute("from", length);
              anim.setAttribute("to", 0);
              anim.setAttribute("dur", 0.25);
              leg._path.appendChild(anim);
              anim.beginElement();

              //Animate opacity
              anim = document.createElementNS(xmlns, "animate");
              anim.setAttribute("attributeName", "stroke-opacity");
              anim.setAttribute("attributeName", "stroke-opacity");
              anim.setAttribute("begin", "indefinite");
              anim.setAttribute("from", 0);
              anim.setAttribute("to", 0.5);
              anim.setAttribute("dur", 0.25);
              leg._path.appendChild(anim);
              anim.beginElement();
            }
            me.setOpacity(0.3);

            //Set the opacity of the spiderLegs back to their correct value
            // The animations above override this until they complete.
            // If the initial opacity of the spiderlegs isn't 0 then they appear before the animation starts.
            if (L.Path.SVG) {
              this._group._forceLayout();

              for (i = childMarkers.length - 1; i >= 0; i--) {
                m = childMarkers[i]._spiderLeg;

                m.options.opacity = 0.5;
                m._path.setAttribute('stroke-opacity', 0.5);
              }
            }

            setTimeout(function () {
              group._animationEnd();
              group.fire('spiderfied');
            }, 200);
          },

          _animationUnspiderfy: function (zoomDetails) {
            var group = this._group,
              map = group._map,
              fg = group._featureGroup,
              thisLayerPos = zoomDetails ? map._latLngToNewLayerPoint(this._latlng, zoomDetails.zoom, zoomDetails.center) : map.latLngToLayerPoint(this._latlng),
              childMarkers = this.getAllChildMarkers(),
              svg = L.Path.SVG && this.SVG_ANIMATION,
              m, i, a;

            group._animationStart();

            //Make us visible and bring the child markers back in
            this.setOpacity(1);
            for (i = childMarkers.length - 1; i >= 0; i--) {
              m = childMarkers[i];

              //Marker was added to us after we were spidified
              if (!m._preSpiderfyLatlng) {
                continue;
              }

              //Fix up the location to the real one
              m.setLatLng(m._preSpiderfyLatlng);
              delete m._preSpiderfyLatlng;
              //Hack override the location to be our center
              if (m.setOpacity) {
                m._setPos(thisLayerPos);
                m.setOpacity(0);
              } else {
                fg.removeLayer(m);
              }

              //Animate the spider legs back in
              if (svg) {
                a = m._spiderLeg._path.childNodes[0];
                a.setAttribute('to', a.getAttribute('from'));
                a.setAttribute('from', 0);
                a.beginElement();

                a = m._spiderLeg._path.childNodes[1];
                a.setAttribute('from', 0.5);
                a.setAttribute('to', 0);
                a.setAttribute('stroke-opacity', 0);
                a.beginElement();

                m._spiderLeg._path.setAttribute('stroke-opacity', 0);
              }
            }

            setTimeout(function () {
              //If we have only <= one child left then that marker will be shown on the map so don't remove it!
              var stillThereChildCount = 0;
              for (i = childMarkers.length - 1; i >= 0; i--) {
                m = childMarkers[i];
                if (m._spiderLeg) {
                  stillThereChildCount++;
                }
              }


              for (i = childMarkers.length - 1; i >= 0; i--) {
                m = childMarkers[i];

                if (!m._spiderLeg) { //Has already been unspiderfied
                  continue;
                }


                if (m.setOpacity) {
                  m.setOpacity(1);
                  m.setZIndexOffset(0);
                }

                if (stillThereChildCount > 1) {
                  fg.removeLayer(m);
                }

                map.removeLayer(m._spiderLeg);
                delete m._spiderLeg;
              }
              group._animationEnd();
            }, 200);
          }
        });


        L.MarkerClusterGroup.include({
          //The MarkerCluster currently spiderfied (if any)
          _spiderfied: null,

          _spiderfierOnAdd: function () {
            this._map.on('click', this._unspiderfyWrapper, this);

            if (this._map.options.zoomAnimation) {
              this._map.on('zoomstart', this._unspiderfyZoomStart, this);
            }
            //Browsers without zoomAnimation or a big zoom don't fire zoomstart
            this._map.on('zoomend', this._noanimationUnspiderfy, this);

            if (L.Path.SVG && !L.Browser.touch) {
              this._map._initPathRoot();
              //Needs to happen in the pageload, not after, or animations don't work in webkit
              //  http://stackoverflow.com/questions/8455200/svg-animate-with-dynamically-added-elements
              //Disable on touch browsers as the animation messes up on a touch zoom and isn't very noticable
            }
          },

          _spiderfierOnRemove: function () {
            this._map.off('click', this._unspiderfyWrapper, this);
            this._map.off('zoomstart', this._unspiderfyZoomStart, this);
            this._map.off('zoomanim', this._unspiderfyZoomAnim, this);

            this._unspiderfy(); //Ensure that markers are back where they should be
          },


          //On zoom start we add a zoomanim handler so that we are guaranteed to be last (after markers are animated)
          //This means we can define the animation they do rather than Markers doing an animation to their actual location
          _unspiderfyZoomStart: function () {
            if (!this._map) { //May have been removed from the map by a zoomEnd handler
              return;
            }

            this._map.on('zoomanim', this._unspiderfyZoomAnim, this);
          },
          _unspiderfyZoomAnim: function (zoomDetails) {
            //Wait until the first zoomanim after the user has finished touch-zooming before running the animation
            if (L.DomUtil.hasClass(this._map._mapPane, 'leaflet-touching')) {
              return;
            }

            this._map.off('zoomanim', this._unspiderfyZoomAnim, this);
            this._unspiderfy(zoomDetails);
          },


          _unspiderfyWrapper: function () {
            /// <summary>_unspiderfy but passes no arguments</summary>
            this._unspiderfy();
          },

          _unspiderfy: function (zoomDetails) {
            if (this._spiderfied) {
              this._spiderfied.unspiderfy(zoomDetails);
            }
          },

          _noanimationUnspiderfy: function () {
            if (this._spiderfied) {
              this._spiderfied._noanimationUnspiderfy();
            }
          },

          //If the given layer is currently being spiderfied then we unspiderfy it so it isn't on the map anymore etc
          _unspiderfyLayer: function (layer) {
            if (layer._spiderLeg) {
              this._featureGroup.removeLayer(layer);

              layer.setOpacity(1);
              //Position will be fixed up immediately in _animationUnspiderfy
              layer.setZIndexOffset(0);

              this._map.removeLayer(layer._spiderLeg);
              delete layer._spiderLeg;
            }
          }
        });


      }(window, document));
      return {
        markerClusterGroup:function(options){
          return L.markerClusterGroup(options);
        }
      }
    })
})();

/**
 * Created by jiuyuong on 2016/5/5.
 */
(function () {
  'use strict';
  localPack.$inject = ["db", "$http", "$rootScope", "$cordovaFileTransfer", "sxt", "xhUtils", "$timeout", "$q", "api"];
  angular
    .module('app.xhsc')
    .factory('localPack', localPack);
  /** @ngInject */
  function localPack(db,$http,$rootScope,$cordovaFileTransfer,sxt,xhUtils,$timeout,$q,api) {

    function Pack(config) {
      var self = this,
        pack = db('pack'+config._id);
      self.pack = pack;
      if(!self.config) {
        pack.getOrAdd(config).then(function (config) {
          self.config = config;
          self.down();
        });
      }
    }
    Pack.prototype.down = function () {
      var self = this;
      if(!self.config || self.isDown)return;
      self.isDown = true;
      self.downTask();
    }
    Pack.prototype.reDown = function () {
      var self = this;
      if(self.config){
        self.config.tasks.forEach(function (item) {
          item.try=0;
          item.completed =false;
        });
        self.down();
      }
    }
    Pack.prototype.downTask = function () {
      var self = this;
      var task = self.config.tasks.find(function (t) {
        return !t.completed && (!t.try || t.try<4);
      });
      if(!task){
        self.isDown = false;
        self.completed = self.getProgress().progress==100;
        $rootScope.$emit('pack' + self.config._id, {
          name: 'allcomplete',
          config: self.config
        });
        return;
      }
      if(task){
        task.try = (task.try||0)+1;
/*        $rootScope.$emit('pack'+self.config._id,{
          name:'begin',
          task:task,
          config:this.config
        });*/
        if(task.type=='ExRegion'){
          task.callback = function (data,config,cb) {
            var gx=[],areas=[];//计算要需要的指标和图纸
            this.item.MeasureItems.forEach(function (m) {
              if(m.AssessmentAreas.length==0)return;

              //TODO: 当前是以项目下载整个测试包，其实可能许多实现项是不需要测试的，数据多余，可以进一步优化
/*              if(!gx.find(function (it) {
                  return it.MeasureItemID==m.MeasureItemID
                })){
                gx.push({
                  MeasureItemID:m.MeasureItemID,
                  MeasureItemName:m.MeasureItemName,
                  TemplateID:m.TemplateID,
                  TemplateName:m.TemplateName
                });
              };*/

              m.AssessmentAreas.forEach(function (a) {
                if(!areas.find(function (it) {
                    return it.RegionID==a.AreaID
                  })){
                  var am = xhUtils.findRegion([data],a.AreaID);
                  //临时测试要去掉
                  //am.DrawingImageUrl='/fs/UploadFiles/Framework/a744a033f5eeec56549c440de2ddfbae.jpg';
                  if(am && am.DrawingImageUrl && !areas.find(function (a) {
                      return a.DrawingImageUrl==am.DrawingImageUrl
                    })) {
                    areas.push({
                      RegionID: am.RegionID,
                      RegionName:am.RegionName,
                      DrawingID:am.DrawingID,
                      DrawingImageUrl:am.DrawingImageUrl,
                      RegionType:am.RegionType
                    });
                  };
                }
              });
            });


/*            gx.forEach(function (g) {
              config.task.push({
                _id:'gx_'+g.MeasureItemID,
                url:sxt.app.api+'/Api/MeasureInfo/GetMeasureItemInfoByAreaID?areaID='+
              })
            });*/
            if(typeof cordova != 'undefined') {
              areas.forEach(function (area) {
                var pics = xhUtils.getMapPic(area.RegionType == 8 ? 4 : 3);
                pics.forEach(function (u) {
                  config.tasks.push({
                    _id: area.RegionID + '_p_' + u,
                    type: 'file',
                    url:sxt.app.fs+'/Api/Picture/Tile/'+u+'?path='+area.DrawingImageUrl + '&name=/' + area.DrawingID +'_'+ u + '.png'
                    //测试数据
                    //url: 'http://ggem.sxtsoft.com:9191/Api/Picture/Tile/' + u + '?path=' + area.DrawingImageUrl + '&name=/' + area.DrawingID + u + '.png'
                  });
                })
              });
            }
            $rootScope.$emit('pack'+self.config._id,{
              name:'taskchanged',
              task:task,
              config:self.config
            });
            cb();
          }
        }
        if(task.type == 'file') {
          try {
            //TODO: 下载的文章与业务ID做为目录，不能共享，需要共享优化
            var rootPath = cordova.file.dataDirectory+ self.config._id+'/',
              names = task.url.split('/'),
              name = names[names.length - 1];
            task.local = rootPath + name;
            $cordovaFileTransfer.download(task.url, task.local)
              .then(function (result) {
                task.completed = true;
                $rootScope.$emit('pack' + self.config._id, {
                  name: 'complete',
                  task: task,
                  config: self.config
                });
                self.downTask();
              }, function (err) {
                task.err = err;
                self.downTask();
              }, function (progress) {

              });
          }catch (ex){
            $rootScope.$emit('pack'+self.config._id,{
              name:'error',
              task:task,
              config:self.config
            });
          }
        }
        else{
          (task.api?task.api():$http.get(sxt.app.api + task.url)).then(function (result) {
            if(task.db){
              var taskDb = db(task.db);
              var updates = [];
              if(task.type=='rows'){
                result.data.forEach(function(row){
                  row._id = row._id||row[task.idField];
                  updates.push(taskDb.addOrUpdate(row));
                });
              }
              else{
                updates.push(taskDb.addOrUpdate(result.data));
              }
              $q.all(updates).then(function (r) {
                $rootScope.$emit('pack'+self.config._id,{
                  name:'complete',
                  task:task,
                  config:self.config
                });
                task.completed = true;
                if(task.callback && task.callback(result.data,self.config,function () {
                    self.downTask();
                  }));
                else
                  self.downTask();

              }).catch(function () {
                self.downTask();
              })

            }
            else{

              self.pack.addOrUpdate({_id:task._id,data:result.data}).then(function () {
                task.completed = true;
                $rootScope.$emit('pack'+self.config._id,{
                  name:'complete',
                  task:task,
                  config:self.config
                });
                if(task.callback && task.callback(result.data,self.config,function () {
                    self.downTask();
                  }));
                else
                  self.downTask();
              }).catch(function () {
                self.downTask();
              })
            }
          })
        }
      }
    }
    Pack.prototype.getProgress = function () {
      var completed = 0, total = this.config.tasks.length;
      this.config.tasks.forEach(function (task) {
        if (task.completed)
          completed++;
      });
      return {
        completed: completed,
        total: total,
        progress: parseInt(completed / total *100)
      }
    }

    var o ={
      packages:{},
      pack:pack,
      unPack:function (id) {
        delete o.packages[id];
      }
    };
    return o;
    function pack(config) {
        this.packages[config._id] = new Pack(config);
      return  this.packages[config._id];
    }

  }
})();

/**
 * Created by jiuyuong on 2016/5/10.
 */
(function () {
  'use strict';

  delopy.$inject = ["$q", "$rootScope"];
  angular
    .module('app.xhsc')
    .factory('delopy', delopy);
  /** @ngInject */
  function delopy($q,$rootScope) {

    var result={};

    function _check(fn) {
      return $q(function (resolve,reject) {
        if(typeof IonicDeploy === 'undefined') {
          reject();
        }else {
          fn().then(function (r) {
            resolve(r);
          }).catch(function (err) {
            reject(err);
          })

        }
      })
    }

    return {
      init: function () {
        return _check(function () {
          return $q(function (resolve, reject) {
            IonicDeploy.init(sxt.identity,sxt.update,function () {
              resolve();
            },function () {
              reject();
            })
          })
        })
      },
      redirect:function(){
        return $q(function (resolve,reject) {
          IonicDeploy.redirect(sxt.identity,function () {
            resolve();
          },function () {
            reject();
          })
        })
      },
      check:function () {
        var self = this;
        result.checking = true;
        result.stateNumber = 0;
        result.state = '正在检查';
        result.progress = '0';
        result.complete = false;
        self.sendEvent();
        return _check(function () {
          return $q(function (resolve, reject) {
            IonicDeploy.check(sxt.identity,"dev",function (r) {
              resolve(r);
            },function () {
              reject();
            })
          })
        })
      },
      toVersion:function (version,p) {
        var vs = version.split('.'),vs1=[];
        var i = 0;
        vs1.push('1');
        while(i<p){
          var vt = '000'+(vs[i]||'');
          vs1.push(vt.substring(vt.length-3,vt.length));
          i++;
        }
        return parseInt(vs1.join(''));
      },
      install:function () {
        return _check(function () {
          return $q(function (resolve,reject) {
            IonicDeploy.install(sxt.identity,function (r) {
              resolve(r);
            },function (err) {
              reject(err)
          });
          })
        })
      },
      download:function () {
        var self = this;
        result.state = '正在下载';
        result.stateNumber = 1;
        result.progress = '0';
        self.sendEvent();

        return _check(function () {
          return $q(function (resolve,reject) {
            result.beigingg=true;
            //$rootScope.$broadcast('updateVison:begion');
            IonicDeploy.download(sxt.identity,function (s) {
              if(s!=='true' && s!=='false'){
                result.progress = s;
                self.sendEvent();
                //$rootScope.$broadcast('updateVison:progress', result);
                //$rootScope.$broadcast('updateVison:progress', s);
              }
              else {
                if (s==='true'){
                  resolve(s);
                }else {
                  result.beigingg=false;
                  reject(s);
                }
              }
            },function (err) {
              result.beigingg=false;
              reject(err)
            });
          })
        })
      },
      extract:function () {
        var self = this;
        result.state = '正在解压';
        result.stateNumber = 2;
        result.progress = '0';
        self.sendEvent();
        return $q(function (resolve,reject) {

          //$rootScope.$broadcast('extract:begion');
          IonicDeploy.extract(sxt.identity,
            function(s){
              if(s!=='done') {
                result.progress = s;
                if (result.progress ==100){


                }
                self.sendEvent();
                //$rootScope.$broadcast('updateVison:progress', result);
              }
              else {
                resolve();
              }
            },function () {
              result.state = '解压失败';
              result.complete = true;
              result.beigingg=false;
              self.sendEvent();
              //$rootScope.$broadcast('updateVison:progress', result);
              reject();
            })
        })

      },
      sendEvent:function(){
        $rootScope.$broadcast('updateVison:progress', result);
      },
      update:function (confirm) {
        var self=this;
        return $q(function (resolve,reject) {
          if (result.ready){
            resolve();
            return;
          }
          if (result.checking){
            var fn = $rootScope.$on('updateVison:progress', function (e,r) {
              if(!result.checking) {
                resolve();
                fn();
              }
            });
            return;
          }
          self.check().then(function (r0) {
            if(self.toVersion(r0,2)>self.toVersion(sxt.version,2)){
              result.checking =false;
              confirm && confirm(self,r0,sxt.version,true).then(function(){
                result.state = '等待安装';
                result.stateNumber = 3;
                result.complete = false;
                result.progress = '100';
                self.sendEvent();
                self.install().then(function () {
                  resolve(Object.assign({},result));
                }).catch(function () {

                });
              },function () {
              });
            }
            else if(self.toVersion(r0,4)>self.toVersion(sxt.version,4)){
              self.download().then(function () {
                self.extract().then(function () {
                  result.complete = true;
                  result.checking =false;
                  result.ready = true;
                  result.state = r0+'(重启后生效)';
                  self.sendEvent();
                  // confirm(self,r0,sxt.version).then(function () {
                  //   self.redirect();
                  // });
                }).catch(function () {
                  result.beigingg=false;
                  result.checking =false;
                  self.sendEvent();
                })
              })
            }
            else {
              result.checking=false;
              result.state=sxt.version;
              result.complete=true;
              self.sendEvent();
            }
          }).catch(function () {
            result.state = '检查失败';
            result.complete = true;
            result.checking =false;
            self.sendEvent();
            reject(result)
          })
        })
      }
    }
  }

})();
/**
 * Created by shaoshunliu on 2017/3/25.
 */

/**
 * Created by jiuyuong on 2016/11/8.
 */
(function(angular){
  'use strict';

  angular
    .module('app.xhsc')
    .filter('cnFilter',cnFilter);

  function cnFilter(){
    return function(items,o) {
      var r = [],b,v;
      if (!items||!items.length){
        return;
      }
      items.forEach(function (item) {
        b = false;
        for(var k in o){
          if(b || !item[k]) break;
          item['_p_'+k] = item['_p_'+k]||Pinyin.getPinyinArrayFirst(item[k]).join('');
          v = item['_p_'+k]+item[k];
          if(v.toLowerCase().indexOf((o[k]||'').toLowerCase())!=-1){
            r.push(item);
          }
        }
      });
      return r;
    }
  }


})(angular);


(function(){
  'use strict';
  offlineTileLayer.$inject = ["$cordovaFile"];
  angular
    .module('app.xhsc')
    .factory('offlineTileLayer',offlineTileLayer);
  /** @ngInject */
  function offlineTileLayer($cordovaFile){
    L.Offline = L.TileLayer.extend({
      _loadTile: function (tile, tilePoint) {
        tile._layer  = this;
        tile.onload  = this._tileOnLoad;
        tile.onerror = this._tileOnError;

        this._adjustTilePoint(tilePoint);
        if(typeof cordova !== 'undefined') {
          $cordovaFile.readAsDataURL(cordova.file.dataDirectory, this._url +'_' + tilePoint.z + '_' + tilePoint.x + '_' + tilePoint.y + '.png').then(function (success) {
            tile.src = success;
          }, function (error) {
            tile.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
            //console.log(error);
          });
        }
        else{
        }
      }
    });

    return {
      offlineTile:function (url) {
        return new L.Offline(url,{attribution: false,noWrap: true});
      }
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  sfWeekRectifyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('sfWeekRectifyController', sfWeekRectifyController);

  /** @ngInject */
  function sfWeekRectifyController($state, $rootScope, $scope, $mdDialog, remote, $timeout, $q, utils, xhUtils, api) {
    var vm = this;
    $rootScope.title = $state.params.Role == 'zb' ? '整改' : '复查';
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;



    api.setNetwork(1).then(function () {
      vm.info = {}

      remote.safe.getRectificationsWrap.cfgSet({
        offline:true,
        filter:function (item) {
          return item.InspectionExtendID==vm.InspectionID;
        }
      })("WeekInspects").then(function (r) {
        var bacth=angular.isArray(r.data)?r.data[0]:null;
        vm.pareaList=[];
        if (bacth){
          bacth.Rectifications.forEach(function (k) {
            if (k.Children){
              k.Children.forEach(function (m) {
                if (!vm.pareaList.some(function (z) {
                    return z.AreaID==m.AreaID;
                  }))
                  vm.pareaList.push(m);
              })
            }
          });
          if (vm.pareaList.length>0){
            vm.regionSelect = vm.pareaList[0];
            vm.regionSelect.hasCheck = true;
            vm.AcceptanceItemName=vm.regionSelect.AcceptanceItemName;
            vm.warter = vm.regionSelect.RegionName + bacth.Describe;;
          }
        }
      });
      vm.selectQy = function (item,noValid) {
        if (vm.regionSelect==item){
          vm.qyslideShow = false;
          return;
        }
        if (noValid){
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.qyslideShow = false;
          return;
        }
        $q(function (resolve,reject) {
          if (vm.points.length){
            switch ($state.params.Role){
              case "zb":
                if (vm.points.find(function (k) {
                    return k.Status!=16;
                  })){
                  utils.confirm("点位尚未全部整改,是否继续下一个区域",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve();
                }
                break;
              default:
                if (vm.points.find(function (k) {
                    return k.Status!=2;
                  })){
                  utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve();
                }
                break;
            }
          }else {
           resolve();
          }
        }).then(function () {
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.qyslideShow = false;
        })
      }
      vm.qyslide = function () {
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult', function () {
        function valid() {
          function next() {
            return  $q(function (resolve,reject) {
              var msg = [],noChecked=[];
              vm.pareaList.forEach(function (r) {
                if (!r.hasCheck) {
                  msg.push(r.RegionName);
                  noChecked.push(r);
                }
              });
              if (msg.length) {
                utils.confirm(msg.join(",") + '尚未查看,去看看?',null,"确定","取消").then(function () {
                  vm.selectQy(noChecked[0],true);
                }).catch(function () {
                });
              }else {
                resolve();
              }
            })
          }
         return  $q(function (resolve,reject) {
           if (vm.points.length){
             switch ($state.params.Role){
               case "zb":
                 if (vm.points.find(function (k) {
                     return k.Status!=16;
                   })){
                   utils.confirm("点位尚未全部整改,是否继续提交",null,"继续","取消").then(function () {
                     return next();
                   }).then(function () {
                     resolve();
                   })
                 }else {
                   return next().then(function () {
                     resolve();
                   });
                 }
                 break;
               default:
                 if (vm.points.find(function (k) {
                     return k.Status!=2;
                   })){
                   utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                     return next();
                   }).then(function () {
                     resolve();
                   })
                 }else {
                   return next().then(function () {
                     resolve();
                   });
                 }
                 break;
             }
           }else {
             return next().then(function () {
               resolve();
             });
           }
          }).then(function () {
           $timeout(function () {
             utils.alert('提交成功，请稍后离线上传数据',null,function () {
               $state.go("app.xhsc.week.sfWeekMain");
             });
           })
         })
        }
        valid();
      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })
    });
  }
})();

/**
 * Created by shaoshun on 2016/11/28.
 */
/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  sfWeekMainController.$inject = ["xhscService", "$mdDialog", "api", "$scope", "$q", "remote", "$state", "sxt", "utils", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('sfWeekMainController', sfWeekMainController);

  /** @ngInject */
  function sfWeekMainController(xhscService,$mdDialog,api,$scope,$q,remote,$state,sxt,utils,$mdBottomSheet) {
    var vm = this;
    vm.procedure = [];
    vm.create=function () {
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.ok=function () {
            remote.safe.insertBatchWrap({
              InspectionID: sxt.uuid(),
              AreaID: $scope.currentArea.RegionID,
              Title: $scope.subject,
            },"WeekInspects").then(function (r) {
              $mdDialog.hide(r);
            }).catch(function () {
              $mdDialog.hide();
            })
          }
          $scope.cancel=function () {
            $mdDialog.cancel();
          }
          function getYearWeek(date){
            var date=date.getDate();
            var week= Math.ceil(date/7);
            return week;
          }
          function initTheme() {
            var projectName=$scope.currentProject?$scope.currentProject.RegionName:"";
            var area=$scope.currentArea?$scope.currentArea.RegionName:"";
            var date=new Date();
            var year=date.getFullYear();
            var month=date.getMonth()+1;
            var week=getYearWeek(date);
            if (!area||!projectName){
              $scope.subject="";
            }else {
              $scope.subject= projectName+area+ year+"年"+month+"月第"+week+"周"+"安全检查";
            }
          }
          xhscService.getRegionTreeOffline("",3,1).then(function (r) {
            $scope.projects=r;
            if(angular.isArray($scope.projects)&&$scope.projects.length){
              $scope.currentProject=$scope.projects[0];
              if ($scope.currentProject.Children.length){
                $scope.currentArea=$scope.currentProject.Children[0];
              }
            }
          })

          $scope.$watch("currentProject",function () {
            initTheme();
          })
          $scope.$watch("currentArea",function () {
            initTheme();
          })
        }],
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_createTemplate.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        fullscreen: false
      }).then(function (r) {
        if (r&&r.status==200){
          loadInspection();
        }else{
          utils.alert("本周已经做过安全检查!");
        }
      });
    }
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
      load();
    });
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("WeekInspects").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7|| item.Type==13)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("WeekInspects",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"WeekInspects").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.weekPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.safe.weekproblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.weekProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaID,null,null))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'safeWeek' + item.InspectionID});
                })

              api.task(tasks, {
                event: 'downloadyf',
                target: item.InspectionID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadyf', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.safe.weekGetSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(getRectificationTask())
                .concat(function () {
                  return remote.offline.create({Id: 'weekZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.current=0;
        vm.uploadInfo.total=0;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;
            function buildTask() {
              function filterUpload(arr) {
                if (angular.isArray(arr)){
                  return arr.filter(function (t) {
                    return !t.isUpload;
                  })
                }
                return arr;
              }
              var tasks = [];
              return $q(function (resolve, reject) {
                api.getUploadData(function (cfg) {
                  return cfg.mark == "weekUp";
                }).then(function (val) {
                  if (val && val.length) {
                    var points = val.find(function (o) {
                      return o.key == "weekPointGeos";
                    });
                    var ckpoints = val.find(function (o) {
                      return o.key == "weekPoints";
                    });
                    var ckpointsVal=ckpoints && ckpoints.vals ? ckpoints.vals : [];

                    var problemRecords = val.find(function (o) {
                      return o.key == "weekProblemRecord";
                    });
                    var problemRecordsVal=problemRecords && problemRecords.vals ? filterUpload(problemRecords.vals) : [];

                    var InspectionProblemRecordFiles = val.find(function (o) {
                      return o.key == "weekInspectionProblemRecordFile";
                    });
                    //文件单独上传
                    var InspectionProblemRecordFilesVal=InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals ?
                      filterUpload(InspectionProblemRecordFiles.vals): [];
                    InspectionProblemRecordFilesVal.forEach(function (k) {
                      tasks.push(function () {
                        return remote.safe.inserFile({
                          FileName:k.FileID,
                          Base64:k.FileContent
                        }).then(function (res) {
                          if(res&&res.data&&res.data.ID){
                            k.FileID=res.data.ID;
                          }
                          delete k.FileContent
                        })
                      });
                    });
                    //几何位置单独上传
                    if (points && points.vals) {
                      points.vals.forEach(function (t) {
                        if (t.geometry) {
                          t.Geometry = t.geometry;
                        }
                        if (typeof t.Geometry === 'string') {
                          t.Geometry = JSON.parse(t.Geometry);
                        }
                        tasks.push(function () {
                          return remote.Procedure.InspectionPoint.create(t)
                        });
                      });
                    }

                    //业务单独上传
                    var post={
                      "CheckpointInput": ckpointsVal,
                      "ProblemRecordInput": problemRecordsVal,
                      "ProblemRecordFileInput": InspectionProblemRecordFilesVal
                    }

                    tasks.push(function () {
                      function clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points) {
                        if (ckpoints&&ckpoints.db){
                          tasks.push(function () {
                            return  ckpoints.db.destroy()
                          })
                        }

                        if (problemRecords&&problemRecords.db){
                          tasks.push(function () {
                            return  problemRecords.db.destroy()
                          })
                        }
                        if (InspectionProblemRecordFiles&&InspectionProblemRecordFiles.db){
                          tasks.push(function () {
                            return  InspectionProblemRecordFiles.db.destroy()
                          })
                        }
                        if (points&&points.db){
                          tasks.push(function () {
                            return  points.db.destroy()
                          })
                        }
                      }
                      return remote.safe.safeUp(post,"WeekInspects").then(function () {
                        clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points);
                      });
                    });
                  }
                  resolve(tasks);
                }).catch(function (err) {
                  reject(err)
                })
              })
            }
            buildTask().then(function (tasks) {
              api.task(tasks)(function (percent, current, total) {
                var percent=percent?parseInt(percent * 100):0;
                vm.uploadInfo.percent = percent + ' %';
                vm.uploadInfo.current = current;
                vm.uploadInfo.total = total;
              }, function () {
                utils.alert("上传成功!");
                $mdDialog.hide();
                load();
                 remote.offline.query().then(function(m){
                    if(angular.isArray(m.data)){
                      m.data.forEach(function(n){
                        if(n.Id&&(n.Id.indexOf("safeWeek")>-1||n.Id.indexOf("weekZg")>-1)){
                          remote.offline.delete({Id:n.Id});
                        }
                      });
                    }
                });
                vm.uploadInfo.uploading = false;
              }, function (timeout) {
                var msg = timeout ? '超时,任务上次失败!' : '上传失败,请检查网络';
                $mdDialog.cancel();
                utils.alert(msg);
                vm.uploadInfo.uploaded = 0;
                vm.uploadInfo.uploading = false;
              });
            })
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }

    function loadInspection() {
     return remote.safe.getBatchWrap.cfgSet({
       mode:2
     })("WeekInspects").then(function (r) {
        vm.Inspections = [];
        if (angular.isArray(r.data)) {
          var ys = [];
          r.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "safeWeek" + k.InspectionID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
          })
        }
      });
    }
    function loadZgLst() {
     return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
            return ret(vm.role);
          }).then(function (r) {
            resolve(r)
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
           params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("WeekInspects",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "weekZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }

    }
    function load() {
      $q.all([
        loadInspection(),
        loadZgLst()
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {

    })

    vm.setModule = function (val) {
      $state.go('app.xhsc.week.sfWeekBase', {yw: val})
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.week.sfWeekRectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.week.sfWeekRectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.week.sfWeekRectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.week.sfWeekRectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.week.sfWeekAccept', {
              projectId: item.ProjectID,
              areaId: item.AreaID,
              InspectionId: item.InspectionID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.week.sfWeekAccept', {
            projectId: item.ProjectID,
            areaId: item.AreaID,
            InspectionId: item.InspectionID
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  sfWeekBaseController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('sfWeekBaseController', sfWeekBaseController);

  function sfWeekBaseController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog,db, $mdBottomSheet, $stateParams, xhscService) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("WeekInspects").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7|| item.Type==13)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("WeekInspects",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"WeekInspects").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.weekPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.safe.weekproblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.weekProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(getRectificationTask())
                .concat(function () {
                  return remote.offline.create({Id: 'weekZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    function loadZgLst() {
      return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
            return ret(vm.role);
          }).then(function (r) {
            resolve(r)
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
          params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("WeekInspects",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "weekZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }

    }
    function load() {
      $q.all([
        loadZgLst()
      ]).then(function () {
        vm.f_isOver= true;
        if (!vm.zglist.length){
          vm.isShowbg=true;
        }
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.week.sfWeekRectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.week.sfWeekRectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.week.sfWeekRectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.week.sfWeekRectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  sfWeekAcceptController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('sfWeekAcceptController',sfWeekAcceptController);

  /**@ngInject*/
  function sfWeekAcceptController($scope,$stateParams,remote,xhUtils,$rootScope,$state,$q,utils,api,xhscService){
    var vm = this;
    var projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.areaId=areaId;
      vm.InspectionId=$stateParams.InspectionId;

      vm.info = {
        current:null,
        projectId:projectId,
        regionId:areaId,
        cancelMode:function () {
          vm.cancelCurrent(null);
        }
      };

    var sendResult = $rootScope.$on('sendGxResult',function(){
      utils.alert("提交成功，请稍后离线上传数据！",null,function () {
        $state.go('app.xhsc.week.sfWeekMain')
      });
    })
    $scope.$on("$destroy",function(){
      sendResult();
      sendResult = null;
    });
    api.setNetwork(1).then(function(){
        vm.cancelCurrent = function ($event) {
          vm.info.current = null;
        }
        $scope.areas= xhscService.getRegionTreeOffline("", 31, 1).then(function (r) {
            if (!angular.isArray(r)){
              return r;
            }
            var area=r.filter(function (k) {
              if (angular.isArray(k.Children)){
                k.Children=k.Children.filter(function (m) {
                  return m.RegionID==areaId;
                })
              }
              return k.RegionID==projectId;
            });
            return area;
        });
        $scope.procedure=remote.safe.getSecurityItem.cfgSet({
         offline: true
       })("WeekInspects");
        $scope.current={};


        $scope.$watch("current.region",function (v,o) {
          if (v&&$scope.current.procedure){
            vm.info.show=true;
          }else {
            vm.info.show=false;
          }
        })
        $scope.$watch("current.procedure",function (v,o) {
          if (v){
            if ($scope.current.region){
              vm.info.show=true;
            }else {
              vm.info.show=false;
            }
            vm.procedureData=[v];
            vm.procedureData.forEach(function(t){
              t.SpecialtyChildren = t.ProblemClassifyList;
              t.ProblemClassifyList.forEach(function(_t){
                _t.WPAcceptanceList = _t.ProblemLibraryList;
                _t.SpecialtyName = _t.ProblemClassifyName;
                _t.ProblemLibraryList.forEach(function(_tt){
                  _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
                })
              })
            })
          }
        })
    });
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  sfDynamicRectifyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('sfDynamicRectifyController', sfDynamicRectifyController);

  /** @ngInject */
  function sfDynamicRectifyController($state, $rootScope, $scope, $mdDialog, remote, $timeout, $q, utils, xhUtils, api) {
    var vm = this;
    $rootScope.title = $state.params.Role == 'zb' ? '整改' : '复查';
    vm.ProjectID = $state.params.ProjectID;
    vm.AcceptanceItemID = $state.params.AcceptanceItemID;
    vm.AcceptanceItemName = $state.params.AcceptanceItemName ? $state.params.AcceptanceItemName : "";
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;
    vm.RectificationID = $state.params.RectificationID;
    api.setNetwork(1).then(function () {
      remote.safe.getRectificationSingle(vm.RectificationID,"DayInspects").then(function (r) {
        vm.Rectification = r.data[0];
        vm.pareaList = vm.Rectification.Children;
        vm.regionSelect = vm.pareaList[0];
        vm.warter = vm.regionSelect.RegionName + (vm.AcceptanceItemName ? '(' + vm.AcceptanceItemName + ')' : "");
        vm.regionSelect.hasCheck = true;
      });

      vm.info = {}
      function load() {
        if (!vm.regionSelect) {
          return;
        }
      }
      vm.selectQy = function (item) {
        vm.regionSelect = item;
        vm.regionSelect.hasCheck = true;
        vm.warter = vm.regionSelect.RegionName + (vm.AcceptanceItemName ? '(' + vm.AcceptanceItemName + ')' : "");
        vm.qyslideShow = false;
      }
      vm.qyslide = function () {
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult', function () {
        var msg = [];
        vm.pareaList.forEach(function (r) {
          if (!r.hasCheck) {
            msg.push(r.RegionName);
          }
        });
        if (msg.length) {
          utils.alert(msg.join(",") + '尚未查看!');
          return;
        };

        utils.alert('提交成功，请稍后离线上传数据',null,function () {
          $state.go("app.xhsc.dyn.sfDynamicMain");
        });
      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })
    });
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */

(function () {
  'use strict';

  sfDynamicMainController.$inject = ["xhscService", "$mdDialog", "api", "$scope", "$q", "remote", "$state", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('sfDynamicMainController', sfDynamicMainController);

  /** @ngInject */
  function sfDynamicMainController(xhscService,$mdDialog,api,$scope,$q,remote,$state,$mdBottomSheet ) {
    var vm = this;
    vm.procedure = [];
    vm.create=function () {
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.ok=function () {
            remote.safe.insertBatchWrap({
              InspectionID: sxt.uuid(),
              AreaID: $scope.currentArea.RegionID,
              Title: $scope.subject,
            },"DayInspects").then(function (r) {
              $mdDialog.hide(r);
            }).catch(function () {
              $mdDialog.hide();
            })
          }
          $scope.cancel=function () {
            $mdDialog.cancel();
          }
          function getYearWeek(date){
            var date=date.getDate();
            var week= Math.ceil(date/7);
            return week;
          }
          function initTheme() {
            var projectName=$scope.currentProject?$scope.currentProject.RegionName:"";
            var area=$scope.currentArea?$scope.currentArea.RegionName:"";
            var date=new Date();
            var year=date.getFullYear();
            var month=date.getMonth()+1;
            var day=date.getDate();
            if (!area||!projectName){
              $scope.subject="";
            }else {
              $scope.subject= projectName+area+ year+"年"+month+"月"+day+"日动态安全检查";
            }
          }
          xhscService.getRegionTreeOffline("",3,1).then(function (r) {
            $scope.projects=r;
            if(angular.isArray($scope.projects)&&$scope.projects.length){
              $scope.currentProject=$scope.projects[0];
              if ($scope.currentProject.Children.length){
                $scope.currentArea=$scope.currentProject.Children[0];
              }
            }
          })

          $scope.$watch("currentProject",function () {
            initTheme();
          })
          $scope.$watch("currentArea",function () {
            initTheme();
          })
        }],
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_createTemplate.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        fullscreen: false
      }).then(function (r) {
        if (r&&r.status==200){
          loadInspection();
        }else{
          utils.alert("本日已经做过动态安全检查!");
        }
      });
    }
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });

    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("DayInspects").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
            (!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && vm.procedure.find(function (k) {
              return k.AcceptanceItemID == item.AcceptanceItemID;
            })
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("DayInspects",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"DayInspects").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.dynPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.safe.dynProblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.dynProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaID,null,null,function (item) {
                  return vm.procedure.find(function (k) {
                    return k.AcceptanceItemID == item.AcceptanceItemID;
                  })
                }))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'safedyn' + item.InspectionID});
                })

              api.task(tasks, {
                event: 'downloaddyn',
                target: item.InspectionID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloaddyn', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(rectificationTask(item))
                .concat(function (tasks) {
                  return $q(function (v, m) {
                    item.Children.forEach(function (area) {
                      tasks.push(
                        function () {
                          return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                        }
                      );
                    })
                    v();
                  })
                })
                .concat(function () {
                  return remote.offline.create({Id: 'zgdyn' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);
    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;
            function buildTask() {
              function filterUpload(arr) {
                if (angular.isArray(arr)){
                  return arr.filter(function (t) {
                    return !t.isUpload;
                  })
                }
                return arr;
              }

              var tasks = [];
              return $q(function (resolve, reject) {
                api.getUploadData(function (cfg) {
                  return cfg.mark == "dynUp"||cfg.mark =="allUp";
                }).then(function (val) {
                  if (val && val.length) {
                    var points = val.find(function (o) {
                      return o.key == "InspectionPoint";
                    });
                    var ckpoints = val.find(function (o) {
                      return o.key == "dynPoints";
                    });
                    var problemRecords = val.find(function (o) {
                      return o.key == "dynProblemRecord";
                    });
                    var InspectionProblemRecordFiles = val.find(function (o) {
                      return o.key == "dynInspectionProblemRecordFile";
                    });
                    if (points && points.vals) {
                      points.vals.forEach(function (t) {
                        if (t.geometry) {
                          t.Geometry = t.geometry;
                        }
                        if (typeof t.Geometry === 'string') {
                          t.Geometry = JSON.parse(t.Geometry);
                        }
                        tasks.push(function () {
                          return remote.Procedure.InspectionPoint.create(t)
                        });
                      });
                    }

                    tasks.push(function () {
                      function clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points) {
                        if (ckpoints && ckpoints.vals) {
                          ckpoints.vals.forEach(function (m) {
                            tasks.push(function () {
                              return  ckpoints.db.delete(m._id);
                            })
                          });
                        }
                        if (problemRecords && problemRecords.vals) {
                          problemRecords.vals.forEach(function (m) {
                            tasks.push(function () {
                              return  problemRecords.db.delete(m._id);
                            })
                          });
                        }
                        if (InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals) {
                          InspectionProblemRecordFiles.vals.forEach(function (m) {
                            tasks.push(function () {
                              return  InspectionProblemRecordFiles.db.delete(m._id);
                            })
                          });
                        }
                        if (points && points.vals){
                          points.vals.forEach(function (t) {
                            tasks.push(function () {
                              return  points.db.delete(t._id)
                            })
                          })
                        }
                      }
                      return remote.safe.safeUp({
                        "CheckpointInput": ckpoints && ckpoints.vals ? ckpoints.vals : [],
                        "ProblemRecordInput": problemRecords && problemRecords.vals ? filterUpload(problemRecords.vals) : [],
                        "ProblemRecordFileInput": InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals ?filterUpload(InspectionProblemRecordFiles.vals): []
                      },"DayInspects").then(function () {
                        clear(ckpoints,problemRecords,InspectionProblemRecordFiles);
                      });
                    });
                  }
                  resolve(tasks);
                })
              }).catch(function () {
                reject(tasks);
              })
            }
            buildTask().then(function (tasks) {
              api.task(tasks)(function (percent, current, total) {
                vm.uploadInfo.percent = parseInt(percent * 100) + ' %';
                vm.uploadInfo.current = current;
                vm.uploadInfo.total = total;
              }, function () {
                utils.alert("上传成功!");
                $mdDialog.hide();
                load();
                vm.uploadInfo.uploading = false;
              }, function (timeout) {
                var msg = timeout ? '超时,任务上次失败!' : '上传失败,请检查网络';
                $mdDialog.cancel();
                utils.alert(msg);
                vm.uploadInfo.uploaded = 0;
                vm.uploadInfo.uploading = false;
              });
            })
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }

    function loadInspection() {
      return remote.safe.getBatchWrap("DayInspects").then(function (r) {
        vm.Inspections = [];
        if (angular.isArray(r.data)) {
          var ys = [];
          r.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "safedyn" + k.InspectionID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
          })
        }
      });
    }
    function loadZgLst() {
      return remote.safe.getRectifications("DayInspects").then(function (r) {
        vm.zglist = [];
        if (angular.isArray(r.data)) {
          var zg = [];
          r.data.forEach(function (o) {
            zg.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              zg.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "zgdyn" + k.RectificationID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.zglist = zg;
          })
        }
      })
    }
    function load() {
      $q.all([
        loadInspection(),
        loadZgLst()
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })
    vm.setModule = function (val) {
      $state.go('app.xhsc.dyn.sfDynamicBase', {yw: val})
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.dyn.sfDynamicRectify', {
              Role: 'zb',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.dyn.sfDynamicRectify', {
            Role: 'zb',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.dyn.sfDynamicRectify', {
              Role: 'jl',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.dyn.sfDynamicRectify', {
            Role: 'jl',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.dyn.sfDynamicAccept', {
              projectId: item.ProjectID,
              areaId: item.AreaID,
              InspectionId: item.InspectionID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.dyn.sfDynamicAccept', {
            projectId: item.ProjectID,
            areaId: item.AreaID,
            InspectionId: item.InspectionID
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  sfDynamicBaseController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('sfDynamicBaseController', sfDynamicBaseController);

  function sfDynamicBaseController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog,
                                db, $mdBottomSheet, $stateParams, xhscService) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    //项目包
    function projectTask(regionID, areas, acceptanceItemID) {
      var projectId = regionID.substr(0, 5);

      function filter(item) {
        return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
          (!areas || areas.find(function (a) {
            return a.AreaID == item.RegionId;
          })) && vm.procedure.find(function (k) {
            return k.AcceptanceItemID == item.AcceptanceItemID;
          })
      }

      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID).then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ckPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload = true;
                  tasks.push(function () {
                    return remote.safe.problemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat([function () {
                  return remote.safe.getSafeInspectionSingle(item.InspectionId);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'safeYs' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }

    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionId == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(rectificationTask(item))
                .concat(function (tasks) {
                  return $q(function (v, m) {
                    item.Children.forEach(function (area) {
                      tasks.push(
                        function () {
                          return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                        }
                      );
                    })
                    v();
                  })
                })
                .concat(function () {
                  return remote.offline.create({Id: 'safeZg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }

    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);


    function load() {
      $q.all([
        remote.safe.getSafeInspections.cfgSet({
          mode:2
        })().then(function (r) {
          $q(function (resolve, reject) {
            vm.Inspections = [];
            if (angular.isArray(r.data)) {
              var ys = [];
              r.data.forEach(function (o) {
                ys.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  ys.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeYs" + k.InspectionId;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }

                vm.Inspections = ys;
                vm.y_isOver;
                if (vm.yw == 16 && !vm.Inspections.length) {
                  utils.alert("暂时没有找到数据");
                }
                resolve();
              }).catch(function () {
                resolve();
              });
            } else {
              resolve();
            }
          });
        }),
        remote.safe.getRectifications().then(function (r) {
          return $q(function (resolve, reject) {
            vm.zglist = [];
            if (angular.isArray(r.data)) {
              var zg = [];
              r.data.forEach(function (o) {
                zg.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  zg.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeZg" + k.RectificationID;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.zglist = zg;
                vm.f_isOver = true;
                resolve();
              }).catch(function () {
                resolve();
              });
            }
            else {
              resolve();
            }
          })

        }),
        remote.Project.getAllRegionWithRight_no_db("", 3).then(function (n) {
          if (vm.yw == 2 || vm.yw == 0) {
            vm.z_isOver = true;
            if (!n || n.data.length == 0) {
              vm.isShowbg = true;
              return;
            }
            remote.offline.query().then(function (r) {
              vm.by_project = xhscService.buildMutilRegionTree(n.data, 1);
              vm.zj_project = $.extend([], vm.by_project, true);
              vm.zj_project.forEach(function (k) {
                if (k.Children) {
                  k.Children.forEach(function (n) {
                    if (r.data.find(function (m) {
                        return m.Id == 'zj' + n.RegionID;
                      })) {
                      n.isComplete = true;
                    }
                  })
                }
              });

            })
          }
        })
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.sfDynamicRectify', {
              Role: 'zb',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.sfDynamicRectify', {
            Role: 'zb',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.sfDynamicRectify', {
              Role: 'jl',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.sfDynamicRectify', {
            Role: 'jl',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.sfDynamicAccept', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.Children[0].newName,
              projectId: item.ProjectID,
              areaId: item.Children[0].AreaID,
              InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.sfDynamicAccept', {
            acceptanceItemID: item.AcceptanceItemID,
            acceptanceItemName: item.AcceptanceItemName,
            name: item.Children[0].newName,
            projectId: item.ProjectID,
            areaId: item.Children[0].AreaID,
            InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  sfDynamicAcceptController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('sfDynamicAcceptController',sfDynamicAcceptController);

  /**@ngInject*/
  function sfDynamicAcceptController($scope,$stateParams,remote,xhUtils,$rootScope,$state,$q,utils,api,xhscService){
    var vm = this;
    var projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.InspectionId=$stateParams.InspectionId;

    vm.info = {
      current:null,
      projectId:projectId,
      regionId:areaId,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };

    api.setNetwork(1).then(function(){
      vm.cancelCurrent = function ($event) {
        vm.info.current = null;
      }
      $scope.areas= xhscService.getRegionTreeOffline("", 31, 1);
      $scope.procedure=remote.safe.getSecurityItem.cfgSet({
        offline: true
      })("DayInspects");
      $scope.current={};

      var sendResult = $rootScope.$on('sendGxResult',function(){
        utils.alert("提交成功，请稍后离线上传数据！",null,function () {
          $state.go('app.xhsc.dyn.sfDynamicMain')
        });
      })
      $scope.$on("$destroy",function(){
        sendResult();
        sendResult = null;
      });

      $scope.$watch("current.region",function (v,o) {
        if (v&&$scope.current.procedure){
          vm.info.show=true;
        }else {
          vm.info.show=false;
        }
      })
      $scope.$watch("current.procedure",function (v,o) {
        if (v){
          if ($scope.current.region){
            vm.info.show=true;
          }else {
            vm.info.show=false;
          }
          vm.procedureData=[v];
          vm.procedureData.forEach(function(t){
            t.SpecialtyChildren = t.ProblemClassifyList;
            t.ProblemClassifyList.forEach(function(_t){
              _t.WPAcceptanceList = _t.ProblemLibraryList;
              _t.SpecialtyName = _t.ProblemClassifyName;
              _t.ProblemLibraryList.forEach(function(_tt){
                _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
              })
            })
          })
        }
      })
    });

  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  safe_civiliz_rectifyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_rectifyController', safe_civiliz_rectifyController);

  /** @ngInject */
  function safe_civiliz_rectifyController($state, $rootScope, $scope, $mdDialog, remote, $timeout, $q, utils, xhUtils, api) {
    var vm = this;
    vm.points=[];
    $rootScope.title = $state.params.Role == 'zb' ? '整改' : '复验';
    vm.ProjectID = $state.params.ProjectID;
    vm.AcceptanceItemID = $state.params.AcceptanceItemID;
    vm.AcceptanceItemName = $state.params.AcceptanceItemName ? $state.params.AcceptanceItemName : "";
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;
    vm.RectificationID = $state.params.RectificationID;
    api.setNetwork(1).then(function () {
      remote.safe.getRectificationSingle(vm.RectificationID).then(function (r) {
        vm.Rectification = r.data[0];
        vm.pareaList = vm.Rectification.Children;
        vm.regionSelect = vm.pareaList[0];
        vm.warter = vm.regionSelect.RegionName + (vm.AcceptanceItemName ? '(' + vm.AcceptanceItemName + ')' : "");
        vm.regionSelect.hasCheck = true;
      });

      vm.info = {}

      function load() {
        if (!vm.regionSelect) {
          return;
        }
      }

      vm.selectQy = function (item,noValid) {
        if (vm.regionSelect==item){
          vm.qyslideShow = false;
          return;
        }
        if (noValid){
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.qyslideShow = false;
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.warter = vm.regionSelect.RegionName + (vm.AcceptanceItemName ? '(' + vm.AcceptanceItemName + ')' : "");
          return;
        }
        $q(function (resolve,reject) {
          if (vm.points.length){
            switch ($state.params.Role){
              case "zb":
                if (vm.points.find(function (k) {
                    return k.Status!=16;
                  })){
                  utils.confirm("点位尚未全部整改,是否继续下一个区域",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve();
                }
                break;
              default:
                if (vm.points.find(function (k) {
                    return k.Status!=2;
                  })){
                  utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve();
                }
                break;
            }
          }else {
            resolve();
          }
        }).then(function () {
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.warter = vm.regionSelect.RegionName + (vm.AcceptanceItemName ? '(' + vm.AcceptanceItemName + ')' : "");
          vm.qyslideShow = false;
        })
      }

      vm.qyslide = function () {
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult', function () {
        function valid() {
          function next() {
            return  $q(function (resolve,reject) {
              var msg = [],noChecked=[];
              vm.pareaList.forEach(function (r) {
                if (!r.hasCheck) {
                  msg.push(r.RegionName);
                  noChecked.push(r);
                }
              });
              if (msg.length) {
                utils.confirm(msg.join(",") + '尚未查看,去看看?',null,"确定","取消").then(function () {
                  vm.selectQy(noChecked[0],true);
                }).catch(function () {
                });
              }else {
                resolve();
              }
            })
          }
          return  $q(function (resolve,reject) {
            if (vm.points.length){
              switch ($state.params.Role){
                case "zb":
                  if (vm.points.find(function (k) {
                      return k.Status!=16;
                    })){
                    utils.confirm("点位尚未全部整改,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
                default:
                  if (vm.points.find(function (k) {
                      return k.Status!=2;
                    })){
                    utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
              }
            }else {
              return next().then(function () {
                resolve();
              });
            }
          }).then(function () {
            $timeout(function () {
              utils.alert('提交成功，请稍后离线上传数据',null,function () {
                $state.go("app.xhsc.sf.sfmain");
              });
            })
          })
        }
        valid();

      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })
    });
  }
})();

/**db
 * Created by lss on 2016/10/18.
 */
/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  safe_civiliz_mainController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_mainController', safe_civiliz_mainController);

  /**@ngInject*/
  function safe_civiliz_mainController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog, db, $mdBottomSheet, xhscService) {
    var vm = this;
    vm.procedure = [];
    //所有全局任务
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    //项目包
    function projectTask(regionID, areas, acceptanceItemID) {
      var projectId = regionID.substr(0, 5);

      function filter(item) {
        return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
          (!areas || areas.find(function (a) {
            return a.AreaID == item.RegionId;
          })) && vm.procedure.find(function (k) {
            return k.AcceptanceItemID == item.AcceptanceItemID;
          })
      }
      var  relates= remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("Acceptances",regionID)

      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null,filter ,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID).then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ckPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.safe.problemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }
    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat([function () {
                  return remote.safe.getSafeInspectionSingle(item.InspectionId);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'safeYs' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }

    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionId == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(rectificationTask(item))
                .concat(function (tasks) {
                  return $q(function (v, m) {
                    item.Children.forEach(function (area) {
                      tasks.push(
                        function () {
                          return remote.safe.safePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                        }
                      );
                    })
                    v();
                  })
                })
                .concat(function () {
                  return remote.offline.create({Id: 'safeZg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }

    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;
            $scope.uploadInfo.current=0;
            $scope.uploadInfo.total=0;
            function buildTask() {
              function filterUpload(arr) {
                if (angular.isArray(arr)){
                  return arr.filter(function (t) {
                      return !t.isUpload;
                  })
                }
                return arr;
              }

              var tasks = [];
              return $q(function (resolve, reject) {
                api.getUploadData(function (cfg) {
                  return cfg.mark == "up";
                }).then(function (val) {
                  if (val && val.length) {
                    var points = val.find(function (o) {
                      return o.key == "PointGeos";
                    });

                    var ckpoints = val.find(function (o) {
                      return o.key == "ckPoints";
                    });
                    var ckpointsVal=ckpoints && ckpoints.vals ? ckpoints.vals : [];

                    var problemRecords = val.find(function (o) {
                      return o.key == "problemRecord";
                    });

                    var problemRecordsVal=problemRecords && problemRecords.vals ? filterUpload(problemRecords.vals) : [];

                    var InspectionProblemRecordFiles = val.find(function (o) {
                      return o.key == "secInspectionProblemRecordFile";
                    });
                    var InspectionProblemRecordFilesVal=InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals ?
                      filterUpload(InspectionProblemRecordFiles.vals): [];
                    InspectionProblemRecordFilesVal.forEach(function (k) {
                      tasks.push(function () {
                        return remote.safe.inserFile({
                          FileName:k.FileID,
                          Base64:k.FileContent
                        }).then(function (res) {
                          if(res&&res.data&&res.data.ID){
                            k.FileID=res.data.ID;
                          }
                          delete k.FileContent
                        })
                      });
                    });
                    //几何位置单独上传
                    if (points && points.vals) {
                      points.vals.forEach(function (t) {
                        if (t.geometry) {
                          t.Geometry = t.geometry;
                        }
                        if (typeof t.Geometry === 'string') {
                          t.Geometry = JSON.parse(t.Geometry);
                        }
                        tasks.push(function () {
                          return remote.Procedure.InspectionPoint.create(t)
                        });
                      });
                    }


                    var post={
                      "CheckpointInput": ckpointsVal,
                      "ProblemRecordInput": problemRecordsVal,
                      "ProblemRecordFileInput": InspectionProblemRecordFilesVal
                    }

                    tasks.push(function () {
                      function clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points) {
                        if (ckpoints&&ckpoints.db){
                          tasks.push(function () {
                            return  ckpoints.db.destroy()
                          })
                        }

                        if (problemRecords&&problemRecords.db){
                          tasks.push(function () {
                            return  problemRecords.db.destroy()
                          })
                        }
                        if (InspectionProblemRecordFiles&&InspectionProblemRecordFiles.db){
                          tasks.push(function () {
                            return  InspectionProblemRecordFiles.db.destroy()
                          })
                        }
                        if (points&&points.db){
                          tasks.push(function () {
                            return  points.db.destroy()
                          })
                        }
                      }
                      return remote.safe.safeUp(post).then(function () {
                        clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points);
                      });
                    });
                  }
                  resolve(tasks);
                }).catch(function (err) {
                    reject(err)
                })
              })
            }
            buildTask().then(function (tasks) {
              api.task(tasks)(function (percent, current, total) {
                var percent=percent?parseInt(percent * 100):0;
                vm.uploadInfo.percent = percent + ' %';
                vm.uploadInfo.current = current;
                vm.uploadInfo.total = total;
              }, function () {
                utils.alert("上传成功!");
                $mdDialog.hide();
                load();
                vm.uploadInfo.uploading = false;
                remote.offline.query().then(function(m){
                    if(angular.isArray(m.data)){
                      m.data.forEach(function(n){
                        if(n.Id&&(n.Id.indexOf("safeYs")>-1||n.Id.indexOf("safeZg")>-1)){
                          remote.offline.delete({Id:n.Id});
                        }
                      });
                    }
                });
              }, function (timeout) {
                var msg = timeout ? '超时,任务上次失败!' : '上传失败,请检查网络';
                $mdDialog.cancel();
                utils.alert(msg);
                vm.uploadInfo.uploaded = 0;
                vm.uploadInfo.uploading = false;
              });
            })
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }

    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });

    function load() {
      $q.all([
        remote.safe.getSafeInspections.cfgSet({
          mode:2
        })().then(function (r) {
          $q(function (resolve, reject) {
            vm.Inspections = [];
            if (angular.isArray(r.data)) {
              var ys = [];
              r.data.forEach(function (o) {
                ys.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  ys.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeYs" + k.InspectionId;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.Inspections = ys;
                resolve();
              }).catch(function () {
                resolve();
              });
            } else {
              resolve();
            }
          });
        }),
        remote.safe.getAcceptancesRec.cfgSet({
          mode:2
        })().then(function (r) {
          return $q(function (resolve, reject) {
            vm.zglist = [];
            if (angular.isArray(r.data)) {
              var zg = [];
              r.data.forEach(function (o) {
                zg.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  zg.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeZg" + k.RectificationID;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.zglist = zg;
                resolve();
              }).catch(function () {
                resolve();
              });
            }
            else {
              resolve();
            }
          })

        })
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.setModule = function (val) {
      $state.go('app.xhsc.sf.sfbase', {yw: val})
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.rectify', {
              Role: 'zb',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.rectify', {
            Role: 'zb',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.rectify', {
              Role: 'jl',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.rectify', {
            Role: 'jl',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.sfaccept', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.Children[0].newName,
              projectId: item.ProjectID,
              areaId: item.Children[0].AreaID,
              InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.sfaccept', {
            acceptanceItemID: item.AcceptanceItemID,
            acceptanceItemName: item.AcceptanceItemName,
            name: item.Children[0].newName,
            projectId: item.ProjectID,
            areaId: item.Children[0].AreaID,
            InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  safe_civiliz_itemController.$inject = ["$scope", "remote", "$stateParams", "$state"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_itemController',safe_civiliz_itemController);

  /**@ngInject*/
  function safe_civiliz_itemController($scope,remote,$stateParams,$state){
    var vm=this;
    vm.projectId = $stateParams.projectId;
    vm.role=$stateParams.role;


    remote.safe.getSecurityItem().then(function(result){
      vm.data=result.data;
      vm.data.sort(function(a,b){
        return a.SpecialtyName.localeCompare(b.SpecialtyName);
      });
      vm.show=true;
    })
    vm.showTab=function(item){
      if (!item.SpecialtyChildren||!item.SpecialtyChildren.length){
        return false;
      }
      var gx= item.SpecialtyChildren;
      for (var  i=0;i<gx.length;i++){
        if (gx[i].WPAcceptanceList&&gx[i].WPAcceptanceList.length){
          return true;
        }
      }
      return false;
    }


    vm.choosego = function(i){
      var applicableArea= i.ApplicableArea;
      var area=-1;
      if (applicableArea){
        var arr=applicableArea.split(",");
        var t;
        arr.forEach(function(k){
          t=parseInt(k);
          if (area<t){
            area=t;
          }
        })
      }
      $state.go('app.xhsc.sf.sfhouse',{role:vm.role,acceptanceItemID:i.AcceptanceItemID,projectId:vm.projectId,acceptanceItemName:i.AcceptanceItemName,maxRegion:area})
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  safe_civiliz_houseController.$inject = ["$scope", "$stateParams", "db", "$rootScope", "xhUtils", "remote", "$timeout", "$q", "$state", "$mdDialog", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_houseController',safe_civiliz_houseController);

  /** @ngInject */
  function safe_civiliz_houseController($scope,$stateParams,db,$rootScope,xhUtils,remote,$timeout,$q,$state,$mdDialog,utils,api,xhscService){
    var vm=this,
      projectId = $stateParams.projectId.substr(0,5),
      acceptanceItemID=$stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName,
      role=$stateParams.role;
    vm.maxRegion = $stateParams.maxRegion;

    $rootScope.title = $stateParams.acceptanceItemName;
    if(role == "zb"){
      $rootScope.sendBt = true;
    }
    vm.building=[];
    function  load(){
      vm.nums={
        qb:0, //全部
        wtj:0,//未提交
        dy:0,//待验收
        hg:0, //合格
        bhg:0,//不合格
        yzg:0,//已整改
        wzg:0//未整改
      }
      function  setNum(status,region){
        function  addNum(status){
          vm.nums.qb++;
          switch (status){
            case  0:
              vm.nums.wtj++;
              break;
            case  1:
              vm.nums.dy++;
              break;
            case  2:
              vm.nums.hg++;
              break;
            case  4:
              vm.nums.bhg++;
              break;
            case  8:
              vm.nums.wzg++;
              break;
            case  16:
              vm.nums.yzg++;
              break;
          }
        }
        if (vm.maxRegion==8){
          if (region.RegionType==8){
            addNum(status);
          }
        }else {
          if (region.RegionType>=8){
            addNum(status);
          }
        }
      }
      //状态设置与用户区域权限
      function filterOrSetting(status,region){
        if (region.RegionType>4){
          statusSetting(status,region);
        }
      }
      var st2 =[];
      function setInspection(region){
        var percentage= 0,status=0;
        if(region.inspectionRows.length){
          region.inspectionRows && region.inspectionRows.forEach(function(t){
            percentage += t.Percentage;
            status = t.Status;
          })
        }else{
          percentage = region.percentage;
          status = 0;
        }
        if(percentage > 100){
          percentage = 100;
        }
        region.Percentage = percentage;
        region.status = status;
        region.style=ConvertClass(status);
        setNum(status,region);
      }
      //状态设置
      function statusSetting(status,region){
        if(!angular.isArray(status)){
          status=[status];
        }
        var st1 = [];
        region.inspectionRows=[];
        status.forEach(function(t){
          if(t.AcceptanceItemId==acceptanceItemID && t.AreaId == region.RegionID){
            region.inspectionRows.push(t);
          }else{
            region.status=0;
            region.Percentage=0;
          }
        })
        setInspection(region);
      }
      function ConvertClass(status){
        var style;
        switch (status){
          case 0:
            style="wait";
            break;
          case 1:
            style="dy";
            break;
          case 2:
            style="pass";
            break;
          case 4:
            style="ng";
            break;
          case 8:
            style="ng";
            break;
          case 16:
            style="yzg";
            break;
          default:
            break;
        }
        return style;
      }
      return $q.all([
        xhscService.getRegionTreesOnline(projectId,31,1),
        remote.safe.getSafeStatus(projectId)
        // remote.Procedure.getRegionStatus(projectId)
      ]).then(function(res){
        vm.loading = true;
        var result= res[0][0];
        var status=res[1]&&res[1].data?res[1].data:[];
        result.Children.forEach(function(d){
          filterOrSetting(status,d);
          d.projectTree =  result.RegionName;
          d.projectTitle = result.RegionName + d.RegionName;
          d.Children && d.Children.forEach(function(c){
            c.floors=[];
            filterOrSetting(status,c)
            c.projectTree = d.projectTree + c.RegionName;
            c.checked = false;
            vm.building.push(c);
            c.Children && c.Children.forEach(function(r){
              r.projectTree = c.projectTree + r.RegionName;
              r.checked = false;
              filterOrSetting(status,r);
              vm.floors=vm.floors?vm.floors:[];
              vm.floors.push(r);
              if (! r.Children||!r.Children.length){
                c.floors.push(r);
              }
              r.Children && r.Children.forEach(function(_r){
                _r.projectTree = r.projectTree + _r.RegionName;
                _r.checked = false;
                filterOrSetting(status,_r);
              })
            })
          })
        })
        vm.houses =  result.Children;
        function DynamicItems() {
          /**
           * @type {!Object<?Array>} Data pages, keyed by page number (0-index).
           */
          this.loadedPages = {};

          /** @type {number} Total number of items. */
          this.numItems = 0;

          /** @const {number} Number of items to fetch per request. */
          this.PAGE_SIZE = 1;

          this.fetchNumItems_();
        };
        // Required.
        DynamicItems.prototype.getItemAtIndex = function (index) {
          var pageNumber = Math.floor(index / this.PAGE_SIZE);
          var page = this.loadedPages[pageNumber];

          if (page) {
            return page[index % this.PAGE_SIZE];
          } else if (page !== null) {
            this.fetchPage_(pageNumber);
          }
        };
        // Required.
        DynamicItems.prototype.getLength = function () {
          return this.numItems;
        };

        DynamicItems.prototype.fetchPage_ = function (pageNumber) {
          // Set the page to null so we know it is already being fetched.
          this.loadedPages[pageNumber] = null;

          // For demo purposes, we simulate loading more items with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop, 0).then(angular.bind(this, function () {
            this.loadedPages[pageNumber] = [];
            var pageOffset = pageNumber * this.PAGE_SIZE;
            for (var i = pageOffset; i < pageOffset + this.PAGE_SIZE; i++) {
              if (vm.building[i]) {
                this.loadedPages[pageNumber].push(vm.building[i]);
              }
            }
          }));
        };

        DynamicItems.prototype.fetchNumItems_ = function () {
          $timeout(angular.noop, 0).then(angular.bind(this, function () {
            this.numItems = vm.building.length;
          }));
        };
        vm.dynamicItems = new DynamicItems();
        return vm.houses;
      });
    }

    load();

    vm.callBack=function(){
      utils.alert('报验成功',null,function(){
        $state.go("app.xhsc.sf.sfmain");
      })
    };
    vm.selected = function(r){
      switch (r.status){
        case 0:
          r.checked = !r.checked;
          break;
        case 1:
          r.checked = r.Percentage==100?false:(!r.checked);
          break;
      }
    }


    vm.zk = function(item){
      item.show = !item.show;
    }
    vm.filterNum = -1;
    vm.filter = function(num){
      vm.filterNum = num;
    }

    function compare(region,operator){
      if (region.Children){
        for (var  i=0;i<region.Children.length;i++){
          if (vm.regionfilterByStatus(region.Children[i])){
            return true;
          }
        }
        return  operator(region.status);
      }else {
        return  operator(region.status);
      }
    }

    vm.regionfilterByStatus=function(region){
      if (vm.filterNum==-1){
        return compare(region,function(status){
          return vm.statusRight(status);
        });
      }
      return compare(region,function(status){
        return status== vm.filterNum
      });
    }

    vm.statusRight=function(status){
      var show=[0,1,2,4,8,16];
      switch (role){
        case "zb":
          show=[0,1,2,8,16];
          break;
        case  "jl":
          show=[0,1,2,8,16];
          break;
        case  "jf":
          show=[0,1,2,4];
          break;
      }
      return show.indexOf(status)>-1;
    }

    var sendgxResult =$rootScope.$on('sendGxResult',function(){
      vm.data = {
        projectId:projectId,
        Rows:[],
        Sign:1,
        acceptanceItemName:acceptanceItemName,
        acceptanceItemID:acceptanceItemID
      }

      vm.houses.forEach(function(t){
        if (!t.Children){
          t.Children=[];
        }
        t.Children.forEach(function(_t){
          if(_t.checked){
            vm.data.Rows.push(_t);
          }
          _t.Children && _t.Children.forEach(function(_tt){
            if(_tt.checked){
              vm.data.Rows.push(_tt);
            }
            _tt.Children && _tt.Children.forEach(function(l){
              if(l.checked){
                vm.data.Rows.push(l)
              }
            })
          })
        })
      })
      if(vm.data.Rows.length){
        vm.showmyDialog = true;
      }else{
        utils.alert('请选择区域');
      }
    });
    $scope.$on("$destroy",function(){
      sendgxResult();
      sendgxResult=null;
    });
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  safe_civiliz_baseController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_baseController', safe_civiliz_baseController);

  function safe_civiliz_baseController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog,
    db, $mdBottomSheet, $stateParams, xhscService) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    //项目包
    function projectTask(regionID, areas, acceptanceItemID) {
      var projectId = regionID.substr(0, 5);

      function filter(item) {
        return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
          (!areas || areas.find(function (a) {
            return a.AreaID == item.RegionId;
          })) && vm.procedure.find(function (k) {
            return k.AcceptanceItemID == item.AcceptanceItemID;
          })
      }
      var  relates= remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("Acceptances",regionID)

      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null,filter ,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID).then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ckPointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.safe.problemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.safe.ProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }
    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat([function () {
                  return remote.safe.getSafeInspectionSingle(item.InspectionId);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'safeYs' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionId == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);
    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(rectificationTask(item))
                .concat(function (tasks) {
                  return $q(function (v, m) {
                    item.Children.forEach(function (area) {
                      tasks.push(
                        function () {
                          return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                        }
                      );
                    })
                    v();
                  })
                })
                .concat(function () {
                  return remote.offline.create({Id: 'safeZg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });


    vm.by = function (r) {
      api.setNetwork(0).then(function () {
        $state.go('app.xhsc.sf.sfitem', {role: 'zb', projectId: r.RegionID});
      });
    }

    function load() {
      $q.all([
        remote.safe.getSafeInspections.cfgSet({
          model:2
        })().then(function (r) {
          $q(function (resolve, reject) {
            vm.Inspections = [];
            if (angular.isArray(r.data)) {
              var ys = [];
              r.data.forEach(function (o) {
                ys.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  ys.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeYs" + k.InspectionId;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }

                vm.Inspections = ys;
                vm.y_isOver;
                if (vm.yw == 16 && !vm.Inspections.length) {
                  vm.isShowbg=true;
                }
                resolve();
              }).catch(function () {
                resolve();
              });
            } else {
              resolve();
            }
          });
        }),
        remote.safe.getRectifications().then(function (r) {
          return $q(function (resolve, reject) {
            vm.zglist = [];
            if (angular.isArray(r.data)) {
              var zg = [];
              r.data.forEach(function (o) {
                zg.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  zg.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "safeZg" + k.RectificationID;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.zglist = zg;
                if ((vm.yw==4||vm.yw==32)&&!vm.zglist.length){
                  vm.isShowbg=true;
                }
                vm.f_isOver = true;
                resolve();
              }).catch(function () {
                resolve();
              });
            }
            else {
              resolve();
            }
          })

        }),
        remote.Project.getAllRegionWithRight_no_db("", 3).then(function (n) {
          if (vm.yw == 2 || vm.yw == 0) {
            vm.z_isOver = true;
            if (!n || n.data.length == 0) {
              vm.isShowbg = true;
              return;
            }
            remote.offline.query().then(function (r) {
              vm.by_project = xhscService.buildMutilRegionTree(n.data, 1);
              vm.zj_project = $.extend([], vm.by_project, true);
              vm.zj_project.forEach(function (k) {
                k.stretch=true;
                if (k.Children) {
                  k.Children.forEach(function (n) {
                    if (r.data.find(function (m) {
                        return m.Id == 'zj' + n.RegionID;
                      })) {
                      n.isComplete = true;
                    }
                  })
                }
              });

            })
          }
        })
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.rectify', {
              Role: 'zb',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.rectify', {
            Role: 'zb',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.rectify', {
              Role: 'jl',
              InspectionID: item.InspectionID,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.rectify', {
            Role: 'jl',
            InspectionID: item.InspectionID,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.sf.sfaccept', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.Children[0].newName,
              projectId: item.ProjectID,
              areaId: item.Children[0].AreaID,
              InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.sf.sfaccept', {
            acceptanceItemID: item.AcceptanceItemID,
            acceptanceItemName: item.AcceptanceItemName,
            name: item.Children[0].newName,
            projectId: item.ProjectID,
            areaId: item.Children[0].AreaID,
            InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }


    vm.click = function (item, evt) {
      if (item.isComplete) {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxlist', {role: '', projectId: item.RegionID});
        });
      }
      evt.stopPropagation();
    }
    vm.stretch = function (item) {
      item.stretch = !item.stretch;
    }

  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  safe_civiliz_acceptController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api"];
  angular
    .module('app.xhsc')
    .controller('safe_civiliz_acceptController',safe_civiliz_acceptController);

  /**@ngInject*/
  function safe_civiliz_acceptController($scope,$stateParams,remote,xhUtils,$rootScope,$state,$q,utils,api){
    var vm = this;
    var acceptanceItemID = $stateParams.acceptanceItemID,
      acceptanceItemName =  $stateParams.acceptanceItemName,
      projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.InspectionId=$stateParams.InspectionId;

    vm.info = {
      current:null,
      projectId:projectId,
      acceptanceItemID:acceptanceItemID,
      regionId:areaId,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };
    vm.setRegion = function(region){
      region.hasCheck=true;
      vm.info.selected = region;
      vm.water=vm.info.selected.RegionName+'('+acceptanceItemName+')';
    }
    vm.selectQy = function(item){
      vm.info.selected = item;
      //vm.RegionName = item.RegionName;
      vm.qyslideShow = false;
      vm.setRegion(item);
    }
    var sendResult = $rootScope.$on('sendGxResult',function(){
      var  msg=[],noChecked=[];
      vm.btBatch.forEach(function(r){
        if (!r.hasCheck){
          msg.push(r.RegionName);
          noChecked.push(r);
        }
      });
      if (msg.length){
        utils.confirm(msg.join(",") + '尚未查看,去看看?',null,"确定","取消").then(function () {
          vm.selectQy(noChecked[0]);
        }).catch(function () {
        });
        return;
      }
      utils.alert("提交成功，请稍后离线上传数据！",null,function () {
        $state.go('app.xhsc.sf.sfmain')
      });
    })
    $scope.$on("$destroy",function(){
      sendResult();
      sendResult = null;
    });

    vm.btBatch;

    api.setNetwork(1).then(function(){
      function initBtBatch(){

        function getRegionType(regionID){
          var  regionType;
          switch (regionID.length){
            case 5:
              regionType=1;
              break;
            case 10:
              regionType=2;
              break;
            case 15:
              regionType=4;
              break;
            case 20:
              regionType=8
              break;
            default:
              regionType=16
              break;
          }
          return regionType;
        }
        var promises=[
          remote.safe.getSafeInspectionSingle(vm.InspectionId)
        ];
        vm.btBatch=[];
        return $q.all(promises).then(function(rtv){
          var  r=rtv[0].data.find(function(o){
            return o.InspectionId==vm.InspectionId;
          });
          if (angular.isArray(r.Children)){
            r.Children.forEach(function(tt){
              vm.btBatch.push(angular.extend({
                RegionID:tt.AreaID,
                RegionType:getRegionType( tt.AreaID)
              },tt));
            });
          }
          vm.selectQy(vm.btBatch[0]);
          return vm.btBatch;
        })
      }
      initBtBatch(); //获取一个批下面的所有区域
      vm.cancelCurrent = function ($event) {
        vm.info.current = null;
      }
      $rootScope.title = acceptanceItemName;


      vm.water="";
      vm.getWaterText=function(){
        if (vm.info.selected){
          return vm.info.selected.RegionName+'('+acceptanceItemName+')'
        }
        return "";
      }
      vm.qyslide = function(){
        vm.qyslideShow = !vm.qyslideShow;
      }
      return remote.safe.getSecurityItem.cfgSet({
        offline:true
      })().then(function(result){
        vm.procedureData = [];
        result.data.forEach(function(it){
          it.SpecialtyChildren.forEach(function(t){
            var p = t.WPAcceptanceList.find(function(a){
              return a.AcceptanceItemID === acceptanceItemID;
            })
            if(p){
              vm.procedureData.push(p);
            }
            vm.procedureData.forEach(function(t){
              t.SpecialtyChildren = t.ProblemClassifyList;
              t.ProblemClassifyList.forEach(function(_t){
                _t.WPAcceptanceList = _t.ProblemLibraryList;
                _t.SpecialtyName = _t.ProblemClassifyName;
                _t.ProblemLibraryList.forEach(function(_tt){
                  _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
                })
              })
            })
          })
        });
      })

    });
  }
})();

/**
 * Created by lss on 2016/9/2.
 */
/**
 * Created by lss on 2016/8/16.
 */
(function(){
  'use strict';

  ysReport.$inject = ["remote", "$state", "$q", "utils", "api", "$stateParams"];
  angular
    .module('app.xhsc')
    .controller('ysReportController',ysReport);

  /** @ngInject */
  function ysReport(remote,$state,$q,utils,api,$stateParams){
    var vm=this;
    var acceptanceItemID= $stateParams.acceptanceItemID;
    var pro=[
      remote.Procedure.authorityByUserId(),
      remote.Project.getMap()
    ]
    api.setNetwork(0).then(function(){
      $q.all(pro).then(function(r){
        var res=r[0];
        var result=r[1];
        if (res&&res.data&&res.data.length){
          vm.role=res.data[0].MemberType;
        }else {
          vm.role=0;
        }
        if(result&&result.data.length){
          result.data.forEach(function (m) {
            m.AssessmentID='scsl'+ m.ProjectID+'_'+vm.role;
            m.AssessmentSubject= m.ProjectName;
          });
          vm.projects=result.data;
        }
      }).catch(function(k){
        utils.alert("数据加载出错！");
      });
      //验收报告
      remote.Procedure.getInspections(31).then(function(r){
        vm.Inspections=[];
        r.data.forEach(function(o){
          if (o.Sign!=8&& o.AcceptanceItemID==acceptanceItemID){
            vm.Inspections.push(o);
          }
        });
        if (vm.Inspections.length==0){
          utils.alert('查无数据!');
        }
      });
      vm.Lookintoys = function(item){
        $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId, acceptanceItemID:item.AcceptanceItemID,acceptanceItemName:item.AcceptanceItemName,projectId:item.ProjectID});
      }
    });
  }
})();

/**
 * Created by lss on 2016/8/16.
 */
(function(){
  'use strict';

  reportDefault.$inject = ["remote", "$state", "$q", "utils", "api"];
  angular
    .module('app.xhsc')
    .controller('reportDefault',reportDefault);

  /** @ngInject */
  function reportDefault(remote,$state,$q,utils,api){
    var vm=this;
    var pro=[
      remote.Procedure.authorityByUserId(),
      remote.Project.getMap()
    ]
    api.setNetwork(0).then(function(){
      $q.all(pro).then(function(r){
        var res=r[0];
        var result=r[1];
        if (res&&res.data&&res.data.length){
          vm.role=res.data[0].MemberType;
        }else {
          vm.role=0;
        }
        if(result&&result.data.length){
          result.data.forEach(function (m) {
            m.AssessmentID='scsl'+ m.ProjectID+'_'+vm.role;
            m.AssessmentSubject= m.ProjectName;
          });
          vm.projects=result.data;
        }
      }).catch(function(k){
        utils.alert("数据加载出错！");
      });
      //查看整改报表
      vm.Lookintoys = function(item){
        $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId, acceptanceItemID:item.AcceptanceItemID,acceptanceItemName:item.AcceptanceItemName,projectId:item.ProjectID});
      }
      //查看验收报告
      vm.Lookintoys = function(item){
        $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId, acceptanceItemID:item.AcceptanceItemID,acceptanceItemName:item.AcceptanceItemName,projectId:item.ProjectID});
      }
      //验收报告
      remote.Procedure.getInspections(31).then(function(r){
        vm.Inspections=[];
        r.data.forEach(function(o){
          if (o.Sign!=8){
            vm.Inspections.push(o);
          }
        });
      });
      vm.go=function(item){
        function callBack(r){
          if (r&& r.data){
            var areas=r.data;
            var  routeData={
              projectId:item.ProjectID,
              assessmentID:item.AssessmentID,
              role:vm.role,
              isReport:1
            };
            if (angular.isArray(areas)&&areas.length>1){
              $state.go("app.xhsc.scsl.chooseArea",routeData)
            }else {
              $state.go("app.xhsc.scsl.sclist",angular.extend(routeData,{area:areas[0].RegionID}));
            }
          }
        }
        remote.Project.GetAreaChildenbyID(item.ProjectID).then(callBack);
      }

      remote.Report.Summary().then(function(r){
          vm.report= r.data? r.data:[];
      });


      vm.selectSpecialty=function(item){
        vm.gxClassType=item.SpecialtyChildren;
        vm.acceptanceItem=[];
      }
      vm.acceptanceItem=[];
      vm.selectSpecialtyLow=function(item){
        vm.acceptanceItem=item.WPAcceptanceList?item.WPAcceptanceList:[];
      }

      vm.comeBack=function(){
        vm.acceptanceItem=[];
      }
      remote.Procedure.queryProcedure().then(function(result){
        vm.data=result.data;
      })
      vm.choosego = function(i){
        $state.go('app.xhsc.report.ysReport',{acceptanceItemID: i.AcceptanceItemID})
      }
    });
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';
  scslmainController.$inject = ["$mdDialog", "db", "scRemote", "xhscService", "sxtlocaStorage", "$rootScope", "$scope", "scPack", "utils", "$q", "api", "$state", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('scslmainController', scslmainController);
  function scslmainController($mdDialog, db, scRemote, xhscService, sxtlocaStorage,$rootScope, $scope, scPack, utils, $q, api, $state, $mdBottomSheet) {
    var vm = this;
    var remote = scRemote;
    var pack = scPack;
    var xcpk = db('scxcpk');
    var itemDownLoad=sxtlocaStorage.getArr("itemDownLoad");
      xhscService.getProfile().then(function (profile) {
        vm.role=profile.role;
        queryOnline();
      });
    function queryOnline() {
      vm.offlines = [];
      xhscService.getRegionTreeOffline("", 3,1,"scRigthRegions").then(function (result) {
        if (!result){
          vm.isOver = true;
          return;
        }
        var arr=[];
        var  role=vm.role;
        if (role=="16"&&role=="8"){
          role="4";
        }
        result.forEach(function (m) {
          m.AssessmentID = 'scsl' + m.RegionID + '_' + role;
          m.Children.forEach(function (n) {
            var f;
            n.AssessmentID = m.AssessmentID;
            n.ProjectID = m.RegionID;
            f = itemDownLoad.find(function (e) {
              return e._id == n.RegionID;
            });
            if (f) {
              n.isComplete = true;
            }
          });
          arr.push(xcpk.addOrUpdate({
            _id: m.RegionID,
            data: m
          }).then(function () {
            vm.isOver = true;
            m.stretch=true;
            return m;
          }));
        });
        $q.all(arr).then(function (res) {
          res.forEach(function (m) {
            vm.offlines.push(m);
          })
          // xcpk.addOrUpdate({
          //   _id: m.RegionID,
          //   data: m
          // }).then(function () {
          //   vm.isOver = true;
          //   m.stretch=true;
          //
          // });
        });
      }).catch(function () { //在没有网络的时候
        xcpk.findAll().then(function (s) {
          vm.offlines.push(s.rows);
          vm.isOver = true;
        }).catch(function () {
          vm.isOver = true;
        })
      });
    }



    function projectTask(regionID) {
      var projectId = regionID.substr(0, 5);
      function  filter(item) {
         return vm.sc.find(function (k) {
           return k.AcceptanceItemID == item.AcceptanceItemID;
         })
      }
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID,"scDrawingRelation",filter).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }



    vm.download = function (item, isReflsh, evt) {
      api.setNetwork(0).then(function () {
        vm.current = item;
        //下载成功回掉
        function callBack() {
          var project = item.RegionID.substr(0, 5);
          item.isComplete = true;
          xcpk.get(project).then(function (k) {
            var data = k.data;
            var loaded=[];
            data.Children.forEach(function (m) {
              if (m.RegionID == item.RegionID) {
                m.isComplete = item.isComplete;
                loaded.push({
                  _id: m.RegionID,
                  data: m
                });
              }
            });
            sxtlocaStorage.setArr2("itemDownLoad",loaded,function (_old,_new) {
              return _new.filter(function (k) {
                return !_old.some(function (t) {
                  return t._id==k._id;
                })
              });
            });
          }).then(function () {
            utils.alert('下载完成');
          })
        }

        vm.sc = [];
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.item = item;
            var tasks = [];
            var projectId = item.RegionID.substr(0, 5);
            tasks.push(function () {
              return remote.PQMeasureStandard.GetListByExtend(projectId,"standard");
            });
            tasks.push(function () {
              return remote.Assessment.GetMeasureItemInfoByAreaID(projectId, "pack1" + item.AssessmentID);
            });
            tasks.push(function () {
              return remote.Assessment.GetRegionTreeInfo(projectId, "pack2" + item.AssessmentID);
            });
            tasks.push(function () {
              return remote.Assessment.GetBaseMeasure("pack3" + item.AssessmentID).then(function (r) {
                var d = r.data && r.data.data ? r.data.data : [];
                d.forEach(function (k) {
                  if (k.WPAcceptanceList.length) {
                    vm.sc = vm.sc.concat(k.WPAcceptanceList);
                  }
                  if (k.SpecialtyChildren && k.SpecialtyChildren.length) {
                    k.SpecialtyChildren.forEach(function (n) {
                      if (n.WPAcceptanceList && n.WPAcceptanceList.length) {
                        vm.sc = vm.sc.concat(n.WPAcceptanceList);
                      }
                    });
                  }
                })
                return r;
              })
            })
            tasks = tasks.concat(projectTask(item.RegionID));
            item.percent = item.current = 0;
            item.total = tasks.length;
            api.task(tasks, {
              event: 'downloadsc',
              target: item
            })(null, function () {
              if (!isReflsh) {
                callBack();
              } else {
                utils.alert("刷新成功!");
              }
            }, function (timeout) {
              item.percent = item.current = item.total = null;
              var msg = timeout ? '请求超时,任务下载失败!' : '下载失败,请检查网络';
              $mdDialog.cancel();
              utils.alert(msg);
            })
          }],
          template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
        evt && evt.stopPropagation();
      })

    }

    api.event('downloadsc', function (s, e) {
      var current = vm.current;
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
        }
      }
    }, $scope);

    vm.upload = function (item) {
      item.progress = 0;
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.item = item;
          $scope.loading=false;
          item.percent=100+"%";
          item.current=0;
          item.total=0;
          remote.Project.getMap(item.ProjectID).then(function (result) {
            if (result.data && result.data.length) {
              var pk = pack.sc.up(item.AssessmentID);
              pk.upload(function (proc, curent, total) {
                if (proc != -1) {
                  item.percent = proc;
                  item.current = curent;
                  item.total = total;
                } else {
                  item.current = item.total = null;
                  item.completed = pk.completed;
                  if (item.completed)
                    $q(function(resolve,reject){
                      $scope.loading=true;
                      remote.Assessment.sumReportTotal(item.AssessmentID).then(function () {
                        pack.sc.removeSc(item.AssessmentID, function () {
                          $q.all([
                            // remote.Assessment.GetMeasurePointAll(item.RegionID),
                            remote.Assessment.GetRegionTreeInfo(item.ProjectID, "pack2" + item.AssessmentID)
                          ]).then(function(){
                            resolve()
                          }).catch(function(){
                            reject();
                          })
                          ;//刷新状态
                        });
                      }).catch(function(){
                        reject();
                      })
                    }).then(function(){
                      $mdDialog.hide();
                      utils.alert('同步完成');
                    }).catch(function(){
                      $mdDialog.hide();
                      utils.alert('在刷新数据的时候发生了错误');
                    })
                  else {
                    utils.alert('同步发生错误,未完成!');
                    $mdDialog.hide();
                  }
                }
              });
            }
            else {
              utils.alert(result.data.ErrorMessage);
            }
          }).catch(function () {
            utils.alert('网络出现异常')
          })
        }],
        template: '<md-dialog aria-label="正在上传..."  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p ng-if="!loading" style="padding-left: 6px;">正在上传：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p><p ng-if="loading" style="padding-left: 6px;">正在刷新数据,请稍后....</p></md-dialog-content></md-dialog>',
        parent: angular.element(document.body),
        clickOutsideToClose: false,
        fullscreen: false
      });
    }

    vm.go = function (item) {
      var routeData = {
        projectId: item.RegionID,
        assessmentID: item.AssessmentID,
        role: vm.role
      };
      api.setNetwork(1).then(function () {
        $rootScope.sc_Area = item.RegionID;
        $state.go("app.xhsc.scsl.sclist", routeData)
      })
    }


    vm.uploadW=function (item,evt) {
      vm.upload(item);
      evt.stopPropagation();
    }


    vm.Refresh=function (item,evt) {
      vm.download(item, true, evt);
      evt.stopPropagation();
    }


    vm.action = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '实 测',
            action: function () {
              $mdBottomSheet.hide();
              vm.go(item);
            }
          }, {
            title: '刷 新',
            action: function (evt) {
              $mdBottomSheet.hide();
              vm.download(item, true, evt);
            }
          }, {
            title: '上 传',
            action: function () {

            }
          }, {
            title: '删 除',
            action: function () {
              $mdBottomSheet.hide();
              utils.confirm('确认删除?', evt, '', '').then(function () {
                $mdDialog.show({
                  controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
                    pack.sc.remove(item.AssessmentID, function () {
                      $mdDialog.hide();
                      sxtlocaStorage.removeArrItem("itemDownLoad",function (t) {
                         return t._id==item.RegionID
                      });
                      item.isComplete=false;
                    })
                  }],
                  template: '<md-dialog aria-label="正在删除"  ng-cloak><md-dialog-content> <md-progress-circular  md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在删除,请稍后...</p></md-dialog-content></md-dialog>',
                  parent: angular.element(document.body),
                  clickOutsideToClose: false,
                  fullscreen: false
                });
              })
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.stretch = function (item) {
      item.stretch = !item.stretch;
    }

    vm.click = function (item, evt) {
      if (item.isComplete) {
        vm.go(item);
      }
      evt.stopPropagation();
    }

  }
})();

/**
 * Created by emma on 2016/7/27.
 */
(function(){
  'use strict';

  schztbdetailController.$inject = ["remote", "$rootScope", "$stateParams"];
  angular
    .module('app.xhsc')
    .controller('schztbdetailController',schztbdetailController);

  /**@ngInject*/
  function schztbdetailController(remote,$rootScope,$stateParams){
    var vm = this;
    vm.acceptanceItemID=$stateParams.acceptanceItemID;
    vm.regionId=$stateParams.regionId;
    remote.Assessment.GetMeasureIndexMeasureInfo_v2($stateParams.regionId,$stateParams.itemId,$stateParams.relative).then(function (result) {
      vm.data = result.data;
      $rootScope.title = vm.data.Region.FullRegionName + (vm.data.Region.HouseTypeName?'('+vm.data.Region.HouseTypeName+')':'');
    });
  }
})();

/**
 * Created by emma on 2016/7/27.
 */
(function(){
  'use strict';

  schztbController.$inject = ["$stateParams", "$rootScope", "remote"];
  angular
    .module('app.xhsc')
    .controller('schztbController',schztbController);

  /**@ngInject*/
  function schztbController($stateParams,$rootScope,remote){
    var vm = this;
    var iMax = 20;
    vm.info={
      pname: $stateParams.pname,
      name:$stateParams.name
    };
    vm.regionId=$stateParams.regionId;
    vm.AcceptanceItemID = $stateParams.measureItemID;
    vm.db=$stateParams.db;
    $rootScope.title = vm.info.name+'('+vm.info.pname+')';
    vm.back = function () {
      history.back();
    }
    vm.twentyRows=[];
    vm.goBack=function(){
      window.history.go(-1);
    }
    for(var i=0;i<20;i++){
      vm.twentyRows.push({});
    }
    remote.Assessment.getMeasure_v2({
      RegionID:$stateParams.regionId,//'0001500000000010000000001',//,
      AcceptanceItemID:$stateParams.measureItemID,//'c9ba481a76644c949d13fdb14b4b4adb',//,
      RelationID:$stateParams.db//'a55164d5c46f454ca8df799f520bbba8'//
    },"nodb").then(function (result){

      console.log(result)
      var newD = [];
      vm.checkUser = result.data[0].data.checkUser;

      result.data[0].data.record.forEach(function (item) {
        //item.newList
        item.rows=item.rows?item.rows:[];
        var arr=[];
        item.List.forEach(function (ee) {
          if (!arr.find(function (m) {
              return m.MeasurePointID==ee.MeasurePointID;
            })){
            arr.push(ee);
          }
        })
        item.List=arr;
        if(!item.List.length){
        //if(!item.newList.length){
        //   item.List=item.List.filter(function (o) {
        //   });
          var rowSpan = 0,t1=0,t2 = 0,tempq=[],tempa=[];
          item.Children = result.data[0].data.record.filter(function (r) {
            if(r.ParentAcceptanceIndexID==item.AcceptanceIndexID){
              if(r.List.length==0)return false;
              r.rows = [];
              var ps=[];
              var numbers=[];
              for(var i=0;i<r.QualifiedPointNum.length;i++){
                var q = r.QualifiedPointNum[i].Value;
                var p = r.UnqualifiedPointNum[i].Value;
                tempa.push({Role:r.QualifiedPointNum[i].Role,allDot:q+p});
              }
              for(var i=0;i< r.QualifiedPointNum.length;i++){
                tempq.push(r.QualifiedPointNum[i]);
              }
              r.QualifiedRate.forEach(function(v){
                v.Value = v.Value * 100;
              })
              r.List.forEach(function (m) {
                m.MeasureValue.forEach(function(r1){
                  var fstatus= m.MeasureStatus.find(function(_r){
                    return _r.Role == r1.Role;
                  })
                  if(fstatus){
                    r1.Status = fstatus.Value;
                  }
                })
                var p = ps.find(function (p1) {
                  return p1.ParentMeasureValueID == m.ParentMeasureValueID;
                });
                if(!p){
                  p = {
                    ParentMeasureValueID:m.ParentMeasureValueID,
                    ms:[]
                  };
                  ps.push(p);
                }
                p.ms.push(m);
              });
              ps.forEach(function (p) {
                if(p.ms.length<=20){
                  r.rows.push(p.ms);
                }
                else{
                  var ms = [];
                  p.ms.forEach(function (m) {
                    if(ms.length<20){
                      ms.push(m);
                    }
                    else{
                      item.rows.push(ms);
                      ms=[m];
                    }
                  });
                  r.rows.push(ms);
                }
              });
              r.rows.forEach(function (ms) {
                while (ms.length<20){
                  ms.push({});
                }
              });
              rowSpan+=r.rows.length;
              return true;
            }
            return false;
          });
          item.rowSpan = rowSpan;
          newD.push(item);
          var atemp=[],btemp=[];
          if(tempa){
            for(var i=0;i<tempa.length;i++){
              var f =atemp.find(function(t){
                return t.Role == tempa[i].Role;
              })
              if(!f){
                f={
                  Role:tempa[i].Role,
                  t:tempa[i].allDot
                }
                atemp.push(f)
              }else{
                f.t +=tempa[i].allDot
              }
            }
          }
          if(tempq){
            for(var i=0;i<tempq.length;i++){
              var f =btemp.find(function(t){
                return t.Role == tempa[i].Role;
              })
              if(!f){
                f={
                  Role:tempq[i].Role,
                  t:tempq[i].Value
                }
                btemp.push(f)
              }else{
                f.t +=tempq[i].Value
              }
            }
          }
          var arra=[],arrb=[];
          for(var i=0;i<btemp.length;i++){
            var a = btemp[i].t/atemp[i].t;
            arra.push({Role:btemp[i].Role,Value:a});
          }
          for(var i=0;i<atemp.length;i++){
            var a = btemp[i].t+'/'+atemp[i].t;
            arrb.push({Role:btemp[i].Role,Value:a});
          }
          item.allDot = arrb;
          item.Qual = arra;
          //console.log(btemp);
          //item.allDot = item.allDot;
        }
        else if(!item.ParentAcceptanceIndexID){

          var roles=[];
          item.rows = [];
          var ps=[];
          item.QualifiedRate.forEach(function(v){
            v.Value = v.Value * 100;
            var f = roles.find(function(r){
              return r.Role == v.Role;
            })
            if(!f){
              roles.push({Role: v.Role});
            }
          })

          var numbers=[];
          for(var i=0;i<item.QualifiedPointNum.length;i++){
            var q = item.QualifiedPointNum[i].Value;
            var p = item.UnqualifiedPointNum[i].Value;
            numbers.push({Role:item.QualifiedPointNum[i].Role,allDot:q+'/'+p});
          }
          item.numbers =numbers;

          item.List.forEach(function (m) {
            var exist = 0;
            roles.forEach(function(r){
              var f = m.ExtendedField1&&m.ExtendedField1.find(function(_r){
                return _r.Role == r.Role;
              })
              if(!f){
                m.ExtendedField1&&m.ExtendedField1.push({Role: r.Role,Value:','})
              }
            })
            m.ExtendedField1&&m.ExtendedField1.forEach(function(fileds){
              var i =fileds.Value?fileds.Value.indexOf(','):0;
              if(i>0){
                exist = 1;
              }
            })
            if(!exist){
              m.MeasureValue.forEach(function(r){
                var fi= m.MeasureStatus.find(function(_r){
                  return _r.Role == r.Role;
                })
                if(fi){
                  r.Status = fi.Value;
                }
              })
            }

            var p = ps.find(function (p1) {
              return p1.ParentMeasureValueID == m.ParentMeasureValueID;
            });
            if(!p){
              p = {
                ParentMeasureValueID:m.ParentMeasureValueID,
                ms:[]
              };
              ps.push(p);
            }

            if(exist){
              var max= 0,nums=[];
              for(var i=0;i< m.ExtendedField1.length;i++){
                if(m.ExtendedField1[i].Value&&m.ExtendedField1[i].Value.indexOf(',')){
                  var num = m.ExtendedField1[i].Value.split(',');
                  nums.push(num);
                  if(num.length > max) max = num.length;
                }
              }
              //console.log(nums)
              var values=[];
              for(var i=0;i<max;i++){
                var temp=[];
                for(var j=0;j<roles.length;j++){
                  temp.push({Role:roles[j].Role,Value:nums[j]&&nums[j][i]||'',Status:m.MeasureStatus[j]&&m.MeasureStatus[j].Value});
                }
                values.push(temp);
              }
              values.forEach(function (v) {
                p.ms.push({
                  MeasureValue:v,
                  MeasureValueId:m.MeasureValueId[0].Value
                });
              });
              p.ParentMeasureValueID = m.MeasureValueId;
              m.ExtendedField1.forEach(function(fs,index){
              })

            }
            else {
              p.ms.push(m);
              if (item.IndexName.indexOf('尺寸一致性') != -1) {
                m.MeasureValue.forEach(function(_r,index){
                  _r.Value =_r.Value + '/' + m.DesignValue[index].Value;
                })
                //m.MeasureValue = m.MeasureValue + '<br/>' + m.DesignValue;
              // m.MeasureValue = m.MeasureValue;
            }
            }
          });
          ps.forEach(function (p) {
            if(p.ms.length<=20){
              item.rows.push(p.ms);
            }
            else{
              var ms = [];
              p.ms.forEach(function (m) {
                if(ms.length<20){
                  ms.push(m);
                }
                else{
                  item.rows.push(ms);
                  ms=[m];
                }
              });
              item.rows.push(ms);
            }
          });
          item.rows.forEach(function (ms) {
            while (ms.length<20){
              ms.push({});
            }
          })
          newD.push(item);
        }
      });
      vm.scData = newD;
    });
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function () {
  'use strict';

  scRegionController.$inject = ["$scope", "$stateParams", "sxt", "$rootScope", "xhUtils", "remote", "$timeout", "$q", "$state", "$mdDialog", "utils", "db"];
  angular
    .module('app.xhsc')
    .controller('scRegionController', scRegionController);

  /** @ngInject */
  function scRegionController($scope, $stateParams, sxt, $rootScope, xhUtils, remote, $timeout, $q, $state, $mdDialog, utils, db) {
    var vm = this,
      area = $stateParams.projectId,
      projectId = area.substr(0, 5),
      acceptanceItemID = $stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName,
      assessmentID = $stateParams.assessmentID,
      isReport = vm.isReport = $stateParams.isReport;
    vm.maxRegion = $stateParams.maxRegion;
    $rootScope.title = $stateParams.acceptanceItemName;
    $rootScope.sendBt = false;
    vm.maxRegion = $stateParams.maxRegion;
    vm.building = [];
    vm.nums = {
      qb: 0,
      wtj: 0,//未提交
      ytj: 0//已检查
    }
    function setNum(status, region) {
      if ((vm.maxRegion == 8 && region.RegionType == 8) || vm.maxRegion == 16 && region.RegionType >= 8) {
        vm.nums.qb++;
        switch (status) {
          case  0:
            vm.nums.wtj++;
            break;
          case  1:
            vm.nums.ytj++;
            break;
        }
      }
    }

    function load() {

      vm.nums = {
        qb: 0,
        wtj: 0,//未提交
        ytj: 0//已检查
      }

      function initRegion(region, sc_status) {
        function ConvertClass(status) {
          var style;
          switch (status) {
            case 0:
              style = "wait";
              break;
            case 1:
              style = "pass";
              break;
            default:
              break;
          }
          return style;
        }

        function _init(region) {
          function setStatus(status,statusArr) {
            if (angular.isArray(statusArr) && statusArr.find(function (k) {
                return k == acceptanceItemID;
              })) {
              return 1;
            }
            return 0;
          }

          region.Status = setStatus(sc_status,region.StatusList);
          if (region.RegionType == 2 && region.RegionID == area) {
            region.selected = true;
          }
          if (region.RegionType == 4&&region.ParentID==area) {
            vm.building.push(region);
          }
          if (region && region.RegionType == 8 || region && region.RegionType == 16) {
            region.style = ConvertClass(region.Status);
            setNum(region.Status, region);
          }
          if (region && region.Children.length) {
            region.Children.forEach(function (r) {
              _init(r);
            });
          }
          if (region.RegionType == 4) {
            region.floors = [];
            region.Children.forEach(function (k) {
              if (!k.Children.length) {
                region.floors.push(k)
              }
            })
          }
        }

        _init(region);
      }

      vm.isRegionShow = function (region) {
        if (vm.maxRegion > 8) {
          if (region.Children && region.Children.length) {
            var f = region.Children.find(function (o) {
              return o.Status == vm.filterNum || vm.filterNum == -1;
            });
            if (f) {
              return true;
            }
          }
        }
        return region.Status == vm.filterNum || vm.filterNum == -1;
      }

      function callBack(res) {
        vm.loading = true;
        var r = res, status = [];
        var project = r.data.data, _area;
        if (angular.isArray(project.Children)) {
          project.Children.forEach(function (k) {
            if ( k.RegionID == area){
              initRegion(k, status.data);
            }
          });
        }
        vm.houses = project.Children;
      }
      remote.Assessment.GetRegionTreeInfo(projectId, 'pack2' + assessmentID).then(callBack)
    }

    load();

    vm.selected = function (r) {
      var routeData = {
        areaId: r.RegionID,
        regionId: r.RegionID,
        RegionName: r.RegionName,
        name: r.FullRegionName,
        regionType: r.RegionType,
        db: assessmentID,
        measureItemID: acceptanceItemID,
        pname: acceptanceItemName
      }
      $state.go('app.xhsc.scsl._sc', routeData);
    }
    //总包点击事件

    vm.zk = function (item) {
      item.show = !item.show;
    }
    vm.filterNum = isReport == '1' ? 1 : -1;
    vm.filter = function (num) {
      vm.filterNum = num;
    }
  }
})();

/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  sclistController.$inject = ["$scope", "scRemote", "$stateParams", "db", "$state"];
  angular
    .module('app.xhsc')
    .controller('sclistController',sclistController);

  /**@ngInject*/
  function sclistController($scope,scRemote,$stateParams,db,$state){
    var vm=this;
    var remote=  scRemote;
    vm.area= $stateParams.projectId;
    vm.projectId = vm.area.substr(0,5);
    vm.assessmentID=$stateParams.assessmentID;
    //var isReport=vm.isReport=$stateParams.isReport;

    function  callback(result){
      vm.procedureData = [];
      if (result.data&&result.data.data){
        vm.procedureData=result.data.data;
      }
    }

    scRemote.Assessment.GetMeasureItemInfoByAreaID(vm.projectId,'pack1'+vm.assessmentID).then(callback);
    //if (isReport=='0'||isReport==0){
    //  var _db=db('pack'+ vm.assessmentID);
    //  _db.get("GetMeasureItemInfoByAreaID").then(callback);
    //}else {
    //  scRemote.Project.GetMeasureItemInfoFilter(vm.projectId).then(callback);
    //}
    //离线待实现
    function getMax(regionStr){
      var val= 0,tmp;
      var  arr=regionStr.split(',');
      if (angular.isArray(arr)){
        arr.forEach(function(o){
          tmp=parseInt(o);
          if (val<tmp){
              val=tmp;
          }
        });
      }
      return val;
    }
    vm.go=function(item){
      $state.go('app.xhsc.scsl.scRegion',{
        assessmentID:vm.assessmentID,
        acceptanceItemID:item.AcceptanceItemID ,
        projectId: vm.area,
        acceptanceItemName:item.MeasureItemName,
        maxRegion: getMax(item.SplitRule)
        //isReport:vm.isReport
      });
    };
  }
})();

/**
 * Created by lss on 2016/7/26.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  chooseAreaController.$inject = ["$scope", "$stateParams", "db", "$state", "remote"];
  angular
    .module('app.xhsc')
    .controller('chooseAreaController',chooseAreaController);

  /** @ngInject */
  function chooseAreaController($scope,$stateParams,db,$state,remote){
    var vm=this,
      id =vm.areasssessmentID= $stateParams.assessmentID;
      vm.projectId=$stateParams.projectId;
      //vm.role=$stateParams.role;
      //var isReport= vm.isReport=$stateParams.isReport;

    var pk = db('pack'+id);
    vm.project;
    vm.areas=[];
    function  callBack(r){
      vm.project=r;
      if (r.data){
        if (r.data.Children&&angular.isArray(r.data.Children)){
          r.data.Children.forEach(function(m){
            vm.areas.push({
              regionID: m.RegionID,
              regionName: m.RegionName
            });
          });
        }
      }
    }

    if (isReport=='0'||isReport==0){
      pk.get('GetRegionTreeInfo').then(callBack);
    }else {
      remote.Project.GetRegionTreeInfo(vm.projectId).then(callBack);
    }

    vm.go=function(item){
      $state.go('app.xhsc.scsl.sclist',{
        projectId:vm.projectId,
        assessmentID:vm.areasssessmentID,
        area:item.regionID
        //isReport:vm.isReport
      });
    }
  }
})();

/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016-5-3.
 */
(function(){
  'use strict';

  _scController.$inject = ["$scope", "$rootScope", "xhUtils", "$stateParams", "utils", "$mdDialog", "db", "scPack", "sxt", "$timeout", "$state", "remote", "api", "$q"];
  angular
    .module('app.xhsc')
    .controller('_scController',_scController)
  /** @ngInject */
  function _scController($scope,$rootScope,xhUtils,$stateParams,utils,$mdDialog,db,scPack,sxt,$timeout,$state,remote,api,$q) {
    var vm = this;
    var  pack=scPack;
    vm.info = {
      db:$stateParams.db,
      name: $stateParams.name,
      areaId:$stateParams.areaId,
      acceptanceItemID:$stateParams.measureItemID,
      regionId: $stateParams.regionId,
      regionType: $stateParams.regionType,
      aItem:{
        MeasureItemName:$stateParams.pname,
        AcceptanceItemID:$stateParams.measureItemID
      },
      tooltip:''
    };
    var areaId = vm.info.regionId.substr(0, 10);
    api.setNetwork(1).then(function(){
      $rootScope.title =vm.info.name;
      var packdb = db('pack1'+vm.info.db);
      var arr=[
        packdb.get('GetMeasureItemInfoByAreaID'),
        remote.Project.getDrawingRelations(areaId, "scDrawingRelation"),
        remote.PQMeasureStandard.GetListByExtend(areaId.substr(0, 5), "standard")
      ]

      $q.all(arr).then(function(res){
        vm.info.loaded=true;
        var  r=res[0];
        var find = r.data.find(function (it) {
          return it.AcceptanceItemID == vm.info.acceptanceItemID;
        });
        if(!find){ //TODO:一般不可能找不到,找不到肯定后台有问题,这里可能需要提示并去掉
          find = r.data.find(function () {
            return true;
          })
        }
        var m=[];
        find.MeasureIndexList.forEach(function(item) {
          m.push(item);
        });
        vm.MeasureIndexes = m;
        vm.MeasureIndexes.forEach(function(t){
          t._id = sxt.uuid();//指标结构表
          t.checked = false;
        })
        vm.picRelate=res[1];
        vm.standar=res[2];

        $timeout(function () {
          vm.scChoose();
        },500);
      }).catch(function(err){
          console.log(err);
      });

      vm.scChoose = function($event){
        $mdDialog.show({
            controller: ['$scope','$mdDialog',function($scope, $mdDialog) {
              $scope.checkSc = function(sc){
                vm.MeasureIndexes.forEach(function (it) {
                  it.checked =false;
                })
                sc.checked = true;
                $scope.answer([sc]);
              };
              $scope.scList = vm.MeasureIndexes;
              $scope.getIsChecked = function () {
                return !$scope.scList.find(function (r) {
                  return r.checked;
                })
              }
              $scope.hide = function () {
                $mdDialog.hide();
              };
              $scope.cancel = function () {
                $mdDialog.cancel();
              };
              $scope.answer = function (answer) {
                $mdDialog.hide(answer);
              };
            }],
            targetEvent:$event,
            templateUrl: 'app/main/xhsc/ys/scChoose.html',
            parent:angular.element('#content'),
            clickOutsideToClose:vm.info.MeasureIndexes//&&vm.info.MeasureIndexes[0].checked
          })
          .then(function(answer) {
            var scStr=[];
            answer && answer.forEach(function(t){
              if(t.checked ==  true){
                scStr.push(t);
              }
            });
            vm.info.MeasureIndexes = scStr;
            var ms=[];

            vm.info.MeasureIndexes.forEach(function (m) {
              ms.push(m);
              if(m.Children && m.Children.length){
                m.Children.forEach(function (m1) {
                  ms.push(m1);
                });
              }
            });
            ms.forEach(function (m) {
              //系统中仅有"门洞尺寸"的"厚"和"宽"需要处理抹灰厚度问题
              if(m.AcceptanceIndexID=='8043e1a4efa942babdb87c5ad5116737'||m.AcceptanceIndexID=='500dc59be8d44458b6fd7940d2c54adc'){
                m.plasterDepth = vm.plasterDepth;
                m.plasterDepthMethod = m.AcceptanceIndexID=='8043e1a4efa942babdb87c5ad5116737'?'+':'-'
              }
            });
            vm.submit();
          });
      }

      vm.submit = function (ev) {
        /*      $mdDialog.show($mdDialog.confirm()
         .title('提交？')
         .textContent('确定完成提交当前指标测试数据吗？')
         .ariaLabel('提交？')
         .targetEvent(ev)
         .ok('确定')
         .cancel('取消')).then(function () {*/
        var indexs = pack.sc.up(vm.info.db).indexs.db;
        vm.info.MeasureIndexes.forEach(function (m) {
          var ms = [];
          if(m.Children && m.Children.length){
            m.Children.forEach(function (it) {
              ms.push(it);
            })
          }
          else{
            ms.push(m);
          }
          ms.forEach(function (m) {
            if(!m._id)
              m._id = sxt.uuid();

            indexs.addOrUpdate({
              _id: m._id,
              RegionId: vm.info.regionId,
              RegionType:vm.info.regionType,
              AcceptanceIndexID: m.AcceptanceIndexID,
              AcceptanceItemID: vm.info.acceptanceItemID,
              IndexResultID:m._id,
              RecordType:1,
              RelationID:vm.info.db,
              Status: 1
            });
          });
        })
      }
    });
  }
})();

/**
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  zjhouseChooseController.$inject = ["$scope", "$stateParams", "sxt", "remote", "$timeout", "$q", "$state", "$mdDialog", "utils", "api", "xhscService", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('zjhouseChooseController',zjhouseChooseController);

  /** @ngInject */
  function zjhouseChooseController($scope,$stateParams,sxt,remote,$timeout,$q,$state,$mdDialog,utils,api,xhscService,$rootScope){
    var vm=this,
      areaId= $stateParams.projectId,
      projectId = areaId.substr(0,5),
      acceptanceItemID=$stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName
    vm.maxRegion = $stateParams.maxRegion;
    $rootScope.title = $stateParams.acceptanceItemName;
    $rootScope.sendBt = false;
    vm.maxRegion = $stateParams.maxRegion;

    vm.building=[];
    function  load(){
      vm.nums={
        qb:0, //全部
        wtj:0,//未提交
        ytj:0//已检查
      }
      function  setNum(status,region){
        if ((vm.maxRegion==8&&region.RegionType==8)||vm.maxRegion>8&&region.RegionType>=8){
          vm.nums.qb++;
          switch (region.status){
            case  0:
              vm.nums.wtj++;
              break;
            case  1:
              vm.nums.ytj++;
              break;
          }
        }
      }
      //状态设置与用户区域权限
      function filterOrSetting(status,region){
        if (region.RegionType<=4){
          return;
        }
        if(!angular.isArray(status)){
          status=[status];
        }
        var st= status.find(function(t){
          return t.AcceptanceItemID==acceptanceItemID && t.AreaId == region.RegionID
        });
        if (st){
          region.status=st.Status;
        }else {
          region.status=0;
        }
        region.style=ConvertClass(region.status);
        setNum(status,region);
      }

      function ConvertClass(status){
        var style;
        switch (status){
          case 0:
            style="wait";
            break;
          case 1:
            style="pass";
            break;
        }
        return style;
      }
      vm.floors=[];
      $q.all([
        remote.Project.queryAllBulidings(projectId),
        remote.Procedure.getRegionStatusEx(projectId,8,null,"project_status_zj")
      ]).then(function(res){
        vm.loading = true;
        var result=res[0];
        var status=res[1]&&res[1].data?res[1].data:[];
        result.data[0].RegionRelations.forEach(function(d){
          if (d.RegionID==areaId){
            d.selected=true;
            filterOrSetting(status,d);
            d.projectTree =  d.RegionName;
            d.projectTitle = result.data[0].ProjectName + d.RegionName;
            d.Children && d.Children.forEach(function(c){
              c.floors=[];
              filterOrSetting(status,c)
              c.projectTree = d.projectTree + c.RegionName;
              c.checked = false;
              vm.building.push(c);
              c.Children && c.Children.forEach(function(r){
                r.projectTree = c.projectTree + r.RegionName;
                r.checked = false;

                filterOrSetting(status,r);
                if (! r.Children||!r.Children.length){
                  c.floors.push(r);
                }else {
                  r.Children.forEach(function(_r){
                    _r.projectTree = r.projectTree + _r.RegionName;
                    _r.checked = false;
                    filterOrSetting(status,_r);
                  })
                }
              })
            })
          }
        })
        vm.houses =  result.data[0].RegionRelations;

        var DynamicItems = function() {
          /**
           * @type {!Object<?Array>} Data pages, keyed by page number (0-index).
           */
          this.loadedPages = {};

          /** @type {number} Total number of items. */
          this.numItems = 0;

          /** @const {number} Number of items to fetch per request. */
          this.PAGE_SIZE = 1;

          this.fetchNumItems_();
        };

        // Required.
        DynamicItems.prototype.getItemAtIndex = function(index) {
          var pageNumber = Math.floor(index / this.PAGE_SIZE);
          var page = this.loadedPages[pageNumber];

          if (page) {
            return page[index % this.PAGE_SIZE];
          } else if (page !== null) {
            this.fetchPage_(pageNumber);
          }
        };

        // Required.
        DynamicItems.prototype.getLength = function() {
          return this.numItems.length;
        };

        DynamicItems.prototype.fetchPage_ = function(pageNumber) {
          // Set the page to null so we know it is already being fetched.
          this.loadedPages[pageNumber] = null;

          // For demo purposes, we simulate loading more items with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop).then(angular.bind(this, function() {
            this.loadedPages[pageNumber] = [];
            var pageOffset = pageNumber * this.PAGE_SIZE;
            for (var i = pageOffset; i < pageOffset + this.PAGE_SIZE; i++) {
              this.loadedPages[pageNumber].push(vm.building[i]);
            }
          }));
        };

        DynamicItems.prototype.fetchNumItems_ = function() {
          // For demo purposes, we simulate loading the item count with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop).then(angular.bind(this, function() {
            this.numItems = vm.building;
          }));
        };

        vm.dynamicItems = new DynamicItems();
        return vm.houses;
      });
    }
    load();

    vm.selected = function(r){
      remote.Procedure.getRegionStatusEx(projectId,"8",null,"project_status_zj").then(function (r1) {
        var fd = r1.data.find(function (item) {
          return item.AreaId==r.RegionID&&item.AcceptanceItemID==acceptanceItemID;
        });
        if(fd!=null){
          $state.go('app.xhsc.gx.gxzjcheck',
            {
              acceptanceItemID:acceptanceItemID,
              acceptanceItemName:acceptanceItemName,
              projectId:projectId,
              InspectionId:fd.InspectionId
            });
        }
        else{
          r.checked = true;
          $rootScope.$emit('sendGxResult');
        }
      });
    }
    //总包点击事件

    vm.zk = function(item){
      item.show = !item.show;
    }
    vm.filterNum = -1;
    vm.filter = function(num){
      vm.filterNum = num;
    }

    vm.regionfilterByStatus=function(region){
      if (vm.filterNum==-1){
         return true;
      }
      if (region.Children&&!region.Children.length||vm.maxRegion>8){
        return true;
      }
      return region.status==vm.filterNum;
    }

    var sendgxResult =$rootScope.$on('sendGxResult',function(){
      vm.data = {
        Percentage:100,
        AreaList:[],
        Describe:'',
        Sign:8,
        AcceptanceItemID:acceptanceItemID
      }

      vm.houses.forEach(function(t){
        t.Children.forEach(function(_t){
          if(_t.checked){
            vm.data.AreaList.push({
              AreaID:_t.RegionID,
              Describe:"",
              Percentage:100,
              RegionName:_t.RegionName
            });
          }
          _t.Children && _t.Children.forEach(function(_tt){
            if(_tt.checked){
              vm.data.AreaList.push({
                AreaID:_tt.RegionID,
                Describe:"",
                Percentage:100,
                RegionName:_t.RegionName+_tt.RegionName
              });
            }
            _tt.Children && _tt.Children.forEach(function(l){
              if(l.checked){
                vm.data.AreaList.push({
                  AreaID:l.RegionID,
                  Describe:"",
                  Percentage:100,
                  RegionName:_t.RegionName+_tt.RegionName+l.RegionName
                })
              }
            })
          })
        })
      })
      if(vm.data.AreaList.length){
        if(!vm.data.Id)
          vm.data.InspectionId = sxt.uuid();
        api.setNetwork(1).then(function(){
          remote.Procedure.postInspection(vm.data).then(function(result){
            if (result.data.ErrorCode==0){
              $state.go('app.xhsc.gx.gxzjcheck',
                {
                  acceptanceItemID:acceptanceItemID,
                  acceptanceItemName:acceptanceItemName,
                  projectId:projectId,
                  InspectionId:result.data.args[0].InspectionId
                });
            }
          });
        });
      }else{
        utils.alert('请选择区域');
      }
    });

    $scope.$on("$destroy",function(){
      sendgxResult();
      sendgxResult=null;
    });
  }
})();

/**
 * Created by lss on 2016/9/22.
 */
/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  ywController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "xhscService", "$mdBottomSheet", "$stateParams"];
  angular
    .module('app.xhsc')
    .controller('ywController', ywController);

  /**@ngInject*/
  function ywController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog, db, xhscService, $mdBottomSheet, $stateParams) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    var globalTask = [
      function () {
        return remote.Procedure.queryProcedure().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        })
      }
    ];
    //项目包
    function projectTask(regionID, areas, acceptanceItemID) {
      var projectId = regionID.substr(0, 5);
      function  filter(item) {
        return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
          (!areas || areas.find(function (a) {
            return a.AreaID == item.RegionId;
          })) && vm.procedure.find(function (k) {
            return k.AcceptanceItemID == item.AcceptanceItemID;
          })
      }
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID,null,filter).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }


    function InspectionTask(item) {
      var t = [function () {
        return remote.Project.getInspectionList(item.InspectionId);
      }];
      item.Children.forEach(function (area) {
        t.push(function (tasks, down) {
          return remote.Procedure.InspectionCheckpoint.query(item.AcceptanceItemID, area.AreaID, item.InspectionId).then(function (result) {
            result.data.forEach(function (p) {
              tasks.push(function () {
                return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                  result.data.forEach(function (r) {
                    tasks.push(function () {
                      return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                      })
                    })
                  })
                })
              });
            });
          })
        });
        t.push(function () {
          return remote.Procedure.InspectionIndexJoinApi.query(item.InspectionId)
        })
        t.push(function () {
          return remote.Procedure.InspectionPoint.query(item.InspectionId, item.AcceptanceItemID, area.AreaID)
        })

      });
      return t;
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.Procedure.getZGById(item.RectificationID).then(function (r) {
            r.data[0].Children.forEach(function (area) {
              tasks.push(function () {
                return remote.Procedure.getZGReginQues(area.AreaID, item.RectificationID);
              });
              tasks.push(function () {
                return remote.Procedure.getZGReginQuesPoint(area.AreaID, item.RectificationID);
              })
            })
          });
        },
        function () {
          return remote.Procedure.getRectification(item.RectificationID);
        }
      ]
    }


    function InspectionZjTask(t, AcceptanceItemID, AreaID, InspectionId) {
      t.push(function () {
        return remote.Procedure.InspectionPoint.query(InspectionId, AcceptanceItemID, AreaID, "InspectionPoint_zj")
      })
      t.push(function (tasks, down) {
        return remote.Procedure.InspectionCheckpoint.query(AcceptanceItemID, AreaID, InspectionId, "InspectionCheckpoint_zj").then(function (result) {
          result.data.forEach(function (p) {
            tasks.push(function () {
              return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID, "InspectionProblemRecord_zj").then(function (result) {
                result.data.forEach(function (r) {
                  tasks.push(function () {
                    return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID, "", "InspectionProblemRecordFile_zj").then(function (result) {
                    })
                  })
                })
              })
            });
          });
        })
      });
    }

    vm.downloadzj = function (item, evt) {
      if (evt) {
        evt.stopPropagation();
      }
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(item.isOffline ? [] : projectTask(item.RegionID))
                .concat(function () {
                    return remote.Project.queryAllBulidings(item.RegionID.substr(0,5));
                  })
                .concat([
                  function (tasks) {
                    var group = [];
                    var inspections = [];
                    return remote.Procedure.getRegionStatusEx(item.ProjectID, "8", null, "project_status_zj").then(function (result) {
                      result.data.forEach(function (item) {
                        if (item.AcceptanceItemID && item.AreaId && item.InspectionId && !group.find(function (k) {
                            return k.AcceptanceItemID == item.AcceptanceItemID && k.AreaId == item.AreaId && k.InspectionId == item.InspectionId
                          })) {
                          group.push([item.AcceptanceItemID, item.AreaId, item.InspectionId]);
                        }
                        if (item.AcceptanceItemID && item.AreaId && item.InspectionId && !inspections.find(function (k) {
                            return k.InspectionId == item.InspectionId;
                          })) {
                          inspections.push(item.InspectionId);
                        }
                      })
                      inspections.forEach(function (id) {
                        tasks.push(function () {
                          return remote.Project.getInspectionList(id, "Inspection_zj");
                        });
                      });
                      group.forEach(function (data) {
                        InspectionZjTask(tasks, data[0], data[1], data[2]);
                      })
                    })
                  }
                ])
              api.task(tasks, {
                event: 'downloadzj',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                item.isComplete = true;
                return remote.offline.create({Id: 'zj' + item.RegionID});
                resolve();
              }, function () {
                item.percent = item.current = item.total = null;
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject()
              })
            }],
            template: '<md-dialog aria-label="正在下载基础数据"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      })
    };

    api.event('downloadzj', function (s, e) {
      var project = vm.zj_project && vm.zj_project.find(function (item) {
          return e.target.RegionID.indexOf(item.RegionID) > -1;
        });
      var current = project && project.Children && project.Children.find(function (item) {
          return e.target.RegionID == item.RegionID;
        })
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
        }
      }
    }, $scope);

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var projectId = item.Children.length ? item.Children[0].AreaID.substr(0, 5) : item.ProjectID;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(function () {
                  return remote.Project.queryAllBulidings(projectId);
                })
                .concat(InspectionTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'ys' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }

    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionId == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var projectId = item.Children.length ? item.Children[0].AreaID.substr(0, 5) : item.ProjectID;
              var t = [];
              if (!item.Children) {
                t = t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID));
              } else {
                item.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(function () {
                  return remote.Project.queryAllBulidings(projectId);
                })
                .concat(InspectionTask(item))
                .concat(rectificationTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'zg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                remote.offline.create({Id: 'zg' + item.RectificationID});
                //RectificationID
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }

    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);

    vm.by = function (r) {
      api.setNetwork(0).then(function () {
        $state.go('app.xhsc.gx.gxlist', {role: 'zb', projectId: r.RegionID});
      });
    }


    function load() {
      remote.Procedure.getZGlist(23).then(function (r) {
        vm.zglist = [];
        if (r.data&&angular.isArray(r.data.data)) {
          var zg = [];
          r.data.data.forEach(function (o) {
            zg.push(o);
          });
          remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              zg.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "zg" + k.RectificationID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.zglist = zg;
            var alert = false;
            switch (vm.yw) {
              case "4":
                var t = vm.zglist.find(function (k) {
                  return k.Status == 4;
                });
                alert = t ? false : true;
                break;
              case "32":
                var t = vm.zglist.find(function (k) {
                  return k.Status == 16;
                });
                alert = t ? false : true;
                break;
            }
            if (alert) {
              vm.isShowbg = true;
            }
            vm.f_isOver = true;

          });
        }
      });
      remote.Procedure.getInspections(1).then(function (r) {
        vm.Inspections = [];
        if (r.data&&angular.isArray(r.data.data)) {
          var ys = [];
          r.data.data.forEach(function (o) {
            ys.push(o);
          });
          remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "ys" + k.InspectionId;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
            if (vm.yw == 16 && !vm.Inspections.length) {
              vm.isShowbg = true;
            }
            vm.y_isOver = true;
          });
        }
      });
      remote.Project.getAllRegionWithRight("", 3).then(function (n) {
        if (vm.yw == 2 || vm.yw == 0) {
          vm.z_isOver = true;
          if (!n || n.data.length == 0) {
            vm.isShowbg = true;
            return;
          }
          remote.offline.query().then(function (r) {
            vm.by_project = xhscService.buildMutilRegionTree(n.data, 1);
            vm.zj_project = $.extend([], vm.by_project, true);


            vm.zj_project.forEach(function (k) {
              if (k.Children) {
                k.stretch=true;
                k.Children.forEach(function (n) {
                  if (r.data.find(function (m) {
                      return m.Id == 'zj' + n.RegionID;
                    })) {
                    n.isComplete = true;
                  }
                })
              }
            });

          })
        }
      }).catch(function () {
        vm.z_isOver = true;
        vm.isShowbg = true;
      });

    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.setModule = function (val) {
      vm.bodyFlag = val;
    }
    vm.zbzjAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzj(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxlist', {role: '', projectId: item.RegionID});
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxlist', {role: '', projectId: item.RegionID});
        });
      }
    }

    vm.zbzjbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '自 检',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzjAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzj(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.click = function (item, evt) {
      if (item.isComplete) {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxlist', {role: '', projectId: item.RegionID});
        });
      }
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxtest', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.Children[0].newName,
              projectId: item.ProjectID,
              areaId: item.Children[0].AreaID,
              InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxtest', {
            acceptanceItemID: item.AcceptanceItemID,
            acceptanceItemName: item.AcceptanceItemName,
            name: item.Children[0].newName,
            projectId: item.ProjectID,
            areaId: item.Children[0].AreaID,
            InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'zb',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', {
            Role: 'zb',
            InspectionID: item.InspectionId,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }

    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'jl',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', {
            Role: 'jl',
            InspectionID: item.InspectionId,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }

    vm.stretch = function (item) {
      item.stretch = !item.stretch;
    }
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  regionStatesController.$inject = ["$scope", "$stateParams", "db", "$rootScope", "xhUtils", "remote", "$timeout", "$q", "$state", "$mdDialog", "utils", "api"];
  angular
    .module('app.xhsc')
    .controller('regionStatesController',regionStatesController);

  /** @ngInject */
  function regionStatesController($scope,$stateParams,db,$rootScope,xhUtils,remote,$timeout,$q,$state,$mdDialog,utils,api){
    var vm=this,
      projectId = $stateParams.projectId,
      acceptanceItemID=$stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName
      vm.maxRegion = $stateParams.maxRegion;
    $rootScope.title = $stateParams.acceptanceItemName;
    var role='jl';
    function  load(){
      vm.nums={
        qb:0, //全部
        wtj:0,//未提交
        dy:0,//待验收
        hg:0, //合格
        bhg:0,//不合格
        yzg:0,//已整改
        wzg:0//未整改
      }
      function  setNum(status,region){
        function  addNum(status){
          vm.nums.qb++;
          switch (status){
            case  0:
              vm.nums.wtj++;
              break;
            case  1:
              vm.nums.dy++;
              break;
            case  2:
              vm.nums.hg++;
              break;
            case  4:
              vm.nums.bhg++;
              break;
            case  8:
              vm.nums.wzg++;
              break;
            case  16:
              vm.nums.yzg++;
              break;
          }
        }
        if (vm.maxRegion==8){
          if (region.RegionType==8&&region.hasShowRight){
            addNum(status);
          }
        }else {
          if (region.RegionType>=8&&region.hasShowRight){
            addNum(status);
          }
        }
      }
      //状态设置与用户区域权限
      function filterOrSetting(status,region){
        var st=status.find(function(o){
          return o.AreaId.indexOf(region.RegionID)!=-1;
        });
        if (st){
          region.hasShowRight=true;
        }
        if (region.RegionType>4){
          statusSetting(status,region);
        }
      }
      var st2 =[];
      function setInspection(region){
        var percentage= 0,status=0;
        if(region.inspectionRows.length){
          region.inspectionRows && region.inspectionRows.forEach(function(t){
            percentage += t.Percentage;
            status = t.Status;
          })
        }else{
          percentage = region.percentage;
          status = 0;
        }
        if(percentage > 100){
          percentage = 100;
        }
        region.Percentage = percentage;
        region.status = status;
        region.style=ConvertClass(status);
        setNum(status,region);
      }
      //状态设置
      function statusSetting(status,region){
        if(!angular.isArray(status)){
          status=[status];
        }
        var st1 = [];
        region.inspectionRows=[];
        status.forEach(function(t){
          if(t.AcceptanceItemID==acceptanceItemID && t.AreaId == region.RegionID){
            region.inspectionRows.push(t);
            region.InspectionId=t.InspectionId;
          }else{
            region.status=0;
            region.Percentage=0;
          }
        })
        setInspection(region);
      }
      function ConvertClass(status){
        var style;
        switch (status){
          case 0:
            style="wait";
            break;
          case 1:
            style="dy";
            break;
          case 2:
            style="pass";
            break;
          case 4:
            style="ng";
            break;
          case 8:
            style="ng";
            break;
          case 16:
            style="yzg";
            break;
          default:
            break;
        }
        return style;
      }
      $q.all([
        remote.Project.queryAllBulidings(projectId),
        remote.Procedure.getRegionStatus(projectId)
      ]).then(function(res){
        vm.loading = true;
        var result=res[0];
        var status=res[1]&&res[1].data?res[1].data:[];
        result.data[0].RegionRelations.forEach(function(d){
          filterOrSetting(status,d);
          d.projectTree =  d.RegionName;
          d.projectTitle = result.data[0].ProjectName + d.RegionName;
          d.Children && d.Children.forEach(function(c){
            filterOrSetting(status,c)
            c.projectTree = d.projectTree + c.RegionName;
            c.checked = false;
            c.Children && c.Children.forEach(function(r){
              r.projectTree = c.projectTree + r.RegionName;
              r.checked = false;
              filterOrSetting(status,r);
              vm.floors=vm.floors?vm.floors:[];
              vm.floors.push(r);
              r.Children && r.Children.forEach(function(_r){
                _r.projectTree = r.projectTree + _r.RegionName;
                _r.checked = false;
                filterOrSetting(status,_r);
              })
            })
          })
        })
        vm.houses =  result.data[0].RegionRelations;
      });
    }

    load();

    vm.zk = function(item){
      item.show = !item.show;
    }
    vm.filterNum = -1;
    vm.filter = function(num){
      vm.filterNum = num;
    }

    function compare(region,operator){
      if (region.Children){
        for (var  i=0;i<region.Children.length;i++){
          if (vm.regionfilterByStatus(region.Children[i])){
            return true;
          }
        }
        return  operator(region.status);
      }else {
        return  operator(region.status);
      }
    }

    vm.regionfilterByStatus=function(region){
      if (vm.filterNum==-1){
        return compare(region,function(status){
          return vm.statusRight(status);
        });
      }
      return compare(region,function(status){
        return status== vm.filterNum
      });
    }

    vm.statusRight=function(status){
      var show=[0,1,2,4,8,16];
      switch (role){
        case "zb":
          show=[0,1,2,8,16];
          break;
        case  "jl":
          show=[0,1,2,8,16];
          break;
        case  "jf":
          show=[0,1,2,4];
          break;
      }
      return show.indexOf(status)>-1;
    }

    //vm.go=function(item){
    //  if (item.InspectionId){
    //    $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId,
    //      acceptanceItemID:acceptanceItemID,acceptanceItemName:acceptanceItemName,projectId:projectId});
    //  }
    //}
  }
})();

/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  jlgxtestController.$inject = ["$scope"];
  angular
    .module('app.xhsc')
    .controller('jlgxtestController',jlgxtestController);

  /**@ngInject*/
  function jlgxtestController($scope){
    var vm = this;
    vm.showTop = function(){
      vm.show = true;
    }
  }
})();

/**
 * Created by emma on 2016/7/8.
 */
(function(){
  'use strict';

  gxzjcheckController.$inject = ["$state", "$stateParams", "remote", "$rootScope", "$q", "$scope", "utils", "api"];
  angular
    .module('app.xhsc')
    .controller('gxzjcheckController',gxzjcheckController);

  /**@ngInject*/
  function gxzjcheckController($state,$stateParams,remote,$rootScope,$q,$scope,utils,api ){
    var vm = this;
    vm.InspectionId = $stateParams.InspectionId;
    vm.acceptanceItemID = $stateParams.acceptanceItemID
    vm.acceptanceItemName = $stateParams.acceptanceItemName;
    vm.areaId = $stateParams.areaId;
    vm.projectId = $stateParams.projectId;
    //console.log('state',$stateParams)
    vm.info={
      current:null,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    }


    $rootScope.title = vm.acceptanceItemName;

    function initBtBatch(){

      function getRegionType(regionID){
        var  regionType;
        switch (regionID.length){
          case 5:
            regionType=1;
            break;
          case 10:
            regionType=2;
            break;
          case 15:
            regionType=4;
            break;
          case 20:
            regionType=8
            break;
          default:
            regionType=16
            break;
        }
        return regionType;
      }

      vm.btBatch=[];
      api.setNetwork(1).then(function(){
        $q.all([
          remote.Project.getInspectionList(vm.InspectionId),
          remote.Project.getInspectionList(vm.InspectionId,"Inspection_zj"),
        ]).then(function(res){

            var rtv=res[0].data.concat(res[1].data);
            var  r=rtv.find(function(o){
              return o.InspectionId==vm.InspectionId;
            });
            if (!r.Children){
              r.Children= r.AreaList;
            }
            if (r.Children&&angular.isArray(r.Children)){
              r.Children.forEach(function(tt){
                vm.btBatch.push(angular.extend({
                  RegionID:tt.AreaID,
                  RegionType:getRegionType( tt.AreaID)
                },tt));
              });
            }
            vm.info.selected = vm.btBatch[0];
            return vm.btBatch;
        })

        remote.Procedure.queryProcedure().then(function(result){
          vm.procedureData = [];
          result.data.forEach(function(it){
            it.SpecialtyChildren.forEach(function(t){
              var p = t.WPAcceptanceList.find(function(a){
                return a.AcceptanceItemID === vm.acceptanceItemID;
              })
              if(p){
                vm.procedureData.push(p);
              }
              vm.procedureData.forEach(function(t){
                t.SpecialtyChildren = t.ProblemClassifyList;
                t.ProblemClassifyList.forEach(function(_t){
                  _t.WPAcceptanceList = _t.ProblemLibraryList;
                  _t.SpecialtyName = _t.ProblemClassifyName;
                  _t.ProblemLibraryList.forEach(function(_tt){
                    _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
                  })
                })
              })
            })
          });
        })
      });
    }
    initBtBatch(); //获取一个批下面的所有区域


    vm.setRegion = function(region){
      vm.info.selected = region;
    }
    vm.nextRegion = function(prev){
      var idx = vm.btBatch.indexOf(vm.info.selected);
      if(idx != -1){
        if(prev){
          if(idx>0){
            vm.setRegion(vm.btBatch[idx-1]);
          }else{
            utils.alert('查无数据');
          }
        }else{
          if(idx<vm.btBatch.length-1){
            vm.setRegion(vm.btBatch[idx+1])
          }else{
            utils.alert('查无数据');
          }
        }
      }
    }

    vm.cancelCurrent = function ($event) {
      //$event.stopPropagation();
      //$event.preventDefault();
      vm.info.current = null;
    }
    vm.qyslide = function(){
      vm.qyslideShow = !vm.qyslideShow;
    }
    vm.selectQy = function(item){
      item.hasCheck=true;
      vm.info.selected = item;
      vm.qyslideShow = false;
      vm.setRegion(item);
    }

    var sendZjResult = $rootScope.$on('sendGxResult',function() {
      remote.Procedure.updataZjStatus(vm.InspectionId).then(function(r){
        if(!r.data.ErrorCode){
          utils.alert('保存成功',null,function(){
            $state.go("app.xhsc.gx.gxmain");
          });
        }
      })
    });

    $scope.$on("$destroy",function(){
      sendZjResult();
      sendZjResult = null;
    });

  }
})();

/**
 * Created by emma on 2016/7/30.
 */
(function() {
    'use strict';

    gxzgreportController.$inject = ["remote", "$stateParams", "$scope", "$timeout"];
    angular
        .module('app.xhsc')
        .controller('gxzgreportController', gxzgreportController);

    /**@ngInject*/
    function gxzgreportController(remote, $stateParams, $scope, $timeout) {
        var vm = this;
        vm.Inspection = $stateParams.InspectionId;
        vm.AcceptanceName = $stateParams.acceptanceItemName;
        vm.acceptanceItemId = $stateParams.acceptanceItemID;

        vm.Regions = [];
        vm.info = {

        }
        remote.Procedure.getZgReport(vm.Inspection).then(function(result) {
            console.log('r2', result)
            result.data.Areas && result.data.Areas.forEach(function(item) {
                vm.Regions.push({ AreaId: item.AreaId });
                item.Classification.forEach(function(_it) {
                    _it.rowspan = _it.Children.length;
                })
            })

            var pics = [];
            vm.pics = [];

            result.data.AcceptancePicture && result.data.AcceptancePicture.forEach(function(pic, index) {
                pic.index = index + 1;
                if (pics.length < 4) {
                    pics.push(pic)
                } else {
                    vm.pics.push(pics);
                    pics = [pic];
                }
            })
            vm.pics.push(pics)
            vm.pics.forEach(function(p) {
                while (p.length < 4) {
                    p.push({});
                }
            })
            vm.result = result.data;
        })
        $scope.$watch(function() {
            if (vm.Regions.length) {
                return vm.Regions;
            }
        }, function() {
            vm.Problems = [];
            vm.Regions.forEach(function(r) {
                var f = vm.result && vm.result.ProblemItem.find(function(t) {
                    return t.AreaID == r.AreaId;
                })
                if (f) {
                    r.Problems = f.Children;
                } else {

                }
            })
            vm.goback = function() {
                window.history.go(-1);
            }
        })

        vm.printBatchCount = function() {
            var $html = $("#divReport").clone(false);
            $html.find('table tr[name="tRow"]').remove();
            $('#export').val($html.html());
        }

    }
})();
/**
 * Created by emma on 2016/7/21.
 */
(function(){
  'use strict';

  gxzgdetailController.$inject = ["$scope", "$stateParams", "remote", "$q", "xhUtils", "utils", "$rootScope"];
  angular
    .module('app.xhsc')
    .controller('gxzgdetailController',gxzgdetailController);

  /**@ngInject*/
  function gxzgdetailController($scope,$stateParams,remote,$q,xhUtils,utils,$rootScope){
    var vm = this;
    vm.InspectionId = $stateParams.InspectionId;
    vm.projectId = $stateParams.projectId;
    vm.acceptanceItemID = $stateParams.acceptanceItemID;
    $rootScope.title = $stateParams.acceptanceItemName;
    vm.role = '';
    vm.info = {};
    function initBtBatch(){

      function getRegionType(regionID){
        var  regionType;
        switch (regionID.length){
          case 5:
            regionType=1;
            break;
          case 10:
            regionType=2;
            break;
          case 15:
            regionType=4;
            break;
          case 20:
            regionType=8
            break;
          default:
            regionType=16
            break;
        }
        return regionType;
      }
      var promises=[
        remote.Project.getInspectionList(vm.InspectionId)
      ];
      vm.btBatch=[];
      return $q.all(promises).then(function(rtv){
        vm.Inspection = rtv[0].data[0];
        vm.btBatch = vm.Inspection.Children;
        vm.current = vm.btBatch[0];
        //load();
        return vm.btBatch;
      })
    }
    initBtBatch(); //获取一个批下面的所有区域
    vm.qyslide = function(){
      vm.qyslideShow = !vm.qyslideShow;
    }
    vm.selectQy = function(item){
      vm.qyslideShow = false;
      vm.current = item;
      vm.setRegion(item);

    }

    vm.setRegion = function(region){
      vm.current = region;
      //load();
    }
    vm.nextRegion = function(prev){
      var idx = vm.btBatch.indexOf(vm.current);
      if(idx != -1){
        if(prev){
          if(idx>0){
            vm.setRegion(vm.btBatch[idx-1]);
          }else{
            utils.alert('查无数据');
          }
        }else{
          if(idx<vm.btBatch.length-1){
            vm.setRegion(vm.btBatch[idx+1])
          }else{
            utils.alert('查无数据');
          }
        }
      }
    }
    vm.showQuesList = function(){
      vm.showList = true;
    }

    function load(){
      remote.Procedure.InspectionCheckpoint.query(vm.acceptanceItemID,vm.current.AreaID,vm.InspectionId).then(function (r) {
        vm.pList = [];
        vm.templist = [];
        r.data.forEach(function(t){
          if(t.InspectionID == vm.InspectionId){
            vm.templist.push(t);
          }
        })
        vm.templist.forEach(function(_t){
          var find = vm.pList.find(function(p){
            return p.id == _t.IndexPointID;
          })
          if(!find){
            var f = {
              id:_t.IndexPointID,
              ProblemSortName:_t.ProblemSortName,
              ProblemDescription: _t.IndexPointID?_t.ProblemDescription:'合格',
              rows:[]
            };
            f.rows.push(_t)
            vm.pList.push(f)
          }else{
            find.rows.push(_t)
          }
        })
        console.log('find',vm.pList)
      });
    }
  }
})();

/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  gxzgController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('gxzgController',gxzgController);

  /** @ngInject */
  function gxzgController($state,$rootScope,$scope,$mdDialog,remote,$timeout,$q,utils,xhUtils,api){
    var vm = this;
    $rootScope.title = $state.params.Role == 'zb'?'整改':'复验';
      vm.ProjectID=$state.params.ProjectID;
      var InspectionID=$state.params.InspectionID;
      vm.AcceptanceItemID=$state.params.AcceptanceItemID;
      var RectificationID=$state.params.RectificationID;
      vm.AcceptanceItemName=$state.params.AcceptanceItemName?$state.params.AcceptanceItemName:"";
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;
    vm.RectificationID = $state.params.RectificationID;
    api.setNetwork(1).then(function(){
      remote.Procedure.getZGById(RectificationID).then(function (r) {
        console.log('r1',r)
        vm.Rectification = r.data[0];
        vm.pareaList = vm.Rectification.Children;
        vm.regionSelect = vm.pareaList[0];
        vm.warter=vm.regionSelect.RegionName+(vm.AcceptanceItemName?'('+vm.AcceptanceItemName+')':"");
        vm.regionSelect.hasCheck=true;
        load();
      });

      vm.info = {

      }

      function setChina(r) {
        switch (r) {
          case 0:
            return '合格';
            break;
          case 1:
            return '待验';
            break;
          case 2:
            return '合格';
            break;
          case 4:
            return '不合格';
            break;
          case 8:
            return '未整改';
            break;
          case 16:
            return '已整改';
            break;
        }
      }
      remote.Procedure.getRectification(RectificationID).then(function(r){
        vm.baseInfor = r.data;
        vm.baseInfor.zwStatus = setChina(r.data.Status);
      })
      function load(){

        if (!vm.regionSelect){
          return;
        }
        var promises=[
          remote.Procedure.getZGReginQues(vm.regionSelect.AreaID,RectificationID)/*,
           remote.Procedure.getZGReginQuesPoint(vm.regionSelect.AreaID,RectificationID)*/
        ]
        vm.ques=[];
        $q.all(promises).then(function(res){
          vm.items = res.data;
          res[0].data.forEach(function (item) {
            var fd = vm.ques.find(function (it) {
              return it.IndexPointID==item.IndexPointID;
            });
            if(!fd){
              fd = item;
              vm.ques.push(fd);
              fd.Points = 1;
            }
            else{
              fd.Points++;
            }
          })

        })
      }
      vm.showTop = function(){
        vm.slideShow = true;
      }
      vm.showQuesList = function(){
        vm.showUp = true;
      }
      vm.selectQy = function(item){
        vm.regionSelect = item;
        vm.regionSelect.hasCheck=true;
        vm.warter=vm.regionSelect.RegionName+(vm.AcceptanceItemName?'('+vm.AcceptanceItemName+')':"");
        vm.qyslideShow = false;
        //load();
      }
      vm.showBaseInfor = function(){
        $mdDialog.show({
          controller:['$scope',function($scope){
            $scope.baseInfo = vm.baseInfor;
            $scope.area = vm.regionSelect;
            $scope.submit = function(){
              $mdDialog.hide();
            }
          }],
          templateUrl:'app/main/xhsc/procedure/baseInforTemp.html',
          clickOutsideToClose:true
        })
      }

      vm.qyslide = function(){
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult',function(){
        var  msg=[];
        vm.pareaList.forEach(function(r){
          if (!r.hasCheck){
            msg.push(r.RegionName);
          }
        });
        if (msg.length){
          utils.alert(msg.join(",")+'尚未查看!');
          return;
        };
        $mdDialog.show({
          controller:['$scope',function($scope){
            $scope.InspectionID  = InspectionID;
            $scope.role = vm.role;
            $scope.remark = '备注';
            $scope.time= 24*7;
            $scope.times = xhUtils.zgDays();
            $scope.cancel = function(){
              $mdDialog.hide();
            }
            $scope.submit = function(){
              if(vm.role=='zb'){
                var data={
                  RectificationId:RectificationID,
                  Status:16
                }
                remote.Procedure.InspectionRectificationUpdateStatus(data).then(function (r) {
                  $mdDialog.hide();
                  utils.alert('提交成功',null,function(){
                    $state.go("app.xhsc.gx.gxmain");
                  });
                })
              }
              else{
                remote.Procedure.insertJlfy({RectificationID:RectificationID,Remarks:$scope.remark,Day:$scope.time}).then(function(r){
                  if (r.data.ErrorCode==0){
                    utils.alert("提交成功",null,function(){
                      vm.Isfail=false;
                      $mdDialog.hide();
                      $state.go("app.xhsc.gx.gxmain");
                    });
                  }
                  else{
                    utils.alert("失败",null,function(){
                      vm.Isfail=true;
                    });
                  }
                })
                //TODO:可能要生成新的整改单,或完成整改
              }
            }
            remote.Procedure.getZGReginQues(null,RectificationID).then(function (r) {
              $scope.status = [
                {status:1,name:'未整改',num:0,visible:1},
                {status:2,name:'合格',num:0,visible:vm.role=='jl'?1:0},
                {status:4,name:'不合格',num:0,visible:vm.role=='jl'?1:0},
                {status:8,name:'已整改',num:0,visible:vm.role=='zb'?1:0}];

              r.data.forEach(function (item) {
                var s = $scope.status.find(function (s1) {
                  return s1.status == item.Status;
                });
                if(s)s.num++;
              });

              if($scope.status[3].num>0 && vm.role=='jl') {
                utils.alert('还有 (' + $scope.status[3].num + '处) 未检查 ，不能提交');
              }
            })
          }],
          templateUrl:'app/main/xhsc/procedure/ngTemp.html',
          clickOutsideToClose:true
        })
      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })

      vm.nextRegion = function(prev){
        if (angular.isArray(vm.pareaList)&&vm.pareaList.length>0){
          var  index=vm.pareaList.indexOf(vm.regionSelect);
          if (prev){
            if ((index-1)>=0){
              vm.regionSelect=vm.pareaList[index-1];
              vm.regionSelect.hasCheck=true;
              //load();
              return;
            }
          }else {
            if ((index+1)<vm.pareaList.length){
              vm.regionSelect=vm.pareaList[index+1];
              vm.regionSelect.hasCheck=true;
              //load();
              return;
            }
          }
          utils.alert("查无数据!");
        }
      };
    });
  }
})();

/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  gxtestController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api"];
  angular
    .module('app.xhsc')
    .controller('gxtestController',gxtestController);

  /**@ngInject*/
  function gxtestController($scope,$stateParams,remote,xhUtils,$rootScope,$state,$q,utils,api){
    var vm = this;
    var acceptanceItemID = $stateParams.acceptanceItemID,
      acceptanceItemName =  $stateParams.acceptanceItemName,
      projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.InspectionId=$stateParams.InspectionId;

    vm.info = {
      current:null,
      projectId:projectId,
      acceptanceItemID:acceptanceItemID,
      regionId:areaId,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };

    vm.btBatch;

    api.setNetwork(1).then(function(){
      function initBtBatch(){

        function getRegionType(regionID){
          var  regionType;
          switch (regionID.length){
            case 5:
              regionType=1;
              break;
            case 10:
              regionType=2;
              break;
            case 15:
              regionType=4;
              break;
            case 20:
              regionType=8
              break;
            default:
              regionType=16
              break;
          }
          return regionType;
        }
        var promises=[
          remote.Project.getInspectionList(vm.InspectionId)
        ];
        vm.btBatch=[];
        return $q.all(promises).then(function(rtv){
          var  r=rtv[0].data.find(function(o){
            return o.InspectionId==vm.InspectionId;
          });
          if (angular.isArray(r.Children)){
            r.Children.forEach(function(tt){
              vm.btBatch.push(angular.extend({
                RegionID:tt.AreaID,
                RegionType:getRegionType( tt.AreaID)
              },tt));
            });
          }
          vm.selectQy(vm.btBatch[0]);
          return vm.btBatch;
        })
      }
      initBtBatch(); //获取一个批下面的所有区域
      vm.cancelCurrent = function ($event) {
        vm.info.current = null;
      }
      $rootScope.title = acceptanceItemName;


      vm.water="";
      vm.getWaterText=function(){
        if (vm.info.selected){
          return vm.info.selected.RegionName+'('+acceptanceItemName+')'
        }
        return "";
      }

      remote.Procedure.queryProcedure().then(function(result){
        vm.procedureData = [];
        result.data.forEach(function(it){
          it.SpecialtyChildren.forEach(function(t){
            var p = t.WPAcceptanceList.find(function(a){
              return a.AcceptanceItemID === acceptanceItemID;
            })
            if(p){
              vm.procedureData.push(p);
            }
            vm.procedureData.forEach(function(t){
              t.SpecialtyChildren = t.ProblemClassifyList;
              t.ProblemClassifyList.forEach(function(_t){
                _t.WPAcceptanceList = _t.ProblemLibraryList;
                _t.SpecialtyName = _t.ProblemClassifyName;
                _t.ProblemLibraryList.forEach(function(_tt){
                  _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
                })
              })
            })
          })
        });
        //console.log('vm',vm.procedureData)
      })
      vm.qyslide = function(){
        vm.qyslideShow = !vm.qyslideShow;
      }
      vm.selectQy = function(item){
        vm.info.selected = item;
        //vm.RegionName = item.RegionName;
        vm.qyslideShow = false;
        vm.setRegion(item);
      }

      var sendResult = $rootScope.$on('sendGxResult',function(){
        var  msg=[];
        vm.btBatch.forEach(function(r){
          if (!r.hasCheck){
            msg.push(r.RegionName);
          }
        });
        if (msg.length){
          utils.alert(msg.join(",")+'尚未验收查看!');
          return;
        };
        $state.go('app.xhsc.gx.gxalllist',{acceptanceItemName:acceptanceItemName,acceptanceItemID:acceptanceItemID,name:vm.RegionFullName,areaId:areaId,projectId:projectId,InspectionId:vm.InspectionId})
      })

      $scope.$on("$destroy",function(){
        sendResult();
        sendResult = null;
      });
      vm.setRegion = function(region){
        region.hasCheck=true;
        vm.info.selected = region;
        vm.water=vm.info.selected.RegionName+'('+acceptanceItemName+')';
      }
      vm.nextRegion = function(prev){
        var idx = vm.btBatch.indexOf(vm.info.selected);
        if(idx != -1){
          if(prev){
            if(idx>0){
              vm.setRegion(vm.btBatch[idx-1]);
            }else{
              utils.alert('查无数据');
            }
          }else{
            if(idx<vm.btBatch.length-1){
              vm.setRegion(vm.btBatch[idx+1])
            }else{
              utils.alert('查无数据');
            }
          }
        }
      }
    });
  }
})();

/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  gxrychooseController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.xhsc')
    .controller('gxrychooseController',gxrychooseController);

  /**@ngInject*/
  function gxrychooseController($scope,$stateParams,remote){
    var vm = this;
    //console.log('a',$stateParams)
    remote.Project.queryAllBulidings($stateParams.projectId).then(function (result) {
    })
    remote.Procedure.GetPermissionsByProjectId($stateParams.projectId).then(function(res){
      var personzbList = [],personjlList=[],persongcList=[];
      res.data.forEach(function(p){
        if(p.MemberType == 0){
          personzbList.push(p)
        }else if(p.MemberType == 2){
          personjlList.push(p);
        }else if(p.MemberType == 4){
          persongcList.push(p);
        }
      })
      vm.persons = [{
        type:0,
        unit:'总包',
        users:personzbList
      },{
        type:2,
        unit:'监理',
        users:personjlList
      },{
        type:4,
        unit:'项目部',
        users:persongcList
      }];
      vm.persons.forEach(function(p){
        p.users.forEach(function(u){
          u.checked = false;
        })
      })
      setUser();
    })

    function setUser(){
      vm.choosed = [];
      if($scope.$parent.vm.responsers){
        $scope.$parent.vm.responsers.forEach(function(_t){
          console.log('-t',_t)
          vm.persons && vm.persons.forEach(function(t){
            var f = t.users.find(function(u){
              return u.SupervisionHeadID === _t.SupervisionHeadID;
            })
            console.log('f',f)
            if(f){
              //console.log(f)
              f.checked = true;
              vm.choosed.push(f)
            }
          })

        })

      }
      vm.choosery(vm.persons[0])
    }


    vm.choosery = function(it){
      //vm.rylevels = null;
      vm.current = it;
      console.log(it)
      vm.persons.forEach(function(t){
        t.checked = false;
        t.users.forEach(function(_t){
         // _t.checked = false;
        })
      })
      it.checked = true;
      //vm.rylevels= it.users;

    }
    vm.choose = function(user){
      console.log(user);
      user.checked = !user.checked;
      if(user.checked){
        vm.choosed.push(user);
      }else{
        vm.choosed.forEach(function(t){
          if(t.SupervisionHeadID ==  user.SupervisionHeadID){
            var idx = vm.choosed.indexOf(user);
            console.log('idx',idx)
            if(idx !=-1){
              vm.choosed.splice(idx,1);
            }
            console.log('vnm',vm.choosed)
          }
        })
      }
    }
    vm.rydel = function(item){
      vm.choosed.forEach(function(t){
        if(t.SupervisionHeadID ==  item.SupervisionHeadID){
          t.checked = false;
          var idx = vm.choosed.indexOf(item);
          console.log('idx',idx)
          if(idx !=-1){
            vm.choosed.splice(idx,1);
          }
          console.log('vnm',vm.choosed)
        }
      })
    }
    $scope.$watch('vm.persons',function(){

    })


    //console.log($scope.$parent.vm.responsers)
    vm.userSubmit = function(user){
      history.go(-1);
      $scope.$parent.vm.responsers = user;
      //console.log($scope.$parent)
    }
  }
})();

/**
 * Created by emma on 2016/5/31.
 */
(function(){
  'use strict';

  gxresultController.$inject = ["$mdDialog", "$stateParams", "$state", "$scope", "remote", "utils", "xhUtils", "api", "$timeout"];
  angular
    .module('app.xhsc')
    .controller('gxresultController',gxresultController);

  /** @ngInject*/
  function gxresultController($mdDialog,$stateParams,$state,$scope,remote,utils,xhUtils,api,$timeout){
    var vm = this;
    vm.params = $stateParams;
    vm.gxname = $stateParams.acceptanceItemName;
    vm.bwname = $stateParams.name;
    var  InspectionId=$stateParams.InspectionId;

    vm.times = xhUtils.zgDays();
    api.setNetwork(1).then(function(){
      remote.Project.queryAllBulidings($stateParams.projectId).then(function(result){
        vm.allRelations = [];
        var areaId = $stateParams.areaId;
        var tmp=[];
        result.data[0].Sections.forEach(function(t){
          tmp= t.SectionRegionIDs.split(',');
          var  d;
          if (angular.isArray(tmp)){
            d= tmp.find(function(x){
              return areaId.indexOf(x)>-1;
            });
            if (d){
              vm.allRelations.push(t);
            }
          }
        })
      });
      vm.params={
        InspectionID:InspectionId,
        Remarks:"",
        Day:12
      }
      vm.Isfail=true;
      vm.submitResult = function(){
        vm.data ={
          InspectionID:vm.params.InspectionID,
          Remarks:vm.params.Remarks,
          Day:vm.time,
        }
        remote.Procedure.createZGReceipt(vm.data).then(function(r){
          $mdDialog.hide();
          if (r){
            utils.alert("提交成功",null,function(){
              $state.go("app.xhsc.gx.gxmain",{index:0});
            });
          }
        })

        // $mdDialog.show({
        //   controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
        //     vm.data ={
        //       InspectionID:vm.params.InspectionID,
        //       Remarks:vm.params.Remarks,
        //       Day:vm.time,
        //     }
        //     remote.Procedure.createZGReceipt(vm.data).then(function(r){
        //       $mdDialog.hide();
        //       if (r){
        //         $timeout(function () {
        //           utils.alert("提交成功",null,function(){
        //             $state.go("app.xhsc.gx.gxmain",{index:0});
        //           });
        //         },300);
        //       }
        //     },function(){
        //       $mdDialog.cancel();
        //     })
        //   }],
        //   template: '<md-dialog aria-label="正在提交"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在上传提交数据.....,</p></md-dialog-content></md-dialog>',
        //   parent: angular.element(document.body),
        //   clickOutsideToClose:false,
        //   fullscreen: false
        // });
      }
    });
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  gxmainController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "xhscService", "$mdDialog", "db", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('gxmainController', gxmainController);

  /**@ngInject*/
  function gxmainController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope,xhscService, $mdDialog, db, $mdBottomSheet) {
    var vm = this;
    var dbpics = db('pics')
    vm.procedure = [];
    //所有全局任务
    var globalTask = [
      function () {
        return remote.Procedure.queryProcedure().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        })
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID) {
      var projectId = regionID.substr(0, 5);
      function  filter(item) {
        return (!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
          (!areas || areas.find(function (a) {
            return a.AreaID == item.RegionId;
          })) && vm.procedure.find(function (k) {
            return k.AcceptanceItemID == item.AcceptanceItemID;
          })
      }
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID,null,filter).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }

    function InspectionTask(item) {
      var t = [function () {
        return remote.Project.getInspectionList(item.InspectionId);
      }];
      item.Children.forEach(function (area) {
        t.push(function (tasks, down) {
          return remote.Procedure.InspectionCheckpoint.query(item.AcceptanceItemID, area.AreaID, item.InspectionId).then(function (result) {
            result.data.forEach(function (p) {
              tasks.push(function () {
                return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                  result.data.forEach(function (r) {
                    tasks.push(function () {
                      return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                      })
                    })
                  })
                })
              });
            });
          })
        });
        t.push(function () {
          return remote.Procedure.InspectionIndexJoinApi.query(item.InspectionId)
        })
        t.push(function () {
          return remote.Procedure.InspectionPoint.query(item.InspectionId, item.AcceptanceItemID, area.AreaID)
        })

      });
      return t;
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.Procedure.getZGById(item.RectificationID).then(function (r) {
            r.data[0].Children.forEach(function (area) {
              tasks.push(function () {
                return remote.Procedure.getZGReginQues(area.AreaID, item.RectificationID);
              });
              tasks.push(function () {
                return remote.Procedure.getZGReginQuesPoint(area.AreaID, item.RectificationID);
              })
            })
          });
        },
        function () {
          return remote.Procedure.getRectification(item.RectificationID);
        }
      ]
    }


    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var projectId  =item.Children.length?item.Children[0].AreaID.substr(0,5):item.ProjectID;
              var t=[];
              if (!item.Children){
                t=t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID)) ;
              }else {
                item.Children.forEach(function (o) {
                  t=t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(function () {
                  return remote.Project.queryAllBulidings(projectId);
                })
                .concat(InspectionTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'ys' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionId == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var projectId  =item.Children.length?item.Children[0].AreaID.substr(0,5):item.ProjectID;
              var t=[];
              if (!item.Children){
                t=t.concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID)) ;
              }else {
                item.Children.forEach(function (o) {
                  t=t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              }
              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(function () {
                  return remote.Project.queryAllBulidings(projectId);
                })
                .concat(InspectionTask(item))
                .concat(rectificationTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'zg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                remote.offline.create({Id: 'zg' + item.RectificationID});
                //RectificationID
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }

    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.RectificationID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);

    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;

            api.upload(function (cfg, item) {
              if (cfg._id == 's_files' && item && item.Url.indexOf('base64') == -1) {
                return false;
              }
              if (cfg._id == "s_offline") {
                return false;
              }
              return true;
            }, function (percent, current, total) {
              vm.uploadInfo.percent = parseInt(percent * 100) + ' %';
              vm.uploadInfo.current = current;
              vm.uploadInfo.total = total;
            }, function (tasks) {
              vm.uploadInfo.uploaded = 1;
              api.uploadTask(function () {
                return true
              }, null);
              $mdDialog.hide();
              //db("s_offline").destroy();
              utils.alert('上传成功');
              load();
              remote.offline.query().then(function(m){
                if(angular.isArray(m.data)){
                  m.data.forEach(function(n){
                    if(n.Id&&(n.Id.indexOf("ys")>-1||n.Id.indexOf("zg")>-1)){
                      remote.offline.delete({Id:n.Id});
                    }
                  });
                }
              });
              vm.uploadInfo.tasks = [];
              vm.uploadInfo.uploading = false;
            }, function (timeout) {
              $mdDialog.hide();
              var msg = '上传失败,请检查网络!'
              if (timeout) {
                msg = '请求超时,请检查网络!';
              }
              utils.alert(msg);
              vm.uploadInfo.uploaded = 0;
              vm.uploadInfo.uploading = false;
            }, {
              uploaded: function (cfg, row, result) {
                if (cfg.db && cfg.db.delete)
                  cfg.db.delete(row._id);
                else
                  cfg._db.delete(row._id);
              }
            });
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-diameter="28" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }



    xhscService.getProfile().then(function(profile){
      vm.role=profile.role;
      vm.OUType=profile.ouType;
    });


    function load() {
      $q.all([
        remote.Procedure.getZGlist(23).then(function (r) {
          return $q(function (resolve, reject) {
            vm.zglist = [];
            if (r.data&& angular.isArray(r.data.data)) {
              var zg = [];
              r.data.data.forEach(function (o) {
                zg.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  zg.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "zg" + k.RectificationID;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.zglist = zg;
                // 值不存在提示
                resolve();
              }).catch(function () {
                resolve();
              });
            }
            else {
              resolve();
            }
          })

        }),
        remote.Procedure.getInspections(1).then(function (r) {
          $q(function (resolve, reject) {
            vm.Inspections = [];
            if (r.data&& angular.isArray(r.data.data)) {
              var ys = [];
              r.data.data.forEach(function (o) {
                ys.push(o);
              });
              remote.offline.query().then(function (r) {
                if (angular.isArray(r.data)) {
                  ys.forEach(function (k) {
                    if (r.data.find(function (m) {
                        return m.Id == "ys" + k.InspectionId;
                      })) {
                      k.isOffline = true;
                    }
                  })
                }
                vm.Inspections = ys;
                if (vm.yw == 16 && !vm.Inspections.length) {
                  utils.alert("暂时没有找到数据");
                }
                resolve();
              }).catch(function () {
                resolve();
              });
            } else {
              resolve();
            }
          });
        })
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })

    vm.setModule = function (val) {
      $state.go('app.xhsc.gx.yw', {yw: val})
    }
    vm.goSelf = function () {
      $state.go('app.xhsc.gx.selfMain')
    }


    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxtest', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.Children[0].newName,
              projectId: item.ProjectID,
              areaId: item.Children[0].AreaID,
              InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxtest', {
            acceptanceItemID: item.AcceptanceItemID,
            acceptanceItemName: item.AcceptanceItemName,
            name: item.Children[0].newName,
            projectId: item.ProjectID,
            areaId: item.Children[0].AreaID,
            InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'zb',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', {
            Role: 'zb',
            InspectionID: item.InspectionId,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID,
            AcceptanceItemName: item.AcceptanceItemName
          });
        });
      }
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'jl',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', {
            Role: 'jl',
            InspectionID: item.InspectionId,
            AcceptanceItemID: item.AcceptanceItemID,
            RectificationID: item.RectificationID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

  }
})();

/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  gxlistController.$inject = ["$scope", "remote", "$stateParams", "$state"];
  angular
    .module('app.xhsc')
    .controller('gxlistController',gxlistController);

  /**@ngInject*/
  function gxlistController($scope,remote,$stateParams,$state){
    var vm=this;
    vm.projectId = $stateParams.projectId;
    vm.role=$stateParams.role;

    remote.Procedure.queryProcedure().then(function(result){
      vm.data=result.data;
      vm.data.sort(function(a,b){
         return a.SpecialtyName.localeCompare(b.SpecialtyName);
      });
      vm.show=true;
    })
    vm.showTab=function(item){
      if (!item.SpecialtyChildren||!item.SpecialtyChildren.length){
        return false;
      }
      var gx= item.SpecialtyChildren;
      for (var  i=0;i<gx.length;i++){
        if (gx[i].WPAcceptanceList&&gx[i].WPAcceptanceList.length){
          return true;
        }
      }
      return false;
    }


    vm.choosego = function(i){
      var applicableArea= i.ApplicableArea;
      var area=-1;
      if (applicableArea){
         var arr=applicableArea.split(",");
          var t;
          arr.forEach(function(k){
              t=parseInt(k);
              if (area<t){
                area=t;
              }
          })

      }
      if(!vm.role){
        $state.go('app.xhsc.gx.zjhouseChoose',{role:vm.role,acceptanceItemID:i.AcceptanceItemID,projectId:vm.projectId,acceptanceItemName:i.AcceptanceItemName,maxRegion:area})
      }else{
        if (vm.role=='regionState'){
          $state.go('app.xhsc.gx.regionStates',{acceptanceItemID:i.AcceptanceItemID,projectId:vm.projectId,acceptanceItemName:i.AcceptanceItemName,maxRegion:area});
          return;
        }
        $state.go('app.xhsc.gx.gxhousechoose',{role:vm.role,acceptanceItemID:i.AcceptanceItemID,projectId:vm.projectId,acceptanceItemName:i.AcceptanceItemName,maxRegion:area})
      }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  gxhousechooseController.$inject = ["$scope", "$stateParams", "db", "$rootScope", "xhUtils", "remote", "$timeout", "$q", "$state", "$mdDialog", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('gxhousechooseController',gxhousechooseController);

  /** @ngInject */
  function gxhousechooseController($scope,$stateParams,db,$rootScope,xhUtils,remote,$timeout,$q,$state,$mdDialog,utils,api,xhscService){
    var vm=this,
      areaId = $stateParams.projectId,
      projectId = areaId.substr(0,5),
      acceptanceItemID=$stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName,
      role=$stateParams.role;
      ;
      vm.maxRegion = $stateParams.maxRegion;

    $rootScope.title = $stateParams.acceptanceItemName;
    if(role == "zb"){
      $rootScope.sendBt = true;
    }
    vm.building=[];
    function  load(){
      vm.nums={
        qb:0, //全部
        wtj:0,//未提交
        dy:0,//待验收
        hg:0, //合格
        bhg:0,//不合格
        yzg:0,//已整改
        wzg:0//未整改
      }
      function  setNum(status,region){
        function  addNum(status){
          vm.nums.qb++;
          switch (status){
            case  0:
              vm.nums.wtj++;
              break;
            case  1:
              vm.nums.dy++;
              break;
            case  2:
              vm.nums.hg++;
              break;
            case  4:
              vm.nums.bhg++;
              break;
            case  8:
              vm.nums.wzg++;
              break;
            case  16:
              vm.nums.yzg++;
              break;
          }
        }
        if (vm.maxRegion==8){
            if (region.RegionType==8&&region.hasShowRight){
              addNum(status);
            }
        }else {
          if (region.RegionType>=8&&region.hasShowRight){
            addNum(status);
          }
        }
      }
      //状态设置与用户区域权限
      function filterOrSetting(status,region){
        var st=status.find(function(o){
          return o.AreaId.indexOf(region.RegionID)!=-1;
        });
        if (st){
          region.hasShowRight=true;
        }
        if (region.RegionType>4){
          statusSetting(status,region);
        }
      }

      var st2 =[];
      function setInspection(region){
        if(region.inspectionRows.length){
          var _100=region.inspectionRows.find(function (k) {
             return k.Percentage>=100;
          });
          if (_100){
            region.single=true;
            region.status =  [_100.Status];
            region.Percentage=100;
            region.style=ConvertClass(_100.Status);
            setNum(_100.Status,region)
          }else {
            region.status = [];
            var percentage=0;
            region.style="dy";
            region.inspectionRows.forEach(function(t){
              percentage += t.Percentage;
              t.style=ConvertClass(t.Status);
              region.status.push(t.Status);
              setNum(t.Status,region)
            })

            region.inspectionRows.forEach(function(t){
              t.Percentage=percentage*(t.Percentage/percentage);
            })
          }
        }else{
          region.single=true;
          region.status =  [0];
          region.Percentage=0;
          region.style=ConvertClass(0);
          setNum(0,region)
        }

      }
      //状态设置
      function statusSetting(status,region){
        if(!angular.isArray(status)){
          status=[status];
        }
        var st1 = [];
        region.inspectionRows=[];
        status.forEach(function(t){
          if(t.AcceptanceItemID==acceptanceItemID && t.AreaId == region.RegionID){
            if (!region.inspectionRows.find(function (k) {
                k.InspectionId==t.InspectionId;
              })){
              region.inspectionRows.push(t);
            }
          }
        })
        setInspection(region);
      }
      function ConvertClass(status){
        var style;
        switch (status){
          case 0:
            style="wait";
            break;
          case 1:
            style="dy";
            break;
          case 2:
            style="pass";
            break;
          case 4:
            style="ng";
            break;
          case 8:
            style="ng";
            break;
          case 16:
            style="yzg";
            break;
          default:
            break;
        }
        return style;
      }
      return $q.all([
        xhscService.getRegionTreesOnline(projectId,31,1),
        remote.Procedure.getRegionStatus(projectId)
      ]).then(function(res){
        vm.loading = true;
        var result= res[0][0];
        var status=res[1]&&res[1].data?res[1].data:[];
        result.Children.forEach(function(d){
          if (d.RegionID==areaId){
            d.selected=true;
            filterOrSetting(status,d);
            d.projectTree =  result.RegionName;
            d.projectTitle = result.RegionName + d.RegionName;
            d.Children && d.Children.forEach(function(c){
              c.floors=[];
              filterOrSetting(status,c)
              c.projectTree = d.projectTree + c.RegionName;
              c.checked = false;
              vm.building.push(c);
              c.Children && c.Children.forEach(function(r){
                r.projectTree = c.projectTree + r.RegionName;
                r.checked = false;
                filterOrSetting(status,r);
                vm.floors=vm.floors?vm.floors:[];
                vm.floors.push(r);
                if (! r.Children||!r.Children.length){
                  c.floors.push(r);
                }
                r.Children && r.Children.forEach(function(_r){
                  _r.projectTree = r.projectTree + _r.RegionName;
                  _r.checked = false;
                  filterOrSetting(status,_r);
                })
              })
            })
          }
        })
        vm.houses =  result.Children;
        return vm.houses;
      });
    }

    load();

    vm.callBack=function(){
      utils.alert('报验成功',null,function(){
        $state.go("app.xhsc.gx.gxmain");
      })
    };
    vm.selected = function(r){
      if (r.inspectionRows&&r.inspectionRows.length){
        var percentage=0;
        r.inspectionRows.forEach(function(t){
          percentage += t.Percentage;
        })
        if (percentage<100){
          r.checked = !r.checked;
        }
      }else {
        if (r.status.indexOf(0)>-1){
          r.checked = !r.checked;
        }
      }
    }


    vm.zk = function(item){
      item.show = !item.show;
    }
    vm.filterNum = -1;
    vm.filter = function(num){
      vm.filterNum = num;
    }

    function compare(region,operator){
      if (region.Children){
        for (var  i=0;i<region.Children.length;i++){
          if (vm.regionfilterByStatus(region.Children[i])){
              return true;
          }
        }
        return  operator(region.status);
      }else {
        return  operator(region.status);
      }
    }

    vm.regionfilterByStatus=function(region){
       if (vm.filterNum==-1){
           return compare(region,function(status){
              return vm.statusRight(status);
           });
       }
       return compare(region,function(status){
         return status== vm.filterNum
       });
    }

    vm.statusRight=function(status){
      var show=[0,1,2,4,8,16];
      switch (role){
        case "zb":
          show=[0,1,2,8,16];
          break;
        case  "jl":
          show=[0,1,2,8,16];
          break;
        case  "jf":
          show=[0,1,2,4];
          break;
      }
      if (angular.isArray(status)){
          for (var i=0;i<status.length;i++){
            if ( show.indexOf(status[i])>-1){
                return true;
            }
          }
          return false;
      }else {
        return show.indexOf(status)>-1;
      }
    }

    var sendgxResult =$rootScope.$on('sendGxResult',function(){
      vm.data = {
        projectId:projectId,
        Rows:[],
        Sign:1,
        acceptanceItemName:acceptanceItemName,
        acceptanceItemID:acceptanceItemID
      }

      vm.houses.forEach(function(t){
        if (!t.Children){
          t.Children=[];
        }
        t.Children.forEach(function(_t){
          if(_t.checked){
            vm.data.Rows.push(_t);
          }
          _t.Children && _t.Children.forEach(function(_tt){
            if(_tt.checked){
              vm.data.Rows.push(_tt);
            }
            _tt.Children && _tt.Children.forEach(function(l){
              if(l.checked){
                vm.data.Rows.push(l)
              }
            })
          })
        })
      })
      if(vm.data.Rows.length){
        vm.showmyDialog = true;
      }else{
        utils.alert('请选择区域');
      }
    });
    $scope.$on("$destroy",function(){
      //$mdDialog
      sendgxResult();
      sendgxResult=null;
    });
  }
})();

/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  gxfyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "$stateParams", "remote", "$q", "utils", "xhUtils"];
  angular
    .module('app.xhsc')
    .controller('gxfyController',gxfyController);

  /** @ngInject */
  function gxfyController($state,$rootScope,$scope,$mdDialog,$stateParams,remote,$q,utils,xhUtils){
    var vm = this;
    vm.ProjectID=$state.params.ProjectID;
    var InspectionID=$state.params.InspectionID;
    vm.AcceptanceItemID=$state.params.AcceptanceItemID;
    var RectificationID=$state.params.RectificationID;
      vm.role = 'fy';

    remote.Procedure.getRegionByInspectionID(InspectionID).then(function(r){
      vm.pareaList = r.data;
      if (angular.isArray(vm.pareaList)&&vm.pareaList.length){
        vm.regionSelect= r.data[0];
        load();
      }
    });

    function setChina(r) {
      switch (r) {
        case 0:
          return '合格';
          break;
        case 1:
          return '未整改';
          break;
      }
    }
    remote.Procedure.getRectification(RectificationID).then(function(r){
      vm.baseInfor = r.data;
      console.log('base',r)
      vm.baseInfor.zwStatus = setChina(r.data.Status);
    })
    function load(){

      if (!vm.regionSelect){
        return;
      }
      var promises=[
        remote.Procedure.getReginQues(vm.regionSelect.AreaID,vm.AcceptanceItemID),
        remote.Procedure.getPoints(vm.regionSelect.AreaID,vm.AcceptanceItemID)
      ]
      vm.ques=[];
      $q.all(promises).then(function(res){
        var ques=res[0].data;
        vm.points=res[1].data;
        if (ques&&ques.length){
          ques.forEach(function(t){
            if (vm.points&&vm.points.length){
              vm.points.forEach(function(m){
                if (t.IndexPointID== m.IndexPointID){
                  if (!t.points){
                    t.points=[];
                  }
                  t.points.push(m);
                }
              });
            }
            vm.ques.push(t);
          });
        }
        console.log(vm.ques);
      })
    }
    vm.showTop = function(){
      vm.slideShow = true;
    }
    vm.selectQy = function(item){
      vm.regionSelect = item;
      vm.qyslideShow = false;
      load();
    }
    vm.showBaseInfor = function(){
      $mdDialog.show({
        controller:['$scope',function($scope){
          $scope.baseInfo = vm.baseInfor;
          $scope.area = vm.regionSelect;
          $scope.submit = function(){
            $mdDialog.hide();
          }
        }],
        templateUrl:'app/main/xhsc/procedure/baseInforTemp.html',
        clickOutsideToClose:true
      })
    }

    vm.qyslide = function(){
      vm.qyslideShow = !vm.qyslideShow;
    }

    var gxfyChanged = $rootScope.$on('sendGxResult',function(){
      $mdDialog.show({
        controller:['$scope',function($scope){
          $scope.times = xhUtils.zgDays();
          $scope.submit = function(){
            $mdDialog.hide();
          }
        }],
        templateUrl:'app/main/xhsc/procedure/ngTemp.html',
        clickOutsideClose:true
      })
    });


    $scope.$on('$destroy', function () {
      gxfyChanged();
      gxfyChanged = null;
    })

    vm.nextRegion = function(prev){
      if (angular.isArray(vm.pareaList)&&vm.pareaList.length>0){
        var  index=vm.pareaList.indexOf(vm.regionSelect);
        if (prev){
          if ((index-1)>=0){
            vm.regionSelect=vm.pareaList[index-1];
            load();
            return;
          }
        }else {
          if ((index+1)<vm.pareaList.length){
            vm.regionSelect=vm.pareaList[index+1];
            load();
            return;
          }
        }
        utils.alert("查无数据!");
      }
    };
  }
})();

/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  gxdetailController.$inject = ["$scope", "$stateParams", "remote", "$q", "xhUtils", "utils"];
  angular
    .module('app.xhsc')
    .controller('gxdetailController',gxdetailController);

  /**@ngInject*/
  function gxdetailController($scope,$stateParams,remote,$q,xhUtils,utils){
    var vm = this,
      acceptanceItemName = $stateParams.acceptanceItemName,
      areaId = $stateParams.areaId;
      vm.projectId = $stateParams.projectId;
      vm.acceptanceItemID = $stateParams.acceptanceItemID;
    vm.InspectionId = $stateParams.InspectionId;
    console.log('state',$stateParams)
    function initBtBatch(){

      function getRegionType(regionID){
        var  regionType;
        switch (regionID.length){
          case 5:
            regionType=1;
            break;
          case 10:
            regionType=2;
            break;
          case 15:
            regionType=4;
            break;
          case 20:
            regionType=8
            break;
          default:
            regionType=16
            break;
        }
        return regionType;
      }
      var promises=[
        remote.Project.getInspectionList(vm.InspectionId)
      ];
      vm.btBatch=[];
      return $q.all(promises).then(function(rtv){
        vm.Inspection = rtv[0].data[0];
        vm.btBatch = vm.Inspection.Children;
        vm.current = vm.btBatch[0];
        //load();
        return vm.btBatch;
      })
    }
    initBtBatch(); //获取一个批下面的所有区域
    vm.qyslide = function(){
      vm.qyslideShow = !vm.qyslideShow;
    }
    vm.selectQy = function(item){
      vm.qyslideShow = false;
      vm.current = item;
      vm.setRegion(item);

    }

    vm.setRegion = function(region){
      vm.current = region;
      //load();
    }
    vm.nextRegion = function(prev){
      var idx = vm.btBatch.indexOf(vm.current);
      if(idx != -1){
        if(prev){
          if(idx>0){
            vm.setRegion(vm.btBatch[idx-1]);
          }else{
            utils.alert('查无数据');
          }
        }else{
          if(idx<vm.btBatch.length-1){
            vm.setRegion(vm.btBatch[idx+1])
          }else{
            utils.alert('查无数据');
          }
        }
      }
    }

    vm.showQuesList = function(){
      vm.showList = true;
    }

    function load(){
      remote.Procedure.InspectionCheckpoint.query(vm.acceptanceItemID,vm.current.AreaID,vm.InspectionId).then(function (r) {
        vm.pList = [];
        vm.templist = [];
        r.data.forEach(function(t){
          if(t.InspectionID == vm.InspectionId){
            vm.templist.push(t);
          }
        })
        vm.templist.forEach(function(_t){
          var find = vm.pList.find(function(p){
            return p.id == _t.IndexPointID;
          })
          if(!find){
            var f = {
              id:_t.IndexPointID,
              ProblemSortName:_t.ProblemSortName,
              ProblemDescription: _t.IndexPointID?_t.ProblemDescription:'合格',
              rows:[]
            };
            f.rows.push(_t)
            vm.pList.push(f)
          }else{
            find.rows.push(_t)
          }
        })
        console.log('find',vm.pList)
      });
    }

  }
})();

/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  gxbdchooseController.$inject = ["db", "remote", "localPack", "xhUtils", "$rootScope", "$scope", "pack", "utils", "stzlServices", "$stateParams"];
  angular
    .module('app.xhsc')
    .controller('gxbdchooseController',gxbdchooseController);

  /**@ngInject*/
  function gxbdchooseController(db,remote,localPack,xhUtils,$rootScope,$scope,pack,utils,stzlServices,$stateParams){
    var vm = this;
    vm.projectId = $stateParams.projectId;
    remote.Project.queryAllBulidings(vm.projectId).then(function(result){
      var mainTitle = result.data.ProjectName;
      result.data[0].Sections.forEach(function(t){
        t.title = (mainTitle||'') + t.SectionName;
      })
      vm.sections = result.data.Sections;
    })
    var xcpk = db('xcpk');
    xcpk.get('xcpk').then(function (result) {
      vm.data = result;
      queryOnline();
    }).catch(function (err) {
      vm.data = {
        _id:'xcpk',
        rows:[]
      };
      queryOnline();
    });
    vm.download = function (item) {
      item.progress = 0;
      item.pack = pack.sc.down(item);
      $rootScope.$on('pack'+item.AssessmentID,function (e,d) {
        //console.log(arguments);
        if(!item.pack)return;
        var p = item.pack.getProgress();
        item.progress = parseInt(p.progress);
        if(item.pack && item.pack.completed){
          var ix = vm.onlines.indexOf(item);
          if(ix!=-1)
            vm.onlines.splice(ix,1);
          ix = vm.offlines.indexOf(item);
          if(ix==-1) {
            vm.offlines.push(item);
            delete item.pack;
            vm.data.rows.push(item);
            xcpk.addOrUpdate(vm.data);
          }
        }
        // console.log('getProgress',  item.progress);

      })
    }
    vm.upload =function (item) {
      var pk = pack.sc.up(item.AssessmentID);
      pk.upload(function (proc) {
        item.progress = proc;
        if(proc==-1) {
          item.completed = pk.completed;
          if(item.completed)
            remote.Assessment.sumReportTotal(item.AssessmentID).then(function(){
              xcpk.addOrUpdate(vm.data);
            })
          else {
            utils.tips('同步未完成');
          }
        }
      });
    }
    vm.delete = function(item,ev){
      utils.confirm('确认删除?',ev,'','').then(function(){
        pack.sc.remove(item.AssessmentID,function () {
          var idx = vm.data.rows.indexOf(item);
          vm.data.rows.splice(idx, 1);
          idx = vm.offlines.indexOf(item);
          vm.offlines.splice(idx, 1);
          xcpk.addOrUpdate(vm.data);
          queryOnline();
        })
      })
    }
    function queryOnline() {
      vm.onlines = [];
      vm.offlines = [];
      vm.data.rows.forEach(function (m) {
        m.progress = 0;
        vm.offlines.push(m);
      });
      remote.Assessment.query().then(function (result) {
        result.data.forEach(function (m) {
          var fd = vm.data.rows.find(function (a) {
            return a.AssessmentID==m.AssessmentID;
          });
          if(fd){

          }
          else{
            vm.onlines.push(m);
          }
        })
      }).catch(function () {

      });
    }
  }
})();

/**
 * Created by emma on 2016/8/1.
 */
(function(){
  'use strict';

  gxalllistController.$inject = ["remote", "$stateParams", "$scope", "$q", "$rootScope", "$state", "api"];
  angular
    .module('app.xhsc')
    .controller('gxalllistController',gxalllistController);

  /**@ngInject*/
  function gxalllistController(remote,$stateParams,$scope,$q,$rootScope,$state,api){
    var vm = this;
    var acceptanceItemID = $stateParams.acceptanceItemID,
      acceptanceItemName = $stateParams.acceptanceItemName,
      projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.inspectionId = $stateParams.InspectionId;
    $rootScope.title = $stateParams.acceptanceItemName;
    api.setNetwork(1).then(function(){
      function load(){
        vm.procedureData.forEach(function(t){
          t.ProblemClassifyList.forEach(function(_t){
            _t.ProblemLibraryList.forEach(function(_tt){
              _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
              var f = vm.allProblems && vm.allProblems.find(function(_f){
                  return _f.ProblemID == _tt.ProblemID && _f.AreaID == vm.current.AreaID;
                })
              if(f){
                _tt.checked = false;
              }else{
                _tt.checked = true;
              }
              _tt.show = true;
            })
          })
        })
      }
      var promise=[
        remote.Procedure.InspectionIndexJoinApi.query(vm.inspectionId),
        remote.Procedure.queryProcedure()
      ];
      $q.all(promise).then(function(rs){
        vm.procedureData = [];
        vm.allProblems=rs[0] && rs[0].data;
        var basePdata = rs[1].data;
        //console.log('p',allProblems)
        basePdata.forEach(function(it){
          it.SpecialtyChildren.forEach(function(t){
            var p = t.WPAcceptanceList.find(function(a){
              return a.AcceptanceItemID === acceptanceItemID;
            })
            if(p){
              vm.procedureData.push(p);
            }
            load();
          })
        });

      })
      vm.current = [];
      vm.btBatch=[];
      vm.qyslide = function(){
        vm.qyslideShow = !vm.qyslideShow;
      }
      vm.selectQy = function(item){
        vm.current= item;
        //vm.RegionName = item.RegionName;
        vm.qyslideShow = false;
        //vm.setRegion(item);
        load();
        console.log(item)
      }
      remote.Project.getInspectionList(vm.inspectionId).then(function(rtv){
        var  r=rtv.data.find(function(o){
          return o.InspectionId==vm.inspectionId;
        });
        if (angular.isArray(r.Children)){
          r.Children.forEach(function(tt){
            vm.btBatch.push(angular.extend({
              RegionID:tt.AreaID,
              //RegionType:getRegionType( tt.AreaID)
            },tt));
          });
        }
        vm.current = r.Children[0];
      })
      $scope.$watch('vm.current',function(){
        remote.Procedure.InspectionCheckpoint.query(acceptanceItemID,vm.current.AreaID,vm.inspectionId).then(function (r) {
          vm.pList = [];
          vm.templist = [];
          r.data.forEach(function(t){
            if(t.InspectionID == vm.inspectionId){
              vm.templist.push(t);
            }
          })
          vm.templist.forEach(function(_t){
            var find = vm.pList.find(function(p){
              return p.id == _t.IndexPointID;
            })
            if(!find){
              var f = {
                id:_t.IndexPointID,
                ProblemSortName:_t.ProblemSortName,
                ProblemDescription: _t.IndexPointID?_t.ProblemDescription:'合格',
                rows:[]
              };
              f.rows.push(_t)
              vm.pList.push(f)
            }else{
              find.rows.push(_t)
            }
          })
          $scope.$watch('vm.procedureData',function(){
            vm.procedureData && vm.procedureData.forEach(function(t){
              t.ProblemClassifyList.forEach(function(_t){
                _t.ProblemLibraryList.forEach(function(_tt){
                  var ff = vm.pList.find(function(r){
                    return r.id == _tt.ProblemID;
                  })
                  if(ff){
                    _tt.show = false;
                  }
                })
              })
            })
            console.log(vm.procedureData)
          })

        });
      })
      vm.checkedOrnot = function(it){
        it.checked = !it.checked;
        //console.log(it)
        var v={
          InspectionID:vm.inspectionId,
          ProblemID:it.ProblemID,
          AreaID:vm.current.AreaID
        }
        remote.Procedure.InspectionIndexJoinApi.create(v);
      }
      var sendaResult = $rootScope.$on('sendGxResult',function(){
        $state.go('app.xhsc.gx.gxresult',{acceptanceItemName:acceptanceItemName,acceptanceItemID:acceptanceItemID,name:vm.RegionFullName,areaId:areaId,projectId:projectId,InspectionId:vm.inspectionId});
      })

      $scope.$on("$destroy",function(){
        sendaResult();
        sendaResult = null;
      });
    });
  }
})();

/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  fgxtestController.$inject = ["$scope"];
  angular
    .module('app.xhsc')
    .controller('fgxtestController',fgxtestController);

  /**@ngInject*/
  function fgxtestController($scope){
    var vm = this;
  }

})();

/**
 * Created by lss on 2016/5/3.
 */
(function(){
  'use strict';

  offlineController.$inject = ["$scope", "remote", "xhUtils", "$stateParams", "utils", "$mdDialog", "$state", "$rootScope", "db"];
  angular
    .module('app.xhsc')
    .controller('offlineController',offlineController)
  /** @ngInject */
  function offlineController($scope,remote,xhUtils,$stateParams,utils,$mdDialog,$state,$rootScope,db) {
    var vm = this;
    var areID="0000700000";
    var r = db("db_"+areID,{auto_compaction:true});
    vm.download= function(){
      r.deleteAll().then(function(data){
        //加载区域项
        remote.region.query(areID).then(function(result){
          var retVal = result.data;
          if (!angular.isArray(retVal)){
            retVal=[retVal];
          }
          retVal.forEach(function(o){
            o.id="region_"+o.RegionID;
            o.tate="加载中...";
          })
          $scope.regions=retVal;
          r.create(retVal).then(function(data){
            retVal.forEach(function(o){
              o.tate="完成";
            });
          });
        })
        //加载实测项
        remote.Measure.query(areID).then(function(result){
          var retVal = result.data;
          if (!angular.isArray(retVal)){
            retVal=[retVal];
          }
          retVal.forEach(function(o){
            o.id="accItem_"+o.AcceptanceItemID;
            o.state="加载中...";
          });
          $scope.AcceptanceItems=retVal;
          r.create(retVal).then(function(data){
            retVal.forEach(function(o){
              o.state="完成";
            });
          });
        })
        //加载指标项
        remote.Measure.MeasureIndex.query().then(function(result){
          var retVal = result.data;
          if (!angular.isArray(retVal)){
            retVal=[retVal];
          }
          retVal.forEach(function(o){
            o.id="accIndex_"+o.AcceptanceIndexID;
            o.state="加载中...";
          })
          $scope.AcceptanceIndexs=retVal;
          r.create(retVal).then(function(data){
            retVal.forEach(function(o){
              o.state="完成";
            })
          });
        })
      });
    }
  }
})();

/**
 * Created by emma on 2016/3/31.
 */
(function(){
  homeMap.$inject = ["$timeout", "mapPopupSerivce"];
  angular
    .module('app.xhsc')
    .directive('homeMap',homeMap);

  /** @Inject */
  function homeMap($timeout,mapPopupSerivce){
    return {
      link:link
    }

    function  link(scope,element,attr,ctrl){
      $timeout(function(){

        var options = {
          onUpdate:function(layer,isNew){
            if(isNew && layer instanceof L.Stamp){
              var i=0;
              this.eachLayer(function(layer){
                if(layer instanceof L.Stamp){
                  i++;
                }
              });
              layer.updateValue({
                seq:i
              });
            }
            console.log('update',layer.toGeoJSON());
          }
        },project = new L.SXT.Project(element[0],{
          map:{
            map:{}
          },
          tileLayers:{
            base: {
              url: 'http://vkde.sxtsoft.com/upload/hx_tile_{z}_{x}_{y}.png'
            }
          },
          featureGroups:{
            sc:{
              options:options,
              toolbar:{
                group:{
                  //areaGroup:false
                }
              }
            }
          }
        });
        project._map.openPopup(mapPopupSerivce.get('p3').el[0],[0.3,0.2],{
          maxWidth:300
        })
        //var draggable = new L.Draggable("<div>aaaaa</div>");
        //draggable.enable();
      },2000);
    }
  }
})();

/**
 * Created by shaoshunliu on 2016/11/20.
 */
(function () {
  'use strict';

  applicationController.$inject = ["$scope", "remote", "$timeout", "$q", "xhscService", "$state"];
  angular
    .module('app.xhsc')
    .controller('applicationController', applicationController);

  /** @ngInject */
  function applicationController($scope, remote, $timeout, $q, xhscService,$state) {
    var vm = this
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      // vm.OUType = profile.ouType;
      vm.loaded = true;
      vm.duties=profile.duties||[];

      //memberType[0:总包,2:监理,4:项目部,8:工程管理部|公司,16:星河集团|工程管理中心,32:分包]
      var ignore = vm.role == "8" || vm.role == "16";
      vm.yw=[
        {
          type:"zl",
          name:"质量",
          items:[
            {
              right: vm.duties.indexOf("1")>-1||ignore,
              type:"zl",
              title: "实测实量",
              img: "app/main/xhsc/images/application/scsl.svg",
              state: "app.xhsc.scsl.scslmain",
              stateParams: null
            }, {
              right: vm.duties.indexOf("2")>-1||ignore,
              type:"zl",
              title: "工序验收",
              img: "app/main/xhsc/images/application/gxys.svg",
              state: "app.xhsc.gx.gxmain",
              stateParams: null
            },
            {
              right: vm.duties.indexOf("2")>-1||ignore,
              title: "日常巡检",
              type:"zl",
              img: "app/main/xhsc/images/application/cycke.svg",
              state: "app.xhsc.xj.main",
              stateParams: null
            },
            {
              right: vm.role == "16",
              title: "现场评估",
              type:"zl",
              img: "app/main/xhsc/images/application/xcpg.svg",
              state: "app.xhsc.download",
              stateParams: null
            },
            {
              right:vm.duties.indexOf("6")>-1||ignore,
              title: "移动验房",
              type:"zl",
              img: "app/main/xhsc/images/application/yf.svg",
              state: "app.xhsc.yf.Main",
              stateParams: null
            },
            {
              right:vm.duties.indexOf("4")>-1||ignore,
              title: "材料验收",
              type:"zl",
              img: "app/main/xhsc/images/application/material.svg",
              state: "app.xhsc.materialys.materialdownload",
              stateParams: null
            }
          ]
        },
        {
          type:"aq",
          name:"安全",
          items:[
            {
              right: vm.duties.indexOf("5")>-1&&vm.role=="0",
              type:"aq",
              title: "安全自检",
              img: "app/main/xhsc/images/application/dyn.svg",
              state: "app.xhsc.sf.selfMain",
              stateParams: null
            },
            {
              right: vm.duties.indexOf("5")>-1||ignore,
              type:"aq",
              title: "安全验收",
              img: "app/main/xhsc/images/application/weekys.svg",
              state: "app.xhsc.sf.sfmain",
              stateParams: null
            },
            {
              right: vm.duties.indexOf("5")>-1||ignore,
              title: "周安全检查",
              type:"aq",
              img: "app/main/xhsc/images/application/weekjc.svg",
              state: "app.xhsc.week.sfWeekMain",
              stateParams: null
            }
          ]
        },{
          type:"jh",
          name:"计划",
          items:[
            {
              right:vm.duties.indexOf("7")>-1||ignore,
              title: "计划管理",
              type:"jh",
              img: "app/main/xhsc/images/application/plan.svg",
              state: "app.plan.personplan",
              stateParams: null
            }
          ]
        }
      ]
      vm.show=function (item) {
        return item.items.length&&item.items.some(function (k) {
            return k.right
          });
      }

      vm.click=function (item) {
        $state.go(item.state);
      }

    })
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function ()
{
  'use strict';

  HomeController.$inject = ["$scope", "auth", "$state", "$rootScope", "$timeout", "utils", "remote", "api", "versionUpdate", "delopy"];
  angular
    .module('app.xhsc')
    .controller('HomeController', HomeController);

  /** @ngInject */
  function HomeController($scope,auth,$state,$rootScope,$timeout, utils,remote,api,versionUpdate,delopy)
  {
    // versionUpdate.check();
    var vm = this;
    delopy.update(function (self,r0,version,isIntall) {
      if (isIntall)
        return utils.confirm('发现新版本：' + r0 + '，是否更新？')
      else {
        return utils.confirm('版本已经更新完毕，是否重新启动?')
      }
    });

    api.setNetwork(0).then(function(){
      remote.profile()
      vm.data = {};
      vm.is = function (state) {
        return vm.includes(state);
      }
      vm.markerClick = markerClick;
      vm.querySearch = function(text){
        var k=[];
        if(vm.markers){
          vm.markers.forEach(function(item){
            var py=window.Pinyin.getPinyinArrayFirst(item.title)
            py=py.join("");
            if(!text || text=='' || item.title.indexOf(text)!=-1||py.toLowerCase().indexOf(text.toLowerCase())>-1){
              k.push(item);
            }
          })
        }
        return k;
      }
      vm.changeItem = function(item){
        $timeout(function(){
          $state.go('app.progress',{projectId:item.projectId, projectName: item.title});
        },200)

      }
      function markerClick($current){
        //$state.go('app.xhsc.xxjd.xxjdmain',{projectId:$current.projectId, projectName:$current.title});
        $state.go('app.progress',{projectId:$current.projectId, projectName:$current.title});
      }
    })
  }
})();

/**
 * Created by jiuyuong on 2016/4/3.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .controller('DemoController',DemoController);

  /** @ngInject */
  function DemoController(){

  }

})();

/**
 * Created by shaoshun on 2016/11/25.
 */
/**
 * Created by shaoshunliu on 2016/11/17.
 */
/**
 * Created by jiuyuong on 2016/11/8.
 */
(function(angular){
  'use strict';

  angular
    .module('app.xhsc')
    .filter('zgFilter',zgFilter);

  function zgFilter(){
    return function(items,Status) {
      if (!items||!items.length){
        return;
      }
      if (!angular.isArray(Status)){
        return items;
      }
      return items.filter(function (t) {
         return Status.some(function (k) {
           return k==t.Status;
         })
      });
    }
  }

})(angular);

/**
 * Created by shaoshunliu on 2016/11/17.
 */
/**
 * Created by jiuyuong on 2016/11/8.
 */
(function(angular){
  'use strict';

  angular
    .module('app.xhsc')
    .filter('scPointFilter',scPointFilter);

  function scPointFilter(){
    return function(items,role) {
      if (!items||!items.length||items.length<index){
        return;
      }
      return [items[index]];
    }
  }

})(angular);

/**
 * Created by emma on 2016/6/20.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .directive('windowHeight',windowHeight);
  /**@ngInject*/
  function windowHeight(){
    return {
      link:link
    }

    function link(scope,element,attr,ctrl){
      var winh= $(window).height();
      var iToolbar = 44;
      var itbar = 44;
      var resize = function(){
        //var winh= $(window).height();
        //var iToolbar = $('#toptoolbar').height();
        //var itbar = $('#toolbar2').height();
        console.log(iToolbar,itbar)
        $(element).css({'height':(winh-iToolbar-itbar-6)+'px','overflow':'hidden'})
      }
      resize();
      $(window).resize(function(){
        resize();
      })
    }
  }
})();

/**
 * Created by emma on 2016/7/27.
 */
(function(){
  'use strict';

  tableAutoHeight.$inject = ["$timeout"];
  angular
    .module('app.xhsc')
    .directive('tableAutoHeight',tableAutoHeight);

  /**@ngInject*/
  function tableAutoHeight($timeout){
    return {
      link:link
    }

    function link(scope,element,attr,ctrl){
      var h;
      scope.$watch(function(){
        return h;
      },function(){
        $(element).css('height',h+12+'px');
        $(element).parent().siblings().find('table').css('height',h+12+'px');
      })
      $timeout(function(){
        h= $(element).parent().parent().parent('tbody').height();
        //console.log('h',h)
      },400);


    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtZgMapCheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtZgMapCheck',sxtZgMapCheck);
  /** @ngInject */
  function sxtZgMapCheck($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtZgMapCheck',
        sxtMapShow:'=',
        items:'=',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              remote.Procedure.InspectionCheckpoint.query(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                remote.Procedure.InspectionPoint.query(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                  fg.data = r.data,fs=[];
                  r.data.forEach(function (c) {
                    var p = r1.data.find(function (p1) {
                      return p1.MeasurePointID == c.PositionID;
                    });
                    if (p && p) {
                      if(p.Geometry){
                        p.geometry = $window.JSON.parse(p.Geometry);
                      }else{
                        p.geometry = p.geometry;
                      }
                      if(!p.geometry)return;
                      c.ProblemDescription= c.IndexPointID?c.ProblemDescription:'合格';
                      p.geometry.properties.seq = c.ProblemSortName;
                      p.geometry.properties.v = c;
                      if(p.geometry.geometry.type == 'Stamp')
                        p.geometry.geometry.type = 'Point';
                      p.geometry.properties.Status = c.Status;
                      fs.push(p.geometry);
                    }
                  });
                  scope.item = null;
                  fg.addData(fs,false);
                  cb();
                  scope.ct && (scope.ct.loading = false);
                })
              });
            },
            onUpdate: function (layer, isNew, group,cb) {

            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('mapRecheckMapPopup');
              if (edit) {
                scope.sxtMapShow = true;
                edit.scope.context = fg;
                edit.scope.data = {
                  item:scope.item,
                  procedure:scope.procedure,
                  regionId:scope.regionId,
                  value: layer.properties.v
                }
                edit.scope.apply && edit.scope.apply();
              }
            }
          });
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID==item.DrawingID
                        })){
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                })
              }
              else{
                if(!result.data.DrawingContent){
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  sxtStamp.$inject = ["mapPopupSerivce"];
  angular
    .module('app.xhsc')
    .directive('sxtStamp',sxtStamp);

  /** @Inject */
  function sxtStamp(mapPopupSerivce){
    return {
      restrict:'E',
      scope:{
      },
      templateUrl:'app/main/xhsc/directive/sxtStamp.html',
      link:link
    }
    function  link(scope,element,attr,ctrl){
      scope.removeLayer = function(){
        var layer = scope.context.layer;
        layer._fg.removeLayer(layer);
      }
      scope.cancelEdit = function(){
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      }

      mapPopupSerivce.set('Stamp',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('Stamp');
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/7/20.
 */
(function () {
  'use strict';

  sxtShowMap.$inject = ["remote", "$window"];
  angular
    .module('app.xhsc')
    .directive('sxtShowMap',sxtShowMap);
  /** @ngInject */
  function sxtShowMap(remote,$window) {
    return {
      restrict: 'A',
      scope: {
        imageId: '=sxtShowMap',
        ct:'='
      },
      link: function (scope, element) {
        scope.ct && (scope.ct.loading = true);
        var map;
        scope.$watch('imageId', function () {
          if (scope.imageId) {
            if (map)
              map.remove();
            remote.Project.getDrawing(scope.imageId).then(function (result2) {
              if (!result2.data.DrawingContent) {
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(2)');
                return;
              }
              map = new $window.L.glProject(element[0]);
              map.loadSvgXml(result2.data.DrawingContent);
              scope.ct && (scope.ct.loading = false);
            });
          }
        })
      }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtSelfcheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtSelfcheckPopup',sxtSelfcheckPopup);
  /** @ngInject */
  function sxtSelfcheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils) {
    return {
      restrict: 'E',
      scope: {
        slideShow: '=',
        slideRole: '=',
        slideId:'=',
        slideInspection:'=',
        slideContext:'='
      },
      templateUrl: 'app/main/xhsc/directive/sxtSelfcheckPopup.html',
      link: link
    }
    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        console.log('role',scope)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        remote.Procedure.InspectionProblemRecord.query(scope.slideId).then(function(r){
          scope.data = r.data;
          r.data.forEach(function (p) {
            remote.Procedure.InspectionProblemRecordFile.query(p.ProblemRecordID).then(function (r2) {
              p.images = r2.data;
            });
          });
          scope.ZjRecord = {
            zj:r.data.find(function (p) {
              return p.DescRole=='zj'
            })
          };
          scope.zjStatus = scope.ZjRecord.zj.Status;
        })
      }
      scope.$watch('slideId',function(){
        if(!scope.slideId) return;
        scope.apply();
      })
      scope.cancel = function(){
        scope.slideShow = false;
        scope.ZjRecord.zj.Status = scope.zjStatus;
      }
      scope.submit = function(){
       // scope.data[0].Status = scope.data[0].Status==2?2:4;

        scope.zjStatus = scope.ZjRecord.zj.Status = scope.ZjRecord.zj.Status == 2?2:4
        var params={
          CheckpointID:scope.slideId,
          Status:scope.data.Status
        }
        remote.Procedure.updataZjPoint({CheckpointID:scope.slideId,Status:scope.ZjRecord.zj.Status}).then(function (r) {
          if(r.data.ErrorCode == 0){
            scope.slideShow = false;
            scope.slideContext.fg.updateStatus(scope.slideContext.layer.properties.$id,scope.ZjRecord.zj.Status);

            //scope.slideContext.layer.redraw();
          }
        });
      }
      scope.$on('$destroy',function(){
        $(element).remove();
      });
    }
  }
  })();

/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function () {
  'use strict';

  sxtScNew.$inject = ["$timeout", "mapPopupSerivce", "db", "sxt", "xhUtils", "scPack", "remote", "utils", "$q", "api", "$rootScope"];
  angular
    .module('app.xhsc')
    .directive('sxtScNew', sxtScNew);

  /** @Inject */
  function sxtScNew($timeout, mapPopupSerivce, db, sxt, xhUtils, scPack, remote, utils, $q, api, $rootScope) {
    var pack = scPack;

    function now() {
      return new Date().toISOString();
    }

    return {
      scope: {
        db: '=', //现场评估id
        areaId: '=', //分期
        acceptanceItem: '=',//实测项
        measureIndexes: '=', //实测指标
        imageUrl: '=',//图纸id
        regionId: '=',//区域
        regionName: '=',//区域名称
        regionType: '=',//区域类型
        readonly: '=',//只读
        tooltip: '='
      },
      link: link
    }

    function link(scope, element, attr, ctrl) {
      var map, tile, fg, toolbar, data, points, pk, scStandar;
      var parentIds = {};//标准批后,用于存放区域测量的父ID
      if (!pk)
        pk = pack.sc.up(scope.db);
      if (!data)
        data = pk.sc.db;
      if (!points)
        points = pk.point.db;

      var install = function () {

        if (!scope.db || !scope.regionId || !scope.measureIndexes || !scope.measureIndexes.length)return;
        if (!map) {
          map = new L.SXT.Project(element[0]);
        }
        if (fg)
          map._map.removeLayer(fg);
        if (toolbar)
          map._map.removeControl(toolbar);
        var ProjectID = scope.regionId.substr(0, 5);
        var areaId = scope.regionId.substr(0, 10);
        var arr = [
          remote.Project.getDrawingRelations(areaId, "scDrawingRelation")
        ];
        parentIds = {};//重置为空
        $q.all(arr).then(function (res) {
          var picRelate = res[0]
          //渲染图纸
          function findImg(source) {
            var result = source;
            var img = result.data.find(function (item) {
              return item.AcceptanceItemID == scope.acceptanceItem && item.RegionId == scope.regionId;
            });
            if (!img) {
              img = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.acceptanceItem && scope.regionId.indexOf(item.RegionId) > -1;
              });
            }
            if (!img) {
              var img = result.data.find(function (item) {
                return item.RegionId == scope.regionId;
              });
            }
            return img;
          }
          var img = findImg(picRelate);
          function loadPic(img) {
            if (!tile || tile != scope.regionId) {
              $timeout(function () {
                if (img) {
                  remote.Project.getDrawing(img.DrawingID).then(function (result2) {
                    if (!result2.data || !result2.data.DrawingContent) {
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent, {
                      filterLine: function (line) {
                        line.attrs.stroke = 'black';
                        line.options = line.options || {};
                        //line.options.color = 'black';

                        line.attrs['stroke-width'] = line.attrs['stroke-width'] * 6;
                      }
                    });
                    map.center();
                    scope.tooltip = '';
                  })
                }
                else {
                  if (!result.data.DrawingContent) {
                    utils.alert('未找到图纸,请与管理员联系!(1)');
                    scope.ct && (scope.ct.loading = false);
                  }
                }
              },300);
            }
            tile = scope.regionId;
          }
          //渲染几何点
          function historydata(layer, index) {
            var layer = layer;
            if (layer.loaded)return;
            layer.loaded = true;

            var reqArr = [
              remote.PQMeasureStandard.GetListByExtend(areaId.substr(0, 5), "standard"),
              data.findAll()
            ]
            $q.all(reqArr).then(function (req) {
              var t = req[0].data && req[0].data.data ? req[0].data.data : [];
              var points = [];
              var msg = [];
              scope.measureIndexes.forEach(function (o) {
                if (!t.find(function (k) {
                    return (o.AcceptanceIndexID == k.AcceptanceIndexID||o.Children.find(function (e) {
                        return e.AcceptanceIndexID==k.AcceptanceIndexID;
                      })) && k.DrawingID == img.DrawingID
                      && k.Status == 1;
                  })) {
                  msg.push(o.IndexName)
                }
              });
              if (msg.length) {
                $timeout(function () {
                  utils.alert("指标：" + msg.join(",") + "尚未标准化，请先做标准化处理!");
                })
                return;
              }


              loadPic(img);
              var u = req[1].rows;

              var po;

              function addData(layData, index, color) {
                if (!layData.geometry && layData.Geometry) {
                  layData.geometry = JSON.parse(layData.Geometry);
                }

                if (!layData.geometry) return;
                layData.geometry.options.color = color;
                layData.geometry.options.fill = true;
                layData.geometry.options.v = index;
                layData.geometry.options.seq = layData.geometry.properties.seq;
                layData.geometry.options.customSeq = true;
                layData.geometry.options.move = false;
                layData.CreateTime = moment(layData.CreateTime).toDate();
                layer.addData(layData.geometry);
              }
              function find(index,source) {
                if (source){
                  if (source.find(function (n) {
                      return n.AcceptanceIndexID==index.AcceptanceIndexID;
                    })){
                    return true;
                  }else {
                    for (var i=0;i<source.length;i++){
                      if (find(index,source[i].Children)){
                        return true;
                      }
                    }
                    return false;
                  }
                }else {
                  return false;
                }
              }
              if (t && t.length) {
                var g;
                t.forEach(function (m) {
                  if (m.DrawingID == img.DrawingID &&find(m,scope.measureIndexes)&&!points.find(function (n) {
                    return n.MeasurePointID==m.MeasurePointID;
                  })) {
                    points.push(m);
                    var values = u.filter(function (v) {
                      return v.MeasureValue && m.MeasurePointID == v.MeasurePointID && v.CheckRegionID == scope.regionId &&
                        scope.measureIndexes.find(function (n) {
                          return n.AcceptanceIndexID == v.AcceptanceIndexID
                        })
                    });
                    var color = values.length == scope.measureIndexes.length ? 'blue' : 'red';
                    addData(m, index, color);
                    index++;
                  }
                });
              }
            });
          }

          function currentdata(layer, index) {
            var _r = function (o) {  //过滤值
              if (o.AcceptanceItemID == scope.acceptanceItem && scope.measureIndexes.length
                && !!scope.measureIndexes.find(function (m) {
                  return m.AcceptanceIndexID == o.AcceptanceIndexID
                    || (m.Children && m.Children.find(function (m1) {
                      return m1.AcceptanceIndexID == o.AcceptanceIndexID
                    }));
                })) {
                if (o.CheckRegionID == scope.regionId) {
                  return true;
                }
              }
              return false;
            }
            data.findAll(function (o) {
              return _r(o);
            }).then(function (r) {
              points.findAll(function (o) {
                return r.rows.find(function (i) {
                    if (i.MeasurePointID == o._id || i.MeasurePointID == o.MeasurePointID) {
                      if (r.rows.find(function (i) {
                          return ((i.MeasurePointID == o._id || i.MeasurePointID == o.MeasurePointID) && i.MeasureValue || i.MeasureValue === 0)
                        })) {
                        o.geometry.options.color = 'blue';
                      }
                      else {
                        o.geometry.options.color = 'red';
                      }
                      o.geometry.options.v = index;
                      o.geometry.options.seq = o.geometry.properties.seq;
                      o.geometry.options.customSeq = true;
                      o.CreateTime = moment(o.CreateTime).toDate();
                      index++;
                      return true;
                    }
                    return false;
                  }) != null;
              }).then(function (p) {
                fg.data = r.rows.filter(function (row) {
                  return row.CheckRegionID == scope.regionId;
                });
                p.rows.sort(function (p1, p2) {
                  return p1.CreateTime.getTime() - p2.CreateTime.getTime();
                });
                p.rows.forEach(function (geo) {
                  layer.addData(geo.geometry);
                });
              })
            }).catch(function (r) {
            });
          }

          fg = new L.SvFeatureGroup({
            onLoad: function () {
              var index = 0;
              historydata(this, index);
              currentdata(this, index);
            },
            onUpdate: function (layer, isNew, group) {
              //这里是修正用户点的位置,尽可能在最近点的同一水平或竖直线上
              if (layer instanceof L.Stamp) {
                var neaser = null,
                  p0 = layer.getLatLng();
                layer._fg.eachLayer(function (ly) {
                  if (ly != layer && ly instanceof L.Stamp) {
                    if (!neaser ||
                      Math.pow(neaser._latlng.lat - p0.lat, 2) + Math.pow(neaser._latlng.lng - p0.lng, 2) >
                      Math.pow(ly._latlng.lat - p0.lat, 2) + Math.pow(ly._latlng.lat - p0.lat, 2)) {
                      neaser = ly;
                    }
                  }
                });
                if (neaser) {
                  var p1 = neaser.getLatLng(),
                    point0 = neaser._map.latLngToLayerPoint(p0),
                    point1 = neaser._map.latLngToLayerPoint(p1),
                    radius = neaser._radius,
                    dx = Math.abs(point0.x - point1.x),
                    dy = Math.abs(point0.y - point1.y),
                    min = Math.min(dx, dy);
                  if (min < radius) {
                    if (dx < dy) {
                      p0.lng = p1.lng;
                    }
                    else {
                      p0.lat = p1.lat;
                    }
                    layer.setLatLng(p0);
                  }
                }
              }
              var point = layer.toGeoJSON();
              point = {
                _id: point.properties.$id,
                geometry: point
              };
              // points.addOrUpdate(point);
              if (isNew || !fg.data.find(function (d) {
                  return d.MeasurePointID == point._id;
                })) {
                scope.measureIndexes.forEach(function (m) {
                  var ms = [];
                  if (m.Children && m.Children.length) {
                    m.Children.forEach(function (m1) {
                      ms.push(m1);
                    });
                  }
                  else {
                    ms.push(m);
                  }
                  ms.forEach(function (m) {
                    var v = {
                      _id: sxt.uuid(),
                      RecordType: 1,
                      CreateTime: now(),
                      RelationID: scope.db,
                      MeasurePointID: point._id,
                      DrawingID: scope.imageUrl,
                      CheckRegionID: scope.regionId,
                      RegionType: scope.regionType,
                      AcceptanceItemID: scope.acceptanceItem,
                      AcceptanceIndexID: m.AcceptanceIndexID
                    };
                    v.MeasureValueId = v._id;
                    data.addOrUpdate(v);
                    fg.data = fg.data ? fg.data : [];
                    fg.data.push(v);
                    //实测标准化
                  });
                })
              }

              if (group) {
                var groupId = group.getValue().$id,//添加或移出的groupId
                  measureIndexs = xhUtils.findAll(scope.measureIndexes, function (m) {
                    return m.QSKey == '4';
                  }),//需要区测量的指标
                  values = xhUtils.findAll(fg.data, function (d) {
                    return d.MeasurePointID == point._id && !!measureIndexs.find(function (m) {
                        return m.AcceptanceIndexID == d.AcceptanceIndexID;
                      });
                  });//相关操作记录值
                if (!point.geometry.properties.$groupId) {//清除groupId
                  values.forEach(function (v) {
                    v.ParentMeasureValueID = null;
                    data.addOrUpdate(v);
                  })
                }
                else {//添加或更改groupId
                  values.forEach(function (v) {
                    var parent = fg.data.find(function (m) {
                      return m.AcceptanceIndexID == v.AcceptanceIndexID && m.MeasurePointID == groupId;
                    });
                    v.ParentMeasureValueID = parent._id;
                    data.addOrUpdate(v);
                  });
                }
              }
              //如果是画区域,而区域内没有点的话,默认生成9点或5个点
              if (isNew && layer instanceof L.AreaGroup) {
                var p = null, b = layer.getBounds();
                fg.eachLayer(function (ly) {
                  if (p === null && ly instanceof L.Stamp) {
                    if (L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat, ly._latlng.lat)
                      && L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng, ly._latlng.lng)) {
                      p = ly;
                    }
                  }
                });
                if (p == null) {
                  var b = layer.getBounds(),
                    x1 = b._northEast.lat,
                    y1 = b._northEast.lng,
                    x2 = b._southWest.lat,
                    y2 = b._southWest.lng;
                  var ps = [], ps1 = [];
                  var offsetX = Math.abs(x2 - x1) / 8,
                    minX = Math.min(x2, x1),
                    offsetY = Math.abs(y2 - y1) / 8,
                    minY = Math.min(y2, y2);
                  for (var i = 1; i <= 3; i++) {
                    for (var j = 1; j <= 3; j++) {
                      ps.push([minX + offsetX * (i == 1 ? 1 : i == 2 ? 4 : 7), minY + offsetY * (j == 1 ? 1 : j == 2 ? 4 : 7)]);
                    }
                  }
                  ps1[0] = ps[0];
                  ps1[1] = ps[1];
                  ps1[2] = ps[2];
                  ps1[3] = ps[5];
                  ps1[4] = ps[8];
                  ps1[5] = ps[7];
                  ps1[6] = ps[6];
                  ps1[7] = ps[3];
                  ps1[8] = ps[4];
                  if (!scope.measureIndexes.find(function (m) {
                      return m.QSKey == '4' && m.QSOtherValue == '9'
                    }) && scope.measureIndexes.find(function (m) {
                      return m.QSKey == '4' && m.QSOtherValue == '5';
                    })) {
                    ps1.splice(7, 1);
                    ps1.splice(5, 1);
                    ps1.splice(3, 1);
                    ps1.splice(1, 1);
                  }
                  ps1.forEach(function (p) {
                    fg.addLayer(new L.Stamp(p), false);
                  });
                }
              }

            },
            onPopupClose: function (e) {
              var self = this;
              var edit = mapPopupSerivce.get('mapPopup'),
                scope = edit.scope;
              if (scope.data && scope.isSaveData !== false) {
                scope.isSaveData = false;
                self.options.onUpdateData(scope.context, scope.data.updates, scope);
                if (scope.data.updates.find(function (m) {
                    return m.v && (m.v.MeasureValue || m.v.MeasureValue === 0);
                  })) {
                  scope.context.layer.setStyle({
                    color: 'blue'
                  });
                }
                else {
                  scope.context.layer.setStyle({
                    color: 'red'
                  });
                }
              }
            },
            onUpdateData: function (context, updates, editScope) {
              //如果有
              updates.forEach(function (m) {
                if (!m.v)return;
                var pid;
                if(editScope.context.layer._value.$groupId) {
                  var pidKey = m.m.AcceptanceIndexID + editScope.context.layer._value.$groupId;
                  pid = parentIds[pidKey];
                  if(!pid) {
                    var p1 = fg.data.find(function (t) {
                      return t.MeasurePointID == editScope.context.layer._value.$groupId
                        && t.AcceptanceIndexID == m.m.AcceptanceIndexID;
                    });
                    if (p1)
                      pid = parentIds[pidKey] = p1._id;
                  }
                  if(!pid){ //如果原来有值,使用原来的值,原来没有,生成新的parentId,不能用$groupId,因为它是模板化,会很多

                    pid = parentIds[pidKey] = m.v.ParentMeasureValueID ||sxt.uuid();
                    p1 = fg.data.find(function (t) {
                      return t._id == pid;
                    });
                    if(!p1) {
                      var pt = {
                        _id: pid,
                        MeasureValueId: pid,
                        CreateTime: now(),
                        RelationID: scope.db,
                        RecordType: 1,
                        DrawingID: scope.imageUrl,
                        MeasurePointID: editScope.context.layer._value.$groupId,
                        CheckRegionID: scope.regionId,
                        RegionType: scope.regionType,
                        AcceptanceItemID: scope.acceptanceItem,
                        AcceptanceIndexID: m.m.AcceptanceIndexID
                      };
                      fg.data.push(pt);
                      data.addOrUpdate(pt);//添加组的值
                    }
                  }
                }
                if (!m.v._id) {
                  m.v = angular.extend({
                    _id: sxt.uuid(),
                    CreateTime: now(),
                    RelationID: scope.db,
                    RecordType: 1,
                    DrawingID: scope.imageUrl,
                    MeasurePointID: editScope.context.layer._value.$id,
                    CheckRegionID: scope.regionId,
                    RegionType: scope.regionType,
                    AcceptanceItemID: scope.acceptanceItem,
                    AcceptanceIndexID: m.m.AcceptanceIndexID,
                    ParentMeasureValueID:pid
                  }, m.v);
                  m.v.MeasureValueId = m.v._id;
                  fg.data.push(m.v);
                }
                if (m.v.values) {
                  var minV = 1000000, maxV = -1000000, vs = [];
                  for (var k in m.v.values) {
                    var v = m.v.values[k];
                    if (m.v.values.hasOwnProperty(k) && v) {
                      minV = Math.min(minV, v);
                      maxV = Math.max(maxV, v);
                      vs.push(v);
                    }
                  }
                  ;
                  m.v.CreateTime = now();
                  m.v.MeasureValue = maxV;
                  m.v.DesignValue = minV;
                  m.v.ExtendedField1 = vs.join(',');
                }
                data.addOrUpdate(m.v);
              });
            },
            onDelete: function (layer) {
              var id = layer.getValue().$id,
                values = xhUtils.findAll(fg.data, function (d) {
                  return d.MeasurePointID == id && !!scope.measureIndexes.find(function (m) {
                      return m.AcceptanceIndexID == d.AcceptanceIndexID;
                    });
                });
              points.delete(id);
              values.forEach(function (v) {
                data.delete(v._id);
              })
            },
            onPopup: function (e) {
              if (e.layer instanceof L.Stamp
                || e.layer instanceof L.AreaGroup
                || e.layer instanceof L.LineGroup)
                var edit = mapPopupSerivce.get('mapPopup');
              if (edit) {
                if (e.layer instanceof L.Stamp) {
                  $timeout(function () {
                    var center = fg._map.getCenter();
                    fg._map.setView([center.lat, e.layer._latlng.lng]);
                  }, 300);
                }
                ;
                edit.scope.context = e;

                edit.scope.data = {
                  measureIndexes: scope.measureIndexes,
                  regionId: scope.regionId,
                  regionType: scope.regionType,
                  acceptanceItem: scope.acceptanceItem,
                  values: fg.data ? fg.data : []
                };

                edit.scope.readonly = scope.readonly;
                edit.scope.apply && edit.scope.apply();
                return edit.el[0];
              }
            }
          }).addTo(map._map);
        }).catch(function (r) {

        });
      };
      $timeout(function () {
        scope.$watchCollection('measureIndexes', function () {
          install();
        });
        scope.$watch('regionId', function () {
          install();
        });
      }, 500);
    }
  }
})();

/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function () {
  'use strict';

  sxtScNew.$inject = ["$timeout", "mapPopupSerivce", "db", "sxt", "xhUtils", "scPack", "remote", "utils", "$q", "api", "$rootScope"];
  angular
    .module('app.xhsc')
    .directive('sxtScNewV', sxtScNew);

  /** @Inject */
  function sxtScNew($timeout, mapPopupSerivce, db, sxt, xhUtils, scPack, remote, utils, $q, api, $rootScope) {
    var pack = scPack;

    function now() {
      return new Date().toISOString();
    }

    return {
      scope: {
        db: '=', //现场评估id
        areaId: '=', //分期
        acceptanceItem: '=',//实测项
        measureIndexes: '=', //实测指标
        imageUrl: '=',//图纸id
        regionId: '=',//区域
        regionName: '=',//区域名称
        regionType: '=',//区域类型
        standar: "=",
        picRelate: "=",
        readonly: '=',//只读
        tooltip: '='
      },
      link: link
    }

    function link(scope, element, attr, ctrl) {
      var map, tile, fg, toolbar, data, points, pk, scStandar;
      var parentIds = {};//标准批后,用于存放区域测量的父ID
      if (!pk)
        pk = pack.sc.up(scope.db);
      if (!data)
        data = pk.sc.db;
      if (!points)
        points = pk.point.db;

      //查找实测和区域对应的图纸
      function loadImg() {
        return $q(function (resolve, reject) {
          if (!scope.db || !scope.regionId || !scope.measureIndexes || !scope.measureIndexes.length) {
            reject();
            return;
          }
          if (!map) {
            map = new L.SXT.Project(element[0]);
          }
          if (fg)
            map._map.removeLayer(fg);
          if (toolbar){
            map._map.removeControl(toolbar);
            toolbar=null
          }
          function findImg(source) {
            var result = source;

            var imgId;
            if (scope.regionId.length>20){
              imgId= result.data.find(function (item) {
                return (item.Type == -3 && item.RegionId == scope.regionId);
              });
              if (!imgId){
                imgId= result.data.find(function (item) {
                  return (item.Type == 3 && item.RegionId == scope.regionId);
                });
              }

              if (!imgId){
                var imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }

              if (!imgId) {
                imgId = result.data.find(function (item) {
                  return item.AcceptanceItemID == scope.acceptanceItem&&scope.regionId.indexOf(item.RegionId)>-1;
                });
              }
            }else {
              imgId = result.data.find(function (item) {
                return item.RegionId == scope.regionId&&item.AcceptanceItemID == scope.acceptanceItem;
              });
            }
            // var img = result.data.find(function (item) {
            //   return item.AcceptanceItemID == scope.acceptanceItem && item.RegionId == scope.regionId;
            // });
            // if (!img) {
            //   img = result.data.find(function (item) {
            //     return item.AcceptanceItemID == scope.acceptanceItem && scope.regionId.indexOf(item.RegionId) > -1;
            //   });
            // }
            // if (!img) {
            //   var img = result.data.find(function (item) {
            //     return item.RegionId == scope.regionId;
            //   });
            // }
            return imgId;
          }
          var img_ck = findImg(scope.picRelate);
          (function (img) {
            if (!tile || tile != scope.regionId) {
              $timeout(function () {
                if (img) {
                  remote.Project.getDrawing(img.DrawingID).then(function (result2) {
                    if (!result2.data || !result2.data.DrawingContent) {
                      scope.ct && (scope.ct.loading = false);
                      utils.alert('未找到图纸,请与管理员联系!(2)');
                      return;
                    }
                    map.loadSvgXml(result2.data.DrawingContent, {
                      filterLine: function (line) {
                        line.attrs.stroke = 'black';
                        line.options = line.options || {};
                        //line.options.color = 'black';

                        line.attrs['stroke-width'] = line.attrs['stroke-width'] * 6;
                      },
                      filterText: function (text) {
                        if (text.options){
                          text.options.color="black";
                        }

                        return true;
                      }
                    });
                    map.center();
                    scope.tooltip = '';
                  })
                }
                else {
                    utils.alert('未找到图纸,请与管理员联系!(1)');
                    scope.ct && (scope.ct.loading = false);
                }
              },300);
            }
            tile = scope.regionId;
          })(img_ck);
          scope.img=img_ck;
          if(img_ck){
            resolve(img_ck);
          }else{
            reject();
          }
        })
      }

      //实测模式(传统模式和标准化模式)
      function modelChoose(img) {
        return $q(function (resolve, reject) {
          var t = scope.standar.data && scope.standar.data.data ? scope.standar.data.data : [];
          var msg = [];
          scope.measureIndexes.forEach(function (o) {
            if (t.find(function (k) {
                return (o.AcceptanceIndexID == k.AcceptanceIndexID || o.Children.find(function (e) {
                    return e.AcceptanceIndexID == k.AcceptanceIndexID;
                  })) && k.DrawingID == img.DrawingID
                  && k.Status == 1;
              })) {
              msg.push(o.IndexName)
            }
          });
          if (msg.length) {
            utils.confirm("指标：" + msg.join(",") + "已经标准化，是否采用标准化点位，选择取消则自行打点!", null).then(function () {
              resolve("standar");
            }).catch(function () {
              resolve("tradition");
            })
          } else {
            resolve("tradition");
          }
        })
      };

      function install(model) {
        parentIds = {};//重置为空
        var coverLayer={
          onUpdate: function (layer, isNew, group) {
            //这里是修正用户点的位置,尽可能在最近点的同一水平或竖直线上
            if (layer instanceof L.Stamp) {
              var neaser = null,
                p0 = layer.getLatLng();
              layer._fg.eachLayer(function (ly) {
                if (ly != layer && ly instanceof L.Stamp) {
                  if (!neaser ||
                    Math.pow(neaser._latlng.lat - p0.lat, 2) + Math.pow(neaser._latlng.lng - p0.lng, 2) >
                    Math.pow(ly._latlng.lat - p0.lat, 2) + Math.pow(ly._latlng.lat - p0.lat, 2)) {
                    neaser = ly;
                  }
                }
              });
              if (neaser) {
                var p1 = neaser.getLatLng(),
                  point0 = neaser._map.latLngToLayerPoint(p0),
                  point1 = neaser._map.latLngToLayerPoint(p1),
                  radius = neaser._radius,
                  dx = Math.abs(point0.x - point1.x),
                  dy = Math.abs(point0.y - point1.y),
                  min = Math.min(dx, dy);
                if (min < radius) {
                  if (dx < dy) {
                    p0.lng = p1.lng;
                  }
                  else {
                    p0.lat = p1.lat;
                  }
                  layer.setLatLng(p0);
                }
              }
            }
            var point = layer.toGeoJSON();
            point = {
              _id: point.properties.$id,
              geometry: point
            };
            points.addOrUpdate(point);
            if (isNew || !fg.data.find(function (d) {
                return d.MeasurePointID == point._id;
              })) {
              scope.measureIndexes.forEach(function (m) {
                var ms = [];
                if (m.Children && m.Children.length) {
                  m.Children.forEach(function (m1) {
                    ms.push(m1);
                  });
                }
                else {
                  ms.push(m);
                }
                ms.forEach(function (m) {
                  var v = {
                    _id: sxt.uuid(),
                    RecordType: 1,
                    CreateTime: now(),
                    RelationID: scope.db,
                    MeasurePointID: point._id,
                    DrawingID: scope.imageUrl,
                    CheckRegionID: scope.regionId,
                    RegionType: scope.regionType,
                    AcceptanceItemID: scope.acceptanceItem,
                    AcceptanceIndexID: m.AcceptanceIndexID
                  };
                  v.MeasureValueId = v._id;
                  data.addOrUpdate(v);
                  fg.data = fg.data ? fg.data : [];
                  fg.data.push(v);
                  //实测标准化
                });
              })
            }

            if (group) {
              var groupId = group.getValue().$id,//添加或移出的groupId
                measureIndexs = xhUtils.findAll(scope.measureIndexes, function (m) {
                  return m.QSKey == '4';
                }),//需要区测量的指标
                values = xhUtils.findAll(fg.data, function (d) {
                  return d.MeasurePointID == point._id && !!measureIndexs.find(function (m) {
                      return m.AcceptanceIndexID == d.AcceptanceIndexID;
                    });
                });//相关操作记录值
              if (!point.geometry.properties.$groupId) {//清除groupId
                values.forEach(function (v) {
                  v.ParentMeasureValueID = null;
                  data.addOrUpdate(v);
                })
              }
              else {//添加或更改groupId
                values.forEach(function (v) {
                  var parent = fg.data.find(function (m) {
                    return m.AcceptanceIndexID == v.AcceptanceIndexID && m.MeasurePointID == groupId;
                  });
                  v.ParentMeasureValueID = parent._id;
                  data.addOrUpdate(v);
                });
              }
            }
            //如果是画区域,而区域内没有点的话,默认生成9点或5个点
            if (isNew && layer instanceof L.AreaGroup) {
              var p = null, b = layer.getBounds();
              fg.eachLayer(function (ly) {
                if (p === null && ly instanceof L.Stamp) {
                  if (L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat, ly._latlng.lat)
                    && L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng, ly._latlng.lng)) {
                    p = ly;
                  }
                }
              });
              if (p == null) {
                var b = layer.getBounds(),
                  x1 = b._northEast.lat,
                  y1 = b._northEast.lng,
                  x2 = b._southWest.lat,
                  y2 = b._southWest.lng;
                var ps = [], ps1 = [];
                var offsetX = Math.abs(x2 - x1) / 8,
                  minX = Math.min(x2, x1),
                  offsetY = Math.abs(y2 - y1) / 8,
                  minY = Math.min(y2, y2);
                for (var i = 1; i <= 3; i++) {
                  for (var j = 1; j <= 3; j++) {
                    ps.push([minX + offsetX * (i == 1 ? 1 : i == 2 ? 4 : 7), minY + offsetY * (j == 1 ? 1 : j == 2 ? 4 : 7)]);
                  }
                }
                ps1[0] = ps[0];
                ps1[1] = ps[1];
                ps1[2] = ps[2];
                ps1[3] = ps[5];
                ps1[4] = ps[8];
                ps1[5] = ps[7];
                ps1[6] = ps[6];
                ps1[7] = ps[3];
                ps1[8] = ps[4];
                if (!scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '9'
                  }) && scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '5';
                  })) {
                  ps1.splice(7, 1);
                  ps1.splice(5, 1);
                  ps1.splice(3, 1);
                  ps1.splice(1, 1);
                }
                ps1.forEach(function (p) {
                  fg.addLayer(new L.Stamp(p), false);
                });
              }
            }

          },
          onPopupClose: function (e) {
            var self = this;
            var edit = mapPopupSerivce.get('mapPopup'),
              scope = edit.scope;
            if (scope.data && scope.isSaveData !== false) {
              scope.isSaveData = false;
              self.options.onUpdateData(scope.context, scope.data.updates, scope);
              if (scope.data.updates.find(function (m) {
                  return m.v && (m.v.MeasureValue || m.v.MeasureValue === 0);
                })) {
                scope.context.layer.setStyle({
                  color: 'blue'
                });
              }
              else {
                scope.context.layer.setStyle({
                  color: 'red'
                });
              }
            }
          },
          onUpdateData: function (context, updates, editScope) {
            //如果有
            updates.forEach(function (m) {
              if (!m.v)return;
              var pid;
              if (editScope.context.layer._value.$groupId) {
                var pidKey = m.m.AcceptanceIndexID + editScope.context.layer._value.$groupId;
                pid = parentIds[pidKey];
                if (!pid) {
                  var p1 = fg.data.find(function (t) {
                    return t.MeasurePointID == editScope.context.layer._value.$groupId
                      && t.AcceptanceIndexID == m.m.AcceptanceIndexID;
                  });
                  if (p1)
                    pid = parentIds[pidKey] = p1._id;
                }
                if (!pid) { //如果原来有值,使用原来的值,原来没有,生成新的parentId,不能用$groupId,因为它是模板化,会很多

                  pid = parentIds[pidKey] = m.v.ParentMeasureValueID || sxt.uuid();
                  p1 = fg.data.find(function (t) {
                    return t._id == pid;
                  });
                  if (!p1) {
                    var pt = {
                      _id: pid,
                      MeasureValueId: pid,
                      CreateTime: now(),
                      RelationID: scope.db,
                      RecordType: 1,
                      DrawingID: scope.imageUrl,
                      MeasurePointID: editScope.context.layer._value.$groupId,
                      CheckRegionID: scope.regionId,
                      RegionType: scope.regionType,
                      AcceptanceItemID: scope.acceptanceItem,
                      AcceptanceIndexID: m.m.AcceptanceIndexID
                    };
                    fg.data.push(pt);
                    data.addOrUpdate(pt);//添加组的值
                  }
                }
              }
              if (!m.v._id) {
                m.v = angular.extend({
                  _id: sxt.uuid(),
                  CreateTime: now(),
                  RelationID: scope.db,
                  RecordType: 1,
                  DrawingID: scope.imageUrl,
                  MeasurePointID: editScope.context.layer._value.$id,
                  CheckRegionID: scope.regionId,
                  RegionType: scope.regionType,
                  AcceptanceItemID: scope.acceptanceItem,
                  AcceptanceIndexID: m.m.AcceptanceIndexID,
                  ParentMeasureValueID: pid
                }, m.v);
                m.v.MeasureValueId = m.v._id;
                fg.data.push(m.v);
              }
              if (m.v.values) {
                var minV = 1000000, maxV = -1000000, vs = [];
                for (var k in m.v.values) {
                  var v = m.v.values[k];
                  if (m.v.values.hasOwnProperty(k) && v) {
                    minV = Math.min(minV, v);
                    maxV = Math.max(maxV, v);
                    vs.push(v);
                  }
                }
                ;
                m.v.CreateTime = now();
                m.v.MeasureValue = maxV;
                m.v.DesignValue = minV;
                m.v.ExtendedField1 = vs.join(',');
              }
              data.addOrUpdate(m.v);
            });
          },
          onDelete: function (layer) {
            var id = layer.getValue().$id,
              values = xhUtils.findAll(fg.data, function (d) {
                return d.MeasurePointID == id && !!scope.measureIndexes.find(function (m) {
                    return m.AcceptanceIndexID == d.AcceptanceIndexID;
                  });
              });
            points.delete(id);
            values.forEach(function (v) {
              data.delete(v._id);
            })
          },
          onPopup: function (e) {
            if (e.layer instanceof L.Stamp
              || e.layer instanceof L.AreaGroup
              || e.layer instanceof L.LineGroup)
              var edit = mapPopupSerivce.get('mapPopup');
            if (edit) {
              if (e.layer instanceof L.Stamp) {
                $timeout(function () {
                  var center = fg._map.getCenter();
                  fg._map.setView([center.lat, e.layer._latlng.lng]);
                }, 300);
              }
              ;
              edit.scope.context = e;

              edit.scope.data = {
                measureIndexes: scope.measureIndexes,
                regionId: scope.regionId,
                regionType: scope.regionType,
                acceptanceItem: scope.acceptanceItem,
                values: fg.data ? fg.data : []
              };

              edit.scope.readonly = scope.readonly;
              edit.scope.apply && edit.scope.apply();
              return edit.el[0];
            }
          }
        }


        switch (model) {
          case "tradition":
            traditionInstall(coverLayer);
            break;
          case "standar":
            standarInstall(coverLayer);
            break;
        }
      }

      //采用标准化模式无需打点
      function standarInstall(coverLayer) {
        coverLayer.onLoad=function () {
          var layer=this;
          if (layer.loaded)return;
          layer.loaded = true;
          data.findAll().then(function (req) {
            var u = req.rows;
            var t = scope.standar.data && scope.standar.data.data ? scope.standar.data.data : [];
            var _points=[];
            fg.data = u.filter(function (row) {
              return row.CheckRegionID == scope.regionId;
            });
            function addData(layData, index, color) {
              if (!layData.geometry && layData.Geometry) {
                layData.geometry = JSON.parse(layData.Geometry);
              }

              if (!layData.geometry) return;
              layData.geometry.options.color = color;
              layData.geometry.options.fill = true;
              // layData.geometry.options.v = index;
              layData.geometry.options.seq = layData.geometry.properties.seq;
              layData.geometry.options.customSeq = true;
              layData.geometry.options.move = false;
              layData.CreateTime = moment(layData.CreateTime).toDate();
              layer.addData(layData.geometry);
            }
            function find(index, source) {
              if (source) {
                if (source.find(function (n) {
                    return n.AcceptanceIndexID == index.AcceptanceIndexID;
                  })) {
                  return true;
                } else {
                  for (var i = 0; i < source.length; i++) {
                    if (find(index, source[i].Children)) {
                      return true;
                    }
                  }
                  return false;
                }
              } else {
                return false;
              }
            }
            if (t && t.length) {
              var g,img=scope.img;
              t.forEach(function (m) {
                if (m.DrawingID == img.DrawingID && find(m, scope.measureIndexes) && !_points.find(function (n) {
                    return n.MeasurePointID == m.MeasurePointID;
                  })) {
                  _points.push(m);
                  var values = u.filter(function (v) {
                    return v.MeasureValue && m.MeasurePointID == v.MeasurePointID && v.CheckRegionID == scope.regionId &&
                      scope.measureIndexes.find(function (n) {
                        return n.AcceptanceIndexID == v.AcceptanceIndexID
                      })
                  });
                  var color = values.length == scope.measureIndexes.length ? 'blue' : 'red';
                  addData(m, null, color);
                  // index++;
                }
              });
            }
          })

        }
        fg = new L.SvFeatureGroup(coverLayer).addTo(map._map);
      }

      //采用传统模式自行打点
      function traditionInstall(coverLayer) {
        coverLayer.onLoad=function () {
          var self=this;
          var _r = function (o) {  //过滤值
            if (o.AcceptanceItemID == scope.acceptanceItem && scope.measureIndexes.length
              && !!scope.measureIndexes.find(function (m) {
                return m.AcceptanceIndexID == o.AcceptanceIndexID
                  || (m.Children && m.Children.find(function (m1) {
                    return m1.AcceptanceIndexID == o.AcceptanceIndexID
                  }));
              })) {
              if (o.CheckRegionID == scope.regionId) {
                return true;
              }
            }
            return false;
          }
          data.findAll(function (o) {
            return _r(o);
          }).then(function (r) {
            points.findAll(function (o) {
              return r.rows.find(function (i) {
                  if (i.MeasurePointID == o._id || i.MeasurePointID == o.MeasurePointID) {
                    if (r.rows.find(function (i) {
                        return ((i.MeasurePointID == o._id || i.MeasurePointID == o.MeasurePointID) && i.MeasureValue || i.MeasureValue === 0)
                      })) {
                      o.geometry.options.color = 'blue';
                    }
                    else {
                      o.geometry.options.color = 'red';
                    }
                    // o.geometry.options.v = index;
                    o.geometry.options.seq = o.geometry.properties.seq;
                    o.geometry.options.customSeq = true;
                    o.CreateTime = moment(o.CreateTime).toDate();
                    // index++;
                    return true;
                  }
                  return false;
                }) != null;
            }).then(function (p) {
              fg.data = r.rows.filter(function (row) {
                return row.CheckRegionID == scope.regionId;
              });
              p.rows.sort(function (p1, p2) {
                return p1.CreateTime.getTime() - p2.CreateTime.getTime();
              });
              p.rows.forEach(function (geo) {
                self.addData(geo.geometry);
              });
            })
          }).catch(function (r) {
          });
        }
        fg = new L.SvFeatureGroup(coverLayer).addTo(map._map);
        toolbar = new L.Control.Draw({
          featureGroup:fg,
          group:{
            lineGroup: false,
            areaGroup:!!scope.measureIndexes.find(function (m) {
              return m.QSKey=='4'
            })
          }
        }).addTo(map._map);
      }

      $timeout(function () {
        scope.$watchCollection('measureIndexes', function () {
          loadImg().then(modelChoose).then(install);
        });
      }, 500);
    }
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  sxtScView.$inject = ["$timeout", "$window", "remote", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtScView', sxtScView);

  /** @Inject */
  function sxtScView($timeout,$window,remote,utils){
    return {
      scope:{
        data:'=',
        procedure:'=',
        regionId:'='
      },
      link:link
    }
    function link(scope,element,attr,ctrl){
      var map,tile,fg;
      var install = function(){
        if(!scope.data)return;

        if(!map){
          map = new L.SXT.Project(element[0]);
        }
        $timeout(function(){
          remote.Project.getDrawingRelations(scope.regionId,"nodb").then(function (result) {
            var imgId = result.data.find(function (item) {
              return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
            });
            if(!imgId){
              imgId = result.data.find(function (item) {
                return item.RegionId == scope.regionId;
              });
            }
            if (imgId) {
              remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                if(!result2.data.DrawingContent){
                  scope.ct && (scope.ct.loading = false);
                  utils.alert('未找到图纸,请与管理员联系!(2)');
                  return;
                }
                map.loadSvgXml(result2.data.DrawingContent, {
                  filterLine: function (line) {
                    line.attrs.stroke = 'black';
                    line.options = line.options||{};
                    //line.options.color = 'black';

                    line.attrs['stroke-width'] = line.attrs['stroke-width']*6;
                  },
                  filterText: function (text) {
                    return false;
                  }
                });
                map.center();
                scope.tooltip = '';
              })
            }
            else{
              if(!result.data.DrawingContent){
                utils.alert('未找到图纸,请与管理员联系!(1)');
                scope.ct && (scope.ct.loading = false);
                return;
              }
            }
          });
        }, 300);

        fg = new L.SvFeatureGroup({
          onLoad:function(){
            var layer = this;

            scope.data.MeasurePoints.forEach(function (point) {
              var geo = JSON.parse(point.Geometry),
                v = scope.data.MeasureValues.find(function (value) {
                  return value.MeasurePointID == point.MeasurePointID;
                });
              if(v) {
                if(geo.geometry.type=='Stamp' && !v.MeasureValue && v.MeasureValue!==0)return;
                if(!v.ExtendedField1 && v.DesignValue){
                  v.ExtendedField1 = v.MeasureValue+','+v.DesignValue;
                }

                v.MeasureValue=!v.MeasureValue?"0":v.MeasureValue;
                geo.options.MeasureValue = v.MeasureValue;
                geo.options.ExtendedField1 = v.ExtendedField1;
                geo.options.seq = v.MeasureValue;
                geo.options.customSeq = true;
                switch(v.MeasureStatus) {
                  case 1:
                    //geo.options.
                    geo.options.color = 'black';
                    break;
                  case 2:
                    geo.options.color = '#eb7400';
                    break;
                }
                layer.addData(geo);
              }
              else if(geo.geometry.type=='Stamp'){
                layer.addData(geo);
              }
            });
            layer.eachLayer(function (layer) {
              if(layer.options.MeasureValue || layer.options.MeasureValue===0) {
                //layer.updateValue({seq: ''+layer.options.MeasureValue});
                layer.on('mouseover',function (e) {
                  if(!layer.popup) {
                    layer.popup = L.popup({
                        closeButton: false
                      })
                      .setLatLng(layer._latlng)
                      .setContent('<div style="text-align:center">' + (layer.options.ExtendedField1 ||layer.options.MeasureValue)+'</div>')
                      .openOn(map._map);
                  }
                  else if(!layer.popup._isOpen){
                    layer.popup.openOn(map._map)
                  }
                });
                layer.on('mouseout',function () {
                  map._map.closePopup(layer.popup);
                })
              }
            })
          }
        }).addTo(map._map);
      };
      $timeout(function(){
        scope.$watch('data',function(){
          install();
        });
      },500);
    }
  }


})();

/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtScPopupNew.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "db"];
  angular
    .module('app.xhsc')
    .directive('sxtScPopupNew',sxtScPopupNew);
  /** @ngInject */
  function sxtScPopupNew(mapPopupSerivce,$timeout,sxt,xhUtils,db){
    return {
      restrict:'E',
      scope:{
        readonly:'='
      },
      templateUrl:'app/main/xhsc/directive/sxtScPopupNew.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.ct ={
      };
      // console.log(scope.readonly);
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.apply = function() {
        scope.isSaveData = null;
        var context = scope.context,p = context.layer.getValue();
        var singleEdit=[],mutiEdit=[],floorEdit=[],sjzEdit=[],materEidt=[],group= null,groupEdit=[];
        scope.data.updates = [];
        var ms = [];
        scope.data.measureIndexes&&scope.data.measureIndexes.forEach(function(m){
          if(m.Children && m.Children.length){
            var m0 = m.Children.find(function(m2){
              return m2.QSKey=='2';
            });
            m.Children.forEach(function (it) {
              it.QSKey = m0?'2': m.QSKey;
              ms.push(it);
            });
          }
          else{
            ms.push(m);
          }
        });

        ms.forEach(function (m) {
          var o = {
            m: m,
            v: scope.data.values.find(function (o) {
              return o.MeasurePointID == p.$id
                && o.AcceptanceIndexID == m.AcceptanceIndexID;
            })
          };
          o.v=o.v? o.v:{};
          scope.data.updates.push(o);
          if (m.IndexType == 'SelectMaterial') {

          } else if (context.layer instanceof L.LineGroup || context.layer instanceof L.AreaGroup) {
            //o.v.children = [];
            group = o;
            o.v.children = xhUtils.findAll(scope.data.values, function (v) {
              return v.ParentMeasureValueID == o.v._id;
            });
          }
          else {
            switch (m.QSKey) {
              case '1':
              case '4':
                mutiEdit.push(o);
                break;
              case '2':
                sjzEdit.push(o);
                break;
              case '3':
                groupEdit.push(o);
                break;
              case '5':
                floorEdit.push(o)
                break;
            }
          }
        });
        if (mutiEdit.length == 1) {
          singleEdit = mutiEdit;
          mutiEdit = [];
        }

        scope.edit ={
          plasterDepth:sjzEdit.find(function (item) {
            return !!item.m.plasterDepth
          }),
          singleEdit:singleEdit,
          mutiEdit:mutiEdit,
          floorEdit:floorEdit,
          sjzEdit:sjzEdit,
          materEidt:materEidt,
          group:group,
          groupEdit:groupEdit
        }
        if(scope.PointType=='LineGroup' || scope.PointType=='AreaGroup') {
          var ps = [];
          context.featureGroup.eachLayer(function (layer) {
            if (layer._value && layer._value.$groupId == scope.value.$id) {
              ps.push(layer._value);
            }
            scope.values = ps;
          });
        }
        $timeout(function(){scope.ct.show && scope.ct.show();},300);
        scope.$apply();
      };
      scope.getCalculatedValue = function (item) {
        if( (item.v.DesignValue || item.v.DesignValue==0) &&( item.v.MeasureValue||item.v.MeasureValue==0)){
          if(item.m.plasterDepth){
            item.v.CalculatedValue = parseInt(item.v.MeasureValue)+(2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth)) - item.v.DesignValue;
          }
          else {
            item.v.CalculatedValue = item.v.MeasureValue - item.v.DesignValue;
          }
        }
        else{
          item.v.CalculatedValue = null;
        }
        return item.v.CalculatedValue;
      }
      scope.onMeasureValueChange = function (v,item) {
        if(v.isDesignValueInput)return;
        $timeout(function () {
          if(v && v.MeasureValue){
            var str = v.MeasureValue.toString();
            if(str.length>1) {
              var sv = parseInt(v.MeasureValue);
              if(item.m.plasterDepth){
                sv+=2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth);
              }
              str = sv.toString();
              var xs = str.substr(str.length - 2, 2),
                n = parseInt(xs),
                l = str.substr(0,str.length-2);
              if(!isNaN(n)){
                if(n<25){
                  v.DesignValue = l+'00';
                }
                else if(n<75){
                  v.DesignValue = l+'50';
                }
                else{
                  v.DesignValue = l.length?(parseInt(l)+1)*100:100;
                }
              }
              else{
                v.DesignValue='';
              }
            }
            else{
              v.DesignValue = 0;
            }
          }
          else{
            v.DesignValue= null;
          }
        },0);

      }
      scope.onDesignValueToggle = function (v,item) {
        v.isDesignValueInput = true;
      }
      scope.distinct = function(array){
        if(!array || !array.forEach)return;
        var min=100000,max=-100000;
        array.forEach(function(item){
          if(item.MeasureValue) {
            if (item.MeasureValue < min)
              min = item.MeasureValue;
            if (item.MeasureValue > max)
              max = item.MeasureValue;
          }
          else {
            if (item < min)
              min = item;
            if (item > max)
              max = item;
          }
        })
        return max-min;
      }
      scope.distinct2 = function(){
        scope.distinct(Array.prototype.splice.call(arguments));
      }
      scope.removeLayer = function(){
        scope.isSaveData = false;
        var layer = scope.context.layer;
        if(layer  instanceof L.AreaGroup){
          var $id=layer._value.$id;
          if ($id){
            var key,v;
            for (key in  layer._fg._layers){
                if( layer._fg._layers.hasOwnProperty(key)){
                  v= layer._fg._layers[key];
                  if (v._value.$groupId&&v._value.$groupId==$id){
                    layer._fg.removeLayer(v);
                  }
                }
            }
          }
        }
        layer._fg.removeLayer(layer);

      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      mapPopupSerivce.set('mapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapPopup');
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtScPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtScPopup',sxtScPopup);
  /** @ngInject */
  function sxtScPopup(mapPopupSerivce,$timeout,sxt,xhUtils){
    return {
      restrict:'E',
      scope:{
        readonly:'='
      },
      templateUrl:'app/main/xhsc/directive/sxtScPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){

      scope.ct ={
      };
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.apply = function() {
        scope.isSaveData = null;
        var context = scope.context,p = context.layer.getValue();
        var singleEdit=[],mutiEdit=[],floorEdit=[],sjzEdit=[],materEidt=[],group= null,groupEdit=[];
        scope.data.updates = [];
        var ms = [];
        scope.data.measureIndexes.forEach(function(m){
          if(m.Children && m.Children.length){
            var m0 = m.Children.find(function(m2){
              return m2.QSKey=='2';
            });
            m.Children.forEach(function (it) {
              it.QSKey = m0?'2': m.QSKey;
              ms.push(it);
            });
          }
          else{
            ms.push(m);
          }
        });
        ms.forEach(function (m) {
          var o = {
            m: m,
            v: scope.data.values.find(function (o) {
              return o.MeasurePointID == p.$id
                && o.AcceptanceIndexID == m.AcceptanceIndexID;
            })
          };
          scope.data.updates.push(o);
          if (m.IndexType == 'SelectMaterial') {

          } else if (context.layer instanceof L.LineGroup || context.layer instanceof L.AreaGroup) {
            //o.v.children = [];
            group = o;
            o.v.children = xhUtils.findAll(scope.data.values, function (v) {
              return v.ParentMeasureValueID == o.v._id;
            });
          }
          else {
            switch (m.QSKey) {
              case '1':
              case '4':
                mutiEdit.push(o);
                break;
              case '2':
                sjzEdit.push(o);
                break;
              case '3':
                groupEdit.push(o);
                break;
              case '5':
                floorEdit.push(o)
                break;
            }
          }
        });
        if (mutiEdit.length == 1) {
          singleEdit = mutiEdit;
          mutiEdit = [];
        }
        scope.edit ={
          plasterDepth:sjzEdit.find(function (item) {
            return !!item.m.plasterDepth
          }),
          singleEdit:singleEdit,
          mutiEdit:mutiEdit,
          floorEdit:floorEdit,
          sjzEdit:sjzEdit,
          materEidt:materEidt,
          group:group,
          groupEdit:groupEdit
        }
        if(scope.PointType=='LineGroup' || scope.PointType=='AreaGroup') {
          var ps = [];
          context.featureGroup.eachLayer(function (layer) {
            if (layer._value && layer._value.$groupId == scope.value.$id) {
              ps.push(layer._value);
            }
            scope.values = ps;
          });
        }
        $timeout(function(){scope.ct.show && scope.ct.show();},300);
        scope.$apply();
      };
      scope.getCalculatedValue = function (item) {
        if( (item.v.DesignValue || item.v.DesignValue==0) &&( item.v.MeasureValue||item.v.MeasureValue==0)){
          if(item.m.plasterDepth){
            item.v.CalculatedValue = parseInt(item.v.MeasureValue)+(2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth)) - item.v.DesignValue;
          }
          else {
            item.v.CalculatedValue = item.v.MeasureValue - item.v.DesignValue;
          }
        }
        else{
          item.v.CalculatedValue = null;
        }
        return item.v.CalculatedValue;
      }
      scope.onMeasureValueChange = function (v,item) {
        if(v.isDesignValueInput)return;
        $timeout(function () {
          if(v && v.MeasureValue){
            var str = v.MeasureValue.toString();
            if(str.length>1) {
              var sv = parseInt(v.MeasureValue);
              if(item.m.plasterDepth){
                sv+=2*(item.m.plasterDepthMethod=='+'?item.m.plasterDepth:-item.m.plasterDepth);
              }
              str = sv.toString();
              var xs = str.substr(str.length - 2, 2),
                n = parseInt(xs),
                l = str.substr(0,str.length-2);
              if(!isNaN(n)){
                if(n<25){
                  v.DesignValue = l+'00';
                }
                else if(n<75){
                  v.DesignValue = l+'50';
                }
                else{
                  v.DesignValue = l.length?(parseInt(l)+1)*100:100;
                }
              }
              else{
                v.DesignValue='';
              }
            }
            else{
              v.DesignValue = 0;
            }
          }
          else{
            v.DesignValue= null;
          }
        },0);

      }
      scope.onDesignValueToggle = function (v,item) {
        v.isDesignValueInput = true;
      }
      scope.distinct = function(array){
        if(!array || !array.forEach)return;
        var min=100000,max=-100000;
        array.forEach(function(item){
          if(item.MeasureValue) {
            if (item.MeasureValue < min)
              min = item.MeasureValue;
            if (item.MeasureValue > max)
              max = item.MeasureValue;
          }
          else {
            if (item < min)
              min = item;
            if (item > max)
              max = item;
          }
        })
        return max-min;
      }
      scope.distinct2 = function(){
        scope.distinct(Array.prototype.splice.call(arguments));
      }
      scope.removeLayer = function(){
        scope.isSaveData = false;
        var layer = scope.context.layer;
        layer._fg.removeLayer(layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      mapPopupSerivce.set('mapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapPopup');
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtScMapPopup.$inject = ["mapPopupSerivce", "$timeout"];
  angular
    .module('app.xhsc')
    .directive('sxtScMapPopup',sxtScMapPopup);
  /** @ngInject */
  function sxtScMapPopup(mapPopupSerivce,$timeout){
    return {
      restrict:'E',
      scope:{
        readonly:'='
      },
      templateUrl:'app/main/xhsc/directive/sxtScMapPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.ct ={
      };
      scope.updateValue = function() {
        var context = scope.context;

        if (!context.featureGroup.options.onUpdateData || context.featureGroup.options.onUpdateData (context) !== false) {
          scope.cancelEdit ();
        }
      };
      scope.apply = function() {
        var context = scope.context;
        scope.PointType = context.layer.toGeoJSON().geometry.type;

        //console.log('PointType',scope.PointType )
        scope.MeasureIndex = context.featureGroup.options.properties;
        scope.value = context.layer.getValue();
        scope.values=null;
        if(scope.PointType=='LineGroup' || scope.PointType=='AreaGroup') {
          var ps = [];
          context.featureGroup.eachLayer(function (layer) {
            if (layer._value && layer._value.$groupId == scope.value.$id) {
              ps.push(layer._value);
            }
            scope.values = ps;
          });
        }
        $timeout(function(){scope.ct.show && scope.ct.show();},300);
        scope.$apply();
      };
      scope.distinct = function(array){
        if(!array || !array.forEach)return;
        var min=100000,max=-100000;
        array.forEach(function(item){
          if(item.MeasureValue) {
            if (item.MeasureValue < min)
              min = item.MeasureValue;
            if (item.MeasureValue > max)
              max = item.MeasureValue;
          }
          else {
            if (item < min)
              min = item;
            if (item > max)
              max = item;
          }
        })
        return max-min;
      }
      scope.distinct2 = function(){
        scope.distinct(Array.prototype.splice.call(arguments));
      }
      scope.removeLayer = function(){
        var layer = scope.context.layer;
        layer._fg.removeLayer(layer);
      };
      scope.cancelEdit = function(){
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      mapPopupSerivce.set('mapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapPopup');
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  'use strict';
  sxtScMap.$inject = ["$timeout", "mapPopupSerivce", "remote", "$q", "sxt", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtScMap',sxtScMap);
  /** @ngInject */
  function sxtScMap($timeout,mapPopupSerivce,remote,$q,sxt,xhUtils){

    return {
      scope:{
        areaId:'=',
        acceptanceItem:'=',
        measureIndexes:'=',
        currentIndex:'=',
        imageUrl:'=',
        regionId:'=',
        regionName:'=',
        tips:'=',
        project:'=',
        regionType:'=',
        readonly:'='
      },
      link:link
    }
    function link(scope,element,attr,ctrl){
      var remoteS = {
        buff:[],
        buff2:[],
        uploading:false,
        t:null,
        t1:null,
        t2:null,
        replaceData:function(data){
          var self = this;
          for(var i= 0,l=self.buff.length;i<l;i++) {
            if (self.buff[i].properties.$id == data.properties.$id) {
              self.buff[i] = data;
              return true;
            }
          }
          return false;
        },
        update:function(data){
          var self = this;
          if(!self.replaceData(data))
            self.buff.push(data);

          if(!self.t){
            self.t = $timeout(function(){
              self.t = null;
              var updates = self.buff;
              self.buff=[];
              self.tips('正在保存测量点……');
              remote.ProjectQuality.MeasurePoint.create(updates).then(function(r){
                if(r.data.ErrorCode==0) {
                  self.tips('已保存测量点。');
                }
                else{
                  self.tips(r.data.ErrorMessage);
                }
              })
            },500);
          }
        },
        replaceData2:function(data){
          var self = this;
          for(var i= 0,l=self.buff2.length;i<l;i++) {
            if (self.buff2[i].$id == data.$id) {
              self.buff2[i] = data;
              return true;
            }
          }
          return false;
        },
        updateData:function(data){
          var self = this;
          if(!self.replaceData2(data))
            self.buff2.push(data);

          if(!self.t2){
            self.t2 = $timeout(function(){
              self.t2 = null;
              var updates = self.buff2;
              self.buff2=[];
              self.tips('正在保存测量值……');
              //data.ParentMeasurePointID = data.$groupId;

              remote.ProjectQuality.MeasureValue.create(updates).then(function(r){
                if(r.data.ErrorCode==0) {
                  self.tips('已保存测量值。');
                }
                else{
                  self.tips(r.data.ErrorMessage);
                }
              });
            },500);
          }

          //remoteS.updateData
         // console.log('update value',data);
        },
        delete:function(data){
          var self = this;
          self.tips('正在删除测量点……');
          remote.ProjectQuality.MeasureValue.delete(data.properties.MeasureValueId).then(function(){
            self.tips('已删除测量点。');
          });
          //console.log('delete layer',data);
        },
        tips:function(tp){
          scope.tips = tp;
          if(this.t1)
            $timeout.cancel(this.t1);
          this.t1=$timeout(function(){
            scope.tips = '';
          },1500)
        }
      }
      var points={},
        options = {
        onLoad:function(){
          var layer = this;
          if(layer.loaded)return;
          layer.loaded = true;
          var defer = points[scope.acceptanceItem+scope.regionId],
            defer2 = points[scope.acceptanceItem+scope.regionId+'2'];
          if(!defer)
            defer = points[scope.acceptanceItem+scope.regionId] =
              remote.ProjectQuality.MeasurePoint.query(scope.acceptanceItem,scope.regionId,scope.regionType,0);
          if(!defer2)
            defer2 = points[scope.acceptanceItem+scope.regionId+'2'] =
              remote.ProjectQuality.MeasureValue.query(scope.acceptanceItem,scope.regionId,scope.regionType,0);
          remoteS.tips('正在加载点数据……');
          $q.all([defer,defer2]).then(function(rs){
            var ps = [];
            rs[1].data.forEach(function(value){
              rs[0].data.forEach(function(f){
               // console.log('a',f.properties.$id,value.MeasurePointID,f.properties.$id==value.MeasurePointID)
                if(f.properties.$id==value.MeasurePointID && (value.AcceptanceIndexID==scope.measureIndexes[scope.currentIndex].AcceptanceIndexID|| (scope.measureIndexes[scope.currentIndex].cds&&scope.measureIndexes[scope.currentIndex].cds.find(function(a){
                    return a.AcceptanceIndexID==f.properties.AcceptanceItemID;
                  })))){
                  value.seq = value.MeasurPointName||value.seq;


                  if(f.geometry.type =='Stamp' && !value.color) {
                    options.setColor(value);
                    f.options && (f.options.color = value.color);
                  }
                  angular.extend(f.properties,value);
                  if(scope.measureIndexes[scope.currentIndex].cds) {
                    var prevP = ps.find(function (f1) {
                      return f1.properties.$id == f.properties.$id;
                    });
                    if (prevP) {
                      prevP.cds[value.AcceptanceIndexID]=value
                    }
                    else {
                      f.cds = {};
                      f.cds[value.AcceptanceIndexID]=value;
                      ps.push(f);
                    }
                  }
                  else{
                    ps.push(f);
                  }
                }
              });
            });

            remoteS.tips('加载完毕');

              var idx = scope.measureIndexes.find(function(m){return m.AcceptanceIndexID==layer.options.acceptanceIndexID;});
              if(idx && idx.QSKey=='5'){
                remoteS.tips('正在加载上层数据……');
                xhUtils.getRegion(scope.areaId,function(r){
                  var find = r.find(scope.regionId);
                  if(find) {
                    var ix = find.$parent.Children.indexOf(find);
                    var prev = find.$parent.prev();
                    if (prev)
                      prev = prev.Children[ix];
                    if(prev) {
                      $q.all([remote.ProjectQuality.MeasurePoint.query(scope.acceptanceItem, prev.RegionID, scope.regionType, 0),
                          remote.ProjectQuality.MeasureValue.query(scope.acceptanceItem, prev.RegionID, scope.regionType, 0)])
                        .then(function (rs) {
                          //var ps2 = [];
                          rs[1].data.forEach(function(value){
                            rs[0].data.forEach(function(f){
                              if(f.properties.$id==value.MeasurePointID && value.AcceptanceIndexID==scope.measureIndexes[scope.currentIndex].AcceptanceIndexID) {
                                value.seq = value.MeasurPointName || value.seq;
                                value.CheckRegionID = prev.RegionID;
                                value.MeasurePointID = f.properties.MeasurePointID;
                                var to = ps.find(function (p) {
                                  return p.properties.$id == f.properties.$id;
                                })
                                if (to) {
                                  to.properties.Prev = value;
                                }
                                else {
                                  angular.extend(f.properties, {
                                    CheckRegionID:scope.regionId,
                                    RegionType:scope.regionType,
                                    MeasureValueId:sxt.uuid(),
                                    Prev: value
                                  });
                                  ps.push(f);
                                }
                              }
                              remoteS.tips('加载上层完毕');
                              layer.addData(ps);
                            });
                          });
                        });
                    }
                  }
                });
              }
            else{
              layer.addData(ps);
            }
          });

        },
        onUpdateData:function(context){
          var value = context.layer.getValue();
          if(value.cds){
            for(var k in value.cds){
              this.onUpdateD(angular.extend({},value,{
                $id:value.cds[k].$id||sxt.uuid(),
                AcceptanceIndexID:k,
                MeasureValueId:value.cds[k].MeasureValueId||sxt.uuid(),
                MeasureValue:value.cds[k].MeasureValue,
                MeasurePointID:value.MeasurePointID
              }));
              value.MeasureValue = value.cds[k].MeasureValue;
            }
          }
          else {
            this.onUpdateD(value);
          }
          if(value.Prev &&(( !value.Prev.CalculatedValue && value.CalculatedValue)||value.Prev.NeedUpload)){
            value.Prev.NeedUpload = true;
            value.Prev.CalculatedValue = value.CalculatedValue;
            value.Prev.AcceptanceItemID = value.AcceptanceItemID;
            value.Prev.MeasurPointName = value.MeasurPointName;
            value.Prev.MeasurPointType = value.MeasurPointType;
            value.Prev.RegionType = value.RegionType;
            remoteS.updateData(value.Prev);
          }
          this.setColor(value);
          context.layer.updateValue && context.layer.updateValue(scope.value);
        },
        onUpdateD:function(value){
          value.AcceptanceItemID = scope.acceptanceItem;
          value.CheckRegionID = scope.regionId;
          value.AcceptanceIndexID = value.AcceptanceIndexID || scope.measureIndexes[scope.currentIndex].AcceptanceIndexID;
          value.RegionType = scope.regionType;
          value.MeasureValueId = value.MeasureValueId||sxt.uuid();
          //value.ParentMeasureValueID = value.$groupId;
          value.MeasurePointID = value.MeasurePointID|| value.$id;
          value.MeasurPointName = value.seq;
          value.MeasurPointType = 0;
          remoteS.updateData(value);
        },
        setColor:function(v){
          if(!v || ((!v.MeasureValue) && v.MeasureValue!==0)) {
            v.color = '#9E9E9E';
          }
          else if(v.MeasureStatus==1){
            v.color = '#4CAF50';
          }
          else if(v.MeasureStatus==2){
            v.color = '#FFEB3B';
          }
          else if(v.MeasureStatus==3){
            v.color = '#F44336';
          }
          else if((v.MeasureValue||v.MeasureValue===0)){
            v.color = '#4CAF50';
          }
        },
        onPopup:function(e){
          if(e.layer instanceof L.Stamp
          || e.layer instanceof L.AreaGroup
          || e.layer instanceof L.LineGroup)
          var edit = mapPopupSerivce.get('mapPopup');
          if(edit) {
            //e.layer._value.seq =
            edit.scope.context = e;
            edit.scope.readonly = scope.readonly;
            edit.scope.apply && edit.scope.apply();
            return edit.el[0];
          }
        },
        onUpdate:function(layer,isNew,isGroup){
          var v = layer.getValue();
          this.setColor(v);
          layer.updateValue && layer.updateValue(v);
          remoteS.update(layer.toGeoJSON());
          if(isNew || isGroup){
            if(isGroup) {
              v.ParentMeasureValueID = isGroup === true ? null : isGroup.getValue().MeasureValueId;
            }
            this.onUpdateD(v);
          }
        },
        onDelete:function(layer){
          remoteS.delete(layer.toGeoJSON());
        }
      },project,tile;
      var install = function(){
        if(!scope.measureIndexes || !scope.regionId)return;
        if(!project){
          project = scope.project = new L.SXT.Project (element[0], {
            map: {
              map: {}
            }
          });
        }
        if(tile)
          project._map.removeLayer(tile);
        tile = L.tileLayer(sxt.app.api+'/Api/Picture/Tile/{z}_{x}_{y}?path=/fs/UploadFiles/Framework/'+ scope.imageUrl, {attribution: false,noWrap: true});
        project._map.addLayer(tile);

        var featureGroups= {};
        scope.measureIndexes.forEach(function(m){
          var id = scope.regionId+m.AcceptanceIndexID;
          if(project._featureGroups[id])return;
          var g = featureGroups[id] = angular.copy(m);
          g.options = angular.copy(options);
          g.options.regionId = scope.regionId;
          g.options.acceptanceIndexID = m.AcceptanceIndexID;
          g.options.regionName = scope.regionName;
          g.toolbar = {
            draw:{},
            group:{
              lineGroup: m.QSKey=='3',
              areaGroup:m.QSKey=='4'
            }
          };
          if(scope.readonly==true){
            g.toolbar.draw =false;
            g.toolbar.group =false;
          }
        });

        project.registerGroups(featureGroups);
        project.swipeFeature(scope.regionId+scope.measureIndexes[scope.currentIndex].AcceptanceIndexID);
      }
      $timeout(function() {
        scope.$watchCollection('measureIndexes', function () {
          install();
        });
        scope.$watch('regionId',function(){
          install();
        });
        scope.$watch('currentIndex',function(){
          if(project){
            project.swipeFeature(scope.regionId+scope.measureIndexes[scope.currentIndex].AcceptanceIndexID);
          }
        })
      },500);

    }
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  sxtScHzView.$inject = ["$timeout", "$window", "remote", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtScHzView', sxtScHzView);

  /** @Inject */
  function sxtScHzView($timeout,$window,remote,utils ){
    return {
      scope:{
        data:'=',
        procedure:'=',
        regionId:'='
      },
      link:link
    }
    function link(scope,element,attr,ctrl){
      var map,tile,fg;
      var install = function(){
        if(!scope.data)return;

        if(!map){
          map = new L.SXT.Project(element[0]);
        }
        $timeout(function(){
        remote.Project.getDrawingRelations(scope.regionId,"nodb").then(function (result) {
          var imgId = result.data.find(function (item) {
            return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
          });
          if(!imgId){
            imgId = result.data.find(function (item) {
              return item.RegionId == scope.regionId;
            });
          }
          if (imgId) {
            remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
              if(!result2.data.DrawingContent){
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(2)');
                return;
              }
              map.loadSvgXml(result2.data.DrawingContent, {
                filterLine: function (line) {
                  line.attrs.stroke = 'black';
                  line.options = line.options||{};
                  //line.options.color = 'black';

                  line.attrs['stroke-width'] = line.attrs['stroke-width']*6;
                },
                filterText: function (text) {
                  return false;
                }
              });
              map.center();
              scope.tooltip = '';
            })
          }
          else{
            if(!result.data.DrawingContent){
              utils.alert('未找到图纸,请与管理员联系!(1)');
              scope.ct && (scope.ct.loading = false);
              return;
            }
          }
        });
      }, 300);


        fg = new L.SvFeatureGroup({
          onLoad:function(){
            var layer = this;

            scope.data.MeasurePoints.forEach(function (point) {
              var geo = JSON.parse(point.Geometry),
                v = scope.data.MeasureValues.find(function (value) {
                  return value.MeasurePointID == point.MeasurePointID;
                });
              if(v) {
                if(geo.geometry.type=='Stamp' && !v.MeasureValue && v.MeasureValue!==0)return;
                if(!v.ExtendedField1 && v.DesignValue){
                  v.ExtendedField1 = v.MeasureValue+','+v.DesignValue;
                }
                v.MeasureValue=!v.MeasureValue?"0":v.MeasureValue;
                geo.options.MeasureValue = v.MeasureValue;
                geo.options.ExtendedField1 = v.ExtendedField1;
                geo.options.seq =v.MeasureValue;
                geo.options.customSeq = true;
                geo.options.PointChilden=point.PointChilden;
                switch(v.MeasureStatus) {
                  case 1:
                    geo.options.color = 'blue';
                    break;
                  case 2:
                    geo.options.color = 'red';
                    break;
                }
              }
              layer.addData(geo);
            });

            layer.eachLayer(function (layer) {
              if(layer.options.MeasureValue || layer.options.MeasureValue===0) {
                //layer.updateValue({seq: ''+layer.options.MeasureValue});
                layer.on('mouseover',function (e) {
                  var  PointChilden=e.target.options.PointChilden;
                  var zb='',jl="",xmb='',t;
                  if (angular.isArray(PointChilden)){
                    t=PointChilden.find(function(o){
                      return o.MemberType==0;
                    });
                    if (t){
                      zb= t.Value;
                    }

                    t=PointChilden.find(function(o){
                      return o.MemberType==2;
                    });
                    if (t){
                      jl= t.Value;
                    }
                    t=PointChilden.find(function(o){
                      return o.MemberType==4;
                    });
                    if (t){
                      xmb= t.Value;
                    }

                  }
                  if(!layer.popup) {
                    var popArr=[];
                    popArr.push('<div style="padding:5px;">')
                    if (zb){
                      popArr.push( '<div class="row" style="margin-bottom: 10px;"><label style="display: block;width:50px;float: left;">总包：</label><p style="margin:0;margin-left: 50px;">'+(zb)+'</p></div>')
                    }
                    if (jl){
                      popArr.push( '<div class="row" style="margin-bottom: 10px;"><label style="display: block;width:50px;float: left;">监理：</label><p style="margin:0;margin-left: 50px;">'+(jl)+'</p></div>')
                    }
                    if (xmb){
                      popArr.push( '<div class="row" style="margin-bottom: 10px;"><label style="display: block;width:50px;float: left;">项目部：</label><p style="margin:0;margin-left: 50px;">'+(xmb)+'</p></div>')
                    }

                    popArr.push('</div>')
                    layer.popup = L.popup({
                        closeButton: false
                      })
                      .setLatLng(layer._latlng)
                      .setContent(popArr.join(''))
                      .openOn(map._map);
                  }
                  else if(!layer.popup._isOpen){
                    layer.popup.openOn(map._map)
                  }
                });
                layer.on('mouseout',function () {
                  //map._map.closePopup(layer.popup);
                })
              }
            })
          }
        }).addTo(map._map);
      };
      $timeout(function(){
        scope.$watch('data',function(){
          install();
        });
      },500);
    }
  }


})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  sxtSc.$inject = ["$timeout", "mapPopupSerivce", "db", "sxt", "xhUtils", "pack", "remote", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtSc', sxtSc);

  /** @Inject */
  function sxtSc($timeout,mapPopupSerivce,db,sxt,xhUtils,pack,remote,utils){
    function now() {
      return new Date().toISOString();
    }
    return {
      scope:{
        db:'=',
        areaId:'=',
        acceptanceItem:'=',
        measureIndexes:'=',
        imageUrl:'=',
        regionId:'=',
        regionName:'=',
        regionType:'=',
        readonly:'=',
        tooltip:'='
      },
      link:link
    }
    function link(scope,element,attr,ctrl){
      var map,tile,fg,toolbar,data,points,pk;
      var install = function(){
        if(!scope.db || !scope.regionId || !scope.measureIndexes || !scope.measureIndexes.length)return;
        if(!pk)
          pk = pack.sc.up(scope.db);
        if(!data)
          data = pk.sc.db;
        if(!points)
          points = pk.point.db;
        if(!map){
          map = new L.SXT.Project(element[0]);
        }
        if(!tile || tile!=scope.regionId) {
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId.substr(0,10)).then(function (result) {
              var imgId;
              if (scope.regionId.length>20){
                imgId= result.data.find(function (item) {
                  return (item.Type == -3 && item.RegionId == scope.regionId);
                });
                if (!imgId){
                  imgId= result.data.find(function (item) {
                    return (item.Type == 3 && item.RegionId == scope.regionId);
                  });
                }

                if (!imgId){
                  var imgId = result.data.find(function (item) {
                    return item.RegionId == scope.regionId;
                  });
                }

                if (!imgId) {
                  imgId = result.data.find(function (item) {
                    return item.AcceptanceItemID == scope.acceptanceItem&&scope.regionId.indexOf(item.RegionId)>-1;
                  });
                }
              }else {
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId&&item.AcceptanceItemID == scope.acceptanceItem;
                });
              }

              if (!imgId){
                imgId={
                  DrawingID:scope.imageUrl
                }
              }

              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data||!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent, {
                    filterLine: function (line) {
                      line.attrs.stroke = 'black';
                      line.options = line.options||{};
                      //line.options.color = 'black';

                      line.attrs['stroke-width'] = line.attrs['stroke-width']*6;
                    },
                    filterText: function (text) {
                      if (text.options){
                        text.options.color="black";
                      }

                     return true;
                    }
                  });
                  map.center();
                  scope.tooltip = '';
                })
              }
              else{
                if(!result.data.DrawingContent){
                  utils.alert('未找到图纸,请与管理员联系!(1)');
                  scope.ct && (scope.ct.loading = false);
                  return;
                }
              }
            });
          }, 300);
          tile = scope.regionId;
        }

        if(fg)
          map._map.removeLayer(fg);

        if(toolbar)
          map._map.removeControl(toolbar);


        fg = new L.SvFeatureGroup({
          onLoad:function(){
            var layer = this;
            if(layer.loaded)return;
            layer.loaded = true;
            data.findAll(function(o){
              return o.DrawingID==scope.imageUrl
               && o.AcceptanceItemID==scope.acceptanceItem
               && !!scope.measureIndexes.find(function(m){
                  return m.AcceptanceIndexID == o.AcceptanceIndexID
                    ||(m.Children && m.Children.find(function (m1) {
                      return m1.AcceptanceIndexID == o.AcceptanceIndexID
                    }));
                });
            }).then(function(r){
              points.findAll(function(o){
                return r.rows.find(function(i){
                    if(i.MeasurePointID == o._id){
                      if(r.rows.find(function(i){
                          return i.MeasurePointID == o._id && i.CheckRegionID==scope.regionId && i.MeasureValue || i.MeasureValue===0
                        })) {
                        o.geometry.options.color = 'blue';
                      }
                      else{
                        o.geometry.options.color = 'red';
                      }
                      o.CreateTime = moment(i.CreateTime).toDate();
                      return true;
                    }
                  return false;
                })!=null;
              }).then(function(p){
                fg.data = r.rows.filter(function (row) {
                  return row.CheckRegionID==scope.regionId;
                });
                //fg.addLayer(p);
                p.rows.sort(function (p1,p2) {
                  return p1.CreateTime.getTime()-p2.CreateTime.getTime();
                });
                p.rows.forEach(function(geo){
                  layer.addData(geo.geometry);
                });
              })
            });
          },
          onUpdate:function(layer,isNew,group){
            //这里是修正用户点的位置,尽可能在最近点的同一水平或竖直线上
            if(layer instanceof L.Stamp){
              var neaser = null,
                p0 = layer.getLatLng();
              layer._fg.eachLayer(function (ly) {
                if(ly != layer && ly instanceof L.Stamp){
                  if(!neaser ||
                    Math.pow(neaser._latlng.lat-p0.lat,2)+Math.pow(neaser._latlng.lng-p0.lng,2)>
                    Math.pow(ly._latlng.lat-p0.lat,2)+Math.pow(ly._latlng.lat-p0.lat,2)){
                    neaser = ly;
                  }
                }
              });
              if(neaser){
                var p1 = neaser.getLatLng(),
                  point0 = neaser._map.latLngToLayerPoint(p0),
                  point1 = neaser._map.latLngToLayerPoint(p1),
                  radius = neaser._radius,
                  dx = Math.abs(point0.x - point1.x),
                  dy = Math.abs(point0.y - point1.y),
                  min = Math.min(dx,dy);
                if(min<radius){
                  if(dx<dy){
                    p0.lng = p1.lng;
                  }
                  else{
                    p0.lat = p1.lat;
                  }
                  layer.setLatLng(p0);
                }
              }
            }
            var point = layer.toGeoJSON();
            point = {
              _id:point.properties.$id,
              geometry:point
            };
            points.addOrUpdate(point);
            if(isNew || !fg.data.find(function (d) {
                return d.MeasurePointID == point._id;
              })){
              scope.measureIndexes.forEach(function (m) {
                var ms = [];
                if (m.Children && m.Children.length) {
                  m.Children.forEach(function (m1) {
                    ms.push(m1);
                  });
                }
                else {
                  ms.push(m);
                }
                ms.forEach(function (m) {
                  var v = {
                    _id: sxt.uuid(),
                    RecordType: 4,
                    CreateTime:now(),
                    RelationID: scope.db,
                    MeasurePointID: point._id,
                    DrawingID:scope.imageUrl,
                    CheckRegionID: scope.regionId,
                    RegionType: scope.regionType,
                    AcceptanceItemID: scope.acceptanceItem,
                    AcceptanceIndexID: m.AcceptanceIndexID
                  };
                  v.MeasureValueId = v._id;
                  data.addOrUpdate(v);
                  fg.data.push(v);
                });
              })
            }
            if(group){
              var groupId = group.getValue().$id,//添加或移出的groupId
                measureIndexs = xhUtils.findAll(scope.measureIndexes,function (m) {
                  return m.QSKey=='4';
                }),//需要区测量的指标
                values = xhUtils.findAll(fg.data,function (d) {
                  return d.MeasurePointID == point._id && !!measureIndexs.find(function (m) {
                      return m.AcceptanceIndexID==d.AcceptanceIndexID;
                    });
                });//相关操作记录值
              if(!point.geometry.properties.$groupId){//清除groupId
                values.forEach(function (v) {
                  v.ParentMeasureValueID = null;
                  data.addOrUpdate(v);
                })
              }
              else{//添加或更改groupId
                values.forEach(function (v) {
                  var parent = fg.data.find(function (m) {
                    return m.AcceptanceIndexID == v.AcceptanceIndexID && m.MeasurePointID==groupId;
                  });
                  v.ParentMeasureValueID = parent._id;
                  data.addOrUpdate(v);
                });
              }
            }
            //如果是画区域,而区域内没有点的话,默认生成9点或5个点
            if(isNew && layer instanceof L.AreaGroup){
              var p=null,b = layer.getBounds();
              fg.eachLayer(function (ly) {
                if(p===null && ly instanceof L.Stamp){
                  if(L.SvFeatureGroup.isMiddleNumber(b._southWest.lat, b._northEast.lat,ly._latlng.lat)
                    && L.SvFeatureGroup.isMiddleNumber(b._southWest.lng, b._northEast.lng,ly._latlng.lng)){
                    p = ly;
                  }
                }
              });
              if(p==null) {
                var b = layer.getBounds(),
                  x1 = b._northEast.lat,
                  y1 = b._northEast.lng,
                  x2 = b._southWest.lat,
                  y2 = b._southWest.lng;
                var ps = [], ps1 = [];
                var offsetX = Math.abs(x2 - x1) / 8,
                  minX = Math.min(x2, x1),
                  offsetY = Math.abs(y2 - y1) / 8,
                  minY = Math.min(y2, y2);
                for (var i = 1; i <= 3; i++) {
                  for (var j = 1; j <= 3; j++) {
                    ps.push([minX + offsetX * (i == 1 ? 1 : i == 2 ? 4 : 7), minY + offsetY * (j == 1 ? 1 : j == 2 ? 4 : 7)]);
                  }
                }
                ps1[0] = ps[0];
                ps1[1] = ps[1];
                ps1[2] = ps[2];
                ps1[3] = ps[5];
                ps1[4] = ps[8];
                ps1[5] = ps[7];
                ps1[6] = ps[6];
                ps1[7] = ps[3];
                ps1[8] = ps[4];
                if (!scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '9'
                  }) && scope.measureIndexes.find(function (m) {
                    return m.QSKey == '4' && m.QSOtherValue == '5';
                  })) {
                  ps1.splice(7, 1);
                  ps1.splice(5, 1);
                  ps1.splice(3, 1);
                  ps1.splice(1, 1);
                }
                ps1.forEach(function (p) {
                  fg.addLayer(new L.Stamp(p), false);
                });
              }
            }

          },
          onPopupClose:function (e) {
            var self = this;
            var edit = mapPopupSerivce.get('mapPopup'),
              scope = edit.scope;
            if(scope.data && scope.isSaveData!==false){
              scope.isSaveData = false;
              self.options.onUpdateData(scope.context,scope.data.updates,scope);
              if(scope.data.updates.find(function (m) {
                return m.v &&(m.v.MeasureValue || m.v.MeasureValue===0);
              })){
                scope.context.layer.setStyle({
                  color:'blue'
                });
              }
              else{
                scope.context.layer.setStyle({
                  color:'red'
                });
              }
            }
          },
          onUpdateData:function(context,updates,editScope){
            updates.forEach(function(m){
              if(!m.v)return;
              if(!m.v._id){
                m.v = angular.extend({
                  _id:sxt.uuid(),
                  CreateTime:now(),
                  RelationID:scope.db,
                  RecordType:4,
                  DrawingID:scope.imageUrl,
                  MeasurePointID:editScope.context.layer._value.$id,
                  CheckRegionID:scope.regionId,
                  RegionType:scope.regionType,
                  AcceptanceItemID:scope.acceptanceItem,
                  AcceptanceIndexID:m.m.AcceptanceIndexID
                },m.v);
                m.v.MeasureValueId = m.v._id;
              }
              if(m.v.values){
                var minV=1000000,maxV=-1000000,vs=[];
                for(var k in m.v.values){
                  var v = m.v.values[k];
                  if(m.v.values.hasOwnProperty(k) && v) {
                    minV = Math.min(minV, v);
                    maxV = Math.max(maxV,v);
                    vs.push(v);
                  }
                };
                m.v.MeasureValue = maxV;
                m.v.DesignValue = minV;
                m.v.ExtendedField1 = vs.join(',');
                //组测量(一个点多个值)
/*                var childValues = fg.data.filter(function (item) {
                  return item.ParentMeasureValueID == m.v.MeasureValueId;
                }),ix=0;
                for(var k in m.v.values) {
                  if (isNaN(parseInt(k)))return;
                  var dv = m.v.values[k];
                  if (!dv)return;
                  var fd = childValues[ix++];
                  if (!fd) {
                    fd = {
                      _id: sxt.uuid(),
                      ParentMeasureValueID: m.v.MeasureValueId,
                      CreateTime: now(),
                      RelationID: scope.db,
                      RecordType: 4,
                      DrawingID:scope.imageUrl,
                      MeasurePointID: editScope.context.layer._value.$id,
                      CheckRegionID: scope.regionId,
                      RegionType: scope.regionType,
                      AcceptanceItemID: scope.acceptanceItem,
                      AcceptanceIndexID: m.m.AcceptanceIndexID,
                      Hide: true
                    };
                    fd.MeasureValueId = fd._id;
                  }
                  fd.MeasureValue = dv;
                  data.addOrUpdate(fd);
                }*/
              }

              data.addOrUpdate(m.v);
            });
          },
          onDelete:function (layer) {
            var id = layer.getValue().$id,
              values = xhUtils.findAll(fg.data,function (d) {
              return d.MeasurePointID == id && !!scope.measureIndexes.find(function (m) {
                  return m.AcceptanceIndexID==d.AcceptanceIndexID;
                });
            });
            points.delete(id);
            values.forEach(function (v) {
              data.delete(v._id);
            })
          },
          onPopup:function(e){
            if(e.layer instanceof L.Stamp
              || e.layer instanceof L.AreaGroup
              || e.layer instanceof L.LineGroup)
              var edit = mapPopupSerivce.get('mapPopup');
            if(edit) {
              if(e.layer instanceof L.Stamp) {
                $timeout(function () {
                  var center = fg._map.getCenter();
                  fg._map.setView([center.lat,e.layer._latlng.lng]);
                },300);
              };
              edit.scope.context = e;
              edit.scope.data = {
                measureIndexes:scope.measureIndexes,
                regionId:scope.regionId,
                regionType:scope.regionType,
                acceptanceItem:scope.acceptanceItem,
                values:fg.data
              };
              edit.scope.readonly = scope.readonly;
              edit.scope.apply && edit.scope.apply();
              return edit.el[0];
            }
          }
        }).addTo(map._map);
        toolbar = new L.Control.Draw({
          featureGroup:fg,
          group:{
            lineGroup: false,
            areaGroup:!!scope.measureIndexes.find(function (m) {
              return m.QSKey=='4'
            })
          }
        }).addTo(map._map);

      };
      $timeout(function(){
        scope.$watchCollection('measureIndexes',function(){
          install();
        });
        scope.$watch('regionId',function(){
          install();
        });
      },500);
    }
  }


})();

/**
 * Created by emma on 2016/8/4.
 */
(function(){
  'use strict';

  sxtReportMap.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtReportMap',sxtReportMap);

  /**@ngInject*/
  function sxtReportMap($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtReportMap',
        sxtMapShow:'=',
        items:'=',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:true,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              remote.Procedure.InspectionCheckpoint.query(scope.procedure,scope.regionId,scope.inspectionId,"nodb").then(function (r) {
                  remote.Procedure.InspectionPoint.query(scope.inspectionId,scope.procedure, scope.regionId,"nodb").then(function (r1) {
                  fg.data = r.data;
                  var fs=[];
                  r.data.forEach(function (c) {
                    var p = r1.data.find(function (p1) {
                      return p1.MeasurePointID == c.PositionID;
                    });
                    if (p && p) {
                      if(p.Geometry){
                        p.geometry = $window.JSON.parse(p.Geometry);
                      }else{
                        p.geometry = p.geometry;
                      }
                      if(!p.geometry)return;
                      c.ProblemDescription= c.IndexPointID?c.ProblemDescription:'合格';
                      p.geometry.properties.seq = c.ProblemSortName;
                      p.geometry.properties.v = c;
                      if(p.geometry.geometry.type == 'Stamp')
                        p.geometry.geometry.type = 'Point';
                      p.geometry.properties.Status = c.Status;
                      fs.push(p.geometry);
                    }
                  });
                  scope.item = null;
                  fg.addData(fs,false);
                  cb();
                  scope.ct && (scope.ct.loading = false);
                })
              });
            },
            onUpdate: function (layer, isNew, group,cb) {

            },
            onPopup: function (layer,cb) {
              //var edit = mapPopupSerivce.get('mapRecheckMapPopup');
              //if (edit) {
              //  scope.sxtMapShow = true;
              //  edit.scope.context = fg;
              //  edit.scope.data = {
              //    item:scope.item,
              //    procedure:scope.procedure,
              //    regionId:scope.regionId,
              //    value: layer.properties.v
              //  }
              //  edit.scope.apply && edit.scope.apply();
              //}
            }
          });
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId,"nodb").then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawingOnline(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  //var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  //btn.click(function () {
                  //  var mapList = [];
                  //  result.data.forEach(function (item) {
                  //    if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                  //        return f.DrawingID==item.DrawingID
                  //      })){
                  //      mapList.push(item);
                  //    }
                  //  });
                  //
                  //  xhUtils.openLinks(mapList);
                  //});
                  //element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                })
              }
              else{
                if(!result.data.DrawingContent){
                  utils.alert('未找到图纸,请与管理员联系!(1)')
                  return;
                }
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtRecheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtRecheckPopup',sxtRecheckPopup);
  /** @ngInject */
  function sxtRecheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q,utils){
    return {
      restrict:'E',
      scope:{
        slideShow:'=',
        slideRole:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/sxtRecheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
        // console.log('role',scope.role)
      })
      $(element).appendTo('body');
      scope.apply = function(){
        //console.log('scope',scope)
        remote.Procedure.InspectionProblemRecord.query(scope.data.value.CheckpointID).then(function(r){
          r.data.forEach(function (p) {
            remote.Procedure.InspectionProblemRecordFile.query(p.ProblemRecordID).then(function (r2) {
              p.images = r2.data;
            });
          });

          scope.Record = {
            jl:r.data.find(function (p) {
              return p.DescRole=='jl'
            }),
            zb:r.data.find(function (p) {
              return p.DescRole=='zb'
            })
          };
          if(!scope.Record.zb){
            scope.Record.zb = {
              CheckpointID:scope.data.value.CheckpointID,
              RectificationID:scope.data.item,
              Describe:'',
              DescRole:scope.role,
              Remark:''
            };
          }
          //remote.Procedure.
        })
        //$timeout(function(){
        //  scope.slideShowbg = true;
        //},200)
        scope.value =scope.data.value.Status;
      }

      scope.playImage = function (imgs) {
        imgs.forEach(function (img) {
          img.url = img.FileContent||img.FileUrl;
          img.alt = ' ';
        })
        xhUtils.playPhoto(imgs);
      }
      function createZb(update) {
        return $q(function (resolve) {
          if(!scope.Record.zb.ProblemRecordID||update===true){
            scope.Record.zb.ProblemRecordID = scope.Record.zb.ProblemRecordID || sxt.uuid();
            remote.Procedure.InspectionProblemRecord.create(scope.Record.zb).then(function () {
              resolve();
            })
          }
          else{
            resolve()
          }
        })
      }
      scope.addPhoto = function (warter) {
        xhUtils.photo(null,warter).then(function (image) {
          if(image){
            createZb().then(function () {
              var img = {
                ProblemRecordFileID:sxt.uuid(),
                ProblemRecordID:scope.Record.zb.ProblemRecordID,
                CheckpointID:scope.Record.zb.CheckpointID,
                FileID:sxt.uuid()+'.jpg',
                FileContent:image
              }
              remote.Procedure.InspectionProblemRecordFile.create(img).then(function () {
                var imgs = scope.Record.zb.images = (scope.Record.zb.images || []);
                imgs.push(img);
              })

            })
          scope.data.value.Status = 8;
          }
        });
      }
      scope.cancel = function(){
        scope.slideShow = false;
        scope.data.value.Status = scope.value;
      }
      scope.submit = function(){
        if(scope.role=='zb'){
          scope.data.value.Status = scope.data.value.Status==8?8:1;
          if(scope.data.value.Status==8 &&(!scope.Record.zb.images || scope.Record.zb.images.length==0)){
            utils.alert('请上传整改后照片');
            return;
          }
          createZb(true).then(function () {
            remote.Procedure.InspectionCheckpoint.create(scope.data.value).then(function () {
              scope.slideShow = false;
              scope.context.updateStatus(scope.data.value.PositionID,scope.data.value.Status);
            });
          });
        }
        else if(scope.role=='jl'){
          scope.data.value.Status = scope.data.value.Status==2?2:4;
          remote.Procedure.InspectionCheckpoint.create(scope.data.value).then(function () {
            scope.slideShow = false;
            scope.context.updateStatus(scope.data.value.PositionID,scope.data.value.Status);
          });
        }else{
          scope.slideShow = false;
        }
      }
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'recheck'){
            scope.slideShow = false;
            scope.$apply()
          }
        }

      })
      mapPopupSerivce.set('mapRecheckMapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapRecheckMapPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtRecheckMap.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtRecheckMap',sxtRecheckMap);
  /** @ngInject */
  function sxtRecheckMap($timeout,remote,mapPopupSerivce,sxt,utils,$q,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtRecheckMap',
        sxtMapShow:'=',
        items:'=',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        disableInspect:'=',
        disableDrag:'=',
        ct:'='
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              $("#inspect").css("display","none");
              $q.all([remote.Procedure.getZGReginQues(scope.regionId,scope.item),
                  remote.Procedure.getZGReginQuesPoint(scope.regionId,scope.item)])
                .then(function(res) {
                  var fs = [];
                  fg.data = res[0].data;
                  res[0].data.forEach(function (item) {
                    var p = res[1].data.find(function (pt) {
                      return pt.MeasurePointID == item.PositionID;
                    });
                    if (p && p.Geometry) {
                      var geo = $window.JSON.parse(p.Geometry);
                      if(geo && geo.geometry) {
                        if (geo.geometry.type == 'Stamp')
                          geo.geometry.type = 'Point';
                        geo.properties.Status = item.Status;
                        geo.properties.v = item;
                        geo.properties.seq = item.ProblemSortName;
                        fs.push(geo);
                      }
                    }
                  })
                  fg.addData(fs, false);
                  cb();
                  scope.ct && (scope.ct.loading = false);
                })
            },
            onUpdate: function (layer, isNew, group,cb) {
              if(isNew){
                layer.properties.seq = scope.item.ProblemSortName;
                layer.properties.Status = scope.item.ProblemID?1:2;
              }
              var point = {
                MeasurePointID:layer.properties.$id,
                geometry:layer
              };
              remote.Procedure.InspectionPoint.create(point);
              if(isNew || !fg.data.find(function (d) {
                  return d.PositionID == point.MeasurePointID;
                })) {
                var v = {
                  InspectionID:scope.inspectionId,
                  CheckpointID:sxt.uuid(),
                  IndexPointID:scope.item.ProblemID,
                  AreaID:scope.regionId,
                  AcceptanceItemID:scope.procedure,
                  PositionID:point.MeasurePointID,
                  MeasureValue:0,
                  Status:1,
                  ProblemSortName:scope.item.ProblemSortName,
                  ProblemDescription:scope.item.ProblemDescription,
                  isNew:true
                }
                if(!v.IndexPointID){
                  v.Status = 2;
                  point.geometry.properties.Status = 2;
                }
                fg.data.push(v);
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                remote.Procedure.InspectionCheckpoint.create(v);
              }
              cb(layer);
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('mapRecheckMapPopup');
              if (edit) {
                scope.sxtMapShow = true;
                edit.scope.context = fg;
                edit.scope.data = {
                  item: scope.item,
                  value: layer.properties.v
                }
                edit.scope.apply && edit.scope.apply();
              }
            }
          });
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID==item.DrawingID
                        })){
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);
                  //scope.ct && (scope.ct.loading = false);
                })
              }
              else {
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by emma on 2016/7/22.
 */
(function(){
  'use strict';

  sxtQuestionList.$inject = ["remote"];
  angular
    .module('app.xhsc')
    .directive('sxtQuestionList',sxtQuestionList);

  /**@ngInject*/
  function sxtQuestionList(remote){
    return {
      scope:{
        listShow:'=',
        listInspectid:'=',
        procedure:'=',
        regionId:'='
      },
      templateUrl:'app/main/xhsc/directive/qlistUp.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      $(element).appendTo('body');
      var load = function(){
        if(!scope.regionId) return;
        if(!scope.listInspectid) return;
        remote.Procedure.InspectionCheckpoint.query(scope.procedure,scope.regionId,scope.listInspectid).then(function (r) {
          scope.pList = [];
          scope.templist = [];
          r.data.forEach(function(t){
            if(t.InspectionID == scope.listInspectid){
              scope.templist.push(t);
            }
          })
          scope.templist.forEach(function(_t){
            var find = scope.pList.find(function(p){
              return p.id == _t.IndexPointID;
            })
            if(!find){
              var f = {
                id:_t.IndexPointID,
                ProblemSortName:_t.ProblemSortName,
                ProblemDescription: _t.IndexPointID?_t.ProblemDescription:'合格',
                rows:[]
              };
              f.rows.push(_t)
              scope.pList.push(f)
            }else{
              find.rows.push(_t)
            }
          })
          console.log('find',scope.pList)
        });
      }
      scope.$watch('regionId',function(){
        load();
      })
      scope.$watch('listInspectid',function(){
        load();
      })
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'qlistUp'){
            scope.listShow = false;
            scope.$apply()
          }
        }

      })
      scope.submit = function(){
        scope.listShow = false;
      }
      scope.$on('$destroy',function(){
        $(element).remove();
      })
    }

  }
})();

/**
 * Created by emma on 2016/7/22.
 */
(function(){
  'use strict';

  sxtQuesDetailUp.$inject = ["$q", "remote"];
  angular
    .module('app.xhsc')
    .directive('sxtQuesDetailUp',sxtQuesDetailUp);

  /**@ngInject*/
  function sxtQuesDetailUp($q,remote){
    return {
      scope:{
        upShow:'=',
        selectedArea:'=',
        currentRectificationid:'='
      },
      templateUrl:'app/main/xhsc/directive/listUp.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      $(element).appendTo('body');
      var load = function(){
        if(!scope.currentRectificationid) return;
        if(!scope.selectedArea) return;
        var promises=[
          remote.Procedure.getZGReginQues(scope.selectedArea,scope.currentRectificationid)/*,
           remote.Procedure.getZGReginQuesPoint(vm.regionSelect.AreaID,RectificationID)*/
        ]
        scope.ques=[];
        $q.all(promises).then(function(res){
          scope.items = res.data;
          res[0].data.forEach(function (item) {
            var fd = scope.ques.find(function (it) {
              return it.IndexPointID==item.IndexPointID;
            });
            if(!fd){
              fd = item;
              scope.ques.push(fd);
              fd.Points = 1;
            }
            else{
              fd.Points++;
            }
          })
          console.log(scope.ques)
        })
      }
      scope.$watch('selectedArea',function(){
        load();
      })
      scope.$watch('currentRectificationid',function(){
        load();
      })
      $('body').on('click',function(e){
        var evt = window.event ? window.event: e,
          target = evt.srcElement || evt.target;
        if($('.slideTop').hasClass('slidedown')){
          if(target.id == 'quesUp'){
            scope.upShow = false;
            scope.$apply()
          }
        }

      })
      scope.submit = function(){
        scope.upShow = false;
      }
      scope.$on('$destroy',function(){
        $(element).remove();
      })
    }

  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  'use strict';

  sxtProcedureDown.$inject = ["xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtProcedureDown',sxtProcedureDown)
    .directive('sxtProcedureTb',sxtProcedureTb)
    .filter('sxtProcedureS',sxtProcedureS);
  /** @ngInject */
  function sxtProcedureDown(xhUtils){
    return {
      scope:{
        obj:'=ngModel',
        value:'=',
        areaId:'=',
        regionType:'='
      },
      template:'<md-menu flex="none">' +
      '<md-button aria-label="展开工序" ng-click="$mdOpenMenu($event)">' +
      '<md-icon md-menu-origin  md-font-icon="icon-menu"></md-icon> {{value.MeasureItemName}}' +
      '</md-button>' +
      '<md-menu-content width="6" >' +
      '<md-tabs md-border-bottom >' +
      '<md-tab ng-repeat="g in types|sxtProcedureS">' +
      '<md-tab-label><span sxt-procedure-tb>{{g.$name}}({{g.ps.length}})</span></md-tab-label>' +
      '<md-tab-body>' +
      '<md-content>' +
      '<section ng-if="g.children && g.children.length" ng-repeat="c in g.children|sxtProcedureS">' +
      '<md-subheader class="md-primary">{{c.$name}}({{c.ps.length}})</md-subheader>\
      <md-list layout-padding>\
      <md-list-item ng-click="sett(p)" ng-repeat="p in c.ps">\
      {{p.MeasureItemName}}\
      </md-list-item>\
      </md-list>\
      </section>\
       <md-list   layout-padding>\
      <md-list-item ng-click="sett(p)" ng-repeat="p in g.ps">\
      {{p.MeasureItemName}}\
      </md-list-item>\
      </md-list>\
      </md-content>\
     </md-tab-body>\
      </md-tab>\
      </md-tabs>\
    </md-menu-content>\
    </md-menu>',
      link:link
    }

    function link(scope,element,attrs,ctrl){
      scope.$watch('areaId',function(){
        if(scope.areaId){
          xhUtils.getProcedure(scope.areaId,function(data){
            scope.types = data;
          });
        }
      })
      scope.$watch('value',function(){
      });

      scope.sett = function(p){
        scope.value = p;
      }
    }


  }
  function sxtProcedureTb(){
    return {
      link:function(scope,element,attrs,ctrl){
        element.parent().attr('md-prevent-menu-close','md-prevent-menu-close');
      }
    }
  }

  function sxtProcedureS(){
    return function (s){
      if(!s)return s;
      var n = [];
      s.forEach(function(a){
        if(a.ps && a.ps.length){
          n.push(a)
        }
      });
      return n;
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/3.
 */
(function(){
  'use strict';

  sxtNumInput.$inject = ["$timeout"];
  angular
    .module('app.xhsc')
    .directive('sxtNumInput', sxtNumInput);

  /** @Inject */
  function sxtNumInput($timeout){
    return {
      scope:{
        value:'=ngModel',
        ok:'&',
        sliderStep:'=ngStep',
        onChange:'&'
      },
      link:link,
      templateUrl:'app/main/xhsc/directive/sxtNumInput.html'
    }

    function link(scope,element,attr,ctrl){

      scope.cancel = function($event){
        $event.stopPropagation();
        $event.preventDefault();
      }
      scope.ck = function(cmd,$event){

        $event && scope.cancel($event);
        var str = (scope.value ||'').toString(),
          num = parseFloat(str);
        if(isNaN(num)){
          num = 0;
        }
        switch (cmd) {
          case 'ok':
            scope.value = isNaN(parseFloat(str))?'':parseFloat(str);
            $timeout(function(){scope.ok && scope.ok()},500);
            return;
          case -1:
            str = str.length > 0 ? str.substring (0, str.length - 1) : str;
            break;
          case 'ac':
            str = '';
            break;
          case '+-':
            str = (-num) + '';
            break;
          case '%':
            break;
          case '.':
            if (str.indexOf ('.') == -1)
              str += '.';
            break;
          default:
            str += cmd;
            break;
        }
        scope.value = str;
        scope.onChange && scope.onChange();
      }
    }
  }


})();

/**
 * Created by jiuyuong on 2016/4/3.
 */
(function(){
  'use strict';

  sxtNumDowndown.$inject = ["$timeout"];
  angular
    .module('app.xhsc')
    .directive('sxtNumDowndown', sxtNumDowndown);

  /** @Inject */
  function sxtNumDowndown($timeout){
    return {
      scope:{
        value:'=ngModel',
        ct:'=',
        onChange:'&',
        onToggle:'&'
      },
      link:link,
      template:'<div class="sxtnumdowndown" style="position:relative"><span fast-click="toggleView()" style="display: block;">&nbsp;{{value}}</span><div class="numberpanel nmmPanel"><sxt-num-input ng-model="value"  ok="ok()"></sxt-num-input></div></div>'
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('value',function () {
        if(scope.isToggleView){
          scope.value = scope.oValue;
          scope.isToggleView =false;
        }
        else {
          scope.onChange && scope.onChange();
        }
      });
      //ng-show="isView"
     $('.numberpanel',element).css('display','none');
      if(typeof(scope.ct)=="object") {
        scope.ct.show = function () {
          var mpanel = $(document).find('.numberpanel').eq(0);
          mpanel.css({
            'display': 'block',
            'left':$('.sxtnumdowndown',element).width()+'px',
            'top':'0px'
          });
        };
      };
      scope.toggleView = function(){
        scope.isToggleView = true;
        scope.oValue =  angular.copy(scope.value);
        $timeout(function () {
          scope.isToggleView =false;
        },300);
        scope.onToggle && scope.onToggle();
        if($(element).find('.numberpanel').is(':hidden')){
          $('.numberpanel').css('display','none');
          var mpanel = $(element).find('.numberpanel');
          mpanel.css({
            'display': 'block',
            'left':$('.sxtnumdowndown',element).width()+'px',
            'top':'0px'
          });
        }else{
          $(element).find('.numberpanel').css('display','none');
        }
      }
      scope.ok = function(){
        $('.numberpanel').css('display','none');
      }
      var docClick = function(e){
        var target = $(e.target);
        if(target.closest(".sxtnumdowndown").length == 0){
          $('.numberpanel').css('display','none');
        }
      }
      $(document).bind("click",docClick);
      scope.$on('$destroy',function(){
        $('.numberpanel',element).css('display','none');
        $(document).unbind("click",docClick);
      })
    }
  }


})();

/**
 * Created by leshuangshuang on 16/4/18.
 */
(function(){
  'use strict';

  sxtMapsDirective.$inject = ["$timeout", "remote", "markerCulster"];
  angular
    .module('app.xhsc')
    .directive('sxtMaps',sxtMapsDirective);

  /** @ngInject */
  function sxtMapsDirective($timeout,remote,markerCulster){
    return {
      scope:{
        markers:'=',
        markerClick:'&'
      },
      link:link
    }

    function  link(scope,element,attr,ctrl){
      $timeout(function () {
        var mks = [];
        remote.Project.getMap().then(function(result){
          var lgn=[22.604987,114.059852];
          if (result&&angular.isArray(result.data)&&result.data.length){
            var d=result.data[0].Coordinate;
            if (d){
               var arr=  d.split(',');
               lgn[0]=arr[1]?arr[1]:lgn[0];
               lgn[1]=arr[0]?arr[0]:lgn[1];
            }
          }
          //lgn.push(result&&angular.isArray(result.data)&&);
          var map = L.map(element[0], {
              center: lgn,
              zoom: 8,
              attributionControl: false
            }),
            layer = L.tileLayer('http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
              subdomains: "1234"
            });
          layer.addTo(map);
          scope.markers=[];
          result.data.filter(function(item) {
            return !!item.Coordinate
          }).forEach(function(m) {
            var latlngs = m.Coordinate.split(',');
            scope.markers.push({
              projectId: m.ProjectID,
              title: m.ProjectName,
              lat: parseFloat(latlngs[1]),
              lng: parseFloat(latlngs[0]),
              center: function () {
                map.setView(new L.latLng([parseFloat(latlngs[1]), parseFloat(latlngs[0])]), 14)
              }
            })
          })
            var parentGroup = L.markerClusterGroup();
            angular.forEach(scope.markers, function (o, k) {
              var mk = L
                .marker([o.lat, o.lng], L.extend({
                  icon: L.icon({
                    iconUrl: 'assets/leaflet/css/images/M.png',
                    iconSize: [27, 37],
                    iconAnchor: [20, 20]
                  })
                }, o))
                .on('click', markerClick);
              mks.push(mk);
              parentGroup.addLayer(mk);

            });
            parentGroup.addTo(map);
        })
      }, 500)

      function markerClick(e){
        //console.log('e.target.options',e)
        scope.markerClick( {$current : e.target.options,pid: e.target.options.projectId, pname: e.target.options.title});

      }

    }
  }


})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtMapSelfCheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote", "$q"];
  angular
    .module('app.xhsc')
    .directive('sxtMapSelfCheckPopup',sxtMapSelfCheckPopup);
  /** @ngInject */
  function sxtMapSelfCheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote,$q){
    return {
      restrict:'E',
      scope:{
        readonly:'='
      },
      templateUrl:'app/main/xhsc/directive/sxtMapSelfCheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      }
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        $q.all([
          remote.Procedure.InspectionProblemRecord.query(scope.data.v.CheckpointID,"InspectionProblemRecord_zj"),
          remote.Procedure.InspectionProblemRecord.query(scope.data.v.CheckpointID)
        ]).then(function(res){
          var r={};
          r.data=res[0].data.concat(res[1].data)
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'zj'
            };
            remote.Procedure.InspectionProblemRecord.create(p);
          }
          scope.data.p = p;

          $q.all([
            remote.Procedure.InspectionProblemRecordFile.query(p.ProblemRecordID, scope.data.v.PositionID,"InspectionProblemRecordFile_zj"),
            remote.Procedure.InspectionProblemRecordFile.query(p.ProblemRecordID, scope.data.v.PositionID)
          ]).then(function(res){
            var r={};
            r.data=res[0].data.concat(res[1].data);
            scope.data.images = r.data;
            if (scope.data.v.isNew) {
              scope.addPhoto();
            }
          })
        });
      };
      scope.viewDetail = function(){
        scope.$parent.vm.slideShow = true;
        scope.$parent.vm.pid = scope.data.v.CheckpointID;
        scope.$parent.vm.context = scope.context;
      }
      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        //var layer = scope.context.layer;
        //layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function () {
        scope.data.v.isNew = false;
        xhUtils.photo().then(function (image) {

          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            remote.Procedure.InspectionProblemRecordFile.create(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('mapSelfCheckMapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapSelfCheckMapPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtMapSelfCheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils", "$q"];
  angular
    .module('app.xhsc')
    .directive('sxtMapSelfCheck', sxtMapSelfCheck);
  /** @ngInject */
  function sxtMapSelfCheck($timeout, remote, mapPopupSerivce, sxt, utils, $window, xhUtils, $q) {
    return {
      scope: {
        item: '=sxtMapSelfCheck',
        items: '=',
        procedure: '=',
        regionId: '=',
        inspectionId: '=',
        ct: '='
      },
      link: link
    };

    function link(scope, element, attr, ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map, fg;
      var install = function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            onChangeMode: function (mode, op, cb) {
              if (mode && !op) {
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID: null,
                  ProblemSortName: '✔',//'',
                  ProblemDescription: ''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              function find(isload) {
                var inspectionCheckpoint;
                var inspectionPoint;
                if (isload){
                   inspectionCheckpoint="InspectionCheckpoint_zj";
                   inspectionPoint="InspectionPoint_zj";
                }
                return $q(function (resolve, reject) {
                  remote.Procedure.InspectionCheckpoint.query(scope.procedure, scope.regionId, scope.inspectionId, inspectionCheckpoint).then(function (r) {
                    remote.Procedure.InspectionPoint.query(scope.inspectionId, scope.procedure, scope.regionId, inspectionPoint).then(function (r1) {
                      fg.data =fg.data?fg.data.concat(r.data):r.data , fs = [];
                      r.data.forEach(function (c) {
                        var p = r1.data.find(function (p1) {
                          return p1.MeasurePointID == c.PositionID;
                        });
                        if (p && p) {
                          if (p.Geometry) {
                            p.geometry = $window.JSON.parse(p.Geometry);
                          } else {
                            p.geometry = p.geometry;
                          }
                          p.geometry.properties.seq = c.ProblemSortName;
                          if (p.geometry.geometry.type == 'Stamp')
                            p.geometry.geometry.type = 'Point';
                          p.geometry.properties.Status = c.Status;
                          fs.push(p.geometry);
                        }
                      });

                      fg.addData(fs, false);
                      //cb();
                      resolve()
                    }).catch(function () {
                      reject();
                    })
                  }).catch(function () {
                    reject();
                  });
                })
              }
              $q.all([
                find("InspectionCheckpoint_zj"),
                find()
              ]).then(function(res){
                scope.item = null;
                if(cb) cb();
                scope.ct && (scope.ct.loading = false);
              });
            },
            onUpdate: function (layer, isNew, group, cb) {
              if (isNew) {
                layer.properties.seq = scope.item.ProblemSortName;
                layer.properties.Status = scope.item.ProblemID ? 1 : 2;
              }
              var point = {
                MeasurePointID: layer.properties.$id,
                geometry: layer
              };
              remote.Procedure.InspectionPoint.create(point);
              if (isNew || !fg.data.find(function (d) {
                  return d.PositionID == point.MeasurePointID;
                })) {
                var v = {
                  InspectionID: scope.inspectionId,
                  CheckpointID: sxt.uuid(),
                  IndexPointID: scope.item.ProblemID,
                  AreaID: scope.regionId,
                  AcceptanceItemID: scope.procedure,
                  PositionID: point.MeasurePointID,
                  MeasureValue: 0,
                  Status: 1,
                  ProblemSortName: scope.item.ProblemSortName,
                  ProblemDescription: scope.item.ProblemDescription,
                  isNew: true
                }
                if (!v.IndexPointID) {
                  v.Status = 2;
                  point.geometry.properties.Status = 2;
                }
                fg.data.push(v);
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                remote.Procedure.InspectionCheckpoint.create(v);
              }
              cb(layer);
            },
            onPopupClose: function (cb) {
              var self = this;
              var edit = mapPopupSerivce.get('mapSelfCheckMapPopup'),
                scope = edit.scope;
              if (scope.data && scope.isSaveData !== false) {
                scope.isSaveData = false;
                self.options.onUpdateData(scope.context, scope.data, scope);
              }
              cb();
            },
            onUpdateData: function (context, data, editScope) {
              if (data.v.ProblemSortName == 'T') {
                remote.Procedure.InspectionCheckpoint.create(data.v);
              }
            },
            onDelete: function (layer, cb) {
              var id = layer.properties.$id;
              remote.Procedure.InspectionPoint.delete({MeasurePointID: id}).then(function (r) {
                var v = fg.data.find(function (d) {
                  return d.PositionID == id;
                }), ix = fg.data.indexOf(v);
                fg.data.splice(ix, 1);
                remote.Procedure.InspectionCheckpoint.delete(v.CheckpointID);
              });
              cb(layer);
            },
            onPopup: function (layer, cb) {
              var edit = mapPopupSerivce.get('mapSelfCheckMapPopup');
              if (edit) {
                edit.scope.context = {
                  fg: fg,
                  layer: layer
                };
                edit.scope.data = {
                  item: scope.item,
                  procedure: scope.procedure,
                  regionId: scope.regionId,
                  v: fg.data.find(function (d) {
                    return d.PositionID == layer.properties.$id;
                  })
                };

                edit.scope.readonly = scope.readonly;
                edit.scope.apply && edit.scope.apply();
                cb(edit.el[0]);
              }
            }
          });
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId.substr(0,10)).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if (!imgId) {
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if (!result || !result.data || !result2.data.DrawingContent) {
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if (item.RegionId == scope.regionId && item.DrawingID != imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID == item.DrawingID
                        })) {
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);

                })
              }
              else {
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if (scope.regionId && scope.procedure) {
            if (map) {
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item', function () {
          if (fg) {
            if (scope.item) {
              fg.changeMode('inspect', scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy', function () {
        if (map) {
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/13.
 */
(function(){
  'use strict';
  sxtMapCheckPopup.$inject = ["mapPopupSerivce", "$timeout", "sxt", "xhUtils", "remote"];
  angular
    .module('app.xhsc')
    .directive('sxtMapCheckPopup',sxtMapCheckPopup);
  /** @ngInject */
  function sxtMapCheckPopup(mapPopupSerivce,$timeout,sxt,xhUtils,remote){
    return {
      restrict:'E',
      scope:{
        readonly:'=',
        warter:"="
      },
      templateUrl:'app/main/xhsc/directive/sxtMapCheckPopup.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.updateValue = function() {
        scope.cancelEdit (true);
      };
      scope.moveLayer = function () {
        scope.context.fg.changeMode('move',{ctx:true});
      };
      scope.apply = function() {
        scope.isSaveData = null;
        scope.$apply();
        remote.Procedure.InspectionProblemRecord.query(scope.data.v.CheckpointID).then(function (r) {
          var p = null;
          if (r.data.length) {
            p = r.data[0];
          }
          else {
            p = {
              ProblemRecordID: sxt.uuid(),
              CheckpointID: scope.data.v.CheckpointID,
              Describe: scope.data.v.ProblemDescription,
              DescRole: 'jl'
            };
            remote.Procedure.InspectionProblemRecord.create(p);
          }
          scope.data.p = p;
          remote.Procedure.InspectionProblemRecordFile.query(p.ProblemRecordID, scope.data.v.PositionID).then(function (r) {
            scope.data.images = r.data;
            if (scope.data.v.isNew  && scope.data.images.length == 0) {
              scope.addPhoto(scope.warter);
            }
          });
        })
      };

      scope.removeLayer = function(){
        scope.isSaveData = false;
        var c = scope.context;
        c.fg.delete(c.layer);
      };
      scope.cancelEdit = function(saveData){
        scope.isSaveData = saveData||false;
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      };
      scope.playImage = function () {
        var imgs = [];
        scope.data.images.forEach(function (img) {
          imgs.push({
            url:img.FileContent||img.FileUrl,
            alt:''
          });
        })
        xhUtils.playPhoto(imgs);
      }
      scope.addPhoto = function (waterText) {
        scope.data.v.isNew = false;
        xhUtils.photo(null,waterText).then(function (image) {
          if(image){
            var img = {
              ProblemRecordFileID:sxt.uuid(),
              FileID:sxt.uuid()+".jpg",
              ProblemRecordID:scope.data.p.ProblemRecordID,
              CheckpointID:scope.data.v.CheckpointID,
              FileContent:image
            };
            remote.Procedure.InspectionProblemRecordFile.create(img);
            scope.data.images.push(img);
          }
        });
      }
      mapPopupSerivce.set('mapCheckMapPopup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('mapCheckMapPopup');
        $(element).remove();
      });
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
(function () {
  sxtMapCheck.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$window", "xhUtils"];
  angular
    .module('app.xhsc')
    .directive('sxtMapCheck',sxtMapCheck);
  /** @ngInject */
  function sxtMapCheck($timeout,remote,mapPopupSerivce,sxt,utils,$window,xhUtils) {
    return {
      scope:{
        item:'=sxtMapCheck',
        items:'=',
        procedure:'=',
        regionId:'=',
        inspectionId:'=',
        ct:'=',
        disableInspect:'@',
        disableDrag:'@'
      },
      link:link
    };

    function link(scope,element,attr,ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map,fg;
      var install =function () {
        scope.ct && (scope.ct.loading = true);
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect:scope.disableInspect,
            disableDrag:scope.disableDrag,
            onChangeMode:function (mode,op,cb) {
              if(mode && !op){
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                scope.item = {
                  ProblemID:null,
                  ProblemSortName:'✔',//'',
                  ProblemDescription:''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              remote.Procedure.InspectionCheckpoint.query(scope.procedure,scope.regionId,scope.inspectionId).then(function (r) {
                remote.Procedure.InspectionPoint.query(scope.inspectionId,scope.procedure, scope.regionId).then(function (r1) {
                  fg.data = r.data,fs=[];
                  r.data.forEach(function (c) {
                    var p = r1.data.find(function (p1) {
                      return p1.MeasurePointID == c.PositionID;
                    });
                    if (p && p) {
                      if(p.Geometry){
                        p.geometry = $window.JSON.parse(p.Geometry);
                      }else{
                        p.geometry = p.geometry;
                      }
                      if(p.geometry && p.geometry.properties) {
                        p.geometry.properties.seq = c.ProblemSortName;
                        if (p.geometry.geometry.type == 'Stamp')
                          p.geometry.geometry.type = 'Point';
                        p.geometry.properties.Status = c.Status;
                        fs.push(p.geometry);
                      }
                    }
                  });
                  scope.item = null;
                  fg.addData(fs,false);
                  cb();
                  scope.ct && (scope.ct.loading = false);
                })
              });
            },
            onUpdate: function (layer, isNew, group,cb) {
              if(isNew){
                layer.properties.seq = scope.item.ProblemSortName;
                layer.properties.Status = scope.item.ProblemID?1:2;
              }
              var point = {
                MeasurePointID:layer.properties.$id,
                geometry:layer
              };
              remote.Procedure.InspectionPoint.create(point);
              if(isNew || !fg.data.find(function (d) {
                  return d.PositionID == point.MeasurePointID;
                })) {
                var v = {
                  InspectionID:scope.inspectionId,
                  CheckpointID:sxt.uuid(),
                  IndexPointID:scope.item.ProblemID,
                  AreaID:scope.regionId,
                  AcceptanceItemID:scope.procedure,
                  PositionID:point.MeasurePointID,
                  MeasureValue:0,
                  Status:1,
                  ProblemSortName:scope.item.ProblemSortName,
                  ProblemDescription:scope.item.ProblemDescription,
                  isNew:true
                }
                if(!v.IndexPointID){
                  v.Status = 2;
                  point.geometry.properties.Status = 2;
                }
                fg.data.push(v);
                scope.ct && scope.ct.cancelMode && scope.ct.cancelMode();
                remote.Procedure.InspectionCheckpoint.create(v);
              }
              cb(layer);
            },
            onPopupClose: function (cb) {
              var self = this;
              var edit = mapPopupSerivce.get('mapCheckMapPopup'),
                scope = edit.scope;
              if(scope.data && scope.isSaveData!==false){
                scope.isSaveData = false;
                self.options.onUpdateData(scope.context,scope.data,scope);
              }
              cb();
            },
            onUpdateData: function (context, data, editScope) {
              if(data.v.ProblemSortName == 'T'){
                remote.Procedure.InspectionCheckpoint.create(data.v);
              }
            },
            onDelete: function (layer,cb) {
              var id = layer.properties.$id;
              remote.Procedure.InspectionPoint.delete({MeasurePointID:id}).then(function (r) {
                var v = fg.data.find(function (d) {
                  return d.PositionID == id;
                }),ix = fg.data.indexOf(v);
                fg.data.splice(ix,1);
                remote.Procedure.InspectionCheckpoint.delete(v.CheckpointID);
              });
              cb(layer);
            },
            onPopup: function (layer,cb) {
              var edit = mapPopupSerivce.get('mapCheckMapPopup');
              if(edit) {
                edit.scope.context = {
                  fg:fg,
                  layer:layer
                };
                edit.scope.data = {
                  item:scope.item,
                  procedure:scope.procedure,
                  regionId:scope.regionId,
                  v:fg.data.find(function (d) {
                    return d.PositionID == layer.properties.$id;
                  })
                };

                edit.scope.readonly = scope.readonly;
                edit.scope.apply && edit.scope.apply();
                cb(edit.el[0]);
              }
            }
          });
          $timeout(function () {
            remote.Project.getDrawingRelations(scope.regionId).then(function (result) {
              var imgId = result.data.find(function (item) {
                return item.AcceptanceItemID == scope.procedure && item.RegionId == scope.regionId;
              });
              if(!imgId){
                imgId = result.data.find(function (item) {
                  return item.RegionId == scope.regionId;
                });
              }
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if(!result2.data.DrawingContent){
                    scope.ct && (scope.ct.loading = false);
                    utils.alert('未找到图纸,请与管理员联系!(2)');
                    return;
                  }
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                  var btn = $('<div class="mapboxgl-ctrl-group mapboxgl-ctrl"><button class="mapboxgl-ctrl-icon links"  title="其它图纸"></button></div>');
                  btn.click(function () {
                    var mapList = [];
                    result.data.forEach(function (item) {
                      if(item.RegionId == scope.regionId && item.DrawingID!=imgId.DrawingID && !mapList.find(function (f) {
                          return f.DrawingID==item.DrawingID
                        })){
                        mapList.push(item);
                      }
                    });

                    xhUtils.openLinks(mapList);
                  });
                  element.find('.mapboxgl-ctrl-bottom-left').append(btn);

                })
              }
              else{
                scope.ct && (scope.ct.loading = false);
                utils.alert('未找到图纸,请与管理员联系!(1)')
                return;
              }
            });
          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if(scope.regionId && scope.procedure) {
            if(map){
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item',function () {
          if(fg) {
            if (scope.item) {
              fg.changeMode('inspect',scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy',function () {
        if(map){
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/12.
 */
(function(){
  sxtLineGroup.$inject = ["mapPopupSerivce"];
  angular
    .module('app.xhsc')
    .directive('sxtLineGroup',sxtLineGroup);

  /** @Inject */
  function sxtLineGroup(mapPopupSerivce){
    return {
      restrict:'E',
      scope:{
      },
      templateUrl:'app/main/xhsc/directive/sxtLineGroup.html',
      link:link
    }
    function  link(scope,element,attr,ctrl){
      scope.removeLayer = function(){
        var layer = scope.context.layer;
        layer._fg.removeLayer(layer);
      }
      scope.cancelEdit = function(){
        var layer = scope.context.layer;
        layer.editing && layer.editing.disable();
      }

      mapPopupSerivce.set('LineGroup',{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove('LineGroup');
      })
    }
  }
})();

/**
 * Created by emma on 2016/5/4.
 */
(function(){
  'use strict';
  sxtImagesDirective.$inject = ["$rootScope"];
  angular
    .module('app.xhsc')
    .directive('sxtImages',sxtImagesDirective);

  /** @ngInject */
  function sxtImagesDirective($rootScope){
    return {
      restrict:'ECMA',
      scope:{
        sxtImages:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){
      var player,defaultIndex,viewer,delplayer,o;
      var imagedata = scope.sxtImages;
      player = function(a,e){
        defaultIndex = $('.img img').index($(a.target))
        if (defaultIndex == -1)
          defaultIndex = 0;
        var str = [];
        str.push('<ul>')
        angular.forEach(imagedata, function (data) {
          var arl = data.ImageByte;
          str.push('<li><img src="' + arl + '"></li>');
        });
        str.push('</ul>');
        o = $(str.join('')).appendTo('body')

        viewer = new Viewer(o[0],{
          button:true,
          scalable:false,
          hide:function(){
            viewer.destroy();
            o.remove();
            viewer = o=null;
          },
          build:function(){

          },
          view:function(){
          }
        });
        viewer.show();
        viewer.view(defaultIndex);
        var str1 = [];
        str1.push('<li class="viewer-delete">删除</li>');
        $(str1.join('')).appendTo('.viewer-toolbar');
        $('.viewer-delete').on('click',function(){
          var nowIndex = viewer.index;
          scope.sxtImages.splice(nowIndex,1);
          viewer.hide();
          if(imagedata.length) delplayer(nowIndex);
          $rootScope.$broadcast('delete',nowIndex)
          //console.log('de',imagedata)
        })

      }
      delplayer = function(nowIndex){
        // console.log('element',scope)

        var str = [];
        str.push('<ul>')
        angular.forEach(imagedata, function (data) {
          var arl = data.ImageByte;
          str.push('<li><img src="' + arl + '"></li>');
        });
        str.push('</ul>');
        o = $(str.join('')).appendTo('body')

        viewer = new Viewer(o[0],{
          button:true,
          scalable:false,
          hide:function(){
            viewer.destroy();
            o.remove();
            viewer = o=null;
          },
          build:function(){

          },
          view:function(){
          }
        });
        viewer.show();
        viewer.view(nowIndex);
        var str1 = [];
        str1.push('<li class="viewer-delete">删除</li>');
        $(str1.join('')).appendTo('.viewer-toolbar');
        $('.viewer-delete').on('click',function(){
          var nowIndex = viewer.index;
          //console.log('lenght',viewer.length,nowIndex)
          imagedata.splice(nowIndex,1);
          viewer.hide();
          if(imagedata.length) delplayer(nowIndex);
          $rootScope.$emit('delete',nowIndex)
        })

      }
      element.on ('click', player);
    }
  }
})();

/**
 * Created by zhangzhaoyong on 16/2/16.
 */
(function(){
  'use strict';

  sxtImageViewDirective.$inject = ["$rootScope", "api", "$q", "utils"];
  angular
    .module('app.xhsc')
    .directive('sxtImageView',sxtImageViewDirective);

  /** @ngInject */
  function sxtImageViewDirective($rootScope, api, $q,utils) {
    return {
      restrict: 'EA',
      link: link,
      scope:{
        isContainer:'='
      }
    }

    function link(scope, element, attr, ctrl) {
      var preview, o,def,player;
      player = function (a, e) {
        if(def)return;
        def=true;
        if (preview)
          preview.destroy();
        if (o)
          o.remove();

        $q(function(resolve) {
          if(!e)
            resolve(null);
          else{
            var request = [];
            e.groups.forEach(function (g) {
              request.push(api.szgc.FilesService.group(g));
            });
            $q.all(request).then(function(results){
              resolve(results);
            });
          }
        }).then(function (results) {
          def = false;
          var defaultIndex = 0;
          var imagedata = null;

          if(results) {
            imagedata = [];
            results.forEach (function (result) {
              result.data.Files.forEach (function (f) {
                imagedata.push ({date: f.CreateDate, url: sxt.app.api + f.Url.substring (1)});
              })
            })
          };
          if (!imagedata) {
            imagedata = [];
            $('img', element).each(function (index, el) {
              console.log('el',element)
              imagedata.push({url:$(el)[0].src});
            })
            defaultIndex = $('img', element).index($(a.target))
            if (defaultIndex == -1)
              defaultIndex = 0;
          }
          if(imagedata.length==0){
            utils.alert('暂无图片')
            return;
          }
          console.log('img',imagedata)
          var str = [];
          str.push('<div class="piclayer">\
        <div class="swiper-container"><div class="swiper-wrapper">')
          angular.forEach(imagedata, function (data) {
            var arl = data.url;
            str.push('<div class="swiper-slide"><p><img src="' + arl + '"></p><div style="position:absolute;top:20px;left:20px; font-size:20px; color:white;text-shadow:2px 2px 3px #ff0000">' + (data.date?'日期：'+data.date:'') + '</div></div>');
          });
          str.push('</div><div class="swiper-pagination"></div></div></div>');
          o = $(str.join('')).appendTo('body')
          //$('body').append(o);

          var iWidth = $(window).width();
          var iHeight = $(window).height();

          var iSh = iHeight;//-150;

          $('.swiper-container').width(iWidth + 'px');
          $('.swiper-container').height(iSh + 'px');
          $('.swiper-slide').height(iSh + 'px');
          $('.swiper-slide p').height(iSh + 'px');//.css('line-height',iSh+'px');

          preview = new Swiper(o.find('.swiper-container')[0], {
            initialSlide: defaultIndex,
            pagination: '.swiper-pagination',
            paginationClickable: true
          });//'.swiper-container'
          o.find('.pic_close button').click(function () {
            //preview.destroy();
            //o.remove();
          })

          //$('.picplayer').is(':visible')
          if ($(o).css('display')) {
            $(o.find('.swiper-container')[0]).click(function (e) {
              preview.destroy();
              $('.piclayer').remove();
              o.remove();
              e.preventDefault();
              preview = o = null;
            })
          }

        });
        scope.$on('$destroy', function () {
          $('.piclayer').remove();
          preview.destroy();
        });
      };
      $rootScope.$on('sxtImageView',player);
      if(scope.isContainer) {
        element.on ('click', player);
      }
    }
  }
})();

/**
 * Created by emma on 2016/6/25.
 */
(function(){
  'use strict';

  sxtAreaShowDirective.$inject = ["$timeout", "remote", "sxt", "ys7"];
  angular
    .module('app.xhsc')
    .directive('sxtAreaShow',sxtAreaShowDirective);

  /**@ngInject*/
  function sxtAreaShowDirective($timeout,remote,sxt,ys7){
    return {
      scope:{
        projectId:'=',
        projectName:'='
      },
      link:link
    }
    function link(scope,element,attr,ctrl){

      var map,layer,dlg;
      var ran = function(){
        $timeout(function(){
          if(!scope.projectId) return;
          if (map && map.projectId == scope.projectId) return;
          if (map) map.remove();
          remote.Assessment.EngineeringProcess.getWorkingMap(scope.projectId).then(function(result){
            var project = result.data;
            //console.log('project',result.data)
            if(project.AreaImage){
              remote.Assessment.EngineeringProcess.getWorkingMapDetail(project.AreaImage).then(function(fs){
                if (fs.data.Files.length == 0) return;
                map = L.map(element[0], {
                  crs: L.extend({}, L.CRS, {
                    projection: L.Projection.LonLat,
                    transformation: new L.Transformation(1, 0, 1, 0),
                    scale: function (e) {
                      return 256 * Math.pow(2, e);
                    }
                  }),
                  center: [.48531902026005, .5],
                  zoom: 1,
                  minZoom: 0,
                  maxZoom: 3,
                  scrollWheelZoom: true,
                  annotationBar: false,
                  attributionControl: false
                }),
                  layer = L.tileLayer(sxt.app.api + '/Api/Picture/Tile/{z}_{x}_{y}?size=256&path=~/FileServer/UploadFiles/map.jpg', {
                    noWrap:true,
                    continuousWorld:false,
                    tileSize:256
                  });
                //console.log('picUrl',scope.picUrl)
                map.projectId = scope.projectId;
                layer.addTo(map);
                var feature = {"type":"FeatureCollection",
                  "features":[
                    {"type":"Feature","properties":{}, "geometry":{"type":"Polygon","coordinates":[[[0.76953125,0.330078125],[0.478515625,0.328125],[0.341796875,0.48046875],[0.4375,0.642578125],[0.55078125,0.638671875],[0.693359375,0.44921875],[0.76953125,0.330078125]]]},"options":{"stroke":true,"color":"#ff0000","dashArray":null,"lineCap":null,"lineJoin":null,"weight":4,"opacity":0.5,"fill":true,"fillColor":null,"fillOpacity":0.2,"clickable":true,"smoothFactor":1,"noClip":false}},
                    {"type":"Feature","properties":{},"geometry":{"type":"Polygon","coordinates":[[[0.9296875,0.01953125],[0.103515625,0.015625],[0.08203125,0.056640625],[0.080078125,0.171875],[0.345703125,0.4453125],[0.455078125,0.31640625],[0.771484375,0.3125],[0.9296875,0.01953125]]]},"options":{"stroke":true,"color":"#ff9800","dashArray":null,"lineCap":null,"lineJoin":null,"weight":5,"opacity":0.5,"fill":true,"fillColor":null,"fillOpacity":0.2,"clickable":true,"smoothFactor":1,"noClip":false}}//,
                    //{"type":"Feature","properties":{},"geometry":{"type":"Point","coordinates":[0.345703125,0.44921875]},"options":{"icon":{"options":{"className":"","shadowUrl":null,"iconAnchor":[15,15],"iconSize":[30,30],"iconUrl":"/dp/libs/leaflet/images/photo.png","color":"#9c27b0"},"_initHooksCalled":true},"title":"","alt":"","clickable":true,"draggable":false,"keyboard":true,"zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250}},
                    //{"type":"Feature","properties":{},"geometry":{"type":"Point","coordinates":[0.498046875,0.31640625]},"options":{"icon":{"options":{"className":"","shadowUrl":null,"iconAnchor":[15,15],"iconSize":[30,30],"iconUrl":"/dp/libs/leaflet/images/photo.png","color":"#ff0000"},"_initHooksCalled":true},"title":"","alt":"","clickable":true,"draggable":false,"keyboard":true,"zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250}}
                  ]};
                var myIcon = L.icon({
                  iconUrl: 'assets/js/images/marker-icon-2x.png',
                  iconSize: [40, 40],
                  iconAnchor: [20, 20]
                });
                L.marker([0.345703125,0.44921875], {icon: myIcon}).addTo(map).on('click',function () {
                  ys7.token().then(function (token) {
                    sxt.plugin.playYs7([token,'e5b1c419eeb44175afd6e61e3e225443']);
                  });
                });
                var myIcon2 = L.icon({
                  iconUrl: 'assets/js/images/marker-icon-2x.png',
                  iconSize: [40, 40],
                  iconAnchor: [20, 20]
                });
                L.marker([0.498046875,0.31640625], {icon: myIcon2}).addTo(map).on('click',function () {
                  ys7.token().then(function (token) {
                    sxt.plugin.playYs7([token,'1d11a177ed734bb3bdffe65afc156014']);
                  });
                });;
                L.geoJson(feature).addTo(map);

/*                $(element).click(function(){
                  $state.go('app.xhsc.xxjd.xxjdbuildings',{projectId:scope.projectId,projectName:scope.projectName})
                });*/
              })
            }

          })
        },1000)
      }
      scope.$watch('projectId',ran);
      scope.$on('$destory',function(){

      })
    }
  }
})();

/**
 * Created by emma on 2016/6/15.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .directive('slideUpDown',slideUpDownDirective);

  /**@ngInject*/
  function slideUpDownDirective(){
    return{
      scope:{
        ngValue:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){

      scope.$watch('ngValue',function(){
        if(scope.ngValue){
          $(element).slideDown();
        }else{
          $(element).slideUp();
        }
      })

    }
  }
})();

/**
 * Created by emma on 2016/7/1.
 */
(function(){
  'use strict';

  slideTopView.$inject = ["xhUtils"];
  angular
    .module('app.xhsc')
    .directive('slideTopView',slideTopView);

  /**@ngInject*/
  function slideTopView(xhUtils){
    return {
      scope:{
        slideShow:'=',
        slideRole:'='
      },
      templateUrl:'app/main/xhsc/directive/slideTopView.html',
      link:link
    }
    function link(scope,element,attr,ctrl){
      scope.$watch('slideRole',function(){
        scope.role = scope.slideRole;
       // console.log('role',scope.role)
      })
      scope.addPhoto = function () {
        xhUtils.photo().then(function (image) {
          if(image){
            //scope.data.images.push({
            //  ProblemRecordFileID:sxt.uuid(),
            //  ProblemRecordID:scope.data.p.ProblemRecordID,
            //  CheckpointID:scope.data.v.CheckpointID,
            //  FileID:image
            //});
          }
        });
      }
      scope.playImage = function () {
        var imgs = [{
          url:'app/main/xhsc/images/photo.png',
          alt:'aa'
        },{
          url:'app/main/xhsc/images/photo.png',
          alt:'aa'
        }];
        //scope.data.images.forEach(function (img) {
        //  imgs.push({
        //    src:img.FileID,
        //    alt:''
        //  });
        //})
        xhUtils.playPhoto(imgs);
      }
    }
  }
})();

/**
 * Created by emma on 2016/6/4.
 */
(function(){
  'use strict';

  slideMenuDirective.$inject = ["$state"];
  angular
    .module('app.xhsc')
    .directive('slideMenu',slideMenuDirective);

  /**@ngInject*/
  function slideMenuDirective($state){
    return {
      scope:{
        slideData:'=',
        showCheck:'=',
        halfHeight:'=',
        level:'=',
        projectId:'=',
        areaId:'=',
        current:'=',
        isSC:'=', //是否为实测项
        role:'=',
        assessmentId:'='
      },
      templateUrl:'app/main/xhsc/directive/slideMenu.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.info = {

      };
      scope.selectProcedure = function(item){
        scope.gxlevels = null;
        scope.slideData.forEach(function(t){
          t.SpecialtyChildren.forEach(function(_t){
            _t.checked = false;
          })
        })
        item.checked = true;
        scope.gxlevels = item.WPAcceptanceList;
        console.log('scope.gxlevels',scope.gxlevels)
      }
      scope.$watch('slideData',function(){
        if(!scope.slideData) return;
        console.log('data',scope.slideData)
        if(!scope.slideData.length) return;
        if(scope.slideData[0].SpecialtyChildren.length)
        scope.selectProcedure(scope.slideData[0].SpecialtyChildren[0]);
      })

      scope.changeOrclick = function(item){
        if(item.checked){
          scope.current = null;
        }
        else{
          scope.gxlevels.forEach(function (it) {
            if(item!==it)
              it.checked = false;
          });
          scope.current = item;
        }
      }
      scope.$watch('info.current',function () {
        scope.current = scope.info.current;
      });
      scope.$watch('current',function () {
        scope.info.current = scope.current;
       // console.log('current',scope.current)
      });
      scope.goToLink = function (item) {
        if(!scope.showCheck){
          if (scope.isSC){
            var tmp= {assessmentID:scope.assessmentId,role:scope.role,acceptanceItemID:item.AcceptanceItemID , projectId: scope.projectId, acceptanceItemName:item.AcceptanceItemName, maxRegion: item.maxRegion}
            $state.go('app.xhsc.scsl.scRegion',tmp);
          }else if (scope.role){
            $state.go('app.xhsc.gx.gxhousechoose',{role:scope.role,acceptanceItemID:item.AcceptanceItemID,projectId:scope.projectId,acceptanceItemName:item.AcceptanceItemName,areaId:scope.areaId,maxRegion:item.maxRegion})
          }else {
            $state.go('app.xhsc.gx.zjhouseChoose',{acceptanceItemID:item.AcceptanceItemID,projectId:scope.projectId,acceptanceItemName:item.AcceptanceItemName,areaId:scope.areaId,maxRegion:item.maxRegion})
          }
        }else{
        }
      }
    }
  }
})();

/**
 * Created by emma on 2016/6/4.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .directive('slideHeight',slideHeightDirective);

  /**@ngInject*/
  function slideHeightDirective(){
    return {
      link:link
    }

    function link(scope,element,attr,ctrl){
      var setHeight = function(){
        var iHeight=$(window).height();
        var iToolbar = $('#toptoolbar').height();
        var itbar = $('#toolbar2').height();
        $(element).css({'height':(iHeight-iToolbar-itbar-6)+'px','overflow':'auto'})
      }
      $(window).resize(function(){
        setHeight();
      })
      setHeight()
      //var iHeight=$(window).height();
      //var iToolbar = $('#toptoolbar').height();
      //var itbar = $('#toolbar2').height();
      //$(element).css({'height':(iHeight-iToolbar-itbar-6)+'px','overflow':'auto'})
      //console.log(iHeight)
    }
  }
})();

/**
 * Created by emma on 2016/6/8.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .directive('slideDelete',slideDeleteDirective);

  /**@ngInject*/
  function slideDeleteDirective(){
    return {
      link:link
    }

    function link(scope,element,attr,ctrl){
      var initX,initY;
      var moveX,moveY;
      var X = 0,Y=0;
      var objX = 0,objY=0;
      var isScrolling,isMoved,isTouched;
      function touchstart(event){
        // console.log(e)
        var obj= $(event.target).parents('md-list-item');
        if(obj[0]){
          isMoved = false;
          isTouched = true;
          isScrolling = undefined;
          initX = event.targetTouches[0].pageX;
          initY = event.targetTouches[0].pageY;
          objX =(obj[0].style.WebkitTransform.replace(/translateX\(/g,"").replace(/px\)/g,""))*1;
        }
      }
      function touchmove(event){
        if (!isTouched) return;
        moveX = event.targetTouches[0].pageX;
        moveY = event.targetTouches[0].pageY;
        if (typeof isScrolling === 'undefined') {
          isScrolling = !!(isScrolling || Math.abs(moveY - initY) > Math.abs(moveX - initX));
        }
        if (isScrolling) {
          isTouched = false;
          return;
        }
        var obj= $(event.target).parents('md-list-item');
        if(objX==0){
          if(obj[0] && !isMoved){

            X = moveX - initX;
            Y=moveY - initY;
            //console.log(Y)
            // isMoved = true;
            event.preventDefault();
            //X<0 往左
            //console.log(Y)
            if(X>0){
              obj[0].style.WebkitTransform = "translateX(" + 0 + "px)";
            }else{
              var l = Math.abs(X);
              obj[0].style.WebkitTransform = "translateX(" + -l + "px)";
              if(l>160){
                l=160;
                obj[0].style.WebkitTransform = "translateX(" + -l + "px)";
              }
            }

          }
        }else if(objX<0){
          if(obj[0] && !isMoved){
            moveX = event.targetTouches[0].pageX;
            moveY = event.targetTouches[0].pageY;
            X = moveX - initX;
            Y=moveY - initY;
            // isMoved = true;
            event.preventDefault();
            if(X>0){
              var r = -160 + Math.abs(X);
              obj[0].style.WebkitTransform = "translateX(" + r + "px)";
              if(r>0){
                r=0;
                obj[0].style.WebkitTransform = "translateX(" + r + "px)";
              }
            }else{
              obj[0].style.WebkitTransform = "translateX(" + -160 + "px)";
            }

          }
        }

      }
      function touchend(event){
        if (!isTouched || !isMoved) {
          isTouched = false;
          isMoved = false;
          return;
        }

        isTouched = false;
        isMoved = false;
        var obj= $(event.target).parents('md-list-item');
        if(obj[0]){
          // event.preventDefault();
          objX =(obj[0].style.WebkitTransform.replace(/translateX\(/g,"").replace(/px\)/g,""))*1;
          if(objX>-40){
            obj[0].style.WebkitTransform = "translateX(" + 0 + "px)";
          }else{
            obj[0].style.WebkitTransform = "translateX(" + -160 + "px)";
          }
        }
      }

      window.addEventListener('touchstart',touchstart,false);
      window.addEventListener('touchmove',touchmove,false);
      window.addEventListener('touchend',touchend,false);

    }
  }
})();

/**
 * Created by lss on 2016/9/11.
 */
/**
 * Created by emma on 2016/3/31.
 */
(function(){
  angular
    .module('app.xhsc')
    .directive('sectionFilter',sectionFilter);

  /** @Inject */
  function sectionFilter(){
    p_controller.$inject = ["$timeout", "remote", "$scope", "$q", "$mdSidenav", "$state"];
    return {
      restrict:'EA',
      controllerAs:"vm",
      scope:{
        source:'=',
        gxSelected:"=",
        secSelected:"=",
        level:"="
      },
      controller:p_controller,
      link:link,
      templateUrl:"app/main/xhsc/directive/sectionFilter.html",
    }
    function  p_controller($timeout,remote,$scope,$q,$mdSidenav,$state ){
      var vm = this;
      if (! $scope.gxSelected){
        $scope.gxSelected=[];
      }
      if (!$scope.secSelected){
        $scope.secSelected=[];
      }
      $scope.submit=function(){
        var gxSelected=$scope.gxSelected;
        var secSelected= $scope.secSelected
        $state.go("app.pcReport_sl_rp",{
          scSelected:"",
          secSelected:secSelected.length?secSelected[secSelected.length-1].RegionID:""
        });
      }
      if ($scope.level){
        $scope.level=parseInt($scope.level);
      }
      vm.removeRegion=function(chip){
        if (chip.index||chip.index===0){
          for (var  i=chip.index;i<vm.ngModel.length;i++){
            vm.ngModel[i]=null;
          }
        }
        for (var i=$scope.secSelected.length-1;i>=0;i--)
        {
          if ($scope.secSelected[i].RegionID.toString().length>chip.RegionID.toString().length){
            $scope.secSelected.splice(i,1);
          }
        }
      }
      vm.secSource=[[],[],[],[],[]];
      vm.ngModel=[null,null,null,null,null]
      $scope.secSelected=[]
      if ($scope.source.then){
        $scope.source.then(function(r){
            if (r&& r.data&&angular.isArray( r.data)){
              r.data.forEach(function(k){
                vm.secSource[0].push({
                  RegionID: k.ProjectID,
                  RegionName: k.ProjectName
                });
              });
            }
        })
      }
      if (angular.isArray($scope.source)){
        vm.secSource[0]=$scope.source;
      }
      vm.getChild=function(item){
        $timeout(function(){
          function child(){
            return  remote.Project.GetAreaChildenbyID(item.RegionID);
          }
          switch ((""+item.RegionID).length){
            case 5:
              item.index=0;
              child().then(function(r){
                vm.secSource[1]= r.data;
              });
              break;
            case 10:
              item.index=1;
              child().then(function(r){
                vm.secSource[2]= r.data;
              });
              break;
            case 15:
              item.index=2;
              child().then(function(r){
                vm.secSource[3]= r.data;
              });
              break;
            case 20:
              item.index=3;
              child().then(function(r){
                vm.secSource[4]= r.data;
              });
              break;
            case 25:
              item.index=4;
              child().then(function(r){
                vm.secSource[5]= r.data;
              });
              break;
          }
          $scope.secSelected.push(item);
        })
      }

      remote.Procedure.queryProcedure().then(function(r){
        if (r.data&&angular.isArray(r.data)){
          $scope.procedures= r.data;
        }
      });

      $scope.acceptanceItem=[];
      $scope.remove=function(item){
        $timeout(function(){
          var index=$scope.gxSelected.indexOf(item);
          if (index>-1){
           $scope.gxSelected.splice(index,1);
            initGxName();
          }
        })
      }
      $scope.choosego=function(item){
        var p=$scope.gxSelected.find(function(o){
          return o.AcceptanceItemID==item.AcceptanceItemID;
        });
        if (!p&&!item.checked){
          $scope.gxSelected.push(item)
        }
        if (p&&item.checked){
          var index=$scope.gxSelected.indexOf(p);
          $scope.gxSelected.splice(index,1);
        }
        initGxName();
      }
      $scope.ok=function(){
        $mdSidenav("right")
          .toggle();
      }
      $scope.selectSpecialtyLow=function(item,parent){
        parent.WPAcceptanceList=item.WPAcceptanceList;
      }
      $scope.click=function(){
        $mdSidenav("right")
          .toggle()
      }
      function initGxName(){
        var attr=[];
        $scope.gxSelected.forEach(function(k){
          attr.push(k.AcceptanceItemName);
        });
        $scope.gxNames= attr.join(',');
      }
    }
    function  link(scope,element,attr,ctrl){
    }
  }
})();

/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  angular
    .module('app.xhsc')
    .directive('ryMenu',ryMenuDirective);

  /**@ngInject*/
  function ryMenuDirective(){
    return {
      scope:{
        ryData:'='
      },
      templateUrl:'app/main/xhsc/directive/rymenu.html',
      link:link
    }

    function link(scope,element,attr,ctrl){
      //var resize = function(){
      //  var iHeight = $(element).parent().height();
      //  var iWh= $(window).height();
      //  var iToolbar = $('#toptoolbar').height();
      //  var itbar = $('#toolbar2').height();
      //  if(scope.halfHeight){
      //    $('.list-left',element).css({'height':(iHeight)+'px','overflow':'auto'});
      //    $('.list-right',element).css({'height':(iHeight)+'px','overflow':'auto'})
      //  }else{
      //    $('.list-left',element).css({'height':(iWh-iToolbar-itbar-6)+'px','overflow':'auto'});
      //    $('.list-right',element).css({'height':(iWh-iToolbar-itbar-6)+'px','overflow':'auto'})
      //  }
      //}
      //resize();
      //$(window).resize(function(){
      //  resize();
      //})

      console.log(scope.ryData)
    }
  }
})();

/**
 * Created by emma on 2016/3/31.
 */
(function(){
  angular
    .module('app.xhsc')
    .directive('proceduce',proceduce);

  /** @Inject */
  function proceduce(){
    p_controller.$inject = ["$timeout", "remote", "$scope", "$q", "$mdDialog"];
    return {
      restrict:'EA',
      scope:{
        selected:'=',
      },
      controller:p_controller,
      link:link,
      template:' <div layout="row" ng-click="click()"> <md-input-container md-theme="default" flex> <label>工序</label> <div> <input ng-model="gxNames" disabled/> <md-button class="md-icon-button md-primary" style="position: absolute;right: -8px;" aria-label="Settings"> <md-icon  md-font-icon="icon-magnify" class="icon s24"></md-icon> </md-button> </div> </md-input-container> </div>'
    }
    function  p_controller($timeout,remote,$scope,$q,$mdDialog){
       $scope.selected=[];
       remote.Procedure.queryProcedure().then(function(r){
         if (r.data&&angular.isArray(r.data)){
           $scope.procedures= r.data;
         }
       });

      $scope.click=function(){
        function gxController(){
          var self=this;
          self.selected=$scope.selected;
          self.acceptanceItem=[];
          self.remove=function(item){
            $timeout(function(){
              var index=self.selected.indexOf(item);
              if (index>-1){
                $scope.gxNames= self.selected.splice(index,1);
              }
            })
          }
          self.choosego=function(item){
            var p=self.selected.find(function(o){
              return o.AcceptanceItemID==item.AcceptanceItemID;
            });
            if (!p&&!item.checked){
              self.selected.push(item)
            }
            if (p&&item.checked){
              var index=self.selected.indexOf(p);
              self.selected.splice(index,1);
            }
          }
          self.ok=function(){
            var attr=[];
            self.selected.forEach(function(k){
              attr.push(k.AcceptanceItemName);
            });
            $scope.gxNames= attr.join(',');
            $mdDialog.hide();
          }
          self.close=function(){
            //$scope.selected=self.selected=[];
            $mdDialog.cancel();
          }
          self.selectSpecialtyLow=function(item,parent){
              parent.WPAcceptanceList=item.WPAcceptanceList;
          }
          $q(function(resolve,reject){
            if ($scope.procedures){
              resolve($scope.procedures);
            }else {
              remote.Procedure.queryProcedure().then(function(r){
                $scope.procedures= r.data;
                resolve($scope.procedures);
              }).catch(function(r){
                reject(r);
              })
            }
          }).then(function(result){
            var procedures= $.extend(true,{},result)
            self.procedures=procedures;
          });
        }

        $mdDialog.show({
          controller:gxController,
          controllerAs:"ctrl",
          templateUrl:"/app/main/xhsc/directive/proceduce.html",
          parent: angular.element(document.body),
          clickOutsideToClose:true,
          fullscreen: true
        });
      }
    }
    function  link(scope,element,attr,ctrl){
    }
  }
})();

(function(){
  photoDraw.$inject = ["$cordovaCamera", "$timeout", "$mdDialog"];
  angular
    .module('app.xhsc')
    .directive('photoDraw',photoDraw);

  /** @Inject */
  function photoDraw($cordovaCamera,$timeout,$mdDialog){
    return {
      restrict:'E',
      scope:{
        onCancel:'&',
        onAnswer:'&',
        waterText:'='
      },
      templateUrl:'app/main/xhsc/directive/photoDraw.html',
      link:link

    }
    function  link(scope,element,attr,ctrl){

      scope.color = 'red';
      scope.is = function (color) {
        return scope.color == color ?'1px':'0';
      };
      scope.setColor = function (color) {
        scope.color = color;
      }


      var canvas, ctx, flag = false,
        prevX = 0,
        currX = 0,
        prevY = 0,
        currY = 0,
        dot_flag = false,
        radio =1,
        parent,
      width,
        height,
      offset,
      srcWidth,srcHeight,
        image;

      canvas = $('canvas',element)[0];

      ctx = canvas.getContext("2d");

      canvas.addEventListener("mousemove", function (e) {
        findxy('move', e)
      }, false);
      canvas.addEventListener("touchmove", function (e) {
        findxy('move', e)
      }, false);
      canvas.addEventListener("mousedown", function (e) {
        findxy('down', e)
      }, false);
      canvas.addEventListener("touchstart", function (e) {
        findxy('down', e)
      }, false);
      canvas.addEventListener("mouseup", function (e) {
        findxy('up', e)
      }, false);
      canvas.addEventListener("touchend", function (e) {
        findxy('up', e)
      }, false);
      canvas.addEventListener("mouseout", function (e) {
        findxy('out', e)
      }, false);



      function draw() {
        //if(Math.abs(prevY/radio-currY/radio)>20)return;
        ctx.beginPath();
        ctx.moveTo(prevX/radio, prevY/radio);
        ctx.lineTo(currX/radio, currY/radio);
        ctx.strokeStyle = scope.color;
        //ctx.strokeStyle = x;
        //ctx.lineWidth = y;
        ctx.stroke();
        ctx.closePath();
      }
      scope.cancel = function () {
       scope.onCancel && scope.onCancel();
      }
      scope.erase = function () {
        if(image){
          ctx.clearRect(0, 0, srcWidth, srcHeight);
          ctx.drawImage(image, 0, 0,image.width,image.height,0,0,srcWidth,srcHeight);
        }
      }
      scope.save =  function () {
        var dataURL = canvas.toDataURL('image/jpeg',0.5);
        scope.onAnswer && scope.onAnswer({$base64Url:dataURL});
      }

      function findxy(res, e) {
        if(!e.clientX &&(!e.touches || !e.touches[0] ||!e.touches[0].clientX))return;
        if (res == 'down') {
          prevX = currX;
          prevY = currY;
          currX = (e.clientX || e.touches[0].clientX)- canvas.offsetLeft;
          currY = (e.clientY || e.touches[0].clientY) - canvas.offsetTop-offset;
          flag = true;

        }
        if (res == 'up' || res == "out") {
          flag = false;
        }
        if (res == 'move') {
          //console.log('e.touches[0].x,y',e.touches[0].clientX,e.touches[0].clientY)
          if (flag) {
            prevX = currX;
            prevY = currY;
            currX = (e.clientX || e.touches[0].clientX) - canvas.offsetLeft;
            currY = (e.clientY || e.touches[0].clientY) - canvas.offsetTop - offset;
            draw();
          }
        }
      }
      $timeout(function () {
          parent = $('canvas',element).parent();
          width =parent.width();
        height =parent.height();
          offset = $('#toptoolbar').height();
        $('canvas',element).width(width)
          .height(height);
        ctx.canvas.width = width;
        ctx.canvas.height = height;
      },1000);
      scope.photo = function ($event) {
        if ($event) {
          $event.preventDefault ();
          $event.stopPropagation ();
        }
        $cordovaCamera.getPicture ({
          quality: 50,
          destinationType: 0,
          // sourceType: s,
          allowEdit: false,
          encodingType: 0,
          targetHeight:600,
          encodingType:0,
          saveToPhotoAlbum: true,
          correctOrientation: true
        }).then (function (imageData) {
          if (imageData) {
            image = new Image();
            image.onload = function() {
              if(image.width>600 || image.height>600){
                var rd = 600/Math.max(image.width,image.height);
                srcWidth = image.width*rd;
                srcHeight = image.height*rd;
              }
              else{
                srcWidth = image.width;
                srcHeight = image.height;
              }
              radio = height/srcHeight;
              width = srcWidth * radio;
              //$('canvas',element).width(width);
              ctx.canvas.width = srcWidth;
              ctx.canvas.height = srcHeight;
              ctx.lineWidth =  srcWidth*2/350;
              ctx.drawImage(image, 0, 0,image.width,image.height,0,0,srcWidth,srcHeight);
              if (scope.waterText){
                ctx.font="20px microsoft yahei";
                ctx.fillStyle = "rgba(255,255,255,0.5)";
                ctx.textAlign="right"
                ctx.fillText(scope.waterText,srcWidth-10,srcHeight-10);
              }
            }
            image.src = "data:image/jpeg;base64," + imageData;
          }
          else{
            scope.cancel();
          }
        }, function (err) {
          scope.cancel();

        });
      }
      scope.photo();
    }
  }
})();

/**
 * Created by lss on 2016/9/2.
 */
/**
 * Created by emma on 2016/3/31.
 */
(function(){
  angular
    .module('app.xhsc')
    .directive('parentFullHeight',parentFullHeight);

  /** @Inject */
  function parentFullHeight(){
    return {
      restrict:'A',
      scope:{

      },
      link:link
    }
    function  link(scope,element,attr,ctrl){
      //var  parent=element.parent();
      //parent.css("height,600px");
    }
  }
})();

/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  myDialogDirective.$inject = ["$state", "$timeout", "remote", "utils", "auth", "sxt", "$mdDialog", "api"];
  angular
    .module('app.xhsc')
    .directive('myDialog',myDialogDirective);

  /**@ngInject*/
  function myDialogDirective($state,$timeout,remote,utils,auth,sxt,$mdDialog,api){
    return {
      scope:{
        dialogShow:'=',
        dialogData:'=',
        dialogSure:'@',
        dialogMsg:'@',
        callBack:"&"
      },
      templateUrl:"app/main/xhsc/directive/mydialog.html",
      link:link,
      controller:["$scope", function($scope){
        $scope.description="";
      }]
    }
    function link(scope,element,attr,ctrl){
      $(element).appendTo('body');
      $('.my-dialog-mask',element).fadeOut();
      scope.$watch('dialogShow',function(){
        if(scope.dialogShow){
          $('.my-dialog-mask',element).fadeIn();
          scope.description="";
        }
        if(scope.dialogSure != '报验'){
          scope.logOut= true;
        }
      })
      scope.$watch('dialogData',function(){
        if(!scope.dialogData) return;
        var msg='';
        scope.max=0;
        scope.dialogData.Rows.forEach(function(t){
          msg += t.projectTree+'，';
          var percent=0;
          t.inspectionRows.forEach(function (s) {
            percent+=s.Percentage;
          })
          percent=100-percent;
          if (scope.max<percent){
            scope.max=percent;
          }
          $timeout(function () {
            scope.percentage=scope.max;
          },300)
        })
        scope.dialogMsg = msg + scope.dialogData.acceptanceItemName+ '工序已自检完毕，请监理验收';
      })
      scope.cancel= function(){
        scope.dialogShow = false;
        $('.my-dialog-mask',element).fadeOut();
      }
      scope.submit = function(evt){
        DialogController.$inject = ["$scope"];
        var parentEl = angular.element(document.body);
        $mdDialog.show({
          parent: parentEl,
          targetEvent: evt,
          template:'<md-dialog   ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在提交数据，请稍候……</md-dialog-content></md-dialog>',
          controller: DialogController
        });
        function DialogController($scope) {
          scope.dialogShow = false;
          scope.areaIds=[];
          $('.my-dialog-mask',element).fadeOut();
          if(scope.dialogSure == '报验'){
            var percentage= scope.percentage?scope.percentage:100
            scope.dialogData.Rows.forEach(function(t){
              scope.areaIds.push( {
                AreaID:t.RegionID,
                Describe:scope.description,
                Percentage:percentage
              });
            })
            var params ={
              AcceptanceItemID:scope.dialogData.acceptanceItemID,
              AreaList:scope.areaIds,
              Describe:scope.description,
              Percentage:percentage,
              id:sxt.uuid()
            }
            api.setNetwork(0).then(function(){
              remote.Procedure.postInspection(params).then(function(result){
                if (result.data.ErrorCode==0) {
                  $timeout(function () {
                    scope.callBack();
                  },300);
                  $mdDialog.hide();
                }
              }).catch(function(){
                $mdDialog.cancel();
              });
            });
          }else{
            $mdDialog.hide();
          }
        }
      }
      scope.$on('$destroy', function () {
        $(element).remove()
      });
    }
  }
})();

/**
 * Created by emma on 2016/3/31.
 */
(function(){
  mapPopup.$inject = ["mapPopupSerivce"];
  angular
    .module('app.xhsc')
    .directive('mapPopup',mapPopup);

  /** @Inject */
  function mapPopup(mapPopupSerivce){
    return {
      restrict:'A',
      scope:{
        popup:'@mapPopup'
      },
      link:link
    }
    function  link(scope,element,attr,ctrl){
      mapPopupSerivce.set(scope.popup,{
        el:element,
        scope:scope
      });
      scope.$on('$destroy',function(){
        mapPopupSerivce.remove(scope.popup);
      })
    }
  }
})();

/**
 * Created by jiuyuong on 2016/6/6.
 */
(function () {
  'use strict';
  fullscreen.$inject = ["$window", "$mdDialog"];
  angular
    .module('app.xhsc')
    .directive('fullscreen',fullscreen);
  /** @ngInject */
  function fullscreen($window,$mdDialog) {
    var isSetting =false;
    return {
      link:link
    }
    function link(scope,element){
      if(isSetting)return;
      isSetting = true;
      var document = element[0].ownerDocument;
      if (!document.fullscreenElement &&
        !document.mozFullScreenElement && !document.webkitFullscreenElement) {  // current working methods
        $mdDialog.show({
          controller: ['$scope', '$mdDialog',function($scope, $mdDialog){
            $scope.cancel = function() {
              $mdDialog.cancel();
            };
            $scope.answer = function() {
              $mdDialog.hide();
              var d = document.documentElement || document;
              if (d.requestFullscreen) {
                d.requestFullscreen();
              } else if (d.mozRequestFullScreen) {
                d.mozRequestFullScreen();
              } else if (d.webkitRequestFullscreen) {
                d.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
              }
            };
          }],
          template:'<md-dialog aria-label="全屏"  ng-cloak>' +
          ' <md-toolbar><div class="md-toolbar-tools">全屏?</div></md-toolbar>' +
          '<md-dialog-content>是否全屏显示窗口?</md-dialog-content>' +
          '<md-dialog-actions layout="row"> <md-button ng-click="cancel()">否</md-button><span flex></span> <md-button fast-click="answer()" >是</md-button></md-dialog-actions>' +
          '</md-dialog>',
          parent: element,
          clickOutsideToClose: true
        });
      }
    }
  }
})();

/**
 * Created by emma on 2016/2/19.
 */

(function() {
  'use strict';

  floorLayerDirective.$inject = ["$timeout", "xhscService"];
  angular
    .module('app.xhsc')
    .directive('floorLayer', floorLayerDirective);

  /** @ngInject */
  function floorLayerDirective($timeout,xhscService){
    return {
      restrict:'EA',
      scope:{
        floorData:'=sxtfloor',
        floorNum: '=',
        sellLine:'=',
        buildLen:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){

      //element.click(function(){
        //var floorData=[50,50,20,10,30];
      scope.$watch('floorNum',function(){
        if(!scope.floorNum) return;
      //console.log('floorNum',scope.floorNum)
      var sellLine = scope.floorData.sellLine, gx1 = scope.floorData.gx1, gx2 = scope.floorData.gx2;
      if (gx1 > scope.floorData.floors) gx1 = scope.floorData.floors;
      if (gx2 > scope.floorData.floors) gx2 = scope.floorData.floors;
        var str=[];
        var iFloorHeight= 0,itemp,iWinHeight;
        var zoom=0;

        str.push('<div class="floor-layer"><div class="item" flex>\
          <a>\
          <div class="whole"><ul class="whole-progress">');
      for (var i = Math.max(gx1, gx2) ; i >= 1; i--) {
        if (i == sellLine) {
          str.push('<li class="build-m-presell" style="z-index:' + i + '"></li>')
        }
        else {
          if (gx2 >= i) {
            str.push('<li class="wall-m" style="z-index:' + i + '"></li>')
          }
          else {
            str.push('<li class="build-m" style="z-index:' + i + '"></li>')
          }
        }
      }

        str.push('<li class="build-b"></li></ul><ul class="whole-target">');
        str.push('<li class="wall-t" style="z-index:'+scope.floorData.floors+'"></li>');
      var totalFloors = scope.floorData.floors;
        while((totalFloors--)){
          if(totalFloors == sellLine){
            str.push('<li class="wall-m-presell" style="z-index:'+totalFloors+'"></li>');
          }else{
            str.push('<li class="wall-m" style="z-index:'+totalFloors+'"></li>');
          }

        }
        str.push('<li class="build-b"></li></ul></div><p>'+scope.floorData.name+'('+Math.max(gx1, gx2)+'/'+scope.floorData.floors+'层)<br/>&nbsp;'+scope.floorData.summary+'</p></a></div></div>');
      var o = $(str.join('')).appendTo(element);
      var iWinWidth = $(window).width();

      //itemp=(scope.floorNum)*18+107+34+50;
       itemp=(scope.floorNum)*17+143+120;

      iWinHeight = $(window).height()-130;
      var newobj={},iflayerWidth=0;
      newobj = xhscService.getZ(iWinWidth,iWinHeight,scope.buildLen,500,itemp);
       //zoom = newobj.z;
        zoom = iWinHeight/newobj.y/itemp;
        iflayerWidth = (1/newobj.x)*iWinWidth;
        $('#floorlayer').css('width',100+'%');
        iFloorHeight = itemp*zoom;
        //console.log('heights',itemp,iFloorHeight,iWinHeight,newobj.z,zoom)
        $('.floor-layer').css({'height':iFloorHeight+'px','width':iflayerWidth+'px'});
        var iFh=(iFloorHeight-50)/itemp;
        $('.whole',element).css({'zoom':iFh});
        scope.$on('$destroy',function(){
          o.remove();
          $(element).remove();
        });
      })
    }
  }

})();


/**
 * Created by jiuyuong on 2016/6/1.
 */
(function () {
  'use strict';
  angular
    .module('app.xhsc')
    .directive('fixScrollbarWidth',fixScrollbarWidth)
  /** @ngInject */
  function fixScrollbarWidth() {

    return {
      scope:{
        parent:'@fixScrollbarWidth'
      },
      link:function (scope,element) {
        var p =$(scope.parent, element.parents('md-tab-content')[0])[0];
        scope.$watch(function () {
          return p.offsetWidth - p.clientWidth;
        },function () {
          resetWidth(p,element);
        })

      }
    }

    function resetWidth(p,el) {
        var w = p.offsetWidth - p.clientWidth +1;
        el.width(w);
    }
  }
})();

/**
 * Created by lss on 2016/6/2.
 */
/**
 * Created by jiuyuong on 2016/6/1.
 */
(function () {
  'use strict';
  fitTableHeight.$inject = ["$timeout"];
  angular
    .module('app.xhsc')
    .directive('fitTableHeight',fitTableHeight)
  /** @ngInject */
  function fitTableHeight($timeout) {
    return {
      link:function (scope,element) {
        $timeout(function(){
          var p =element.parent()[0];

          element.css("min-height",p.offsetHeight>49?p.offsetHeight:49);
        });
        //scope.$watch(function () {
        //  return p.offsetHeight;
        //},function () {
        //  element.height(p.offsetHeight);
        //})
      }
    }
  }
})();

/**
 * Created by emma on 2016/6/24.
 */
(function(){
  'use strict';

  buildingListDirective.$inject = ["api"];
  angular
    .module('app.xhsc')
    .directive('buildingList',buildingListDirective);

  /**@ngInject*/
  function buildingListDirective(api){
    return {
      scope:{
        data:'=sxtfloor',
        floorNum:'=floorNum',
        buildsLen:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('data',function(){
        if(!scope.data) return;
        //console.log('floorNum',scope.data)
        var sellFloor = scope.data.sellLine, gx1 = scope.data.gx1, gx2 = scope.data.gx2,sellLine;
        if (gx1 > scope.data.floors) gx1 = scope.data.floors;
        if (gx2 && gx2 > scope.data.floors){
          gx2 = scope.data.floors
        }else{
          gx2 = 0;
        }
        if(sellFloor < 1 ){
          sellLine = parseInt(scope.data.floors * sellFloor);
        }else{
          sellLine = sellFloor;
        }
        var str=[];
        var iFloorHeight= 0,itemp,iWinHeight;
        var zoom=0;

        str.push('<div class="floor-layer"><div class="item" flex>\
          <a>\
          <div class="whole"><ul class="whole-progress">');
        for (var i = Math.max(gx1, gx2) ; i >= 1; i--) {
          if (i == sellLine) {
            str.push('<li class="build-m-presell" style="z-index:' + i + '"></li>')
          }
          else {
            if (gx2 >= i) {
              str.push('<li class="wall-m" style="z-index:' + i + '"></li>')
            }
            else {
              str.push('<li class="build-m" style="z-index:' + i + '"></li>')
            }
          }
        }

        str.push('<li class="build-b"></li></ul><ul class="whole-target">');
        str.push('<li class="wall-t" style="z-index:'+scope.data.floors+'"></li>');
        var totalFloors = scope.data.floors;
        while((totalFloors--)){
          if(totalFloors == sellLine){
            str.push('<li class="wall-m-presell" style="z-index:'+totalFloors+'"></li>');
          }else{
            str.push('<li class="wall-m" style="z-index:'+totalFloors+'"></li>');
          }

        }
        str.push('<li class="build-b"></li></ul></div><p>'+scope.data.name+'('+Math.max(gx1, gx2)+'/'+scope.data.floors+'层)<br/>&nbsp;'+scope.data.summary+'</p></a></div></div>');
        var o = $(str.join('')).appendTo(element);
        var iWinWidth = $(window).width();

        //itemp=(scope.floorNum)*18+107+34+50;
        itemp=(scope.floorNum)*17+143+50;

        iWinHeight = $(window).height()-130;
        var newobj={},iflayerWidth=0;
        //console.log(api)
        newobj = api.xhsc.Assessment.sxtHouseService.getZ(iWinWidth,iWinHeight,scope.buildsLen,500,itemp);
        //zoom = newobj.z;
        zoom = iWinHeight/newobj.y/itemp;
        iflayerWidth = (1/newobj.x)*iWinWidth;
        $('#floorlayer').css('width',100+'%');
        iFloorHeight = itemp*zoom;
        //console.log('heights',itemp,iFloorHeight,iWinHeight,newobj.z,zoom)
        $('.floor-layer').css({'height':iFloorHeight+'px','width':iflayerWidth+'px'});
        var iFh=(iFloorHeight-50)/itemp;
        //console.log('a',scope.buildsLen)
        $('.whole',element).css({'zoom':iFh});
        scope.$on('$destroy',function(){
          o.remove();
          $(element).remove();
        });
      })
    }
  }
})();

/**
 * Created by emma on 2016/6/24.
 */
(function(){
  'use strict';

  buildingDetailDirective.$inject = ["api"];
  angular
    .module('app.xhsc')
    .directive('buildingDetail',buildingDetailDirective);

  /**@ngInject*/
  function buildingDetailDirective(api){
    return {
      scope:{
        data:'=buildData',
        bdetailData:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('data',function(){
        if(!scope.data) return;
        console.log('floorNum',scope.data)
        var sellFloor = scope.data.sellLine, gx1 = scope.data.gx1, gx2 = scope.data.gx2,sellLine;
        if (gx1 > scope.data.floors) gx1 = scope.data.floors;
        if (gx2 && gx2 > scope.data.floors){
          gx2 = scope.data.floors
        }else{
          gx2 = 0;
        }
        if(sellFloor < 1 ){
          sellLine = parseInt(scope.data.floors * sellFloor);
        }else{
          sellLine = sellFloor;
        }
        var str=[];
        var iFloorHeight= 0,itemp,iWinHeight;
        var zoom=0;
        str.push('<div class="floor-layer1"><div class="item" flex>\
          <a>\
          <div class="whole"><ul class="whole-progress">');
        for (var i = Math.max(gx1, gx2) ; i >= 0; i--) {
          if (i == sellLine) {
            str.push('<li class="build-m-presell" style="z-index:' + i + '"></li>')
          }
          else {
            if (gx2 >= i) {
              str.push('<li class="wall-m" style="z-index:' + i + '"></li>')
            }
            else {
              str.push('<li class="build-m" style="z-index:' + i + '"></li>')
            }
          }
        }

        str.push('<li class="build-b"></li></ul><ul class="whole-target">');

        str.push('<li class="wall-t" style="z-index:' + scope.data.floors + '"></li>');
        var totalFloors = scope.data.floors;
        while (totalFloors--) {
          if (totalFloors == sellLine) {
            str.push('<li class="wall-m-presell" style="z-index:' + totalFloors + '"></li>');
          } else {
            str.push('<li class="wall-m" style="z-index:' + totalFloors + '"></li>');
          }
        }
        str.push('<li class="build-b"></li></ul><div style="position:relative;bottom:0;left:175px;z-index:100;min-width:200%;" class="newlayer">');
        var temparr = [];
        var temparr2 = [];
        angular.forEach(scope.bdetailData[0].datapoints, function (v, k) {
          var find = temparr.find(function (v1) { return v1.y == v.y });
          if (!find) {
            find = {
              y: v.y,
              x: v.x
            };
            temparr.push(find)
          }
          else {
            find.x += ';' + v.x;
          }
        })
        angular.forEach(temparr, function (v, k) {
          if(!v.y)return;
          var iBottom = v.y * 18 + 60;
          str.push('<div style="height:18px;position:absolute;bottom:' + iBottom + 'px;"><span style="height:4px;width:30px;background:#f00;display:block;float:left;margin-top:6px;"></span><span style="display:block;margin-left:35px;border:1px solid #ddd;background:#fff;text-align:left;padding:3px;">' +v.y+'层'+ v.x + '<span><span style="clear:both;"></span></div>');
        })

        str.push('<div style="height:55px;"></div></div></div><p>' + scope.data.name + '('+ Math.max(gx1, gx2) +'/' + scope.data.floors + '层)<br/>&nbsp;' + scope.data.summary +'</p></a></div></div>');

        //str.push('<div class="floor-layer1"><div class="item" flex>\
        //  <a>\
        //  <div class="whole"><ul class="whole-progress">');
        //for (var i = Math.max(gx1, gx2) ; i >= 1; i--) {
        //  if (i == sellLine) {
        //    str.push('<li class="build-m-presell" style="z-index:' + i + '"></li>')
        //  }
        //  else {
        //    if (gx2 >= i) {
        //      str.push('<li class="wall-m" style="z-index:' + i + '"></li>')
        //    }
        //    else {
        //      str.push('<li class="build-m" style="z-index:' + i + '"></li>')
        //    }
        //  }
        //}
        //str.push('<li class="build-b"></li></ul><ul class="whole-target">');
        //str.push('<li class="wall-t" style="z-index:'+scope.data.floors+'"></li>');
        //var totalFloors = scope.data.floors;
        //while((totalFloors--)){
        //  if(totalFloors == sellLine){
        //    str.push('<li class="wall-m-presell" style="z-index:'+totalFloors+'"></li>');
        //  }else{
        //    str.push('<li class="wall-m" style="z-index:'+totalFloors+'"></li>');
        //  }
        //}
        //str.push('<li class="build-b"></li></ul></div><p>'+scope.data.name+'('+Math.max(gx1, gx2)+'/'+scope.data.floors+'层)<br/>&nbsp;'+scope.data.summary+'</p></a></div></div>');
        var o = $(str.join('')).appendTo(element);
        var iWinWidth = $(window).width();

        //itemp=(scope.floorNum)*18+107+34+50;
        itemp=(scope.data.floors)*17+143+50;
        //console.log(itemp)
        iWinHeight = $(window).height()-100;
        var detailH = parseInt(iWinHeight/2);
        var izoom = detailH/itemp;
        var fwidth = $('.whole-target').width();
        $('.floor-layer1').css({'height':detailH+'px','width':fwidth+'px','margin':'0 auto'});
        var iFh=(detailH-50)/itemp;
        //console.log('a',scope.buildsLen)
        $('.whole',element).css({'zoom':iFh});
        scope.$on('$destroy',function(){
          o.remove();
          $(element).remove();
        });
      })
    }
  }
})();

/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/7/1.
 */
(function () {
  'use strict';

  cycleLookRectifyController.$inject = ["$state", "$rootScope", "$scope", "$mdDialog", "remote", "$timeout", "$q", "utils", "xhUtils", "api"];
  angular
    .module('app.xhsc')
    .controller('cycleLookRectifyController', cycleLookRectifyController);

  /** @ngInject */
  function cycleLookRectifyController($state, $rootScope, $scope, $mdDialog, remote, $timeout, $q, utils, xhUtils, api) {
    var vm = this;//cycle
    $rootScope.title = $state.params.Role == 'zb' ? '整改' : '复验';
    vm.role = $state.params.Role;
    vm.InspectionID = $state.params.InspectionID;


    api.setNetwork(1).then(function () {
      remote.safe.getRectificationsWrap.cfgSet({
        offline:true,
        filter:function (item) {
          return item.InspectionExtendID==vm.InspectionID;
        }
      })("cycle").then(function (r) {
        var bacth=angular.isArray(r.data)?r.data[0]:null;
        vm.pareaList=[];
        if (bacth){
          bacth.Rectifications.forEach(function (k) {
            if (k.Children){
              k.Children.forEach(function (m) {
                if (k.AcceptanceItemName.indexOf("钢筋")>-1&&!vm.pareaList.some(function (z) {
                    return z.AreaID==m.AreaID&&z.AcceptanceItemName.indexOf("钢筋")<-1;
                  })){
                  m.AcceptanceItemID=k.AcceptanceItemID;
                  m.AcceptanceItemName=k.AcceptanceItemName;
                  m.RegionName=m.RegionName+'('+ m.AcceptanceItemName+')';
                  m.isGj=true;
                  vm.pareaList.push(m);
                }else {
                  if (!vm.pareaList.some(function (z) {
                      return z.AreaID==m.AreaID;
                    })){
                    m.AcceptanceItemID=k.AcceptanceItemID;
                    m.AcceptanceItemName=k.AcceptanceItemName;
                    vm.pareaList.push(m);
                  }
                }
              })
            }
          });
          if (vm.pareaList.length>0){
            vm.regionSelect = vm.pareaList[0];
            vm.regionSelect.hasCheck = true;
            vm.AcceptanceItemName=vm.regionSelect.AcceptanceItemName;
            vm.warter = vm.regionSelect.RegionName + bacth.Describe;;
          }
        }
      });
      vm.info = {}

      vm.selectQy = function (item,noValid) {
        if (vm.regionSelect==item){
          vm.qyslideShow = false;
          return;
        }
        if (noValid){
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.qyslideShow = false;
          return;
        }
        $q(function (resolve,reject) {
          if (vm.points.length){
            switch ($state.params.Role){
              case "zb":
                if (vm.points.find(function (k) {
                    return k.Status!=16;
                  })){
                  utils.confirm("点位尚未全部整改,是否继续下一个区域",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve()
                }
                break;
              default:
                if (vm.points.find(function (k) {
                    return k.Status!=2;
                  })){
                  utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                    resolve();
                  })
                }else {
                  resolve()
                }
                break;
            }
          }else {
            resolve();
          }
        }).then(function () {
          vm.regionSelect = item;
          vm.regionSelect.hasCheck = true;
          vm.AcceptanceItemID=item.AcceptanceItemID;
          vm.AcceptanceItemName=item.AcceptanceItemName;
          vm.qyslideShow = false;
        })
      }
      vm.qyslide = function () {
        vm.qyslideShow = !vm.qyslideShow;
      }
      $scope.times = xhUtils.zgDays();
      var gxzgChanged = $rootScope.$on('sendGxResult', function () {

        function valid() {
          function next() {
            return  $q(function (resolve,reject) {
              var msg = [],noChecked=[];
              vm.pareaList.forEach(function (r) {
                if (!r.hasCheck) {
                  msg.push(r.RegionName);
                  noChecked.push(r);
                }
              });
              if (msg.length) {
                utils.confirm(msg.join(",") + '尚未查看,去看看?',null,"确定","取消").then(function () {
                  vm.selectQy(noChecked[0],true);
                }).catch(function () {
                });
              }else {
                resolve();
              }
            })
          }
          return  $q(function (resolve,reject) {
            if (vm.points.length){
              switch ($state.params.Role){
                case "zb":
                  if (vm.points.find(function (k) {
                      return k.Status!=16;
                    })){
                    utils.confirm("点位尚未全部整改,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
                default:
                  if (vm.points.find(function (k) {
                      return k.Status!=2;
                    })){
                    utils.confirm("点位尚未全部合格,是否继续提交",null,"继续","取消").then(function () {
                      return next();
                    }).then(function () {
                      resolve();
                    })
                  }else {
                    return next().then(function () {
                      resolve();
                    });
                  }
                  break;
              }
            }else {
              return next().then(function () {
                resolve();
              });
            }
          }).then(function () {
            $timeout(function () {
              utils.alert('提交成功，请稍后离线上传数据',null,function () {
                $state.go("app.xhsc.xj.main");
              });
            })
          })
        }
        valid();
      });

      $scope.$on('$destroy', function () {
        gxzgChanged();
        gxzgChanged = null;
      })
    });
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */

(function () {
  'use strict';

  cycleLookMainController.$inject = ["xhscService", "$mdDialog", "api", "$scope", "$q", "remote", "$state", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('cycleLookMainController', cycleLookMainController);

  /** @ngInject */
  function cycleLookMainController(xhscService,$mdDialog,api,$scope,$q,remote,$state,$mdBottomSheet) {
    var vm = this;
    vm.procedure = [];
    vm.create=function () {
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.ok=function () {
            remote.safe.insertBatchWrap({
              InspectionID: sxt.uuid(),
              AreaID: $scope.currentArea.RegionID,
              Title: $scope.subject,
            },"cycle").then(function (r) {
              $mdDialog.hide(r);
            }).catch(function () {
              $mdDialog.hide();
            })
          }
          $scope.cancel=function () {
            $mdDialog.cancel();
          }

          function initTheme() {
            var projectName=$scope.currentProject?$scope.currentProject.RegionName:"";
            var area=$scope.currentArea?$scope.currentArea.RegionName:"";
            var date=new Date();
            var year=date.getFullYear();
            var month=date.getMonth()+1;
            var day=date.getDate();
            if (!area||!projectName){
              $scope.subject="";
            }else {
              $scope.subject= projectName+area+ year+"年"+month+"月"+day+"日巡检";
            }
          }
          xhscService.getRegionTreeOffline("",3,1).then(function (r) {
            $scope.projects=r;
            if(angular.isArray($scope.projects)&&$scope.projects.length){
              $scope.currentProject=$scope.projects[0];
              if ($scope.currentProject.Children.length){
                $scope.currentArea=$scope.currentProject.Children[0];
              }
            }
          })

          $scope.$watch("currentProject",function () {
            initTheme();
          })
          $scope.$watch("currentArea",function () {
            initTheme();
          })
        }],
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_createTemplate.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        fullscreen: false
      }).then(function (r) {
        if (r&&r.status==200){
          loadInspection();
        }else{
          utils.alert("本日已经创建过日常巡检!");
        }
      });
    }
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
      vm.OUType = profile.ouType;
    });

    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("cycle").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("cycle",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"cycle").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.cycleLook.cyclePointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.cycleLook.cycleProblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.cycleLook.cycleProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaID,null,null))
                .concat([function () {
                  return xhscService.getRegionTreeOffline("", 31, 1);
                }])
                .concat(function () {
                  return remote.offline.create({Id: 'cycleYs' + item.InspectionID});
                })

              api.task(tasks, {
                event: 'downloaddyn',
                target: item.InspectionID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成',null,function () {
                  resolve();
                }).catch(function () {
                  reject();
                });
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloaddyn', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
          return item.InspectionID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.cycleLook.cyclePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(getRectificationTask())
                .concat(function () {
                  return remote.offline.create({Id: 'cycleZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);
    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%';
        vm.uploadInfo.current=0;
        vm.uploadInfo.total=0;
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;
            function buildTask() {
              function filterUpload(arr) {
                if (angular.isArray(arr)){
                  return arr.filter(function (t) {
                    return !t.isUpload;
                  })
                }
                return arr;
              }
              var tasks = [];
              return $q(function (resolve, reject) {
                api.getUploadData(function (cfg) {
                  return cfg.mark == "cycleUp";
                }).then(function (val) {
                  if (val && val.length) {
                    var points = val.find(function (o) {
                      return o.key == "cyclePointGeos";
                    });
                    var ckpoints = val.find(function (o) {
                      return o.key == "cyclePoints";
                    });

                    var ckpointsVal=ckpoints && ckpoints.vals ? ckpoints.vals : [];

                    var problemRecords = val.find(function (o) {
                      return o.key == "cycleProblemRecord";
                    });
                    var problemRecordsVal=problemRecords && problemRecords.vals ? filterUpload(problemRecords.vals) : [];

                    var InspectionProblemRecordFiles = val.find(function (o) {
                      return o.key == "cycleInspectionProblemRecordFile";
                    });
                    var InspectionProblemRecordFilesVal=InspectionProblemRecordFiles && InspectionProblemRecordFiles.vals ?
                      filterUpload(InspectionProblemRecordFiles.vals): [];
                    InspectionProblemRecordFilesVal.forEach(function (k) {
                      tasks.push(function () {
                        return remote.safe.inserFile({
                          FileName:k.FileID,
                          Base64:k.FileContent
                        }).then(function (res) {
                          if(res&&res.data&&res.data.ID){
                            k.FileID=res.data.ID;
                          }
                          delete k.FileContent
                        })
                      });
                    });

                    if (points && points.vals) {
                      points.vals.forEach(function (t) {
                        if (t.geometry) {
                          t.Geometry = t.geometry;
                        }
                        if (typeof t.Geometry === 'string') {
                          t.Geometry = JSON.parse(t.Geometry);
                        }
                        tasks.push(function () {
                          return remote.Procedure.InspectionPoint.create(t)
                        });
                      });
                    }


                    //业务单独上传
                    var post={
                      "CheckpointInput": ckpointsVal,
                      "ProblemRecordInput": problemRecordsVal,
                      "ProblemRecordFileInput": InspectionProblemRecordFilesVal
                    }

                    tasks.push(function () {
                      function clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points) {
                        if (ckpoints&&ckpoints.db){
                          tasks.push(function () {
                            return  ckpoints.db.destroy()
                          })
                        }

                        if (problemRecords&&problemRecords.db){
                          tasks.push(function () {
                            return  problemRecords.db.destroy()
                          })
                        }
                        if (InspectionProblemRecordFiles&&InspectionProblemRecordFiles.db){
                          tasks.push(function () {
                            return  InspectionProblemRecordFiles.db.destroy()
                          })
                        }
                        if (points&&points.db){
                          tasks.push(function () {
                            return  points.db.destroy()
                          })
                        }
                      }
                      return remote.safe.safeUp(post,"cycle").then(function () {
                        clear(ckpoints,problemRecords,InspectionProblemRecordFiles,points);
                      });
                    });
                  }
                  resolve(tasks);
                }).catch(function (err) {
                  reject(err)
                })
              })
            }
            buildTask().then(function (tasks) {
              api.task(tasks)(function (percent, current, total) {
                var percent=percent?parseInt(percent * 100):0;
                vm.uploadInfo.percent = percent + ' %';
                vm.uploadInfo.current = current;
                vm.uploadInfo.total = total;
              }, function () {
                utils.alert("上传成功!");
                $mdDialog.hide();
                load();
                 remote.offline.query().then(function(m){
                    if(angular.isArray(m.data)){
                      m.data.forEach(function(n){
                        if(n.Id&&(n.Id.indexOf("cycleYs")>-1||n.Id.indexOf("cycleZg")>-1)){
                          remote.offline.delete({Id:n.Id});
                        }
                      });
                    }
                });
                vm.uploadInfo.uploading = false;
              }, function (timeout) {
                var msg = timeout ? '超时,任务上次失败!' : '上传失败,请检查网络';
                $mdDialog.cancel();
                utils.alert(msg);
                vm.uploadInfo.uploaded = 0;
                vm.uploadInfo.uploading = false;
              });
            })
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }

    function loadInspection() {
      return remote.safe.getBatchWrap.cfgSet({
        mode:2
      })("cycle").then(function (r) {
        vm.Inspections = [];
        if (angular.isArray(r.data)) {
          var ys = [];
          r.data.forEach(function (o) {
            ys.push(o);
          });
          return remote.offline.query().then(function (r) {
            if (angular.isArray(r.data)) {
              ys.forEach(function (k) {
                if (r.data.find(function (m) {
                    return m.Id == "cycleYs" + k.InspectionID;
                  })) {
                  k.isOffline = true;
                }
              })
            }
            vm.Inspections = ys;
          })
        }
      });
    }
    function loadZgLst() {
       return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
          }).then(function () {
            ret(vm.role).then(function (r) {
              resolve(r);
            });
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
          params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("cycle",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "cycleZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }
    }
    function load() {
      $q.all([
        loadInspection(),
        loadZgLst()
      ]).then(function () {
        vm.isOver = true;
      });
    }

    api.setNetwork(0).then(function () {
      load();
    })
    vm.setModule = function (val) {
      $state.go('app.xhsc.xj.base', {yw: val})
    }
    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.xj.rectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.xj.rectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.xj.rectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.xj.rectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.xj.accept', {
              projectId: item.ProjectID,
              areaId: item.AreaID,
              InspectionId: item.InspectionID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.xj.accept', {
            projectId: item.ProjectID,
            areaId: item.AreaID,
            InspectionId: item.InspectionID
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by emma on 2016/6/21.
 */
(function () {
  'use strict';

  cycleLookBaseController.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('cycleLookBaseController', cycleLookBaseController);

  function cycleLookBaseController(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog,
                                db, $mdBottomSheet, $stateParams, xhscService) {
    var vm = this;
    vm.procedure = [];
    vm.yw = $stateParams.yw;
    vm.isShowbg = false;
    //所有全局任务
    xhscService.getProfile().then(function (profile) {
      vm.role = profile.role;
    });

    var globalTask = [
      function () {
        return remote.safe.getSecurityItem.cfgSet({
          offline: true
        })("cycle").then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        });
      }
    ];
    function projectTask(regionID, areas, acceptanceItemID,_filter) {
      var projectId = regionID.substr(0, 5);
      var filter=_filter;
      if (!filter){
        filter=  function filter(item) {
          return(!areas || areas.find(function (a) {
              return a.AreaID == item.RegionId;
            })) && (item.Type==7)
        }
      }
      var relates=remote.safe.getDrawingRelate.cfgSet({
        offline: true
      })("cycle",regionID)
      return [
        function (tasks) {
          return $q(function (resolve, reject) {
            return xhscService.downloadPics(regionID, null, filter,relates).then(function (t) {
              t.forEach(function (m) {
                tasks.push(m);
              })
              resolve();
            }).catch(function () {
              reject();
            });
          })
        }
      ]
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.safe.getRecPackage(item.RectificationID,"cycle").then(function (r) {
            if (r && r.data) {
              var Checkpoints = r.data.Checkpoint; //插入点
              if (angular.isArray(Checkpoints)) {
                Checkpoints.forEach(function (t) {
                  tasks.push(function () {
                    return remote.cycleLook.cyclePointCreate(t)
                  });
                });
              }
              var ProblemRecords = r.data.ProblemRecord; //插入记录
              if (angular.isArray(ProblemRecords)) {
                ProblemRecords.forEach(function (t) {
                  t.isUpload=true;
                  tasks.push(function () {
                    return remote.cycleLook.cycleProblemRecordCreate(t)
                  });
                });
              }
              var ProblemRecordFiles = r.data.ProblemRecordFile; //插入文件
              if (angular.isArray(ProblemRecordFiles)) {
                ProblemRecordFiles.forEach(function (t) {
                  tasks.push(function () {
                    return remote.cycleLook.cycleProblemRecordFileQuery(t.ProblemRecordFileID);
                  });
                });
              }
            }
          })
        }
      ]
    }

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var t = [];
              item.Rectifications.forEach(function (k) {
                k.Children.forEach(function (o) {
                  t = t.concat(projectTask(o.AreaID, [o], o.AcceptanceItemID));
                });
              });
              function getRectificationTask() {
                var  task=[];
                var rectification=item.Rectifications;
                rectification.forEach(function (item) {
                  task=task.concat(rectificationTask(item)).concat([
                    function (tasks) {
                      return $q(function (v, m) {
                        item.Children.forEach(function (area) {
                          tasks.push(
                            function () {
                              return remote.safe.getSafePointGeo(item.InspectionID, item.AcceptanceItemID, area.AreaID)
                            }
                          );
                        })
                        v();
                      })
                    }
                  ]);
                })
                return task;
              }

              var tasks = [].concat(globalTask)
                .concat(t)
                .concat(getRectificationTask())
                .concat(function () {
                  return remote.offline.create({Id: 'cycleZg' + item.InspectionExtendID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.InspectionExtendID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
          return item.InspectionExtendID == e.target;
        });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            break;
        }
      }
    }, $scope);

    function loadZgLst() {
      return $q(function (resolve,reject) {
        if (vm.role||vm.role===0){
          ret(vm.role).then(function (r) {
            resolve(r);
          });
        }else {
          xhscService.getProfile().then(function (profile) {
            vm.role = profile.role;
          }).then(function () {
            ret(vm.role).then(function (r) {
              resolve(r);
            });
          })
        }
      })
      function ret(role) {
        var params="";
        if (vm.role==2||vm.role=="2"){
          params="jl";
        }else {
          params="zb";
        }
        return remote.safe.getRectificationsWrap.cfgSet({
          mode:2
        })("cycle",params).then(function (r) {
          vm.zglist = [];
          if (angular.isArray(r.data)) {
            var zg = [];
            r.data.forEach(function (o) {
              zg.push(o);
            });
            return remote.offline.query().then(function (r) {
              if (angular.isArray(r.data)) {
                zg.forEach(function (k) {
                  if (r.data.find(function (m) {
                      return m.Id == "cycleZg" + k.InspectionExtendID;
                    })) {
                    k.isOffline = true;
                  }
                })
              }
              vm.zglist = zg;
            })
          }
        })
      }
    }
    function load() {
      $q.all([
        loadZgLst()
      ]).then(function () {
        vm.f_isOver = true;
        if (!vm.zglist.length){
          vm.isShowbg=true;
        }
      });
    }
    api.setNetwork(0).then(function () {
      load();
    })

    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.xj.rectify', {
              Role: 'zb',
              InspectionID: item.InspectionExtendID
            });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.xj.rectify', {
            Role: 'zb',
            InspectionID: item.InspectionExtendID
          });
        });
      }
    }
    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.xj.rectify', {
              Role: 'jl',
              InspectionID: item.InspectionExtendID
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.xj.rectify', {
            Role: 'jl',
            InspectionID: item.InspectionExtendID
          })
        });
      }
    }
    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/19.
 */
/**
 * Created by emma on 2016/6/6.
 */
(function(){
  'use strict';

  cycleLookAcceptController.$inject = ["$scope", "$stateParams", "remote", "xhUtils", "$rootScope", "$state", "$q", "utils", "api", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('cycleLookAcceptController',cycleLookAcceptController);

  /**@ngInject*/
  function cycleLookAcceptController($scope,$stateParams,remote,xhUtils,$rootScope,$state,$q,utils,api,xhscService){
    var vm = this;
    var projectId = $stateParams.projectId,
      areaId = $stateParams.areaId?$stateParams.areaId:$stateParams.regionId;
    vm.areaId=areaId;
    vm.InspectionId=$stateParams.InspectionId;

    vm.info = {
      current:null,
      projectId:projectId,
      regionId:areaId,
      cancelMode:function () {
        vm.cancelCurrent(null);
      }
    };

    api.setNetwork(1).then(function(){
      vm.cancelCurrent = function ($event) {
        vm.info.current = null;
      }
      $scope.areas= xhscService.getRegionTreeOffline("", 31, 1).then(function (r) {
        if (!angular.isArray(r)){
          return r;
        }
        var area=r.filter(function (k) {
          if (angular.isArray(k.Children)){
            k.Children=k.Children.filter(function (m) {
              return m.RegionID==areaId;
            })
          }
          return k.RegionID==projectId;
        });
        return area;
      });
      $scope.procedure=remote.safe.getSecurityItem.cfgSet({
        offline: true
      })("cycle");
      $scope.current={};

      var sendResult = $rootScope.$on('sendGxResult',function(){
        utils.alert("提交成功，请稍后离线上传数据！",null,function () {
          $state.go('app.xhsc.xj.main')
        });
      })
      $scope.$on("$destroy",function(){
        sendResult();
        sendResult = null;
      });

      function initImgId(regionId,gx) {
        var imgId="";
        if(regionId){
          var areaID=regionId.substr(0,10);
          remote.safe.getDrawingRelate.cfgSet({
            offline: true
          })("cycle",areaID).then(function (result) {
            imgId = result.data.find(function (item) {
              if (gx&&gx.isGj){
                return item.AcceptanceItemID==gx.AcceptanceItemID && item.RegionId ==regionId;
              }
              return item.Type==7 && item.RegionId ==regionId;
            });
            if(!imgId){
              imgId = result.data.find(function (item) {
                return item.RegionId == regionId;
              });
            }
            if (imgId){
              vm.imgId=imgId.DrawingID;
            }
          })
        }
      }
      $scope.$watch("current.region",function (v,o) {
        if (v&&$scope.current.procedure){
          if (v.SpecialtyID=="0000200008"){
            v.isGj=true;
          }
          initImgId(v.RegionID,$scope.current.procedure);
          vm.info.show=true;
        }else {
          vm.info.show=false;
        }
      })
      $scope.$watch("current.procedure",function (v,o) {
        if (v){
          if (v.SpecialtyID=="0000200008"){
            v.isGj=true;
          }
          if ($scope.current.region){
            initImgId($scope.current.region.RegionID,v);
            vm.info.show=true;
          }else {
            vm.info.show=false;
          }
          vm.procedureData=[v];
          vm.procedureData.forEach(function(t){
            t.SpecialtyChildren = t.ProblemClassifyList;
            t.ProblemClassifyList.forEach(function(_t){
              _t.WPAcceptanceList = _t.ProblemLibraryList;
              _t.SpecialtyName = _t.ProblemClassifyName;
              _t.ProblemLibraryList.forEach(function(_tt){
                _tt.AcceptanceItemName = _tt.ProblemSortName +'.'+ _tt.ProblemDescription;
              })
            })
          })
        }
      })
    });
  }
})();

/**
 * Created by shaoshunliu on 2016/11/13.
 */
/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  standarRegionController.$inject = ["$scope", "db", "api", "$q", "remote", "$state", "$timeout", "$stateParams", "xhscService"];
  angular
    .module('app.xhsc')
    .controller('standarRegionController',standarRegionController);

  /**@ngInject*/
  function standarRegionController($scope,db,api,$q,remote,$state,$timeout,$stateParams,xhscService){
    var vm = this;
    var projectID=$stateParams.projectID;

    remote.Project.getRegionWithRight(projectID).then(function (res) {
      var result= xhscService.buildRegionTree(res.data,1);
      vm.souce=result&&result.Children;
      vm.show=true;
    });

  }
})();

/**
 * Created by lss on 2016/10/30.
 */
/**
 * Created by lss on 2016/7/25.
 */
/**
 * Created by jiuyuong on 2016-5-3.
 */
(function () {
  'use strict';

  sc_standarController.$inject = ["$rootScope", "$scope", "utils", "xhUtils", "$stateParams", "$mdDialog", "sxt", "$timeout", "$state", "remote", "$q"];
  angular
    .module('app.xhsc')
    .controller('sc_standarController', sc_standarController)
  /** @ngInject */
  function sc_standarController($rootScope,$scope, utils, xhUtils, $stateParams, $mdDialog, sxt, $timeout, $state, remote, $q) {
    var vm = this;
    vm.info = {
      acceptanceItemID: $stateParams.AcceptanceItemID,
      acceptanceIndexID: $stateParams.AcceptanceIndexID,
      drawing: $stateParams.DrawingID,
      projectId:$stateParams.projectID
    };
    var arr = [
      remote.Project.GetMeasureItemInfoByAreaID(),
      remote.Project.getDrawing(vm.info.drawing),
      remote.PQMeasureStandard.messageList(vm.info.drawing, vm.info.AcceptanceItemID)
    ]
    vm.selected = [];
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.show=mobileDetect.mobile();
    $q.all(arr).then(function (res) {
      var r = res[0];
      vm.drawing = res[1];
      vm.scroll = true;
      var find = r.data.find(function (it) {
        return it.AcceptanceItemID == vm.info.acceptanceItemID;
      });
      if (find) {
        vm.title = $rootScope.title = find.MeasureItemName;
        var m = [];
        var tt = res[2];
        find.MeasureIndexList.forEach(function (item) {
          if (tt.data.find(function (w) {
              return w.AcceptanceIndexID == item.AcceptanceIndexID && w.Status == 1
            })) {
            item.completed = true;
          }

          if (item.AcceptanceIndexID == vm.info.acceptanceIndexID) {
            item.checked = true;
          }
          m.push(item);
        });

        vm.selected = $.map(m, function (r) {
          if (r.checked) {
            return r;
          }
        });


        vm.MeasureIndexes = m;
        $timeout(function () {
          if (!vm.info.acceptanceIndexID) {
            vm.scChoose();
          }
        }, 500);
      }
      vm.submit = function () {

        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            function reflash() {
              return remote.PQMeasureStandard.messageList(vm.info.drawing, vm.info.acceptanceItemID).then(function (r) {
                vm.MeasureIndexes.forEach(function (k) {
                  k.num = 0;
                  r.data.forEach(function (m) {
                    if (m.AcceptanceIndexID == k.AcceptanceIndexID||(k.Children)&&k.Children.find(function (n) {
                        return n.AcceptanceIndexID==m.AcceptanceIndexID;
                      })) {
                      k.num++;
                      k.completed = m.Status == 1 ? true : k.completed;
                      k.checked=k.checked;
                    }
                  });
                })
                vm.selected = $.map(m, function (r) {
                  if (r.checked) {
                    return r;
                  }
                });
                return r;
              })
            }

            function valid() {
              return $q(function (resolve, reject) {
                reflash().then(function (r) {
                  var sub = $.map(vm.selected, function (o) {
                    if (o.completed)
                      return o.IndexName;
                  });
                  if (sub.length) {
                    reject("指标:" + sub.join(",") + "重复提交！");
                    return;
                  }
                  var sub = vm.selected.filter(function (o) {
                    return !!o.num && !o.completed;
                  });
                  if (!sub.length) {
                    reject("您当前未选择任何的指标，并在图纸上描点！");
                    return;
                  }
                  resolve(sub);
                }).catch(function () {
                  reject("由于网络或者后台服务异常，导致提交失败!");
                });
              })
            }

            valid().then(function (sub) {
              var  sub=sub;
              return $q(function (resolve, reject) {
                var msg = $.map(sub, function (r) {
                  return r.IndexName
                })
                msg ="指标："+ msg.join(",")+"已经完毕，确认提交？";
                $mdDialog.hide().then(function () {
                  utils.confirm(msg, null, '', '').then(function () {
                    var arr = [];
                    sub.forEach(function (item) {
                      arr.push(remote.PQMeasureStandard.standarSubmit(item.AcceptanceIndexID, item.AcceptanceItemID, vm.drawing.data.DrawingID))
                    })
                    $q.all(arr).then(function () {
                      resolve();
                    }).catch(function () {
                      reject("由于网络或者后台服务异常，导致提交失败!");
                    })
                  })
                });
              })
            }).then(function () {
              reflash().then(function () {
                $timeout(function () {
                  vm.scChoose();
                },300)
              });
            }).catch(function (msg) {
              $mdDialog.cancel(msg);
            })
          }],
          template: '<md-dialog aria-label="正在提交"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate" md-diameter="28"></md-progress-circular><p style="padding-left: 6px;">正在下载提交，请稍后...</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        }).catch(function (r) {
            utils.alert(r).then(function () {
              $timeout(function () {
                vm.scChoose();
              },300)
            });
        });
      }
      vm.scChoose = function ($event) {
        $mdDialog.show({
          controller: ['$scope', '$mdDialog', function ($scope, $mdDialog) {
            $scope.checkSc = function (sc) {
              vm.MeasureIndexes.forEach(function (it) {
                it.checked = false;
              })
              sc.checked = true;
              $scope.answer([sc]);
            };
            $scope.scList = vm.MeasureIndexes;
            $scope.getIsChecked = function () {
              return !$scope.scList.find(function (r) {
                return r.checked;
              })
            }
            $scope.hide = function () {
              $mdDialog.hide();
            };
            $scope.cancel = function () {
              $mdDialog.cancel();
            };
            $scope.ok=function (answer) {

              $mdDialog.hide(answer);
            }

            $scope.answer = function (answer) {
              $mdDialog.hide(answer);
            };
          }],
          targetEvent: $event,
          templateUrl: 'app/main/xhsc/center/pcIndexChoose.html',
          parent: angular.element('#content'),
          clickOutsideToClose: false
        }).then(function (m) {
          vm.selected = $.map(m, function (r) {
            if (r.checked) {
              return r;
            }
          });

        })
      }
      var sendgxResult= $rootScope.$on("sendGxResult",function () {
        vm.submit();
      })
      $scope.$on("$destroy",function(){
        sendgxResult();
        sendgxResult=null;
      });
    }).catch(function (err) {
    });
  }
})();

/**
 * Created by lss on 2016/10/29.
 */
/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  scPiclstController.$inject = ["$scope", "$q", "remote", "$stateParams", "$state", "$timeout", "$mdBottomSheet", "utils"];
  angular
    .module('app.xhsc')
    .controller('scPiclstController',scPiclstController);

  /**@ngInject*/
  function scPiclstController($scope,$q,remote,$stateParams,$state,$timeout,$mdBottomSheet,utils){
    var vm = this;
    var projectID=$stateParams.projectID.substr(0,5);
    var region=$stateParams.projectID;
    var  arr=[
      remote.Project.GetMeasureItemInfoByAreaID(),
      remote.PQMeasureStandard.GetProjectDrawing(projectID),
      remote.Project.getDrawingRelations(region,"nodb")
    ];
    vm.searchText="";
    vm.selectedItem=null;

    $q.all(arr).then(function(res){
      vm.scItems=res[0]? res[0].data:[];
      var  draws=res[1]? res[1].data:[];
      var relate=res[2]?res[2].data:[];
      function init(o,draws){
        o.pics=[];

        function build(o,k) {
          var pic={
            DrawingID: k.DrawingID,
            AcceptanceItemID: o.AcceptanceItemID,
            DrawingName: k.DrawingName
          }
          pic.indexs=[];
          o.pics.push(pic);
          o.MeasureIndexList.forEach(function(n){
            pic.indexs.push({
              AcceptanceIndexID: n.AcceptanceIndexID,
              AcceptanceItemID: o.AcceptanceItemID,
              DrawingID:k.DrawingID,
              IndexName: n.IndexName
            });
          });
        }

        draws.forEach(function(k){
          if (relate.find(function (w) {
               return w.DrawingID==k.DrawingID
            })){ //判断区域
            if (k.Type== o.MeasurePictureType){
              build(o,k)
            }else {
              var split=o.SplitRule;
              var apply=[];
              if (split){
                apply=split.split(",");
              }
              if (k.Type=-3&&apply.find(function (o) {
                    return o=="16"||o==16;
                  })){
                build(o,k)
              }
            }
          }
        });
      }
      vm.scItems.forEach(function(o){
          init(o,draws);
          o.querySearch=function(text){
            var k=[];
            o.pics.forEach(function(n){
              var py=window.Pinyin.getPinyinArrayFirst(n.DrawingName)
              py=py.join("");
              if (text&&n.DrawingName.indexOf(text)>-1||py.toLowerCase().indexOf(text.toLowerCase())>-1){
                k.push({
                  DrawingID: n.DrawingID,
                  DrawingName: n.DrawingName
                });
              }
            })
            return k;
          }
          o.changeItem=function(selectedItem){
            if (selectedItem){
              var p= draws.find(function(u){
                return u.DrawingID==selectedItem.DrawingID
              })
              if (p){
                init(o,[p]);
              }
            }else {
              init(o,draws);
            }
          }
        });
      vm.show=true;
    });

    vm.stretch = function (item) {
      item.stretch = !item.stretch;
      if (item.stretch){
        remote.PQMeasureStandard.messageList(item.DrawingID,item.AcceptanceItemID).then(function(r){
          item.indexs.forEach(function(k){
            r.data.forEach(function(m){
               if (m.AcceptanceIndexID== k.AcceptanceIndexID&&item.DrawingID==m.DrawingID){
                 k.standar=k.standar=="completed"?k.standar:"no";
                 if (m.Status==1){
                   k.standar="completed"
                 }
               }
            });
          })
        })
      }
    }
    vm.go=function(AcceptanceItemID,drawingID,AcceptanceIndexID){
      $state.go("app.xhsc.sc_standar",{
        AcceptanceItemID:AcceptanceItemID,
        DrawingID:drawingID,
        AcceptanceIndexID:AcceptanceIndexID,
        projectID:projectID
      })
    }

    vm.click=function (item,evt) {
      evt.stopPropagation();
      // if (item.standar=='completed'){
      //   return;
      // }
      vm.go(item.AcceptanceItemID,item.DrawingID,item.AcceptanceIndexID);
    }
    vm.action = function (item, evt) {
      evt.stopPropagation();
      if (item.standar=="completed"){
        return;
      }
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '标准化',
            action: function () {
              $mdBottomSheet.hide();
              vm.go(item.AcceptanceItemID,item.DrawingID,item.AcceptanceIndexID);
            }
          },
            {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
    }
  }
})();

/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  personController.$inject = ["$scope", "$mdDialog", "db", "auth", "$rootScope", "api", "utils", "$q", "remote", "versionUpdate", "$state", "$timeout", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('personController',personController);

  /**@ngInject*/
  function personController($scope,$mdDialog,db,auth,$rootScope,api,utils,$q,remote,versionUpdate,$state,$timeout,$mdBottomSheet){
    var vm = this;

    var pro=[
      remote.profile()
    ];
    $q.all(pro).then(function(r){
      var role=r[0];
      vm.user={};
      vm.u={};
      if (role&&role.data&&role.data){
          vm.user.name= role.data.Name;
          vm.user.userName= role.data.UserName;
          vm.user.OUName = role.data.Role.OUName;
          vm.user.role=role.data.Role.MemberTypeName;
      }
    });


  }
})();

/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  pcenter_mainController.$inject = ["$scope", "xhscService", "$mdDialog", "db", "auth", "$rootScope", "api", "utils", "$q", "remote", "versionUpdate", "$state", "$timeout", "sxt", "delopy"];
  angular
    .module('app.xhsc')
    .controller('pcenter_mainController',pcenter_mainController);

  /**@ngInject*/
  function pcenter_mainController($scope,xhscService,$mdDialog,db,auth,$rootScope,api,utils,$q,remote,versionUpdate,$state,$timeout,sxt,delopy){
    resetPasswordController.$inject = ["$rootScope", "$state", "$scope", "api", "utils", "auth", "$timeout", "$mdDialog", "remote", "$q", "$http"];
    var vm = this;
    vm.projects=[];
    api.setNetwork(0).then(function () {
      var arr=[
        remote.profile(),
        remote.Project.getAllRegionWithRight_no_db("", 1)
      ];
      $q.all(arr).then(function (res) {
        var r=res[0];
        if (r.data && r.data.Role) {
          vm.role = r.data.Role.MemberType === 0 || r.data.Role.MemberType ? r.data.Role.MemberType : -100;
          vm.OUType=r.data.Role.OUType===0||r.data.Role.OUType?r.data.Role.OUType:-100;
        }
        var k=res[1];
        if (k&&k.data){
          vm.projects=k.data;
        }
      }).catch(function () {
        vm.show=true;
        utils.alert("当前网络异常！");
      });
      vm.serverAppVersion = sxt.version;
      $scope.$on('$destroy',$rootScope.$on("updateVison:progress",function (s,info) {
        $timeout(function () {
          var tips = (info.ready || info.checking)?
          info.state + (info.complete || info.stateNumber == 3 ? '' : '(' + info.progress + '%)'):
            sxt.version;
          vm.serverAppVersion= tips;
        })
      }));
      delopy.update(function (self,r0,version,isIntall) {
        if (isIntall)
          return utils.confirm('发现新版本：' + r0 + '，是否更新？')
        else {
          return utils.confirm('版本已经更新完毕，是否重新启动?')
        }
      }).then(function (res) {
        if (res&&res.info){
          $timeout(function () {
            sxt.version=res.info;
          })
        }
      });
      // versionUpdate.check().then(function () {
      //   vm.serverAppVersion = versionUpdate.version;
      // });

      vm.clearCache=function(){
        utils.confirm('确定清除所有缓存数据吗?').then(function (result) {
          vm.trueClear = function (exclude) {
            $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
              .then(function(answer) {
              }, function() {
                window.localStorage.removeItem("dbs");
                utils.alert('清除成功');
              });
            return;
          }
          xhscService.clear_Root_uglyVal();
          vm.trueClear(['v_profile']);
        });
      }
      vm.logout = function(){
        utils.confirm('确定清除所有缓存数据吗?').then(function (result) {

          vm.trueClear = function (exclude) {
            $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
              .then(function(answer) {
                window.localStorage.clear();
                auth.logout();
              }, function() {

              });
            return;
          }
          vm.trueClear(['v_profile']);
          api.xhsc.logout();
        });
      }
      //消息中心
      vm.scStandar=function(){
        if (!vm.projects.length){
          utils.alert("正在加载您的项目信息，请稍等片刻。。。");
          return;
        }
        if (vm.projects.length>1){
          $mdDialog.show({
            controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
              $scope.projects=vm.projects;
              $scope.go=function (item) {
                $state.go("app.xhsc.standarRegion",{projectID:item.RegionID});
                $mdDialog.hide();
              }
            }],
            templateUrl:"app/main/xhsc/center/projectlst.html" ,
            parent: angular.element(document.body),
            clickOutsideToClose:true,
            fullscreen: false
          });

        }else {
          $state.go("app.xhsc.standarRegion",{projectID:vm.projects[0].RegionID});
        }
      }
    });

    vm.resetPassword= function(ev, item) {
      $mdDialog.show({
        controller: resetPasswordController,
        templateUrl: 'app/main/auth/components/reset-password.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        locals: {
          model: angular.copy(item)
        },
        clickOutsideToClose: false
      }).then(function () {
      }, function () {
      });
    };
    function resetPasswordController($rootScope, $state, $scope, api, utils, auth, $timeout, $mdDialog,remote,$q,$http) {
      var vm = this;
      init();

      $scope.sending = false;
      $scope.send = function () {
        if ($scope.sending) return;
        $scope.timing = 60;
        $scope.sending = 'S后重新发送';
        api.auth.verificationCode.post({ identitySign: $scope.d.LoginID, type: 'ResetPassword' }).then(function () {
          $timeout(function () {
            updateTime();
          }, 1000);
        });
      }

      function updateTime() {
        $scope.timing--;
        if ($scope.timing == 0) {
          $scope.sending = false;
          $scope.timing = 0;
        } else {
          $timeout(function () {
            updateTime();
          }, 1000);
        }
      }

      $scope.submit = function () {
        if ($scope.d.NewPassword.length < 6) {
          $scope.resetError = '*新密码不少于6位字符';
          return;
        }

        if ($scope.d.NewPassword !== $scope.d.passwordConfirm) {
          $scope.resetError = '*两次输入的密码不一致';
          return;
        }
        // auth.reset({
        //   LoginID: $scope.d.username,
        //   CurrentPassword: $scope.d.oldPassword,
        //   NewPassword: $scope.d.newPassword,
        //   IsSaveButtonClick:true
        // }).then(function (r) {
        //   $mdDialog.cancel();
        //   $rootScope.$emit('user:needlogin');
        // }, function (reject) {
        //   $scope.resetError = '*原密码不正确';
        // })
        $http({
        method  : 'POST',
        url     : 'http://emp.chngalaxy.com:9090/Api/User/ChangePassword',
        data    : $.param($scope.d),  // pass in data as strings
        headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  // set the headers so angular passing info as form data (not request payload)
      }).then(function (r) {
        console.log(r)
        if(r.data.ErrorMessage=="密码验证失败"){
          $scope.resetError = '*原密码不正确';
        }else if(r.data.ErrorMessage=="修改密码成功"){
          $scope.resetTrue = '修改成功,即将跳转到登录页';
          setTimeout(function(){
            $mdDialog.cancel(),
            $rootScope.$emit('user:needlogin')
          },3000)
        }
        })
      }

     function init() {
      var pro=[
          remote.profile()
        ];
        $q.all(pro).then(function(r){
          console.log(r)
          var role=r[0];
          if (role&&role.data&&role.data){
                      $scope.d = {
              LoginID:role.data.UserName,
              IsSaveButtonClick:true,
              IsSaveCloseButtonClick:null,
              IsEdit:true
            }
          }
        });
      }

      $scope.cancel = function () {
        $mdDialog.cancel();
      };
    }
  }
})();

/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  pcenterController.$inject = ["$scope", "$mdDialog", "db", "auth", "$rootScope", "api", "utils", "$q", "remote", "versionUpdate", "$state", "$timeout", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('pcenterController',pcenterController);

  /**@ngInject*/
  function pcenterController($scope,$mdDialog,db,auth,$rootScope,api,utils,$q,remote,versionUpdate,$state,$timeout,$mdBottomSheet){
    var vm = this;

    vm.serverAppVersion = versionUpdate.version;
    var pro=[
      remote.profile()
    ];
    $q.all(pro).then(function(r){
      var role=r[0];
      vm.user={};
      vm.u={};
      if (role&&role.data&&role.data){
          vm.user.name= role.data.Name,
          vm.user.userName= role.data.UserName
          switch (role.data.Role.MemberType){
            case 0:
              vm.user.role='总包';
                  break
            case 2:
              vm.user.role='监理';
                  break;
            case 4:
              vm.user.role="项目部";
          }
      }
    });

    vm.goMsg=function(){
      $state.go("app.xhsc.mcenter");
    }

    $rootScope.$on('sxt:online', function(event, state){
      vm.networkState = api.getNetwork();
    });
    $rootScope.$on('sxt:offline', function(event, state){
      vm.networkState = api.getNetwork();
    });
    vm.networkState = api.getNetwork();
    $scope.$watch(function () {
      return vm.networkState
    },function () {
      api.setNetwork(vm.networkState);
    });

    vm.clearCache=function(){
      utils.confirm('确定清除所有缓存数据吗?').then(function (result) {
        vm.trueClear = function (exclude) {
          $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
            .then(function(answer) {
            }, function() {
              utils.alert('清除成功');
            });
          return;
        }
        vm.trueClear(['v_profile']);
      });
    }
    vm.logout = function(){
      utils.confirm('确定清除所有缓存数据吗?').then(function (result) {
        vm.trueClear = function (exclude) {
          $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
            .then(function(answer) {
              auth.logout();
            }, function() {

            });
          return;
        }
        vm.trueClear(['v_profile']);
      });
    }
    //消息中心
    function reloadMessage() {
     return  remote.message.messageList(0, 0).then(function (result) {
        vm.messages = [];
        result.data.Items.forEach(function (item) {
          var name="系统提示";
          item.style={
            background:"#f00"
          }
          if (item.ExtrasContent&&item.ExtrasContent.Status&&item.ExtrasContent.Status<4){
            switch (item.ExtrasContent.Status){
              case 1:
                name="工序验收";
                break;
              case 2:
                name="工序整改";
                break;
              case 3:
               name="工序复验";
                break;
              case 4:
            }
            item.style.background="#ff6d1f"
          }
          vm.messages.push({
            id: item.Id,
            name:name,
            time: item.SendTime,
            title: item.Title,
            description: item.Content,
            ExtrasContent:item.ExtrasContent,
            style:item.style
          });
        })

        function DynamicItems() {
          /**
           * @type {!Object<?Array>} Data pages, keyed by page number (0-index).
           */
          this.loadedPages = {};

          /** @type {number} Total number of items. */
          this.numItems = 0;

          /** @const {number} Number of items to fetch per request. */
          this.PAGE_SIZE = 50;

          this.fetchNumItems_();
        };
        // Required.
        DynamicItems.prototype.getItemAtIndex = function(index) {
          var pageNumber = Math.floor(index / this.PAGE_SIZE);
          var page = this.loadedPages[pageNumber];

          if (page) {
            return page[index % this.PAGE_SIZE];
          } else if (page !== null) {
            this.fetchPage_(pageNumber);
          }
        };
        // Required.
        DynamicItems.prototype.getLength = function() {
          return this.numItems;
        };

        DynamicItems.prototype.fetchPage_ = function(pageNumber) {
          // Set the page to null so we know it is already being fetched.
          this.loadedPages[pageNumber] = null;

          // For demo purposes, we simulate loading more items with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.loadedPages[pageNumber] = [];
            var pageOffset = pageNumber * this.PAGE_SIZE;
            for (var i = pageOffset; i < pageOffset + this.PAGE_SIZE; i++) {
              if (vm.messages[i]){
                this.loadedPages[pageNumber].push(vm.messages[i]);
              }
            }
          }));
        };

        DynamicItems.prototype.fetchNumItems_ = function() {
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.numItems = vm.messages.length;
          }));
        };
        vm.dynamicItems = new DynamicItems();

      })
    }
    reloadMessage();
    var onMessage = $rootScope.$on('receiveMessage',function(){
      reloadMessage();
    })
    $scope.$on('destroy',function(){
      onMessage();
    })
    vm.messages&&vm.messages.forEach(function(t){
      t.checked = false;
    })
    $scope.$watch('vm.msgList',function(){
      var i=0;
      vm.messages&&vm.messages.forEach(function(t){
        console.log(t.checked)
        if(t.checked){
          i++;
        }
      })
      if(i){
        vm.showSend = true;
      }else{
        vm.showSend  = false;
      }
    },true)
    function operateMsg(ev){
      utils.confirm('确认全部删除?',ev,'','').then(function(){
        remote.message.deleteAllMessage().then(function () {
          reloadMessage();
        })
      })
    }
    var event=   $rootScope.$on('operateMsg',operateMsg);
    vm.action=function(item,evt){
      if (!(item.ExtrasContent&&item.ExtrasContent.Status&&item.ExtrasContent.Status<4)){
        return;
      }
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '处 理',
            action: function () {
              $mdBottomSheet.hide();
              if (item.ExtrasContent&&item.ExtrasContent.Status){
                item.ExtrasContent.id=item.id;
                switch (item.ExtrasContent.Status){
                  case 1:
                   vm.jlysAction(item.ExtrasContent);
                        break;
                  case 2:
                    vm.zbzgAction(item.ExtrasContent)
                        break;
                  case 3:
                    vm.jlfyAction(item.ExtrasContent);
                    break;
                  case 4:
                    break;
                }
              }
            }
          }, {
            title: '删 除',
            action: function () {
              $mdBottomSheet.hide();
              remote.message.deleteMessage(item.id).then(function () {
                reloadMessage();
              })
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }




    //业务逻辑
    var dbpics = db('pics');
    var globalTask = [
      function () {
        return remote.Procedure.queryProcedure();
      }
    ];
    function projectTask(region, areas, acceptanceItemID) {
      var projectId=region.substr(0,5);
      return [
        function (tasks) {
          return $q(function (resolve) {
            var arr = [
              remote.Project.getDrawingRelations(region),
              dbpics.findAll()
            ];
            $q.all(arr).then(function (res) {
              var result = res[0], offPics = res[1].rows;
              var pics = [];
              result.data.forEach(function (item) {
                if ((!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
                  (!areas || areas.find(function (a) {
                    return a.AreaID == item.RegionId;
                  })) &&
                  pics.indexOf(item.DrawingID) == -1 && !offPics.find(function (r) {
                    return r._id == item.DrawingID;
                  }) && vm.procedure.find(function (k) {
                    return k.AcceptanceItemID == item.AcceptanceItemID;
                  })) {
                  pics.push(item.DrawingID);
                }
              });
              pics.forEach(function (drawingID) {
                tasks.push(function () {
                  return remote.Project.getDrawing(drawingID).then(function () {
                    dbpics.addOrUpdate({
                      _id: drawingID
                    })
                  });
                })
              });
              resolve(result);
            });
          })
        },
        function () {
          return remote.Project.queryAllBulidings(projectId);
        }
      ]
    }
    function InspectionTask(item) {
      var t = [function () {
        return remote.Project.getInspectionList(item.InspectionId);
      }];
      item.AreaList.forEach(function (area) {
        t.push(function (tasks, down) {
          return remote.Procedure.InspectionCheckpoint.query(item.AcceptanceItemID, area.AreaID, item.InspectionId).then(function (result) {
            result.data.forEach(function (p) {
              tasks.push(function () {
                return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                  result.data.forEach(function (r) {
                    tasks.push(function () {
                      return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                      })
                    })
                  })
                })
              });
            });
          })
        });
        t.push(function () {
          return remote.Procedure.InspectionIndexJoinApi.query(item.InspectionId)
        })
        t.push(function () {
          return remote.Procedure.InspectionPoint.query(item.InspectionId, item.AcceptanceItemID, area.AreaID)
        })

      });
      return t;
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.Procedure.getZGById(item.RectificationID).then(function (r) {
            r.data[0].Children.forEach(function (area) {
              tasks.push(function () {
                return remote.Procedure.getZGReginQues(area.AreaID, item.RectificationID);
              });
              tasks.push(function () {
                return remote.Procedure.getZGReginQuesPoint(area.AreaID, item.RectificationID);
              })
            })
          });
        },
        function () {
          return remote.Procedure.getRectification(item.RectificationID);
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaList[0].AreaID, item.AreaList, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'ys' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadys', function (s, e) {
      var current = e.target;
      switch (e.event) {
        case 'progress':
          current.percent = parseInt(e.percent * 100) + ' %';
          current.current = e.current;
          current.total = e.total;
          break;
        case 'success':
          break;
      }
    }, $scope);

    vm.downloadzg = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaList[0].AreaID, item.AreaList, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(rectificationTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'zg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                remote.offline.create({Id: 'zg' + item.RectificationID});
                //RectificationID
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = e.target;
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);

    vm.jlfyAction = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      vm.downloadzg(item).then(function () {
        api.setNetwork(1).then(function () {
          remote.message.deleteMessage(item.id).then(function(){
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'jl',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          })
        });
      })
    }
    vm.zbzgAction = function (item) {
        item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            remote.message.deleteMessage(item.id).then(function(){
              $state.go('app.xhsc.gx.gxzg', {
                Role: 'zb',
                InspectionID: item.InspectionId,
                AcceptanceItemID: item.AcceptanceItemID,
                RectificationID: item.RectificationID,
                AcceptanceItemName: item.AcceptanceItemName
              });
            })
          });
        })
    }
    vm.jlysAction = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      vm.downloadys(item).then(function () {
        api.setNetwork(1).then(function () {
          remote.message.deleteMessage(item.id).then(function(){
            $state.go('app.xhsc.gx.gxtest', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.AreaList[0].newName,
              projectId: item.AreaList[0].substring(0, 5),
              areaId: item.AreaList[0],
              InspectionId: item.InspectionId
            })
          })
        });
      })
    }

    $scope.$on("$destroy",function(){
      event();
      event=null;
    });
  }
})();

/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by lss on 2016/10/20.
 */
/**
 * Created by emma on 2016/6/12.
 */
(function(){
  'use strict';

  messageController.$inject = ["$scope", "$mdDialog", "db", "auth", "$rootScope", "api", "utils", "$q", "remote", "versionUpdate", "$state", "$timeout", "$mdBottomSheet"];
  angular
    .module('app.xhsc')
    .controller('messageController',messageController);

  /**@ngInject*/
  function messageController($scope,$mdDialog,db,auth,$rootScope,api,utils,$q,remote,versionUpdate,$state,$timeout,$mdBottomSheet){
    var vm = this;
    $rootScope.msg=true;
    vm.serverAppVersion = versionUpdate.version;

    vm.clearCache=function(){
      utils.confirm('确定清除所有缓存数据吗?').then(function (result) {
        vm.trueClear = function (exclude) {
          $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
            .then(function(answer) {
            }, function() {
              utils.alert('清除成功');
            });
          return;
        }
        vm.trueClear(['v_profile']);
      });
    }
    vm.logout = function(){
      utils.confirm('确定清除所有缓存数据吗?').then(function (result) {
        vm.trueClear = function (exclude) {
          $mdDialog.show({
              controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
                api.clearDb(function (persent) {
                  $scope.cacheInfo = parseInt(persent * 100) + '%';
                }, function () {
                  $scope.cacheInfo = null;
                  //$rootScope.$emit('clearDbSuccess');
                  $mdDialog.hide();
                  //utils.alert('清除成功');
                }, function () {
                  $scope.cacheInfo = null;
                  $mdDialog.cancel();
                  utils.alert('清除失败');

                }, {
                  exclude: exclude,
                  timeout: 3000
                })
              }],
              template: '<md-dialog aria-label="正在清除"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular> 正在清除数据，请稍候……({{cacheInfo}})</md-dialog-content></md-dialog>',
              parent: angular.element(document.body),
              clickOutsideToClose:false,
              fullscreen: false
            })
            .then(function(answer) {
              auth.logout();
            }, function() {

            });
          return;
        }
        vm.trueClear(['v_profile']);
      });
    }
    //消息中心
    function reloadMessage() {
      return  remote.message.messageList(0, 0).then(function (result) {
        vm.messages = [];
        vm.system_messages=[];
        result.data.Items.forEach(function (item) {
          var name="系统提示";
          item.style={
            background:"#f00"
          }
          var newItem={
            id: item.Id,
            name:name,
            time: item.SendTime,
            title: item.Title,
            description: item.Content,
            ExtrasContent:item.ExtrasContent,
            style:item.style
          }
          if (item.ExtrasContent&&item.ExtrasContent.Status&&item.ExtrasContent.Status<4){
            newItem.name="工序验收";
            vm.messages.push(newItem)
          }else {
            vm.system_messages.push(newItem)
          }
        })

        function DynamicItems() {
          /**
           * @type {!Object<?Array>} Data pages, keyed by page number (0-index).
           */
          this.loadedPages = {};

          /** @type {number} Total number of items. */
          this.numItems = 0;

          /** @const {number} Number of items to fetch per request. */
          this.PAGE_SIZE = 50;

          this.fetchNumItems_();
        };
        // Required.
        DynamicItems.prototype.getItemAtIndex = function(index) {
          var pageNumber = Math.floor(index / this.PAGE_SIZE);
          var page = this.loadedPages[pageNumber];

          if (page) {
            return page[index % this.PAGE_SIZE];
          } else if (page !== null) {
            this.fetchPage_(pageNumber);
          }
        };
        // Required.
        DynamicItems.prototype.getLength = function() {
          return this.numItems;
        };

        DynamicItems.prototype.fetchPage_ = function(pageNumber) {
          // Set the page to null so we know it is already being fetched.
          this.loadedPages[pageNumber] = null;

          // For demo purposes, we simulate loading more items with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.loadedPages[pageNumber] = [];
            var pageOffset = pageNumber * this.PAGE_SIZE;
            for (var i = pageOffset; i < pageOffset + this.PAGE_SIZE; i++) {
              if (vm.messages[i]){
                this.loadedPages[pageNumber].push(vm.messages[i]);
              }
            }
          }));
        };

        DynamicItems.prototype.fetchNumItems_ = function() {
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.numItems = vm.messages.length;
          }));
        };
        vm.dynamicItems = new DynamicItems();
        function sys_DynamicItems(){
          /**
           * @type {!Object<?Array>} Data pages, keyed by page number (0-index).
           */
          this.loadedPages = {};

          /** @type {number} Total number of items. */
          this.numItems = 0;

          /** @const {number} Number of items to fetch per request. */
          this.PAGE_SIZE = 50;

          this.fetchNumItems_();
        }
        sys_DynamicItems.prototype=new DynamicItems();
        sys_DynamicItems.prototype.fetchPage_ =function(pageNumber) {
          // Set the page to null so we know it is already being fetched.
          this.loadedPages[pageNumber] = null;

          // For demo purposes, we simulate loading more items with a timed
          // promise. In real code, this function would likely contain an
          // $http request.
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.loadedPages[pageNumber] = [];
            var pageOffset = pageNumber * this.PAGE_SIZE;
            for (var i = pageOffset; i < pageOffset + this.PAGE_SIZE; i++) {
              if (vm.system_messages[i]){
                this.loadedPages[pageNumber].push(vm.system_messages[i]);
              }
            }
          }));
        };
        sys_DynamicItems.prototype.fetchNumItems_ = function() {
          $timeout(angular.noop, 0).then(angular.bind(this, function() {
            this.numItems = vm.system_messages.length;
          }));
        };
        vm.sys_dynamicItems = new sys_DynamicItems();

      })
    }
    reloadMessage();

    function operateMsg(ev){
      utils.confirm('确认全部删除?',ev,'','').then(function(){
        remote.message.deleteAllMessage().then(function () {
          reloadMessage();
        })
      })
    }
    vm.sysMsg=false;
    var event=   $rootScope.$on('operateMsg',operateMsg);
    var msgEvent=   $rootScope.$on('sendMsg',function(d,data){
      vm.sysMsg=data;
    });
    vm.action=function(item,evt){
      if (!(item.ExtrasContent&&item.ExtrasContent.Status&&item.ExtrasContent.Status<4)){
        return;
      }
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '处 理',
            action: function () {
              $mdBottomSheet.hide();
              if (item.ExtrasContent&&item.ExtrasContent.Status){
                item.ExtrasContent.id=item.id;
                switch (item.ExtrasContent.Status){
                  case 1:
                    vm.jlysAction(item.ExtrasContent);
                    break;
                  case 2:
                    vm.zbzgAction(item.ExtrasContent)
                    break;
                  case 3:
                    vm.jlfyAction(item.ExtrasContent);
                    break;
                  case 4:
                    break;
                }
              }
            }
          }, {
            title: '删 除',
            action: function () {
              $mdBottomSheet.hide();
              remote.message.deleteMessage(item.id).then(function () {
                reloadMessage();
              })
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

    //业务逻辑
    var dbpics = db('pics');
    var globalTask = [
      function () {
        return remote.Procedure.queryProcedure();
      }
    ];
    function projectTask(projectId, areas, acceptanceItemID) {
      return [
        function (tasks) {
          return $q(function (resolve) {
            var arr = [
              remote.Project.getDrawingRelations(projectId),
              dbpics.findAll()
            ];
            $q.all(arr).then(function (res) {
              var result = res[0], offPics = res[1].rows;
              var pics = [];
              result.data.forEach(function (item) {
                if ((!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
                  (!areas || areas.find(function (a) {
                    return a.AreaID == item.RegionId;
                  })) &&
                  pics.indexOf(item.DrawingID) == -1 && !offPics.find(function (r) {
                    return r._id == item.DrawingID;
                  }) && vm.procedure.find(function (k) {
                    return k.AcceptanceItemID == item.AcceptanceItemID;
                  })) {
                  pics.push(item.DrawingID);
                }
              });
              pics.forEach(function (drawingID) {
                tasks.push(function () {
                  return remote.Project.getDrawing(drawingID).then(function () {
                    dbpics.addOrUpdate({
                      _id: drawingID
                    })
                  });
                })
              });
              resolve(result);
            });
          })
        },
        function () {
          return remote.Project.queryAllBulidings(projectId);
        }
      ]
    }
    function InspectionTask(item) {
      var t = [function () {
        return remote.Project.getInspectionList(item.InspectionId);
      }];
      item.AreaList.forEach(function (area) {
        t.push(function (tasks, down) {
          return remote.Procedure.InspectionCheckpoint.query(item.AcceptanceItemID, area.AreaID, item.InspectionId).then(function (result) {
            result.data.forEach(function (p) {
              tasks.push(function () {
                return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                  result.data.forEach(function (r) {
                    tasks.push(function () {
                      return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                      })
                    })
                  })
                })
              });
            });
          })
        });
        t.push(function () {
          return remote.Procedure.InspectionIndexJoinApi.query(item.InspectionId)
        })
        t.push(function () {
          return remote.Procedure.InspectionPoint.query(item.InspectionId, item.AcceptanceItemID, area.AreaID)
        })

      });
      return t;
    }
    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.Procedure.getZGById(item.RectificationID).then(function (r) {
            r.data[0].Children.forEach(function (area) {
              tasks.push(function () {
                return remote.Procedure.getZGReginQues(area.AreaID, item.RectificationID);
              });
              tasks.push(function () {
                return remote.Procedure.getZGReginQuesPoint(area.AreaID, item.RectificationID);
              })
            })
          });
        },
        function () {
          return remote.Procedure.getRectification(item.RectificationID);
        }
      ]
    }

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaList[0].substring(0, 5), item.AreaList, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'ys' + item.InspectionId});
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, {timeout: 300000})
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }
    api.event('downloadys', function (s, e) {
      var current = e.target;
      switch (e.event) {
        case 'progress':
          current.percent = parseInt(e.percent * 100) + ' %';
          current.current = e.current;
          current.total = e.total;
          break;
        case 'success':
          break;
      }
    }, $scope);

    vm.downloadzg = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.AreaList[0].substring(0, 5), item.AreaList, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(rectificationTask(item))
                .concat(function () {
                  return remote.offline.create({Id: 'zg' + item.RectificationID});
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                remote.offline.create({Id: 'zg' + item.RectificationID});
                //RectificationID
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }
    api.event('downloadzg', function (s, e) {
      var current = e.target;
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);

    vm.jlfyAction = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      vm.downloadzg(item).then(function () {
        api.setNetwork(1).then(function () {
          remote.message.deleteMessage(item.id).then(function(){
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'jl',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID
            })
          })
        });
      })
    }
    vm.zbzgAction = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      vm.downloadzg(item).then(function () {
        api.setNetwork(1).then(function () {
          remote.message.deleteMessage(item.id).then(function(){
            $state.go('app.xhsc.gx.gxzg', {
              Role: 'zb',
              InspectionID: item.InspectionId,
              AcceptanceItemID: item.AcceptanceItemID,
              RectificationID: item.RectificationID,
              AcceptanceItemName: item.AcceptanceItemName
            });
          })
        });
      })
    }
    vm.jlysAction = function (item) {
      item.InspectionId=item.InspectionId?item.InspectionId:item.InspectionID;
      vm.downloadys(item).then(function () {
        api.setNetwork(1).then(function () {
          remote.message.deleteMessage(item.id).then(function(){
            $state.go('app.xhsc.gx.gxtest', {
              acceptanceItemID: item.AcceptanceItemID,
              acceptanceItemName: item.AcceptanceItemName,
              name: item.AreaList[0].newName,
              projectId: item.AreaList[0].substring(0, 5),
              areaId: item.AreaList[0],
              InspectionId: item.InspectionId
            })
          })
        });
      })
    }

    $scope.$on("$destroy",function(){
      event();
      msgEvent();
      $rootScope.msg=false;
      event=null;
    });
  }
})();

/**
 * Created by emma on 2016/6/8.
 */
(function(){
  'use strict';

  mcenterController.$inject = ["$scope", "$rootScope", "$http", "xhUtils", "sxt", "remote", "utils"];
  angular
    .module('app.xhsc')
    .controller('mcenterController',mcenterController);

  /**@ngInject*/
  function mcenterController($scope,$rootScope,$http,xhUtils,sxt,remote,  utils){

    var vm = this;

    function reloadMessage() {

      remote.message.messageList(0, 0).then(function (result) {

        vm.messages = [];
        result.data.Items.forEach(function (item) {
          vm.messages.push({
            id: sxt.uuid(),
            name: '系统',
            time: item.SendTime,
            title: item.Title,
            description: item.Content
          });

        })
      })
    }
    reloadMessage();
    var onMessage = $rootScope.$on('receiveMessage',function(){
      reloadMessage();
    })

    $scope.$on('destroy',function(){
      onMessage();
    })


    vm.messages&&vm.messages.forEach(function(t){
      t.checked = false;
    })
    $scope.$watch('vm.msgList',function(){
      var i=0;
      vm.messages&&vm.messages.forEach(function(t){
        console.log(t.checked)
        if(t.checked){
          i++;
        }
      })
      if(i){
        vm.showSend = true;
      }else{
        vm.showSend  = false;
      }
    },true)

    function operateMsg(ev){

      utils.confirm('确认全部删除?',ev,'','').then(function(){
       remote.message.deleteAllMessage().then(function () {
          vm.messages = [];
        })
      })
    }
    var event=   $rootScope.$on('operateMsg',operateMsg);
    $scope.$on("$destroy",function(){
      //$mdDialog
      event();
      event=null;
    });
  }
})();

/**
 * Created by jiuyuong on 2016/3/30.
 */
(function (angular, undefined) {
  'use strict';

  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.plan', ['app.core','app.xhsc',
      'gantt',
      'gantt.sortable',
      'gantt.movable',
      'gantt.drawtask',
      'gantt.tooltips',
      'gantt.bounds',
      'gantt.progress',
      'gantt.table',
      'gantt.tree',
      'gantt.groups',
      'gantt.dependencies',
      'gantt.overlap',
      'gantt.resizeSensor','angularFileUpload'])
    .config(config);

  /** @ngInject */
  function config($stateProvider, msNavigationServiceProvider) {
    $stateProvider
      .state('app.plan', {
        url: '/plan',
        views: {
          'content@app': {
            template: '<ui-view class="animate-slide-left" flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      .state('app.plan.task', {
        url: '/task',
        abstract: true,
        template: '<ui-view flex layout="column"></ui-view>'
      })
      .state('app.plan.task.demo', {
        url: '/demo/taskTable',
        template: '<div task-table flex></div>'
      })
      .state('app.plan.task.list', {
        url: '',
        template: '<plan-tasks flex layout="column"></plan-tasks>'
      })
      .state('app.plan.task.detail', {
        url: '/levels/{id}/{templateId}',
        template: '<plan-task-v flex layout="column"></plan-task-v>'
      })
      .state('app.plan.task.detailLevel', {
        url: '/level0/{id}',
        template: '<plan-task-level flex layout="column"></plan-task-level>'
      })
      .state('app.plan.template', {
        url: '/temp',
        abstract: true,
        template: '<ui-view flex layout="column"></ui-view>'
      })
      .state('app.plan.template.list', {
        url: '',
        template: '<plan-templates flex layout="column"></plan-templates>'
      })
      .state('app.plan.template.detail', {
        url: '/{id}/{taskLibraryId}',
        template: '<plan-template flex layout="column"></plan-template>'
      })
      .state('app.plan.bc', {
        url: '/bc',
        abstract: true,
        template: '<ui-view flex layout="column"></ui-view>'
      })
      .state('app.plan.bc.list', {
        url: '',
        template: '<plan-bc flex layout="column"></plan-bc>'
      })
      .state('app.plan.bc.detail', {
        url: '/{id}',
        template: '<plan-bcAdd flex layout="column"></plan-bcAdd>'
      })
      .state('app.plan.buildPlan',{
        url:'/build',
        template:'<plan-build flex layout="column"></plan-build>'
      })
      .state('app.plan.create',{
        url:'/create',
        template:'<plan-create flex layout="column"></plan-create>'
      })

      .state('app.plan.milestone',{
        url:'/milestone/{id}',
        abstract:true,
        template:'<ui-view layout="column" flex></ui-view>'
        //template:'<plan-milestone flex layout="column"></plan-milestone>'
      })
      .state('app.plan.milestone.gantt',{
        url:'/gantt',
        template:'<plan-milestone flex layout="column"></plan-milestone>'
      })
      .state('app.plan.milestone.item',{
        url:'/item',
        template:'<plan-gantt flex layout="column"></plan-gantt>'
      })
      .state('app.plan.gantts',{
        url:'/gantts',
        template:'<plan-ganttlist flex layout="column"></plan-ganttlist>'
      })
      .state('app.plan.personplan',{
        url:'/personplan',
        template:'<plan-personplan layout="column" flex></plan-personplan>',
        sendBt: false,
        noBack:true
      })
      .state('app.plan.report',{
        url:'/report',
        template:'<plan-report layout="column" flex></plan-report>'
      })
    msNavigationServiceProvider.saveItem('plan', {
      title: '计划管理',
      group: true,
      weight: 2
    });
    msNavigationServiceProvider.saveItem('plan.build', {
      title: '创建计划',
      state: 'app.plan.buildPlan',
      icon: 'icon-open-in-new',
      weight: 1
    });
    msNavigationServiceProvider.saveItem('plan.gantt', {
      title: '查看计划',
      state: 'app.plan.gantts',
      icon: 'icon-poll',
      weight: 1
    });
    msNavigationServiceProvider.saveItem('plan.template', {
      title: '模板管理',
      icon: 'icon-folder',
      weight: 1
    });
    msNavigationServiceProvider.saveItem('plan.personplan', {
      title: '个人计划',
      icon: 'icon-view-list',
      state:'app.plan.personplan',
      weight: 1
    });
    msNavigationServiceProvider.saveItem('plan.report', {
      title: '报表管理',
      icon: 'icon-table',
      state: 'app.plan.report',
      weight: 1
    });
    msNavigationServiceProvider.saveItem('plan.template.template', {
      title: '模板',
      state: 'app.plan.template.list',
      weight: 1
    });

    msNavigationServiceProvider.saveItem('plan.template.task', {
      title: '任务',
      state: 'app.plan.task.list',
      weight: 1
    });
    //msNavigationServiceProvider.saveItem('plan.template.task.demo', {
    //  title: 'demo',
    //  state: 'app.plan.task.demo',
    //  icon: 'icon-account',
    //  weight: 1
    //});

    msNavigationServiceProvider.saveItem('plan.template.bc', {
      title: '补偿',
      state: 'app.plan.bc.list',
      weight: 1
    });
  }
})(angular, undefined);

/**
 * Created by jiuyuong on 2016/9/22.
 */
(function (angular,undefined) {
  template.$inject = ["$window"];
  angular
    .module('app.plan')
    .factory('template',template);
  /** @ngInject */
  function template($window) {
    var GitGraph = $window.GitGraph;
    GitGraph.Commit.prototype._render = GitGraph.Commit.prototype.render;
    GitGraph.Commit.prototype.render = function () {
      this._render();
      this.context.fillStyle = 'white';
      if(this.tag) {
        var r = /\d+/.exec(this.tag), seq = r && r[0];
        if(r && seq)
          this.context.fillText(seq, this.x-(seq.length==1?5:8), this.y+5);
      }
    }
    GitGraph.Branch.prototype.merge = function ( target, commitOptions ) {
      // Merge target
      var targetBranch = target || this.parent.HEAD;

      // Check integrity of target
      if ( targetBranch instanceof GitGraph.Branch === false || targetBranch === this ) {
        return this;
      }
      // Add points to path
      var targetCommit = targetBranch.commits.slice( -1 )[ 0 ];
      var endOfBranch = {
        x: this.offsetX + this.template.commit.spacingX * (targetCommit.showLabel ? 3 : 2) - this.parent.commitOffsetX,
        y: this.offsetY + this.template.commit.spacingY * (targetCommit.showLabel ? 3 : 2) - this.parent.commitOffsetY,
        type: "join"
      };
      this.pushPath( JSON.parse( JSON.stringify( endOfBranch ) ) ); // Elegant way for cloning an object

      var mergeCommit = {
        x: targetCommit.x,
        y: targetCommit.y,
        type: "end"
      };
      this.pushPath( mergeCommit );
      endOfBranch.type = "start";
      this.pushPath( endOfBranch );
      this.parent.render();
      this.parent.HEAD = targetBranch;
      return this;
    };

/*    var graphTemplate = new $window.GitGraph.Template({
      colors: [ "#ffae4b", "#00b8ff", "#00c98f","#4cd9b0" ],
      branch: {
        lineWidth: 6,
        spacingX: 90,
        mergeStyle: "straight",
        showLabel: true,
        // display Branch names on graph
        labelFont: "normal 14px arial"
      },
      commit: {
        spacingY: -45,
        dot: {
          size: 14,
          strokeColor: "white",
          strokeWidth: 2
        },
        tag: {
          font: "normal 13px arial",
          strokeWidth: 1
        },
        message: {
          display:false
        },
        shouldDisplayTooltipsInCompactMode:false
      },
      //arrow: {
      //  size: 8,
      //  offset: 0.5
      //}
    });*/
    var graphTemplate = new $window.GitGraph.Template({
      colors: [ "#fb9013", "#ffba13", "#93ed12","#11ea6d","#05ecce","0ab5f4" ],
      branch: {
        lineWidth: 1,
        spacingX: 20,
        mergeStyle: "bezier",
        showLabel: false,
        // display Branch names on graph
        labelFont: "normal 12px arial"
      },
      commit: {

        spacingY: -44,
        dot: {
          size: 8,
          strokeColor: "white",
          strokeWidth: 1
        },
        tag: {
          font: "normal 12px arial",
          strokeWidth: 1,
          display:false
        },
        message: {
          display:false
        },
        shouldDisplayTooltipsInCompactMode:false
      },
      //arrow: {
      //  size: 8,
      //  offset: 0.5
      //}
    });
    function FTemplate(options) {
      this.options = extend(options, {});
      this.options.config = extend(this.options.config,{
        template:graphTemplate,
        mode:'extend',
        orientation:'vertical'
      });
      this.init();
    }
    FTemplate.prototype.init = function () {
      var g = $window.$('#gitGraph'),
        p = g.parent(),
        scrollTop = p.scrollTop();
      g.remove();
      p.append('<canvas id="gitGraph"></canvas>');

      var gitGraph = this.gitGraph = new GitGraph(this.options.config);
      gitGraph.canvas.addEventListener( "graph:render", function ( event ) {
        //console.log( event.data.id, "graph has been rendered" );
      } );

      gitGraph.canvas.addEventListener( "commit:mouseover", function ( event ) {
        //console.log( "You're over a commit.", event.data );
        this.style.cursor = "pointer";
      } );

      gitGraph.canvas.addEventListener("commit:mouseout", function (event) {
        //console.log( "You just left this commit ->", event.data );
        this.style.cursor = "auto";
      });

      gitGraph.canvas.addEventListener('graph:render',function () {
        p.scrollTop(scrollTop);
      })
    }
    FTemplate.prototype.load = function load(task) {
      this.task = task;
      var groups = [],lines = [],times=[];
      this.line = fillTask(groups,lines,0,task);
      groups.forEach(function (g) {
        //if(!g.ParentId){
          appendRoot(times,groups,lines,g);
        //}
      });
      this.times = times;
      this.render();
      return times.filter(function (t) {
        return t.type !== 'line';
      })
    }
    FTemplate.prototype.onClick = function (e) {
      var data = this.times.find(function (d) {
        return d.TaskFlowId === e.author;
      });
      this.options.onClick && this.options.onClick({e:e,data:data});
    }
    FTemplate.prototype.render = function () {
      this.gitGraph = null;
      this.init();
      var self = this,times = self.times,
        Branch = self.Branch = [],
        gitGraph = self.gitGraph;
      function onClick(e) {
        self.onClick(e);
      }
      function getBranch(line) {
        var b1 = Branch.find(function (b) {
          return b.line==line;
        });
        return b1 && b1.b;
      }
      times.forEach(function (t) {
        switch (t.type){
          case 'line':
            Branch.push({
              line: t.line,
              b: gitGraph.branch({
                name: t.Name || ('b' + Branch.length),
                showLabel: false,
                column: t.line<5?t.line:(t.line % 5)+1,
                parentBranch: getBranch(t.parent)
              })
            });
            break;
          case 'merge':
            var ix=t.merge.length===1?2:0;
            getBranch(t.line).commit({
             author:t.TaskFlowId,
             //tag: (t.seq+1)+'、'+ t.Name,
             displayTagBox:false,
             message:t.Name,
             onClick:onClick,
             color:self.options.onNodeColor && self.options.onNodeColor(t),
             dotColor:self.options.onNodeDotColor && self.options.onNodeDotColor(t)
             });
            t.merge.forEach(function (m) {
              getBranch(m).merge(getBranch(t.line),{
                author:t.TaskFlowId,
                seq:t.seq+1,
                //tag:ix!==0?(t.seq+1)+'、'+ t.Name:undefined,
                tag:t.tag,
                displayTagBox:false,
                dotSize:ix===0?1:0,
                dotStrokeWidth:ix===0?1:0,
                dotStrokeColor:ix===0?'transparent':0,
                onClick:onClick,
                color:self.options.onNodeColor && self.options.onNodeColor(t),
                dotColor:self.options.onNodeDotColor && self.options.onNodeDotColor(t)
              });
              ix++;
            });

            break;
          default:
            if(t.line || t.line===0){
              //console.log('commnt',t.Name);
              getBranch(t.line).commit({
                author:t.TaskFlowId,
                //tag: (t.seq+1)+'、'+ t.Name,
                tag:t.tag,
                displayTagBox:false,
                message:t.Name,
                onClick:onClick,
                color:self.options.onNodeColor && self.options.onNodeColor(t),
                dotColor:self.options.onNodeDotColor && self.options.onNodeDotColor(t)
              });
            }
            break;
        }
      });
    }
    FTemplate.prototype.add = function (data,prev,isBranch) {
      if(prev && !prev.TaskFlowId)
        prev = null;

      var container = !prev||prev.line===0?this.task.Master:this.task.Branch.find(function (b) {
        return b.indexOf(prev)!=-1;
      });
      if(prev)
        data.ParentId = prev.TaskFlowId;
      if(isBranch){
        this.task.Branch.push([data]);
      }
      else{
        container.push(data);
      }
      return this.load(this.task);
    }
    FTemplate.prototype.edit = function (data) {
      this.render();
    }
    FTemplate.prototype.remove = function (data) {
      var container = this.task.Master.indexOf(data)!=-1?
        this.task.Master:
        this.task.Branch.find(function (b) {
          return b.indexOf(data)!=-1;
        });
      var index = container.indexOf(data);
      if(index===0 && container===this.task.Master && container.length===1){
        this.task.Master = [];
        this.task.Branch = [];
      }
      else{
        var next = container[index+1];
        container.splice(index,1);
        if(next) {
          next.ParentId = data.ParentId;
          this.task.Branch.forEach(function (b) {
            if (b[0].ParentId === data.TaskFlowId) {
              b[0].ParentId = next.TaskFlowId;
            }
          });
        }
      }
      for(var l=this.task.Branch.length-1;l>=0;l--){
        if(this.task.Branch[l].length===0){
          this.task.Branch.splice(l,1);
        }
      }
      return this.load(this.task);
    }
    function extend(obj,ext) {
      obj = obj||{};
      for(var k in ext){
        if(ext.hasOwnProperty(k) && !obj.hasOwnProperty(k)){
          obj[k] = ext[k];
        }
      }
      return obj;
    }
    function appendRoot(times,groups,lines,g) {
      if(g.TaskFlowId && !times.find(function (t) {
          return t.TaskFlowId===g.TaskFlowId;
        })) {
        var line = lines.find(function (l) {
          return l.line === g.line;
        });
        times.push(line);
        times.push(g);
      }
      appendTask(times,groups,lines,g);
    }
    function appendTask(times,groups,lines,gp) {
      if(!gp || !gp.TaskFlowId) return;
      var fds = groups.filter(function (g) {
        return g.ParentId === gp.TaskFlowId;
      });
      fds.sort(function (s1,s2) {
        if(s1.line===gp.line)
          return 1;
        if(s2.line===gp.line)
          return -1;
        return 0;
      }).forEach(function (fd) {
        if(fd.merge){
          fd.merge = [];
        }
        var ends = fd.TaskFlowId && groups.filter(function (g) {
            return g.EndFlagTaskFlowId === fd.TaskFlowId;
          });
        ends && ends.forEach(function (e) {
          if(!fd.merge) {
            fd.merge = [];
            fd.type = 'merge';
          }
          fd.merge.push(e.line);
        })
        if(fd.line != gp.line){
          var line = lines.find(function (l) {
            return l.line === fd.line;
          });
          line.parent = gp.line;
          times.push(line);
        }
        if(fd.TaskFlowId && times.find(function (g) {
            return g.TaskFlowId===fd.TaskFlowId;
          })) {
          return;
        }
        times.push(fd);
        appendTask(times, groups, lines, fd);
        //
        /*      if(fd.EndFlagTaskFlowId){
         var ed = groups.find(function (g) {
         return g.TaskFlowId === fd.EndFlagTaskFlowId;
         });
         if(ed){
         var eRoot = findLineRoot(groups,ed);
         appendRoot(times,groups,lines,eRoot);
         }
         }*/
      });
      /*    fds.forEach(function (fd) {
       appendTask(times, groups, lines, fd);
       })*/
    }
    function findLineRoot(groups,g1) {
      var prev = groups.find(function (g) {
        return g.line===g1.line && g1.ParentId===g.TaskFlowId;
      });
      return prev?findLineRoot(groups,prev):g1;
    }
    function fillTask(groups,lines,t,task,parent) {
      var t2 = t;
      task.type = 'line';
      task.line = t2;
      lines.push(task);
      var prev = null,seq=0;
      var laskTask;
      task.Master && task.Master.forEach(function (g) {
        g.seq = seq++;
        g.ParentId = prev ? prev.TaskFlowId : parent && parent.TaskFlowId;
        if(prev)
          prev.hasNext = true;
        prev = g;
        g.line = t2;
        groups.push(g);

        if (laskTask) {
          laskTask.EndFlagTaskFlowId = g.TaskFlowId;
          laskTask = null;
        }
        g.tasks && g.tasks.forEach(function (tk) {
          if (tk.Master.length) {
            tk.Master[0].ParentId = g.TaskFlowId;
            laskTask = tk.Master[tk.Master.length - 1];
            t = fillTask(groups, lines, t + 1, tk, g);
          }
        });
      });
      task.Branch && task.Branch.forEach(function (b) {
        lines.push({
          type:'line',
          line:(++t)
        });
        prev = null;
        seq=0;
        b.forEach(function (g) {
          if(prev)
            prev.hasNext = true;
          g.seq = seq++;
          prev = g;
          g.line = t;
          groups.push(g);
          g.tasks && g.tasks.forEach(function (tk) {
            t = fillTask(groups,lines,t+1,tk,g);
          })
        });
      });

      return t;
    }
    return FTemplate;
  }
})(angular,undefined);

/**
 * Created by emma on 2016/9/28.
 */

(function(){
  'use strict';
  angular.module('gantt').factory('GanttRow', ['GanttTask', 'moment', '$filter', function(Task, moment, $filter) {
    var Row = function(rowsManager, model) {
      this.rowsManager = rowsManager;
      this.model = model;

      this.from = undefined;
      this.to = undefined;
      this.realFrom = undefined;
      this.realTo = undefined;
      this.duration = undefined;
      //this.duration = model.tasks&&model.tasks[0].duration;

      this.tasksMap = {};
      this.tasks = [];
      this.filteredTasks = [];
      this.visibleTasks = [];
    };

    Row.prototype.addTaskImpl = function(task, viewOnly) {
      this.tasksMap[task.model.id] = task;
      this.tasks.push(task);

      if (!viewOnly) {
        if (this.model.tasks === undefined) {
          this.model.tasks = [];
        }
        if (this.model.tasks.indexOf(task.model) === -1) {
          this.model.tasks.push(task.model);
        }
      }

    };

    // Adds a task to a specific row. Merges the task if there is already one with the same id
    Row.prototype.addTask = function(taskModel, viewOnly) {
      // Copy to new task (add) or merge with existing (update)
      var task, isUpdate = false;

      this.rowsManager.gantt.objectModel.cleanTask(taskModel);
      if (taskModel.id in this.tasksMap) {
        task = this.tasksMap[taskModel.id];
        if (task.model === taskModel) {
          return task;
        }
        task.model = taskModel;
        isUpdate = true;
      } else {
        task = new Task(this, taskModel);
        this.addTaskImpl(task, viewOnly);
      }

      this.sortTasks();
      this.setFromToByTask(task);

      if (!viewOnly) {
        if (isUpdate) {
          this.rowsManager.gantt.api.tasks.raise.change(task);
        } else {
          this.rowsManager.gantt.api.tasks.raise.add(task);
        }
      }

      return task;
    };

    // Removes the task from the existing row and adds it to he current one
    Row.prototype.moveTaskToRow = function(task, viewOnly) {
      var oldRow = task.row;
      oldRow.removeTask(task.model.id, viewOnly, true);

      task.row = this;
      this.addTaskImpl(task, viewOnly);

      this.sortTasks();
      this.setFromToByTask(task);

      task.updatePosAndSize();
      this.updateVisibleTasks();

      oldRow.$scope.$digest();
      task.row.$scope.$digest();

      this.rowsManager.gantt.api.tasks.raise.viewRowChange(task, oldRow);
      if (!viewOnly) {
        this.rowsManager.gantt.api.tasks.raise.rowChange(task, oldRow);
      }
    };

    Row.prototype.updateVisibleTasks = function() {
      var filterTask = this.rowsManager.gantt.options.value('filterTask');
      if (filterTask) {
        if (typeof(filterTask) === 'object') {
          filterTask = {model: filterTask};
        }

        var filterTaskComparator = this.rowsManager.gantt.options.value('filterTaskComparator');
        if (typeof(filterTaskComparator) === 'function') {
          filterTaskComparator = function(actual, expected) {
            return filterTaskComparator(actual.model, expected.model);
          };
        }

        this.filteredTasks = $filter('filter')(this.tasks, filterTask, filterTaskComparator);
      } else {
        this.filteredTasks = this.tasks.slice(0);
      }
      this.visibleTasks = $filter('ganttTaskLimit')(this.filteredTasks, this.rowsManager.gantt);
    };

    Row.prototype.updateTasksPosAndSize = function() {
      for (var j = 0, k = this.tasks.length; j < k; j++) {
        this.tasks[j].updatePosAndSize();
      }
    };

    // Remove the specified task from the row
    Row.prototype.removeTask = function(taskId, viewOnly, silent) {
      if (taskId in this.tasksMap) {
        var removedTask = this.tasksMap[taskId];
        var task;
        var i;

        for (i = this.tasks.length - 1; i >= 0; i--) {
          task = this.tasks[i];
          if (task.model.id === taskId) {
            this.tasks.splice(i, 1); // Remove from array

            // Update earliest or latest date info as this may change
            if (this.from - task.model.from === 0 || this.to - task.model.to === 0) {
              this.setFromTo();
            }

            break;
          }
        }

        for (i = this.filteredTasks.length - 1; i >= 0; i--) {
          task = this.filteredTasks[i];
          if (task.model.id === taskId) {
            this.filteredTasks.splice(i, 1); // Remove from filtered array
            break;
          }
        }

        for (i = this.visibleTasks.length - 1; i >= 0; i--) {
          task = this.visibleTasks[i];
          if (task.model.id === taskId) {
            this.visibleTasks.splice(i, 1); // Remove from visible array
            break;
          }
        }

        if (!viewOnly) {
          delete this.tasksMap[taskId]; // Remove from map

          if (this.model.tasks !== undefined) {
            var taskIndex = this.model.tasks.indexOf(removedTask.model);
            if (taskIndex > -1) {
              this.model.tasks.splice(taskIndex, 1);
            }
          }

          if (!silent) {
            this.rowsManager.gantt.api.tasks.raise.remove(removedTask);
          }
        }

        return removedTask;
      }
    };

    Row.prototype.removeAllTasks = function() {
      this.from = undefined;
      this.to = undefined;
      this.realFrom = undefined;
      this.realTo = undefined;

      this.duration = undefined;

      this.tasksMap = {};
      this.tasks = [];
      this.filteredTasks = [];
      this.visibleTasks = [];
    };

    // Calculate the earliest from and latest to date of all tasks in a row
    Row.prototype.setFromTo = function() {
      this.from = undefined;
      this.to = undefined;
      this.realFrom = undefined;
      this.realTo = undefined;
      this.duration = undefined;

      for (var j = 0, k = this.tasks.length; j < k; j++) {
        this.setFromToByTask(this.tasks[j]);
      }
    };

    Row.prototype.setFromToByTask = function(task) {
      this.setFromToByValues(task.model.from, task.model.to,task.model.realFrom,task.model.realTo);
    };

    Row.prototype.setFromToByValues = function(from, to,realFrom,realTo) {
      if (from !== undefined) {
        if (this.from === undefined) {
          this.from = moment(from);
        } else if (from < this.from) {
          this.from = moment(from);
        }
      }

      if (to !== undefined) {
        if (this.to === undefined) {
          this.to = moment(to);
        } else if (to > this.to) {
          this.to = moment(to);
        }
      }
      if(from !==undefined && to !== undefined){
        this.duration = this.to.diff(this.from, 'day');
      }
      if(realFrom !==undefined){
        if (this.realFrom === undefined) {
          this.realFrom = moment(realFrom);
        } else if (realFrom > this.realFrom) {
          this.realFrom = moment(realFrom);
        }
      }
      if(realTo !==undefined){
        if (this.realTo === undefined) {
          this.realTo = moment(realTo);
        } else if (realTo > this.realTo) {
          this.realTo = moment(realTo);
        }
      }

    };

    Row.prototype.sortTasks = function() {
      this.tasks.sort(function(t1, t2) {
        return t1.left - t2.left;
      });
    };

    Row.prototype.clone = function() {
      var clone = new Row(this.rowsManager, angular.copy(this));
      for (var i = 0, l = this.tasks.length; i < l; i++) {
        clone.addTask(this.tasks[i].model);
      }
      return clone;
    };

    return Row;
  }]);
}());

(function(){
  'use strict';
  angular.module('gantt').factory('GanttColumnsManager', ['GanttColumnGenerator', 'GanttColumnBuilder', 'GanttHeadersGenerator', '$filter', '$timeout', 'ganttLayout', 'ganttBinarySearch', 'moment', function(ColumnGenerator, ColumnBuilder, HeadersGenerator, $filter, $timeout, layout, bs, moment) {
    var ColumnsManager = function(gantt) {
      var self = this;

      this.gantt = gantt;

      this.from = undefined;
      this.to = undefined;

      this.columns = [];
      this.visibleColumns = [];
      this.previousColumns = [];
      this.nextColumns = [];

      this.headers = [];
      this.visibleHeaders = [];

      this.scrollAnchor = undefined;

      this.columnBuilder = new ColumnBuilder(this);

      // Add a watcher if a view related setting changed from outside of the Gantt. Update the gantt accordingly if so.
      // All those changes need a recalculation of the header columns
      this.gantt.$scope.$watchGroup(['viewScale', 'columnWidth', 'timeFramesWorkingMode', 'timeFramesNonWorkingMode', 'fromDate', 'toDate', 'autoExpand', 'taskOutOfRange'], function(newValues, oldValues) {
        if (newValues !== oldValues && self.gantt.rendered) {
          self.generateColumns();
        }
      });

      this.gantt.$scope.$watchCollection('headers', function(newValues, oldValues) {
        if (newValues !== oldValues && self.gantt.rendered) {
          self.generateColumns();
        }
      });

      this.gantt.$scope.$watchCollection('headersFormats', function(newValues, oldValues) {
        if (newValues !== oldValues && self.gantt.rendered) {
          self.generateColumns();
        }
      });

      this.gantt.$scope.$watchGroup(['ganttElementWidth', 'showSide', 'sideWidth', 'maxHeight', 'daily'], function(newValues, oldValues) {
        if (newValues !== oldValues && self.gantt.rendered) {
          self.updateColumnsMeta();
        }
      });

      this.gantt.api.data.on.load(this.gantt.$scope, function() {
        if ((self.from === undefined || self.to === undefined ||
          self.from > self.gantt.rowsManager.getDefaultFrom() ||
          self.to < self.gantt.rowsManager.getDefaultTo()) && self.gantt.rendered) {
          self.generateColumns();
        }

        self.gantt.rowsManager.sortRows();
      });

      this.gantt.api.data.on.remove(this.gantt.$scope, function() {
        self.gantt.rowsManager.sortRows();
      });

      this.gantt.api.registerMethod('columns', 'clear', this.clearColumns, this);
      this.gantt.api.registerMethod('columns', 'generate', this.generateColumns, this);
      this.gantt.api.registerMethod('columns', 'refresh', this.updateColumnsMeta, this);
      this.gantt.api.registerMethod('columns', 'getColumnsWidth', this.getColumnsWidth, this);
      this.gantt.api.registerMethod('columns', 'getColumnsWidthToFit', this.getColumnsWidthToFit, this);
      this.gantt.api.registerMethod('columns', 'getDateRange', this.getDateRange, this);

      this.gantt.api.registerEvent('columns', 'clear');
      this.gantt.api.registerEvent('columns', 'generate');
      this.gantt.api.registerEvent('columns', 'refresh');
    };

    ColumnsManager.prototype.setScrollAnchor = function() {
      if (this.gantt.scroll.$element && this.columns.length > 0) {
        var el = this.gantt.scroll.$element[0];
        var center = el.scrollLeft + el.offsetWidth / 2;

        this.scrollAnchor = this.gantt.getDateByPosition(center);
      }
    };

    ColumnsManager.prototype.scrollToScrollAnchor = function() {
      var self = this;

      if (this.columns.length > 0 && this.scrollAnchor !== undefined) {
        // Ugly but prevents screen flickering (unlike $timeout)
        this.gantt.$scope.$$postDigest(function() {
          self.gantt.api.scroll.toDate(self.scrollAnchor);
        });
      }
    };

    ColumnsManager.prototype.clearColumns = function() {
      this.setScrollAnchor();

      this.from = undefined;
      this.to = undefined;

      this.columns = [];
      this.visibleColumns = [];
      this.previousColumns = [];
      this.nextColumns = [];

      this.headers = [];
      this.visibleHeaders = [];

      this.gantt.api.columns.raise.clear();
    };

    ColumnsManager.prototype.generateColumns = function(from, to) {
      if (!from) {
        from = this.gantt.options.value('fromDate');
      }

      if (!to) {
        to = this.gantt.options.value('toDate');
      }

      if (!from || (moment.isMoment(from) && !from.isValid())) {
        from = this.gantt.rowsManager.getDefaultFrom();
        if (!from) {
          return false;
        }
      }

      if (!to || (moment.isMoment(to) && !to.isValid())) {
        to = this.gantt.rowsManager.getDefaultTo();
        if (!to) {
          return false;
        }
      }

      if (from !== undefined && !moment.isMoment(from)) {
        from = moment(from);
      }

      if (to !== undefined && !moment.isMoment(to)) {
        to = moment(to);
      }

      if (this.gantt.options.value('taskOutOfRange') === 'expand') {
        from = this.gantt.rowsManager.getExpandedFrom(from);
        to = this.gantt.rowsManager.getExpandedTo(to);
      }

      this.setScrollAnchor();

      this.from = from;
      this.to = to;
      this.duration = this.to.diff(this.from, 'day');
      this.columns = ColumnGenerator.generate(this.columnBuilder, from, to, this.gantt.options.value('viewScale'), this.getColumnsWidth());
      this.headers = HeadersGenerator.generate(this);
      this.previousColumns = [];
      this.nextColumns = [];

      this.updateColumnsMeta();
      this.scrollToScrollAnchor();

      this.gantt.api.columns.raise.generate(this.columns, this.headers);
    };

    ColumnsManager.prototype.updateColumnsMeta = function() {
      this.gantt.isRefreshingColumns = true;

      var lastColumn = this.getLastColumn();
      this.gantt.originalWidth = lastColumn !== undefined ? lastColumn.originalSize.left + lastColumn.originalSize.width : 0;

      var columnsWidthChanged = this.updateColumnsWidths(this.columns,  this.headers, this.previousColumns, this.nextColumns);

      this.gantt.width = lastColumn !== undefined ? lastColumn.left + lastColumn.width : 0;

      var showSide = this.gantt.options.value('showSide');
      var sideShown = this.gantt.side.isShown();
      var sideVisibilityChanged = showSide !== sideShown;

      if (sideVisibilityChanged && !showSide) {
        // Prevent unnecessary v-scrollbar if side is hidden here
        this.gantt.side.show(false);
      }

      this.gantt.rowsManager.updateTasksPosAndSize();
      this.gantt.timespansManager.updateTimespansPosAndSize();

      this.updateVisibleColumns(columnsWidthChanged);

      this.gantt.rowsManager.updateVisibleObjects();

      var currentDateValue = this.gantt.options.value('currentDateValue');
      this.gantt.currentDateManager.setCurrentDate(currentDateValue);

      if (sideVisibilityChanged && showSide) {
        // Prevent unnecessary v-scrollbar if side is shown here
        this.gantt.side.show(true);
      }

      this.gantt.isRefreshingColumns = false;
      this.gantt.api.columns.raise.refresh(this.columns, this.headers);
    };

    // Returns the last Gantt column or undefined
    ColumnsManager.prototype.getLastColumn = function(extended) {
      var columns = this.columns;
      if (extended) {
        columns = this.nextColumns;
      }
      if (columns && columns.length > 0) {
        return columns[columns.length - 1];
      } else {
        return undefined;
      }
    };

    // Returns the first Gantt column or undefined
    ColumnsManager.prototype.getFirstColumn = function(extended) {
      var columns = this.columns;
      if (extended) {
        columns = this.previousColumns;
      }

      if (columns && columns.length > 0) {
        return columns[0];
      } else {
        return undefined;
      }
    };

    // Returns the column at the given or next possible date
    ColumnsManager.prototype.getColumnByDate = function(date, disableExpand) {
      if (!disableExpand) {
        this.expandExtendedColumnsForDate(date);
      }
      var extendedColumns = this.previousColumns.concat(this.columns, this.nextColumns);
      var columns = bs.get(extendedColumns, date, function(c) {
        return c.date;
      }, true);
      return columns[0] === undefined ? columns[1] : columns[0];
    };

    // Returns the column at the given position x (in em)
    ColumnsManager.prototype.getColumnByPosition = function(x, disableExpand) {
      if (!disableExpand) {
        this.expandExtendedColumnsForPosition(x);
      }
      var extendedColumns = this.previousColumns.concat(this.columns, this.nextColumns);
      var columns = bs.get(extendedColumns, x, function(c) {
        return c.left;
      }, true);
      return columns[0] === undefined ? columns[1]: columns[0];
    };

    ColumnsManager.prototype.updateColumnsWidths = function(columns,  headers, previousColumns, nextColumns) {
      var columnWidth = this.gantt.options.value('columnWidth');
      var expandToFit = this.gantt.options.value('expandToFit');
      var shrinkToFit = this.gantt.options.value('shrinkToFit');

      if (columnWidth === undefined || expandToFit || shrinkToFit) {
        var newWidth = this.gantt.getBodyAvailableWidth();

        var lastColumn = this.gantt.columnsManager.getLastColumn(false);
        if (lastColumn !== undefined) {
          var currentWidth = lastColumn.originalSize.left + lastColumn.originalSize.width;

          if (expandToFit && currentWidth < newWidth ||
            shrinkToFit && currentWidth > newWidth ||
            columnWidth === undefined
          ) {
            var widthFactor = newWidth / currentWidth;

            layout.setColumnsWidthFactor(columns, widthFactor);
            for (var i=0; i< headers.length; i++) {
              layout.setColumnsWidthFactor(headers[i], widthFactor);
            }
            // previous and next columns will be generated again on need.
            previousColumns.splice(0, this.previousColumns.length);
            nextColumns.splice(0, this.nextColumns.length);
            return true;
          }
        }
      }
      return false;
    };

    ColumnsManager.prototype.getColumnsWidth = function() {
      var columnWidth = this.gantt.options.value('columnWidth');
      if (columnWidth === undefined) {
        if (!this.gantt.width || this.gantt.width <= 0) {
          columnWidth = 20;
        } else {
          columnWidth = this.gantt.width / this.columns.length;
        }
      }
      return columnWidth;
    };

    ColumnsManager.prototype.getColumnsWidthToFit = function() {
      return this.gantt.getBodyAvailableWidth() / this.columns.length;
    };

    ColumnsManager.prototype.expandExtendedColumnsForPosition = function(x) {
      var viewScale;
      if (x < 0) {
        var firstColumn = this.getFirstColumn();
        var from = firstColumn.date;
        var firstExtendedColumn = this.getFirstColumn(true);
        if (!firstExtendedColumn || firstExtendedColumn.left > x) {
          viewScale = this.gantt.options.value('viewScale');
          this.previousColumns = ColumnGenerator.generate(this.columnBuilder, from, undefined, viewScale, this.getColumnsWidth(), -x, 0, true);
        }
        return true;
      } else if (x > this.gantt.width) {
        var lastColumn = this.getLastColumn();
        var endDate = lastColumn.getDateByPosition(lastColumn.width);
        var lastExtendedColumn = this.getLastColumn(true);
        if (!lastExtendedColumn || lastExtendedColumn.left + lastExtendedColumn.width < x) {
          viewScale = this.gantt.options.value('viewScale');
          this.nextColumns = ColumnGenerator.generate(this.columnBuilder, endDate, undefined, viewScale, this.getColumnsWidth(), x - this.gantt.width, this.gantt.width, false);
        }
        return true;
      }
      return false;
    };

    ColumnsManager.prototype.expandExtendedColumnsForDate = function(date) {
      var firstColumn = this.getFirstColumn();
      var from;
      if (firstColumn) {
        from = firstColumn.date;
      }

      var lastColumn = this.getLastColumn();
      var endDate;
      if (lastColumn) {
        endDate = lastColumn.getDateByPosition(lastColumn.width);
      }

      var viewScale;
      if (from && date < from) {
        var firstExtendedColumn = this.getFirstColumn(true);
        if (!firstExtendedColumn || firstExtendedColumn.date > date) {
          viewScale = this.gantt.options.value('viewScale');
          this.previousColumns = ColumnGenerator.generate(this.columnBuilder, from, date, viewScale, this.getColumnsWidth(), undefined, 0, true);
        }
        return true;
      } else if (endDate && date >= endDate) {
        var lastExtendedColumn = this.getLastColumn(true);
        if (!lastExtendedColumn || lastExtendedColumn.date < endDate) {
          viewScale = this.gantt.options.value('viewScale');
          this.nextColumns = ColumnGenerator.generate(this.columnBuilder, endDate, date, viewScale, this.getColumnsWidth(), undefined, this.gantt.width, false);
        }
        return true;
      }
      return false;
    };

    // Returns the number of active headers
    ColumnsManager.prototype.getActiveHeadersCount = function() {
      return this.headers.length;
    };

    ColumnsManager.prototype.updateVisibleColumns = function(includeViews) {
      this.visibleColumns = $filter('ganttColumnLimit')(this.columns, this.gantt);

      this.visibleHeaders = [];
      for (var i=0; i< this.headers.length; i++) {
        this.visibleHeaders.push($filter('ganttColumnLimit')(this.headers[i], this.gantt));
      }

      if (includeViews) {
        for (i=0; i<this.visibleColumns.length; i++) {
          this.visibleColumns[i].updateView();
        }
        for (i=0; i<this.visibleHeaders.length; i++) {
          var headerRow = this.visibleHeaders[i];
          for (var j=0; j<headerRow.length; j++) {
            headerRow[j].updateView();
          }
        }
      }

      var currentDateValue = this.gantt.options.value('currentDateValue');
      this.gantt.currentDateManager.setCurrentDate(currentDateValue);
    };

    var defaultHeadersFormats = {'year': 'YYYY', 'quarter': '[Q]Q YYYY', month: 'YYYY-MM', week: 'w', day: 'D', hour: 'H', minute:'HH:mm'};
    var defaultDayHeadersFormats = {day: 'LL', hour: 'H', minute:'HH:mm'};
    var defaultYearHeadersFormats = {'year': 'YYYY', 'quarter': '[Q]Q', month: 'MM'};

    ColumnsManager.prototype.getHeaderFormat = function(unit) {
      var format;
      var headersFormats = this.gantt.options.value('headersFormats');
      if (headersFormats !== undefined) {
        format = headersFormats[unit];
      }
      if (format === undefined) {
        var viewScale = this.gantt.options.value('viewScale');
        viewScale = viewScale.trim();
        if (viewScale.charAt(viewScale.length - 1) === 's') {
          viewScale = viewScale.substring(0, viewScale.length - 1);
        }

        var viewScaleUnit;
        var splittedViewScale;

        if (viewScale) {
          splittedViewScale = viewScale.split(' ');
        }
        if (splittedViewScale && splittedViewScale.length > 1) {
          viewScaleUnit = splittedViewScale[splittedViewScale.length - 1];
        } else {
          viewScaleUnit = viewScale;
        }

        if (['millisecond', 'second', 'minute', 'hour'].indexOf(viewScaleUnit) > -1) {
          format = defaultDayHeadersFormats[unit];
        } else if (['month', 'quarter', 'year'].indexOf(viewScaleUnit) > -1) {
          format = defaultYearHeadersFormats[unit];
        }
        if (format === undefined) {
          format = defaultHeadersFormats[unit];
        }
      }
      return format;
    };

    ColumnsManager.prototype.getDateRange = function(visibleOnly) {
      var firstColumn, lastColumn;

      if (visibleOnly) {
        if (this.visibleColumns && this.visibleColumns.length > 0) {
          firstColumn = this.visibleColumns[0];
          lastColumn = this.visibleColumns[this.visibleColumns.length - 1];
        }
      } else {
        firstColumn = this.getFirstColumn();
        lastColumn = this.getLastColumn();
      }

      return firstColumn && lastColumn ? [firstColumn.date, lastColumn.endDate]: undefined;
    };

    return ColumnsManager;
  }]);
}());
angular.module('gantt.tree.templates', []).run(['$templateCache', function($templateCache) {
  $templateCache.put('plugins/tree/sideContentTree.tmpl.html',
    '<div class="gantt-side-content-tree" ng-controller="GanttTreeController">\n' +
    '    <gantt-tree-header>\n' +
    '    </gantt-tree-header>\n' +
    '    <gantt-tree-body>\n' +
    '    </gantt-tree-body>\n' +
    '</div>\n' +
    '');
  $templateCache.put('plugins/tree/treeBody.tmpl.html',
    '<div class="gantt-tree-body" ng-style="getLabelsCss()">\n' +
    '    <div gantt-vertical-scroll-receiver>\n' +
    '        <div class="gantt-row-label-background">\n' +
    '            <div class="gantt-row-label gantt-row-height"\n' +
    '                 ng-class="row.model.classes"\n' +
    '                 ng-style="{\'height\': row.model.height}"\n' +
    '                 ng-repeat="row in gantt.rowsManager.visibleRows track by row.model.id">\n' +
    '                &nbsp;\n' +
    '            </div>\n' +
    '        </div>\n' +
    '        <div ui-tree ng-controller="GanttUiTreeController" data-drag-enabled="false" data-empty-place-holder-enabled="false">\n' +
    '            <ol class="gantt-tree-root" ui-tree-nodes ng-model="rootRows">\n' +
    '                <li ng-repeat="row in rootRows" ui-tree-node\n' +
    '                    ng-include="\'plugins/tree/treeBodyChildren.tmpl.html\'">\n' +
    '                </li>\n' +
    '            </ol>\n' +
    '        </div>\n' +
    '    </div>\n' +
    '</div>\n' +
    '');
  $templateCache.put('plugins/tree/treeBodyChildren.tmpl.html',
    '<div ng-controller="GanttTreeNodeController"\n' +
    '     class="gantt-row-label gantt-row-height"\n' +
    '     ng-class="row.model.classes"\n' +
    '     ng-style="{\'height\': row.model.height}">\n' +
    '    <div class="gantt-valign-container">\n' +
    '        <div class="gantt-valign-content">\n' +
    '            <a style="display: inline-block;width:20px;text-align: center;line-height:48px;" ng-disabled="isCollapseDisabled()" data-nodrag\n' +
    '               class="gantt-tree-handle-button btn btn-xs"\n' +
    '               ng-class="{\'gantt-tree-collapsed\': collapsed, \'gantt-tree-expanded\': !collapsed}"\n' +
    '               ng-click="!isCollapseDisabled() && toggle()"><span\n' +
    '                class="gantt-tree-handle glyphicon glyphicon-minus"\n' +
    '                ng-class="{\n' +
    '                \'glyphicon-plus\': collapsed, \'glyphicon-minus\': !collapsed,\n' +
    '                \'gantt-tree-collapsed\': collapsed, \'gantt-tree-expanded\': !collapsed}"></span>\n' +
    '            </a>\n' +
    '            <span gantt-row-label class="gantt-label-text" gantt-bind-compile-html="getRowContent()"/>\n' +
    '        </div>\n' +
    '    </div>\n' +
    '</div>\n' +
    '<ol ui-tree-nodes ng-class="{hidden: collapsed}" ng-model="childrenRows">\n' +
    '    <li ng-repeat="row in childrenRows" ui-tree-node>\n' +
    '        <div ng-include="\'plugins/tree/treeBodyChildren.tmpl.html\'"></div>\n' +
    '    </li>\n' +
    '</ol>\n' +
    '');
  $templateCache.put('plugins/tree/treeHeader.tmpl.html',
    '<div class="gantt-tree-header" ng-style="{height: $parent.ganttHeaderHeight + \'px\'}">\n' +
    '    <div ng-if="$parent.ganttHeaderHeight" class="gantt-row-label gantt-row-label-header gantt-tree-row gantt-tree-header-row"><span class="gantt-label-text" gantt-bind-compile-html="getHeaderContent()"/></div>\n' +
    '</div>\n' +
    '');
}]);

/**
 * Created by emma on 2016/11/3.
 */
(function(){
  'use strict';

  angular
    .module('app.plan')
    .filter('filterTmp',filterTmp);

  /**@ngInject*/
  function filterTmp(){
    return function (data,arg1,arg2){
      var outputs=[];
      data&&data.forEach(function(r){
        var x1=r.Name.indexOf(arg1);
        var x2=r.Name.indexOf(arg2);
        if(x1 !=-1 && x2 !=-1){
          outputs.push(r);
        }
      })
      return outputs;
    }
  }
})();

/**
 * Created by jiuyuong on 2016/10/25.
 */
(function (angular) {
  taskTable.$inject = ["api", "utils"];
  angular
    .module('app.plan')
    .directive('taskTable',taskTable);
  /** @ngInject */
  function taskTable(api,utils) {
    return {
      scope:{
        tasks:'=',
        flowId:'=',
        allTasks:'='
      },
      templateUrl:'app/main/plan/directives/taskTable.html',
      link:link
    }

    function link(scope,element,attr,ctrl) {
      scope.data = {

      }
      scope.info={
        tasks:scope.tasks,
        flowId:scope.flowId
      }
      var gs = (function () {
        var vars = [],r = /[a-z]/gi,
          compare = function (s1,s2) {
            return s1.key.localeCompare(s2.key);
          };
        return {
          getVars:function (g) {
            var vs = g.toUpperCase().match(r),
              rs = [];
            if(!vs || vs.length===0) return rs;
            vs.forEach(function (v) {
              var r = vars.find(function (n) {
                return n.key == v;
              });
              if(!r){
                r = {
                  key:v
                };
                vars.push(r);

              }
              rs.push(r);
            });
            vars.sort(compare);
            rs.sort(compare);
            return rs;
          },
          setVars:function (g) {
            var vs = g.toUpperCase().match(r),f = true;
            if(!vs ||vs.length===0){
              try {
                return eval(g);
              }catch (e){
                return g;
              }
            }
            vs.forEach(function (v) {
              var r = vars.find(function (n) {
                return n.key == v;
              });
              if(r && (r.value || r.value===0)){
                g = g.replace(new RegExp(v,'gi'),r.value);
              }
              else{
                f = false;
              }
            });

            if(f) {
              try {
                return eval(g);
              }catch (e){
                return g;
              }
            }
            else
              return g;
          }
        }
      })();
      var swapItems = function(arr, index1, index2) {
        arr[index1] = arr.splice(index2, 1, arr[index1])[0];
        return arr;
      };
      scope.upDot = function(item){
        scope.data.template.forEach(function(r){
          r.selected = false;
        })
        item.selected = true;
        var idx = scope.data.template.indexOf(item);
        if(idx!=0){
          swapItems( scope.data.template, idx, idx - 1);
        }
        var data={
          BeforeBuildingPlanFlowId: scope.data.template[idx-1].Id,
          AfterBuildingPlanFlowId: scope.data.template[idx].Id
        }
        api.plan.BuildPlan.swapOrder(scope.flowId,data).then(function(r){
          if(r.data || r.status==200){
            utils.alert('交换完成!')
          }
        })
      }
      scope.downDot = function(item){
        scope.data.template.forEach(function(r){
          r.selected = false;
        })
        item.selected = true;
        var idx = scope.data.template.indexOf(item);
        if(idx != scope.data.template.length-1){
          swapItems(scope.data.template, idx, idx + 1)
        }
        var data={
          BeforeBuildingPlanFlowId: scope.data.template[idx].Id,
          AfterBuildingPlanFlowId: scope.data.template[idx+1].Id
        }
        api.plan.BuildPlan.swapOrder(scope.flowId,data).then(function(r){
          if(r.data || r.status==200){
            utils.alert('交换完成!')
          }
        })
      }
      scope.changeFloor = function(item){
       // console.log(item,scope.data.template)
        var arr=[],index,arr1=[];
        var f=scope.data.template.find(function(r){
          return r.IsFloor == true;
        })
        if(f){
          arr.push(f);
          index = scope.data.template.indexOf(f);
          scope.data.template.splice(index,1);
        }
        arr.forEach(function(_r){
          var find = _r.Floors.find(function(t){
            return t.Id == item.Id
          })
          if(find){
            var idx = _r.Floors.indexOf(find);
            arr1.push(_r.Floors.slice(0,idx));
            arr1.push(_r.Floors.slice(idx,_r.Floors.length));
          }
        })
        arr1.forEach(function(r){
          var obj={
            Floors:r,
            getFullName:function () {
              var f = this.Floors[0],
                l = this.Floors[this.Floors.length-1];
              return f===l?f.FullName.replace(f.TaskFlowName,''):f.FullName.replace(f.TaskFlowName,'')+'~'+l.FullName.replace(f.TaskFlowName,'');
            },
            IsFloor : true,
            IsRequired:true,
            selectedTask :this.Floors[0].OptionalTasks[0],
            getOptionalTasks:function () {
              return this.Floors[0].OptionalTasks;
            }
          };
          scope.data.template.splice(index,0,obj);
          index +=1;
        })
      }
      scope.getVars = function (task) {
        if(!task) return;
        if(task.eDuration !='' && !task.eDuration)
          task.eDuration = task.Duration||'';

        task.vars = scope.vars = gs.getVars(task.eDuration);
        var r = gs.setVars(task.eDuration);
        if(!task.vars.length){
          task.minValue = task.Duration*0.8;
        }
        task.xDuration = r;
        return r;
      };
      function setTask(item) {
        var next = scope.data.template.find(function (it) {
          return it.ParentId===item.Id && it.OptionalTasks.find(function (task) {
              return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
            })!=null;
        });
        if(next){
          next.selectedTask = next.OptionalTasks.find(function (task) {
            return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
          });
          next.selectedTask.eDuration = item.selectedTask.eDuration;
          next.selectedTask.xDuration = item.selectedTask.xDuration;
          scope.resetName(next);
          setTask(next);
        }
      }
      function setDuration(item){
        var next = scope.data.template.find(function (it) {
          return it.ParentId===item.Id && it.OptionalTasks.find(function (task) {
              return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
            })!=null;
        });
        if(next) {
          next.selectedTask = next.OptionalTasks.find(function (task) {
            return task.TaskLibraryId === item.selectedTask.TaskLibraryId;
          });
          if (next.selectedTask) {
            next.selectedTask.eDuration = item.selectedTask.eDuration;//Math.round(item.selectedTask.duration*10)*0.1;
            next.selectedTask.xDuration = item.selectedTask.xDuration;
          }
          setDuration(next)
        }
      }
      scope.reloadTask = function (item,op) {
        item.selectedTask = op;
         // scope.resetName(op);
          setTask(item);
        setDuration(item);
      }
      function setMin(item){
        var result;
        if(!item.selectedTask.vars.length&&item.selectedTask.Duration){
          item.min = item.selectedTask.Duration*0.8;
          if(item.selectedTask.eDuration < item.min){
            utils.alert('输入值应大于基本工期的80%').then(function(){
              item.show = true;
              //item.selectedTask.eDuration = item.selectedTask.Duration;
              result =  false;
            })
          }else{
            item.show = false;
            result = true;
          }
        }
        return result;
      }
      scope.batchDuration = function(task){
        var f = setMin(task);
        if(f){
          setDuration(task);
        }
      }
      scope.deleteDot = function(item){
          utils.confirm('确认删除',null,'确定','取消').then(function(){
            api.plan.BuildPlan.deleteTaskLibById(scope.flowId,item.Id).then(function(r){
              //console.log(r)
              if(r.status == 200){
                utils.alert('删除成功').then(function(){
                  getData(scope.flowId);
                })
              }
            },function(err){
              console.log(err)
              utils.alert(err.data+',创建计划失败！')
            })
          })
      }
      scope.resetName = function (item) {
        item.Name = (item.FullName || item.TaskFlowName)+' - ' +
          (item.selectedTask?item.selectedTask.Name:'')
          + ' - 可选('+item.OptionalTasks.length+')';

      }
      //scope.data.template = scope.tasks;
      scope.$watch('tasks',function(){
        //console.log(scope.tasks)
        if(scope.tasks&&scope.flowId){
          getData(scope.flowId).then(function(){
            scope.$parent.$parent.vm.closePanel();
          })
        }
      })
      scope.$watch('flowId',function(){
        if(scope.tasks&&scope.flowId){
          getData(scope.flowId).then(function(){
            scope.$parent.$parent.vm.closePanel();
          })
        }
      })
      //scope.$watch('info',function(){
      //  //console.log(scope.flowId)
      //  if(scope.info.flowId&&scope.info.tasks){
      //    getData(scope.info.flowId)
      //  }
      //},true)
      function getData(id) {
        return api.plan.BuildPlan.getBuildPlanFlowTree(id).then(function (r) {
          r.data.RootTask.Master.forEach(function (task) {
            task.selectedTask = task.OptionalTasks.length == 0 ? null : task.OptionalTasks[0];
            scope.getVars(task.selectedTask);
            scope.resetName(task);
            return task;
          })
          scope.data.originData = r.data;
          scope.allTasks = scope.data.template = r.data.RootTask.Master;
          //scope.data.template =  r.data.RootTask.Master.reduce(function (container,current,index,array) {
          //  if(!current.IsFloor){
          //    container.push(current);
          //  }
          //  else{
          //    var last = container[container.length-1];
          //    if(last.IsFloor){
          //      last.Floors.push(current);
          //    }
          //    else{
          //      container.push({
          //        getFullName:function () {
          //          var f = this.Floors[0],
          //            l = this.Floors[this.Floors.length-1];
          //          return f===l?f.FullName.replace(f.TaskFlowName,''):f.FullName.replace(f.TaskFlowName,'')+'~'+l.FullName.replace(f.TaskFlowName,'');
          //        },
          //        IsFloor : true,
          //        Floors:[current],
          //        IsRequired:true,
          //        getOptionalTasks:function () {
          //          return this.Floors[0].OptionalTasks;
          //        }
          //      })
          //    }
          //  }
          //  return container;
          //},[]);

          console.log('scope.data.template', scope.data.template);
        });
      }
    }
  }
})(angular);

/**
 * Created by jiuyuong on 2016/10/9.
 */
(function (angular,undefined) {
  'use strict';

  taskCategories.$inject = ["api"];
  angular
    .module('app.plan')
    .directive('taskCategories',taskCategories);
  /** @ngInject */
  function taskCategories(api) {
    return {
      require:'ngModel',
      scope:{
        value:'=ngModel',
        data:'=?'
      },
      templateUrl:'app/main/plan/directives/taskCategories.html',
      link:link
    }

    function link(scope,element,attrs,ctrl) {
      if(!scope.data) {
        api.plan.Task.Categories.query().then(function (r) {
          scope.data = r.data;
        });
      }
    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/12/16.
 */
(function(){
  'use strict';

  sxtImages2.$inject = ["FileUploader", "utils", "tokenInjector", "$q"];
  angular
    .module('app.plan')
    .directive('sxtImages2',sxtImages2)

  /**@ngInject*/
  function sxtImages2(FileUploader,utils,tokenInjector,$q){
    return {
        restrict: 'E',
        require: "?ngModel",
        scope: {
            gid: '=ngModel',
            img:'='
        },
        controller: ["$scope", function ($scope) {
            var dataURItoBlob = function (dataURI) {
                var byteString;
                if (dataURI.split(',')[0].indexOf('base64') >= 0)
                    byteString = atob(dataURI.split(',')[1]);
                else
                    byteString = unescape(dataURI.split(',')[1]);
                var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
                var ia = new Uint8Array(byteString.length);
                for (var i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }

                return new Blob([ia], {
                    type: mimeString
                });
            };

            var resizeFile = function (file) {
                var deferred = $q.defer();
                var img = new Image();
                try {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        img.src = e.target.result;
                        $scope.img = img.src;
                        img.onload = function () {
                            var canvas = document.createElement("canvas");
                            var ctx = canvas.getContext("2d");
                            ctx.drawImage(img, 0, 0);
                            var MAX_WIDTH = 800;
                            var MAX_HEIGHT = 800;
                            var width = img.width;
                            var height = img.height;
                            if (width > height) {
                                if (width > MAX_WIDTH) {
                                    height *= MAX_WIDTH / width;
                                    width = MAX_WIDTH;
                                }
                            } else {
                                if (height > MAX_HEIGHT) {
                                    width *= MAX_HEIGHT / height;
                                    height = MAX_HEIGHT;
                                }
                            }
                            canvas.width = width;
                            canvas.height = height;
                            var ctx = canvas.getContext("2d");
                            ctx.drawImage(img, 0, 0, width, height);

                            var dataURL = canvas.toDataURL('image/jpeg');
                            var blob = dataURItoBlob(dataURL);

                            deferred.resolve(blob);
                        }
                    };
                    reader.readAsDataURL(file);
                } catch (e) {
                    deferred.resolve(e);
                }
                return deferred.promise;

            };

            var uploader = $scope.uploader = new FileUploader({
                headers: { 'Authorization': tokenInjector.getToken() },
                autoUpload: false,
                //onSuccessItem: function (item, response, status, headers) {
                //
                //    if (status == 200) {
                //        $scope.imgOK = true;
                //
                //    } else {
                //        $scope.imgFail = true;
                //    }
                //
                //    item.file.Id = response.Files[0].Id;
                //    item.file.Url = response.Files[0].Url;
                //    item.file.Remark = response.Files[0].Remark;
                //    if (angular.isArray($scope.files))
                //        $scope.files.push(response.Files[0].Url);
                //    item.remove = function () {
                //        var me = this;
                //
                //        FilesService.delete(me.file.Id).then(function (r) {
                //            var ix = uploader.queue.indexOf(me);
                //            uploader.queue.splice(ix, 1);
                //            if (angular.isArray($scope.files))
                //                $scope.files.splice(ix, 1);
                //        });
                //    }
                //    item.save = function () {
                //        var me = this;
                //        FilesService.update(me.file).then(function () {
                //            me.isEditing = false;
                //        })
                //    }
                //    if ($scope.single && uploader.queue.length > 1) {
                //        uploader.queue[0].remove();
                //    }
                //},
                onAfterAddingFile: function (item) {
                    //console.log(JSON.stringify(item))
                    if (!$scope.single && item.file.type.indexOf('image/') != -1) {
                        resizeFile(item._file).then(function (blob_data) {
                          console.log(blob_data)
                            item._file = blob_data;
                            $scope.ImageSize = blob_data.size / 1024 / 1024
                            console.log('$scope.ImageSize', $scope.ImageSize)
                           // item.upload();
                        })
                      console.log($scope)
                    }
                    else {
                       // item.upload();
                    }

                },
              onBeforeUploadItem :function(item){
                //console.log(item)
              }
            });
            //$scope.editPic = function (file) {
            //    if (!$scope.edit || utils.isApp()) return;
            //    var url;
            //    if (file.Url.indexOf('data:image/png') != -1) {
            //        url = file.Url && file.Url.substring(0, 1) == '~' ? file.Url.substring(1) : file.Url;
            //
            //    } else {
            //        url = appConfig.apiUrl + (file.Url && file.Url.substring(0, 1) == '~' ? file.Url.substring(1) : file.Url);
            //    }
            //    utils.imgEdit(url.replace('/s_', '/'), function (data) {
            //        FilesService.update({ Id: file.Id, file, Url: data }).then(function (result) {
            //            file.Url = result.data.Url;
            //            //console.log('scope', data,file.Id)
            //            // uploader.queue.push(item);
            //            utils.alert('更新成功');
            //        });
            //    });
            //}
            $scope.remove = function ($event, file) {
                $scope.imgOK = false;
                $event.preventDefault();
                //file.remove();
                $scope.img = null;
                //utils.confirm(null, '确定删除些图片吗？', function () {
                //    file.remove();
                //});
            }
        }],
        templateUrl: "app/main/plan/directives/sxt-images2.html",
        link: function (scope, element, attrs, ngModel) {
            var uploader = scope.uploader;
            var gid;
          //console.log(scope)
          scope.$watch('gid',function(){
            if (gid && gid == scope.gid) return;
            uploader.queue.length = 0;
            gid = scope.gid;

                if (gid != '') {
                  //console.log(uploader.queue)
                    //angular.forEach(uploader.queue, function (item) { item.url = uploader.url });
                }
                scope.inputChange = function () {
                    scope.imgOK = false;
                    scope.imgFail = false;
                }
          })
            //scope.$watch('gid', function () {
            //    if (gid && gid == scope.gid) return;
            //    uploader.queue.length = 0;
            //    gid = scope.gid;
            //    //if (gid != '') {
            //    //    uploader.url = appConfig.apiUrl + '/api/Files/' + gid + '?project=' + (scope.project || '');
            //    //    angular.forEach(uploader.queue, function (item) { item.url = uploader.url });
            //    //}
            //    scope.inputChange = function () {
            //        scope.imgOK = false;
            //        scope.imgFail = false;
            //    }
            //
            //    //FilesService.group(scope.gid || '').success(function (data) {
            //    //    if (gid != data.Group) {
            //    //        gid = scope.gid = data.Group;
            //    //        uploader.url = appConfig.apiUrl + '/api/Files/' + gid + '?project=' + (scope.project || '');
            //    //        angular.forEach(uploader.queue, function (item) { item.url = uploader.url });
            //    //    }
            //    //    if (data.Files) {
            //    //        if (angular.isArray(scope.files)) {
            //    //            scope.files = [];
            //    //        }
            //    //        data.Files.forEach(function (att) {
            //    //            if (angular.isArray(scope.files))
            //    //                scope.files.push(att.Url);
            //    //            var item = {
            //    //                file: {
            //    //                    Id: att.Id,
            //    //                    name: att.FileName,
            //    //                    size: att.FileSize,
            //    //                    Url: att.Url,
            //    //                    UserID: att.UserID,
            //    //                    Remark: att.Remark,
            //    //                    CreateDate: att.CreateDate,
            //    //                    PartionID: att.PartionID
            //    //                },
            //    //                remove: function () {
            //    //                    var me = this;
            //    //                    FilesService.delete(me.file.Id).then(function (r) {
            //    //                        uploader.queue.splice(uploader.queue.indexOf(me), 1);
            //    //                    });
            //    //                },
            //    //                save: function () {
            //    //                    var me = this;
            //    //                    FilesService.update(me.file).then(function () {
            //    //                        me.isEditing = false;
            //    //                    })
            //    //                },
            //    //                progress: 100,
            //    //                isServer: true,
            //    //                isSuccess: true,
            //    //                isCancel: false,
            //    //                isError: false,
            //    //                isReady: false,
            //    //                isUploading: true,
            //    //                isUploaded: true,
            //    //                index: null
            //    //            };
            //    //            scope.setParDes && scope.setParDes(att.PartionID, item);
            //    //            uploader.queue.push(item);
            //    //        });
            //    //    }
            //    //})
            //});
        }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/10/25.
 */
(function (angular,undefined) {
  planCreating.$inject = ["template", "api", "$state", "$window", "$mdDialog", "$q", "utils", "sxt"];
  angular
    .module('app.plan')
    .directive('planCreating',planCreating);
  /** @ngInject */
  function planCreating(template,api,$state,$window,$mdDialog,$q,utils,sxt) {
    return {
      scope:{
        buildId:'=',
        begin:'=',
        libraryId:'=',
        flow:'=',
        branch:'=',
        vars:'='
      },
      templateUrl:'app/main/plan/directives/plan-creating.html',
      link:link
    }

    function link(scope,element,attr,ctrl) {
      var  moment = $window.moment;
      //var buildId = scope.buildId || '000420000000006',
      //  rootTaskLibraryId = scope.libraryId || 303,
      //  begin = scope.begin ? moment(scope.begin) : moment('2016-10-1');
      scope.$watch('libraryId',function(){
        if(!!scope.libraryId&&!!scope.buildId) {
          begin = scope.begin;
          load();
        }
      })
      scope.$watch('buildId',function(){
        if(!!scope.libraryId&&!!scope.buildId) {
          begin = scope.begin;
          load();
        }
      })
      scope.$watch('begin',function () {
        begin = scope.begin ? moment(scope.begin):null;
        //scope.buildDate();
        if(!!scope.libraryId&&!!scope.buildId){
          begin = scope.begin;
          //load();
          scope.buildDate();
        }
      });
      var gs = (function () {
        var vars = [], r = /[a-z]{1,3}/gi,
          compare = function (s1, s2) {
            return s1.key.localeCompare(s2.key);
          },
          getDate = function (key, g) {
            var r = vars.find(function (n) {
              return n.key == key;
            });
            if (r && r.value) {
              var date = new moment(r.value);
              g = g.replace(key, '');
              try {
                var days = $window.eval(g);
                return date.add(days, 'days');
              } catch (ex) {
                return false;
              }
            }
            return false;
          };
        return {
          setValue: function (k, value) {
            var v = vars.find(function (v) {
              return v.key == k;
            });
            if (v)
              v.value = value;
            else {
              vars.push({
                key: k,
                value: value
              });
            }
          },
          getVars: function (g) {
            if (!g) return [];
            var vs = g.toUpperCase().match(r),
              rs = [];
            if (!vs || vs.length === 0) return rs;
            vs.forEach(function (v) {
              var r = vars.find(function (n) {
                return n.key == v;
              });
              if (!r) {
                r = {
                  key: v
                };
                vars.push(r);
              }
              if (v.length === 1 && !rs.find(function (n) {
                  return n.key == v;
                })) {
                rs.push(r);
              }
            });
            vars.sort(compare);
            rs.sort(compare);
            return rs;
          },
          setVars: function (g) {
            var vs = g.toUpperCase().match(r), f = true, isDate = false, g1 = g;
            //只有数字的计算
            if (!vs || vs.length === 0) {
              try {
                return eval(g1);
              } catch (e) {
                return g1;
              }
            }
            vs.forEach(function (v) {
              var r = vars.find(function (n) {
                return n.key == v;
              });
              if (!isDate && v.length > 1) {
                isDate = true;
              }
              if (v.length === 1 && r && (r.value || r.value === 0)) {
                g1 = g1.replace(new RegExp(v, 'gi'), r.value);
              }
              else {
                f = false;
              }
            });
            if (isDate) { //计算日期
              var b = g1.split('~');
              if (b.length === 2) {
                var s = b[0].match(r),
                  e = b[1].match(r);
                var sd = getDate(s[0], b[0]),
                  ed = getDate(e[0], b[1]);
                if (sd && ed) {
                  return {
                    s: sd,
                    days: moment.duration(ed.diff(sd)).asDays(),
                    e: ed
                  };
                }
              }
              return g;
            }
            else {
              //仅计算天数,没有日期
              if (f) {
                try {
                  return eval(g1);
                } catch (e) {
                  return g1;
                }
              }
              else
                return g;
            }
          },
          allVars:function () {
            return vars;
          }
        }
      })();
      scope.vars = gs;
      function load() {
        $q.all([
          api.plan.TaskLibrary.getTaskFlow(scope.libraryId),
          api.plan.Project.query(scope.buildId),
          api.plan.MileStone.queryByTaskId(scope.libraryId)
        ]).then(function (rs) {
          var rootTask = rs[0].data,
            floors = rs[1].data,
            mileStone = rs[2].data;
          var flows = [], banchs = [];
          rootTask.Master.forEach(function (t) {
            if (t.IsFloor) {
              floors.forEach(function (f) {
                var t1 = angular.copy(t), tid = t1.TaskFlowId;
                t1.IsFloor = true;
                t1.IsRequired = t.IsRequired;
                t1.TaskFlowId = f.FloorId + '-' + tid;
                t1.FloorId = f.FloorId;
                t1._TaskFlowId = tid;
                t1.FloorName = f.FloorName;
                t1.Name = f.FloorName;
                flows.push(t1);
                if (f.IsPresalesMilestone) {
                  flows.push({
                    selected: true,
                    FloorId: f.FloorId,
                    TaskFlowId: f.FloorId + '-' + tid + '-0',
                    Id: 0,
                    RelatedFlowId: tid,
                    type: 'm',
                    Name: '达到预售楼层'
                  });
                }
              })
            }
            else {
              flows.push(t);
            }
            var m = mileStone.Items.find(function (m1) {
              return m1.RelatedFlowId == t.TaskFlowId;
            });
            if (m) {
              flows.push({
                selected: true,
                TaskFlowId: m.Id + '-' + m.RelatedFlowId,
                Id: m.Id,
                RelatedFlowId: m.RelatedFlowId,
                type: 'm',
                Name: m.Name
              });
            }
          });
          flows.forEach(function (f) {
            if (f.OptionalTasks) {
              if (f.IsFloor) {
                if(f.Name.indexOf('负') != -1){
                  //scope.underhidden=false;
                }else{
                  scope.underhidden=true;
                }
                if (f.Name.indexOf('负') != -1) {
                  f.currentTask = f.OptionalTasks.find(function (t) {
                    return t.Name.indexOf('负') != -1 || t.Name.indexOf('地') != -1
                  });
                }
                else if (f.Name.indexOf('裙') != -1) {
                  f.currentTask = f.OptionalTasks.find(function (t) {
                    return t.Name.indexOf('裙') != -1;
                  });
                }
                else if (f.Name.indexOf('转') != -1) {
                  f.currentTask = f.OptionalTasks.find(function (t) {
                    return t.Name.indexOf('转') != -1;
                  });
                }
                else {
                  f.currentTask = f.OptionalTasks.filter(function (t) {
                    return t.Name.indexOf('负') == -1 &&
                      t.Name.indexOf('裙') == -1 &&
                      t.Name.indexOf('转') == -1;
                  })[0];
                }
              }
              if (!f.currentTask) {
                f.currentTask = f.OptionalTasks[0];
                //f.currentTask.eDuration = f.currentTask.Duration;
              }else{
                //f.currentTask.eDuration = f.currentTask.Duration;
              }
              f.selected = true;
            }
          });
          rootTask.Branch.forEach(function (bs) {
            //if(scope.underhidden){
            //  if(bs[0].Name.indexOf('地下室')!=-1||bs[0].Name.indexOf('人货梯')!=-1){
            //    return;
            //  }
            //}
            bs.forEach(function (b) {
              if (!b.currentTask) {
                b.currentTask = b.OptionalTasks[0];
              }
              banchs.push(b);
            });
          });
          gs.getVars('N');
          gs.setValue('N', floors.filter(function (f) {
            // 1	标准层
            // 2	地下室
            // 4	裙楼
            // 8	转换层
            return f.FloorTypeStatus != '2';
          }).length);
          scope.flow = scope.flows = flows;
          scope.branch = scope.banchs = banchs;
          scope.buildDate();
        });
      }

      function setTask(item) {
        var index = scope.flows.indexOf(item);
        var floorArr = scope.flows.filter(function (r) {
          return r.IsFloor;
        })
        var r = floorArr.indexOf(item);
        if (r != -1) {
          for (var i = index; i < floorArr.length + index - r + 1; i++) {
            var f = scope.flows[i].OptionalTasks && scope.flows[i].OptionalTasks.find(function (task) {
                return task.TaskLibraryId === item.currentTask.TaskLibraryId;
              });
            if (f) {
              scope.flows[i].currentTask = f;
              gs.setValue(scope.flows[i].Expression + 'B', undefined);
              gs.setValue(scope.flows[i].Expression + 'D', undefined);
             // scope.flows[i].currentTask.eDuration = f.Duration;
            }
          }
        }
      }
      scope.setCurrent = function (flow, task) {
        flow.currentTask = task;
        //flow.currentTask.eDuration = flow.currentTask.Duration;
        setTask(flow);
        scope.buildDate(flow);
      };
      scope.buildBranch = function () {
        scope.banchs.forEach(function (flow) {
          var d = gs.setVars(flow.Expression);
          if (d) {
            flow.start = d.s;
            flow.days = d.days;
            flow.end = d.e;
            flow.selected = !!(d.s && d.e);
          }
          else{
            flow.selected = false;
          }
        });
      };
      scope.buildDate = function (item) {
        if (!scope.flows) return;
        //if(item&&item.currentTask&&item.currentTask.eDuration < item.currentTask.Duration*0.8){
        //  item&&(item.show = true);
        //  return;
        //}else{
        //  item&&(item.show = false);
        //};
        scope.flows.reduce(function (prev, current) {
          if(current.show) return current;
          if (!current.selected) return prev;
          if (current.type) {
            current.end = prev.end;
            return prev;
          }
          if (prev && !prev.end) { //前置条件不足
            current.days = current.start = current.end = undefined;
          }
          else {
            var start = prev ? moment(prev.end) : moment(begin),
              end;
            if (!start) {
              current.days = current.start = current.end = undefined;
            }
            else {
              try {
                //var days = gs.setVars(current.currentTask.eDuration);
                //if (days === current.currentTask.eDuration)
                var days = gs.setVars(current.currentTask.Duration);
                if (days === current.currentTask.Duration)
                  days = undefined;
                current.days = days;
              } catch (ex) {
              }
              if (current.days) {
                end = moment(start).add(current.days, 'days');
              }
              else {
                end = undefined;
              }
              current.start = start;
              current.end = end;
            }
          }
          if (prev && prev.IsFloor) {
            var pTask = prev.currentTask,
              cTask = current.currentTask;
            if (current.IsFloor) {
              if (pTask.Name.indexOf('地') != -1 && cTask.Name.indexOf('地') == -1) {
                gs.setValue(prev.Expression + 'D', prev.end);
              }
              if (
                (pTask.Name.indexOf('地') != -1 ||
                pTask.Name.indexOf('裙') != -1 ||
                pTask.Name.indexOf('转') != -1) &&
                (cTask.Name.indexOf('地') == -1 &&
                cTask.Name.indexOf('裙') == -1 &&
                cTask.Name.indexOf('转') == -1)
              ) {
                gs.setValue(prev.Expression + 'B', current.start);
              }
            }
            else {
              gs.setValue(prev.Expression + 'S', prev.start);
              gs.setValue(prev.Expression + 'F', prev.end);
            }
          }
          if (current.Expression) {
            if (!current.IsFloor) {
              gs.setValue(current.Expression + 'S', current.start);
              gs.setValue(current.Expression + 'F', current.end);
            }
            //console.log('current.currentTask', current.currentTask);
          }
          return current;
        }, null);
        scope.buildBranch();
      };
      scope.down = function (flow) {
        var index = scope.flows.indexOf(flow);
        if (index >= 0) {
          var next = scope.flows[index + 1];
          if (next&&!next.IsFloor) {
            scope.flows[index] = next;
            scope.flows[index + 1] = flow;
          }else if(next&&next.IsFloor){
            utils.alert('不可与楼层交换')
          }
        }
        scope.buildDate();
      }
      scope.up = function (flow) {
        var index = scope.flows.indexOf(flow);
        var next = scope.flows[index - 1];
        if (next&&!next.IsFloor) {
          scope.flows[index] = next;
          scope.flows[index - 1] = flow;
        }else if(next&&next.IsFloor){
          utils.alert('不可与楼层交换')
        }
        scope.buildDate();
      }
      scope.setVars = function (flow) {
        var dur = flow.Type !=0 ? flow.Expression : flow.currentTask.Duration;
        var vars = gs.getVars(dur);
        if (vars.length == 0) return;
        return $mdDialog.show({
          controller: ['$mdDialog', '$scope', function ($mdDialog) {
            var vm = this;
            vm.vars = vars;
            vm.dur = dur;
            vm.select = function () {
              $mdDialog.hide(vm.dur);
            }
          }],
          controllerAs: 'vm',
          templateUrl: 'app/main/plan/component/plan-create-vars.html',
          parent: angular.element(document.body),
          clickOutsideToClose: true
        }).then(function (dur) {
          if (flow.currentTask)
            flow.currentTask.Duration = dur;
          else
            flow.Expression = dur;
          scope.buildDate();
        });
      }

    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/10/11.
 */
(function(){
  'use strict';

  bodyBackground.$inject = ["$mdSidenav", "utils"];
  angular
    .module('app.plan')
    .directive('bodyBackground',bodyBackground);

  /**@ngInject*/
  function bodyBackground($mdSidenav,utils){
    return {
      scope:{
        value:'=bodyShow',
        data:'=bodyData',
        bodyMin:'='
      },
      link:link
    }

    function link(scope,element,ctrl,attr){
      scope.$watch('value',function(){
        if(scope.value){
          $('.body-background').css('display','block');
          $(element).addClass('on')
        }else{
          $('.body-background').css('display','none');
          $(element).removeClass('on');
        }
      })

      $(element).on('click',function(){
        if(scope.bodyMin){
          utils.alert('工期应大于基本工期的80%');
          return;
        }
        if(scope.$parent.vm.current.selectedTask&&
          (
            !scope.$parent.vm.current.selectedTask.xDuration ||
            isNaN(parseInt(scope.$parent.vm.current.selectedTask.xDuration))
          )){
          utils.alert('工期计划结果不合法')
          return;
        }else{
          scope.value = false;
          $('.body-background').css('display','none');
          $(element).removeClass('on');
          $mdSidenav('right')
            .close();
        }
      })

      scope.$on('$destroy',function(){
        scope.value = false;
        $('.body-background').css('display','none');
        $(element).removeClass('on');
        $mdSidenav('right')
          .close();
      })
    }
  }
})();

/**
 * Created by emma on 2016/9/30.
 */
(function(){
  'use strict';

  scrollTop.$inject = ["$timeout"];
  angular
    .module('app.plan')
    .directive('scrollTop',scrollTop);

  /**@ngInject*/
  function scrollTop($timeout){
    return {
      scope:{
        scrollTop:'='
      },
      link:link
    }

    function link(scope,element,attr,ctrl){
      scope.$watch('scrollTop',function(){
        $timeout(function(){
          $('#content').animate({scrollTop: '0'});
        },500)

      })
    }
  }
})();

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTemplates.$inject = ["$scope", "api", "$state", "utils"];
  angular
    .module('app.plan')
    .component('planTemplates',{
      templateUrl:'app/main/plan/component/plan-templates.html',
      controller:planTemplates,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planTemplates($scope,api,$state,utils){
    var vm = this;
    vm.total=0;
    $scope.pageing={
      page:1,
      pageSize:10
    }

    vm.pageAction = function(title, page, pageSize, total){
      $scope.pageing.page = page;
    }

    $scope.$watch("pageing",function(){
      Load();
    },true);

    vm.Query = function (item) {
      console.log(item)
      $state.go("app.plan.template.detail",{id:item.Id,taskLibraryId:item.RootTaskLibraryId});

    }

    vm.Delete = function(item){
      utils.confirm('是否确认删除模板？').then(function (r) {
        api.plan.TaskTemplates.delete(item.Id).then(function (r) {
          Load();
        });
      });

    }
    vm.copyTemp = function(item){
      console.log(item)
      utils.confirm('复制模板？').then(function(){
        api.plan.TaskTemplates.copyTemplate(item.Id).then(function(r){
          utils.alert('复制成功').then(function(){
            Load();
          })
        },function(err){
          utils.alert(err.data||'复制失败');
        })
      })
    }
    function Load() {
      var page=utils.getPage($scope.pageing);

      api.plan.TaskTemplates.GetList({Skip:page.Skip,Limit:page.Limit}).then(function (r) {
        vm.items=r.data.Items||[];
        vm.total = r.data.TotalCount;
      });

    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTemplate.$inject = ["$scope", "template", "$mdSidenav", "$stateParams", "api", "$state", "$mdDialog", "$mdSelect", "$q", "utils", "$timeout"];
  angular
    .module('app.plan')
    .component('planTemplate',{
      templateUrl:'app/main/plan/component/plan-template-new.html',
      controller:planTemplate,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planTemplate($scope,template,$mdSidenav,$stateParams,api,$state,$mdDialog,$mdSelect,$q,utils,$timeout){
    var vm = this;
    var temp,task
    var id = $stateParams.id,taskLibraryId = $stateParams.taskLibraryId;
    vm.isNew = $stateParams.id=='add';
    if(id!='add'){
      api.plan.TaskTemplates.getItem(id).then(function (r) {
        vm.dataTemp = r.data;
        $timeout(function(){
          vm.dataTemp = r.data;
        },1000)
        console.log(vm.dataTemp)
      })
    }

    api.plan.TaskLibrary.GetList({Level:0,TemplateId:id}).then(function (r) {
      vm.tasks = r.data.Items||[];
    });
    vm.AreaList = [];

    api.plan.SysDataDictionary.Get('SXT.EMBD.Base.Region').then(function (r) {

      r.data.Items.forEach(function(f){
        vm.AreaList.push({Value:f.DDicMember,Text:f.DDicMemberName})
      });

    })
    vm.ClickSave = function(data){
      if(id=='add'){
        api.plan.TaskTemplates.Create(data).then(function (r) {
          if(r.data || r.status == 200){
            utils.alert('保存成功').then(function(){
              $state.go('app.plan.template.list');
            })
          }
        });
        //console.log( data,"保存")
      }else{
        api.plan.TaskTemplates.update(data).then(function (r) {
          if(r.status == 200){
            utils.alert('保存成功').then(function(){
              $state.go('app.plan.template.list');
            })
          }
        });
      }
    };
    if(!vm.isNew){
      vm.loading= true;
      loadData();
      api.plan.TaskLibrary.getTaskFlow($stateParams.taskLibraryId).then(function (r) {
        task = vm.data = r.data;
        vm.data._CloseRelatedObjectType = vm.data.CloseRelatedObjectType;
        vm.data.CloseRelatedObjectType&&vm.data.CloseRelatedObjectType==0?vm.data.CloseRelatedObjectType ='PQMeasure':vm.data.CloseRelatedObjectType='Inspection';
        task.oType = task.Type;
        vm.data._DurationType = vm.data.DurationType;
        vm.data.DurationType == 0?vm.data.DurationType ='FixedDuration':vm.data.DurationType= 'VariableDuration';
        vm.loading= false;
        task.Master.forEach(function (flow) {
          if(flow.Description)
            angular.extend(flow,angular.fromJson(flow.Description));
          //单项任务名改变时取值
          if(flow.OptionalTask){
            if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
              flow.OptionalTask =  flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
            }else{
              if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
              }
            }
          }
          flow.oMilestone=flow.Milestone;
          flow.oName=flow.Name;
          flow.oReservedEndDays = flow.ReservedEndDays;
          flow.oDuration = flow.Duration;
          flow.oNotice7 = flow.Notice7;
          flow.oNotice8 = flow.Notice8;
          flow.oMeasureInfo = flow.MeasureInfo;
          flow.oExpression = flow.Expression;
        });
        task.Branch.forEach(function (b) {
          b.forEach(function (flow) {
            if(flow.Description)
              angular.extend(flow,angular.fromJson(flow.Description));
            if(flow.OptionalTask){
              if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
                flow.OptionalTask = flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
              }else{
                if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                  flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
                }
              }
            }
            flow.oMilestone=flow.Milestone;
            flow.oName=flow.Name;
            flow.oReservedEndDays = flow.ReservedEndDays;
            flow.oDuration = flow.Duration;
            flow.oNotice7 = flow.Notice7;
            flow.oNotice8 = flow.Notice8;
            flow.oMeasureInfo = flow.MeasureInfo;
            flow.oExpression = flow.Expression;
          })
        });
        vm.onLoadTemplate();
      })
    }
    else{
      task = vm.data = {
        Level:0
      }
    }
    vm.setEndFlow = function (flow,endFlow) {
      flow.EndFlagTaskFlowId = endFlow? endFlow.TaskFlowId:0;
      vm.updateFlow(flow).then(function () {
        vm.flows = temp.load(temp.task);
      });
    }
    vm.relationTypes = [{
      name:'关联实测项',
      type:'PQMeasure'
    },{
      name:'关联工序',
      type:'Inspection'
    }]
    vm.addNext = function (ev,flow,isBranch) {
      var confirm = $mdDialog.prompt()
        .title('添加'+(isBranch?'下一分支':'下一流程'))
        .placeholder((isBranch?'分支名称':'流程名称'))
        .ariaLabel((isBranch?'分支名称':'流程名称'))
        .targetEvent(ev)
        .ok('确定')
        .cancel('取消');

      return $mdDialog.show(confirm).then(function(result) {
        var next = {
          TaskLibraryId: taskLibraryId,
          IsFloor: false,
          Type: isBranch ? temp.task.Branch.length+1 : flow ? flow.line : 0,
          ParentId: flow ? flow.TaskFlowId : 0,
          Name: result,
          TemplateId:id
        };
        return api.plan.TaskFlow.post(
          next
        ).then(function (r) {
          next.TaskFlowId = r.data.TaskFlowId;
          if(vm.data.Level==1){
            return api.plan.TaskLibrary.create({
              Level:vm.data.Level+1,
              Name:result
            }).then(function (r1) {
              return api.plan.TaskFlow.resetTaskFlow(next.TaskFlowId,[{
                TaskFlowId:next.TaskFlowId,
                TaskLibraryId:r1.data.TaskLibraryId
              }]);
            });
          }
        }).then(function () {
          vm.flows = temp.add(next,flow,isBranch);
        });
      });
    }
    vm.removeFlow = function (ev,flow) {
      return utils.confirm('确认删除'+flow.Name+'？',null).then(function(){
        return $q(function (resolve) {
          if (vm.data.Level === 1) {
            return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
              if(r.data.Items.length){
                var q=[];
                r.data.Items.forEach(function (t) {
                  q.push(api.plan.TaskLibrary.delete(t.TaskLibraryId));
                });
                $q.all(q).then(function () {
                  resolve();
                })
              }
              else{
                resolve();
              }
            });
          }
          else {
            resolve();
          }
        }).then(function () {
          return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId,[]).then(function (r) {
            return api.plan.TaskFlow.deleteFlow(flow.TaskFlowId).then(function () {
              vm.flows = temp.remove(flow);
            })
          });
        });
      });
    }
    vm.updateFlowName = function (flow) {
      if(flow.oName != flow.Name){
        flow.oName = flow.Name;
        return vm.updateFlow(flow);
      }
    }
    vm.updateExpression = function (flow) {
      if(flow.oExpression != flow.Expression){
        flow.oExpression = flow.Expression;
        return vm.updateFlow(flow);
      }
    }
    vm.updateMilestone = function (flow) {
      if(flow.oMilestone != flow.Milestone){
        flow.oMilestone = flow.Milestone;
        return api.plan.MileStone.query({RelatedFlowId:flow.TaskFlowId}).then(function(r){
          var m = r.data && r.data.Items[0];
          if(!flow.Milestone){
            if(m) {
              return api.plan.MileStone.delete(m.Id);
            }
          }
          else{
            if(m) {
              m.Name = flow.Milestone;
              //m.TemplateId = id;
              return api.plan.MileStone.update(m.Id, m)
            }
            else{
              return api.plan.MileStone.create({
                Name:flow.Milestone,
                RelatedFlowId:flow.TaskFlowId,
                Percentage:100,
                TemplateId:id
              });
            }
          }
        }).then(function () {
          return vm.updateFlow(flow);
        })
      }
    }
    vm.updateFlow = function (flow) {
      return api.plan.TaskFlow.updateTaskById({
        Id:flow.TaskFlowId,
        Name:flow.Name,
        IsFloor:flow.IsFloor,
        IsRequired:flow.IsRequired,
        EndFlagTaskFlowId:flow.EndFlagTaskFlowId,
        Expression:flow.Expression,
        IsMustComplete:flow.IsMustComplete,
        Description:angular.toJson({
          ReservedEndDays:flow.ReservedEndDays,
          Duration: flow.Duration,
          Milestone:flow.Milestone,
          OptionalTask:flow.OptionalTask,
          Notices:flow.Notices,
          CarryOut:flow.CarryOut,
          Notice7: flow.Notice7,
          Notice8: flow.Notice8,
          MeasureInfo:flow.MeasureInfo
        })
      }).then(function () {

      })
    }
    vm.updateMust = function(flow){
      return vm.updateFlow(flow);
    }
    vm.updateDuration = function (flow) {
      if(flow.oDuration != flow.Duration){
        flow.oDuration = flow.Duration;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.Duration = flow.Duration;
          return api.plan.TaskLibrary.update(taskLib).then(function () {
            return vm.updateFlow(flow);
          })
        });
      }
    }
    vm.updateReservedEndDays = function (flow) {
      if(flow.oReservedEndDays != flow.ReservedEndDays){
        flow.oReservedEndDays = flow.ReservedEndDays;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.ReservedEndDays = flow.ReservedEndDays;
          return api.plan.TaskFlow.updateTaskById(taskLib).then(function () {
            return vm.updateFlow(flow);
          })
        });
      }
    }
    vm.onLoadTemplate = function () {
      if(!task) {
        task = {
          taskId: 0,
          Name: vm.data&&vm.data.name||'楼栋模板',
          Master: [],
          Branch: []
        }
      }
      if(temp)return;
      temp = new template({
        onClick:function (e) {
          vm.current = e.data;
        }
      });
      vm.flows = temp.load(task);
      //setVerify(vm.flows)
    }
    function setVerify(items){
      items.forEach(function(r){
        if(r.Name.indexOf('验') !=-1){
          r.choose = true;
        }
      })
    }
    vm.setBack = function(flow){
      var f = vm.flows.indexOf(flow);
      if(f!=-1){
        vm.flows.forEach(function(r,index){
          if(index>f){
            r.showBack = true;
          }else{
            r.showBack = false;
          }
        })
      }
    }
    vm.selectOptionalTask =function (flow) {
      return $mdDialog.show({
        controller: ['$mdDialog','$scope', function ($mdDialog) {
          var vm = this;
          vm.flow = flow;
          vm.data = {};
          vm.selectedCategory = flow.Name;
          vm.categories = [{
            name:flow.Name
          }];
          var promises = [
            api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1,TemplateId:id}),
            api.plan.TaskFlow.getSubTasks(flow.TaskFlowId)
          ];
          $q.all(promises).then(function(res){
            vm.items = res[0].data.Items;
            vm.items.forEach(function(r){
              var f = res[1].data.Items&&res[1].data.Items.find(function(_r){
                  return _r.TaskLibraryId == r.TaskLibraryId;
                });
              if(r.Type)
                r.Type = '其它';
              var tags = r.Type&&r.Type.split('>');
              tags&&tags.reduce(function (prev,current) {
                var fd = prev.find(function (t) {
                  return t.name == current;
                });
                if(!fd){
                  fd = {
                    name:current,
                    children:[]
                  }
                  prev.push(fd);
                }
                return fd.children;
              },vm.categories);
              if(f){
                r.Type = flow.Name;
                r.selected = true;
              }
            })
          })
          vm.add = function(cmd){
            vm.current = cmd;
            vm.data = {};
          }
          vm.select = function () {
            $mdDialog.hide(vm.items.filter(function (t) {
              return t.selected;
            }));
          }
          vm.submit = function () {
            vm.data.Type = vm.data.Type || flow.Name;
            vm.data.Level = task.Level+1;
            vm.data.TemplateId=id;
            api.plan.TaskLibrary.create(vm.data).then(function(r){
              if(r.status == 200 || r.data){
                vm.current = 'default';
                api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1,TemplateId:id}).then(function(r1){

                  if(vm.items){
                    r1.data.Items.forEach(function (item) {
                      item.selected = !!vm.items.find(function (it) {
                        return it.TaskLibraryId == item.TaskLibraryId && it.selected;
                      })
                    });
                  }
                  var newItem = r1.data.Items.find(function (it) {
                    return it.TaskLibraryId == r.data.TaskLibraryId;
                  });
                  if(newItem)
                    newItem.selected = true;

                  vm.items = r1.data.Items;
                })
              }
            })
          }
        }],
        controllerAs: 'vm',
        templateUrl: 'app/main/plan/component/plan-task-subs.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function (tasks) {
        var ts = [];
        tasks.forEach(function (t) {
          ts.push({
            TaskFlowId: flow.TaskFlowId,
            TaskLibraryId: t.TaskLibraryId
          });
        })
        return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId, ts).then(function (r) {
          flow.OptionalTask = tasks.length ?
            (tasks.length > 1 ? tasks.length + '任务' : tasks[0].Name) : undefined;
          return vm.updateFlow(flow);
        })
      });
    }
    vm.selectUsers = function(item,type){
      return $mdDialog.show({
        templateUrl:'app/main/plan/component/plan-task-roles.html',
        controller:['$scope',function($scope){
          var vm = this;
          vm.type = type;
          vm.add = function(){
            api.plan.UserGroup.create({
              "GroupName": vm.dataName,
              "SystemID": "plan",
              "Description": vm.dataName,
              "TemplateId":id
            }).then(function(res){
              vm.current = 'default';
              api.plan.UserGroup.query().then(function(r){
                if(vm.nextUserGroups){
                  r.data.Items.forEach(function (item) {
                    item.selected = !!vm.nextUserGroups.find(function (it) {
                      return it.GroupID == item.GroupID && it.selected;
                    })
                  });
                }
                vm.nextUserGroups = r.data.Items;
              });
            })
          }
          vm.select = function () {
            $mdDialog.hide(vm.nextUserGroups.filter(function (t) {
              return t.selected;
            }));
          }
          $q.all([
            api.plan.UserGroup.query(),
            api.plan.TaskFlow.getRoleByFlowId(item.TaskFlowId)
          ]).then(function(res){
            vm.nextUserGroups = res[0].data.Items;
            var users = res[1].data.Items;
            if(!users.length) return;
            users&&users.forEach(function(r){
              var f = vm.nextUserGroups&&vm.nextUserGroups.find(function(_r){
                  return _r.GroupID == r.RoleId;
                })
              if(f&& r.NotificationType == vm.type){
                f.selected = true;
              }
            })
          })
        }],
        controllerAs: 'vm',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function(back){
        var users ={
          roleIds:[]
        };
        var datas = back;
        datas&&datas.forEach(function(r){
          users.roleIds.push(r.GroupID)
        })
        api.plan.TaskFlow.resetTaskFlowRolesByType(item.TaskFlowId,type,users.roleIds).then(function(r){
          item['Notice'+type] = back.length ?
            (back.length > 1 ? back.length + '角色' : back[0].GroupName) : undefined;
          return vm.updateFlow(item);
        })
      })
    }
    //获取所有角色
    //api.plan.UserGroup.query().then(function(r){
    //  vm.nextUserGroup = r.data.Items;
    //})
    vm.stop = function(ev){
      ev.stopPropagation();
    }
    vm.saveUserGroup = function (flow,type) {
      var users ={
        roleIds:[]
      };
      var datas = flow['saveNotice'+type];
      datas&&datas.forEach(function(r){
        users.roleIds.push(r)
      })
      api.plan.TaskFlow.resetTaskFlowRolesByType(flow.TaskFlowId,type,users.roleIds).then(function(r){
        flow['saveNotice'+type] = datas;
        return vm.updateFlow(flow);
      })
    }

    function loadData(){
      api.plan.procedure.query().then(function(r){
        vm.procedures = r.data;
      })
      api.plan.MeasureInfo.query().then(function(r){
        vm.measureInfo = r.data;
      })
      api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:1}).then(function (r) {
        vm.subTasks = r.data.Items||[];
      });
    }
    vm.setMeasureInfo = function(flow){
      return $mdDialog.show({
        controller:['$scope','pdata','mdata','data','subtasks',function($scope,pdata,mdata,data,subtasks){
          var vm = this;
          vm.data = data;
          vm.current = null;
          vm.gxName = '';
          vm.proceduresData = pdata;
          vm.measureData = mdata;
          vm.subTasks = subtasks;
          vm.stop = function(ev){
            ev.stopPropagation();
          }
          vm.choose = function(item){
            vm.current = item;
            vm.data.CloseRelatedObjectId = item.AcceptanceItemID;
            vm.gxName = item.AcceptanceItemName;
            flow.MeasureInfo = item.AcceptanceItemName;
          }
          vm.select = function(index){
            switch (index){
              case 0:
                vm.data.CloseRelatedObjectType = null;
                vm.data.CloseRelatedObjectId =  null;
                vm.data.RelatedTaskId  = vm.relatedTask.TaskLibraryId;
                flow.MeasureInfo = vm.relatedTask.Name;
                break;
              case 1:
                vm.data.CloseRelatedObjectType = 'PQMeasure';
                vm.data.CloseRelatedObjectId = vm.CloseRelatedObjectId.AcceptanceItemID;
                flow.MeasureInfo = vm.CloseRelatedObjectId.MeasureItemName;
                break;
              case 2:
                vm.data.CloseRelatedObjectType = 'Inspection';
                break;
            }
            $mdDialog.hide(vm.data);
          }
        }],
        controllerAs:'vm',
        templateUrl:'app/main/plan/component/plan-task-measureinfo.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        locals:{
          pdata:vm.procedures && vm.procedures,
          mdata:vm.measureInfo && vm.measureInfo,
          data:vm.data && vm.data,
          subtasks:vm.subTasks&&vm.subTasks
        }
      }).then(function(data){
        api.plan.TaskLibrary.update(data).then(function (r) {
          return vm.updateFlow(flow);
        });
      })
    }
    vm.ClickSaveleft = function(data){
      data.Type = data.Type || data.oType;
      if(id=='add'){
        api.plan.TaskLibrary.create(data).then(function (r) {
          $state.go('app.plan.task.list');
        });
      }else{
        api.plan.TaskLibrary.update(data).then(function (r) {
          //$state.go('app.plan.task.list');
          if(r.status == 200){
            utils.alert('保存成功！');
          }
        });
      }

    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTask.$inject = ["$scope", "api", "$state", "utils", "$interval", "$mdDialog"];
  angular
    .module('app.plan')
    .component('planTasks',{
      templateUrl:'app/main/plan/component/plan-tasks.html',
      controller:planTask,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planTask($scope,api,$state,utils,$interval,$mdDialog){
    var vm = this;
    vm.selectedFilter = 1;
//      vm.currentSelect={
//          selectedFilter:1,
//          selectedMoban:''
//      }
//    $scope.$watch("vm.selectedFilter",function(){
//      Load();
//    });
    $scope.$watch("vm.selectedMoban",function(){
        if(vm.selectedMoban){
            vm.loading = false;
            Load();
        }

    },true);
    vm.Query = function (item) {
      if(vm.selectedFilter == 0 ){
        $state.go("app.plan.task.detailLevel",{id:item.TaskLibraryId});
      }else{
        $state.go("app.plan.task.detail",{id:item.TaskLibraryId,templateId:vm.selectedMoban});
      }
    }
    vm.copyTaskLib = function(item){
      //console.log(item)
      utils.confirm('复制模板？').then(function(){
        api.plan.TaskLibrary.copyTaskLibrary(item.TaskLibraryId).then(function(r){
          utils.alert('复制成功').then(function(){
            Load();
          })
        },function(err){
          utils.alert(err.data||'复制失败');
        })
      })
    }
    vm.Delete = function(item){
      //$mdDialog.show(
      //  $mdDialog.prompt()
      //    .title('输入')
      //    .textContent('shu')
      //    .placeholder('a')
      //    .ok('ok')
      //    //.parent(angular.element('#content'))
      //).then(function(r){
      //  alert(r)
      //})
      utils.confirm('是否确认删除任务？').then(function (r) {
        api.plan.TaskLibrary.delete(item.TaskLibraryId).then(function (r) {
          Load();
        });
      });
    }
    api.plan.TaskTemplates.GetList({Skip:0,Limit:0}).then(function (r) {
      vm.tempDatas=r.data.Items||[];
      vm.selectedMoban = vm.tempDatas[0].Id;
    });
      vm.loading = false;
     // Load()
    function Load() {
       api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:1,TemplateId:vm.selectedMoban}).then(function (r) {
         vm.items = r.data.Items||[];
           vm.loading =true;
           console.log('vm.loading',vm.loading)
       });

    }

  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTask.$inject = ["$scope", "template", "$mdSidenav", "$stateParams", "api", "$state", "$mdDialog", "$mdSelect", "$q", "utils", "$timeout"];
  angular
    .module('app.plan')
    .component('planTask',{
      templateUrl:'app/main/plan/component/plan-task.html',
      controller:planTask,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planTask($scope,template,$mdSidenav,$stateParams,api,$state,$mdDialog,$mdSelect,$q,utils,$timeout){
    var vm = this,
      temp,task,
      id = $state.params["id"];

/*    if(id!='add'){
      api.plan.TaskLibrary.getItem(id).then(function (r) {
        vm.data = r.data;
      })
    }*/
    //保存任务左边的基础信息
    vm.ClickSaveleft = function(data){
      if(id=='add'){
        api.plan.TaskLibrary.create(data).then(function (r) {
          $state.go('app.plan.task.list');
        });

      }else{
        api.plan.TaskLibrary.update(data).then(function (r) {
          //$state.go('app.plan.task.list');
          if(r.status == 200){
            utils.alert('保存成功！');
          }
        });
      }

    }
    //工序
    api.plan.procedure.query().then(function(r){
      vm.procedures = r.data;
    })
    api.plan.MeasureInfo.query().then(function(r){
      vm.measureInfo = r.data
    })
    vm.selectSpecialtyLow=function(item,parent){
      parent.WPAcceptanceList=item.WPAcceptanceList;
    }

    vm.selectedGx = [];
    vm.choosego = function(item){
      vm.gxNames = item.AcceptanceItemName;
      vm.data.CloseRelatedObjectId = item.AcceptanceItemID;
      $mdSidenav('gx_nav').close();
    }

    vm.selectProcedure = function(){
      $mdSidenav('gx_nav').open();
    }
    vm.isNew = $stateParams.id=='add';

    vm.createTask = function(){
      if(vm.isNew) {
        api.plan.TaskLibrary.create(vm.data).then(function (r) {
          $state.go('app.plan.task.detail',{id: r.data.TaskLibraryId});
        });
      }
      else{
        api.plan.TaskLibrary.update(vm.data.TaskLibraryId,vm.data).then(function (r) {

        })
      }
    }

    if(!vm.isNew){
      api.plan.TaskLibrary.getTaskFlow($stateParams.id).then(function (r) {
        task = vm.data = r.data;
      })
    }
    else{
      task = vm.data = {
        Level:0
      }
    }

    vm.toggleRight = function () {
      return $mdSidenav('right')
        .open();
    }
    vm.closeRight = function () {
      return $mdSidenav('right')
        .close();
    }
    vm.relationTypes = [{
      name:'关联实测项',
      type:'PQMeasure'
    },{
      name:'关联工序',
      type:'Inspection'
    }]
    vm.onLoadTemplate = function () {

      if(!task) {
        task = {
          taskId: 0,
          Name: vm.data&&vm.data.name||'楼栋模板',
          Master: [],
          Branch: []
        }
      }
      if(task.Master.length===0) {
        vm.toggleRight();
      }
      if(temp)return;
      temp = new template({
        onClick:function (e) {
          vm.current = e.data;
          vm.toggleRight();
          vm.saveNotice7=[];
          vm.MileStone = [];
          //vm.saveNoticeStarted = [];
          //vm.saveNoticeEarlyWarning=[];
          vm.saveNotice8=[];
          $timeout(function(){
            vm.getUsers();
            vm.getNextTasks();
            vm.getMilestone();
            vm.categoryChanged = false;
          },300)

        }
      });
      temp.load(task);

    }
    vm.getMilestone = function(){
      api.plan.MileStone.query({RelatedFlowId:vm.current.TaskFlowId}).then(function(r){
        if(r.data&&r.data.Items.length){
          vm.MileStone = r.data.Items[0];
          vm.current.Memorial = true;
          vm.current.MemorialName = vm.MileStone.Name;
          vm.current.Percentage = vm.MileStone.Percentage;
        }
      })
    }
    api.plan.UserGroup.query().then(function(r){
      vm.nextUserGroups = r.data.Items;
    })
    vm.getUsers = function(){
      var promise=[
        api.plan.TaskFlow.getRoleByFlowId(vm.current.TaskFlowId)
        //api.plan.UserGroup.query()
      ]
      if(!vm.nextUserGroups) return;
     // $q.all(promise).then(function(res){
        api.plan.TaskFlow.getRoleByFlowId(vm.current.TaskFlowId).then(function(res){
        //var users = res[0].data.Items;
        //vm.nextUserGroups = res[1].data.Items;
        var users = res.data.Items;
        if(!users&&users.length) return;
        users.forEach(function(r){
          var f = vm.nextUserGroups.find(function(_r){
            return _r.GroupID == r.RoleId;
          })
          if(f){
            f['selected'+ r.NotificationType] = true;
          }
        })
        users.forEach(function(r){
          switch (r.NotificationType){
            //case 1:
            //  vm.saveNoticeStarted.push(r.RoleId);
            //  break;
            //case 2:
            //  vm.saveNoticeEarlyWarning.push(r.RoleId);
            //  break;
            case 1:
              break;
            case 2:
              break;
            case 4:
              break;
            case 7:
              vm.saveNotice7.push(r.RoleId);
              break;
            case 8:
              vm.saveNotice8.push(r.RoleId);
              break;
            default:
              break;
          }
        })
      })
    }

    vm.save = function () {
      var data={
        "Id": vm.current.TaskFlowId,
        "Name": vm.current.Name,
        "IsFloor": vm.current.IsFloor,
        "IsRequired":vm.current.IsRequired
      }
      api.plan.TaskFlow.updateTaskById(data).then(function () {
        temp && temp.edit(vm.current);
        vm.closeRight();
      })
      if(vm.current.Memorial){
        var mdata = {
          "Name": vm.current.MemorialName,
          "RelatedFlowId": vm.current.TaskFlowId,
          "Percentage": vm.current.Percentage
        }
        if(vm.MileStone&&vm.MileStone.length){
          mdata.Id = vm.MileStone.Id;
          api.plan.MileStone.update(vm.MileStone.Id,mdata).then(function(){

          })
        }else{
          api.plan.MileStone.create(mdata).then(function(r){

          })
        }
      }else if(!vm.current.Memorial&&vm.MileStone){
        api.plan.MileStone.delete(vm.MileStone.Id).then(function(r){
          console.log(r)
        })
      }
    }
    vm.getSelectedText = function(){
      vm.saveTasks && vm.saveTasks.map(function(r){
        console.log(r)
       // return r.split('-')[0];
      })
      return vm.saveTasks;
    }
    vm.nextSave = function () {
      var next = angular.extend({
        TaskLibraryId:task.TaskLibraryId,
        IsFloor:false,
        Type:vm.current?vm.current.line:0,
        ParentId:vm.current?vm.current.TaskFlowId:0
      },vm.next);
      vm.next = {};
      api.plan.TaskFlow.post(
        next
      ).then(function (r) {
        next.TaskFlowId = r.data.TaskFlowId;
        next.TaskLibraryId = task.TaskLibraryId;
        //next.categoryId = new Date().getTime();
        temp && temp.add(next,vm.current);
        vm.closeRight();
      });

    }
    vm.nextBranch = function () {
      var next = angular.extend({
        TaskLibraryId:task.TaskLibraryId,
        IsFloor:false,
        Type:vm.data.Branch.length+1,//vm.current?vm.current.line+1:0,
        ParentId:vm.current?vm.current.TaskFlowId:0
      },vm.branch);
      vm.branch = {};
      api.plan.TaskFlow.post(
        next
      ).then(function (r) {
        next.TaskFlowId = r.data.TaskFlowId;
        next.TaskLibraryId = task.TaskLibraryId;
        //next.categoryId = new Date().getTime();
        temp && temp.add(next,vm.current,true);
        vm.closeRight();
      });

    }
    vm.remove = function () {
      utils.confirm('确认删除',null).then(function(){
        api.plan.TaskFlow.deleteFlow(vm.current.TaskFlowId).then(function () {
          temp && temp.remove(vm.current);
          vm.closeRight();
          //$state.go('app.plan.task.list');
        })
      })
    }
    $scope.$watch('vm.selectedCategory',function(){
      if(!vm.cselectedCategory){
        vm.cselectedCategory = vm.selectedCategory;
      }
      if(vm.selectedCategory&&vm.selectedCategory!=vm.cselectedCategory){
        vm.categoryChanged = true;
      }else if(vm.selectedCategory){
        vm.categoryChanged = false;
        vm.getNextTasks();
      }
    })
    vm.getNextTasks = function () {
      vm.saveTasks =[];
      vm.nextTasks=[];
      var promises = [
        api.plan.TaskLibrary.GetList({Level:task.Level+1}),
        api.plan.TaskFlow.getSubTasks(vm.current.TaskFlowId)
      ];
      $q.all(promises).then(function(res){
        vm.nextTasks = res[0].data.Items;
        vm.selectedTasks =  res[1].data.Items;
        vm.nextTasks.forEach(function(r){
          var f = res[1].data.Items&&res[1].data.Items.find(function(_r){
            return _r.TaskLibraryId == r.TaskLibraryId;
          })
          if(f&&!vm.categoryChanged){
              vm.cselectedCategory = r.Type;
              vm.selectedCategory = r.Type;
              r.selected = true;
          }
        })
      })
      //api.plan.TaskLibrary.GetList({
      //  Level:task.Level+1
      //}).then(function (r) {
      //  vm.nextTasks = r.data.Items;
      //})
    }

    vm.addSubTask = function (ev) {
      $mdSelect.destroy();
      $mdDialog.show({
        controller: 'planTaskMiniController',
        templateUrl: 'app/main/plan/component/plan-task-mini.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        clickOutsideToClose: true,
        fullscreen: false,
        locals:{
          parentTask:task,
          selected:vm.selectedCategory&&vm.selectedCategory
        }
      })
        .then(function (newTask) {
          if(!angular.isArray(vm.saveTasks)){
            vm.saveTasks=[];
          }
          vm.saveTasks.push(newTask.TaskLibraryId);
          var tasks = [];
          vm.saveTasks && vm.saveTasks.forEach(function (tid) {
            tasks.push({
              TaskFlowId:vm.current.TaskFlowId,
              TaskLibraryId:tid
            });
          })
          api.plan.TaskFlow.resetTaskFlow(vm.current.TaskFlowId,tasks).then(function(r){
            if(r.status == 200 || r.data){
              vm.getNextTasks();
            }
          })

        }, function () {

        });
    }
    vm.saveSubTasks = function () {
      var tasks = [];
      vm.saveTasks && vm.saveTasks.forEach(function (tid) {
        tasks.push({
          TaskFlowId:vm.current.TaskFlowId,
          TaskLibraryId:tid
        });
      })
      api.plan.TaskFlow.resetTaskFlow(vm.current.TaskFlowId,tasks).then(function(r){

      })
      //console.log('vm.saveTasks',vm.saveTasks)
    }
    //vm.getUseGroups = function () {
    //  api.plan.UserGroup.query().then(function (r) {
    //    vm.nextUserGroups = r.data.Items;
    //  })
    //}
    //vm.getUseGroups();
    vm.stop = function(ev){
      ev.stopPropagation();
    }
    vm.addRole = function (ev) {
      $mdSelect.destroy();
        var confirm = $mdDialog.prompt()
          .title('添加新的角色')
          .textContent('请输入角色名字')
          .placeholder('角色名字')
          .ariaLabel('角色名字')
          .initialValue('')
          .ok('添加')
          .cancel('取消');
        $mdDialog.show(confirm).then(function(result) {
          api.plan.UserGroup.create({
            "GroupName": result,
            "SystemID": "plan",
            "Description": result
          }).then(function(r){
            utils.alert('添加成功',null).then(function(){

            })
            //$mdDialog.show(
            //  $mdDialog.alert()
            //    .title('添加成功')
            //)
          })
        }, function() {

        });
    }
    vm.saveUserGroup = function (type) {
      var users ={
        roleIds:[]
      };
      var datas = vm['saveNotice'+type];
      //console.log(datas)
      datas&&datas.forEach(function(r){
        users.roleIds.push(r)
      })
      api.plan.TaskFlow.resetTaskFlowRolesByType(vm.current.TaskFlowId,type,users.roleIds).then(function(r){
      })
    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTaskV.$inject = ["$scope", "template", "$mdSidenav", "$stateParams", "api", "$state", "$mdDialog", "$mdSelect", "$q", "utils", "$timeout"];
  angular
    .module('app.plan')
    .component('planTaskV',{
      templateUrl:'app/main/plan/component/plan-task-v.html',
      controller:planTaskV,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planTaskV($scope,template,$mdSidenav,$stateParams,api,$state,$mdDialog,$mdSelect,$q,utils,$timeout){
    var vm = this,
      temp,task,
      id = $state.params["id"],
      templateId=$state.params['templateId'];

    vm.isNew = $stateParams.id=='add';
    api.plan.TaskTemplates.GetList({Skip:0,Limit:0}).then(function (r) {
      vm.tempDatas=r.data.Items||[];
    });
    if(!vm.isNew){
      vm.loading= true;
      //loadData();
      api.plan.TaskLibrary.getTaskFlow($stateParams.id).then(function (r) {
        task = vm.data = r.data;
        vm.data._CloseRelatedObjectType = vm.data.CloseRelatedObjectType;
        vm.data.CloseRelatedObjectType&&vm.data.CloseRelatedObjectType==0?vm.data.CloseRelatedObjectType ='PQMeasure':vm.data.CloseRelatedObjectType='Inspection';
        task.oType = task.Type;
        vm.data._DurationType = vm.data.DurationType;
        vm.data.DurationType == 0?vm.data.DurationType ='FixedDuration':vm.data.DurationType= 'VariableDuration';
        vm.loading= false;
        task.Master = [{
          root:true,
          TaskFlowId:id,
          Name:task.Name
        }].concat(task.Master);

        task.Master.forEach(function (flow) {
          if(flow.ParentId===0)
            flow.ParentId=id;
          if(flow.Description)
            angular.extend(flow,angular.fromJson(flow.Description));
          //单项任务名改变时取值
          if(flow.OptionalTask){
            if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
              flow.OptionalTask =  flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
            }else{
              if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
              }
            }
          }
          flow.oMilestone=flow.Milestone;
          flow.oName=flow.Name;
          flow.oReservedEndDays = flow.ReservedEndDays;
          flow.oDuration = flow.Duration;
          flow.oNotice7 = flow.Notice7;
          flow.oNotice8 = flow.Notice8;
          flow.oMeasureInfo = flow.MeasureInfo;
          flow.oExpression = flow.Expression;
          flow.oisChuancha = flow.isChuancha;
          flow.oMeasureId = flow.MeasureId;
          flow.oManuallyClose=flow.ManuallyClose;
        });
        task.Branch.forEach(function (b) {
          b.forEach(function (flow) {
            if(flow.ParentId===0)
              flow.ParentId=id;
            if(flow.Description)
              angular.extend(flow,angular.fromJson(flow.Description));
            if(flow.OptionalTask){
              if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
                flow.OptionalTask = flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
              }else{
               if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                 flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
               }
              }
            }
            flow.oMilestone=flow.Milestone;
            flow.oName=flow.Name;
            flow.oReservedEndDays = flow.ReservedEndDays;
            flow.oDuration = flow.Duration;
            flow.oNotice7 = flow.Notice7;
            flow.oNotice8 = flow.Notice8;
            flow.oMeasureInfo = flow.MeasureInfo;
            flow.oExpression = flow.Expression;
            flow.oisChuancha = flow.isChuancha;
            flow.oMeasureId = flow.MeasureId;
            flow.oManuallyClose=flow.ManuallyClose;
          })
        });
        vm.onLoadTemplate();
      })
    }
    else{
      task = vm.data = {
        Level:1,
        DurationType: 'FixedDuration'
      }
    }
    vm.setEndFlow = function (flow,endFlow) {
      flow.EndFlagTaskFlowId = endFlow? endFlow.TaskFlowId:0;
      vm.updateFlow(flow).then(function () {
        vm.flows = temp.load(temp.task);
      });
    }
    vm.relationTypes = [{
      name:'关联实测项',
      type:'PQMeasure'
    },{
      name:'关联工序',
      type:'Inspection'
    }]
    vm.addNext = function (ev,flow,isBranch) {
      var confirm = $mdDialog.prompt()
        .title('添加'+(isBranch?'下一分支':'下一流程'))
        .placeholder((isBranch?'分支名称':'流程名称'))
        .ariaLabel((isBranch?'分支名称':'流程名称'))
        .targetEvent(ev)
        .ok('确定')
        .cancel('取消');
      if(temp.task.Master.length===1)
        isBranch =false;

      return $mdDialog.show(confirm).then(function(result) {
        var next = {
          TaskLibraryId: id,
          IsFloor: false,
          Type: isBranch ? temp.task.Branch.length+1 : flow ? flow.line : 0,
          ParentId: flow && flow.TaskFlowId!=id ? flow.TaskFlowId : 0,
          Name: result
        };
        return api.plan.TaskFlow.post(
          next
        ).then(function (r) {
          next.TaskFlowId = r.data.TaskFlowId;
          if(vm.data.Level==1){
            return api.plan.TaskLibrary.create({
              Level:vm.data.Level+1,
              Name:result
            }).then(function (r1) {
              return api.plan.TaskFlow.resetTaskFlow(next.TaskFlowId,[{
                TaskFlowId:next.TaskFlowId,
                TaskLibraryId:r1.data.TaskLibraryId
              }]);
            });
          }
        }).then(function () {
          vm.flows = temp.add(next,flow,isBranch);
        });
      });
    }
    api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:1,TemplateId:templateId}).then(function (r) {
      vm.subTasks = r.data.Items||[];
    });
    vm.addBranch = function(ev,flow,isBranch){
      $mdDialog.show({
        templateUrl:'app/main/plan/component/plan-branch.html',
        controller:['$scope','items',function($scope,items){
          var vm = this;
          if(items){
            vm.subTasks = items;
          }else{
              console.log('t',templateId)
            api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:1,TemplateId:templateId}).then(function (r) {
              vm.subTasks = r.data.Items||[];
            });
          }
          vm.stop = function(ev){
            ev.stopPropagation();
          }
          vm.select = function(){
            $mdDialog.hide(vm.relatedTask)
          }
        }],
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        controllerAs:'vm',
        locals:{
          items:vm.subTasks && vm.subTasks
        }
      }).then(function(res){
        var next = {
          TaskLibraryId: id,
          IsFloor: false,
          Type: isBranch ? temp.task.Branch.length+1 : flow ? flow.line : 0,
          ParentId: flow ? flow.TaskFlowId : 0,
          Name: res.Name,
          Description:angular.toJson({
            isChuancha:true
          })
        };
        return api.plan.TaskFlow.post(
          next
        ).then(function (r) {
          next.TaskFlowId = r.data.TaskFlowId;
          if(vm.data.Level==1) {
            return api.plan.TaskFlow.resetTaskFlow(next.TaskFlowId, [{
              TaskFlowId: next.TaskFlowId,
              TaskLibraryId: res.TaskLibraryId
            }]);
          }
        }).then(function () {
          vm.flows = temp.add(next,flow,isBranch);
          vm.flows.forEach(function(flow){
            if(flow.Description)
              angular.extend(flow,angular.fromJson(flow.Description));
          })
          //console.log(next,vm.flows)
        });
      })
    }
    vm.removeFlow = function (ev,flow) {
      return utils.confirm('确认删除'+flow.Name+'？',null).then(function(){
        return $q(function (resolve) {
          if (vm.data.Level === 1) {
            return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
              if(r.data.Items.length){
                var q=[];
                r.data.Items.forEach(function (t) {
                  q.push(api.plan.TaskLibrary.delete(t.TaskLibraryId));
                });
                $q.all(q).then(function () {
                  resolve();
                })
              }
              else{
                resolve();
              }
            });
          }
          else {
            resolve();
          }
        }).then(function () {
          return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId,[]).then(function (r) {
            return api.plan.TaskFlow.deleteFlow(flow.TaskFlowId).then(function () {
              vm.flows = temp.remove(flow);
            })
          });
        });
      });
    }
    vm.updateFlowName = function (flow) {
      if(flow.oName != flow.Name){
        flow.oName = flow.Name;
        return vm.updateFlow(flow);
      }
    }
    vm.updateExpression = function (flow) {
      if(flow.oExpression != flow.Expression){
        flow.oExpression = flow.Expression;
        return vm.updateFlow(flow);
      }
    }
    vm.updateMilestone = function (flow) {
      if(flow.oMilestone != flow.Milestone){
        flow.oMilestone = flow.Milestone;
        return api.plan.MileStone.query({RelatedFlowId:flow.TaskFlowId}).then(function(r){
          var m = r.data && r.data.Items[0];
          if(!flow.Milestone){
            if(m) {
              return api.plan.MileStone.delete(m.Id);
            }
          }
          else{
            if(m) {
              m.Name = flow.Milestone;
              return api.plan.MileStone.update(m.Id, m)
            }
            else{
              return api.plan.MileStone.create({
                Name:flow.Milestone,
                RelatedFlowId:flow.TaskFlowId,
                Percentage:100
              });
            }
          }
        }).then(function () {
          return vm.updateFlow(flow);
        })
      }
    }
    vm.updateFlow = function (flow) {
      return api.plan.TaskFlow.updateTaskById({
        Id:flow.TaskFlowId,
        Name:flow.Name,
        IsFloor:flow.IsFloor,
        IsRequired:flow.IsRequired,
        EndFlagTaskFlowId:flow.EndFlagTaskFlowId,
        Expression:flow.Expression,
        IsMustComplete:flow.IsMustComplete,
        Description:angular.toJson({
          ReservedEndDays:flow.ReservedEndDays,
          Duration: flow.Duration,
          Milestone:flow.Milestone,
          OptionalTask:flow.OptionalTask,
          Notices:flow.Notices,
          CarryOut:flow.CarryOut,
          Notice7: flow.Notice7,
          Notice8: flow.Notice8,
          MeasureInfo:flow.MeasureInfo,
          isChuancha:flow.isChuancha,
          MeasureId : flow.MeasureId,
          ManuallyClose:flow.ManuallyClose,
        })
      }).then(function () {

      })
    }
    vm.updateMust = function(flow){
      return vm.updateFlow(flow);
    }
    vm.updateManuallyClose = function(flow){
      //if(flow.oManuallyClose != flow.ManuallyClose){
        flow.oManuallyClose = flow.ManuallyClose;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.ManuallyClose = flow.ManuallyClose;
          taskLib._taskFlowId = taskLib.TaskLibraryId;
          return api.plan.TaskLibrary.update(taskLib).then(function () {
            return vm.updateFlow(flow);
          },function(err){
            utils.alert(err.data||'更新手工关闭数据失败!')
          })
        },function(err){
          utils.alert(err.data||'更新手工关闭数据失败!')
        });
      //}

    }
    vm.updateDuration = function (flow) {
      if(flow.oDuration != flow.Duration){
        flow.oDuration = flow.Duration;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib._taskFlowId = taskLib.TaskLibraryId;
          taskLib.Duration = flow.Duration;
          return api.plan.TaskLibrary.update(taskLib).then(function () {
            return vm.updateFlow(flow);
          },function(err){
            utils.alert(err.data||'更新工期数据失败!')
          })
        },function(err){
          utils.alert(err.data||'更新工期数据失败!')
        });
      }
    }
    vm.updateReservedEndDays = function (flow) {
      if(flow.oReservedEndDays != flow.ReservedEndDays){
        flow.oReservedEndDays = flow.ReservedEndDays;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.ReservedEndDays = flow.ReservedEndDays;
          return api.plan.TaskFlow.updateTaskById(taskLib).then(function () {
            return vm.updateFlow(flow);
          })
        });
      }
    }
    vm.onLoadTemplate = function () {
      if(!task) {
        task = {
          taskId: 0,
          Name: vm.data&&vm.data.name||'楼栋模板',
          Master: [],
          Branch: []
        }
      }
      if(temp)return;
      temp = new template({
        onClick:function (e) {
          vm.current = e.data;
        }
      });
      vm.flows = temp.load(task);
      //setVerify(vm.flows)
    }
    function setVerify(items){
      items.forEach(function(r){
        if(r.Name.indexOf('验') !=-1){
          r.choose = true;
        }
      })
    }
    vm.setBack = function(flow){
      var f = vm.flows.indexOf(flow);
      if(f!=-1){
        vm.flows.forEach(function(r,index){
          if(index>f){
            r.showBack = true;
          }else{
            r.showBack = false;
          }
        })
      }
    }
    vm.selectOptionalTask =function (flow) {
      return $mdDialog.show({
        controller: ['$mdDialog','$scope', function ($mdDialog) {
          var vm = this;
          vm.flow = flow;
          vm.data = {};
          vm.selectedCategory = flow.Name;
          vm.categories = [{
            name:flow.Name
          }];
          var promises = [
            api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1}),
            api.plan.TaskFlow.getSubTasks(flow.TaskFlowId)
          ];
          $q.all(promises).then(function(res){
            vm.items = res[0].data.Items;
            vm.items.forEach(function(r){
              var f = res[1].data.Items&&res[1].data.Items.find(function(_r){
                  return _r.TaskLibraryId == r.TaskLibraryId;
                });
              if(r.Type)
                r.Type = '其它';
              var tags = r.Type&&r.Type.split('>');
              tags&&tags.reduce(function (prev,current) {
                var fd = prev.find(function (t) {
                  return t.name == current;
                });
                if(!fd){
                  fd = {
                    name:current,
                    children:[]
                  }
                  prev.push(fd);
                }
                return fd.children;
              },vm.categories);
              if(f){
                r.Type = flow.Name;
                r.selected = true;
              }
            })
          })
          vm.add = function(cmd){
            vm.current = cmd;
            vm.data = {};
          }
          vm.select = function () {
            $mdDialog.hide(vm.items.filter(function (t) {
              return t.selected;
            }));
          }
          vm.submit = function () {
            vm.data.Type = vm.data.Type || flow.Name;
            vm.data.Level = task.Level+1;
              api.plan.TaskLibrary.create(vm.data).then(function(r){
                if(r.status == 200 || r.data){
                  vm.current = 'default';
                  api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1}).then(function(r1){

                    if(vm.items){
                      r1.data.Items.forEach(function (item) {
                        item.selected = !!vm.items.find(function (it) {
                          return it.TaskLibraryId == item.TaskLibraryId && it.selected;
                        })
                      });
                    }
                    var newItem = r1.data.Items.find(function (it) {
                      return it.TaskLibraryId == r.data.TaskLibraryId;
                    });
                    if(newItem)
                      newItem.selected = true;

                    vm.items = r1.data.Items;
                  })
                }
              })
            }
        }],
        controllerAs: 'vm',
        templateUrl: 'app/main/plan/component/plan-task-subs.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function (tasks) {
          var ts = [];
          tasks.forEach(function (t) {
            ts.push({
              TaskFlowId: flow.TaskFlowId,
              TaskLibraryId: t.TaskLibraryId
            });
          })
          return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId, ts).then(function (r) {
            flow.OptionalTask = tasks.length ?
              (tasks.length > 1 ? tasks.length + '任务' : tasks[0].Name) : undefined;
            return vm.updateFlow(flow);
          })
        });
    }
    vm.selectUsers = function(item,type){
      return $mdDialog.show({
        templateUrl:'app/main/plan/component/plan-task-roles.html',
        controller:['$scope',function($scope){
          var vm = this;
          vm.type = type;
          vm.add = function(){
            api.plan.UserGroup.create({
              "GroupName": vm.dataName,
              "SystemID": "plan",
              "Description": vm.dataName
            }).then(function(res){
              vm.current = 'default';
              api.plan.UserGroup.query().then(function(r){
                if(vm.nextUserGroups){
                  r.data.Items.forEach(function (item) {
                    item.selected = !!vm.nextUserGroups.find(function (it) {
                      return it.GroupID == item.GroupID && it.selected;
                    })
                  });
                }
                r.data.Items.forEach(function(r){
                  var newItem = !vm.nextUserGroups.find(function(_r){
                    return _r.GroupID == r.GroupID;
                  })
                  if(newItem){
                    r.selected = true;
                  }
                })
                vm.nextUserGroups = r.data.Items;
              });
            })
          }
          vm.select = function () {
            $mdDialog.hide(vm.nextUserGroups.filter(function (t) {
              return t.selected;
            }));
          }
          $q.all([
            api.plan.UserGroup.query(),
            api.plan.TaskFlow.getRoleByFlowId(item.TaskFlowId)
          ]).then(function(res){
            vm.nextUserGroups = res[0].data.Items;
            var users = res[1].data.Items;
            if(!users.length) return;
            users&&users.forEach(function(r){
              var f = vm.nextUserGroups&&vm.nextUserGroups.find(function(_r){
                  return _r.GroupID == r.RoleId;
                })
              if(f&& r.NotificationType == vm.type){
                f.selected = true;
              }
            })
          })
        }],
        controllerAs: 'vm',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function(back){
        var users ={
          roleIds:[]
        };
        var datas = back;
        datas&&datas.forEach(function(r){
          users.roleIds.push(r.GroupID)
        })
        api.plan.TaskFlow.resetTaskFlowRolesByType(item.TaskFlowId,type,users.roleIds).then(function(r){
          item['Notice'+type] = back.length ?
            (back.length > 1 ? back.length + '角色' : back[0].GroupName) : undefined;
          return vm.updateFlow(item);
        })
      })
    }
    //获取所有角色
    //api.plan.UserGroup.query().then(function(r){
    //  vm.nextUserGroup = r.data.Items;
    //})
    vm.stop = function(ev){
      ev.stopPropagation();
    }
    vm.saveUserGroup = function (flow,type) {
      var users ={
        roleIds:[]
      };
      var datas = flow['saveNotice'+type];
      datas&&datas.forEach(function(r){
        users.roleIds.push(r)
      })
      api.plan.TaskFlow.resetTaskFlowRolesByType(flow.TaskFlowId,type,users.roleIds).then(function(r){
        flow['saveNotice'+type] = datas;
        return vm.updateFlow(flow);
      })
    }
    api.plan.procedure.query().then(function(r){
      vm.procedures = r.data;
    })

    //vm.selectSpecialtyLow=function(item,parent){
    //  parent.WPAcceptanceList=item.WPAcceptanceList;
    //}
    vm.setMeasureInfo = function(flow){
      vm.loadMeasure = false;
       $mdDialog.show({
        controller:['$scope','data','items',function($scope,data,items){
          var vm = this;
          vm.data = data;
          vm.current = null;
          vm.gxName = '';
          api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function(r){
            vm.sendData = r.data.Items[0];
            vm.sendData._taskFlowId =r.data.Items[0].TaskLibraryId;
          })
          if(items){
            vm.loadMeasure = true;
            vm.proceduresData = items;
            var g = vm.proceduresData.find(function(_p){
              return _p.AcceptanceItemID ==  flow.MeasureId;
            })
              if(g){
                vm.current = g;
                vm.gxName = flow.MeasureInfo;
              }
            if(!vm.current){
                //vm.sendData.CloseRelatedObjectId = null;
                flow.MeasureInfo = null;
                flow.MeasureId = null;
            }
          }
          vm.clrChoose = function(){
            vm.current = null;
            vm.gxName = '';
            vm.sendData.CloseRelatedObjectId = null;
          }
          vm.stop = function(ev){
            ev.stopPropagation();
          }
          vm.choose = function(item){
            vm.current = item;
            vm.sendData.CloseRelatedObjectId = item.AcceptanceItemID;
            vm.gxName = item.AcceptanceItemName;
          }
          vm.select = function(){
            vm.sendData.CloseRelatedObjectType = 'Inspection';
            if(vm.current){
              flow.MeasureInfo = vm.current.AcceptanceItemName;
              flow.MeasureId = vm.current.AcceptanceItemID;
            }else{
              flow.MeasureInfo = null;
              flow.MeasureId = null;
            }
            $mdDialog.hide(vm.sendData);
          }
        }],
        controllerAs:'vm',
        templateUrl:'app/main/plan/component/plan-task-measureinfo.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        locals:{
          data:vm.data && vm.data,
          items:vm.procedures
        }
      }).then(function(data){
         console.log(data)
        api.plan.TaskLibrary.update(data).then(function (r) {
          return vm.updateFlow(flow);
        });
      })
    }
    vm.ClickSaveleft = function(data){
      data._taskFlowId=data._taskFlowId||data.TaskLibraryId;
      data.Type = data.Type || data.oType;
      if(id=='add'){
        api.plan.TaskLibrary.create(data).then(function (r) {
          $state.go('app.plan.task.list');
        });
      }else{
        api.plan.TaskLibrary.update(data).then(function (r) {
          //$state.go('app.plan.task.list');
          if(r.status == 200){
            utils.alert('保存成功！');
          }
        });
      }

    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTaskSubs.$inject = ["$scope", "api", "$state", "utils"];
  angular
    .module('app.plan')
    .component('planTaskSubs',{
      templateUrl:'app/main/plan/component/plan-task-subs.html',
      controller:planTaskSubs,
      controllerAs:'vm',
      bindings:{
        flow:'<',
        onSelect:'&'
      }
    });

  /** @ngInject */
  function planTaskSubs($scope,api,$state,utils){
    var vm = this;
    vm.selectedFilter = 1;

    vm.Delete = function(item){
      utils.confirm('是否确认删除任务？').then(function (r) {
        api.plan.TaskLibrary.delete(item.TaskLibraryId).then(function (r) {
          Load();
        });
      });
    }

    $scope.$watch("vm.selectedFilter",function(){
      Load();
    });

    function Load() {
       api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:vm.selectedFilter}).then(function (r) {
         vm.items = r.data.Items||[];
       });
    }

  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planTaskMiniController.$inject = ["$scope", "api", "$mdDialog", "parentTask", "selected"];
  angular
    .module('app.plan')
    .controller('planTaskMiniController',planTaskMiniController)

  /** @ngInject */
  function planTaskMiniController($scope,api, $mdDialog,parentTask,selected){
    $scope.data = {
      Level:parentTask.Level+1,
      Type:selected
    }
    $scope.hide = function () {
      api.plan.TaskLibrary.create($scope.data).then(function (r) {
        $mdDialog.hide(r.data);
      });
    }
    $scope.cancel = function () {
      $mdDialog.cancel();
    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/11/14.
 */
(function(angular,undefined){
  'use strict';

  planTaskLevelController.$inject = ["$scope", "template", "$mdSidenav", "$stateParams", "api", "$state", "$mdDialog", "$mdSelect", "$q", "utils", "$timeout"];
  angular
    .module('app.plan')
    .component('planTaskLevel',{
      templateUrl:'app/main/plan/component/plan-task-level.html',
      controller:planTaskLevelController,
      controllerAs:'vm'
    });

  /**@ngInject*/
  function planTaskLevelController($scope,template,$mdSidenav,$stateParams,api,$state,$mdDialog,$mdSelect,$q,utils,$timeout){
    var vm = this;
    var vm = this,
      temp,task,
      id = $state.params["id"];

    vm.isNew = $stateParams.id=='add';
    if(!vm.isNew){
      vm.loading= true;
      loadData();
      api.plan.TaskLibrary.getTaskFlow($stateParams.id).then(function (r) {
        task = vm.data = r.data;
        vm.data._CloseRelatedObjectType = vm.data.CloseRelatedObjectType;
        vm.data.CloseRelatedObjectType&&vm.data.CloseRelatedObjectType==0?vm.data.CloseRelatedObjectType ='PQMeasure':vm.data.CloseRelatedObjectType='Inspection';
        task.oType = task.Type;
        vm.data._DurationType = vm.data.DurationType;
        vm.data.DurationType == 0?vm.data.DurationType ='FixedDuration':vm.data.DurationType= 'VariableDuration';
        vm.loading= false;
        task.Master.forEach(function (flow) {
          if(flow.Description)
            angular.extend(flow,angular.fromJson(flow.Description));
          //单项任务名改变时取值
          if(flow.OptionalTask){
            if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
              flow.OptionalTask =  flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
            }else{
              if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
              }
            }
          }
          flow.oMilestone=flow.Milestone;
          flow.oName=flow.Name;
          flow.oReservedEndDays = flow.ReservedEndDays;
          flow.oDuration = flow.Duration;
          flow.oNotice7 = flow.Notice7;
          flow.oNotice8 = flow.Notice8;
          flow.oMeasureInfo = flow.MeasureInfo;
          flow.oExpression = flow.Expression;
        });
        task.Branch.forEach(function (b) {
          b.forEach(function (flow) {
            if(flow.Description)
              angular.extend(flow,angular.fromJson(flow.Description));
            if(flow.OptionalTask){
              if(!(/^\d+$/.test(flow.OptionalTask.substr(0,1)))){
                flow.OptionalTask = flow.OptionalTasks.length&&flow.OptionalTasks[0].Name;
              }else{
                if(flow.OptionalTasks.length !=flow.OptionalTask.substr(0,1)){
                  flow.OptionalTask = flow.OptionalTasks.length==1?flow.OptionalTasks[0].Name:flow.OptionalTasks.length+'任务';
                }
              }
            }
            flow.oMilestone=flow.Milestone;
            flow.oName=flow.Name;
            flow.oReservedEndDays = flow.ReservedEndDays;
            flow.oDuration = flow.Duration;
            flow.oNotice7 = flow.Notice7;
            flow.oNotice8 = flow.Notice8;
            flow.oMeasureInfo = flow.MeasureInfo;
            flow.oExpression = flow.Expression;
          })
        });
        vm.onLoadTemplate();
      })
    }
    else{
      task = vm.data = {
        Level:0
      }
    }
    vm.setEndFlow = function (flow,endFlow) {
      flow.EndFlagTaskFlowId = endFlow? endFlow.TaskFlowId:0;
      vm.updateFlow(flow).then(function () {
        vm.flows = temp.load(temp.task);
      });
    }
    vm.relationTypes = [{
      name:'关联实测项',
      type:'PQMeasure'
    },{
      name:'关联工序',
      type:'Inspection'
    }]
    vm.addNext = function (ev,flow,isBranch) {
      var confirm = $mdDialog.prompt()
        .title('添加'+(isBranch?'下一分支':'下一流程'))
        .placeholder((isBranch?'分支名称':'流程名称'))
        .ariaLabel((isBranch?'分支名称':'流程名称'))
        .targetEvent(ev)
        .ok('确定')
        .cancel('取消');

      return $mdDialog.show(confirm).then(function(result) {
        var next = {
          TaskLibraryId: id,
          IsFloor: false,
          Type: isBranch ? temp.task.Branch.length+1 : flow ? flow.line : 0,
          ParentId: flow ? flow.TaskFlowId : 0,
          Name: result
        };
        return api.plan.TaskFlow.post(
          next
        ).then(function (r) {
          next.TaskFlowId = r.data.TaskFlowId;
          if(vm.data.Level==1){
            return api.plan.TaskLibrary.create({
              Level:vm.data.Level+1,
              Name:result
            }).then(function (r1) {
              return api.plan.TaskFlow.resetTaskFlow(next.TaskFlowId,[{
                TaskFlowId:next.TaskFlowId,
                TaskLibraryId:r1.data.TaskLibraryId
              }]);
            });
          }
        }).then(function () {
          vm.flows = temp.add(next,flow,isBranch);
        });
      });
    }
    vm.removeFlow = function (ev,flow) {
      return utils.confirm('确认删除'+flow.Name+'？',null).then(function(){
        return $q(function (resolve) {
          if (vm.data.Level === 1) {
            return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
              if(r.data.Items.length){
                var q=[];
                r.data.Items.forEach(function (t) {
                  q.push(api.plan.TaskLibrary.delete(t.TaskLibraryId));
                });
                $q.all(q).then(function () {
                  resolve();
                })
              }
              else{
                resolve();
              }
            });
          }
          else {
            resolve();
          }
        }).then(function () {
          return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId,[]).then(function (r) {
            return api.plan.TaskFlow.deleteFlow(flow.TaskFlowId).then(function () {
              vm.flows = temp.remove(flow);
            })
          });
        });
      });
    }
    vm.updateFlowName = function (flow) {
      if(flow.oName != flow.Name){
        flow.oName = flow.Name;
        return vm.updateFlow(flow);
      }
    }
    vm.updateExpression = function (flow) {
      if(flow.oExpression != flow.Expression){
        flow.oExpression = flow.Expression;
        return vm.updateFlow(flow);
      }
    }
    vm.updateMilestone = function (flow) {
      if(flow.oMilestone != flow.Milestone){
        flow.oMilestone = flow.Milestone;
        return api.plan.MileStone.query({RelatedFlowId:flow.TaskFlowId}).then(function(r){
          var m = r.data && r.data.Items[0];
          if(!flow.Milestone){
            if(m) {
              return api.plan.MileStone.delete(m.Id);
            }
          }
          else{
            if(m) {
              m.Name = flow.Milestone;
              return api.plan.MileStone.update(m.Id, m)
            }
            else{
              return api.plan.MileStone.create({
                Name:flow.Milestone,
                RelatedFlowId:flow.TaskFlowId,
                Percentage:100
              });
            }
          }
        }).then(function () {
          return vm.updateFlow(flow);
        })
      }
    }
    vm.updateFlow = function (flow) {
      return api.plan.TaskFlow.updateTaskById({
        Id:flow.TaskFlowId,
        Name:flow.Name,
        IsFloor:flow.IsFloor,
        IsRequired:flow.IsRequired,
        EndFlagTaskFlowId:flow.EndFlagTaskFlowId,
        Expression:flow.Expression,
        IsMustComplete:flow.IsMustComplete,
        Description:angular.toJson({
          ReservedEndDays:flow.ReservedEndDays,
          Duration: flow.Duration,
          Milestone:flow.Milestone,
          OptionalTask:flow.OptionalTask,
          Notices:flow.Notices,
          CarryOut:flow.CarryOut,
          Notice7: flow.Notice7,
          Notice8: flow.Notice8,
          MeasureInfo:flow.MeasureInfo
        })
      }).then(function () {

      })
    }
    vm.updateMust = function(flow){
      return vm.updateFlow(flow);
    }
    vm.updateDuration = function (flow) {
      if(flow.oDuration != flow.Duration){
        flow.oDuration = flow.Duration;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.Duration = flow.Duration;
          return api.plan.TaskLibrary.update(taskLib).then(function () {
            return vm.updateFlow(flow);
          })
        });
      }
    }
    vm.updateReservedEndDays = function (flow) {
      if(flow.oReservedEndDays != flow.ReservedEndDays){
        flow.oReservedEndDays = flow.ReservedEndDays;
        return api.plan.TaskFlow.getSubTasks(flow.TaskFlowId).then(function (r) {
          var taskLib = r.data.Items[0];
          taskLib.Id = taskLib.TaskLibraryId;
          taskLib.ReservedEndDays = flow.ReservedEndDays;
          return api.plan.TaskFlow.updateTaskById(taskLib).then(function () {
            return vm.updateFlow(flow);
          })
        });
      }
    }
    vm.onLoadTemplate = function () {
      if(!task) {
        task = {
          taskId: 0,
          Name: vm.data&&vm.data.name||'楼栋模板',
          Master: [],
          Branch: []
        }
      }
      if(temp)return;
      temp = new template({
        onClick:function (e) {
          vm.current = e.data;
        }
      });
      vm.flows = temp.load(task);
      //setVerify(vm.flows)
    }
    function setVerify(items){
      items.forEach(function(r){
        if(r.Name.indexOf('验') !=-1){
          r.choose = true;
        }
      })
    }
    vm.setBack = function(flow){
      var f = vm.flows.indexOf(flow);
      if(f!=-1){
        vm.flows.forEach(function(r,index){
          if(index>f){
            r.showBack = true;
          }else{
            r.showBack = false;
          }
        })
      }
    }
    vm.selectOptionalTask =function (flow) {
      return $mdDialog.show({
        controller: ['$mdDialog','$scope', function ($mdDialog) {
          var vm = this;
          vm.flow = flow;
          vm.data = {};
          vm.selectedCategory = flow.Name;
          vm.categories = [{
            name:flow.Name
          }];
          var promises = [
            api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1}),
            api.plan.TaskFlow.getSubTasks(flow.TaskFlowId)
          ];
          $q.all(promises).then(function(res){
            vm.items = res[0].data.Items;
            vm.items.forEach(function(r){
              var f = res[1].data.Items&&res[1].data.Items.find(function(_r){
                  return _r.TaskLibraryId == r.TaskLibraryId;
                });
              if(r.Type)
                r.Type = '其它';
              var tags = r.Type&&r.Type.split('>');
              tags&&tags.reduce(function (prev,current) {
                var fd = prev.find(function (t) {
                  return t.name == current;
                });
                if(!fd){
                  fd = {
                    name:current,
                    children:[]
                  }
                  prev.push(fd);
                }
                return fd.children;
              },vm.categories);
              if(f){
                r.Type = flow.Name;
                r.selected = true;
              }
            })
          })
          vm.add = function(cmd){
            vm.current = cmd;
            vm.data = {};
          }
          vm.select = function () {
            $mdDialog.hide(vm.items.filter(function (t) {
              return t.selected;
            }));
          }
          vm.submit = function () {
            vm.data.Type = vm.data.Type || flow.Name;
            vm.data.Level = task.Level+1;
            api.plan.TaskLibrary.create(vm.data).then(function(r){
              if(r.status == 200 || r.data){
                vm.current = 'default';
                api.plan.TaskLibrary.GetList({Skip: 0, Limit: 10000, Level: task.Level+1}).then(function(r1){

                  if(vm.items){
                    r1.data.Items.forEach(function (item) {
                      item.selected = !!vm.items.find(function (it) {
                        return it.TaskLibraryId == item.TaskLibraryId && it.selected;
                      })
                    });
                  }
                  var newItem = r1.data.Items.find(function (it) {
                    return it.TaskLibraryId == r.data.TaskLibraryId;
                  });
                  if(newItem)
                    newItem.selected = true;

                  vm.items = r1.data.Items;
                })
              }
            })
          }
        }],
        controllerAs: 'vm',
        templateUrl: 'app/main/plan/component/plan-task-subs.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function (tasks) {
        var ts = [];
        tasks.forEach(function (t) {
          ts.push({
            TaskFlowId: flow.TaskFlowId,
            TaskLibraryId: t.TaskLibraryId
          });
        })
        return api.plan.TaskFlow.resetTaskFlow(flow.TaskFlowId, ts).then(function (r) {
          flow.OptionalTask = tasks.length ?
            (tasks.length > 1 ? tasks.length + '任务' : tasks[0].Name) : undefined;
          return vm.updateFlow(flow);
        })
      });
    }
    vm.selectUsers = function(item,type){
      return $mdDialog.show({
        templateUrl:'app/main/plan/component/plan-task-roles.html',
        controller:['$scope',function($scope){
          var vm = this;
          vm.type = type;
          vm.add = function(){
            api.plan.UserGroup.create({
              "GroupName": vm.dataName,
              "SystemID": "plan",
              "Description": vm.dataName
            }).then(function(res){
              vm.current = 'default';
              api.plan.UserGroup.query().then(function(r){
                if(vm.nextUserGroups){
                  r.data.Items.forEach(function (item) {
                    item.selected = !!vm.nextUserGroups.find(function (it) {
                      return it.GroupID == item.GroupID && it.selected;
                    })
                  });
                }
                vm.nextUserGroups = r.data.Items;
              });
            })
          }
          vm.select = function () {
            $mdDialog.hide(vm.nextUserGroups.filter(function (t) {
              return t.selected;
            }));
          }
          $q.all([
            api.plan.UserGroup.query(),
            api.plan.TaskFlow.getRoleByFlowId(item.TaskFlowId)
          ]).then(function(res){
            vm.nextUserGroups = res[0].data.Items;
            var users = res[1].data.Items;
            if(!users.length) return;
            users&&users.forEach(function(r){
              var f = vm.nextUserGroups&&vm.nextUserGroups.find(function(_r){
                  return _r.GroupID == r.RoleId;
                })
              if(f&& r.NotificationType == vm.type){
                f.selected = true;
              }
            })
          })
        }],
        controllerAs: 'vm',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function(back){
        var users ={
          roleIds:[]
        };
        var datas = back;
        datas&&datas.forEach(function(r){
          users.roleIds.push(r.GroupID)
        })
        api.plan.TaskFlow.resetTaskFlowRolesByType(item.TaskFlowId,type,users.roleIds).then(function(r){
          item['Notice'+type] = back.length ?
            (back.length > 1 ? back.length + '角色' : back[0].GroupName) : undefined;
          return vm.updateFlow(item);
        })
      })
    }
    //获取所有角色
    //api.plan.UserGroup.query().then(function(r){
    //  vm.nextUserGroup = r.data.Items;
    //})
    vm.stop = function(ev){
      ev.stopPropagation();
    }
    vm.saveUserGroup = function (flow,type) {
      var users ={
        roleIds:[]
      };
      var datas = flow['saveNotice'+type];
      datas&&datas.forEach(function(r){
        users.roleIds.push(r)
      })
      api.plan.TaskFlow.resetTaskFlowRolesByType(flow.TaskFlowId,type,users.roleIds).then(function(r){
        flow['saveNotice'+type] = datas;
        return vm.updateFlow(flow);
      })
    }

    function loadData(){
      api.plan.procedure.query().then(function(r){
        vm.procedures = r.data;
      })
      api.plan.MeasureInfo.query().then(function(r){
        vm.measureInfo = r.data;
      })
      api.plan.TaskLibrary.GetList({Skip:0,Limit:10000,Level:1}).then(function (r) {
        vm.subTasks = r.data.Items||[];
      });
    }

    vm.setMeasureInfo = function(flow){
      return $mdDialog.show({
        controller:['$scope','pdata','mdata','data','subtasks',function($scope,pdata,mdata,data,subtasks){
          var vm = this;
          vm.data = data;
          vm.current = null;
          vm.gxName = '';
          vm.proceduresData = pdata;
          vm.measureData = mdata;
          vm.subTasks = subtasks;
          // setVaule();
          //function setVaule(){
          //  var f = vm.measureData.find(function(_r){
          //    return _r.AcceptanceItemID == vm.data.CloseRelatedObjectId;
          //  })
          //  var h = vm.subTasks.find(function(r){
          //    return r.TaskLibraryId =vm.data.RelatedTaskId;
          //  })
          //  vm.proceduresData.forEach(function(_r){
          //    _r.SpecialtyChildren.forEach(function(_rr){
          //      var g=_rr.WPAcceptanceList && _rr.WPAcceptanceList.find(function(t){
          //        return t.AcceptanceItemID ==  vm.data.CloseRelatedObjectId;
          //      })
          //      if(g){
          //        vm.current = g;
          //        vm.gxName = flow.MeasureInfo;
          //      }
          //    })
          //  })
          //  if(f){
          //    vm.current = f;
          //  }else if(h){
          //    vm.current =  h;
          //  }
          //
          //}
          vm.stop = function(ev){
            ev.stopPropagation();
          }
          vm.choose = function(item){
            vm.current = item;
            vm.data.CloseRelatedObjectId = item.AcceptanceItemID;
            vm.gxName = item.AcceptanceItemName;
            flow.MeasureInfo = item.AcceptanceItemName;
          }
          vm.select = function(index){
            switch (index){
              case 0:
                vm.data.CloseRelatedObjectType = null;
                vm.data.CloseRelatedObjectId =  null;
                vm.data.RelatedTaskId  = vm.relatedTask.TaskLibraryId;
                flow.MeasureInfo = vm.relatedTask.Name;
                break;
              case 1:
                vm.data.CloseRelatedObjectType = 'PQMeasure';
                vm.data.CloseRelatedObjectId = vm.CloseRelatedObjectId.AcceptanceItemID;
                flow.MeasureInfo = vm.CloseRelatedObjectId.MeasureItemName;
                break;
              case 2:
                vm.data.CloseRelatedObjectType = 'Inspection';
                break;
            }
            $mdDialog.hide(vm.data);
          }
        }],
        controllerAs:'vm',
        templateUrl:'app/main/plan/component/plan-task-measureinfo.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true,
        locals:{
          pdata:vm.procedures && vm.procedures,
          mdata:vm.measureInfo && vm.measureInfo,
          data:vm.data && vm.data,
          subtasks:vm.subTasks&&vm.subTasks
        }
      }).then(function(data){
        api.plan.TaskLibrary.update(data).then(function (r) {
          return vm.updateFlow(flow);
        });
      })
    }
    vm.ClickSaveleft = function(data){
      data.Type = data.Type || data.oType;
      if(id=='add'){
        api.plan.TaskLibrary.create(data).then(function (r) {
          $state.go('app.plan.task.list');
        });
      }else{
        api.plan.TaskLibrary.update(data).then(function (r) {
          //$state.go('app.plan.task.list');
          if(r.status == 200){
            utils.alert('保存成功！');
          }
        });
      }

    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/11/21.
 */
(function(){
  'use strict';

  planReportController.$inject = ["api"];
  angular
    .module('app.plan')
    .component('planReport',{
      templateUrl:'app/main/plan/component/plan-report.html',
      controller:planReportController,
      controllerAs:'vm'
    });

  /**@ngInject*/
  function planReportController(api){
    var vm = this;
    vm.reportTime=new Date();
    function setChina(r){
      var str='';
      switch (r){
        case 0:
          str='提前完成';
          break;
        case 1:
          str='正常完成';
          break;
        case 2:
          str='轻度延期';
          break;
        case 3:
          str='中度延期';
          break;
        case 4:
          str='重度延期';
          break;
        case 5:
          str='严重延期';
          break;
        case 6:
          str='';
          break;
        default:
          str='无状态';
          break;
      }
      return str;
    }
    api.plan.BuildPlan.statisticsReport().then(function(r){
      r.data.CompanyStatisticss&&r.data.CompanyStatisticss.forEach(function(c){
        c.ProjectStatisticss&&c.ProjectStatisticss.forEach(function(_c){
          _c.SectionStatisticss&&_c.SectionStatisticss.forEach(function(_p){
            _p.TaskStatisticss&&_p.TaskStatisticss.forEach(function(t){
              t.statusName = setChina(t.CompleteStatus)
            })
          })
        })
      })
      //r.data.forEach(function(re){
      //  // re.statusName = setChina(re.CompleteStatus)
      //})
      vm.data= r.data;
      console.log(vm.data)
    })


    //vm.data = {
    //  "CompanyStatisticss": [
    //    {
    //      "CompanyId": "1",
    //      "CompanyName": "星河",
    //      "ProjectStatisticss": [
    //        {
    //          "ProjectId": "101",
    //          "ProjectName": "星河一期",
    //          "SectionStatisticss": [
    //            {
    //              "SectionId": "10101",
    //              "SectionName": "一标",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "10101",
    //                  "BuildingId": "10101",
    //                  "BuildName": "10101",
    //                  "TaskId": "10101",
    //                  "TaskName": "一标task1",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "10101",
    //                  "NextTaskName": "10101",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "10101",
    //                  "BuildingId": "10103",
    //                  "BuildName": "10103",
    //                  "TaskId": "10103",
    //                  "TaskName": "一标task2",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "10103",
    //                  "NextTaskName": "10103",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            },{
    //              "SectionId": "10201",
    //              "SectionName": "二标",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "10201",
    //                  "BuildingId": "10201",
    //                  "BuildName": "10201",
    //                  "TaskId": "10201",
    //                  "TaskName": "10201",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "10201",
    //                  "NextTaskName": "10201",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "10201",
    //                  "BuildingId": "10203",
    //                  "BuildName": "10203",
    //                  "TaskId": "10203",
    //                  "TaskName": "10203",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "10203",
    //                  "NextTaskName": "10203",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            }
    //          ]
    //        },{
    //          "ProjectId": "201",
    //          "ProjectName": "星河二期",
    //          "SectionStatisticss": [
    //            {
    //              "SectionId": "20101",
    //              "SectionName": "20101",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20101",
    //                  "BuildName": "20101",
    //                  "TaskId": "20101",
    //                  "TaskName": "20101",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20101",
    //                  "NextTaskName": "20101",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20103",
    //                  "BuildName": "20103",
    //                  "TaskId": "20103",
    //                  "TaskName": "20103",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20103",
    //                  "NextTaskName": "20103",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            },{
    //              "SectionId": "20201",
    //              "SectionName": "20201",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20201",
    //                  "BuildName": "20201",
    //                  "TaskId": "20201",
    //                  "TaskName": "20201",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20201",
    //                  "NextTaskName": "20201",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20203",
    //                  "BuildName": "20203",
    //                  "TaskId": "20203",
    //                  "TaskName": "20203",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20203",
    //                  "NextTaskName": "20203",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            }
    //          ]
    //        }
    //      ],
    //      "StatisticsResult": {
    //        "TotalTaskNumber": 1,
    //        "AdvanceCompleteNumber": 2,
    //        "NormalCompleteNumber": 3,
    //        "LightDelayNumber": 4,
    //        "ModerateDelayNumber": 5,
    //        "HightDelayNumber": 6,
    //        "SeriousDelayNumber": 7,
    //        "AdvanceCompletePercent": 10,
    //        "NormalCompletePercent": 10,
    //        "LightDelayPercent": 10,
    //        "ModerateDelayPercent": 10,
    //        "HightDelayPercent": 10,
    //        "SeriousDelayPercent": 10
    //      }
    //    },
    //    {
    //      "CompanyId": "2",
    //      "CompanyName": "万科",
    //      "ProjectStatisticss": [
    //        {
    //          "ProjectId": "201",
    //          "ProjectName": "201",
    //          "SectionStatisticss": [
    //            {
    //              "SectionId": "20101",
    //              "SectionName": "20101",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20101",
    //                  "BuildName": "20101",
    //                  "TaskId": "20101",
    //                  "TaskName": "20101",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20101",
    //                  "NextTaskName": "20101",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20103",
    //                  "BuildName": "20103",
    //                  "TaskId": "20103",
    //                  "TaskName": "20103",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20103",
    //                  "NextTaskName": "20103",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            },{
    //              "SectionId": "20201",
    //              "SectionName": "20201",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20201",
    //                  "BuildName": "20201",
    //                  "TaskId": "20201",
    //                  "TaskName": "20201",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20201",
    //                  "NextTaskName": "20201",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20203",
    //                  "BuildName": "20203",
    //                  "TaskId": "20203",
    //                  "TaskName": "20203",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20203",
    //                  "NextTaskName": "20203",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            }
    //          ]
    //        },{
    //          "ProjectId": "201",
    //          "ProjectName": "201",
    //          "SectionStatisticss": [
    //            {
    //              "SectionId": "20101",
    //              "SectionName": "20101",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20101",
    //                  "BuildName": "20101",
    //                  "TaskId": "20101",
    //                  "TaskName": "20101",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20101",
    //                  "NextTaskName": "20101",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20101",
    //                  "BuildingId": "20103",
    //                  "BuildName": "20103",
    //                  "TaskId": "20103",
    //                  "TaskName": "20103",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20103",
    //                  "NextTaskName": "20103",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            },{
    //              "SectionId": "20201",
    //              "SectionName": "20201",
    //              "TaskStatisticss": [
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20201",
    //                  "BuildName": "20201",
    //                  "TaskId": "20201",
    //                  "TaskName": "20201",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20201",
    //                  "NextTaskName": "20201",
    //                  "NextTaskDuration": 0
    //                },
    //                {
    //                  "SectionID": "20201",
    //                  "BuildingId": "20203",
    //                  "BuildName": "20203",
    //                  "TaskId": "20203",
    //                  "TaskName": "20203",
    //                  "ScheduledEndTime": "2016-11-21T07:37:52.594Z",
    //                  "ActualEndTime": "2016-11-21T07:37:52.594Z",
    //                  "CompleteStatus": "AdvanceComplete",
    //                  "DelayDays": 0,
    //                  "NextTaskId": "20203",
    //                  "NextTaskName": "20203",
    //                  "NextTaskDuration": 0
    //                }
    //              ]
    //            }
    //          ]
    //        }
    //      ],
    //      "StatisticsResult": {
    //        "TotalTaskNumber": 20,
    //        "AdvanceCompleteNumber": 20,
    //        "NormalCompleteNumber": 20,
    //        "LightDelayNumber": 20,
    //        "ModerateDelayNumber": 20,
    //        "HightDelayNumber": 20,
    //        "SeriousDelayNumber": 20,
    //        "AdvanceCompletePercent": 15,
    //        "NormalCompletePercent": 20,
    //        "LightDelayPercent": 15,
    //        "ModerateDelayPercent": 20,
    //        "HightDelayPercent": 20,
    //        "SeriousDelayPercent": 20
    //      }
    //    }
    //  ],
    //  "StatisticsResult": {
    //    "TotalTaskNumber": 40,
    //    "AdvanceCompleteNumber": 40,
    //    "NormalCompleteNumber": 40,
    //    "LightDelayNumber": 40,
    //    "ModerateDelayNumber": 40,
    //    "HightDelayNumber": 40,
    //    "SeriousDelayNumber": 40,
    //    "AdvanceCompletePercent": 10,
    //    "NormalCompletePercent": 10,
    //    "LightDelayPercent": 20,
    //    "ModerateDelayPercent": 20,
    //    "HightDelayPercent": 20,
    //    "SeriousDelayPercent": 20
    //  }
    //}
  }
})();

/**
 * Created by emma on 2016/11/11.
 */
(function(angular,undefined){
  'use strict';

  personPlanController.$inject = ["$scope", "$rootScope", "$mdToast", "moment", "api", "$mdDialog", "$timeout", "utils", "xhUtils", "sxt"];
  angular
    .module('app.plan')
    .component('planPersonplan',{
      templateUrl:'app/main/plan/component/plan-personplan.html',
      controller:personPlanController,
      controllerAs:'vm',
      sendBt: true,
    });

  /**@ngInject*/
  function personPlanController($scope,$rootScope,$mdToast,moment,api,$mdDialog,$timeout,utils,xhUtils,sxt){
    var vm = this;
    load();
    function load() {
      var now = moment(new Date().toISOString().substring(0,10)).toDate();
      vm.tasksList = [];
      api.plan.BuildPlan.personPlans().then(function (res) {
        vm.tdata = res.data;
        vm.tdata.forEach(function (_r) {
          _r.showNoPlan = _r.NoPlanTasks.length ? true : false;
          _r.PlaningTasks.forEach(function (r) {
            r.parentId=_r.Id;
            r.sdate = r.ActualStartTime && moment(r.ActualStartTime.substring(0, 10)).toDate() || r.ScheduledStartTime && moment(r.ScheduledStartTime.substring(0, 10)).toDate();
            r.edate = r.ActualEndTime && moment(r.ActualEndTime.substring(0, 10)).toDate() || r.ScheduledEndTime && moment(r.ScheduledEndTime.substring(0, 10)).toDate();
          })
          _r.NoPlanTasks.forEach(function (r) {
            r.parentId=_r.Id;
            r.sdate = r.ActualStartTime && moment(r.ActualStartTime.substring(0, 10)).toDate() || r.ScheduledStartTime && moment(r.ScheduledStartTime.substring(0, 10)).toDate();
            r.edate = r.ActualEndTime && moment(r.ActualEndTime.substring(0, 10)).toDate() || r.ScheduledEndTime && moment(r.ScheduledEndTime.substring(0, 10)).toDate();
          })
        })
        vm.data = vm.tdata;
        vm.data && vm.data.forEach(function (_r) {
          var temp = {
            Name: _r.Name
          };
          temp.tasks = _r.PlaningTasks.filter(function (r) {
            return (r.edate && (r.sdate <= now && r.edate >= now)) || (!r.edate && r.sdate <= now);
          })
          vm.tasksList.push(temp);
        })
        vm.tasksList.forEach(function(task){
          task.tasks.forEach(function(_task){
            _task.showBtn = true;
          })
        })
      })
    }
    $scope.$watch('vm.data',function(){
      if(vm.data){
        $scope.onlyWeekendsPredicate = function(date){
          for(var j=0;j<vm.data.length;j++){
            for(var i=0;i<vm.data[j].PlaningTasks.length;i++){
              if(vm.data[j].PlaningTasks[i].edate&&vm.data[j].PlaningTasks[i].sdate <= date && vm.data[j].PlaningTasks[i].edate >= date||
              !vm.data[j].PlaningTasks[i].edate&&vm.data[j].PlaningTasks[i].sdate <= date){
                return true;
              }
            }
          }
        }
        vm.loading = true;
        $timeout(function(){
          vm.myDate = new Date();
        },500)
        //vm.myDate = new Date();
      }
    },true);
    //$scope.$watch('vm.myDate',function(){
    //  if(!vm.myDate){
    //    vm.myDate = new Date();
    //    $timeout(function(){
    //      vm.myDate = new Date();
    //    },800)
    //  }
    //})
    $rootScope.$on('md-calendar-change', function(event,data) {
      vm.tasksList = [];
      vm.data && vm.data.forEach(function (_r) {
        var temp ={
          Name:_r.Name
        };
         temp.tasks = _r.PlaningTasks.filter(function (r) {
           return r.edate&&(r.sdate <=data && r.edate>=data)||!r.edate&& r.sdate<=data;
        })
        vm.tasksList.push(temp)
      });
      console.log(vm.tasksList)
    })
    vm.showTaskD = function(t){
        api.plan.fileService.get(t.UploadPhotoFileId).then(function(r){
          if(r.data.Base64){
            t.images=[{
              url:r.data.Base64,
              alt:task.EndDescription||''
            }]
            xhUtils.playPhoto(t.images)
          }else if(t.EndDescription){
            var msg = '反馈信息:'+task.EndDescription+'，无图片';
            utils.alert(msg)
          }else{
            utils.alert('无图片,无反馈信息')
            //$mdToast.show(
            //  $mdToast.simple()
            //    .textContent(task.EndDescription)
            //    .position('top')
            //    .hideDelay(3000)
            //);
          }

        })
    }
    vm.startTask = function(t){
      var time = new Date();
      api.plan.BuildPlan.startInsert(t.parentId, t.Id,time).then(function(r){
        //t.IsAbleStart = false;
        vm.loading = false;
        load();
        //vm.data.forEach(function(tt){
        //  tt.PlaningTasks.forEach(function(_t){
        //    var f = r.data.find(function(_r){
        //      return _r.Id == _t.Id;
        //    })
        //    if(f){
        //      t.IsAbleStart = f.IsAbleStart;
        //      t.IsInterlude = f.IsInterlude;
        //      t.ManuallyClose = f.ManuallyClose;
        //      t.IsRelatedObject = f.IsRelatedObject;
        //    }
        //  })
        //  tt.NoPlanTasks.forEach(function(_t){
        //    var f = r.data.find(function(_r){
        //      return _r.Id == _t.Id;
        //    })
        //    if(f){
        //      t.IsAbleStart = f.IsAbleStart;
        //      t.IsInterlude = f.IsInterlude;
        //      t.ManuallyClose = f.ManuallyClose;
        //      t.IsRelatedObject = f.IsRelatedObject;
        //    }
        //  })
        //})
      },function(err){
        utils.alert(err.data||'错误');
      })
    }
    vm.start = function(t){
      var time = new Date();
      api.plan.Task.start(t.Id,true,time).then(function(r){
        vm.data.forEach(function(tt){
          tt.PlaningTasks.forEach(function(_t){
            var f = r.data.find(function(_r){
              return _r.Id == _t.Id;
            })
            if(f){
              t.State = f.State;
            }
          })
          tt.NoPlanTasks.forEach(function(_t){
            var f = r.data.find(function(_r){
              return _r.Id == _t.Id;
            })
            if(f){
              t.State = f.State;
            }
          })
        })

      })
    }
    vm.end = function(t){
      xhUtils.photo().then(function (image) {
        if(image){
          var time = new Date();
          $mdDialog.show({
            templateUrl:'app/main/plan/component/plan-task-close.html',
            controller:['$scope',function($scope){
              $scope.img=[{ImageByte:image}];
              $scope.close = function(description){
                $scope.data ={
                  description:description,
                  PhotoFileName:sxt.uuid()+'.jpg',
                  PhotoFile:$scope.img[0].ImageByte
                }
                $mdDialog.hide($scope.data)
              }
              $scope.cancel = function(){
                $mdDialog.cancel()
              }
              var deleteFn = function(d,data){
                //console.log(data)
                $scope.img.splice(data,1);
                if(!$scope.img.length){
                  $mdDialog.cancel()
                }
                //$scope.$apply();
              }
              $rootScope.$on('delete',deleteFn);
            }],
            parent: angular.element(document.body),
            clickOutsideToClose:true,
          }
            //$mdDialog.prompt()
            //  .title('确认关闭')
            //  .textContent('关闭原因')
            //  .placeholder('输入')
            //  .ok('确定')
            //  .cancel('取消')
          ).then(function(res){
            t.IsInterlude = false;
            var data = angular.extend({
              TaskId: t.Id
            },res)
            api.plan.BuildPlan.endTask(t.parentId,data).then(function (r){
              vm.loading = false;
               load();
             })
            //api.plan.Task.end(t.Id,true,time,res.description,res.img,res.PhotoFileName).then(function(r){
            //  vm.loading = false;
            //  load();
            //  //vm.data.forEach(function(tt){
            //  //  tt.PlaningTasks.forEach(function(_t){
            //  //    var f = r.data.find(function(_r){
            //  //      return _r.Id == _t.Id;
            //  //    })
            //  //    if(f){
            //  //      t.State = f.State;
            //  //    }
            //  //  })
            //  //  tt.NoPlanTasks.forEach(function(_t){
            //  //    var f = r.data.find(function(_r){
            //  //      return _r.Id == _t.Id;
            //  //    })
            //  //    if(f){
            //  //      t.State = f.State;
            //  //    }
            //  //  })
            //  //})
            //},function(err){
            //  utils.alert(err.data||'错误');
            //})
          },function(){
            console.log('cancel')
          })
          //var img = {
          //  ProblemRecordFileID:sxt.uuid(),
          //  FileID:sxt.uuid()+".jpg",
          //  ProblemRecordID:scope.data.p.ProblemRecordID,
          //  CheckpointID:scope.data.v.CheckpointID,
          //  FileContent:image
          //};
          //remote.Procedure.InspectionProblemRecordFile.create(img);
          //scope.data.images.push(img);

        }
      });


    }
  }
})(angular,undefined);

/**
 * Created by emma on 2016/11/8.
 */
(function(angular,undefined){
  'use strict';

  planMilestoneController.$inject = ["$stateParams", "api", "$rootScope", "$mdDialog", "utils"];
  angular
    .module('app.plan')
    .component('planMilestone',{
      templateUrl:'app/main/plan/component/plan-milestone.html',
      controller:planMilestoneController,
      controllerAs:'vm'
    })

  /**@ngInject*/
  function planMilestoneController($stateParams,api,$rootScope,$mdDialog,utils){
    var vm = this;
    vm.current = null;
    vm.tempid= $stateParams.id;
    vm.load = load;
    load();
    function load(){
      api.plan.BuildPlan.getMileStone(vm.tempid).then(function(r){
        r.data.forEach(function(_r){
          _r.setTime = new Date(_r.MilestoneTime);
        })
        vm.data = r.data;
      });
    }

    api.plan.BuildPlan.mainProcess(vm.tempid).then(function(r){
      vm.mainProcess = r.data;
    });
    vm.select = function(item){
     // console.log('sel',item)
      if(!item.edit) return;
      vm.current = item;
    }
    vm.edit = function(item){
      vm.data.forEach(function(r){
        r.edit = false;
      })
      item.edit = true;
    }
    //vm.edit = function(item){
    //  //item.edit = true;
    //  $mdDialog.show({
    //    templateUrl:'app/main/plan/component/plan-milestone-settime.html',
    //    controller:['$scope',function($scope){
    //      $scope.item = item;
    //      console.log(item)
    //      $scope.cancel = function(){
    //        $mdDialog.cancel()
    //      }
    //      $scope.answer = function(){
    //        $mdDialog.hide($scope.item)
    //      }
    //    }]
    //  }).then(function(res){
    //    console.log('res',res)
    //  })
    //}
    vm.enter=false;
    if($rootScope.$$listeners["md-calendar-change"]){
      $rootScope.$$listeners["md-calendar-change"] = [];
     }
    $rootScope.$on('md-calendar-change', function(event,data) {
      //if(vm.enter) return;
      //vm.enter = true;
      if(!data) return;
      api.plan.BuildPlan.setMileStoneTime($stateParams.id,vm.current.Id,vm.current.setTime).then(function(r){
        //
        if(r.data.State == 1){
          utils.alert('没有未完成任务')
        }else if(r.data.State == 2){
          utils.alert('没有有效工期')
        }else if(r.data.State == 3){
          utils.alert('压缩工期大于当前总工期')
        }else if(r.data.State == 0){
          var data = {
            "Id": vm.current.Id,
            "Name": vm.current.Name,
            "MilestoneTime": vm.current.setTime
          }
          if(r.data.SurplusRatio == 100){
            api.plan.BuildPlan.updateMileStone($stateParams.id,vm.current.Id,data).then(function(r){
              utils.alert('更改成功').then(function(){
                load();
              });
            })
          }else if(r.data.SurplusRatio >=80 && r.data.SurplusRatio <100){
            var msg1 = '现今至'+vm.current.Name+'剩余工作量仅为标准工期的'+r.data.SurplusRatio+'%，可能会影响质量与进度';
            utils.confirm(msg1,null).then(function(rs){
              console.log('ok')
              api.plan.BuildPlan.updateMileStone($stateParams.id,vm.current.Id,data).then(function(r){

                utils.alert('更改成功').then(function(){
                  load();
                });
              })
            },function(){
              console.log('cancel')
              vm.current.setTime = new Date(vm.current.MilestoneTime);
            })
          }else{
            var msg = '现今至'+vm.current.Name+'剩余工作量仅为标准工期的'+r.data.SurplusRatio+'%，会严重影响质量与进度'
            utils.confirm(msg,null).then(function(rs){
              console.log('ok')
              api.plan.BuildPlan.updateMileStone($stateParams.id,vm.current.Id,data).then(function(r){
                utils.alert('更改成功').then(function(){
                  load();
                });
              })
            },function(){
              vm.current.setTime = new Date(vm.current.MilestoneTime);
              console.log('cancel')
            })
          }
        }
      })
      //console.log(event,data,vm.current)
    })
  }
})(angular,undefined);

/**
 * Created by emma on 2016/9/27.
 */
(function(){
  'use strict';

  planGanttlist.$inject = ["$scope", "$state", "api", "utils"];
  angular
    .module('app.plan')
    .component('planGanttlist',{
      templateUrl:'app/main/plan/component/plan-ganttlist.html',
      controller:planGanttlist,
      controllerAs:'vm'
    });

  /**@ngInject*/
  function  planGanttlist($scope,$state,api,utils){
    var vm = this;
    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    };
    vm.pageAction = function(title, page, pageSize, total){
      $scope.pageing.page = page;
    }
    $scope.$watch("pageing",function(){
      load();
    },true);
    function load(){
      var page= utils.getPage($scope.pageing);
      api.plan.BuildPlan.getList({status:'Generated',Skip:page.Skip,Limit:page.Limit}).then(function(r){
        vm.items = r.data.Items;
        $scope.pageing.total = r.data.TotalCount;
      });
    }
    //load();
    vm.Delete = function(item){
      utils.confirm('确定删除',null).then(function(){
        api.plan.BuildPlan.deleteBuildPlan(item.Id).then(function(r){
          utils.alert('删除成功').then(function(){
            load();
          })
        },function(err){
          utils.alert(err.data||'删除失败')
        })
      })

    }
    vm.openJzx = function(item){
      utils.confirm('确定开启精装修',null).then(function(){
        api.plan.BuildPlan.startRenovation(item.Id).then(function(r){
          utils.alert('开启精装修成功').then(function(){
            load();
          },function(err){
            utils.alert(err.data||'开启精装修失败')
          })
        })
      })
    }
  }
})();

/**
 * Created by UUI on 2016/9/27.
 */
(function(angular,undefined){
  'use strict';

  plangantt.$inject = ["$mdDialog", "$document", "$rootScope", "$mdToast", "$animate", "$scope", "$timeout", "utils", "ganttUtils", "$mdPanel", "GanttObjectModel", "ganttDebounce", "moment", "$window", "$mdSidenav", "api", "$stateParams", "$q", "xhUtils"];
  angular
    .module('app.plan')
    .component('planGantt',{
      templateUrl:'app/main/plan/component/plan-gantt.html',
      controller:plangantt,
      controllerAs:'vm'
    });

  /** @ngInject */
  function plangantt($mdDialog, $document,$rootScope,$mdToast, $animate, $scope, $timeout,utils, ganttUtils,$mdPanel, GanttObjectModel, ganttDebounce, moment, $window, $mdSidenav,api,$stateParams,$q,xhUtils){
    GanttChartAddEditDialogController.$inject = ["dialogData", "originData", "template", "$timeout", "$mdPanel", "$scope"];
    var vm = this;
    var objectModel;
    vm.isStarted = true;
    /*loading界面*/
    $mdDialog.show({
      controller:['$scope',function($scope){
        $scope.hide = function(){
          $mdDialog.cancel();
        }
      }],
      template: '<md-dialog style="background-color: transparent;box-shadow: none;"><md-dialog-content ><div layout="row" layout-align="center center"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div><div layout="row" layout-align="center center">正在生成，请稍后...</div></md-dialog-content></md-dialog>',
      parent: angular.element('#content'),
      clickOutsideToClose:false,
      hasBackdrop:true,
      escapeToClose: true,
      focusOnOpen: true
    })
    //$scope.$on('$destroy',function(){
    //  $scope.hide();
    //})
    //$scope.$watch('vm.gantt',function(){
    //  $mdDialog.hide();
    //})
    // Data
    vm.live = {};
    /*gantt配置*/
    vm.options = {
      mode                    : 'custom',
      scale                   : 'year',
      sortMode                : undefined,
      sideMode                : 'TreeTable',
      daily                   : false,
      maxHeight               : 300,
      width                   : true,
      zoom                    : 1,
      rowSortable             : false,
      columns                 : ['model.name', 'from', 'to','realFrom','realTo','duration'],
      treeTableColumns        : ['from', 'to','realFrom','realTo','duration'],
      columnsHeaders          : {
        'model.name': 'Name',
        'from'      : '计划开始',
        'to'        : '计划结束',
        'realFrom':'实时开始',
        'realTo':'实时结束',
        'duration'  :'工期'
      },
      columnsClasses          : {
        'model.name': 'gantt-column-name',
        'from'      : 'gantt-column-from',
        'to'        : 'gantt-column-to',
        'realFrom'      : 'gantt-column-from',
        'realTo'        : 'gantt-column-to',
        'duration'  : 'gantt-column-duration'
      },
      columnsFormatters       : {
        'from': function (from)
        {
          return angular.isDefined(from) ? from.format('YY-MM-DD') : undefined;
        },
        'to'  : function (to)
        {
          return angular.isDefined(to) ? to.format('YY-MM-DD') : undefined;
        },
        'realFrom': function (realFrom)
        {
          return angular.isDefined(realFrom) ? realFrom.format('YY-MM-DD') : undefined;
        },
        'realTo'  : function (realTo)
        {
          return angular.isDefined(realTo) ? realTo.format('YY-MM-DD') : undefined;
        },
        'duration':function(duration){
          return duration;
        }
      },
      treeHeaderContent       : '{{getHeader()}}',
      treeHeader:'计划',
      columnsHeaderContents   : {
        'model.name': '{{getHeader()}}',
        'from'      : '{{getHeader()}}',
        'to'        : '{{getHeader()}}',
        'realFrom':'{{getHeader()}}',
        'realTo':'{{getHeader()}}',
        'duration'        : '{{getHeader()}}'
      },
      autoExpand              : 'none',
      taskOutOfRange          : 'truncate',
      fromDate                : '',
      toDate                  : '',
      rowContentEnabled       : true,
      rowContent              : '{{row.model.name}}',
      taskContentEnabled      : true,
      taskContent             : '<span class="gantt-task-name" style="display: block;" flex ng-click="scope.vm.editDialog($event,task,task.model)">\n    {{task.model.name}}\n    <md-tooltip md-direction="top" class="gantt-chart-task-tooltip">\n        <div layout="column" layout-align="center center">\n            <div class="tooltip-name">\n                {{task.model.name}}\n            </div>\n            <div class="tooltip-date">\n                <span>\n                    {{task.model.from.format(\'MM月DD日A\')}}\n                </span>\n                <span>-</span>\n                <span>\n                    {{task.model.to.format(\'MM月DD日A\')}}\n                </span>\n            </div>\n        </div>\n    </md-tooltip>\n</span>',
      allowSideResizing       : true,
      labelsEnabled           : true,
      currentDate             : 'line',
      currentDateValue        : new Date(),
      draw                    : true,
      readOnly                : false,
      groupDisplayMode        : 'group',
      filterTask              : '',
      filterRow               : '',
      timeFrames              : {
        'day'    : {
          start  : moment('8:00', 'HH:mm'),
          end    : moment('20:00', 'HH:mm'),
          working: true,
          default: true
        },
        'noon'   : {
          start  : moment('12:00', 'HH:mm'),
          end    : moment('13:30', 'HH:mm'),
          working: true,
          default: true
        },
        'weekend': {
          working: true
        },
        'holiday': {
          working: false,
          color  : 'red',
          classes: ['gantt-timeframe-holiday']
        }
      },
      dateFrames              : {
        'weekend'    : {
          evaluator: function (date)
          {
            return date.isoWeekday() === 6 || date.isoWeekday() === 7;
          },
          targets  : ['weekend']
        },
        '11-november': {
          evaluator: function (date)
          {
            return date.month() === 10 && date.date() === 11;
          },
          //targets  : ['holiday']
        }
      },
      timeFramesWorkingMode   : 'hidden',
      timeFramesNonWorkingMode: 'visible',
      columnMagnet            : '15 minutes',
      timeFramesMagnet        : false,
      dependencies            : true,
      canDraw                 : function (event)
      {
        var isLeftMouseButton = event.button === 0 || event.button === 1;
        return vm.options.draw && !vm.options.readOnly && isLeftMouseButton;
      },
      drawTaskFactory         : function ()
      {
        return {
          id   : ganttUtils.randomUuid(),  // Unique id of the task.
          name : 'Drawn task', // Name shown on top of each task.
          color: '#AA8833' // Color of the task in HEX format (Optional).
        };
      },
      api                     : function (ganttApi)
      {
        vm.api = ganttApi;

        vm.api.core.on.ready($scope, function ()
        {
          vm.load().then(function(){
            $timeout(function(){
              $mdDialog.hide();
              //vm.ganttHeight =$('.gantt').height()
              //console.log($('.gantt').height())
              vm.api.tree.collapseAll()
            })
          });
          vm.winWidth = $($window).width();

          //console.log($($window).width())
          objectModel = new GanttObjectModel(vm.api);
          if(vm.winWidth < 610){
            vm.api.side.setWidth(150);
          }else{
            vm.api.side.setWidth(640);//450
          }


          vm.api.directives.on.new($scope, function (directiveName, directiveScope, element)
          {
            /**
             * Gantt Task
             */
            if ( directiveName === 'ganttTask' )
            {
            }

            /**
             * Gantt Row
             */
            else if ( directiveName === 'ganttRow' )
            {

            }

            /**
             * Gantt Row Label
             */
            else if ( directiveName === 'ganttRowLabel' )
            {
              // Fix for double trigger due to gantt-sortable plugin
              element.off('click');

              element.on('click', function (event)
              {
                event.preventDefault();
                if(directiveScope.row.model.tasks){
                  editDialog(event, 'row', directiveScope.row.model.tasks[0]);
                }
              });

              element.on('mousedown touchstart', function ()
              {
                vm.live.row = directiveScope.row.model;
                $scope.$digest();
              });

            }
          });
        });
      }
    };

    vm.canAutoWidth = canAutoWidth;
    vm.getColumnWidth = getColumnWidth;
    vm.load = load;
    vm.reload = reload;
    vm.editDialog = editDialog;
    //////////

    init();

    /**
     * Initialize
     */
    function init()
    {
      $timeout(function () {
        // Set Gantt Chart height at the init
        calculateHeight();
      },600)


      angular.element($window).on('resize', function ()
      {
        $scope.$apply(function ()
        {
          calculateHeight();
        });
      });
    }

    /**
     * Max Height Fix
     */
    function calculateHeight()
    {
      //vm.options.maxHeight = $document.find('#chart-container')[0].offsetHeight;
      var h = $(window).height()-115;
      vm.options.maxHeight = h;

    }
    function reload()
    {
       api.plan.BuildPlan.getGantt({
        Type:'BuildingPlan',
        Source:$stateParams.id
      }).then(function (rs) {
        vm.originData = rs.data;
        var mergedata = mergeFloor(rs.data.Items);
        vm.data = rs.data.Items.filter(function (item) {
          return !item.ExtendedParameters;
        }).map(function (item) {
          if (item.Description)
            angular.extend(item, angular.fromJson(item.Description));
          var result = {
            id: item.Id + '-group',
            name: item.Name,
            classes: [
              item.IsInterlude ? "md-light-blue-100-bg" : ""
            ],
            //parent:'__',
            tasks: [
              {
                id: item.Id,
                name: item.Name,
                isStarted: !!item.ActualStartTime,
                isEnded: !!item.ActualEndTime,
                from: item.ScheduledStartTime,
                to: item.ScheduledEndTime,
                realFrom: item.ActualStartTime || item.RealScheduledStartTime && item.RealScheduledStartTime,
                realTo: item.ActualEndTime || item.RealScheduledEndTime && item.RealScheduledEndTime,
                movable: true,
                classes: [
                  item.IsInterlude ? "md-light-blue-100-bg" : ""
                ],
                isType: item.Type,
                dependencies: item.Dependencies.map(function (d) {
                  return {
                    from: d.DependencyTaskID
                  }
                })
              }
            ]
          }
          /*          if(item.ExtendedParameters)
           {
           return angular.extend(result,{parent:item.ExtendedParameters+'-group'})
           }*/

          //result = mergedata.concat(result)
          return result;
        });
        mergedata.forEach(function (r) {
          var f = vm.data.find(function (_r) {
            return _r.id == r.id + '-group'
          })
          if (f) {
            var idx = vm.data.indexOf(f);
            if (idx > -1) {
              vm.data.splice(idx, 0, r);
            }
          }
        })
         vm.options.maxHeight -=3;
      })
      //$animate.enabled(true);
      //$animate.enabled($document.find('#gantt'), false);
    }
    /**
     * Side Mode
     */
    $scope.$watch('vm.options.sideMode', function (newValue, oldValue)
    {
      if ( newValue !== oldValue )
      {
        vm.api.side.setWidth(undefined);

        $timeout(function ()
      {
        vm.api.columns.refresh();
      });
      }
    });

    function canAutoWidth(scale)
    {
      if ( scale.match(/.*?hour.*?/) || scale.match(/.*?minute.*?/) )
      {
        return false;
      }

      return true;
    }

    function getColumnWidth(widthEnabled, scale, zoom)
    {
      if ( !widthEnabled && vm.canAutoWidth(scale) )
      {
        return undefined;
      }

      if ( scale.match(/.*?week.*?/) )
      {
        return 150 * zoom;
      }

      if ( scale.match(/.*?month.*?/) )
      {
        return 300 * zoom;
      }

      if ( scale.match(/.*?quarter.*?/) )
      {
        return 500 * zoom;
      }

      if ( scale.match(/.*?year.*?/) )
      {
        return 800 * zoom;
      }

      return 40 * zoom;
    }
    //合并
    function mergeFloor(data){
      var array =[];
      data.forEach(function(r){
        if(!r.FloorType) return;
        var f = array.find(function(_r){
          return _r.FloorType == r.FloorType;
        })
        if(!f){
          var name = setName(r);
          array.push({
            name: name,
            Dependencies:r.Dependencies,
            id:r.Id,
            FloorType: r.FloorType,
            children:[r.Name]
          })
        }else{
          //var name = setName(r);
          f.children.push(r.Name)
        }
      })
      return array;
    }
    function setName(r){
      var str = '';
      switch (r.FloorType){
        case "1":
          str='预售前标准楼层';
          break;
        case "2":
          str='地下室';
              break;
        case "4":
          str='裙楼';
          break;
        case "8":
          str='转换层';
          break;
        case "9":
          str='预售后楼层';
          break;
      }
      return str;
    }
    // Reload data action
    function load()
    {
       return api.plan.BuildPlan.getGantt({
        Type:'BuildingPlan',
        Source:$stateParams.id
      }).then(function (rs) {
        vm.originData = rs.data;
        var mergedata = mergeFloor(rs.data.Items);
        vm.data = rs.data.Items.filter(function (item) {
          return !item.ExtendedParameters;
        }).map(function (item) {
          if(item.Description)
            angular.extend(item,angular.fromJson(item.Description));
          var result = {
            id:item.Id+'-group',
            name:item.Name,
            classes: [
              item.IsInterlude?"md-light-blue-100-bg":""
            ],
            //parent:'__',
            tasks:[
              {
                id:item.Id,
                name:item.Name,
                isStarted:!!item.ActualStartTime,
                isEnded:!!item.ActualEndTime,
                from:item.ScheduledStartTime,
                to:item.ScheduledEndTime,
                realFrom:item.ActualStartTime||item.RealScheduledStartTime&&item.RealScheduledStartTime,
                realTo:item.ActualEndTime||item.RealScheduledEndTime&&item.RealScheduledEndTime,
                movable:true,
                classes: [
                  item.IsInterlude?"md-light-blue-100-bg":""
                ],
                isType:item.Type,
                dependencies:item.Dependencies.map(function (d) {
                  return {
                    from:d.DependencyTaskID
                  }
                })
              }
            ]
          }
/*          if(item.ExtendedParameters)
          {
           return angular.extend(result,{parent:item.ExtendedParameters+'-group'})
          }*/

          //result = mergedata.concat(result)
          return result;
        });
         mergedata.forEach(function(r){
           var f = vm.data.find(function(_r){
             return _r.id == r.id+'-group'
           })
           if(f){
             var idx = vm.data.indexOf(f);
             if(idx>-1){
               vm.data.splice(idx,0,r);
             }
           }
         })
         console.log(vm.data)
       // vm.isStarted = vm.data[0].tasks[0].isStarted;
      })
      // Fix for Angular-gantt-chart issue
      $animate.enabled(true);
      $animate.enabled($document.find('#gantt'), false);
    }

    /**
     * Edit Dialog
     */
    function editDialog(ev, formView, formData)
    {
      //if(formData.isType !=0) return;
      $mdDialog.show({
        controller         : GanttChartAddEditDialogController,
        controllerAs       : 'vm',
        templateUrl        : 'app/main/plan/component/plan-gantt-flow.html',
        parent             : angular.element($document.body),
        //targetEvent        : ev,
        clickOutsideToClose: true,
        locals             : {
          dialogData: {
            formData  : formData
          },
          originData:vm.originData
        }
      }).then(function(load){
        if(1){
          vm.options.maxHeight +=3 ;
          vm.reload();
        }
      },function(){
        vm.options.maxHeight +=3 ;
        vm.reload();
      });
    }
    vm.needLoad = false;
    /** @ngInject */
    function GanttChartAddEditDialogController(dialogData,originData,template,$timeout,$mdPanel,$scope) {
      var vm = this;
      function setSatus(i){
        var str='';
        switch (i){
          case 1:
                str = '未启动';
                break;
          case 2:
                str='完成';
                break;
          case 4:
                str='开启';
                break;
          case 8:
                str='暂停';
                break;
        }
        return str;
      };
      function setColor(i){
        var clr='';
        switch (i){
          case 1:
            clr = '#ccc';
            break;
          case 2:
            clr='#000';
            break;
          case 4:
            clr='green';
            break;
          case 8:
            clr='暂停';
            break;
        }
        return clr;
      }
      loadSubTask();
      function loadSubTask(){
        api.plan.BuildPlan.getGantt({
          ParentTaskId:dialogData.formData.id,
          Type:'BuildingPlan',
          Source:$stateParams.id
        }).then(function(r){
          var task = {
            Master:r.data.Items.filter(function (t) {
              try{
                var desc = eval('('+t.Description+')');
                return desc.Type == 0;
              }catch (ex){
                return false;
              }
            }).map(function (item) {
              return {
                EndFlagTaskFlowId:eval('('+item.Description+')').EndFlagTaskId,
                ScheduledStartTime:item.ScheduledStartTime,
                ScheduledEndTime:item.ScheduledEndTime,
                ActualStartTime:item.ActualStartTime,
                ActualEndTime:item.ActualEndTime,
                RealScheduledStartTime:item.RealScheduledStartTime,
                RealScheduledEndTime:item.RealScheduledEndTime,
                IsAbleStart: item.IsAbleStart,
                IsInterlude: item.IsInterlude,
                ManuallyClose: item.ManuallyClose,
                IsRelatedObject:item.IsRelatedObject,
                State:item.State,
                Color:setColor(item.State),
                _State:setSatus(item.State),
                switch:item.State!=4?false:true,
                UploadPhotoFileId:item.UploadPhotoFileId,
                Flags:item.Flags,
                TaskFlowId:item.Id,
                ParentId:item.Dependencies[0]&&item.Dependencies[0].DependencyTaskID||null,
                Name:item.Name,
                Type:0
              }
            }),
            Branch:function(items) {
              var branchs = [];
              items.forEach(function (t) {
                try {
                  var desc = eval('('+t.Description+')');
                  if(desc.Type!=0) {
                    var array = branchs[desc.Type - 1];
                    if(!array){
                      array = [];
                      branchs[desc.Type - 1] = array;
                    }
                    array.push({
                      EndFlagTaskFlowId:eval('('+t.Description+')').EndFlagTaskId,
                      ScheduledStartTime:t.ScheduledStartTime,
                      ScheduledEndTime:t.ScheduledEndTime,
                      ActualStartTime:t.ActualStartTime,
                      ActualEndTime:t.ActualEndTime,
                      RealScheduledStartTime:t.RealScheduledStartTime,
                      RealScheduledEndTime:t.RealScheduledEndTime,
                      IsAbleStart: t.IsAbleStart,
                      IsInterlude: t.IsInterlude,
                      ManuallyClose: t.ManuallyClose,
                      IsRelatedObject: t.IsRelatedObject,
                      State: t.State,
                      Color:setColor(t.State),
                      _State:setSatus(t.State),
                      switch:t.State!=4?false:true,
                      UploadPhotoFileId:t.UploadPhotoFileId,
                      Flags:t.Flags,
                      TaskFlowId:t.Id,
                      ParentId:t.Dependencies[0]&&t.Dependencies[0].DependencyTaskID||null,
                      Name:t.Name,
                      Type:desc.Type
                    });
                  }
                } catch (ex) {
                  return false;
                }
              });
              return branchs;
            }(r.data.Items),
            Name:'流程'
          };
          vm.data = task;
          vm.onLoadTemplate();
        })
      }
      /*开启穿插*/
      vm.startTask = function(task){
        var time = new Date();
        api.plan.BuildPlan.startInsert($stateParams.id,task.TaskFlowId,time).then(function(r){
          vm.needLoad = true;
          loadSubTask();
        },function(err){
          utils.alert(err.data||'错误');
        })
      }
      vm.openTask = function(task){
        var time = new Date();
        api.plan.Task.start(task.TaskFlowId,true,time).then(function (r) {
          //r.data.forEach(function(_r){
          //  var f=vm.flows.find(function(t){
          //    return t.TaskFlowId == _r.Id;
          //  })
          //  if(f){
          //    f.ActualStartTime = _r.ActualStartTime;
          //    f._State=setSatus(_r.State);
          //    f.State = _r.State;
          //  }
          //})
          loadSubTask();
        });
      }
      //详情
      vm.showTaskD = function(task){
        api.plan.fileService.get(task.UploadPhotoFileId).then(function(r){
          if(r.data.Base64){
            task.images=[{
              url:r.data.Base64,
              alt:task.EndDescription||''
            }]
            xhUtils.playPhoto(task.images)
          }else if(task.EndDescription){
            //$mdDialog.show(
            //  $mdDialog.alert()
            //    .title('关闭原因')
            //    .textContent(task.EndDescription)
            //    .ok('确定')
            //)
            //var pinTo = $scope.getToastPosition();
            //task.currentT = task.EndDescription;
            //task.showTooltip = true;
            $mdToast.show(
              $mdToast.simple()
                .textContent(task.EndDescription)
                .position('top')
                .hideDelay(3000)
            );
            //utils.alert('无图片')
            //var position = $mdPanel.newPanelPosition()
            //  .relativeTo('.sub-toolbar')
            //  .addPanelPosition($mdPanel.xPosition.CENTER, $mdPanel.yPosition.BELOW)
            //
            //$mdPanel.open({
            //  controller: function (mdPanelRef,$scope,utils) {
            //    var vm = this;
            //    //vm.closePanel1 = function() {
            //    //  return mdPanelRef.close().then(function () {
            //    //    mdPanelRef.destroy();
            //    //    parent.closePanel1 = null;
            //    //  });
            //    //}
            //  },
            //  controllerAs: 'vm',
            //  template: '<div class="mt-20" style="background:rgb(245,245,245);border-radius: 4px;padding:16px;box-shadow: 0px 7px 8px -4px rgba(0, 0, 0, 0.2), 0px 13px 19px 2px rgba(0, 0, 0, 0.14), 0px 5px 24px 4px rgba(0, 0, 0, 0.12);"><div>无图片</div>\
            //  </div>',
            //  hasBackdrop: true,
            //  position: position,
            //  trapFocus: true,
            //  zIndex: 5000,
            //  clickOutsideToClose: true,
            //  escapeToClose: true,
            //  focusOnOpen: true,
            //  attachTo:angular.element('body')
            //});
          }else{
            //task.currentT = '未上传照片，未填写关闭原因';
            //task.showTooltip = true;
            $mdToast.show(
              $mdToast.simple()
                .textContent('无上传照片，无反馈信息')
                .position('top')
                .hideDelay(3000)
                .toastClass('abc')
            );
          }
        })
      }
      /*关闭任务*/
      vm.closeTask = function(task){
        console.log($scope)
        var parent = vm;
        var position = $mdPanel.newPanelPosition()
          .relativeTo('.sub-toolbar')
          .addPanelPosition($mdPanel.xPosition.CENTER, $mdPanel.yPosition.BELOW)

        $mdPanel.open({
          controller: function (mdPanelRef,$scope,utils) {
            var vm = this;
            vm.endTask = function(){
              var time = new Date(),
                params ={
                "TaskId": task.TaskFlowId,
                "ActualEndTime": new Date(),
                "EndDescription": vm.EndDescription,
                "Force": true,
                 "PhotoFileName":sxt.uuid()+'.jpg',
                  "PhotoFile":vm.img//$scope.img[0].ImageByte
              };
              if(!vm.img){
                return;
              }
              vm.closePanel1();
              api.plan.BuildPlan.endTask($stateParams.id,params).then(function (r) {
                //task.IsAbleStart = r.IsAbleStart;
                //task.IsInterlude = r.IsInterlude;
                //task.ManuallyClose = r.ManuallyClose;
                //parent.needLoad = true;
                //console.log(parent.$parent)
                if(r.data.length){
                  r.data.forEach(function(_r){
                    var f=parent.flows.find(function(t){
                      return t.TaskFlowId == _r.Id;
                    })
                    if(f){
                      f.ActualStartTime = _r.ActualStartTime;
                      f.ActualEndTime = _r.ActualEndTime;
                      f._State=setSatus(_r.State);
                      f.Color=setColor(_r.State);
                      f.State = _r.State;
                      f.IsAbleStart = _r.IsAbleStart;
                      f.IsInterlude = _r.IsInterlude;
                      f.ManuallyClose = _r.ManuallyClose;
                      f.IsRelatedObject = _r.IsRelatedObject;
                      f.RealScheduledStartTime = _r.RealScheduledStartTime;
                      f.RealScheduledEndTime = _r.RealScheduledEndTime;
                    }
                  })
                }else{
                  loadSubTask();
                }
              },function(err){
                utils.alert(err.data||'上传图片失败');
              });
            }
            vm.quxiao = function(){
              vm.closePanel1();
            }
            vm.closePanel1 = function() {
              return mdPanelRef.close().then(function () {
                mdPanelRef.destroy();
                parent.closePanel1 = null;
              });
            }
          },
          controllerAs: 'vm',
          template: '<div style="margin-top:-50px;width:320px;background:#fff;border-radius: 10px;box-shadow: 0px 7px 8px -4px rgba(0, 0, 0, 0.2), 0px 13px 19px 2px rgba(0, 0, 0, 0.14), 0px 5px 24px 4px rgba(0, 0, 0, 0.12);overflow: hidden;"><div style="margin-bottom: 10px;background: #f9f9f9;border-bottom: 1px solid #dedede;height:50px;line-height: 50px;padding-left:30px;">反馈信息</div><div style="display: block;text-align: center;"><sxt-images2 ng-model="task.TaskFlowId" img="vm.img"></sxt-images2></div><md-input-container md-no-float class="md-block m-0" style="margin:0 20px;">\
          <input type="text" ng-model="vm.EndDescription" placeholder="备注">\
          </md-input-container>\
          <div layout="row" layout-align="space-around start" style="margin-bottom: 10px;">\
          <md-button class="md-raised" ng-click="vm.quxiao()">取消</md-button>\
            <md-button class="md-raised md-primary" ng-click="vm.endTask()" ng-disabled="!vm.img">完成</md-button></div><div layout="row" layout-align="center center" style="margin-bottom: 10px;">点完成按钮前必须上传图片</div></div>',
          hasBackdrop: true,
          position: position,
          trapFocus: true,
          zIndex: 5000,
          clickOutsideToClose: true,
          escapeToClose: true,
          focusOnOpen: true,
          attachTo:angular.element('body')
        });
      }
      //vm.endTask = function(){
      //  var time = new Date();
      //  api.plan.Task.end(vm.currentTask.TaskFlowId,true,time,vm.EndDescription).then(function (r) {
      //    loadSubTask();
      //  });
      //}
      function stopTask(task,changeds) {
        changeds.push({task:task,stop:true});
        //找到依赖他执行的任务
        var deps = originData.Items.filter(function (it) {
          return it.Dependencies.find(function (d) {
            return d.DependencyTaskID==task.Id;
          });
        });
        if(deps.length==0){
          //如果非主线
          if(task.Description){
            try{
              var t = eval('('+task.Description+')');
              if(t && t.Type===0) { //如果是主线
                if(task.ExtendedParameters) {
                  var parent = originData.Items.find(function (it) {
                    return it.Id == task.ExtendedParameters;
                  });
                  if (parent) {
                    return stopTask(parent, changeds);
                  }
                  else{
                    return -2;//有异常
                  }
                }
                else{
                  return 1;//返回主线结束
                }
              }
              else{
                return -1;//有异常
              }
            }
            catch(ex) {
              return -3;//有异常
            }
          }
          else {
            return 1;//全结束
          }
        }
        else{
          deps.forEach(function (d) {
            //要开始的任务
            changeds.push({task:d,stop:false});
          });
          return 0;//正常下走
        }
      }

      function toStopTask(task) {
        var changes =[],querys=[];
        var r = stopTask(task,changes);
        changes.forEach(function (c) {
          if(c.stop)
            querys.push(api.plan.Task.end(c.task.Id,true));
          else
            querys.push(api.plan.Task.start(c.task.Id,true));
        });
        $q.all(querys).then(function (rs) {
          changes.forEach(function (c) {
            if(c.stop) {
              c.task.ActualEndTime = new Date();
              vm.data.forEach(function (t) {
                var f = t.tasks.find(function (t1) {
                  return t1.id==c.task.Id;
                });
                if(f){
                  f.to = new Date();
                }
              })
            }
            else{
              c.task.ActualStartTime = new Date();
              vm.data.forEach(function (t) {
                var f = t.tasks.find(function (t1) {
                  return t1.id==c.task.Id;
                });
                if(f){
                  f.from = new Date();
                }
              })
            }
          })
          if(r===0){
            utils.alert('操作成功');
          }
          else if(r>0){
            utils.alert('计划全部完成');
          }
          else{
            utils.alert('部分计划不能正常继续');
          }
        });
      }
      vm.toStopTask = function () {
        var tid = vm.current?vm.current.Eid:taskId;
        var task = originData.Items.find(function (it) {
          return it.Id == tid;
        });
        utils.confirm('确定关闭'+task.Name+'"吗?').then(function () {
          toStopTask(task);
        });
      };
      //toStopTask();
      vm.dialogData = dialogData;
      vm.close =function(){
        $mdDialog.hide(vm.needLoad);
      }
      vm.toggleRight = function () {
        return $mdSidenav('right')
          .open();
      }
      vm.closeRight = function () {
        return $mdSidenav('right')
          .close();
      }

      vm.onLoadTemplate = function () {
        var temp;
        //if(temp)return;
        temp = new template({
          onNodeDotColor:function (t) {
            return t.Color;
          },
          onNodeColor:function (t) {
            return 'silver'
          },
          onClick:function (e) {
            vm.current = e.data;
            console.log(e);
            vm.openDialog(e.data,e.data.TaskFlowId);
           // vm.toggleRight();
          }
        });
        vm.flows = temp.load(vm.data);
      }

      vm.openDialog = function(data,Id){
        api.plan.BuildPlan.getGantt({
          ParentTaskId:Id,
          Type:'BuildingPlan',
          Source:$stateParams.id
        }).then(function(r){
          if(!r.data.Items.length) return;
          var newdata = angular.extend({
            id:Id
          },data)
          editDialog('','',newdata);
        })

      }

    }


  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planCreate.$inject = ["$scope", "template", "api", "$state", "$window", "$mdDialog", "$q", "utils", "sxt"];
  angular
    .module('app.plan')
    .component('planCreate',{
      templateUrl:'app/main/plan/component/plan-create.html',
      controller:planCreate,
      bindings:{
        buildId:'<',
        begin:'<',
        libraryId:'<',
        templateId:'<',
        ct:'<',
        onUpdate:'&'
      },
      controllerAs:'vm'
    });

  /** @ngInject */
  function planCreate($scope,template,api,$state,$window,$mdDialog,$q,utils,sxt) {
    var vm = this,
      moment = $window.moment;
    var buildId = vm.buildId || '000420000000006',
      rootTaskLibraryId = vm.libraryId || 303,
      begin = vm.begin ? moment(vm.begin) : moment('2016-10-1');
    var gs = (function () {
      var vars = [], r = /[a-z]{1,3}/gi,
        compare = function (s1, s2) {
          return s1.key.localeCompare(s2.key);
        },
        getDate = function (key,g) {
          var r = vars.find(function (n) {
            return n.key == key;
          });
          if(r && r.value){
            var date = new moment(r.value);
            g = g.replace(key,'');
            try{
              var days = $window.eval(g);
              return date.add(days,'days');
            }catch (ex){
              return false;
            }
          }
          return false;
      };
      return {
        setValue: function (k, value) {
          var v = vars.find(function (v) {
            return v.key == k;
          });
          if (v)
            v.value = value;
          else{
            vars.push({
              key:k,
              value:value
            });
          }
        },
        getVars: function (g) {
          if (!g) return [];
          var vs = g.toUpperCase().match(r),
            rs = [];
          if (!vs || vs.length === 0) return rs;
          vs.forEach(function (v) {
            var r = vars.find(function (n) {
              return n.key == v;
            });
            if (!r) {
              r = {
                key: v
              };
              vars.push(r);
            }
            if(v.length ===1 && !rs.find(function (n) {
                return n.key == v;
              })) {
              rs.push(r);
            }
          });
          vars.sort(compare);
          rs.sort(compare);
          return rs;
        },
        setVars: function (g) {
          var vs = g.toUpperCase().match(r), f = true, isDate = false,g1 = g;
          //只有数字的计算
          if (!vs || vs.length === 0) {
            try {
              return eval(g1);
            } catch (e) {
              return g1;
            }
          }
          vs.forEach(function (v) {
            var r = vars.find(function (n) {
              return n.key == v;
            });
            if (!isDate && v.length > 1) {
              isDate = true;
            }
            if (v.length === 1 && r && (r.value || r.value === 0)) {
              g1 = g1.replace(new RegExp(v, 'gi'), r.value);
            }
            else {
              f = false;
            }
          });
          if (isDate) { //计算日期
            var b = g1.split('~');
            if(b.length===2) {
              var s = b[0].match(r),
                e = b[1].match(r);
              var sd = getDate(s[0],b[0]),
                ed = getDate(e[0],b[1]);
              if(sd && ed){
                return {
                  s:sd,
                  days: moment.duration(ed.diff(sd)).asDays(),
                  e:ed
                };
              }
            }
            return g;
          }
          else {
            //仅计算天数,没有日期
            if (f) {
              try {
                return eval(g1);
              } catch (e) {
                return g1;
              }
            }
            else
              return g;
          }
        }
      }
    })();

    $q.all([
      api.plan.TaskLibrary.getTaskFlow(rootTaskLibraryId),
      api.plan.Project.query(buildId),
      api.plan.MileStone.queryByTaskId(rootTaskLibraryId)
    ]).then(function (rs) {
      var rootTask = rs[0].data,
        floors = rs[1].data,
        mileStone = rs[2].data;
      var flows = [], banchs = [];
      rootTask.Master.forEach(function (t) {
        if (t.IsFloor) {
          floors.forEach(function (f) {
            var t1 = angular.copy(t), tid = t1.TaskFlowId;
            t1.IsFloor = true;
            t1.IsRequired = t.IsRequired;
            t1.TaskFlowId = f.FloorId + '-' + tid;
            t1.FloorId = f.FloorId;
            t1._TaskFlowId = tid;
            t1.FloorName = f.FloorName;
            t1.Name = f.FloorName;
            flows.push(t1);
            if (f.IsPresalesMilestone) {
              flows.push({
                selected: true,
                FloorId: f.FloorId,
                TaskFlowId: f.FloorId + '-' + tid + '-0',
                Id: 0,
                RelatedFlowId: tid,
                type: 'm',
                Name: '开盘'
              });
            }
          })
        }
        else {
          flows.push(t);
        }
        var m = mileStone.Items.find(function (m1) {
          return m1.RelatedFlowId == t.TaskFlowId;
        });
        if (m) {
          flows.push({
            selected: true,
            TaskFlowId: m.Id + '-' + m.RelatedFlowId,
            Id: m.Id,
            RelatedFlowId: m.RelatedFlowId,
            type: 'm',
            Name: m.Name
          });
        }
      });
      flows.forEach(function (f) {
        if (f.OptionalTasks) {
          if (f.IsFloor) {
            if (f.Name.indexOf('负') != -1) {
              f.currentTask = f.OptionalTasks.find(function (t) {
                return t.Name.indexOf('负') != -1 || t.Name.indexOf('地') != -1
              });
            }
            else if (f.Name.indexOf('裙') != -1) {
              f.currentTask = f.OptionalTasks.find(function (t) {
                return t.Name.indexOf('裙') != -1;
              });
            }
            else if (f.Name.indexOf('转') != -1) {
              f.currentTask = f.OptionalTasks.find(function (t) {
                return t.Name.indexOf('转') != -1;
              });
            }
            else {
              f.currentTask = f.OptionalTasks.filter(function (t) {
                return t.Name.indexOf('负') == -1 &&
                  t.Name.indexOf('裙') == -1 &&
                  t.Name.indexOf('转') == -1;
              })[0];
            }
          }
          if (!f.currentTask) {
            f.currentTask = f.OptionalTasks[0];
          }
          f.selected = true;
        }
      });
      rootTask.Branch.forEach(function (bs) {
        bs.forEach(function (b) {
          banchs.push(b);
        });
      });
      gs.getVars('N');
      gs.setValue('N', floors.filter(function (f) {
        // 1	标准层
        // 2	地下室
        // 4	裙楼
        // 8	转换层
        return f.FloorTypeStatus != '2'
          ;
      }).length);
      vm.flows = flows;
      vm.banchs = banchs;
      vm.buildDate();
    });

    vm.setCurrent = function (flow, task) {
      flow.currentTask = task;
      vm.buildDate();
    }
    vm.buildBranch = function () {
      vm.banchs.forEach(function (flow) {
        var d = gs.setVars(flow.Expression);
        if(d){
          flow.start = d.s;
          flow.days = d.days;
          flow.end = d.e;
        }
      });
    }
    vm.buildDate = function () {
      if (!vm.flows) return;
      vm.flows.reduce(function (prev, current, index, array) {
        if (!current.selected) return prev; //未选中
        if (current.type) {//里程碑
          current.end = prev.end;
          return prev;
        }
        if (prev && !prev.end) { //前置条件不足
          current.days = current.start = current.end = undefined;
        }
        else {
          var start = prev ? moment(prev.end) : moment(begin),
            end;
          if (!start) {
            current.days = current.start = current.end = undefined;
          }
          else {
            try {
              var days = gs.setVars(current.currentTask.Duration);
              if (days === current.currentTask.Duration)
                days = undefined;
              current.days = days;
            } catch (ex) {
            }
            if (current.days) {
              end = moment(start).add(current.days, 'days');
            }
            else {
              end = undefined;
            }
            current.start = start;
            current.end = end;
          }
        }
        if(prev && prev.IsFloor){
          var pTask = prev.currentTask,
            cTask = current.currentTask;
          if(current.IsFloor) {
            if (pTask.Name.indexOf('地') != -1 && cTask.Name.indexOf('地') == -1) {
              gs.setValue(prev.Expression + 'D', prev.end);
            }
            else if (
              (pTask.Name.indexOf('地') != -1 ||
              pTask.Name.indexOf('裙') != -1 ||
              pTask.Name.indexOf('转') != -1) &&
              (cTask.Name.indexOf('地') == -1 &&
              cTask.Name.indexOf('裙') == -1 &&
              cTask.Name.indexOf('转') == -1)
            ) {
              gs.setValue(prev.Expression + 'B', current.start);
            }
          }
          else{
            gs.setValue(prev.Expression + 'S', prev.start);
            gs.setValue(prev.Expression + 'F', prev.end);
          }
        }
        if(current.Expression) {
          if(!current.IsFloor){
            gs.setValue(current.Expression+'S',current.start);
            gs.setValue(current.Expression+'F',current.end);
          }
          //console.log('current.currentTask', current.currentTask);
        }
        return current;
      }, null);
      vm.buildBranch();
      return '';
    }

    vm.down = function (flow) {
      var index = vm.flows.indexOf(flow);
      if (index > 0) {
        var next = vm.flows[index + 1];
        if (next) {
          vm.flows[index] = next;
          vm.flows[index + 1] = flow;
        }
      }
      vm.buildDate();
    }
    vm.up = function (flow) {
      var index = vm.flows.indexOf(flow);
      var next = vm.flows[index - 1];
      if (next) {
        vm.flows[index] = next;
        vm.flows[index - 1] = flow;
      }
      vm.buildDate();
    }
    vm.setVars = function (flow) {
      var dur = flow.Expression ? flow.Expression : flow.currentTask.Duration;
      var vars = gs.getVars(dur);
      if (vars.length == 0) return;
      return $mdDialog.show({
        controller: ['$mdDialog', '$scope', function ($mdDialog) {
          var vm = this;
          vm.vars = vars;
          vm.dur = dur;
          vm.select = function () {
            $mdDialog.hide(vm.dur);
          }
        }],
        controllerAs: 'vm',
        templateUrl: 'app/main/plan/component/plan-create-vars.html',
        parent: angular.element(document.body),
        clickOutsideToClose: true
      }).then(function (dur) {
        if (flow.currentTask)
          flow.currentTask.Duration = dur;
        else
          flow.Expression = dur;
        vm.buildDate();
      });
    }

    vm.submit = function () {
      var tasks = [], milestones = [];
      vm.flows.reduce(function (prev, current) {
        if (!current.selected) return prev;
        if (current.type) {
          milestones.push({
            Name: current.Name,
            RelatedFlowId: current.RelatedFlowId,
            MilestoneTime: current.end.format('YYYY-MM-DD')
          });
          return prev;
        }
        if (!current._id)
          current._id = sxt.uuid();

        tasks.push({
          "Id": current._id,
          "DependentTaskFlowId": prev && prev._id,
          "TaskFlowId": current._TaskFlowId || current.TaskFlowId,
          "FloorId": current.FloorId,
          "FloorName": current.FloorName,
          "Type": current.Type,
          "OptionalTask": {
            "TaskLibraryId": current.currentTask.TaskLibraryId,
            "PlanBeginTime": current.start.format('YYYY-MM-DD'),
            "PlanEndTime": current.end.format('YYYY-MM-DD'),
            "Days": current.days
          }
        })
        return current;
      }, null);
      vm.banchs.forEach(function (current) {
        tasks.push({
          "Id": sxt.uuid(),
          "DependentTaskFlowId": null,
          "TaskFlowId": current.TaskFlowId,
          "FloorId": current.FloorId,
          "FloorName": current.FloorName,
          "Type": current.Type,
          "OptionalTask": {
            "TaskLibraryId": current.currentTask.TaskLibraryId,
            "PlanBeginTime": current.start.format('YYYY-MM-DD'),
            "PlanEndTime": current.end.format('YYYY-MM-DD'),
            "Days": current.days
          }
        })
      });
      var b = {
        "BuildingPlanInput": {
          "BuildingId": "000420000000006",
          "Name": "测试计划",
          "TaskTemplateId": vm.templateId,
          "StartTime": "2016-10-01T00:00:00.412Z",
          "PreSalesTime": "2016-11-01T14:37:07.412Z",
          "ExpectEndTime": "2016-11-01T14:37:07.412Z"
        },
        "TaskFlows": tasks,
        "Milestones": milestones
      };
      var fg = true;
      tasks.forEach(function (t) {
        if(!t.OptionalTask.PlanEndTime){
          fg = false;
        }
      });
      if(!fg) return fg;
      console.log(JSON.stringify(b));
      return api.plan.BuildPlan.post(b);
    }
    if (vm.ct)
      vm.ct.submit = function () {
        return vm.submit();
      }
  }
})(angular,undefined);

(function(angular,undefined){
  'use strict';

  planBuild.$inject = ["$scope", "api", "template", "$q", "$mdSidenav", "utils", "$timeout", "$mdDialog", "$mdPanel", "$state"];
  angular
    .module('app.plan')
    .component('planBuild',{
      templateUrl:'app/main/plan/component/plan-build.html',
      controller:planBuild,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planBuild($scope,api,template,$q,$mdSidenav,utils,$timeout,$mdDialog,$mdPanel,$state){
    var vm = this;
    vm.initLoading = true;
    vm.data = {
      projects:null
    }
    vm.formWizard={

    }
    vm.formWizard.StartTime ?vm.formWizard.StartTime:vm.formWizard.StartTime = new Date();
    api.xhsc.Project.getMap().then(function (r) {
      vm.data.projects = r.data;
      vm.initLoading = false;
    })
    vm.getMaps = function () {
      return vm.data.projects||api.xhsc.Project.getMap().then(function (r) {
          vm.data.projects = r.data;
         return vm.data.projects
        });
    }
    vm.getSections = function () {
      return api.xhsc.Project.GetAreaChildenbyID(vm.formWizard.projectId).then(function (r) {
        vm.data.sections = r.data;
      })
    }

    vm.getBuildings = function () {
      return api.xhsc.Project.GetAreaChildenbyID(vm.formWizard.sectionId).then(function (r) {
        vm.data.buildings = r.data;
      })
    }
    vm.getYT = function(Id){
      if(!Id) return;
      var find = vm.data.projects.find(function(r){
          return r.ProjectID == Id;
        })
      if(find){
        vm.YT={
          ProjectFormatName:find.ProjectFormatName&&find.ProjectFormatName?find.ProjectFormatName:'',
          RegionName:find.RegionName&&find.RegionName?find.RegionName:''
        }
      }
    }
    vm.getFloors = function (bid) {
      return api.xhsc.Project.GetAreaChildenbyID(bid).then(function (r) {
        vm.data.floors = r.data;
        return r.data;
      })
    }
    vm.getTask = function (templateId) {
      return api.plan.TaskTemplates.getItem(templateId).then(function (r) {
        return api.plan.TaskLibrary.getTaskFlow(r.data.RootTaskLibraryId).then(function (r1) {
          return r1.data;
        })
      })
    }
    vm.toggleRight = function () {
      return $mdSidenav('right')
        .open();
    }
    vm.closeRight = function () {
      return $mdSidenav('right')
        .close();
    }
    vm.resetName = function (item) {
      item.Name = (item.FullName || item.TaskFlowName)+' - ' +
        (item.selectedTask?item.selectedTask.Name:'')
      + ' - 可选('+item.OptionalTasks.length+')';

    }
    function setTask(item) {
      var next = vm.rootTask.Master.find(function (it) {
        return it.ParentId===item.Id && it.OptionalTasks.find(function (task) {
          return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
        })!=null;
      });
      if(next){
        next.selectedTask = next.OptionalTasks.find(function (task) {
          return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
        });
        next.selectedTask.eDuration = item.selectedTask.eDuration;
        next.selectedTask.xDuration = item.selectedTask.xDuration;
        vm.resetName(next);
        setTask(next);
      }
    }

    //vm.setDuration = function(item){
    //  var next = vm.rootTask.Master.find(function (it) {
    //    return it.ParentId===item.Id && it.OptionalTasks.find(function (task) {
    //        return task.TaskLibraryId===item.selectedTask.TaskLibraryId;
    //      })!=null;
    //  });
    //  if(next) {
    //    next.selectedTask = next.OptionalTasks.find(function (task) {
    //      return task.TaskLibraryId === item.selectedTask.TaskLibraryId;
    //    });
    //    if (next.selectedTask) {
    //      next.selectedTask.eDuration = vm.current.selectedTask.eDuration;//Math.round(item.selectedTask.duration*10)*0.1;
    //      next.selectedTask.xDuration = vm.current.selectedTask.xDuration;
    //    }
    //    vm.setDuration(next)
    //  }
    //}
    vm.reloadTask = function () {
      if(vm.current) {
        vm.resetName(vm.current);
        setTask(vm.current);
      }
      vm.temp.load(vm.rootTask);

    }
    vm.flows=null;
    vm.branches=null;
    vm.vars = null;
    vm.nextStep = function(i,f){
      if(i==0){
        var find=vm.data.templates.find(function(r){
          return r.RootTaskLibraryId==vm.formWizard.RootTaskLibraryId
        })
        if(find){
          vm.formWizard.TaskTemplateId = find.Id;
        }
        f();
      }
      else if(i===1){
        var tasks = [], milestones = [],flag;
        vm.flows.reduce(function (prev, current) {
          //if(current.show) flag=true;
          if (!current.selected) return prev;
          if (current.type) {
            milestones.push({
              Name: current.Name,
              RelatedFlowId: current.RelatedFlowId,
              MilestoneTime: current.end&&current.end.format('YYYY-MM-DD')
            });
            return prev;
          }
          if (!current._id)
            current._id = sxt.uuid();

          tasks.push({
            "Id": current._id,
            "DependentTaskFlowId": prev && prev._id,
            "TaskFlowId": current._TaskFlowId || current.TaskFlowId,
            "FloorId": current.FloorId,
            "FloorName": current.FloorName,
            "Type": current.Type,
            "OptionalTask": {
              "TaskLibraryId": current.currentTask.TaskLibraryId,
              "PlanBeginTime": current.start&&current.start.format('YYYY-MM-DD'),
              "PlanEndTime": current.end&&current.end.format('YYYY-MM-DD'),
              "Days": current.days
            }
          })
          return current;
        }, null);
        vm.branches.forEach(function (current) {
          if(!current.selected) return;
          //var f=vm.flows.find(function(_t){
          //  return _t.TaskFlowId == current.ParentId;
          //})
          tasks.push({
            "Id": sxt.uuid(),
            "DependentTaskFlowId": null,
            "TaskFlowId": current.TaskFlowId,
            "FloorId": current.FloorId,
            "FloorName": current.FloorName,
            "Type": current.Type,
            "OptionalTask": {
              "TaskLibraryId": current.currentTask.TaskLibraryId,
              "PlanBeginTime": current.start&&current.start.format('YYYY-MM-DD'),
              "PlanEndTime": current.end&&current.end.format('YYYY-MM-DD'),
              "Days": current.days
            }
          })
        });
        var b = {
          "Vars":vm.vars.allVars().filter(function (v) {
            return v.key.length === 1;
          }),
          "BuildingPlanInput": {
            "BuildingId": vm.formWizard.BuildingId,
            "Name": vm.formWizard.Name,
            "TaskTemplateId": vm.formWizard.TaskTemplateId,
            "StartTime": vm.formWizard.StartTime,
            "PreSalesTime": "",
            "ExpectEndTime": ""
          },
          "TaskFlows": tasks,
          "Milestones": milestones
        };
        var fg = true;
        tasks.forEach(function (t) {
          if(!t.OptionalTask.PlanEndTime){
            fg = false;
          }
        });
        if(!fg){
          utils.alert('有工期设置不恰当项存在!').then(function(){
          });
        return fg;
        };
        //if(flag){
        //  utils.alert('工期应大于基本工期的80%!').then(function(){
        //  });
        //  return;
        //};
          var parent = vm;
          var position = $mdPanel.newPanelPosition()
            .relativeTo('md-tabs-wrapper')
            .addPanelPosition($mdPanel.xPosition.CENTER, $mdPanel.yPosition.BELOW)

          $mdPanel.open({
            controller: function (mdPanelRef,$scope,utils) {
              var vm = this;
              parent.loading1 = false;
              parent.closePanel1 = function() {
                return mdPanelRef.close().then(function () {
                  mdPanelRef.destroy();
                  parent.loading1 = true;
                  parent.closePanel1 = null;
                });
              }
            },
            controllerAs: 'vm',
            template: '<div layout="row" class="mt-20" layout-align="center center"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div>',
            hasBackdrop: false,
            position: position,
            trapFocus: true,
            zIndex: 5000,
            clickOutsideToClose: true,
            escapeToClose: true,
            focusOnOpen: true,
            attachTo:angular.element('#content')
          });
          f();
        var data;
        vm.formWizard.Id?data=angular.extend({
          BuildingPlanId:vm.formWizard.Id
        },b):data=b;
        vm.currentRoles = null;
        (vm.formWizard.Id?api.plan.BuildPlan.update(vm.formWizard.Id,data):api.plan.BuildPlan.post(data)).then(function(r){
            if(!vm.formWizard.Id)
              vm.formWizard.Id = r.data.Id;
            api.plan.BuildPlan.getBuildingPlanRoles(r.data.Id).then(function (r) {
              vm.currentRoles = r.data.Items;
            });
            parent.closePanel1();
           // f();
          },function(err){
            parent.closePanel1();
            utils.alert(err.data||'提交失败');
            return;
          });
      }
    }
    function getDataTemplate(){
      return api.plan.BuildPlan.getBuildPlanFlowTree(vm.formWizard.Id).then(function(r){
        r.data.RootTask.Master = r.data.RootTask.Master.map(function (item) {
          item._TaskFlowId = item.TaskFlowId;
          item.TaskFlowId = item.Id;
          item.selectedTask = item.OptionalTasks.length==0?null:item.OptionalTasks[0];
          vm.getVars(item.selectedTask);
          //item.selectedTask.Duration = item.selectedTask.Duration?item.selectedTask.Duration:null;
          vm.resetName(item);
          return item;
        });
        r.data.RootTask.Branch.forEach(function(_t){
          _t.forEach(function(_tt){
            _tt._TaskFlowId = _tt.TaskFlowId;
            _tt.TaskFlowId = _tt.Id;
            _tt.Name = _tt.FullName||_tt.TaskFlowName;
          })
        });
        //vm.temp = new template({
        //  onClick:function (e) {
        //    vm.current = e.data;
        //    vm.showBg = true;
        //    vm.toggleRight();
        //  }
        //});
        vm.rootTask = r.data.RootTask;
       // vm.reloadTask();
      });
    }
    vm.loadUser = function(){
      if(vm.roleUsers&&vm.roleUsers.length) return;
        return api.plan.users.queryById({projectId:vm.formWizard.projectId}).then(function(r){
          vm.roleUsers = r.data;
        })
    }
    vm.deleteTaskLib = function(){
      utils.confirm('确认删除',null,'确定','取消').then(function(){
        api.plan.BuildPlan.deleteTaskLibById(vm.formWizard.Id,vm.current.TaskFlowId).then(function(r){
          //console.log(r)
          if(r.status == 200){
            utils.alert('删除成功').then(function(){
              vm.showBg = false;
              vm.closeRight();
              $timeout(function(){
                getDataTemplate();
              },500)
            })
          }
        })
      })
    }
    vm.stop = function(ev){
      ev.stopPropagation();
    }
    vm.sendForm = function(fn){
      var resets = [];
      var p = vm;
      if(!vm.currentRoles.length){
        utils.alert('未配置角色');
        return;
      }
        $mdDialog.show({
          controller:['$scope',function($scope){
            p.hide = function(){
              $mdDialog.cancel();
            }
          }],
          template: '<md-dialog style="background-color: transparent;box-shadow: none;"><md-dialog-content ><div layout="row" layout-align="center center"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div><div layout="row" layout-align="center center">正在生成，请稍后...</div></md-dialog-content></md-dialog>',
          parent: angular.element('#content'),
          clickOutsideToClose:false,
          hasBackdrop:true,
          escapeToClose: true,
          focusOnOpen: true
        })


      vm.currentRoles&&vm.currentRoles.forEach(function (r) {
        resets.push(api.plan.BuildPlan.buildingRolesReset(vm.formWizard.Id,{
          RoleId:r.RoleId,
          UserIds:r.Users
        }));
      });
        $q.all(resets).then(function (rs) {
          //生成计划
          utils.alert('生成计划完成').then(function(){
            $state.go('app.plan.gantts');
            //fn();
            //p.hide();
          })
        },function(err){
          console.log(err)
        });


    }
    vm.change = function(){
      vm.inputChange = true;
    }
    var regionName1='',regionName2='',regionName3='';
    $scope.$watch('vm.formWizard.projectId',function(){
      vm.data.sections = null;
      vm.data.buildings=null;
      if(vm.formWizard&&vm.formWizard.projectId&&!vm.inputChange){
        regionName1='';
        var f=vm.data.projects.find(function(r){
          return r.ProjectID == vm.formWizard.projectId;
        })
        if(f){
          regionName1 = f.ProjectName;
          vm.formWizard.Name = regionName1;
        }
        api.plan.TaskTemplates.GetList({Skip:0,Limit:100,ProjectId:vm.formWizard.projectId}).then(function (r) {
          vm.data.templates = r.data.Items||[];
        })
      }
    });
    $scope.$watch('vm.formWizard.sectionId',function(){
      vm.data.buildings=null;
      if(vm.formWizard&&vm.formWizard.sectionId&&!vm.inputChange){
        regionName2 = '';
        var f=vm.data.sections.find(function(r){
          return r.RegionID == vm.formWizard.sectionId;
        })
        if(f){
          regionName2 = f.RegionName;
          vm.formWizard.Name = regionName1+regionName2;
        }
      }
    })
    $scope.$watch('vm.formWizard.BuildingId',function(){
      if(vm.formWizard&&vm.formWizard.BuildingId&&!vm.inputChange){
        regionName3 = '';
        var f=vm.data.buildings.find(function(r){
          return r.RegionID == vm.formWizard.BuildingId;
        })
        if(f){
          regionName3 = f.RegionName;
          vm.formWizard.Name = regionName1+regionName2+regionName3;
        }
      }
    })

  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planBcAdd.$inject = ["$scope", "api", "utils", "$state", "$stateParams"];
  angular
    .module('app.plan')
    .component('planBcadd',{
      templateUrl:'app/main/plan/component/plan-bcAdd.html',
      controller:planBcAdd,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planBcAdd($scope,api,utils,$state,$stateParams){
    var vm = this;
    vm.data = {};
    vm.data.IsAllStopWork = 'true';
    vm.data.CompensateId = $stateParams.id;

    api.plan.compensate.getBaseRegion().then(function (r) {
      vm.Areas = r.data.Items||[];
    });

    if(vm.data.CompensateId){
      api.plan.compensate.getCompensate(vm.data.CompensateId).then(function (r) {
        vm.data = r.data;
        vm.data.Time = new Date(vm.data.Time.substring(0,10));
        vm.data.IsAllStopWork = ''+vm.data.IsAllStopWork;
        var areaIds = [];
        //aaa
        r.data.CompensateAreas.forEach(function (a) {
          areaIds.push(a.AreaId);
        });
        vm.data.AreaIds = areaIds;
      });
    }

    vm.save = function(){
      if(!vm.data.CompensateId){
        api.plan.compensate.createBc(vm.data).then(function () {
          utils.alert("提交成功",null,function(){
            $state.go("app.plan.bc.list");
          });
        })
      }else{
        vm.data.Id = vm.data.CompensateId;
        api.plan.compensate.putCompensate(vm.data).then(function () {
          api.plan.compensate.postAreaReset({id:vm.data.CompensateId,areaIds:vm.data.AreaIds}).then(function () {
            utils.alert("提交成功",null,function(){
              $state.go("app.plan.bc.list");
            });
          })
        })
      }
    };
  }
})(angular,undefined);

/**
 * Created by emma on 2016/8/22.
 */
(function(angular,undefined){
  'use strict';

  planBc.$inject = ["$scope", "api", "utils"];
  angular
    .module('app.plan')
    .component('planBc',{
      templateUrl:'app/main/plan/component/plan-bc.html',
      controller:planBc,
      controllerAs:'vm'
    });

  /** @ngInject */
  function planBc($scope,api,utils){
    var vm = this;
    vm.total=0;
    $scope.pageing={
      page:1,
      pageSize:10
    };

    vm.pageAction = function(title, page, pageSize, total){
      $scope.pageing.page = page;
    };

    $scope.$watch("pageing",function(){
      Load();
    },true);

    function Load() {
      var page = utils.getPage($scope.pageing);

      api.plan.compensate.getList({Skip:page.Skip,Limit:page.Limit}).then(function (r) {
        vm.data = r.data.Items||[];
        vm.total = r.data.TotalCount;
        console.log(r.data,'------------')
      });
    }

    vm.delete = function(id){
      utils.confirm('确认删除此补偿信息').then(function () {
        api.plan.compensate.delete(id).then(function () {
          Load();
        })
      });
    }
  }
})(angular,undefined);

/**
 * Created by HuangQingFeng on 2016/11/28.
 */
(function (angular, undefined) {
  'use strict';

  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.pileFoundation', ['app.core','app.xhsc'])
    .config(config);
  /** @ngInject */
  function config($stateProvider, msNavigationServiceProvider) {
    $stateProvider
      .state('app.pileFoundation', {
        url: '/pileFoundation',
        views: {
          'content@app': {
            template: '<ui-view class="animate-slide-left" flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      .state('app.pileFoundation.list', {
        url:'/list',
        template:'<pile-foundation-list flex layout="column"></pile-foundation-list>'
      });
    // msNavigationServiceProvider.saveItem('pileFoundation', {
    //   title: '桩基管理',
    //   group: true,
    //   weight: 2
    // });
    //
    // msNavigationServiceProvider.saveItem('pileFoundation.pileFoundation', {
    //   title: '桩基管理',
    //   icon: 'icon-sort-variant',
    //   state: 'app.pileFoundation.list',
    //   weight: 1
    // });

  }
})(angular, undefined);

/**
 * Created by lukehua on 2016/11/22.
 */

(function (angular, undefined) {
  'use strict';

  sxtAreaZj.$inject = ["$timeout", "sxt", "utils", "api"];
  angular
    .module('app.pileFoundation')
    .directive('sxtAreaZj', sxtAreaZj);

  /**@ngInject*/
  function sxtAreaZj($timeout, sxt, utils, api) {

    return {
      scope: {
        data: '=',
        isShow: '=',
        popup: '@'
      },
      link: function (scope, element, attrs, ctrl) {
        var map, el;
        var ran = function () {
          if (!scope.isShow || !scope.data || scope.data.files.length === 0) return;
          if (map) map.remove();

          var url = scope.data.obj.FileId;
          var layer;
          map = L.map(element[0], {
            crs: L.extend({}, L.CRS, {
              projection: L.Projection.LonLat,
              transformation: new L.Transformation(1, 0, 1, 0),
              scale: function (e) {
                return 512 * Math.pow(2, e);
              }
            }),
            center: [.48531902026005, .5],
            zoom: 0,
            minZoom: 0,
            maxZoom: 3,
            scrollWheelZoom: true,
            annotationBar: false,
            zoomControl: false,
            attributionControl: false
          }),
            //layer = L.tileLayer(sxt.app.api + '/api/file/load?x={x}&y={y}&z={z}', {
            layer = L.tileLayer(sxt.app.api + '/api/PicMap/load/{z}_{x}_{y}.png?fid=' + url.replace('/s_', '/'), {
              noWrap: true,
              continuousWorld: false,
              tileSize: 512
            });
          map.projectId = scope.projectId;
          layer.addTo(map);

          var drawnItems = L.featureGroup(),
            labels = L.featureGroup();

          map.addLayer(labels);
          map.addLayer(drawnItems);

          api.pileFoundation.pileFoundation.getPileFoundationList({
            regionTreeId: scope.data.obj.RegionTreeId + '>' + scope.data.obj.Id,
            status: 4
          }).then(function (r) {
            r.data.forEach(function (ly) {
              var geojson = JSON.parse(ly.GeoJSON),
                options = geojson.options;
              if (scope.data.zy && options.zy != scope.data.zy) return;
              switch (geojson.geometry.type) {
                case 'Circle':
                  layer = L.circle(L.GeoJSON.coordsToLatLng(geojson.geometry.coordinates), options.radius, options);
                  break;
                default:
                  var layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);
                  layer.feature = L.GeoJSON.asFeature(geojson);

                  break;
              }
              layer.data = ly;
              drawnItems.addLayer(layer);
              updateText(layer);
              layer.on('mouseover', function () {
                console.log('mouseover');
              })
              layer.on('mouseout', function () {
                console.log('mouseout');
              })
              layer.on('click', function (e) {
                openPopup(layer);
                console.log('click')
              })
            })
          });


          var editing, isPopup, drawLine,isclose;
          map.on('draw:drawstart', function (e) {
            var type = e.layerType;
            if (type == 'polyline') {
              drawLine = true;
            }
            console.log('start', type);
          });
          map.on('draw:drawstop', function (e) {
            drawLine = false;
            console.log('end');
          });
          map.on('draw:pointChanged', function (e) {
            console.log('point', e);
          })
          map.on('draw:editstart', function () {
            editing = true;
          })
          map.on('draw:deletestart', function () {
            editing = true;
          })
          map.on('draw:editstop', function () {
            editing = false;
          })
          map.on('draw:deletestop', function () {
            editing = false;
          })
          map.on('draw:created', function (e) {
            var type = e.layerType,
              layer = e.layer;
            drawnItems.addLayer(layer);
            isclose = false;
            layer.on('click', function (e) {
              openPopup(layer);

            })
            openPopup(layer);
          });
          map.on('draw:edited', function (e) {
            var layers = e.layers;
            layers.eachLayer(function (layer) {
              var geojson = layer.toGeoJSON();
              geojson.geometry.type = geojson.geometry.type != 'Polygon' ? 'Circle' : 'Polygon';
              geojson.options = layer.options;
              geojson.options.radius = layer._mRadius;
              layer.data.GeoJSON = JSON.stringify(geojson);
              api.pileFoundation.pileFoundation.updatePileFoundationArea(layer.data.Id, layer.data);
            });
          });
          map.on('draw:deleted', function (e) {
            var layers = e.layers;
            layers.eachLayer(function (layer) {
              api.pileFoundation.pileFoundation.delete(layer.data.Id).then(function () {
                var ly = null;
                labels.eachLayer(function (lb) {
                  if (lb.id == layer.options.id)
                    ly = lb;
                });
                if (ly) {
                  labels.removeLayer(ly);
                }
              })
            });
          });
          map.on('popupclose', function (e) {
            isclose = true;
            var text = $('input', el).val();
            var type = $('#zjtypeB', el).length ? $('#zjtypeB', el).prop('checked') ? 'B' : 'A' : null;
            if (text == '') {
              setTimeout(function () {
                //alert('请输入名称');
                e.popup.openOn(map);
              }, 10);
            }
            else {
              isPopup = false;
              var layer = e.popup.layer;
              layer.options.text = text;
              layer.options.type = type;
              var json = layer.toGeoJSON();
              json.geometry.type = json.geometry.type != 'Polygon' ? 'Circle' : 'Polygon';
              json.options = layer.options;
              json.options.radius = layer._mRadius;
              json.options.zy = scope.data.zy;
              json.options.id = json.options.id || sxt.uuid();
              layer.data = {
                Id: json.options.id,
                RegionName: text,
                RegionType: scope.data.obj.RegionType,
                RegionTreeId: scope.data.obj.RegionTreeId + '>' + scope.data.obj.Id,
                RegionTreeName: scope.data.obj.RegionTreeName + '>' + scope.data.obj.RegionName,
                UserId: json.options.type,
                GeoJSON: JSON.stringify(json)
              }

              api.pileFoundation.pileFoundation.createPileFoundationArea(layer.data).then(function () {
                $('input', el).val('');
                updateText(layer);
              });
            }
          });

          function updateText(layer) {
            if (!layer.options.text) return;
            var ly = null;
            labels.eachLayer(function (lb) {
              if (lb.id == layer.options.id)
                ly = lb;
            });
            if (ly) {
              labels.removeLayer(ly);
            }

            // ly = L.marker(layer.getBounds().getCenter(), {
            //   icon: new ST.L.LabelIcon({
            //     html: layer.options.text,
            //     color: layer.options.color,
            //     iconAnchor: [(layer.options.text.length * 6), 12]
            //   }),
            //   saved: false,
            //   draggable: false,       // Allow label dragging...?
            //   zIndexOffset: 1000     // Make appear above other map features
            // });
            //ly.id = layer.options.id;
            //labels.addLayer(ly);

          }

          function openPopup(layer) {
            if(isclose == true) {
              isclose = false;
              return;
            }
            if (editing || isPopup) {
              map.closePopup();
              return;
            };

            el = el || document.getElementById(scope.popup);
            $('input', el).val(layer.options.text);
            if (layer.options.type == 'B') {
              $('#zjtypeA', el).prop('checked', false);
              $('#zjtypeB', el).prop('checked', true);
            }
            else {
              $('#zjtypeB', el).prop('checked', false);
              $('#zjtypeA', el).prop('checked', true);
            }
            var popup = L.popup()
              .setLatLng(layer.getBounds().getCenter())
              .setContent(el)
              .openOn(map);
            isPopup = true;
            popup.layer = layer;
          }

          var drawControl = new L.Control.Draw({
            draw: {
              polygon: {
                allowIntersection: false,
                drawError: {
                  color: '#b00b00',
                  timeout: 1000
                },
                shapeOptions: {
                  color: '#ff0000'
                },
                showArea: false
              },
              circleMarker: {
                shapeOptions: {
                  weight: 2
                }
              }
            },
            edit: {
              edit: true,
              remove: true,
              featureGroup: drawnItems
            }
          });
          map.addControl(drawControl);

        }

        function ran1() {
          $timeout(ran, 300);
        }

        scope.$watch('data', ran1);
        scope.$watch('data.zy', ran1);
        scope.$watch('isShow', ran1);
        scope.$watchCollection('data.files', function () {
          if (scope.data.files && scope.data.files.length) {
            ran1();
          }
          else {
            if (map) {
              map.remove();
              map = null;
            }
          }
        });
      }
    };
  }
})(angular, undefined);

/**
 * Created by HuangQingFeng on 2016/11/22.
 */

(function (angular, undefined) {
  'use strict';
  pileFoundationList.$inject = ["$scope", "api", "utils", "$stateParams", "$state", "$compile", "tokenInjector"];
  angular
    .module('app.pileFoundation')
    .component('pileFoundationList', {
      templateUrl: 'app/main/pileFoundation/component/pileFoundation-list.html',
      controller: pileFoundationList,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function pileFoundationList($scope,api, utils, $stateParams, $state,$compile,tokenInjector) {
    var vm = this;
    vm.data = {};
    vm.lst_html = [];
    vm.RegionName = '';
    vm.RegionTreeId = '';
    vm.RegionTreeName = '';
    vm.zj = {};


    api.xhsc.Project.getMap().then(function (r) {
      vm.ProjectList = r.data||[];
    });

    $scope.$watch('vm.project',function () {
      if (vm.project==null) return;
      vm.StagesList = [];
        api.xhsc.Project.GetAreaChildenbyID(vm.project).then(function (r) {
        vm.StagesList = r.data||[];
        vm.lst_html = [];
      });
    });

    $scope.$watch('vm.Stages',function () {
      vm.lst_html = [];
      if(vm.Stages==null) return;
      vm.RegionTreeId = vm.project+'>'+vm.Stages;
      load(vm.RegionTreeId);
    });

    function load (regionTreeId) {
      vm.lst_html = [];
      api.pileFoundation.pileFoundation.getPileFoundationByRegionTreeId({regionTreeId:vm.RegionTreeId}).then(function (r) {
        if(r.data && r.data.length>0){
          vm.lst_html = r.data;
        }
      });
    }

    vm.addRegion = function () {
      if(vm.RegionName==''){
        utils.alert('区域名称不能为空！');
        return;
      }

      var model = {
        Id:sxt.uuid(),
        GeoJSON:'',
        RegionName:vm.RegionName,
        RegionTreeId:vm.RegionTreeId,
        RegionTreeName:vm.RegionTreeName,
        RegionType:128,
        Status:4,
        CrateTime:new Date().Format('yyyy-MM-dd hh:mm:ss')
      };
      vm.lst_html.push(model);
      vm.RegionName = '';
    }

    vm.makeRegionTreeName = function (arg1,arg2){
      if (arg1!=null && arg1!=''){
        vm.RegionTreeName = arg1;
      }
      if (arg2!=null && arg2!=''){
        vm.RegionTreeName = vm.RegionTreeName +'>'+ arg2;
      }
    }

    vm.save = function (data) {
      api.pileFoundation.pileFoundation.save(data).then(function (r) {
        utils.alert('提交成功！');
        load(vm.RegionTreeId);
      });
    }

    // vm.showImg = function (data) {
    //   vm.rid = data.Id;
    //   vm.tf.obj = data ? data : [];
    // }

  }
})(angular, undefined);

/**
 * Created by lss on 2016/9/12.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  gxysReportController.$inject = ["$scope", "remote", "$mdDialog", "$state", "$rootScope", "$window"];
  angular
    .module('app.pcReport_ys')
    .controller('gxysReportController',gxysReportController);

  /**@ngInject*/
  function gxysReportController($scope,remote,$mdDialog,$state,$rootScope,$window ){
    var vm = this;
    var params=$rootScope.gxParams;
    vm.gxSelected=params&&params.gxSelected? params.gxSelected:[];
    vm.secSelected=params&&params.secSelected? params.secSelected:[];
    vm.show=false;

    function convertStatus(status){
      var zt=''
      switch (status){
        case 1:
          zt="待验收";
          break;
        case 2:
          zt="合格";
          break;
        case 4:
          zt="不合格";
          break;
        case 8:
          zt="未整改";
          break;
        case 16:
          zt="已整改";
          break;
        default:
          zt="未知";
          break;
      }
      return zt;
    }

    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    }

    $scope.$watch("pageing.pageSize",function(){
      if ($scope.pageing.pageSize){
        load();
      }
    },true);

    function load(){
      var tmp=[];
      vm.gxSelected.forEach(function(k){
        tmp.push(k.AcceptanceItemID);
      });
      vm.source=[];
      remote.Procedure.GetInspectionInfoListEx({
        PageSize:$scope.pageing.pageSize,
        CurPage:$scope.pageing.page-1,
        status:31,
        ProjectId: vm.secSelected.length?vm.secSelected[0].RegionID:"",
        AcceptanceItemIDs:tmp
      }).then(function(r){
        $scope.pageing.total= r.data.TotalCount;
        r.data.Data.forEach(function(o){
          //非自检单并根据工序过滤
          if (!o.InspectionTime){
            o.InspectionTime="";
          }
          o.statusName=convertStatus(o.Status);

          vm.source.push(o);
        });
        vm.show=true;
      }).catch(function(){
        vm.show=true;
      });
    }

    vm.pageAction=function(title, page, pageSize, total){
      $scope.pageing.page=page;
      load();
    }

    vm.goBack=function(){
      window.history.go(-1);
    }
    vm.Lookintoys = function(item){
      $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId, acceptanceItemID:item.AcceptanceItemID,acceptanceItemName:item.AcceptanceItemName,projectId:item.ProjectID});
    }
  }
})();

/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function() {
    'use strict';

    gxysFilterController.$inject = ["$scope", "remote", "$mdSidenav", "$state", "$rootScope", "$timeout", "$window"];
    angular
        .module('app.pcReport_ys')
        .controller('gxysFilterController', gxysFilterController);

    /**@ngInject*/
    function gxysFilterController($scope, remote, $mdSidenav, $state, $rootScope, $timeout, $window) {
        var vm = this;
        vm.regions = [];
        var mobileDetect = new MobileDetect(window.navigator.userAgent);
        vm.isMobile = mobileDetect.mobile();
        vm.isiPad = mobileDetect.mobile() == "iPad";
        remote.Project.getMap("nodb").then(function(result) {
            vm.regions.push({
                RegionID: "",
                RegionName: "全部"
            })
            result.data.forEach(function(m) {
                vm.regions.push({
                    RegionID: m.ProjectID,
                    RegionName: m.ProjectName
                })
            });
        });
        vm.ck = function(item) {
            $scope.project = item.RegionID;
        }
        $scope.click = function() {
            $mdSidenav("right").toggle()
        }

        remote.Procedure.queryProcedure().then(function(r) {
            if (r.data && angular.isArray(r.data)) {
                $scope.procedures = r.data;
            }
        });

        $scope.choosego = function(item) {
            var p = $scope.gxSelected.find(function(o) {
                return o.AcceptanceItemID == item.AcceptanceItemID;
            });
            if (!p && !item.checked) {
                $scope.gxSelected.push(item)
            }
            if (p && item.checked) {
                var index = $scope.gxSelected.indexOf(p);
                $scope.gxSelected.splice(index, 1);
            }
            initGxName();
        }

        function initGxName() {
            var attr = [];
            $scope.gxSelected.forEach(function(k) {
                attr.push(k.AcceptanceItemName);
            });
            $scope.gxNames = attr.join(',');
        }
        $scope.ok = function() {
            $mdSidenav("right").toggle();
        }
        $scope.selectSpecialtyLow = function(item, parent) {
            parent.WPAcceptanceList = item.WPAcceptanceList;
        }
        $scope.remove = function(item) {
            $timeout(function() {
                var index = $scope.gxSelected.indexOf(item);
                if (index > -1) {
                    $scope.gxSelected.splice(index, 1);
                    initGxName();
                }
            })
        }

        function convertStatus(status) {
            var zt = ''
            switch (status) {
                case 1:
                    zt = "待验收";
                    break;
                case 2:
                    zt = "合格";
                    break;
                case 4:
                    zt = "不合格";
                    break;
                case 8:
                    zt = "未整改";
                    break;
                case 16:
                    zt = "已整改";
                    break;
                default:
                    zt = "未知";
                    break;
            }
            return zt;
        }



        if ($rootScope.gxysFilter_load) {
            $scope.gxSelected = $rootScope.gxysFilter_load.gxSelected;
            $scope.project = $rootScope.gxysFilter_load.project;;
            $scope.gxNames = $rootScope.gxysFilter_load.gxNames
        } else {
            $scope.gxSelected = [];
            $scope.project = "-";
        }
        $scope.pageing = {
            page: 1,
            pageSize: 10,
            total: 0
        }
        $scope.$watch("pageing.pageSize", function() {
            if ($scope.pageing.pageSize) {
                load();
            }
        }, true);
        $scope.$watch("project", function() {
            if (vm.isMobile && !vm.isiPad) {
                return;
            }
            if ($scope.project && $scope.project != "-" || $scope.project === "") {
                load();
            }
        });
        $scope.$watchCollection("gxSelected", function() {
            if (vm.isMobile && !vm.isiPad) {
                return;
            }
            if ($scope.gxSelected.length || $scope.gxSelected.isGo) {
                load();
            } else {
                $scope.gxSelected.isGo = true;
            }
        });


        function load() {
            var t = [];
            $scope.gxSelected.forEach(function(k) {
                t.push(k.AcceptanceItemID);
            });
            vm.source = [];
            remote.Procedure.GetInspectionInfoListEx({
                PageSize: $scope.pageing.pageSize,
                CurPage: $scope.pageing.page - 1,
                status: 31,
                ProjectId: $scope.project && $scope.project != "-" ? $scope.project : "",
                AcceptanceItemIDs: t
            }).then(function(r) {
                $scope.pageing.total = r.data.TotalCount;
                r.data.Data.forEach(function(o) {
                    o.statusName = convertStatus(o.Status);
                    vm.source.push(o);
                });
                $rootScope.gxysFilter_load = {
                    gxSelected: $scope.gxSelected,
                    project: $scope.project,
                    gxNames: $scope.gxNames
                }
            }).catch(function() {});
        }

        vm.pageAction = function(title, page, pageSize, total) {
            $scope.pageing.page = page;
            load();
        }
        vm.filter = function() {
            var p = vm.regions.find(function(k) {
                return k.RegionID == $scope.project;
            })

            $rootScope.gxParams = {
                gxSelected: $scope.gxSelected,
                secSelected: p && p.RegionID ? [p] : []
            }
            $state.go("app.pcReport_ys_rp");
        }

        vm.Lookintoys = function(item) {
            $state.go('app.xhsc.gx.gxzgreport', { InspectionId: item.InspectionId, acceptanceItemID: item.AcceptanceItemID, acceptanceItemName: item.AcceptanceItemName, projectId: item.ProjectID });
        }

    }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
  module('app.pcReport_yf',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_yf_default',{
        title:"移动验房",
        url:'/pcReport_yf_default',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/yf/yf_default.html',
            controller : 'yf_defaultController as vm',
          }
        }
      })
      .state('app.pcReport_yf_detail',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_yf_detail/{regionId}/{inspectionId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/yf/yf_detail.html',
            controller : 'yf_detailController as vm',
          }
        }
      })
  }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  yf_detailController.$inject = ["$stateParams", "remote"];
  angular
    .module('app.pcReport_yf')
    .controller('yf_detailController',yf_detailController);

  /**@ngInject*/
  function yf_detailController($stateParams,remote){
    var inspectionId=$stateParams.inspectionId;
    var vm=this;
    remote.report.getdetail('house',inspectionId).then(function (r) {
      vm.source=r.data;
    })
  }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  yf_defaultController.$inject = ["$state", "remote"];
  angular
    .module('app.pcReport_yf')
    .controller('yf_defaultController',yf_defaultController);

  /**@ngInject*/
  function yf_defaultController($state,remote){
     var vm=this;

      remote.report.getWrapList('house').then(function (r) {
        vm.source=r.data

      })

      vm.go=function (item) {
        $state.go("app.pcReport_yf_detail",{regionId:item.AreaID,inspectionId:item.InspectionID});
      }
  }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
  module('app.pcReport_week',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_week_default',{
        title:'周安全检查',
        url:'/pcReport_week_default/{display}',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/weekSafe/week_default.html',
            controller : 'week_defaultController as vm',
          }
        }
      })
      .state('app.pcReport_week_detail',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_week_detail/{regionId}/{inspectionId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/weekSafe/week_detail.html',
            controller : 'week_detailController as vm',
          }
        }
      })
      .state('app.pcReport_week_default.filter',{
        title:'周安全检查报表',
        noBack:true,
        // sendBt:false,
        url:'/pcReport_week_default/filter/{from}',
        templateUrl: 'app/main/pcReport/weekSafe/week_filter.html',
        controller: 'week_filterController as vm'
      })
  }
})();


/**
 * Created by lss on 2016/9/13.
 */

(function(){
  'use strict';

  week_filterController.$inject = ["$state", "$stateParams", "remote", "$scope", "$timeout", "xhscService", "$rootScope", "sxtlocaStorage"];
  angular
    .module('app.pcReport_week')
    .controller('week_filterController',week_filterController);

  /**@ngInject*/
  function week_filterController($state,$stateParams,remote,$scope,$timeout,xhscService,$rootScope,sxtlocaStorage){
    var vm=this;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    vm.display=true;

    var params= sxtlocaStorage.getObj("week_params")
    $scope.core=params?params:{};
    if ($scope.core.minDate){
      $scope.core.minDate=new Date($scope.core.minDate)
    }
    if($scope.core.maxDate){
      $scope.core.maxDate=new Date($scope.core.maxDate);
    }



    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      pc($scope,sxtlocaStorage,$rootScope,$timeout,$state);
    }else {
      mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage)
    }
    xhscService.getRegionTreeOffline("",3,1).then(function (r) {
      $scope.projects=r;
    });

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })

  }



  function pc($scope,sxtlocaStorage,$rootScope,$timeout,$state) {

    $scope.$watch("core.minDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("week_params");
        if (!params){
          params={};
        }
        params.minDate=v;
        sxtlocaStorage.setObj("week_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.maxDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("week_params");
        if (!params){
          params={};
        }
        params.maxDate=v;
        sxtlocaStorage.setObj("week_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentArea",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("week_params");
        if (!params){
          params={};
        }
        params.currentArea=v;
        sxtlocaStorage.setObj("week_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentProject",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("week_params");
        if (!params){
          params={};
        }
        params.currentProject=v;
        params.currentArea = {};
        $scope.core.currentArea = null;
        sxtlocaStorage.setObj("week_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)


    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_main");
    })
  }


  function mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage) {
    var from=$stateParams.from;
    $scope.ok=function () {
      vm.display=false;
      $rootScope.$emit("filter");
    }
    //详细里面返回
    if (from=="app.pcReport_week_detail"){
      vm.display=false;
      //展示明细
      $rootScope.$emit("show");
    }else {
      vm.display=true;

      $scope.$watch("core.minDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("week_params");
          if (!params){
            params={};
          }
          params.minDate=v;
          sxtlocaStorage.setObj("week_params",params);
        }
      },true)

      $scope.$watch("core.maxDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("week_params");
          if (!params){
            params={};
          }
          params.maxDate=v;
          sxtlocaStorage.setObj("week_params",params);
        }
      },true)

      $scope.$watch("core.currentArea",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("week_params");
          if (!params){
            params={};
          }
          params.currentArea=v;
          sxtlocaStorage.setObj("week_params",params);
        }
      },true)

      $scope.$watch("core.currentProject",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("week_params");
          if (!params){
            params={};
          }
          params.currentProject=v;
          sxtlocaStorage.setObj("week_params",params);
        }
      },true)
    }
    //返回按钮
    $rootScope.$on("goBack",function () {
      if (vm.display){
        $state.go("app.pcReport_main");
      }else {
        vm.display=true;
        $rootScope.$emit("hide")
      }
    })

  }

})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  week_detailController.$inject = ["$stateParams", "remote", "$rootScope", "$scope", "$state", "xhUtils"];
  angular
    .module('app.pcReport_week')
    .controller('week_detailController',week_detailController);

  /**@ngInject*/
  function week_detailController($stateParams,remote,$rootScope,$scope,$state,xhUtils){
    var inspectionId=$stateParams.inspectionId;
    var vm=this;

    vm.showImg=function (img) {
      img.url = img.FileContent||img.Url;
      img.alt = ' ';
      xhUtils.playPhoto([img]);
    }

    vm.up=function (item) {
      item.up=!item.up;
    }

    remote.report.getdetail('WeekInspects',inspectionId).then(function (r) {
      vm.source=r.data;

      //复验信息
      vm.source.reviewsItem={};
      vm.source.Reviews.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Reviews.length>0){
        vm.source.reviewsItem=vm.source.Reviews[vm.source.Reviews.length-1];
      }

      //验收信息
      vm.source.supervisionsItem={};
      vm.source.Supervisions.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Supervisions.length>0){
        vm.source.supervisionsItem=vm.source.Supervisions[vm.source.Supervisions.length-1];
      }
      //整改信息
      vm.source.rectifysItem={};
      vm.source.Rectifys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Rectifys.length>0){
        vm.source.rectifysItem=vm.source.Rectifys[vm.source.Rectifys.length-1];
      }

      vm.source.companysItem={};
      vm.source.Companys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Companys.length>0){
        vm.source.companysItem=vm.source.Companys[vm.source.Companys.length-1];
      }
    })

    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_week_default.filter",{from:"app.pcReport_week_detail"});
    })

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })
  }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function () {
  'use strict';

  week_defaultController.$inject = ["$state", "remote", "$scope", "$rootScope", "sxtlocaStorage", "$timeout"];
  angular
    .module('app.pcReport_week')
    .controller('week_defaultController', week_defaultController);

  /**@ngInject*/
  function week_defaultController($state, remote, $scope, $rootScope, sxtlocaStorage, $timeout) {
    var vm = this;
    vm.selectSize = 10;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    function load() {
      $timeout(function () {
        if (!vm.going) {
          vm.going = true;
          var params = sxtlocaStorage.getObj("week_params");
          params = params ? params : {};
          $scope.pageIndex = params.pageIndex ? params.pageIndex : 1;
          $scope.PageSize = params.pageSize ? params.pageSize : 10;
          var queryParams = {};
          queryParams.CurPage = $scope.pageIndex - 1;
          queryParams.PageSize = $scope.PageSize;

          if (params.minDate && !angular.isObject(params.minDate)) {
            queryParams.StartTime = params.minDate.toLocaleString();
          }

          if (params.maxDate && !angular.isObject(params.maxDate)) {
            queryParams.EndTime = params.maxDate.toLocaleString();
          }

          if (params.currentArea && params.currentArea.RegionID) {
            queryParams.AreaId = params.currentArea.RegionID;
          }

          if (params.currentProject && params.currentProject.RegionID) {
            queryParams.ProjectID = params.currentProject.RegionID;
          }


          remote.report.getWrapList('WeekInspects', queryParams).then(function (r) {
            vm.total = r.data.TotalCount;
            vm.source = r.data.Data;
            vm.going = false;
            $scope.display = true;
          }).catch(function () {
            vm.going = false;
            $scope.display = true;
          });
        }
      });
    }
    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      load();
    }
    //初始化
    var filter = $rootScope.$on("filter", function (event, data) {
      $scope.display = true;
      load();
    });


    vm.pageAction = function (bar, page, pageSize, total) {
      var params = sxtlocaStorage.getObj("week_params");
      params = params ? params : {};
      params.PageSize = pageSize;
      params.pageIndex = page;
      sxtlocaStorage.setObj(params);
      load();
    }

    $scope.$watch("vm.selectSize", function (v) {
      if (v) {
        var params = sxtlocaStorage.getObj("week_params");
        params = params ? params : {};
        params.PageSize = v;
        sxtlocaStorage.setObj(params);
        if ($scope.display) {
          load();
        }
      }
    })


    //隐藏列表
    var showDetail = $rootScope.$on("show", function (event, data) {
      $scope.display = true;
    });
    //展示列表
    var hideDetail = $rootScope.$on("hide", function (event, data) {
      $scope.display = false;
    });

    //明细
    vm.go = function (item) {
      $state.go("app.pcReport_week_detail", { regionId: item.AreaID, inspectionId: item.InspectionID });
    }

    $scope.$on("$destroy", function () {
      showDetail();
      filter();
      hideDetail();
    })
  }
})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
  module('app.pcReport_safeys',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_safeys_default',{
        title:"安全验收报表",
        url:'/pcReport_safeys_default/{display}',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/safeys/safeys_default.html',
            controller : 'safeys_defaultController as vm',
          }
        }
      })
      .state('app.pcReport_safeys_detail',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_safeys_detail/{regionId}/{inspectionId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/safeys/safeys_detail.html',
            controller : 'safeys_detailController as vm',
          }
        }
      })
      .state('app.pcReport_safeys_default.filter',{
        noBack:true,
        title:"安全验收报表",
        // sendBt:false,
        url:'/pcReport_safeys_default/filter/{from}',
        templateUrl: 'app/main/pcReport/safeys/safeys_filter.html',
        controller: 'safeys_filterController as vm'
      })
  }
})();


/**
 * Created by lss on 2016/9/13.
 */

(function(){
  'use strict';

  safeys_filterController.$inject = ["$state", "$stateParams", "remote", "$scope", "$timeout", "xhscService", "$rootScope", "sxtlocaStorage"];
  angular
    .module('app.pcReport_safeys')
    .controller('safeys_filterController',safeys_filterController);

  /**@ngInject*/
  function safeys_filterController($state,$stateParams,remote,$scope,$timeout,xhscService,$rootScope,sxtlocaStorage){
    var vm=this;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    vm.display=true;

    var params= sxtlocaStorage.getObj("safeys_params")
    $scope.core=params?params:{};
    if ($scope.core.minDate){
      $scope.core.minDate=new Date($scope.core.minDate)
    }
    if($scope.core.maxDate){
      $scope.core.maxDate=new Date($scope.core.maxDate);
    }



    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      pc($scope,sxtlocaStorage,$rootScope,$timeout,$state);
    }else {
      mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage)
    }
    xhscService.getRegionTreeOffline("",3,1).then(function (r) {
      $scope.projects=r;
    });

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })

  }



  function pc($scope,sxtlocaStorage,$rootScope,$timeout,$state) {

    $scope.$watch("core.minDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("safeys_params");
        if (!params){
          params={};
        }
        params.minDate=v;
        sxtlocaStorage.setObj("safeys_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.maxDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("safeys_params");
        if (!params){
          params={};
        }
        params.maxDate=v;
        sxtlocaStorage.setObj("safeys_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentArea",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("safeys_params");
        if (!params){
          params={};
        }
        params.currentArea=v;
        sxtlocaStorage.setObj("safeys_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentProject",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("safeys_params");
        if (!params){
          params={};
        }
        params.currentProject=v;
        params.currentArea = {};
        $scope.core.currentArea = null;
        sxtlocaStorage.setObj("safeys_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)


    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_main");
    })
  }


  function mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage) {
    var from=$stateParams.from;
    $scope.ok=function () {
      vm.display=false;
      $rootScope.$emit("filter");
    }
    //详细里面返回
    if (from=="app.pcReport_safeys_detail"){
      vm.display=false;
      //展示明细
      $rootScope.$emit("show");
    }else {
      vm.display=true;

      $scope.$watch("core.minDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("safeys_params");
          if (!params){
            params={};
          }
          params.minDate=v;
          sxtlocaStorage.setObj("safeys_params",params);
        }
      },true)

      $scope.$watch("core.maxDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("safeys_params");
          if (!params){
            params={};
          }
          params.maxDate=v;
          sxtlocaStorage.setObj("safeys_params",params);
        }
      },true)

      $scope.$watch("core.currentArea",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("safeys_params");
          if (!params){
            params={};
          }
          params.currentArea=v;
          sxtlocaStorage.setObj("safeys_params",params);
        }
      },true)

      $scope.$watch("core.currentProject",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("safeys_params");
          if (!params){
            params={};
          }
          params.currentProject=v;
          sxtlocaStorage.setObj("safeys_params",params);
        }
      },true)
    }
    //返回按钮
    $rootScope.$on("goBack",function () {
      if (vm.display){
        $state.go("app.pcReport_main");
      }else {
        vm.display=true;
        $rootScope.$emit("hide")
      }
    })

  }

})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  safeys_detailController.$inject = ["$stateParams", "remote", "$rootScope", "$scope", "$state", "xhUtils"];
  angular
    .module('app.pcReport_safeys')
    .controller('safeys_detailController',safeys_detailController);

  /**@ngInject*/
  function safeys_detailController($stateParams,remote,$rootScope,$scope,$state,xhUtils){
    var inspectionId=$stateParams.inspectionId;
    var vm=this;
    vm.showImg=function (img) {
      img.url = img.FileContent||img.Url;
      img.alt = ' ';
      xhUtils.playPhoto([img]);
    }
    remote.report.getdetail('Acceptances',inspectionId).then(function (r) {
      vm.source=r.data;
      //报验信息
      vm.source.mainContractorsItem={};
      vm.source.MainContractors.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.MainContractors.length>0){
        vm.source.mainContractorsItem=vm.source.MainContractors[0];
      }

      //验收信息
      vm.source.supervisionsItem={};
      vm.source.Supervisions.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Supervisions.length>0){
        vm.source.supervisionsItem=vm.source.Supervisions[vm.source.Supervisions.length-1];
      }
      //复验信息
      vm.source.reviewsItem={};
      vm.source.Reviews.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Reviews.length>0){
        vm.source.reviewsItem=vm.source.Reviews[vm.source.Reviews.length-1];
      }

      //整改信息
      vm.source.rectifysItem={};
      vm.source.Rectifys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })

      if (vm.source.Rectifys.length>0){
        vm.source.rectifysItem=vm.source.Rectifys[vm.source.Rectifys.length-1];
      }
      vm.up=function (item) {
        item.up=!item.up;
      }
      //建设单位
      vm.source.companysItem={};
      vm.source.Companys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Companys.length>0){
        vm.source.companysItem=vm.source.Companys[vm.source.Companys.length-1];
      }
    })

    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_safeys_default.filter",{from:"app.pcReport_safeys_detail"});
    })

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })
  }
})();

/**
 * Created by shaoshunliu on 2016/12/19.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function () {
  'use strict';

  safeys_defaultController.$inject = ["$state", "remote", "$scope", "$rootScope", "sxtlocaStorage", "$timeout"];
  angular
    .module('app.pcReport_safeys')
    .controller('safeys_defaultController', safeys_defaultController);

  /**@ngInject*/
  function safeys_defaultController($state, remote, $scope, $rootScope, sxtlocaStorage, $timeout) {
    var vm = this;
    vm.selectSize = 10;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    function load() {
      $timeout(function () {
        if (!vm.going) {
          vm.going=true;
          var params = sxtlocaStorage.getObj("safeys_params");
          params = params ? params : {};
          $scope.pageIndex = params.pageIndex ? params.pageIndex : 1;
          $scope.PageSize = params.pageSize ? params.pageSize : 10;
          var queryParams = {};
          queryParams.CurPage = $scope.pageIndex - 1;
          queryParams.PageSize = $scope.PageSize;

          if (params.minDate && !angular.isObject(params.minDate)) {
            queryParams.StartTime = params.minDate.toLocaleString();
          }

          if (params.maxDate && !angular.isObject(params.maxDate)) {
            queryParams.EndTime = params.maxDate.toLocaleString();
          }

          if (params.currentArea && params.currentArea.RegionID) {
            queryParams.AreaId = params.currentArea.RegionID;
          }

          if (params.currentProject && params.currentProject.RegionID) {
            queryParams.ProjectID = params.currentProject.RegionID;
          }

          remote.report.getYsReportList(queryParams).then(function (r) {
            $scope.display = true;
            vm.total = r.data.TotalCount;
            vm.source = r.data.Data;
            vm.going=false;
          }).catch(function(){
            $scope.display = true;
            vm.going=false;
          });


        }
      })
    }
    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      load();
    }
    //初始化
    var filter = $rootScope.$on("filter", function (event, data) {
      $scope.display = true;
      load();
    });


    vm.pageAction = function (bar, page, pageSize, total) {
      var params = sxtlocaStorage.getObj("safeys_params");
      params = params ? params : {};
      params.PageSize = pageSize;
      params.pageIndex = page;
      sxtlocaStorage.setObj(params);
      load();
    }

    $scope.$watch("vm.selectSize", function (v) {
      if (v) {
        var params = sxtlocaStorage.getObj("safeys_params");
        params = params ? params : {};
        params.PageSize = v;
        sxtlocaStorage.setObj(params);
        if ($scope.display) {
          load();
        }
      }
    })


    //隐藏列表
    var showDetail = $rootScope.$on("show", function (event, data) {
      $scope.display = true;
    });
    //展示列表
    var hideDetail = $rootScope.$on("hide", function (event, data) {
      $scope.display = false;
    });

    //明细
    vm.go = function (item) {
      $state.go("app.pcReport_safeys_detail", { regionId: item.AreaID, inspectionId: item.InspectionID });
    }

    $scope.$on("$destroy", function () {
      showDetail();
      filter();
      hideDetail();
    })
  }
})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

(function(){
  'use strict';
  scslReportController.$inject = ["$scope", "remote", "$mdDialog", "$stateParams", "$state", "$rootScope", "$q", "$window"];
  angular
    .module('app.pcReport_sl')
    .controller('scslReportController',scslReportController);

  /**@ngInject*/
  function scslReportController($scope,remote,$mdDialog,$stateParams,$state,$rootScope ,$q,$window){
    var vm = this;

    vm.scSelected=$stateParams.scSelected?$stateParams.scSelected:"";
    vm.secSeleced=$stateParams.secSelected;


    vm.show=false;
    vm.go=function(item,role){
      var relaArr=item.RelationID.split(',');
      var relationID;
      switch (role){
        case 0:
          relationID=relaArr.find(function (o) {
            return o.indexOf("_0")>-1;
          })
          break;
        case 2:
          relationID=relaArr.find(function (o) {
            return o.indexOf("_2")>-1;
          })
          break;
        default:
          relationID=relaArr.find(function (o) {
            return o.indexOf("_2")==-1&&o.indexOf("_0")==-1;
          })
          break;
      }
      $state.go("app.xhsc.scsl.schztb",{
        regionId: item.AreaID,
        RegionName: item.AreaName,
        name: item.AreaName,
        db:relationID,
        measureItemID: item.AcceptanceItemID,
        pname: item.MeasureItemName
      });
    }

    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    }

    vm.btnShow=function (item,indentiy) {
      var r =item.RelationID.indexOf(indentiy)>-1
      if (!r&&indentiy=='_4'){
        if (item.RelationID.indexOf('_0')==-1&&item.RelationID.indexOf('_2')==-1){
          return true
        }
      }
      return r;
    }

    $scope.$watch("pageing.pageSize",function(){
      if ($scope.pageing.pageSize){
        load();
      }
    },true);

    function load(){
      remote.Assessment.GetMeasureList({
        ProjectId: vm.secSeleced,
        AcceptanceItemIDs:vm.scSelected?[vm.scSelected]:[],
        PageSize: $scope.pageing.pageSize,
        CurPage: $scope.pageing.page-1
      }).then(function(r){
        $scope.pageing.total= r.data.TotalCount;
        vm.source= r.data.Data;
        vm.source.forEach(function (o) {
          o.MeasureTime=o.MeasureTime?o.MeasureTime:"";
        })
        vm.show=true;

      }).catch(function(){
        vm.show=true;
      });
    }
    //load();
    vm.pageAction=function(title, page, pageSize, total){
      $scope.pageing.page=page;
      load();
    }
    vm.goBack=function(){
      window.history.go(-1);
    }

    vm.Lookintoys = function(item){
      $state.go('app.xhsc.gx.gxzgreport',{InspectionId:item.InspectionId, acceptanceItemID:item.AcceptanceItemID,acceptanceItemName:item.AcceptanceItemName,projectId:item.ProjectID});
    }
  }
})();

/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function() {
    'use strict';

    scslFilterController.$inject = ["$scope", "remote", "$mdDialog", "$state", "$rootScope", "$timeout", "$window"];
    angular
        .module('app.pcReport_sl')
        .controller('scslFilterController', scslFilterController);

    /**@ngInject*/
    function scslFilterController($scope, remote, $mdDialog, $state, $rootScope, $timeout, $window) {
        var vm = this;
        $scope.currentSC;
        var mobileDetect = new MobileDetect(window.navigator.userAgent);
        vm.isMobile = mobileDetect.mobile();
        vm.isiPad = mobileDetect.mobile() == "iPad";
        $scope.$watch('project.pid', function() {
            $scope.currentSC = null;
            remote.Project.GetMeasureItemInfoByAreaID($scope.project.pid).then(function(r) {
                if (r && r.data) {
                    vm.mes = r.data;
                }
            })
        })
        $scope.$watch('project.pid', function() {
            if ($scope.project.pid || $scope.project.isGo) {
                load()
            } else {
                $scope.project.isGo = true;
            }
        })
        $scope.$watch('currentSC', function() {
            if ($scope.currentSC) {
                load()
            }

        })

      vm.go=function(item,role){
        var relaArr=item.RelationID.split(',');
        var relationID;
        switch (role){
          case 0:
            relationID=relaArr.find(function (o) {
              return o.indexOf("_0")>-1;
            })
            break;
          case 2:
            relationID=relaArr.find(function (o) {
              return o.indexOf("_2")>-1;
            })
            break;
          default:
            relationID=relaArr.find(function (o) {
              return o.indexOf("_2")==-1&&o.indexOf("_0")==-1;
            })
            break;
        }
        $state.go("app.xhsc.scsl.schztb",{
          regionId: item.AreaID,
          RegionName: item.AreaName,
          name: item.AreaName,
          db:relationID,
          measureItemID: item.AcceptanceItemID,
          pname: item.MeasureItemName
        });
      }

        if ($rootScope.scslFilter) {
            $scope.currentSC = $rootScope.scslFilter.currentSC;
            $scope.project = $rootScope.scslFilter.project;

        }
        $scope.pageing = {
            page: 1,
            pageSize: 10,
            total: 0
        }
        $scope.$watch("pageing.pageSize", function() {
            if ($scope.pageing.pageSize) {
                load();
            }
        }, true);

      vm.btnShow=function (item,indentiy) {
        var r =item.RelationID.indexOf(indentiy)>-1
        if (!r&&indentiy=='_4'){
          if (item.RelationID.indexOf('_0')==-1&&item.RelationID.indexOf('_2')==-1){
            return true
          }
        }
        return r;
      }
        function load() {
            remote.Assessment.GetMeasureList({
                ProjectId: $scope.project.pid ? $scope.project.pid : "",
                AcceptanceItemIDs: $scope.currentSC ? [$scope.currentSC] : [],
                PageSize: $scope.pageing.pageSize,
                CurPage: $scope.pageing.page - 1
            }).then(function(r) {
                $scope.pageing.total = r.data.TotalCount;
                vm.source = r.data.Data;
                vm.source.forEach(function(o) {
                    o.MeasureTime = o.MeasureTime ? o.MeasureTime : "";
                })
                $rootScope.scslFilter = {
                    currentSC: $scope.currentSC,
                    project: $scope.project
                }

            }).catch(function() {});
        }
        vm.pageAction = function(title, page, pageSize, total) {
            $scope.pageing.page = page;
            load();
        }

        vm.Lookintoys = function(item) {
            $state.go('app.xhsc.gx.gxzgreport', { InspectionId: item.InspectionId, acceptanceItemID: item.AcceptanceItemID, acceptanceItemName: item.AcceptanceItemName, projectId: item.ProjectID });
        }
        $scope.project = {
            isMore: true,
            onQueryed: function(data) {
                $scope.project.data = data;
            }
        };

        //--------------------------------------------以下为移动适配---------------------------------------
        vm.source = remote.Project.getMap();
        vm.gxSelected = [];
        vm.secSelected = [];
    }
})();

/**
 * Created by lss on 2016/9/14.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
    module('app.pcReport_pg',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_pg',{
        title:"现场评估报表",
        url:'/pcReport_pg',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/pgReport/pgReportFilter.html',
            controller : 'pgReportFilterController as vm',
          }
        }
      })
      .state('app.pcReport_pg_default',{
        url:'/pcReport_pg_default/{year}/{quart}',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/pgReport/pgDefault.html',
            controller : 'pgDefaultController as vm',
          }
        }
      })
      .state('app.pcReport_pg_pkresult',{
        noBack:true,
        sendBt:false,
        url:'/pkresult/{year}/{projectID}/{quarter}/{assessmentStage}',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/pchz.html',
            controller:'pchzController as vm'
          }
        }
      })
      .state('app.pcReport_pg_scRegion',{
        noBack:true,
        sendBt:false,
        url:'/scRegion/{year}/{projectID}/{quarter}/{assessmentStage}',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/scRegion.html',
            controller:'pgScRegionController as vm'
          }
        }
      })
      .state('app.pcReport_pg_xmb',{
      noBack:true,
      sendBt:false,
      url:'/pcReport_pg_xmb/{quarter}',
      views :{
        'content@app':{
          templateUrl : 'app/main/pcReport/pgReport/pg_xmb.html',
          controller:'pgXmbController as vm'
        }
      }
    })
      .state('app.pcReport_pg_zb',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_pg_zb/{quarter}',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/pg_zb.html',
            controller:'pgZbController as vm'
          }
        }
      })
      .state('app.pcReport_pg_jl',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_pg_jl/{quarter}',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/pg_jl.html',
            controller:'pgJlController as vm'
          }
        }
      })
      .state('app.pcReport_pg_class',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_pg_class/{quarter}',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/pg_class.html',
            controller:'pgClassController as vm'
          }
        }
      })
      .state('app.pcReport_pg_trial',{
      noBack:true,
      sendBt:false,
      url:'/pcReport_pg_trial/{areaId}',
      views :{
        'content@app':{
          templateUrl : 'app/main/pcReport/pgReport/pg_trial.html',
          controller:'pgTrialController as vm'
        }
      }
    })
      .state('app.pcReport_pg_rate',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_pg_rate',
        views :{
          'content@app':{
            templateUrl : 'app/main/pcReport/pgReport/pg_rate.html',
            controller:'pgRateController as vm'
          }
        }
      })
  }
})();

/**
 * Created by lss on 2016/9/18.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  pgScRegionController.$inject = ["$scope", "$stateParams", "$rootScope", "xhUtils", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgScRegionController',pgScRegionController);

  /** @ngInject */
  function pgScRegionController($scope,$stateParams,$rootScope,xhUtils,remote){
    var vm=this;
    remote.Assessment.queryRegions($stateParams).then(function (result) {
      vm.sections = result.data;
    });
  }

})();

/**
 * Created by UUI on 2017/1/7.
 */
(function(){
  'use strict';

  pgZbController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgZbController',pgZbController);

  /**@ngInject*/
  function pgZbController($scope,$stateParams,remote){
    var vm = this;
    var quarter=$stateParams.quarter;
    remote.report.getReportFormAssessmentZb(quarter).then(function (d) {
      vm.source=d.data;
      vm.loaded=true;
    });

  }
})();

/**
 * Created by UUI on 2017/1/7.
 */
(function(){
  'use strict';

  pgXmbController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgXmbController',pgXmbController);

  /**@ngInject*/
  function pgXmbController($scope,$stateParams,remote){
    var vm = this;
    var quarter=$stateParams.quarter;
    remote.report.getReportFormAssessmentXmb(quarter).then(function (d) {
      vm.source=d.data;
      vm.loaded=true;
    });

  }
})();

/**
 * Created by UUI on 2017/1/11.
 */

(function(){
  'use strict';

  pgTrialController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgTrialController',pgTrialController);

  /**@ngInject*/
  function pgTrialController($scope,$stateParams,remote){
    var vm = this;
    var areaId=$stateParams.areaId;
    remote.report.getReportFormAssessmentTrial(areaId).then(function (d) {
      vm.source=d.data.Body;
      vm.loaded=true;
    });

  }
})();

/**
 * Created by UUI on 2017/1/11.
 */

(function(){
  'use strict';

  pgRateController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgRateController',pgRateController);

  /**@ngInject*/
  function pgRateController($scope,$stateParams,remote){
    var vm = this;
    var areaId=$stateParams.areaId;
    remote.report.getReportFormAssessmentRate(areaId).then(function (d) {
      vm.source=d.data;
      wrap(vm.source);
      vm.loaded=true;
      if (!vm.source.Heads.length){
        vm.isShowbg=true;
      }

    });


    function wrap(source) {
      source.subTitle = [];
      if (source.Heads) {
        source.Heads.forEach(function (k) {
          k.Sub.forEach(function (n) {
            source.subTitle.push(n);
          });
        });

      }
    }
  }
})();

/**
 * Created by UUI on 2017/1/7.
 */
(function(){
  'use strict';

  pgJlController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgJlController',pgJlController);

  /**@ngInject*/
  function pgJlController($scope,$stateParams,remote){
    var vm = this;
    var quarter=$stateParams.quarter;
    remote.report.getReportFormAssessmentJl(quarter).then(function (d) {
      vm.source=d.data;
      vm.loaded=true;
    });

  }
})();

/**
 * Created by UUI on 2017/1/9.
 */

(function(){
  'use strict';

  pgClassController.$inject = ["$scope", "$stateParams", "remote"];
  angular
    .module('app.pcReport_pg')
    .controller('pgClassController',pgClassController);

  /**@ngInject*/
  function pgClassController($scope,$stateParams,remote){
    var vm = this;
    var quarter=$stateParams.quarter;
    remote.report.getReportFormAssessmentClass(quarter).then(function (d) {
      vm.source=d.data;
      wrap(vm.source);
      vm.loaded=true;
    });

    function wrap(source) {
      source.subTitle = [];
      if (source.Heads) {
        source.Heads.forEach(function (k) {
          k.Sub.forEach(function (n) {
            source.subTitle.push(n);
          });
        });
      }
    }

  }
})();

/**
 * Created by lss on 2016/9/14.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  pgReportFilterController.$inject = ["$scope", "remote", "$mdDialog", "$state", "$rootScope", "$timeout"];
  angular
    .module('app.pcReport_pg')
    .controller('pgReportFilterController',pgReportFilterController);

  /**@ngInject*/
  function pgReportFilterController($scope,remote,$mdDialog,$state,$rootScope,$timeout){
    var vm = this;
    $scope.year="";
    $scope.quart="";
    vm.yearSource=[
      2015,2016,2017,2018,2019,2020
    ];
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    vm.yearQuart=[{
      "id": 1,
      "text": "第一季度"
    }, {
      "id": 2,
      "text": "第二季度"
    }, {
      "id": 3,
      "text": "第三季度"
    }, {
      "id": 4,
      "text": "第四季度"
    }];
    if ($rootScope.pgReportFilter_load){
      $scope.year=$rootScope.pgReportFilter_load.year;
      $scope.quart=$rootScope.pgReportFilter_load.quart;
    }
    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    }
    $scope.$watch("year",function(){
      if (vm.isMobile&&!vm.isiPad){
        return;
      }
      if ($scope.year){
        load();
      }
    });
    $scope.$watch("quart",function(){
      if (vm.isMobile&&!vm.isiPad){
        return;
      }
      if ($scope.quart){
        load();
      }
    });
    $scope.$watch("pageing.pageSize",function(){
      if ($scope.pageing.pageSize){
        load();
      }
    },true);
    vm.ck=function(item){
      $scope.year=item;
    }
    vm.ck_quart=function(item){
      $scope.quart=item.id;
    }
    function load(){
      remote.Assessment.GetAsssmentReportLst({
        Curpage:$scope.pageing.page-1,
        PageSize:$scope.pageing.pageSize,
        Year:$scope.year?$scope.year:0,
        Quarter:$scope.quart?$scope.quart:0
      }).then(function(r){
        $scope.pageing.total= r.data.TotalCount;
        if (r&& r.data){
          vm.source= r.data.Data;
        }
        $rootScope.pgReportFilter_load={
          year:$scope.year,
          quart:$scope.quart
        }
      }).catch(function(){
      });
    }

    vm.filter=function(){
      $state.go("app.pcReport_pg_default",{
        year:$scope.year,
        quart:$scope.quart
      });
    }
    vm.pageAction=function(title, page, pageSize, total){
      $scope.pageing.page=page;
      load();
    }
    vm.gohz=function(item){
      $state.go("app.pcReport_pg_pkresult",{
        year:item.Year,
        projectID:item.AssessmentProjectID,
        quarter:item.Quarter,
        assessmentStage:item.AssessmentStage
      })
    }
    vm.gosc=function(item){
      $state.go("app.pcReport_pg_scRegion",{
        year:item.Year,
        projectID:item.AssessmentProjectID,
        quarter:item.Quarter,
        assessmentStage:item.AssessmentStage
      })
    }
  }
})();

/**
 * Created by lss on 2016/9/14.
 */
/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';
  pgDefaultController.$inject = ["$scope", "remote", "$mdDialog", "$state", "$rootScope", "$timeout", "$stateParams"];
   angular
    .module('app.pcReport_pg')
    .controller('pgDefaultController',pgDefaultController);

  /**@ngInject*/
  function pgDefaultController($scope,remote,$mdDialog,$state,$rootScope,$timeout,$stateParams){
    var vm = this;

    $scope.year=$stateParams.year?$stateParams.year:"";
    $scope.quart=$stateParams.quart?$stateParams.quart:"";

    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    }

    vm.show=false;
    $scope.$watch("pageing.pageSize",function(){
      if ($scope.pageing.pageSize){
        load();
      }
    },true);

    function load(){
      remote.Assessment.GetAsssmentReportLst({
        Curpage:$scope.pageing.page-1,
        PageSize:$scope.pageing.pageSize,
        Year:$scope.year?$scope.year:0,
        Quarter:$scope.quart?$scope.quart:0
      }).then(function(r){
        $scope.pageing.total= r.data.TotalCount;
        if (r&& r.data){
          vm.source= r.data.Data;
        }
        vm.show=true;
      }).catch(function(){
        vm.show=true;
      });
    }

    vm.pageAction=function(title, page, pageSize, total){
      $scope.pageing.page=page;
      load();
    }
    vm.gohz=function(item){
      $state.go("app.pcReport_pg_pkresult",{
        year:item.Year,
        projectID:item.AssessmentProjectID,
        quarter:item.Quarter,
        assessmentStage:item.AssessmentStage
      })
    }
    vm.gosc=function(item){
      $state.go("app.pcReport_pg_scRegion",{
        year:item.Year,
        projectID:item.AssessmentProjectID,
        quarter:item.Quarter,
        assessmentStage:item.AssessmentStage
      })
    }
    vm.goBack=function(){
      window.history.go(-1);
    }
  }
})();
/**
 * Created by lss on 2016/9/14.
 */

/**
 * Created by lss on 2016/9/18.
 */
/**
 * Created by emma on 2016/4/29.
 */
(function(){
  'use strict';

  pchzController.$inject = ["$scope", "$stateParams", "xhUtils", "remote", "$mdDialog", "utils", "$q", "$timeout"];
  angular
    .module('app.pcReport_pg')
    .controller('pchzController',pchzController);

  /** @ngInject*/
  function pchzController($scope,$stateParams,xhUtils,remote,$mdDialog,utils,$q,$timeout){
    var vm = this;
    var params={
      year:$stateParams.year,
      projectID:$stateParams.projectID,
      quarter:$stateParams.quarter,
      assessmentStage:$stateParams.assessmentStage
    };
    vm.params =params;
    $q.all([
      remote.Assessment.queryReport_9090(params.year,params.quarter,params.projectID,params.assessmentStage),
      remote.Assessment.queryProjectRegionInfo_9090(params.projectID)
    ]).then(function(result){
      var  r=result[0];
      var  prj=result[1];
      onQueryBase(r.data,prj.data);
    },function(error){

    })
    //remote.Assessment.queryReport(params.year,params.quarter,params.projectID).then(function(r){
    //   onQueryBase(r.data);
    //});
    remote.Assessment.queryTotalReport_9090(params.year,params.quarter,params.projectID,params.assessmentStage).then(function(t){
      vm.toTalReport= t.data;
      setRoleScore();
    });
    function setRoleScore(){
      vm.prjScores=[];
      vm.jlScores=[];
      vm.zbScores=[];
      vm.toTalReport.Sections.sort(xhUtils.sort(function (s) {
        return s.SectionName;
      }));
      vm.toTalReport.Sections.forEach(function(r){
        vm.prjScores.push(findRole(4, r.SectionID));
        vm.prjScores.avg=avg(vm.prjScores);
        vm.jlScores.push(findRole(2, r.SectionID));
        vm.jlScores.avg=avg(vm.jlScores);
        vm.zbScores.push(findRole(1, r.SectionID));
        vm.zbScores.avg=avg(vm.zbScores);
        vm.toTalReport.AssessmentTypes.forEach(function(k){
          SetTypeScore(k, r.SectionID);
        });
      });
    }
    function SetTypeScore(assessmentCategory,sectionID){
      var sections=assessmentCategory.CategorySections;
      if (angular.isArray(sections)){
        var  z=[];
        if (angular.isArray(assessmentCategory.sectionScore)){
          z=assessmentCategory.sectionScore;
        }
        var  t=sections.find(function(t){
          return t.SectionID==sectionID;
        });
        if (!t){
          z.push({
            SectionID:sectionID
          });
        }else {
          z.push(t);
        }
        assessmentCategory.sectionScore=z;
      }
      if (angular.isArray(assessmentCategory.AssessmentCategorys)){
        assessmentCategory.AssessmentCategorys.forEach(function(k){
          SetTypeScore(k,sectionID);
        });
      }
    }

    function avg(arr){
      var score=0,l=0;
      if (angular.isArray(arr)){
        arr.forEach(function(t) {
          if (t.Score === 0)t.Score = '';
          if (t.Score) {
            l++;
            score = score ? score + t.Score : t.Score;
          }
        });
      }
      if (score){
        return (score/l).toFixed(4);
      }
      return "";
    }
    function findRole(roleType,sectionID){
      var role= vm.toTalReport.AssessmentRoles.find(function(t){
        return t.RoleType==roleType;
      });
      if (role){
        return role.SectionScores.find(function(t){
          return t.SectionID==sectionID;
        });
      }
      return {};
    }

    function onQueryBase(item,region) {
      //管理行为界面控制开关
      vm.showfitObj=false;
      item.Assessments.sort(xhUtils.sort(function (s) {
        return s.SectionName;
      }));
      vm.sections=item.Assessments;
      vm.items = {
        AssessmentClassifys:[]
      };
      vm.caches = {
        AssessmentClassifys:[]
      }

      function  setshow(o){
        o.show=false;
        if(angular.isArray(o.AssessmentItems)&& o.AssessmentItems.length>0){
          for(var i=0;i<o.AssessmentItems.length;i++){
            var x= o.AssessmentItems[i].AssessmentItemResults;
            if (angular.isArray(x)&& x.length>0){
              o.AssessmentItems[i].show=o.show=true;
            }
          }
        }else {
          if (angular.isArray(o.AssessmentClassifys)&& o.AssessmentClassifys.length>0){
            for (var i=0;i<o.AssessmentClassifys.length;i++){
              if (setshow(o.AssessmentClassifys[i])){
                o.show=true;
              }
            }
          }
        }
        return o.show;
      }

      function  gl_setshow(o){
        o.show=false;
        if(angular.isArray(o.AssessmentItems)&& o.AssessmentItems.length>0){
          for(var i=0;i<o.AssessmentItems.length;i++){
            o.AssessmentItems[i].show=o.show=true;
          }
        }else {
          if (angular.isArray(o.AssessmentClassifys)&& o.AssessmentClassifys.length>0){
            for (var i=0;i<o.AssessmentClassifys.length;i++){
              if (gl_setshow(o.AssessmentClassifys[i])){
                o.show=true;
              }
            }
          }
        }
        return o.show;
      }

      item.AssessmentTypes.forEach(function (t) {
        t.AssessmentClassifys.forEach(function (cls) {
          vm.items.AssessmentClassifys.push({
            AssessmentClassificationName:cls.AssessmentClassificationName,
            show:true
          });
          cls.show=true;
          vm.caches.AssessmentClassifys.push(cls);
        });
      });
      fillRegion(vm.caches,item.Assessments,region);

      $scope.$watch('vm.selectedIndex',function () {
        vm.loading = true;
        vm.showfitObj =false;
        $timeout(function () {
          if(vm.selectedIndex>=0&&vm.selectedIndex<vm.items.AssessmentClassifys.length){
            var k = vm.items.AssessmentClassifys[vm.selectedIndex];

            vm.isAddScore=k.AssessmentClassificationName.indexOf("加分")!=-1;
            vm.isDScore = k.AssessmentClassificationName.indexOf("扣分")!=-1;
            vm.showfitObj= vm.isAddScore || vm.isDScore || k.AssessmentClassificationName.indexOf("管理行为")!=-1;
            if (!k.AssessmentClassifys){
              var assessmentClassifys= vm.caches.AssessmentClassifys[vm.selectedIndex].AssessmentClassifys;
              if (k.AssessmentClassificationName.indexOf("管理行为")!=-1
                ||k.AssessmentClassificationName.indexOf("加分")!=-1 ||k.AssessmentClassificationName.indexOf("扣分")!=-1
              ){
                assessmentClassifys.forEach(function(t){
                  gl_setshow(t);
                });
                //vm.showfitObj=true;
              }else {
                assessmentClassifys.forEach(function(t){
                  setshow(t);
                });
              }
              k.AssessmentClassifys =assessmentClassifys;
              k.level = getEvels(k,1);
            }
          }else {
            remote.Assessment.queryTotalReport(params.year,params.quarter,params.projectID,params.assessmentStage).then(function(t){
              vm.toTalReport= t.data;
              setRoleScore();
            });
          }
          $timeout(function () {
            vm.loading = false;
            if(!vm.inited)
              vm.inited = true;
          },200);
        },800);

      })
    }

    function setPath(item,_region,region){
      var parent= region.find(function(t){
        return _region.ParentID== t.RegionID&& t.RegionType>2;
      });
      if (parent){
        item.RegionName=parent.RegionName+">"+item.RegionName;
        setPath(item,parent,region);
      }
    }

    function fillRegion(k,sections,region) {
      if(k.AssessmentItems){
        k.AssessmentItems.forEach(function (item) {
          item.scoreList=[];
          var resultItem = item.AssessmentItemResults;
          var itemResult,tmp,sectionScore;
          sections.forEach(function(t){
            sectionScore={
              sectionID: t.SectionID,
              ModifyScore:"",
              DelScore:"",
              Description:""
            }
            //Description
            if (angular.isArray(resultItem)&&resultItem.length>0){
              itemResult=resultItem.find(function(k){
                return k.SectionID== t.SectionID;
              });
              if (itemResult){
                tmp=itemResult.ModifyScore;
                if (!tmp&&tmp!==0){
                  tmp=itemResult.TotalScore;
                }
                sectionScore.ModifyScore=tmp;
                tmp=item.Weight-sectionScore.ModifyScore;
                sectionScore.Weight = item.Weight;
                sectionScore.DelScore=tmp;
                sectionScore.Description=itemResult.Description;
                if (angular.isArray(itemResult.AssessmentRegionItemResults)){
                  var _region;
                  itemResult.AssessmentRegionItemResults.forEach(function(q){
                    _region=region.find(function(v){
                      return v.RegionID==q.RegionID;
                    })
                    if (_region){
                      setPath(q,_region,region);
                    }
                  })
                }
              }
            }else {
              sectionScore.ModifyScore= 0;
            }
            item.scoreList.push(sectionScore);
          });

        });
      }
      if(k.AssessmentClassifys){
        k.AssessmentClassifys.forEach(function (c) {
          fillRegion(c,sections,region);
        })
      }
    }
    vm.bindSectionScore=function(item,sectionID,field){
      var scoreList=item.scoreList;
      var score;
      if (angular.isArray(scoreList)&&scoreList.length>0){
        score= scoreList.find(function(t){
          return t.sectionID==sectionID;
        });
        if (score){
          if(field=='DelScore'){
            if(vm.isAddScore || vm.isDScore){
              field = 'ModifyScore';
            }
          }else if(field=='ModifyScore'){
            if(vm.isDScore) return '';
          }
          return score[field];
        }
      }
      return "";
    }

    vm.showkf=function(item,sectionID,field){
      var kf= vm.bindSectionScore(item,sectionID,field);
      return  angular.isNumber(kf);
    }
    vm.showfitlogol=function(item,sectionID,field){
      var kf= vm.bindSectionScore(item,sectionID,field);
      return  angular.isNumber(kf)&&kf!=0;
    }
    vm.getSectionName=function(sectionID){
      var section=vm.sections.find(function(o){
        return o.SectionID==sectionID;
      });
      return section?section.SectionName:"";
    }
    vm.getW = function (level,t) {
      if(level==1){
        return 10.0/t;
      }
      else{
        return 10.0/t /(100 - vm.getW(level-1,t))*100;
      }
    }

    function getEvels(item,level) {
      if(item.AssessmentClassifys && item.AssessmentClassifys.length){
        var levels = [],max=0;
        item.AssessmentClassifys.forEach(function (item) {
          levels.push(getEvels(item,level));
        });
        levels.forEach(function (l) {
          if(max<l)
            max = l;
        });
        return max;
      }
      return level+1;
    }

    vm.quesDetail = function(item,region,ev) {
      var images=[];
      region.DeductScoreItems.forEach(function(item){
        item.Images.forEach(function (img) {
          images.push({
            url:sxt.app.fs+img.ImageUrl,
            alt:item.ProblemDescription + (item.PartDescriptioin?'(部位:'+ item.PartDescriptioin+')':'')
          });
        })
      })

      if(images.length)
      {
        xhUtils.playPhoto(images);
      }
      else
      {
        $mdDialog.show({
          controller: ['$scope','$mdDialog',function ($scope, $mdDialog) {
            $scope.item=item;

            $scope.cancel = function(){
              $mdDialog.hide()
            }
          }],
          templateUrl:'app/main/xhsc/ys/pcQuestion.html',
          parent: angular.element(document.body),
          targetEvent: ev,
          clickOutsideToClose:true,
          focusOnOpen:false
        })
      }

    }

    vm.deleteScoreItem = function (q) {
      console.log('q',q)
    }
    vm.changeScore = function (item,k,$event) {
      console.log(item);
      var obj= item.scoreList.find(function(v){
        return v.sectionID== k.SectionID;
      });
      $mdDialog.show(
        {
          controller: ['$scope','$mdDialog','showfitObj',function ($scope, $mdDialog,showfitObj) {
            $scope.showfitObj = showfitObj;
            $scope.cancel = function(){
              $mdDialog.hide()
            }
            $scope.item= {
              value: (vm.isAddScore||vm.isDScore)?obj.ModifyScore: obj.DelScore,
              reason:obj.Description,
              isAddScore:vm.isAddScore,
              isDScore:vm.isDScore
            }
            $scope.delScore = function(result){
              $mdDialog.hide(result)
              item.kf = result.value;
              item.des = result.reason;
            }
            $scope.noScore = function(result){
              item.kf = result.value = 0;
              item.des = result.reason ='符合要求';
              $mdDialog.hide(result);
            }
          }],
          templateUrl:'app/main/xhsc/ys/glxwInput.html',
          parent: angular.element(document.body),
          targetEvent: $event,
          clickOutsideToClose:false,
          focusOnOpen:false,
          locals :{showfitObj:vm.showfitObj}
        }
      ).then(function (result) {
        if(result){
          var r = parseFloat(result.value),
            r1 = (vm.isAddScore || vm.isDScore) ?r :  item.Weight -r
          if(!isNaN(result.value)){
            if(item.Weight<result.value || result.value<0){
              utils.alert('输入的值应该介于0 与 '+item.Weight + ' 之间');
              return;
            }
            remote.Assessment.modifyScore({
              AssessmentID:k.AssessmentID,
              AssessmentCheckItemID:item.AssessmentCheckItemID,
              ModifyScore: r1,
              Description:result.reason

            }).then(function (z) {
              if (z.data.ErrorCode==0){
                obj.DelScore = r;
                obj.ModifyScore = r1;
                obj.Description=result.reason;
              }else {
                utils.alert('失败：'+ z.data.ErrorMessage);
              }
            }).catch(function (z) {
              utils.alert('失败：服务器返回错误');
            })
          }
          else{
            utils.alert('应该输入半角数字');
          }
        }
      })
    }
  }
})();

(function(angular,undefined){
  'use strict';
  config.$inject = ["apiProvider"];
  angular
    .module('app.insideYs')
    .config(config);

  /** @ngInject */
  function config(apiProvider){
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('insideYs', {
      batch: {
        getList: function (param) {
          return $http.get($http.url('/api/v1/enterpirse/report/problemdetails', {rectifyOu: param.rectifyOu, status: param.status}));
        }
      }
    })
  }
})(angular,undefined);
/**
 * Created by emma on 2016/9/20.
 */
(function(){
  'use strict';

  angular
    .module('app.pcReport_sl')
    .directive('sxtSelectJd', ["utils", "$rootScope", function (utils, $rootScope) {
      var joinArr = function(arr) {
        var n = [];
        arr.forEach(function(a) {
          n.push(a[0]);
        })
        return n.join('');
      }
      var newSt = function (index, idField, nameField, items, label, selected, noSync) {
        var nt = [],
          letters = [],
          filters = [];
        letters.push({
          $id: '',
          selected: true,
          $name: '所有'
        })
        items.forEach(function(item) {
          var n = typeof item == 'object' ? item : {
            $id: item,
            $name: item
          };
          item.$id = item[idField];
          item.$name = item[nameField];
          item.$letter = joinArr(Pinyin.getPinyinArrayFirst(item.$name));
          item.$lf = item.$letter.substring(0, 1).toUpperCase();
          var fl = item.$lf;
          if (!letters.find(function(f) {
              return f.$name == fl;
            }))
            letters.push({
              $id: fl,
              $name: fl,
              selected: false
            });
        });
        letters.sort(function(s1, s2) {
          return s1.$id.localeCompare(s2.$id);
        });
        var filter = function(lt,all) {
          letters.forEach(function(it) {
            it.selected = false;
          });
          lt.selected = true;
          filters.length = 0;
          items.forEach(function(item) {
            if ((lt.$id == '' || item.$lf == lt.$id) && (all || index != 0 || filters.length < 5)) {
              filters.push(item);
            }
          });
        }
        filter(letters[0]);
        return {
          label: label,
          index: index,
          letters: letters,
          items: items,
          filters: filters,
          filter: filter,
          extend: false,
          more: false,
          selected: selected,
          noSync:noSync,
          keyChanged:function(){
            var s = this;
            letters.forEach(function (it) {
              it.selected = false;
            });
            filters.length = 0;
            items.forEach(function (item) {
              if ((!s.key || (item._ix = item.$letter.indexOf(s.key)) != -1) &&(index!=0 || filters.length < 5)) {
                filters.push(item);
              }
            });
            filters.sort(function (a, b) {
              return (a._ix || 0) - (b._ix || 0);
            })
          },
          toggleExtend: function() {
            this.extend = !this.extend;
          },
          toggleMore: function() {
            this.more = !this.more;
          }
        }
      }
      return {
        transclude: true,
        scope: {
          value: '=ngModel',
          valueName: '=',
          idTree: '=',
          nameTree: '=',
          onQuery: '=',
          onChange: '=',
          isMore: '=',
          cache: '@'
        },
        templateUrl:'app/main/pcReport/directive/sxt-select.html',
        link: function(scope, element, attr, ctrl) {
          scope.selectors = [];
          scope.isMore = true;
          var syncValue = function () {
            if (!scope.selectors.length || !scope.selectors[0].selected) {
              scope.value =
                scope.idTree =
                  scope.nameTree = null;
            } else {
              var i = 0,
                c = scope.selectors[i],
                idTree = [],
                nameTree = [];
              while (c) {
                if (!c.selected) break;
                idTree.push(c.selected.$id);
                nameTree.push(c.selected.$name);
                scope.value = c.selected.$id;
                scope.valueName = c.selected.$name;
                c = scope.selectors[++i];
              }
              scope.idTree = idTree.join('>');
              scope.nameTree = nameTree.join('>');
            }
            scope.onChange && scope.onChange(scope);
          }

          scope.toggleMore = function() {
            scope.isMore = !scope.isMore;
          }
          scope.isShow = function(item) {
            return !item.selected && (scope.isMore || item.index < 1);
          }
          scope.item_clear = function (index) {
            scope.selectors.splice(index + 1, scope.selectors.length);
            scope.selectors[index].selected = null;
            syncValue();
            var q = scope.onQuery(index, newSt, scope.selectors.length > 1 ? scope.selectors[index - 1].selected.$id : null, scope);
            if (q) {
              q.then(function(result) {
                var next = result;
                scope.selectors[index] = next;
                if (!$rootScope.$$phase) {
                  scope.$apply();
                }
              });
            } else {

            }
          };
          scope.item_back = function (index) {
            var i = 0;
            var arr = [];
            for(var i=0;i<scope.selectors.length;i++){
              if (scope.selectors[i].selected != undefined)
              { arr.push(scope.selectors[i].index); }
            }
            var iLen = arr.length-1;

            scope.selectors.splice(iLen + 1, scope.selectors.length);
            scope.selectors[iLen].selected = null;
            syncValue();
            var q = scope.onQuery(iLen, newSt, scope.selectors.length > 1 ? scope.selectors[iLen - 1].selected.$id : null,scope);
            if (q) {
              q.then(function (result) {
                var next = result;
                scope.selectors[iLen] = next;
              });
            }


          };
          scope.item_selected = function(item, index, noSync) {
            var cnt = scope.selectors[index];
            cnt.selected = item;
            var next = scope.selectors[index + 1];
            if (noSync !== false)
              syncValue();

            var q = scope.onQuery(index + 1, newSt, item.$id,scope);
            if (q) {
              q.then(function(result) {
                next = result;
                scope.selectors[index + 1] = next;
                if (result.selected)
                  scope.item_selected(result.selected, scope.selectors.length - 1, false);
                if (result.noSync===false || noSync === false)
                  syncValue();

                if (!$rootScope.$$phase) {
                  scope.$apply();
                }
              });
            }
          }
          scope.onQuery(0, newSt, scope.value,scope).then(function(result) {
            scope.selectors.push(result);
            if (result.selected)
              scope.item_selected(result.selected, scope.selectors.length - 1, false);
          });
        }
      }
    }])
})();

/**
 * Created by lss on 2016/10/10.
 */
/**
 * Created by lss on 2016/10/7.
 */
(function () {
  'use strict';
  sxtScMskCharts.$inject = ["api", "$window", "$timeout", "$state", "$q", "remote"];
  angular
    .module('app.pcReport_sl')
    .directive('sxtScMskCharts',sxtScMskCharts);

  /** @ngInject */
  function sxtScMskCharts(api,$window,$timeout,$state,$q,remote) {
    return {
      scope: {
        build:'=',
        procedures:'='
      },
      link: function (scope, element) {
        var query = null;
        scope.build.query = function () {
          var  legend = [
            {value: 0, label: '未验', color: 'rgba(225,225,225,1)'},
            {value: 2, label: '总包已验', color: 'rgba(0,150,136,1)'},
            {value: 4, label: '监理已验收', color: 'rgba(44,157,251,1)'},
            //{value: 4, label: '不合格', color: 'red'},
            //{value: 8, label: '未整改', color: 'rgba(0,150,136,1)'},
            //{value: 16, label: '已整改', color: 'rgba(249,98,78,1)'}
          ];
          function setYAxis(){
            var regions=[];
            scope.build.regions.forEach(function(k){
              regions.push(angular.extend({},k));
            });
            if (!angular.isArray(regions)||!regions.length){
              return [];
            }
            var  floors=[];

            regions.forEach(function(k){
              if (k.RegionType==8){
                floors.push(k);
              }
            });
            var maxRoomLen=0;
            floors.forEach(function(k){
              k.rooms=[];
              regions.forEach(function(n){
                if (n.RegionType==16&& n.RegionID.indexOf(k.RegionID)>-1){
                  n.parent=k;
                  k.rooms.push(n);
                }
              });
              if (k.rooms.length>maxRoomLen){
                maxRoomLen=k.rooms.length;
              }
              scope.procedures.forEach(function(n){
                //AcceptanceItemID
                var st= scope.build.status.find(function(m){
                  return m.AcceptanceItemID== n.AcceptanceItemID&& k.RegionID== m.AreaId;
                })
                if (st){
                  k.status= k.status?k.status:{};
                  k.status[st.AcceptanceItemID]=st.Status>2?4:st.Status;
                }
              })
            })
            floors.maxRoomLen=maxRoomLen;

            floors.forEach(function(k){
                if (!k.rooms.length){
                  if (!floors.maxRoomLen){
                    k.rooms.push({
                      parent:k,
                      RegionID:-1,
                      RegionName:""
                    })
                    floors.maxRoomLen=1;
                  }else {
                    for (var i=0;i<floors.maxRoomLen;i++){
                      k.rooms.push({
                        parent:k,
                        RegionID:-1,
                        RegionName: k.RegionName+i>9?i:("0"+i)
                      })
                    }
                  }
                }
            })
            return floors;
          }
          //y轴
          var yAxisSource=setYAxis();
          var yAxis= $.map(yAxisSource,function(k){
            return k.RegionName;
          })
          //X轴
          function setXAxis(){
            var maxRoomLen=yAxisSource.maxRoomLen;
            var xAxis=[];
            scope.procedures.forEach(function(k){
              for (var i=0;i<=maxRoomLen;i++){
                xAxis.push({
                  AcceptanceItemID: k.AcceptanceItemID,
                  MeasureItemName:k.MeasureItemName
                });
              }
            })
            return xAxis;
          }
          var xAxisSource=setXAxis();
          var xAxis= $.map(xAxisSource,function(k){
            return k.MeasureItemName;
          });
          //设置serial
          function  setSeries(){
            function  setStatus(i,j){
              function  setRoomStatus(room){
                if (!room){
                  return "-";
                }
                var acceptanceItemID= x.AcceptanceItemID;
                var parent=room.parent;
                if (parent.status&&(parent.status[acceptanceItemID]||parent.status[acceptanceItemID]===0)){
                  return parent.status[acceptanceItemID];
                }
                var st= scope.build.status.find(function(m){
                  return m.AcceptanceItemID== acceptanceItemID&& room.RegionID== m.AreaId;
                })
                return  st? st.Status>2?4:st.Status:0;
              }

              //0 1 2 3 4 5 6 7
              var len=yAxisSource.maxRoomLen;
              if ((i+1)%(len+1)){
                var x=xAxisSource[i];
                var y=yAxisSource[j];
                var room= y.rooms[i%len]
                return setRoomStatus(room,x);
              }
              return "-";
            }

            var serial=[[]];
            var  t;
            var len=yAxisSource.maxRoomLen;
            for (var  j=0;j<yAxisSource.length;j++){
              for (var  i=0;i<xAxisSource.length;i++){
                var status=setStatus(i,j);
                serial.push([i,j,status]);
              }
            }
            return serial;
          }
          var  serial=setSeries();
          serial.shift();
          var option = {
            tooltip: {
              show:false
            },
            grid: {
            },
            xAxis: {
              type: 'category',
              data:xAxis,
              axisLabel: {
                interval: function (index, value) {
                  return index % (yAxisSource.maxRoomLen + 1) == parseInt((yAxisSource.maxRoomLen)/2);
                  return true;
                },
                show: true
              },
              splitArea: {
                show: false
              }
            },
            yAxis: {
              type: 'category',
              data: yAxis,
              min: 0,
              max: 50,
              interval: 1,
              axisLabel: {
                textStyle: {
                  fontSize: 8
                }
              },
              splitArea: {
                show: false
              }
            },
            visualMap: [{
              top:0,
              type: 'piecewise',
              pieces: legend,
              show: true,
              min: 0,
              max: 32,
              calculable: false,
              itemWidth: 5,
              orient: 'horizontal'
            }],
            series: [
              {
                type: 'heatmap',
                data:serial,
                label: {
                  normal: {
                    show: false,
                    textStyle: {
                      fontSize: 5
                    }
                  }
                },
                itemStyle: {
                  normal: {
                    borderWidth: 1,
                    borderColor: 'rgba(255, 255, 255, 1)'
                  },
                  emphasis: {
                    shadowBlur: 10,
                    shadowColor: 'rgba(0, 0, 0, 1)'
                  }
                }
              }
            ]
          };
          $timeout(function(){
            var myChart = $window.echarts.init(element[0]);
            myChart.setOption(option);
          })
        };
      }
    }
  }

})();

/**
 * Created by shaoshunliu on 2016/12/20.
 */
/**
 * Created by emma on 2016/8/4.
 */
(function () {
  'use strict';

  sxtReportView.$inject = ["$timeout", "remote", "mapPopupSerivce", "sxt", "utils", "$q", "$window", "xhUtils"];
  angular
    .module('app.pcReport_sl')
    .directive('sxtReportView', sxtReportView);

  /**@ngInject*/
  function sxtReportView($timeout, remote, mapPopupSerivce, sxt, utils, $q, $window, xhUtils) {
    return {
      scope: {
        regionId: '=',
        inspectionId: '=',
        ponits: '=',
        type: "=",
        disableInspect: '=',
        disableDrag: '=',
        ct: '=',
        loaded: "="
      },
      link: link
    };

    function link(scope, element, attr, ctrl) {
      scope.ct && (scope.ct.loading = true);
      var map, fg;
      var install = function () {
        if (!map) {
          map = new $window.L.glProject(element[0], {
            map: {
              zoomControl: false
            }
          });
          fg = $window.mapboxgl.Plan({
            disableInspect: true,
            disableDrag: true,
            onChangeMode: function (mode, op, cb) {
              if (mode && !op) {
                scope.item = {
                  ProblemID: null,
                  ProblemSortName: '✔',//'',
                  ProblemDescription: ''
                };
              }
              cb();
            },
            onLoad: function (cb) {
              if (angular.isArray(scope.ponits)) {
                var fs = [];
                scope.ponits.forEach(function (p) {
                  if (p.Geometry) {
                    p.geometry = $window.JSON.parse(p.Geometry);
                  } else {
                    p.geometry = p.geometry;
                  }
                  if (!p.geometry) return;
                  // c.ProblemDescription = c.IndexPointID ? c.ProblemDescription : '合格';
                  p.geometry.properties.seq = p.ProblemSortName;
                  if (p.geometry.geometry.type == 'Stamp')
                    p.geometry.geometry.type = 'Point';
                  function convert(status) {
                    switch (status) {
                      case 8:
                      case 4:
                        return 1;
                      case 16:
                        return 8;
                    }
                    return status;
                  }
                  p.geometry.properties.Status = convert(p.Status);
                  // if (!p.IndexPointID) {
                  //   p.geometry.properties.Status = 2;
                  // } else {
                  //   p.geometry.properties.Status = 1;
                  // }

                  fs.push(p.geometry);
                });
              }
              scope.item = null;
              fg.addData(fs, false);
              cb();
            },
            onUpdate: function (layer, isNew, group, cb) {

            },
            onPopup: function (layer, cb) {
            }
          });
          $timeout(function () {
            var imgId;
            switch (scope.type) {
              case "house":
                remote.safe.getDrawingRelate("house", scope.regionId.substr(0, scope.regionId.length - 5)).then(function (r) {
                  imgId = r.data.Relations.find(function (item) {
                    return item.Type == -3 && item.RegionId == scope.regionId;
                  });
                  if (!imgId) {
                    imgId = r.data.Relations.find(function (item) {
                      return item.Type == 7 && item.RegionId == scope.regionId.substr(0, scope.regionId.length - 5)
                    });
                  }
                  callback(imgId);
                });

                break;
              case "week":
                remote.safe.getDrawingRelate("WeekInspects", scope.regionId).then(function (r) {
                  imgId = r.data.Relations.find(function (item) {
                    return item.Type == 7 && item.RegionId == scope.regionId;
                  });
                  if (!imgId) {
                    imgId = r.data.Relations.find(function (item) {
                      return item.Type == 13 && item.RegionId == scope.regionId;
                    });
                  }
                  callback(imgId);
                });

                break;
              case "cycle":
                remote.safe.getDrawingRelate("cycle", scope.regionId).then(function (r) {
                  imgId = r.data.Relations.find(function (item) {
                    return item.Type == 7 && item.RegionId == scope.regionId;
                  });
                  callback(imgId);
                });
                break
            }


            function callback(imgId) {
              if (imgId) {
                remote.Project.getDrawing(imgId.DrawingID).then(function (result2) {
                  if (!result2.data.DrawingContent) {
                    return;
                  }
                  scope.loaded = true;
                  map.loadSvgXml(result2.data.DrawingContent);
                  map.map.addControl(fg);
                }).catch(function () {
                })
              }
              else {
                scope.loaded = true;
                return;
              }
            }

          }, 300);
        }
      };
      $timeout(function () {
        scope.$watch('regionId', function () {
          if (scope.regionId) {
            if (map) {
              map.remove();
              map = null;
            }
            install();
          }
        });
        scope.$watch('item', function () {
          if (fg) {
            if (scope.item) {
              fg.changeMode('inspect', scope.item);
            }
            else {
              fg.changeMode();
            }
          }
        })
      }, 500);
      scope.$on('destroy', function () {
        if (map) {
          map.remove();
          map = null;
        }
      })
    }
  }
})();

/**
 * Created by emma on 2016/9/20.
 */
(function(){
  'use strict';

  sxtProjectsJd.$inject = ["$timeout", "remote", "$cookies", "$q"];
  angular
    .module('app.pcReport_sl')
    .directive('sxtProjectsJd',sxtProjectsJd);

  /**@ngInject*/
  function sxtProjectsJd($timeout, remote, $cookies, $q){
    var cookieName = 'projects';
    return {
      transclude:true,
      scope: {
        value: '=ngModel',
        regionType: '=',
        regionName: '=',
        projectId: '=',
        projectName: '=',
        idTree: '=',
        nameTree: '=',
        onQuery: '=',
        onQueryed: '=',
        isMore: '=',
        levels:'@'
      },
      template: '<sxt-select-jd  ng-model="value" is-more="isMore" value-name="regionName" id-tree="idTree" name-tree="nameTree" on-query="onQueryInner" on-change="onChanged" ><div ng-transclude></div></sxt-select-jd>',
      link: function(scope, element, attr, ctrl) {
        scope.onChanged = function(p) {
          if (!p.selectors.length || !p.selectors[0].selected) {
            scope.regionType =
              scope.regionName =
                scope.projectId =
                  scope.projectName = null;
            $cookies.remove(cookieName)
          } else {
            var i = 0,
              c = p.selectors[i],
              ck = [];
            while (c) {
              if (!c.selected) break;
              if (i == 0) {
                scope.projectId = c.selected.$id;
                scope.projectName = c.selected.$name;
              }
              switch (i) {
                case 0:
                  scope.regionType = 1;
                  break;
                case 1:
                  scope.regionType = 2;
                  break;
                case 2:
                  scope.regionType = 8;
                  break;
                case 3:
                  scope.regionType = 32;
                  break;
                case 4:
                  scope.regionType = 64;
                  break;
                // case 5:
                //    scope.regionType = 128;
                //    break;
              }
              ck.push(c.selected);
              c = p.selectors[++i];
              //console.log('scope.regionType',scope.regionType)
            }
            // console.log('ck', JSON.stringify(ck))
            $cookies.put(cookieName, JSON.stringify(ck));
          }
          if (p.selectors.length) {
            scope.onQueryed && scope.onQueryed(p.selectors[p.selectors.length - 1]);
          }

        }
        var init = true;
        var cookie = $cookies.get(cookieName);
        try {
          cookie = cookie ? JSON.parse(cookie) : null;
        } catch (e) {}
        scope.onQueryInner = function (index, st, value, innerScope) {
          if (scope.levels && scope.levels <= index) {
            init = false;
            innerScope && scope.onChanged(innerScope);
            return
          };
          switch (index) {
            case 0:
              if (init && cookie && cookie[index]) {
                return $q(function(r) {
                  r(new st(index, 'ProjectID', 'ProjectName', [cookie[index]], '项目', cookie[index], !!cookie[index+1]))
                });
              } else {
                init = false;
                innerScope && scope.onChanged(innerScope);
                return remote.Project.getMap().then(function (result) {
                  result.data.forEach(function(r){
                    r.RegionID = r.ProjectID;
                    r.RegionName = r.ProjectName;
                  })
                  var s = new st(index, 'RegionID', 'RegionName', result.data, '项目');
                  scope.onQueryed && scope.onQueryed(s);
                  s.letters.length = 0;
                  s.extend = true;
                  return s;
                });
              }
              break;
            case 1:
              if (init && cookie && cookie[index]) {
                return $q(function(r) {
                  r(new st(index, 'RegionID', 'RegionName', [cookie[index]], '分期', cookie[index], !!cookie[index + 1]))
                });
              } else {
                init = false;
                innerScope && scope.onChanged(innerScope);
                return remote.Project.GetAreaChildenbyID(value).then(function(result){
                    var s = new st(index, 'RegionID', 'RegionName', result.data, '分期');
                    scope.onQueryed && scope.onQueryed(s);
                    s.letters.length = 0;
                    s.extend = true;
                    return s;
                })
              }
              break;
            case 2:
              if (init && cookie && cookie[index]) {
                return $q(function(r) {
                  r(new st(index, 'RegionID', 'RegionName', [cookie[index]], '楼栋', cookie[index], !!cookie[index + 1]))
                });
              } else {
                init = false;
                innerScope && scope.onChanged(innerScope);
                return remote.Project.GetAreaChildenbyID(value).then(function(result){
                    var s = new st(index, 'RegionID', 'RegionName', result.data, '楼栋');
                    scope.onQueryed && scope.onQueryed(s);
                    return s;
                })
              }
              break;
            case 3:

              if (init && cookie && cookie[index]) {
                return $q(function(r) {
                  r(new st(index, 'RegionID', 'RegionName', [cookie[index]], '楼层', cookie[index], !!cookie[index + 1]))
                });
              } else {
                init = false;
                innerScope && scope.onChanged(innerScope);
                return remote.Project.GetAreaChildenbyID(value).then(function(result){
                  var s = new st(index, 'RegionID', 'RegionName', result.data, '楼层');
                  scope.onQueryed && scope.onQueryed(s);
                  return s;
                })
              }
              break;
            case 4:
              if (init && cookie && cookie[index]) {
                return $q(function(r) {
                  r(new st(index, 'RegionID', 'RegionName', [cookie[index]], '户', cookie[index], !!cookie[index + 1]))
                });

              } else {
                init = false;
                innerScope && scope.onChanged(innerScope);
                return remote.Project.GetAreaChildenbyID(value).then(function(result){
                  var s = new st(index, 'RegionID', 'RegionName', result.data, '房间');
                  scope.onQueryed && scope.onQueryed(s);
                  return s;
                })

                //var ix = value.indexOf('-');

                //return vkapi.rooms({
                //  page_number: 1,
                //  page_size: 1000,
                //  building_id: value.substring(0,ix),
                //  floor: value.substring(ix+1)
                //}).then(function(result) {
                //  result.data.data.forEach(function (r) {
                //    if (r.unit) {
                //      r.name = r.unit + '-' + r.name;
                //    }
                //  })
                //  var s = new st(index, 'room_id', 'name', result.data.data, '户');
                //  scope.onQueryed && scope.onQueryed(s);
                //  return s;
                //});
              }
              break;
            default:
              init = false;
              innerScope && scope.onChanged(innerScope);
              return scope.onChange ? scope.onQuery(index, st, value) : null;
          }
        }


      }
    }
  }
})();

/**
 * Created by lss on 2016/10/7.
 */
(function () {
  'use strict';
  sxtMskCharts.$inject = ["api", "$window", "$timeout", "$state", "$q", "remote"];
  angular
    .module('app.pcReport_sl')
    .directive('sxtMskCharts',sxtMskCharts);

  /** @ngInject */
  function sxtMskCharts(api,$window,$timeout,$state,$q,remote) {
    return {
      scope: {
        build:'=',
        procedures:'='
      },
      link: function (scope, element) {
        var query = null;
        scope.build.query = function () {
          var  legend = [
              {value: 0, label: '未报验', color: 'rgba(225,225,225,1)'},
              {value: 1, label: '待验', color: 'rgba(0,150,136,1)'},
              {value: 2, label: '合格', color: 'rgba(44,157,251,1)'},
              {value: 4, label: '不合格', color: 'red'},
            ];
          function setYAxis(){
            var regions=[];
            scope.build.regions.forEach(function(k){
              regions.push(angular.extend({},k));
            });
            if (!angular.isArray(regions)||!regions.length){
                return [];
            }
            var  floors=[];

            regions.forEach(function(k){
                if (k.RegionType==8){
                  floors.push(k);
                }
            });
            var maxRoomLen=0;
            floors.forEach(function(k){
              k.rooms=[];
              regions.forEach(function(n){
                  if (n.RegionType==16&& n.RegionID.indexOf(k.RegionID)>-1){
                    n.parent=k;
                    k.rooms.push(n);
                  }
              });
              if (k.rooms.length>maxRoomLen){
                maxRoomLen=k.rooms.length;
              }
              scope.procedures.forEach(function(n){
                //AcceptanceItemID
                var st= scope.build.status.find(function(m){
                    return m.AcceptanceItemID== n.AcceptanceItemID&& k.RegionID== m.AreaId;
                })
                if (st){
                  k.status= k.status?k.status:{};
                  k.status[st.AcceptanceItemID]=st.Status>2?4:st.Status;
                }
              })
            })
            floors.maxRoomLen=maxRoomLen;
            floors.forEach(function(k){
              if (!k.rooms.length){
                if (!floors.maxRoomLen){
                  k.rooms.push({
                    parent:k,
                    RegionID:-1,
                    RegionName:""
                  })
                  floors.maxRoomLen=1;
                }else {
                  for (var i=0;i<floors.maxRoomLen;i++){
                    k.rooms.push({
                      parent:k,
                      RegionID:-1,
                      RegionName: k.RegionName+i>9?i:("0"+i)
                    })
                  }
                }
              }
            })
            return floors;
          }
         //y轴
          var yAxisSource=setYAxis();
          var yAxis= $.map(yAxisSource,function(k){
              return k.RegionName;
          })
         //X轴
         function setXAxis(){
           var maxRoomLen=yAxisSource.maxRoomLen;
           var xAxis=[];
           scope.procedures.forEach(function(k){
              for (var i=0;i<=maxRoomLen;i++){
                xAxis.push({
                  AcceptanceItemID: k.AcceptanceItemID,
                  AcceptanceItemName:k.AcceptanceItemName
                });
              }
           })
           return xAxis;
          }
          var xAxisSource=setXAxis();
          var xAxis= $.map(xAxisSource,function(k){
            return k.AcceptanceItemName;
          });
          //设置serial
          function  setSeries(){
            function  setStatus(i,j){
              function  setRoomStatus(room){
                if (!room){
                  return "-";
                }
                var acceptanceItemID= x.AcceptanceItemID;
                var parent=room.parent;
                if (parent.status&&(parent.status[acceptanceItemID]||parent.status[acceptanceItemID]===0)){
                    return parent.status[acceptanceItemID];
                }
                var st= scope.build.status.find(function(m){
                  return m.AcceptanceItemID== acceptanceItemID&& room.RegionID== m.AreaId;
                })
                return  st? st.Status>2?4:st.Status:0;
              }

              //0 1 2 3 4 5 6 7
              var len=yAxisSource.maxRoomLen;
              if ((i+1)%(len+1)){
                var x=xAxisSource[i];
                var y=yAxisSource[j];
                var room= y.rooms[i%len]
                return setRoomStatus(room,x);
              }
              return "-";
            }

            var serial=[[]];
            var  t;
            var len=yAxisSource.maxRoomLen;
            for (var  j=0;j<yAxisSource.length;j++){
              for (var  i=0;i<xAxisSource.length;i++){
                var status=setStatus(i,j);
                serial.push([i,j,status]);
              }
            }
            return serial;
          }
          var  serial=setSeries();
          serial.shift();
          var option = {
            tooltip: {
              show:false
            },
            grid: {
            },
            xAxis: {
              type: 'category',
              data:xAxis,
              axisLabel: {
                interval: function (index, value) {
                  return index % (yAxisSource.maxRoomLen + 1) == parseInt((yAxisSource.maxRoomLen)/2);
                  return true;
                },
                show: true
              },
              splitArea: {
                show: false
              }
            },
            yAxis: {
              type: 'category',
              data: yAxis,
              min: 0,
              max: 50,
              interval: 1,
              axisLabel: {
                textStyle: {
                  fontSize: 8
                }
              },
              splitArea: {
                show: false
              }
            },
            visualMap: [{
              top:0,
              type: 'piecewise',
              pieces: legend,
              show: true,
              min: 0,
              max: 32,
              calculable: false,
              itemWidth: 5,
              orient: 'horizontal'
            }],
            series: [
              {
                type: 'heatmap',
                data:serial,
                label: {
                  normal: {
                    show: false,
                    textStyle: {
                      fontSize: 5
                    }
                  }
                },
                itemStyle: {
                  normal: {
                    borderWidth: 1,
                    borderColor: 'rgba(255, 255, 255, 1)'
                  },
                  emphasis: {
                    shadowBlur: 10,
                    shadowColor: 'rgba(0, 0, 0, 1)'
                  }
                }
              }
            ]
          };
          $timeout(function(){
            var myChart = $window.echarts.init(element[0]);
            myChart.setOption(option);
          })
        };
      }
    }
  }

})();

/**
 * Created by shaoshun on 2017/3/12.
 */
/**
 * Created by lss on 2016/10/7.
 */
(function () {
  'use strict';
  angular
    .module('app.pcReport_sl')
    .directive('jtReport',jtReport);

  /** @ngInject */
  function jtReport() {
    return {
      scope: {
        fixTitle:"@",
        itemName:"@"
      },
      link: function (scope, element) {
        element.scroll(function (event) {
            var left= element.scrollLeft();
            var  top =element.scrollTop();
            var s=170;
            $('#'+scope.fixTitle).css( 'transform', 'translateX('+(s-left)+'px)');
            $("#"+scope.itemName).css('transform', 'translateY('+(-top)+'px)')
        })
      }
    }
  }

})();



/**
 * Created by shaoshunliu on 2016/12/19.
 */

(function ()
{
  'use strict';
  config.$inject = ["$stateProvider"];
  angular.
  module('app.pcReport_cycle',[])
    .config(config);
  /** @ngInject */
  function config($stateProvider)
  {
    $stateProvider
      .state('app.pcReport_cycle_default',{
        title:"日常巡检",
        url:'/pcReport_cycle_default/{display}',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/cycle/cycle_default.html',
            controller : 'cycle_defaultController as vm',
          }
        }
      })
      .state('app.pcReport_cycle_detail',{
        noBack:true,
        sendBt:false,
        url:'/pcReport_cycle_detail/{regionId}/{inspectionId}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/cycle/cycle_detail.html',
            controller : 'cycle_detailController as vm',
          }
        }
      })
      .state('app.pcReport_cycle_default.filter',{
        title:"日常巡检报表",
        noBack:true,
        // sendBt:false,
        url:'/pcReport_cycle_default/filter/{from}',
        templateUrl: 'app/main/pcReport/cycle/cycle_filter.html',
        controller: 'cycle_filterController as vm'
      })
  }
})();


/**
 * Created by lss on 2016/9/13.
 */

(function(){
  'use strict';

  cycle_filterController.$inject = ["$state", "$stateParams", "remote", "$scope", "$timeout", "xhscService", "$rootScope", "sxtlocaStorage"];
  angular
    .module('app.pcReport_cycle')
    .controller('cycle_filterController',cycle_filterController);

  /**@ngInject*/
  function cycle_filterController($state,$stateParams,remote,$scope,$timeout,xhscService,$rootScope,sxtlocaStorage){
    var vm=this;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    vm.display=true;

    var params= sxtlocaStorage.getObj("cycle_params")
    $scope.core=params?params:{};
    if ($scope.core.minDate){
      $scope.core.minDate=new Date($scope.core.minDate)
    }
    if($scope.core.maxDate){
      $scope.core.maxDate=new Date($scope.core.maxDate);
    }



    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      pc($scope,sxtlocaStorage,$rootScope,$timeout,$state);
    }else {
      mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage)
    }
    xhscService.getRegionTreeOffline("",3,1).then(function (r) {
      $scope.projects=r;
    });

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })

  }



  function pc($scope,sxtlocaStorage,$rootScope,$timeout,$state) {

    $scope.$watch("core.minDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("cycle_params");
        if (!params){
          params={};
        }
        params.minDate=v;
        sxtlocaStorage.setObj("cycle_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.maxDate",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("cycle_params");
        if (!params){
          params={};
        }
        params.maxDate=v;
        sxtlocaStorage.setObj("cycle_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentArea",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("cycle_params");
        if (!params){
          params={};
        }
        params.currentArea=v;
        sxtlocaStorage.setObj("cycle_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)

    $scope.$watch("core.currentProject",function (v,o) {
      if (v){
        var params= sxtlocaStorage.getObj("cycle_params");
        if (!params){
          params={};
        }
        params.currentProject=v;
        params.currentArea = {};
        $scope.core.currentArea = null;
        sxtlocaStorage.setObj("cycle_params",params);
        if (!$scope.isbusy){
          $rootScope.$emit("filter");
        }
        $timeout(function () {
          $scope.isbusy=false;
        },500)
      }
    },true)


    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_main");
    })
  }


  function mobile($scope,$stateParams,vm,$rootScope,$state,sxtlocaStorage) {
    var from=$stateParams.from;
    $scope.ok=function () {
      vm.display=false;
      $rootScope.$emit("filter");
    }
    //详细里面返回
    if (from=="app.pcReport_cycle_detail"){
      vm.display=false;
      //展示明细
      $rootScope.$emit("show");
    }else {
      vm.display=true;

      $scope.$watch("core.minDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("cycle_params");
          if (!params){
            params={};
          }
          params.minDate=v;
          sxtlocaStorage.setObj("cycle_params",params);
        }
      },true)

      $scope.$watch("core.maxDate",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("cycle_params");
          if (!params){
            params={};
          }
          params.maxDate=v;
          sxtlocaStorage.setObj("cycle_params",params);
        }
      },true)

      $scope.$watch("core.currentArea",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("cycle_params");
          if (!params){
            params={};
          }
          params.currentArea=v;
          sxtlocaStorage.setObj("cycle_params",params);
        }
      },true)

      $scope.$watch("core.currentProject",function (v,o) {
        if (v){
          var params= sxtlocaStorage.getObj("cycle_params");
          if (!params){
            params={};
          }
          params.currentProject=v;
          sxtlocaStorage.setObj("cycle_params",params);
        }
      },true)
    }
    //返回按钮
    $rootScope.$on("goBack",function () {
      if (vm.display){
        $state.go("app.pcReport_main");
      }else {
        vm.display=true;
        $rootScope.$emit("hide")
      }
    })

  }

})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function(){
  'use strict';

  cycle_detailController.$inject = ["$stateParams", "remote", "$rootScope", "$scope", "$state", "xhUtils"];
  angular
    .module('app.pcReport_cycle')
    .controller('cycle_detailController',cycle_detailController);

  /**@ngInject*/
  function cycle_detailController($stateParams,remote,$rootScope,$scope,$state,xhUtils){
    var inspectionId=$stateParams.inspectionId;
    var vm=this;

    vm.showImg=function (img) {
      img.url = img.FileContent||img.Url;
      img.alt = ' ';
      xhUtils.playPhoto([img]);
    }
    vm.up=function (item) {
      item.up=!item.up;
    }
    remote.report.getdetail('cycle',inspectionId).then(function (r) {
      vm.source=r.data;

      //复验信息
      vm.source.reviewsItem={};
      vm.source.Reviews.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Reviews.length>0){
        vm.source.reviewsItem=vm.source.Reviews[vm.source.Reviews.length-1];
      }

      //验收信息
      vm.source.supervisionsItem={};
      vm.source.Supervisions.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Supervisions.length>0){
        vm.source.supervisionsItem=vm.source.Supervisions[vm.source.Supervisions.length-1];
      }

      //整改信息
      vm.source.rectifysItem={};
      vm.source.Rectifys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Rectifys.length>0){
        vm.source.rectifysItem=vm.source.Rectifys[vm.source.Rectifys.length-1];
      }

      vm.source.companysItem={};
      vm.source.Companys.sort(function (a,b) {
        if (!a.Time){
          return true;
        }
        return a.Time.localeCompare(a,b);
      })
      if (vm.source.Companys.length>0){
        vm.source.companysItem=vm.source.Companys[vm.source.Companys.length-1];
      }
    })

    $rootScope.$on("goBack",function () {
      $state.go("app.pcReport_cycle_default.filter",{from:"app.pcReport_cycle_detail"});
    })

    $scope.$on("$destroy",function () {
      $rootScope.$$listeners.goBack=[];
    })
  }
})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by lss on 2016/9/13.
 */
/**
 * Created by lss on 2016/9/8.
 */
/**
 * Created by emma on 2016/6/7.
 */
(function () {
  'use strict';

  cycle_defaultController.$inject = ["$state", "remote", "$scope", "$rootScope", "sxtlocaStorage", "$timeout"];
  angular
    .module('app.pcReport_cycle')
    .controller('cycle_defaultController', cycle_defaultController);

  /**@ngInject*/
  function cycle_defaultController($state, remote, $scope, $rootScope, sxtlocaStorage, $timeout) {
    var vm = this;
    vm.selectSize = 10;
    var mobileDetect = new MobileDetect(window.navigator.userAgent);
    vm.isMobile=mobileDetect.mobile();
    vm.isiPad=mobileDetect.mobile()=="iPad";
    function load() {
      $timeout(function () {
        if (!vm.going) {
          vm.going = true;
          var params = sxtlocaStorage.getObj("cycle_params");
          params = params ? params : {};
          $scope.pageIndex = params.pageIndex ? params.pageIndex : 1;
          $scope.PageSize = params.pageSize ? params.pageSize : 10;
          var queryParams = {};
          queryParams.CurPage = $scope.pageIndex - 1;
          queryParams.PageSize = $scope.PageSize;

          if (params.minDate && !angular.isObject(params.minDate)) {
            queryParams.StartTime = params.minDate.toLocaleString();
          }

          if (params.maxDate && !angular.isObject(params.maxDate)) {
            queryParams.EndTime = params.maxDate.toLocaleString();
          }

          if (params.currentArea && params.currentArea.RegionID) {
            queryParams.AreaId = params.currentArea.RegionID;
          }

          if (params.currentProject && params.currentProject.RegionID) {
            queryParams.ProjectID = params.currentProject.RegionID;
          }

          remote.report.getWrapList('cycle', queryParams).then(function (r) {
            $scope.display = true;
            vm.total = r.data.TotalCount;
            vm.source = r.data.Data;
            vm.going=false;
          }).catch(function(){
            $scope.display = true;
            vm.going=false;
          });
        }
      })
    }
    if (vm.isMobile&&vm.isiPad||!vm.isMobile){
      load();
    }
    //初始化
    var filter = $rootScope.$on("filter", function (event, data) {
      $scope.display = true;
      load();
    });


    vm.pageAction = function (bar, page, pageSize, total) {
      var params = sxtlocaStorage.getObj("cycle_params");
      params = params ? params : {};
      params.PageSize = pageSize;
      params.pageIndex = page;
      sxtlocaStorage.setObj(params);
      load();
    }

    $scope.$watch("vm.selectSize", function (v) {
      if (v) {
        var params = sxtlocaStorage.getObj("cycle_params");
        params = params ? params : {};
        params.PageSize = v;
        sxtlocaStorage.setObj(params);
        if ($scope.display) {
          load();
        }
      }
    })


    //隐藏列表
    var showDetail = $rootScope.$on("show", function (event, data) {
      $scope.display = true;
    });
    //展示列表
    var hideDetail = $rootScope.$on("hide", function (event, data) {
      $scope.display = false;
    });

    //明细
    vm.go = function (item) {
      $state.go("app.pcReport_cycle_detail", { regionId: item.AreaID, inspectionId: item.InspectionID });
    }

    $scope.$on("$destroy", function () {
      showDetail();
      filter();
      hideDetail();
    })
  }
})();
/**
 * Created by shaoshunliu on 2016/12/19.
 */

/**
 * Created by 陆科桦 on 2016/10/23.
 */

(function () {
  'use strict';
  materialYsDownload.$inject = ["remote", "xhUtils", "$rootScope", "utils", "api", "$q", "$state", "$scope", "$mdDialog", "db", "$mdBottomSheet", "auth"];
  angular
    .module('app.xhsc')
    .component('materialYsDownload', {
      templateUrl: 'app/main/materialYs/component/materialys-download.html',
      controller: materialYsDownload,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function materialYsDownload(remote, xhUtils, $rootScope, utils, api, $q, $state, $scope, $mdDialog, db, $mdBottomSheet, auth) {
    var vm = this;
    var dbpics = db('pics');
    vm.procedure = [];

    vm.material = true;
    var user = auth.current();

    if(user.Role.MemberType==8){
      vm.userType = 'xmjl';
    }else{
      vm.userType = 'default';
    }

    utils.onCmd($scope, ['swap'], function (cmd, e) {
      vm.material = e.arg.material;
    });

    function deleteMaterialPack() {
      db("materialPlan").destroy();
      db("materialPlanDetailList").destroy();
      db("materialPlanCheckInfo").destroy();
      db("materialPlanReportInfo").destroy();
      db("materialPlanApprovalInfo").destroy();
      db("materialExitInfo").destroy();
      db("materialBatchIntoFactory").destroy();
      db("materialBatchInspection").destroy();
      db("materialUnqualifiedExit").destroy();
      db("materialBatchProgress").destroy();
    }

    loadSection();
    function loadSection() {
      vm.offlines = [];
      vm.section = [];

      remote.Project.getUserProjectSection(user.Role.MemberType).then(function (result) {
        if (!result || result.data.length == 0) {
          utils.alert('暂无项目！');
        }
        else {
          if (user.Role.MemberType == 8) {
            vm.offlines = result.data;
          } else {
            remote.offline.query().then(function (r2) {
              result.data.forEach(function (r) {
                var fd = r2.data.find(function (a) {
                  return a.Id == 'msy' + r.SectionID;
                });
                if (fd) {
                  vm.offlines.push(r);

                } else {
                  vm.section.push(r);
                }
              });
              //vm.section=result.data;
            }).catch(function () {
              vm.section = result.data;
            });
          }
        }
      }).catch(function () {
        remote.offline.query().then(function (r) {
          r.data.forEach(function (list) {
            vm.offlines.push({ SectionID: list.SectionID, FullName: list.FullName });
          });
        });
      });
    }



    vm.downloadPlan = function (item, isReflsh, evt) {
      var status = (user.Role.MemberType == 0 || user.Role.MemberType == 32) ? 1 : 46;
      //下载成功回掉
      function callBack() {
        var ix = vm.section.indexOf(item);
        if (ix != -1)
          vm.section.splice(ix, 1);
        ix = vm.offlines.indexOf(item);
        if (ix != -1) {
          vm.offlines.splice(ix, 1);
        }
        vm.offlines.push(item);

      }
      $mdDialog.show({
        controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
          $scope.item = item;
          var tasks = []
            .concat(function () {
              return api.xhsc.materialPlan.getMaterialPlanBatch(item.SectionID, status);
            })
            .concat(function () {
              return api.xhsc.materialPlan.getMaterialPlanDetailList(item.SectionID, status);
            })
            .concat(function () {
              return api.xhsc.materialPlan.getMaterialBatchProgress(item.SectionID, status);
            })
            .concat(function () {
              return remote.offline.create({ Id: 'msy' + item.SectionID, SectionID: item.SectionID, FullName: item.FullName });
            });
          api.task(tasks, {
            event: 'downloadPlan',
            target: item
          })(null, function () {
            item.percent = item.current = item.total = null;
            $mdDialog.hide();
            if (!isReflsh) {
              callBack();
              utils.alert("下载完成!");
            } else {
              utils.alert("刷新成功!");
            }
            //resolve();
          }, function () {
            $mdDialog.cancel();
            utils.alert('下载失败,请检查网络');
            item.percent = item.current = item.total = null;
          })
        }],
        template: '<md-dialog aria-label="正在下载" ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.Name}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
        parent: angular.element(document.body),
        clickOutsideToClose: false,
        fullscreen: false
      });
    };

    vm.Refresh = function (item, evt) {
      vm.downloadPlan(item, true, evt);
      evt.stopPropagation();
    }

    api.event('downloadPlan', function (s, e) {
      var current = vm.section && vm.section.find(function (item) {
        return item.SectionID == e.target.SectionID;
      });
      if (!current) {
        current = vm.offlines && vm.offlines.find(function (item) {
          return item.SectionID == e.target.SectionID;
        });
      }

      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
        }
      }
    }, $scope);


    //所有全局任务
    var globalTask = [
      function () {
        return remote.Procedure.queryProcedure().then(function (r) {
          if (r.data && r.data.length) {
            r.data.forEach(function (k) {
              if (k.SpecialtyChildren.length) {
                k.SpecialtyChildren.forEach(function (m) {
                  if (m.WPAcceptanceList.length) {
                    vm.procedure = vm.procedure.concat(m.WPAcceptanceList);
                  }
                })
              }
            });
          }
          return r;
        })
      }
    ];
    //项目包
    function projectTask(projectId, areas, acceptanceItemID) {
      return [
        function (tasks) {
          return $q(function (resolve) {
            var arr = [
              remote.Project.getDrawingRelations(projectId),
              dbpics.findAll()
            ];
            $q.all(arr).then(function (res) {
              var result = res[0], offPics = res[1].rows;
              var pics = [];
              result.data.forEach(function (item) {
                if ((!acceptanceItemID || item.AcceptanceItemID == acceptanceItemID) &&
                  (!areas || areas.find(function (a) {
                    return a.AreaID == item.RegionId;
                  })) &&
                  pics.indexOf(item.DrawingID) == -1 && !offPics.find(function (r) {
                    return r._id == item.DrawingID;
                  }) && vm.procedure.find(function (k) {
                    return k.AcceptanceItemID == item.AcceptanceItemID;
                  })) {
                  pics.push(item.DrawingID);
                }
              });
              pics.forEach(function (drawingID) {
                tasks.push(function () {
                  return remote.Project.getDrawing(drawingID).then(function () {
                    dbpics.addOrUpdate({
                      _id: drawingID
                    })
                  });
                })
              });
              resolve(result);
            });
          })
        },
        function () {
          return remote.Project.queryAllBulidings(projectId);
        }
      ]
    }

    function InspectionTask(item) {
      var t = [function () {
        return remote.Project.getInspectionList(item.InspectionId);
      }];
      item.Children.forEach(function (area) {
        t.push(function (tasks, down) {
          return remote.Procedure.InspectionCheckpoint.query(item.AcceptanceItemID, area.AreaID, item.InspectionId).then(function (result) {
            result.data.forEach(function (p) {
              tasks.push(function () {
                return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                  result.data.forEach(function (r) {
                    tasks.push(function () {
                      return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                      })
                    })
                  })
                })
              });
            });
          })
        });
        t.push(function () {
          return remote.Procedure.InspectionIndexJoinApi.query(item.InspectionId)
        })
        t.push(function () {
          return remote.Procedure.InspectionPoint.query(item.InspectionId, item.AcceptanceItemID, area.AreaID)
        })

      });
      return t;
    }

    function rectificationTask(item) {
      return [
        function (tasks) {
          return remote.Procedure.getZGById(item.RectificationID).then(function (r) {
            r.data[0].Children.forEach(function (area) {
              tasks.push(function () {
                return remote.Procedure.getZGReginQues(area.AreaID, item.RectificationID);
              });
              tasks.push(function () {
                return remote.Procedure.getZGReginQuesPoint(area.AreaID, item.RectificationID);
              })
            })
          });
        },
        function () {
          return remote.Procedure.getRectification(item.RectificationID);
        }
      ]
    }


    function InspectionZjTask(t, AcceptanceItemID, AreaID, InspectionId) {
      t.push(function () {
        return remote.Procedure.InspectionPoint.query(InspectionId, AcceptanceItemID, AreaID)
      })
      t.push(function (tasks, down) {
        return remote.Procedure.InspectionCheckpoint.query(AcceptanceItemID, AreaID, InspectionId).then(function (result) {
          result.data.forEach(function (p) {
            tasks.push(function () {
              return remote.Procedure.InspectionProblemRecord.query(p.CheckpointID).then(function (result) {
                result.data.forEach(function (r) {
                  tasks.push(function () {
                    return remote.Procedure.InspectionProblemRecordFile.query(r.ProblemRecordID).then(function (result) {
                    })
                  })
                })
              })
            });
          });
        })
      });
    }
    vm.downloadzj = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(item.isOffline ? [] : projectTask(item.ProjectID))
                .concat([
                  function (tasks) {
                    var group = [];
                    var inspections = [];
                    return remote.Procedure.getRegionStatus(item.ProjectID, "8").then(function (result) {
                      result.data.forEach(function (item) {
                        if (item.AcceptanceItemID && item.AreaId && item.InspectionId && !group.find(function (k) {
                          return k.AcceptanceItemID == item.AcceptanceItemID && k.AreaId == item.AreaId && k.InspectionId == item.InspectionId
                        })) {
                          group.push([item.AcceptanceItemID, item.AreaId, item.InspectionId]);
                        }
                        if (item.AcceptanceItemID && item.AreaId && item.InspectionId && !inspections.find(function (k) {
                          return k.InspectionId == item.InspectionId;
                        })) {
                          inspections.push(item.InspectionId);
                        }
                      })
                      inspections.forEach(function (id) {
                        tasks.push(function () {
                          return remote.Project.getInspectionList(id);
                        });
                        tasks.push(function () {
                          return remote.Procedure.InspectionIndexJoinApi.query(id)
                        });
                      });
                      group.forEach(function (data) {
                        InspectionZjTask(tasks, data[0], data[1], data[2]);
                      })
                    })
                  }
                ])
                .concat(function () {
                  return remote.offline.create({ Id: 'zj' + item.ProjectID });
                });
              api.task(tasks, {
                event: 'downloadzj',
                target: item
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                item.percent = item.current = item.total = null;
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject()
              })
            }],
            template: '<md-dialog aria-label="正在下载基础数据"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      })
    };

    api.event('downloadzj', function (s, e) {
      var current = vm.projects && vm.projects.find(function (item) {
        return item.ProjectID == e.target.ProjectID;
      });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
        }
      }
    }, $scope);

    vm.downloadys = function (item) {
      return api.setNetwork(0).then(function () {
        return $q(function (resolve, reject) {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.ProjectID, item.Children, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(function () {
                  return remote.offline.create({ Id: 'ys' + item.InspectionId });
                })
              api.task(tasks, {
                event: 'downloadys',
                target: item.InspectionId
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                item.percent = item.current = item.total = null;
                reject();
              }, { timeout: 300000 })
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载： {{item.AcceptanceItemName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        })
      });
    }

    api.event('downloadys', function (s, e) {
      var current = vm.Inspections && vm.Inspections.find(function (item) {
        return item.InspectionId == e.target;
      });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':
            current.isOffline = true;
            break;
        }
      }
    }, $scope);

    vm.downloadzg = function (item) {
      return $q(function (resolve, reject) {
        api.setNetwork(0).then(function () {
          $mdDialog.show({
            controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
              $scope.item = item;
              var tasks = [].concat(globalTask)
                .concat(projectTask(item.Children[0].AreaID.substring(0, 5), item.Children, item.AcceptanceItemID))
                .concat(InspectionTask(item))
                .concat(rectificationTask(item))
                .concat(function () {
                  return remote.offline.create({ Id: 'zg' + item.RectificationID });
                });
              api.task(tasks, {
                event: 'downloadzg',
                target: item.RectificationID
              })(null, function () {
                item.percent = item.current = item.total = null;
                item.isOffline = true;
                remote.offline.create({ Id: 'zg' + item.RectificationID });
                //RectificationID
                $mdDialog.hide();
                utils.alert('下载完成');
                resolve();
              }, function () {
                $mdDialog.cancel();
                utils.alert('下载失败,请检查网络');
                reject();
                item.percent = item.current = item.total = null;
              });
            }],
            template: '<md-dialog aria-label="正在下载"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在下载：{{item.ProjectName}} {{item.percent}}({{item.current}}/{{item.total}})</p></md-dialog-content></md-dialog>',
            parent: angular.element(document.body),
            clickOutsideToClose: false,
            fullscreen: false
          });
        });
      })

    }

    api.event('downloadzg', function (s, e) {
      var current = vm.zglist && vm.zglist.find(function (item) {
        return item.RectificationID == e.target;
      });
      if (current) {
        switch (e.event) {
          case 'progress':
            current.percent = parseInt(e.percent * 100) + ' %';
            current.current = e.current;
            current.total = e.total;
            break;
          case 'success':

            break;
        }
      }
    }, $scope);

    vm.uploadInfo = {}
    vm.uploadInfo.uploading = false;
    vm.upload = function () {
      api.setNetwork(0).then(function () {
        vm.uploadInfo.uploading = true;
        vm.uploadInfo.percent = '0%'
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.uploadInfo = vm.uploadInfo;

            api.upload(function (cfg, item) {
              if (cfg._id == 's_files' && item && item.Url.indexOf('base64') == -1) {
                return false;
              }
              return true;
            }, function (percent, current, total) {
              vm.uploadInfo.percent = parseInt(percent * 100) + ' %';
              vm.uploadInfo.current = current;
              vm.uploadInfo.total = total;
            }, function (tasks) {
              vm.uploadInfo.uploaded = 1;
              api.uploadTask(function () {
                return true
              }, null);
              $mdDialog.hide();
              db("s_offline").destroy();

              utils.alert('上传成功');
              deleteMaterialPack();
              loadSection();
              vm.uploadInfo.tasks = [];
              vm.uploadInfo.uploading = false;
            }, function (timeout) {
              $mdDialog.hide();
              var msg = '上传失败,请检查网络!'
              if (timeout) {
                msg = '请求超时,请检查网络!';
              }
              utils.alert(msg);
              vm.uploadInfo.uploaded = 0;
              vm.uploadInfo.uploading = false;
            }, {
                uploaded: function (cfg, row, result) {
                  cfg.db && cfg.db.delete(row._id);
                }
              });
          }],
          template: '<md-dialog aria-label="正在上传"  ng-cloak><md-dialog-content> <md-progress-circular md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">正在上传：{{uploadInfo.percent}}({{uploadInfo.current}}/{{uploadInfo.total}})</p></md-dialog-content></md-dialog>',
          parent: angular.element(document.body),
          clickOutsideToClose: false,
          fullscreen: false
        });
      });
    }


    vm.MemberType = [];
    vm.by = function (r) {
      api.setNetwork(0).then(function () {
        $state.go('app.xhsc.gx.gxlist', { role: 'zb', projectId: r.ProjectID });
      });
    }
    api.setNetwork(0).then(function () {
      remote.profile().then(function (r) {
        if (r.data && r.data.Role) {
          vm.role = r.data.Role.MemberType === 0 || r.data.Role.MemberType ? r.data.Role.MemberType : -100;
          vm.OUType = r.data.Role.OUType === 0 || r.data.Role.OUType ? r.data.Role.OUType : -100;
          vm.MemberType.push(vm.role);
          vm.bodyFlag = vm.role;
        }
      });
    })

    function load() {
      // remote.Project.getMap().then(function(result){
      //   remote.offline.query().then(function (r) {
      //     if (r&& r.data&& r.data.length){
      //       result.data.forEach(function (item) {
      //         item.isOffline =true;
      //       });
      //     }
      //     vm.projects = result.data;
      //   }).catch(function(){
      //     vm.projects = result.data;
      //   });
      // });
      //
      // remote.Procedure.getZGlist(23).then(function (r) {
      //   vm.zglist = [];
      //   if (angular.isArray(r.data)){
      //     var zg=[];
      //     r.data.forEach(function(o){
      //       zg.push(o);
      //     });
      //     remote.offline.query().then(function(r){
      //       if (angular.isArray(r.data)){
      //         zg.forEach(function(k){
      //           if (r.data.find(function(m){
      //               return m.Id=="zg"+k.RectificationID;
      //             })){
      //             k.isOffline=true;
      //           }
      //         })
      //       }
      //       vm.zglist=zg;
      //     });
      //   }
      // });
      // remote.Procedure.getInspections(1).then(function(r){
      //   vm.Inspections=[];
      //   if (angular.isArray(r.data)){
      //     var ys=[];
      //     r.data.forEach(function(o){
      //       ys.push(o);
      //     });
      //     remote.offline.query().then(function(r){
      //       if (angular.isArray(r.data)){
      //         ys.forEach(function(k){
      //           if (r.data.find(function(m){
      //               return m.Id=="ys"+k.InspectionId;
      //             })){
      //             k.isOffline=true;
      //           }
      //         })
      //       }
      //       vm.Inspections=ys;
      //     });
      //   }
      // });
    }
    api.setNetwork(0).then(function () {
      load();
    })

    vm.setModule = function (val) {
      vm.bodyFlag = val;
    }
    vm.zbzjAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzj(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxlist', { role: '', projectId: item.ProjectID });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxlist', { role: '', projectId: item.ProjectID });
        });
      }
    }

    vm.zbzjbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '自 检',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzjAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzj(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

    vm.jlysAction = function (item) {
      if (!item.isOffline) {
        vm.downloadys(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxtest', {
              acceptanceItemID: item.AcceptanceItemID, acceptanceItemName: item.AcceptanceItemName, name: item.Children[0].newName,
              projectId: item.ProjectID, areaId: item.Children[0].AreaID, InspectionId: item.InspectionId
            })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxtest', {
            acceptanceItemID: item.AcceptanceItemID, acceptanceItemName: item.AcceptanceItemName, name: item.Children[0].newName,
            projectId: item.ProjectID, areaId: item.Children[0].AreaID, InspectionId: item.InspectionId
          })
        });
      }
    }
    vm.jlysbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '验 收',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlysAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadys(item);
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
    vm.zbzgAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', { Role: 'zb', InspectionID: item.InspectionId, AcceptanceItemID: item.AcceptanceItemID, RectificationID: item.RectificationID, AcceptanceItemName: item.AcceptanceItemName });
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', { Role: 'zb', InspectionID: item.InspectionId, AcceptanceItemID: item.AcceptanceItemID, RectificationID: item.RectificationID, AcceptanceItemName: item.AcceptanceItemName });
        });
      }
    }

    vm.zbzgbtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '整 改',
            action: function () {
              $mdBottomSheet.hide();
              vm.zbzgAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }

    vm.jlfyAction = function (item) {
      if (!item.isOffline) {
        vm.downloadzg(item).then(function () {
          api.setNetwork(1).then(function () {
            $state.go('app.xhsc.gx.gxzg', { Role: 'jl', InspectionID: item.InspectionId, AcceptanceItemID: item.AcceptanceItemID, RectificationID: item.RectificationID })
          });
        })
      } else {
        api.setNetwork(1).then(function () {
          $state.go('app.xhsc.gx.gxzg', { Role: 'jl', InspectionID: item.InspectionId, AcceptanceItemID: item.AcceptanceItemID, RectificationID: item.RectificationID })
        });
      }
    }

    vm.jlfybtnAction = function (item, evt) {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller: ["$scope", function ($scope) {
          $scope.btns = [{
            title: '复 验',
            action: function () {
              $mdBottomSheet.hide();
              vm.jlfyAction(item);
            }
          }, {
            title: '下 载',
            action: function () {
              $mdBottomSheet.hide();
              vm.downloadzg(item)
            }
          }, {
            title: '取 消',
            action: function () {
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
      evt.stopPropagation();
    }
  }

})(angular, undefined);

/**
 * Created by 陆科桦 on 2016/10/28.
 */
(function (angular,undefined) {
  'use strict';
  exit.$inject = ["$rootScope", "$scope", "$stateParams", "api", "utils", "sxt", "xhUtils", "$state", "auth", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialYsExit',{
      templateUrl:'app/main/materialYs/component/materialYs-exit.html',
      controller:exit,
      controllerAs:'vm'
    });

  /** @ngInject */
  function exit($rootScope,$scope,$stateParams,api,utils,sxt,xhUtils,$state,auth,$filter){
    var vm = this;
    var user = auth.current();
    vm.data = {ExitId:sxt.uuid(),PlanId:$stateParams.id};
    vm.data.ExitReason = '材料多余';
    vm.data.ExitOperatorTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');
    vm.data.ExitWitness = user.Name;

    $scope.$on("$destroy",function(){
      sendCheckResult();
      sendCheckResult = null;
    });

    var sendCheckResult = $rootScope.$on('sendGxResult',function() {
      if(vm.data.ExitCount == null){
        utils.alert('材料退场数量不能为空');
        return;
      }
      if(vm.data.ExitWitness == null){
        utils.alert('退场见证人不能为空');
        return;
      }
      if(vm.exitImgs.length == 0){
        utils.alert('至少上传一张退场照片');
        return;
      }

      vm.data.MaterialFiles = vm.exitImgs;
      api.xhsc.materialPlan.PostExitInfo(vm.data).then(function (r) {
        utils.alert('提交成功!',null,function () {
          $state.go("app.xhsc.materialys.materialdownload");
        });
      })
    });

    vm.exitImgs = [];

    //删除图片操作
    $rootScope.$on('delete',function (data,index) {
      $scope.$apply();
    });

    vm.addPhoto = function (type) {
      //拍照事件
      xhUtils.photo().then(function (image) {
      if(image){
        // var image;
          photo(type,vm.exitImgs,image);
          vm.data.ExitOperatorTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
      }
      });
    };

    function photo(type, arr, image) {
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.id,
        OptionType: type,
        ApproachStage: 32,
        ImageName: _id + ".jpeg",
        ImageUrl: _id + ".jpeg",
        ImageByte: image
      });
    }

  }
})(angular,undefined);

/**
 * Created by HuangQingFeng on 2016/10/28.
 */
(function () {
  'use strict';
  materialUnqualifiedExit.$inject = ["$rootScope", "$scope", "api", "utils", "$stateParams", "$state", "sxt", "xhUtils", "auth", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialUnqualifiedExit',{
      templateUrl:'app/main/materialYs/component/materialYs-UnqualifiedExit.html',
      controller:materialUnqualifiedExit,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialUnqualifiedExit($rootScope,$scope,api,utils,$stateParams,$state,sxt,xhUtils,auth,$filter){
    var vm = this;
    var user = auth.current();
    vm.data = {};
    vm.data.Id = $stateParams.id;
    vm.data.ExitReason = '材料不合格';
    vm.data.MaterialFiles = [];
    vm.data.ExitOperatorTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');
    vm.data.ExitWitness = user.Name;
    vm.data.Unit = $stateParams.unit;

    var sendgxResult =$rootScope.$on('sendGxResult',function(){
      if(vm.data.ExitReason == null){
        utils.alert('退场原因不能为空');
        return;
      }
      if(vm.data.ExitCount == null){
        utils.alert('退场数量不能为空');
        return;
      }
      if(vm.data.ExitWitness == null){
        utils.alert('退场见证人不能为空');
        return;
      }
      if(vm.data.MaterialFiles.length == 0){
        utils.alert('请至少上传一张材料退场照片');
        return;
      }

      api.xhsc.materialPlan.materialUnqualifiedExit(vm.data).then(function (q) {
        utils.alert("提交成功", null, function () {
          api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.data.Id);
          $state.go("app.xhsc.materialys.materialdownload");
        });
      });
    });

    //删除图片操作
    $rootScope.$on('delete',function (data,index) {
      $scope.$apply();
    });

    $scope.$on("$destroy",function(){
      sendgxResult();
      sendgxResult=null;
    });

    vm.addPhoto = function (type) {
      //拍照事件
      xhUtils.photo().then(function (image) {
        if(image){
        // var image;
          photo(type,vm.data.MaterialFiles,image);
          vm.data.ExitOperatorTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
        }
      });
    }

    function photo(type,arr,image){
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.id,
        OptionType:type,
        ApproachStage:32,
        ImageName:_id+".jpeg",
        ImageUrl:_id+".jpeg",
        ImageByte: image
      });
    }

  }
})(angular,undefined);

/**
 * Created by HuangQingFeng on 2016/11/16.
 */

(function () {
  'use strict';
  materialPlanProgress.$inject = ["$rootScope", "$stateParams", "api", "utils", "$state"];
  angular
    .module('app.xhsc')
    .component('materialPlanProgress',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-progress.html',
      controller:materialPlanProgress,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialPlanProgress($rootScope,$stateParams,api,utils,$state){
    var vm = this;
    var batchId = $stateParams.id;

    api.xhsc.materialPlan.getBatchProgressById(batchId).then(function (r) {
      vm.data = r.data;
    });

  }
})(angular,undefined);

/**
 * Created by HangQingFeng on 2016/10/24.
 */
(function () {
  'use strict';
  materialPlanList.$inject = ["$rootScope", "$stateParams", "api", "utils", "$state", "auth"];
  angular
    .module('app.xhsc')
    .component('materialPlanList',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-list.html',
      controller:materialPlanList,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialPlanList($rootScope,$stateParams,api,utils,$state,auth){
    var vm = this;
    $rootScope.title = $stateParams.title;
    var user = auth.current();
    vm.status;
    if(user.Role.MemberType==8){
      api.setNetwork(0);
      vm.status = 16;
    }else{
      api.setNetwork(1);
      vm.status = (user.Role.MemberType == 0 || user.Role.MemberType == 32)?1:46;
    }


    api.xhsc.materialPlan.getMaterialPlanBatch($stateParams.id,vm.status).then(function (r) {
      vm.planList = r.data;
    });

  }
})(angular,undefined);

/**
 * Created by HangQingFeng on 2016/10/25.
 */

(function () {
  'use strict';
  materialIntoFactory.$inject = ["$rootScope", "$scope", "api", "utils", "$state", "$stateParams", "sxt", "xhUtils", "auth", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialIntoFactory', {
      templateUrl: 'app/main/materialYs/component/materialPlanYs-intoFactory.html',
      controller: materialIntoFactory,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function materialIntoFactory($rootScope, $scope, api, utils, $state, $stateParams, sxt, xhUtils, auth,$filter) {
    var vm = this;
    var user = auth.current();
    vm.data = {};
    vm.data.ApproachType = $stateParams.status == 1 ? 1 : 0;
    vm.outPutDate = new Date();
    vm.data.ApproachTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');
    vm.data.MaterialPlanFiles = [];
    vm.vehicleImgs = [];
    vm.goodsImgs = [];
    vm.rummagerImgs = [];
    vm.CertificateImgs = [];
    vm.data.Inspector = user.Name;
    vm.data.IsPacking = true;
    var status = user.Role.MemberType == 0 ? 1 : 110;

    api.xhsc.materialPlan.getMaterialPlanDetail($stateParams.BatchId).then(function (q) {
      vm.data.Id = q.data.Id;
      vm.data.Unit = q.data.Unit;
      vm.data.PlanId = q.data.PlanId;
      vm.Brands = q.data.Brands.split(/、|,|，|；|;/) || [];
      if (vm.data.ApproachType == 1) {
        vm.data.Id = sxt.uuid();
      }

      api.xhsc.materialPlan.getMaterialBatchIntoFactory().then(function (r) {
        if(r.data && r.data.length > 0){
          var _subCount = 0;
          r.data.forEach(function (e) {
            if (vm.data.PlanId == e.PlanId) {
              _subCount = parseFloat(e.ApproachCount) + _subCount;
            }
          });

          _subCount = q.data.PlanCount - _subCount;
          vm.data.ApproachCount = _subCount > 0 ? _subCount : 0;
        } else {
          vm.data.ApproachCount = parseFloat(q.data.PlanCount);
        }
      });
    });

    var sendgxResult = $rootScope.$on('sendGxResult', function () {
      if (vm.data.ApproachCount == null) {
        utils.alert('进场数量不能为空');
        return;
      }
      if (vm.data.Brand == null) {
        utils.alert('厂家/品牌不能为空');
        return;
      }
      if (vm.data.Supplier == null) {
        utils.alert('供货方不能为空');
        return;
      }
      if (vm.data.Inspector == null) {
        utils.alert('检查人不能为空');
        return;
      }
      // if (vm.vehicleImgs.length == 0) {
      //   utils.alert('请上传至少一张车辆检查照片');
      //   return;
      // }
      // if (vm.rummagerImgs.length == 0) {
      //   utils.alert('请上传至少一张检查人照片');
      //   return;
      // }

      if (vm.goodsImgs.length == 0) {
        utils.alert('请上传至少一张货物检查照片');
        return;
      }
      
      if (vm.CertificateImgs.length == 0) {
        utils.alert('请上传至少一张合格证照片');
        return;
      }

      vm.data.MaterialPlanFiles = vm.vehicleImgs.concat(vm.goodsImgs, vm.rummagerImgs, vm.CertificateImgs);

      api.xhsc.materialPlan.IntoFactoryMaterialBatch(vm.data).then(function (q) {
        utils.alert("提交成功", null, function () {
          if(vm.data.ApproachType == 0){
            api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.data.Id);
          }
          $state.go("app.xhsc.materialys.materialdownload");
        });
      });
    });

    $scope.$on("$destroy", function () {
      sendgxResult();
      sendgxResult = null;
    });

    //删除图片操作
    $rootScope.$on('delete', function (data, index) {
      $scope.$apply();
    });

    vm.addPhoto = function (type) {
      xhUtils.photo().then(function (image) {
        if (image) {
          // var image;
          switch (type) {
            case 256: {
              photo(type, vm.vehicleImgs, image);
              break;
            }
            case 512: {
              photo(type, vm.goodsImgs, image);
              break;
            }
            case 1024: {
              photo(type, vm.rummagerImgs, image);
              break;
            }
            case 2048: {
              photo(type, vm.CertificateImgs, image);
              break;
            }
          }
          vm.data.ApproachTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
        }
      });
    };

    function photo(type, arr, image) {
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.BatchId,
        OptionType: type,
        ApproachStage: 1,
        ImageName: _id + ".jpeg",
        ImageUrl: _id + ".jpeg",
        ImageByte: image
      });
    }
  }
})(angular, undefined);

/**
 * Created by HangQingFeng on 2016/10/27.
 */

(function () {
  'use strict';
  materialPlanInspection.$inject = ["$rootScope", "$scope", "api", "utils", "$stateParams", "$state", "sxt", "xhUtils", "auth", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialPlanInspection',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-inspection.html',
      controller:materialPlanInspection,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialPlanInspection($rootScope,$scope,api,utils,$stateParams,$state,sxt,xhUtils,auth,$filter){
    var vm = this;
    var user = auth.current();
    vm.data = {};
    vm.data.Id = $stateParams.id;
    vm.outPutDate = new Date();
    vm.data.InspectionTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');
    vm.samplingProcessImgs = [];
    vm.checkListImgs = [];
    vm.data.MaterialPlanFiles = [];
    vm.data.Inspectioner = user.Name;

    var sendgxResult =$rootScope.$on('sendGxResult',function(){
      if(vm.data.InspectionTime == null){
        utils.alert('送检时间不能为空');
        return;
      }
      if(vm.data.Inspectioner == null){
        utils.alert('送检人不能为空');
        return;
      }
      if(vm.data.CheckList == null){
        utils.alert('送检单号不能为空');
        return;
      }
      if(vm.samplingProcessImgs.length == 0){
        utils.alert('请至少上传一张抽样过程照片');
        return;
      }
      if(vm.checkListImgs.length == 0 ){
        utils.alert('请至少上传一张检查单照片');
        return;
      }

      vm.data.MaterialPlanFiles = vm.samplingProcessImgs.concat(vm.checkListImgs);
      api.xhsc.materialPlan.MaterialInspection(vm.data).then(function (q) {
        utils.alert("提交成功", null, function () {
          api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.data.Id);
          $state.go("app.xhsc.materialys.materialdownload");
        });
      });
    });

    //删除图片操作
    $rootScope.$on('delete',function (data,index) {
      $scope.$apply();
    });

    $scope.$on("$destroy",function(){
      sendgxResult();
      sendgxResult=null;
    });

    vm.addPhoto = function (type) {
      //拍照事件
      xhUtils.photo().then(function (image) {
        if(image){
          // var image;
          switch (type) {
            case 16:{
              photo(type,vm.samplingProcessImgs,image);
              break;
            }
            case 32:{
              photo(type,vm.checkListImgs,image);
              break;
            }
          }
          vm.data.InspectionTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
        }
      });
    }

    function photo(type,arr,image){
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.id,
        OptionType:type,
        ApproachStage:4,
        ImageName:_id+".jpeg",
        ImageUrl:_id+".jpeg",
        ImageByte: image
      });
    }
  }
})(angular,undefined);

/**
 * Created by HangQingFeng on 2016/10/24.
 */

(function () {
  'use strict';
  materialysDetail.$inject = ["$scope", "api", "utils", "$stateParams"];
  angular
    .module('app.xhsc')
    .component('materialPlanDetail',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-detail.html',
      controller:materialysDetail,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialysDetail($scope,api,utils,$stateParams){
    var vm = this;
    vm.data = {};
    vm.data.Id = $stateParams.batchId;
    vm.confirm = true;
    vm._confirm = false;

    $scope.$watch('vm.confirm',function () {
      if (vm._confirm){
        vm.btnEnable = true;
        return;
      }
      vm.btnEnable = !vm.confirm;
    });

    api.xhsc.materialPlan.getMaterialPlanDetail(vm.data.Id).then(function (q) {
      vm.data = q.data;
      if(q.data.FirstBatchTime){
        var _str = JSON.stringify(q.data.FirstBatchTime).replace(/-/g,'/').replace('T',' ');
        var dt = new Date(_str);
        var currDt = new Date();
        vm._confirm = parseInt(Math.abs(currDt- dt)/1000/60/60/24) > 7 ? true : false;
        vm.btnEnable = vm._confirm ? true : false;
      }
    });

  }
})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/26.
 */

(function (angular,undefined) {
  'use strict';
  materialPlanYsCheckInfo.$inject = ["$rootScope", "$scope", "api", "utils", "$stateParams", "xhUtils", "sxt", "$state", "auth", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialYsCheckInfo',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-checkInfo.html',
      controller:materialPlanYsCheckInfo,
      controllerAs:'vm'
    });

  /** @ngInject */
  function materialPlanYsCheckInfo($rootScope,$scope,api,utils,$stateParams,xhUtils,sxt,$state,auth,$filter){

    var vm = this;
    vm.data = {};
    var user = auth.current();
    vm.images = [];
    vm.vehicleImgs = [];
    vm.goodsImgs = [];
    vm.checkerImgs = [];
    vm.certificateImgs = [];
    vm.data.Accepter = user.Name;

    //删除图片操作
    $rootScope.$on('delete',function (data,index) {
      $scope.$apply();
    });

    vm.addPhoto = function (type) {
      //拍照事件
      xhUtils.photo().then(function (image) {
        if(image){
      // var image;
          switch (type){
            case 1:
              photo(type,vm.vehicleImgs,image);
              break;
            case 2:
              photo(type,vm.goodsImgs,image);
              break;
            case 4:
              photo(type,vm.checkerImgs,image);
              break;
            default:
              photo(type,vm.certificateImgs,image);
          }
          vm.data.AcceptanceTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
        }
      });
    };


    function photo(type,arr,image){
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.id,
        OptionType:type,
        ApproachStage:2,
        ImageName:_id+".jpeg",
        ImageUrl:_id+".jpeg",
        ImageByte: image
      });
    }


    vm.data.Id = $stateParams.id;
    vm.outPutDate = new Date();
    vm.data.AcceptanceTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');

    vm.data.WgCheck = true;
    vm.data.IsInspection = true;

    $scope.$on("$destroy",function(){
      sendCheckResult();
      sendCheckResult = null;
    });
    var sendCheckResult = $rootScope.$on('sendGxResult',function() {
      if(vm.data.AcceptanceTime == null){
        utils.alert('验收时间不能为空');
        return;
      }
      if(vm.data.Accepter == null){
        utils.alert('验收人不能为空');
        return;
      }
      // if(vm.vehicleImgs.length == 0){
      //   utils.alert('至少上传一张验收车辆照片');
      //   return;
      // }
      if(vm.goodsImgs.length == 0){
        utils.alert('至少上传一张验收货物照片');
        return;
      }
      // if(vm.checkerImgs.length == 0){
      //   utils.alert('至少上传一张验收检查人照片');
      //   return;
      // }
      if(vm.certificateImgs.length == 0){
        utils.alert('至少上传一张验收合格证照片');
        return;
      }

      vm.images = vm.vehicleImgs.concat(vm.goodsImgs).concat(vm.checkerImgs).concat(vm.certificateImgs);
      vm.data.BatchFile = vm.images;
      if(!vm.data.WgCheck){
        vm.data.IsInspection = null;
      }
      api.xhsc.materialPlan.PostCheckInfo(vm.data).then(function (r) {
        utils.alert('提交成功!',null,function () {
          api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.data.Id);
          $state.go("app.xhsc.materialys.materialdownload");
        });
      })
    });
  }
})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/27.
 */
(function (angular,undefined) {
  'use strict';
  approval.$inject = ["$rootScope", "$scope", "api", "$mdBottomSheet", "$stateParams", "utils", "$filter", "$state", "$mdDialog", "sxt"];
  angular
    .module('app.xhsc')
    .component('materialYsApproval',{
      templateUrl:'app/main/materialYs/component/materialPlanYs-approval.html',
      controller:approval,
      controllerAs:'vm'
    });

  /** @ngInject */
  function approval($rootScope,$scope,api,$mdBottomSheet,$stateParams,utils,$filter,$state,$mdDialog,sxt){
    var vm = this;
    vm.data = {};
    vm.intoFactoryImgs = [];
    vm.checkedImgs = [];



    api.xhsc.materialPlan.getMaterialPlanBatchById($stateParams.id).then(function (r) {
      vm.data = r.data;
      vm.data.Images.forEach(function (i) {
        i.ImageByte = sxt.app.api + i.ImageByte;
      });

      vm.data.PlanTime = new Date(vm.data.PlanTime).Format('yyyy年MM月dd日');
      vm.data.ApproachTime = new Date(vm.data.ApproachTime).Format('yyyy年MM月dd日');
      vm.data.AcceptanceTime = new Date(vm.data.AcceptanceTime).Format('yyyy年MM月dd日');
    });

    $scope.$on("$destroy",function(){
      sendApprovalResult();
      sendApprovalResult = null;
    });

    var sendApprovalResult = $rootScope.$on('sendClResult',function() {
      $mdBottomSheet.show({
        templateUrl: 'app/main/xhsc/procedure/action.html',
        controller:["$scope", function($scope){
          $scope.btns=[{
            title:'退场',
            action:function(){
              $mdBottomSheet.hide();
              subApproval(0);
            }
          },{
            title:'让步接收',
            action:function(){
              $mdBottomSheet.hide();
              subApproval(1);
            }
          },{
            title:'抽样检查',
            action:function(){
              $mdBottomSheet.hide();
              subApproval(2);
            }
          },
            {
            title:'取消',
            action:function(){
              $mdBottomSheet.hide();
            }
          }]
        }]
      });
    });

    function subApproval(handle){
      var batch = {};
      batch.Handle = handle;
      // batch.Opinion = vm.data.Handle?'让步接收':'退场';
      batch.Opinion = function(){
        var val = '退场';
        switch(handle){
          case 0:{
            val = '退场';
            break;
          }
          case 1:{
            val = '让步接收';
            break;
          }
          case 2:{
            val = '抽样检查';
            break;
          }
        }
        return val;
      }();
      batch.Id = $stateParams.id;
      vm.flag = handle;

      if(handle == 1){
        vm.batch = batch;
        cfmInputReason();
        return;
      }

      api.xhsc.materialPlan.PostApprovalInfo(vm.flag,batch).then(function (r) {
        utils.alert('提交成功!',null,function () {
          api.xhsc.materialPlan.deleteMaterialPlanBatch(batch.Id);
          $state.go("app.xhsc.materialys.materialdownload");
        });
      });
    }

    var cfmInputReason = function(batch){
      var confirm = $mdDialog.prompt()
        .title('请输入让步接收原因…')
        .placeholder('原因')
        .targetEvent(vm)
        .ok('提交')
        .cancel('取消');

      $mdDialog.show(confirm).then(function(result) {
        if(result && result != null){
          vm.batch.Reason = result;
          api.xhsc.materialPlan.PostApprovalInfo(vm.flag,vm.batch).then(function (r) {
            utils.alert('提交成功!',null,function () {
              api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.batch.Id);
              $state.go("app.xhsc.materialys.materialdownload");
            });
          });
        }else{
          utils.alert('尚未输入让步接收原因，取消当前操作。');
        }
      }, function() {
        //console.log('Cancel');
      });
    };

  }

})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/27.
 */

(function (angular,undefined) {
  'use strict';
  inspectionReport.$inject = ["$rootScope", "$scope", "api", "utils", "$stateParams", "sxt", "$state", "xhUtils", "$filter"];
  angular
    .module('app.xhsc')
    .component('materialYsInspectionReport',{
      templateUrl:'app/main/materialYs/component/inspection-report.html',
      controller:inspectionReport,
      controllerAs:'vm'
    });

  /** @ngInject */
  function inspectionReport($rootScope,$scope,api,utils,$stateParams,sxt,$state,xhUtils,$filter){
    var vm = this;
    vm.data = {};
    vm.data.Id = $stateParams.id;
    vm.outPutDate = new Date();
    vm.data.ReportTime = $filter('date')(new Date(),'yyyy-MM-dd hh:mm:ss');
    vm.data.LabCheck = true;
    vm.reportImgs = [];

    $scope.$on("$destroy",function(){
      sendReportResult();
      sendReportResult = null;
    });

    var sendReportResult = $rootScope.$on('sendGxResult',function() {
      if(!vm.data.Report){
        utils.alert('请填写报告单编号');
        return;
      }
      if(vm.reportImgs.length == 0){
        utils.alert('至少上传一张报告单照片');
        return;
      }

      vm.data.BatchFile = vm.reportImgs;
      api.xhsc.materialPlan.PostReportInfo(vm.data).then(function (r) {
        utils.alert('提交成功!',null,function () {
          api.xhsc.materialPlan.deleteMaterialPlanBatch(vm.data.Id);
          $state.go("app.xhsc.materialys.materialdownload");
        });
      })
    });

    //删除图片操作
    $rootScope.$on('delete',function (data,index) {
      $scope.$apply();
    });

    vm.addPhoto = function (type) {
      //拍照事件
      xhUtils.photo().then(function (image) {
      if(image){
        // var image;
          photo(type,vm.reportImgs,image);
          vm.data.ReportTime = new Date().Format('yyyy-MM-dd hh:mm:ss');
        }
      });
    };

    function photo(type,arr,image){
      var _id = sxt.uuid();
      arr.push({
        Id: sxt.uuid(),
        BatchId: $stateParams.id,
        OptionType:type,
        ApproachStage:8,
        ImageName:_id+".jpeg",
        ImageUrl:_id+".jpeg",
        ImageByte: image
      });
    }
  }
})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/14.
 */

(function (angular, undefined) {
  'use strict';

  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.material', ['app.core','app.xhsc','ui.tree','ngMaterial', 'ngMessages'])
    .config(config);
  /** @ngInject */
  function config($stateProvider, msNavigationServiceProvider) {
    $stateProvider
      .state('app.material', {
        url: '/material',
        views: {
          'content@app': {
            template: '<ui-view class="animate-slide-left" flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      .state('app.material.list', {
        url:'/list',
        template:'<material-list flex layout="column"></material-list>'
      })
      .state('app.material.add', {
        url: '/add/{id}/{cid}',
        template: '<material-add flex layout="column"></material-add>'
      })
      .state('app.material.contracts', {
        url:'/contracts',
        template:'<material-contracts flex layout="column"></material-contracts>'
      })
      .state('app.material.contract', {
        url:'/contract/{id}',
        template:'<material-contract flex layout="column"></material-contract>'
      })
      .state('app.material.type', {
        url:'/type',
        template:'<material-type flex layout="column"></material-type>'
      })
      .state('app.material.typeAdd',{
        url:'/typeAdd/{id}',
        template:'<material-class-add flex layout="column"></material-class-add>'
      })
      .state('app.material.plans',{
        url:'/plans',
        template:'<material-plans flex layout="column"></material-plans>'
      })
      .state('app.material.plan',{
        url:'/plan/{id}',
        template:'<material-plan flex layout="column"></material-plan>'
      })
      .state('app.material.batchDetail',{
        url:'/batchDetail/{planId}',
        template:'<material-batch-detail flex layout="column"></material-batch-detail>'
      })
      .state('app.material.materialLibrary',{
        url:'/library/{cid}',
        template:'<material-library flex layout="column"></material-library>'
      })
      .state('app.material.materialReport',{
        url:'/materialReport',
        template:'<material-Report flex layout="column"></material-Report>'
      });

    msNavigationServiceProvider.saveItem('material', {
      allow: [{user: 'm',memberType:28}],
      title: '材料验收',
      group: true,
      weight: 2
    });

    // msNavigationServiceProvider.saveItem('material.type', {
    //   title: '材料分类',
    //   icon: 'icon-sort-variant',
    //   state: 'app.material.type',
    //   weight: 1
    // });

    // msNavigationServiceProvider.saveItem('material.list', {
    //   title: '材料管理',
    //   icon: 'icon-view-list',
    //   state: 'app.material.list',
    //   weight: 1
    // });

    msNavigationServiceProvider.saveItem('material.materialLibrary', {
      allow: [{user: 'm',memberType:16}],
      title: '集团材料库',
      icon: 'icon-view-list',
      state: 'app.material.materialLibrary',
      weight: 1
    });

    msNavigationServiceProvider.saveItem('material.materialReport', {
      allow: [{user: 'm',memberType:28}],
      title: '材料验收报表',
      icon: 'icon-calendar-blank',
      state: 'app.material.materialReport',
      weight: 1
    });

    msNavigationServiceProvider.saveItem('material.contracts', {
      allow: [{user: 'm',memberType:28}],
      title: '项目材料管理',
      icon: 'icon-account',
      state: 'app.material.contracts',
      weight: 1
    });

    msNavigationServiceProvider.saveItem('material.plans', {
      allow: [{user: 'm',memberType:28}],
      title: '材料进场计划',
      icon: 'icon-calendar-text',
      state: 'app.material.plans',
      weight: 1
    });

  }
})(angular, undefined);

/**
 * Created by HangQingFeng on 2016/10/14.
 */

(function(angular,undefined){
  'use strict';
  materialClass.$inject = ["$scope", "api", "utils"];
  angular
    .module('app.material')
    .component('materialType',{
      templateUrl:'app/main/material/component/materialClass-list.html',
      controller:materialClass,
      controllerAs:'vm'
    });
  /** @ngInject */
  function materialClass($scope,api,utils){
    var vm = this;
    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    };

    vm.pageAction = function(title, page, pageSize, total){
      $scope.pageing.page = page;
    }

    $scope.$watch("pageing",function(){
      load();
    },true);

    // $scope.treeSetting = [{
    //   'id': 1,
    //   'title': 'AAAAA',
    //   'level': 0,
    //   'nodes': [],
    //   'isEnable': tmp,
    //   'regionType':2
    // }]

    function load(){
      var page= utils.getPage($scope.pageing);
      api.material.type.getList({Skip:page.Skip,Limit:page.Limit}).then(function(r){
        vm.data = r.data.Items;
        $scope.pageing.total = r.data.TotalCount;
      });
    }

   vm.delete =  function(id){
      utils.confirm('确认删除此材料分类').then(function () {
        api.material.type.delete(id).then(function () {
          load();
        })
      });
    }
  }
})(angular,undefined);


/**
 * Created by lukehua on 2017/1/4.
 */

(function (angular, undefined) {
    'use strict';
    materialReport.$inject = ["$scope", "api", "sxt", "utils"];
    angular
        .module('app.material')
        .component('materialReport', {
            templateUrl: 'app/main/material/component/material-report.html',
            controller: materialReport,
            controllerAs: 'vm'
        });

    /** @ngInject */
    function materialReport($scope, api, sxt, utils) {
        var vm = this;
        $scope.pageing = {
            page: 1,
            pageSize: 10,
            total: 0
        };
        vm.host = sxt.app.api;
        vm.projects = [];
        // var mobileDetect = new MobileDetect(window.navigator.userAgent);
        // vm.isMobile = mobileDetect.mobile();
        // vm.isiPad = mobileDetect.mobile() == "iPad";
        var mobileDetect = new MobileDetect(window.navigator.userAgent);
        vm.isMobile = mobileDetect.mobile();
        vm.getProjects = function () {
            if (vm.projects.length == 0) {
                return api.xhsc.Project.getMap().then(function (r) {
                    vm.projects = r.data;
                });
            }
        };

        vm.clearRegion = function () {
            vm.regions = [];
            vm.sections = [];
            vm.regionId = null;
            vm.sectionId = null;
        }

        vm.getAreas = function (pId) {
            return api.xhsc.Project.GetAreaChildenbyID(pId).then(function (r) {
                vm.regions = r.data;
            });
        };

        vm.clearSection = function () {
            vm.sections = [];
            vm.sectionId = null;
        }

        vm.getSections = function (aId) {
            return api.material.materialPlan.GetProjectSection(aId).then(function (e) {
                vm.sections = e.data;
            });
        };

        vm.getData = function (sid) {
            var page = utils.getPage($scope.pageing);
            return api.material.materialPlan.getMaterialReport(sid, { Skip: page.Skip, Limit: page.Limit }).then(function (r) {
                vm.source = r.data.Items || [];
                $scope.pageing.total = r.data.TotalCount;
            });
        }

        vm.pageAction = function (title, page, pageSize, total) {
            $scope.pageing.page = page;
        }

        $scope.$watch("pageing", function () {
            vm.getData(vm.sectionId);
        }, true);

        vm.printBatchCount = function () {
            $('#export').val($("#divReport").html());
        }
    };
})(angular, undefined);
/**
 * Created by 陆科桦 on 2016/10/17.
 */

(function (angular,undefined) {
  'use strict';
  materialPlans.$inject = ["$scope", "api", "utils", "remote", "auth"];
  angular
    .module('app.material')
    .component('materialPlans',{
      templateUrl:'app/main/material/component/material-plans.html',
      controller:materialPlans,
      controllerAs:'vm'
    })

  /** @ngInject */
  function materialPlans($scope,api,utils,remote,auth) {
    var vm = this;
    var user = auth.current();
    vm.data = {};
    vm.ProjectId = '';
    vm.RegionId = '';
    vm.SectionId = '';
    $scope.pageing={
      page:1,
      pageSize:10,
      total:0
    };
    var role = [];
    vm.projects = [];
    if(user.Role.MemberType !== ''){
      api.material.materialPlan.getUserProjectSectionForPc().then(function (result) {
        role = result.data;
      });
    }

    var projects = null;
    api.xhsc.Project.getMap("nodb").then(function (r) {
      vm.projects = r.data;
      projects = r.data.map(function (r) { return r.ProjectID }).join(',');
      Load();
    });

    vm.getSections = function () {
      return api.xhsc.Project.GetAreaChildenbyID(vm.data.ProjectId).then(function (r) {
        vm.sections = r.data;
      })
    };

    vm.pageAction = function (title, page, pageSize, total) {
      $scope.pageing.page = page;
    };

    $scope.$watch('pageing',function () {
      Load();
    },true);

    $scope.$watch('vm.ProjectId',function () {
      vm.regions = [];
      vm.RegionId = '';
      vm.SectionId = '';
      api.xhsc.Project.GetAreaChildenbyID(vm.ProjectId).then(function (r) {
        
        vm.regions = r.data;
        // if(vm.regions.length != 0)
        //   vm.regions[0].selected = true;
      });
    },true);

    $scope.$watch('vm.RegionId',function () {
      vm.sections = [];
      vm.SectionId = '';
      api.material.materialPlan.GetProjectSection(vm.RegionId).then(function (e) {
        vm.sections = e.data;
        // if(vm.sections.length != 0)
        //   vm.sections[0].selected = true;
      });
    },true);

    $scope.$watch('vm.SectionId',function () {
        Load();
    },true);

    function Load() {
      projects = vm.ProjectId?vm.ProjectId:projects;
      var SectionId = vm.SectionId || '';

      var page = utils.getPage($scope.pageing);
      api.material.materialPlan.getList({RegionId:projects,SectionId:SectionId,Skip:page.Skip,Limit:page.Limit}).then(function (q) {
        vm.data = q.data.Items||[];
        $scope.pageing.total = q.data.TotalCount;
      });
    }

    vm.delete = function(id){
      utils.confirm('确认删除此材料信息').then(function () {
        api.material.materialPlan.delete(id).then(function () {
          Load();
        })
      });
    }

  }
})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/17.
 */

(function (angular, undefined) {
  'use strict';
  materialPlan.$inject = ["$scope", "api", "utils", "$stateParams", "$state", "moment", "auth", "$element", "$timeout", "$q", "$log"];
  angular
    .module('app.material')
    .component('materialPlan', {
      templateUrl: 'app/main/material/component/material-plan.html',
      controller: materialPlan,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function materialPlan($scope, api, utils, $stateParams, $state, moment, auth, $element, $timeout, $q, $log) {
    var vm = this;
    var user = auth.current();
    vm.data = {};
    var role = [];
    vm.data.Id = $stateParams.id;
    vm.SupplyType = [
      { type: 1, name: '甲供' },
      { type: 2, name: '认质认价' },
      { type: 4, name: '甲指乙供' }
    ];
    vm.data.PlanTime = new Date();

    vm.states = loadAll();
    vm.states2 = loadAll2();
    vm.querySearch = querySearch;

    function loadAll() {
      var allStates = vm.Specifications && vm.Specifications != [] ? vm.Specifications.join(", ") : '';
      return allStates.split(/、|,|，|；|;/).map(function (state) {
        return {
          value: state.toLowerCase(),
          display: state || '暂无数据'
        };
      });
    }

    function loadAll2() {
      var allStates = vm.Models && vm.Models != [] ? vm.Models.join(", ") : '';
      return allStates.split(/、|,|，|；|;/).map(function (state) {
        return {
          value: state.toLowerCase(),
          display: state || '暂无数据'
        };
      });
    }

    function querySearch(query, dataType) {
      var dataSource = null;
      switch (dataType) {
        case 1: {
          dataSource = vm.states;
          break;
        }
        case 2: {
          dataSource = vm.states2;
          break;
        }
      }

      if (!dataSource || dataSource == '') {
        return;
      }

      var results = query ? dataSource.filter(createFilterFor(query)) : dataSource, deferred;
      return results;
    }

    function createFilterFor(query) {
      var lowercaseQuery = angular.lowercase(query);
      return function filterFn(state) {
        return (state.value.indexOf(lowercaseQuery) === 0);
      };
    }

    if (user.Role.MemberType !== '') {
      api.material.materialPlan.getUserProjectSectionForPc().then(function (result) {
        role = result.data;
      });
    }

    $scope.searchTerm;
    $scope.searchC;
    $scope.clearSearchTerm = function () {
      $scope.searchTerm = '';
    };
    $scope.clearSearchC = function () {
      $scope.searchC = '';
    };

    $element.find('input').on('keydown', function (ev) {
      ev.stopPropagation();
    });

    vm.projects = [];
    vm.getMaps = function () {
      return api.xhsc.Project.getMap().then(function (r) {
        vm.projects = r.data;
      })
    };

    vm.getContracts = function () {
      api.material.contract.getList({ Skip: 0, Limit: 999, projects: vm.data.ProjectId }).then(function (q) {
        vm.contracts = q.data.Items || [];
      });
    }



    vm.getAreas = function (pId) {
      return api.xhsc.Project.GetAreaChildenbyID(pId).then(function (r) {
        vm.regions = r.data;

      });
    };

    vm.getSections = function (aId) {
      api.material.materialPlan.GetProjectSection(aId).then(function (e) {
        vm.sections = e.data;
      });
    };

    vm.typeId;
    vm.getMaterial = function () {
      if (vm.typeId) {
        api.material.materialScience.GetMaterialByTypeId(vm.typeId).then(function (r) {
          vm.materials = r.data;
        })
      }
    };

    vm.upNext = function () {
      vm.regions = null;
      vm.sections = null;
      vm.RegionId = null;
      vm.SectionId = null;
    };

    vm.upSection = function () {
      vm.sections = null;
      vm.SectionId = null;
    };

    // api.material.materialScience.getMaterialList().then(function (r) {
    //   vm.materials = r.data||[];
    // });

    vm.init = function (m) {
      vm.Specifications = m.Specifications ? m.Specifications.split(/、|,|，|；|;/) : [];
      vm.Models = m.Model ? m.Model.split(/、|,|，|；|;/) : [];

      vm.states = loadAll()
      vm.states2 = loadAll2();
    };

    if (vm.data.Id) {
      vm.inputChange = true;
      vm.getMaps();
      api.material.materialPlan.getMaterial(vm.data.Id).then(function (r) {
        vm.data = r.data;
        vm.data.ProjectId = r.data.RegionId.substr(0, 5);
        //vm.data.RegionId = r.data.RegionId.substr(5,10);
        vm.data.SectionId = r.data.SectionId;
        vm.data.PlanTime = r.data.PlanTime == null ? new Date() : new moment(r.data.PlanTime).toDate();

        vm.getAreas(vm.data.ProjectId);
        vm.RegionId = r.data.RegionId;
        vm.getSections(vm.data.RegionId);
        vm.SectionId = r.data.SectionId;
        api.material.materialScience.GetMaterialByTypeId(vm.data.ContractId).then(function (r) {
          vm.materials = r.data || [];
          vm.materials.forEach(function (q) {
            if (q.Id == vm.data.MaterialId) {
              q.selected = true;
              vm.init(q);
              vm.searchText = vm.data.Specifications;
              vm.searchText2 = vm.data.Model;
            }
          });
        });
      });
    }

    vm.save = function () {
      vm.data.Specifications = vm.searchText == '暂无数据' ? '' : vm.searchText;
      vm.data.Model = vm.searchText2 == '暂无数据' ? '' : vm.searchText2;
      if ($scope.myForm.$valid) {
        vm.data.RegionId = vm.RegionId;
        vm.data.SectionId = vm.SectionId;
        vm.data.MaterialId = vm.data.Material.Id;
        vm.data.PlanTime = vm.data.PlanTime.Format('yyyy-MM-dd');
        if (vm.data.Id) {
          api.material.materialPlan.putMaterial(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.plans");
            });
          });
        } else {
          api.material.materialPlan.Create(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.plans");
            });
          });
        }
      }
    };

    vm.change = function () {
      vm.inputChange = true;
    };

    var materialName = '', specification = '', model = '', planCount = '', unit = '';
    $scope.$watch('vm.data.Material', function () {
      if (vm.data && vm.data.Material && !vm.inputChange) {
        materialName = '';
        materialName = vm.data.Material.MaterialName;
        vm.data.PlanName = materialName + specification + model + planCount + unit;
      }
    });

    $scope.$watch('vm.data.Specifications', function () {
      if (vm.data && vm.data.Specifications && !vm.inputChange) {
        specification = '';
        specification = '_' + vm.data.Specifications;
        vm.data.PlanName = materialName + specification + model + planCount + unit;
      }
    });

    $scope.$watch('vm.data.Model', function () {
      if (vm.data && vm.data.Model && !vm.inputChange) {
        model = '';
        model = '_' + vm.data.Model;
        vm.data.PlanName = materialName + specification + model + planCount + unit;
      }
    });

    $scope.$watch('vm.data.PlanCount', function () {
      if (vm.data && vm.data.PlanCount && !vm.inputChange) {
        planCount = '';
        planCount = '_' + vm.data.PlanCount;
        vm.data.PlanName = materialName + specification + model + planCount + unit;
      }
    });

    $scope.$watch('vm.data.Unit', function () {
      if (vm.data && vm.data.Unit && !vm.inputChange) {
        unit = '';
        unit = vm.data.Unit + '_' + new Date(vm.data.PlanTime).Format('yyMMdd');
        vm.data.PlanName = materialName + specification + model + planCount + unit;
      }
    });
  }

})(angular, undefined);

/**
 * Created by 陆科桦 on 2016/10/14.
 */

(function(angular,undefined){
  'use strict';
  material.$inject = ["$scope", "api", "utils"];
  angular
    .module('app.material')
    .component('materialList',{
      templateUrl:'app/main/material/component/material-list.html',
      controller:material,
      controllerAs:'vm'
  });
  /** @ngInject */
  function material($scope,api,utils){
    var vm = this;
    vm.total=0;
    $scope.pageing={
      page:1,
      pageSize:10
    };

    vm.pageAction = function(title, page, pageSize, total){
      $scope.pageing.page = page;
    };

    $scope.$watch("pageing",function(){
      Load();
    },true);

    function Load() {
      var page = utils.getPage($scope.pageing);

      api.material.materialScience.getList({Skip:page.Skip,Limit:page.Limit}).then(function (r) {
        vm.data = r.data.Items||[];
        vm.total = r.data.TotalCount;
        console.log(r.data.Items);
      });
    }

    vm.delete = function(id){
      utils.confirm('确认删除此材料信息').then(function () {
        api.material.materialScience.delete(id).then(function () {
          Load();
        })
      });
    }
  }
})(angular,undefined);

/**
 * Created by HuangQingFeng on 2016/11/29.
 */
(function (angular, undefined) {
  'use strict';

  materialLibrary.$inject = ["$scope", "api", "utils", "$state", "$stateParams", "$mdDialog"];
  angular
    .module('app.material')
    .component('materialLibrary', {
      templateUrl: 'app/main/material/component/material-library.html',
      controller: materialLibrary,
      controllerAs: 'vm'
    });

  function materialLibrary($scope, api, utils, $state, $stateParams,$mdDialog) {
    var vm = this;
    $scope.data = {};
    vm.cid = $stateParams.cid || 0;

    function load() {
      api.material.materialScience.GetMaterialTreeList(vm.cid).then(function (q) {
        if (q.data) {
          $scope.data.nodeList = q.data;
        }
      });
    }
      load();

    vm.batchAdd = function(node,ev) {
      var data = {};
      var confirm = $mdDialog.prompt()
        .title('批量添加材料')
        // .textContent('Bowser is a common name.')
        .placeholder('材料名称')
        .ariaLabel('材料名称')
        // .initialValue('Buddy')
        .targetEvent(ev)
        .ok('提交')
        .cancel('关闭');

      $mdDialog.show(confirm).then(function(result) {
        if (result){
          data.MaterialClassId = node.id;
          data.MaterialName = result;
          api.material.materialScience.Create(data).then(function () {
            vm.batchAdd(node,null);
          });
        }else {
          load();
        }
      }, function() {
        load();
        console.log('Cancel Batch Add Material !')
      });
    }

    vm.addMaterial = function (node) {
      $state.go('app.material.add');
    }

    vm.toggleClick = function (node, scope,fn) {
      scope.toggle(scope);
      if(!node.nodes){
        api.material.materialScience.GetMaterialListByTypeId(node.id).then(function(r){
          node.nodes = r.data;
        });
      }
    }

    vm.btnEdit = function (node,flag,ev) {
        if(node){
          switch (node.level){
            case 1 : {
              vm.showPrompt(node,flag,ev);
              break;
            }
            case 2: {
              $state.go('app.material.add',{id:node.id,cid:vm.cid});
              break;
            }
          }
        }
    }

    vm.btnRemove = function(node){
      if (node){
        switch (node.level){
          case 1:{
            utils.confirm('确认删除此材料库').then(function () {
              api.material.type.delete(node.id).then(function () {
                utils.alert("删除成功", null, function () {
                  load();
                });
              })
            });
            break;
          }
          case 2:{
            utils.confirm('确认删除此材料信息').then(function () {
              api.material.materialScience.delete(node.id).then(function () {
                utils.alert("删除成功", null, function () {
                  load();
                });
              })
            });
            break;
          }
        }
      }
    }

    vm.showPrompt = function(node,flag,ev) {
      var data = node ? node : {};
      var title = flag ? '编辑材料库': '新增材料库';

      $mdDialog.show({
        controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
          $scope.materialName = flag ? node.title : '';

          $scope.submit = function (result) {
            if(result){
              data.CategoryName = result;
              if(flag){
                data.Id = node.id;
                api.material.type.update(data).then(function () {
                  utils.alert("提交成功", null, function () {
                    load();
                  });
                });
              }else{
                api.material.type.create(data).then(function () {
                  utils.alert("提交成功", null, function () {
                    load();
                  });
                });
              }
            }

            $mdDialog.hide();
          }

          $scope.close = function () {
            $mdDialog.hide();
          }
        }],
        template: '<md-dialog aria-label="'+title+'">'
        +'<md-subheader class="md-no-sticky" style="background-color:#78909C;color: black;">'+title+'<small></small></md-subheader>'
        + '<md-dialog-content style="padding: 30px 20px 13px 20px;">'
          +'<md-input-container class="md-block">'
          +'<input ng-model="materialName" type="text" placeholder="材料库名称">'
          +'</md-input-container>'
        +'<div layout="row" flex>'
        +'<md-button class="md-primary md-raised" type="submit" flex="50" ng-click="submit(materialName)">保存</md-button>'
        +'<md-button class="md-primary md-raised" flex="50" ng-click="close()">取消</md-button>'
        +'</div>'
        + '</md-dialog-content>'
        + '</md-dialog>',
        parent: angular.element(document.body),
        clickOutsideToClose:false,
        fullscreen: false,
        targetEvent:ev
      });
    }

    vm.alertPromat = function (node,ev) {
      $mdDialog.show({
        controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
          $scope.submit = function (content) {
            if (content) {
              var arrs = [];
              var _words = [];
              var json = {};
              var words = content.replace(new RegExp('\n','g'),'|').split('|');
              //清除换行空值
              words = words.filter(function (t) {
                return  t != undefined && t != null && t.replace(/(^\s*)|(\s*$)/g, "") != ''
              });
              //清除重复数据
              for(var i = 0; i < words.length; i++){
                var val = words[i].replace(/(^\s*)|(\s*$)/g, '')
                if(!json[val]){
                  _words.push(val);
                  json[val] = 1;
                }
              }

              _words.forEach(function (r) {
                if(r){
                  arrs.push({
                    'MaterialClassId':node.id,
                    'MaterialName':r
                  });
                }
              });

              api.material.materialScience.batchCreate(arrs).then(function () {
                utils.alert("提交成功",null,function () {
                  load();
                });
              });
            }

            $mdDialog.hide();
          }

          $scope.close = function () {
            $mdDialog.hide();
          }
        }],
        template: '<md-dialog aria-label="新增材料">'
        +'<md-subheader class="md-no-sticky" style="background-color:#78909C;color: black;">批量新增材料<small>（Enter 键换行多个添加）</small></md-subheader>'
        + '<md-dialog-content style="padding: 20px 20px 13px 20px;">'
        + '<textarea ng-model="materialName" cols="30" rows="5" style="border: 2px solid lightgrey;padding: 5px 10px;"></textarea>'
        +'<div layout="row" flex style="padding-top:10px;">'
        +'<md-button class="md-primary md-raised" type="submit" flex="50" ng-click="submit(materialName)">保存</md-button>'
        +'<md-button class="md-primary md-raised" flex="50" ng-click="close()">取消</md-button>'
        +'</div>'
        + '</md-dialog-content>'
        + '</md-dialog>',
        parent: angular.element(document.body),
        clickOutsideToClose:false,
        fullscreen: false,
        targetEvent:ev
      });
    }

  }
})(angular, undefined);

/**
 * Created by lukehua on 2016/11/15.
 */

(function (angular, undefined) {
  'use strict';
  materialContracts.$inject = ["$scope", "api", "utils", "auth"];
  angular
    .module('app.material')
    .component('materialContracts', {
      templateUrl: 'app/main/material/component/material-contracts.html',
      controller: materialContracts,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function materialContracts($scope, api, utils, auth) {
    var vm = this;
    var user = auth.current();
    $scope.pageing = {
      page: 1,
      pageSize: 10,
      total: 0
    };
    vm.pageAction = function (title, page, pageSize, total) {
      $scope.pageing.page = page;
    }
    $scope.$watch("pageing", function () {
      load();
    }, true);

    api.xhsc.Project.getMap("nodb").then(function (r) {
      vm.projects = r.data.map(function (r) { return r.ProjectID });
      load();
    });

    function load() {
      var page = utils.getPage($scope.pageing);
      if(!vm.projects) return;
      api.material.contract.getList({ Skip: page.Skip, Limit: page.Limit, projects: vm.projects.join(',') }).then(function (q) {
        vm.data = q.data.Items || [];
        $scope.pageing.total = q.data.TotalCount;
      });
    }

    vm.delete = function (id) {
      utils.confirm('确认删除此合同信息').then(function () {
        api.material.contract.delete(id).then(function () {
          load();
        })
      });
    }
  }

})(angular, undefined);

/**
 * Created by lukehua on 2016/11/15.
 */

(function (angular, undefined) {
  'use strict';
  materialContract.$inject = ["$scope", "api", "utils", "$q", "$stateParams", "$state", "$element", "sxt"];
  angular
    .module('app.material')
    .component('materialContract', {
      templateUrl: 'app/main/material/component/material-contract.html',
      controller: materialContract,
      controllerAs: 'vm'
    })

  /** @ngInject */
  function materialContract($scope, api, utils, $q, $stateParams, $state, $element, sxt) {
    var vm = this;
    vm.projects = [];
    vm.data = {};
    vm.data.Id = $stateParams.id;
    // vm.data.ContractRelations = [];
    vm.MaterialIds = [];

    api.xhsc.Project.getMap().then(function (r) {
      var projects = r.data.map(function (r) { return r.ProjectID });
      $q.all([
        api.material.contract.getSysOrgOU(projects.join(',')),
        api.material.type.getList({ Skip: 0, Limit: 100 }),
        //api.material.materialScience.getList({Skip: 0, Limit: 100})
      ]).then(function (r) {
        vm.Partners = r[0].data;
        vm.materialClass = r[1].data.Items;
      });
    });


    if (vm.data.Id) {
      api.material.contract.getById(vm.data.Id).then(function (r) {
        vm.data = r.data;
        vm.data.PartnerId = vm.data.SectionId + '>' + vm.data.PartnerId;
        vm.MaterialIds = vm.data.MaterialTypeId.split(',');
        // vm.data.ContractRelations.forEach(function (r) {
        //   vm.MaterialIds.push(r.MaterialId);
        // });
      });
    }

    vm.searchTerm;
    vm.clearSearchTerm = function () {
      vm.searchTerm = '';
    };

    $element.find('input').on('keydown', function (ev) {
      ev.stopPropagation();
    });

    vm.save = function () {
      if ($scope.myForm.$valid) {
        vm.data.MaterialTypeId = JSON.stringify(vm.MaterialIds).replace('[', '').replace(']', '');
        // if(vm.MaterialIds && vm.MaterialIds.length>0){
        //   if (vm.data.ContractRelations.length > 0) {
        //     var arrs = [];
        //     vm.MaterialIds.forEach(function (r) {
        //       var flag = false;
        //       vm.data.ContractRelations.forEach(function (q){
        //         if (r == q.MaterialId) {
        //           arrs.push(q);
        //           flag=true;
        //           return;
        //         }
        //       });
        //       if (!flag){
        //         arrs.push({'Id':0,'MaterialId':r});
        //       }
        //     });
        //     vm.data.ContractRelations = arrs;
        //   } else {
        //     vm.data.ContractRelations = [];
        //     vm.MaterialIds.forEach(function (r) {
        //       vm.data.ContractRelations.push({'MaterialId':r});
        //     });
        //     console.log(vm.data.ContractRelations)
        //   }
        // }
        var arr = vm.data.PartnerId.split('>');
        vm.data.SectionId = arr[0];
        vm.data.PartnerId = arr[1];
        if (vm.data.Id) {

          api.material.contract.update(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.contracts");
            });
          });
        } else {
          api.material.contract.create(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.contracts");
            });
          });
        }
      }
    }

  }
})(angular, undefined);

/**
 * Created by HangQingFeng on 2016/10/17.
 */
(function (angular, undefined) {
  'use strict';

  materialClassAdd.$inject = ["$scope", "api", "utils", "$state", "$stateParams"];
  angular
    .module('app.material')
    .component('materialClassAdd', {
      templateUrl: 'app/main/material/component/material-classAdd.html',
      controller: materialClassAdd,
      controllerAs: 'vm'
    });

  function materialClassAdd($scope, api, utils, $state, $stateParams) {
    var vm = this;
    vm.data = {};
    vm.data.Id = $stateParams.id;

    vm.selParent = function (m) {
      vm.data.ParentName = m.CategoryName;
    };

    if (vm.data.Id) {
      api.material.type.getItem(vm.data.Id).then(function (r) {
        vm.data = r.data;
      })
    }

    vm.save = function () {
      if ($scope.myForm.$valid) {
        if (vm.data.Id) {
          api.material.type.update(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.type");
            });
          })
        } else {
          api.material.type.create(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.type");
            });
          })
        }
      }
    }
  }
})(angular, undefined);


/**
 * Created by HuangQingFeng on 2016/11/14.
 */

(function(angular,undefined) {
  'use strict';

  materialBatchDetail.$inject = ["$scope", "api", "utils", "$state", "$stateParams"];
  angular
    .module('app.material')
    .component('materialBatchDetail', {
      templateUrl: 'app/main/material/component/material-batchDetail.html',
      controller: materialBatchDetail,
      controllerAs: 'vm'
    });

  function materialBatchDetail($scope,api,utils,$state,$stateParams) {
    var vm = this;
    vm.data = {};
    vm.data.PlanId = $stateParams.planId;

    api.xhsc.materialPlan.GetMaterialPlanInfolById(vm.data.PlanId).then(function (r) {
      if(r.data){
        vm.data.PlanModel =  r.data;
        if(r.data.PlanBatchDetail){
          r.data.PlanBatchDetail.forEach(function (q) {
            q.Images.forEach(function (i) {
              i.ImageByte = sxt.app.api + i.ImageByte;
            });
          });
        }
      }
    });

    // api.xhsc.materialPlan.GetMaterialPlanBatchByPlanId(vm.data.PlanId).then(function (r) {
    //   vm.data.BatchList = r.data||[];
    //   vm.data.BatchList.forEach(function (b) {
    //     b.Images.forEach(function (i) {
    //       i.ImageByte = sxt.app.api + i.ImageByte;
    //     })
    //   })
    // });
    //
    // api.xhsc.materialPlan.GetExcessMaterialExitByPlanId(vm.data.PlanId).then(function (r) {
    //     vm.data.BatchExitList = r.data||[];
    // });

  }
})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/16.
 */

(function (angular, undefined) {
  'use strict';
  materialAdd.$inject = ["$scope", "api", "utils", "$stateParams", "$state"];
  angular
    .module('app.material')
    .component('materialAdd', {
      templateUrl: 'app/main/material/component/material-add.html',
      controller: materialAdd,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function materialAdd($scope, api, utils, $stateParams, $state) {
    var vm = this;
    vm.data = {};
    vm.data.Id = $stateParams.id;
    vm.cid = $stateParams.cid;
    vm.pageState = vm.cid != 0 ? true : false;
    vm.readonly = false;

    api.material.type.getList({ Skip: 0, Limit: 999 }).then(function (g) {
      vm.materialType = g.data.Items || [];
    });

    if (vm.data.Id) {
      api.material.materialScience.getMaterial(vm.data.Id).then(function (r) {
        vm.data = r.data;
        if (vm.cid != 0) {
          api.material.contract.GetContractDetailById(vm.cid, vm.data.Id).then(function (r) {
            if (r.data) {
              vm.Brands = r.data.Brands.split(/、|,|，|；|;/);
            } else {
              vm.Brands = vm.data.Brands.split(/、|,|，|；|;/);
            }
          });
        }
      })
    }

    vm.save = function () {

      if (vm.cid != 0) {
        var _str = vm.Brands.join("、");
        var _data = { 'ContractId': vm.cid, 'MaterialId': vm.data.Id, 'Brands': _str };
        api.material.contract.UpdateContract(_data).then(function () {
          utils.alert("提交成功", null, function () {
            $state.go("app.material.materialLibrary", { cid: vm.cid });
          });
        })
      } else {
        if (vm.data.Id) {
          api.material.materialScience.putMaterial(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.materialLibrary");
            });
          })
        } else {
          api.material.materialScience.Create(vm.data).then(function () {
            utils.alert("提交成功", null, function () {
              $state.go("app.material.materialLibrary");
            });
          })
        }
      }
    }
  }
})(angular, undefined);

/**
 * Created by HuangQingFeng on 2016/11/22.
 */
(function (angular, undefined) {
  'use strict';

  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.earthwork', ['app.core','app.xhsc','angularFileUpload'])
    .config(config);
  /** @ngInject */
  function config($stateProvider, msNavigationServiceProvider) {
    $stateProvider
      .state('app.earthwork', {
        url: '/earthwork',
        views: {
          'content@app': {
            template: '<ui-view class="animate-slide-left" flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      // .state('app.earthwork.test',{
      //   url:'/test',
      //   template:'<earthwork-test flex layout="column"></earthwork-test>'
      // })
    .state('app.earthwork.list', {
      url:'/list',
      template:'<earthwork-list flex layout="column"></earthwork-list>'
    });
    // msNavigationServiceProvider.saveItem('earthwork', {
    //   title: '土方管理',
    //   group: true,
    //   weight: 2
    // });

    // msNavigationServiceProvider.saveItem('earthwork.test', {
    //   title: '画图测试',
    //   icon: 'icon-calendar-text',
    //   state: 'app.earthwork.test',
    //   weight: 1
    // });


    // msNavigationServiceProvider.saveItem('earthwork.earthwork', {
    //   title: '土方管理',
    //   icon: 'icon-sort-variant',
    //   state: 'app.earthwork.list',
    //   weight: 1
    // });

  }
})(angular, undefined);

/**
 * Created by HuangQingFeng on 2016/11/24.
 */

(function (angular, undefined) {
  'use strict';
  sxtImagesTf.$inject = ["$rootScope", "FileUploader", "tokenInjector", "api", "sxt", "$q", "utils"];
  angular.module('app.earthwork')
    .directive('sxtImagesTf',sxtImagesTf);

  /**@ngInject*/
  function sxtImagesTf($rootScope,FileUploader,tokenInjector,api,sxt,$q,utils) {
    return {
      restrict: 'E',
      require: "?ngModel",
      scope: {
        rid: '=ngModel',
        project: '=',
        edit: '@',
        files: '=',
        single: '@',
        isPartions: '@'
      },
      controller: ["$scope", function ($scope) {
        var dataURItoBlob = function (dataURI) {
          var byteString;
          if (dataURI.split(',')[0].indexOf('base64') >= 0)
            byteString = atob(dataURI.split(',')[1]);
          else
            byteString = unescape(dataURI.split(',')[1]);
          var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
          var ia = new Uint8Array(byteString.length);
          for (var i = 0; i < byteString.length; i++) {
            ia[i] = byteString.charCodeAt(i);
          }

          return new Blob([ia], {
            type: mimeString
          });
        };

        var resizeFile = function (file) {
          var deferred = $q.defer();
          var img = new Image();
          try {
            var reader = new FileReader();
            reader.onload = function (e) {
              img.src = e.target.result;
              img.onload = function () {
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0);
                var MAX_WIDTH = 800;
                var MAX_HEIGHT = 800;
                var width = img.width;
                var height = img.height;
                if (width > height) {
                  if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                  }
                } else {
                  if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                  }
                }
                canvas.width = width;
                canvas.height = height;
                var ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, width, height);

                var dataURL = canvas.toDataURL('image/jpeg');
                var blob = dataURItoBlob(dataURL);

                deferred.resolve(dataURL);
              }
            };
            reader.readAsDataURL(file);
          } catch (e) {
            deferred.resolve(e);
          }
          return deferred.promise;

        };

        var uploader = $scope.uploader = new FileUploader({
          headers: {'Authorization': tokenInjector.getToken()},
          autoUpload: false,
          // onSuccessItem: function (item, response, status, headers) {
          //
          //   if (status == 200) {
          //     $scope.imgOK = true;
          //
          //   } else {
          //     $scope.imgFail = true;
          //   }
          //
          //   item.file.Id = response.Files[0].Id;
          //   item.file.Url = response.Files[0].Url;
          //   item.file.Remark = response.Files[0].Remark;
          //   if (angular.isArray($scope.files))
          //     $scope.files.push(response.Files[0].Url);
          //   item.remove = function () {
          //     var me = this;
          //
          //     FilesService.delete(me.file.Id).then(function (r) {
          //       var ix = uploader.queue.indexOf(me);
          //       uploader.queue.splice(ix, 1);
          //       if (angular.isArray($scope.files))
          //         $scope.files.splice(ix, 1);
          //     });
          //   }
          //   item.save = function () {
          //     var me = this;
          //     FilesService.update(me.file).then(function () {
          //       me.isEditing = false;
          //     })
          //   }
          //   if ($scope.single && uploader.queue.length > 1) {
          //     uploader.queue[0].remove();
          //   }
          // },
          onAfterAddingFile: function (item) {
            if ($scope.single && item.file.type.indexOf('image/') != -1) {
              resizeFile(item._file).then(function (blob_data) {
                // item.formData = [{s:blob_data}]
                //item.upload();
                var id= sxt.uuid();
                api.earthwork.earthwork.upLoadImage({Id:id,ImageName:id + '.jpeg',RelationId:$scope.rid,ImageByte:blob_data})
                  .then(function (r) {
                    $scope.imgOK = true;

                    item.file.Id = r.data.Id;
                    item.file.Url = sxt.app.api + r.data.ImageUrl;
                    if (angular.isArray($scope.files))
                      $scope.files.push(sxt.app.api + r.data.ImageUrl);
                    item.remove = function () {
                      var me = this;

                      api.earthwork.earthwork.DeleteFile(me.file.Id).then(function (r) {
                        var ix = uploader.queue.indexOf(me);
                        uploader.queue.splice(ix, 1);
                        if (angular.isArray($scope.files))
                          $scope.files.splice(ix, 1);
                      });
                    }
                    item.save = function () {
                      var me = this;
                      api.earthwork.earthwork.upLoadImage(r.data).then(function () {
                        me.isEditing = false;
                      })
                    }
                    if ($scope.single && uploader.queue.length > 1) {
                      uploader.queue[0].remove();
                    }
                  });
              })
            }
            else {
              // item.formData = [{Id:'12313124',ImageName:'bbbbb'}];


              item.upload();
            }

          }
        });
        $scope.editPic = function (file) {
          if (!$scope.edit || utils.isApp()) return;
          var url;
          if (file.Url.indexOf('data:app/main/earthwork/images/png') != -1) {
            url = file.Url && file.Url.substring(0, 1) == '~' ? file.Url.substring(1) : file.Url;

          } else {
            url = appConfig.apiUrl + (file.Url && file.Url.substring(0, 1) == '~' ? file.Url.substring(1) : file.Url);
          }
          utils.imgEdit(url.replace('/s_', '/'), function (data) {
            FilesService.update({Id: file.Id,file: file, Url: data}).then(function (result) {
              file.Url = result.data.Url;
              //console.log('scope', data,file.Id)
              // uploader.queue.push(item);
              utils.alert('更新成功');
            });
          });
        }
        $scope.remove = function ($event, file) {

          $scope.imgOK = false;
          $event.preventDefault();
          utils.confirm('确认删除此材料信息').then(function () {
            file.remove();
          });
        }

        if ($scope.isPartions == "true") {
          FilesService.GetPartionId().then(function (r) {
            $scope.partions = r.data.Rows;
          })
          //$scope.partions = $scope.partions ? $scope.partions : [{ Id: 1, desc: '卫生间' }, { Id: 2, desc: '厨房' }, { Id: 4, desc: '主卧' }, { Id: 8, desc: '次卧' }, { Id: 16, desc: '儿童房' }, { Id: 32, desc: '卫生间1' }, { Id: 64, desc: '卫生间2' }];

          $scope.setParDes = $scope.setParDes ? $scope.setParDes : function (partionID, item) {
            var findParbyId = function () {
              for (var i = 0; i < $scope.partions.length; i++) {
                if ($scope.partions[i].Id == partionID) {
                  return $scope.partions[i];
                }
              }
            }
            if (item) {
              var partion = findParbyId();
              item.showPartion = partion ? partion.desc : '';
            }
          }

          $scope.modify = function (partionID, item) {
            $scope.setParDes && $scope.setParDes(partionID, item);
            FilesService.modifyPartion(partionID, item.file.Id);
          }

        }
      }],
      templateUrl: "app/main/earthwork/directives/sxtImages_Template.html",
      link: function (scope, element, attrs, ngModel) {
        var uploader = scope.uploader;
        var rid;
        scope.$watch('rid', function () {
          if (rid && rid == scope.rid) return;
          if (angular.isArray(scope.files)) {
            scope.files.splice(0, scope.files.length);
          }
          uploader.queue.length = 0;
          rid = scope.rid;
          if (rid != '') {
            uploader.url = 'http://localhost:5000/api/Eartwork/UpLoadImage/' + rid;
            angular.forEach(uploader.queue, function (item) {
              item.url = sxt.app.api + uploader.url
            });
          }
          scope.inputChange = function () {
            scope.imgOK = false;
            scope.imgFail = false;
          }

          api.earthwork.earthwork.getFileByRid(scope.rid).success(function (data) {
            if (rid != data.RelationId) {
              rid = scope.rid = data.RelationId;
              uploader.url = sxt.app.api + '/api/Eartwork/UpLoadImage/' + rid;
              angular.forEach(uploader.queue, function (item) {
                item.url = sxt.app.api + uploader.url
              });
            }
            if (data) {
              if (angular.isArray(scope.files)) {
                scope.files = [];
              }
              if (angular.isArray(scope.files))
                scope.files.push(sxt.app.api + data.ImageUrl);
              var item = {
                file: {
                  Id: data.Id,
                  name: data.ImageName,
                  //size: att.FileSize,
                  Url: sxt.app.api + data.ImageUrl,
                  //UserID: att.UserID,
                  //Remark: att.Remark,
                  CreateDate: data.CreateTime
                  //PartionID: att.PartionID
                },
                remove: function () {
                  var me = this;
                  api.earthwork.earthwork.DeleteFile(me.file.Id).then(function (r) {
                    uploader.queue.splice(uploader.queue.indexOf(me), 1);
                  });
                },
                save: function () {
                  var me = this;
                  api.earthwork.earthwork.upLoadImage(data).then(function () {
                    me.isEditing = false;
                  })
                },
                progress: 100,
                isServer: true,
                isSuccess: true,
                isCancel: false,
                isError: false,
                isReady: false,
                isUploading: true,
                isUploaded: true,
                index: null
              };
              scope.setParDes && scope.setParDes(att.PartionID, item);
              uploader.queue.push(item);
            }
          })
        });
      }
    }
  }

})(angular,undefined);

/**
 * Created by lukehua on 2016/11/22.
 */

(function (angular, undefined) {
  'use strict';

  sxtAreaTf.$inject = ["$timeout", "sxt", "utils", "api"];
  angular
    .module('app.earthwork')
    .directive('sxtAreaTf', sxtAreaTf);

  /**@ngInject*/
  function sxtAreaTf($timeout, sxt, utils, api) {

    return {
      scope: {
        data: '=',
        isShow: '=',
        popup: '@'
      },
      link: function (scope, element, attrs, ctrl) {
        var map, el;
        var ran = function () {
          if (!scope.isShow || !scope.data || scope.data.files.length === 0) return;
          if (map) map.remove();

          var url = scope.data.obj.FileId;
          var layer;
          map = L.map(element[0], {
            crs: L.extend({}, L.CRS, {
              projection: L.Projection.LonLat,
              transformation: new L.Transformation(1, 0, 1, 0),
              scale: function (e) {
                return 512 * Math.pow(2, e);
              }
            }),
            center: [.48531902026005, .5],
            zoom: 0,
            minZoom: 0,
            maxZoom: 3,
            scrollWheelZoom: true,
            annotationBar: false,
            zoomControl: false,
            attributionControl: false
          }),
            //layer = L.tileLayer(sxt.app.api + '/api/file/load?x={x}&y={y}&z={z}', {
            layer = L.tileLayer(sxt.app.api + '/api/PicMap/load/{z}_{x}_{y}.png?fid=' + url.replace('/s_', '/'), {
              noWrap: true,
              continuousWorld: false,
              tileSize: 512
            });
          map.projectId = scope.projectId;
          layer.addTo(map);
          L.drawLocal = {
            draw: {
              toolbar: {
                actions: {
                  title: '取消',
                  text: '取消'
                },
                undo: {
                  title: '撤消最后一个点',
                  text: '撤消'
                },
                buttons: {
                  polyline: '',
                  polygon: '切画区域',
                  rectangle: 'Draw a rectangle',
                  circle: 'Draw a circle',
                  marker: '摄像头位置'
                }
              },
              handlers: {
                circle: {
                  tooltip: {
                    start: 'Click and drag to draw circle.'
                  },
                  radius: 'Radius'
                },
                marker: {
                  tooltip: {
                    start: '点击这里放置摄像头'
                  }
                },
                polygon: {
                  tooltip: {
                    start: '点击开始',
                    cont: '点击继续',
                    end: '点击第一点结束.'
                  }
                },
                polyline: {
                  error: '<strong>Error:</strong> shape edges cannot cross!',
                  tooltip: {
                    start: 'Click to start drawing line.',
                    cont: 'Click to continue drawing line.',
                    end: 'Click last point to finish line.'
                  }
                },
                rectangle: {
                  tooltip: {
                    start: 'Click and drag to draw rectangle.'
                  }
                },
                simpleshape: {
                  tooltip: {
                    end: 'Release mouse to finish drawing.'
                  }
                }
              }
            },
            edit: {
              toolbar: {
                actions: {
                  save: {
                    title: '保存编辑.',
                    text: '保存'
                  },
                  cancel: {
                    title: '取消编辑，所有改动将取消',
                    text: '取消'
                  }
                },
                buttons: {
                  edit: 'Edit layers.',
                  editDisabled: 'No layers to edit.',
                  remove: 'Delete layers.',
                  removeDisabled: 'No layers to delete.'
                }
              },
              handlers: {
                edit: {
                  tooltip: {
                    text: '点击方块改变区域.',
                    subtext: '点击取消退出编辑'
                  }
                },
                remove: {
                  tooltip: {
                    text: '点击物件删除'
                  }
                }
              }
            }
          };
          var drawnItems = L.featureGroup(),
            labels = L.featureGroup();

          map.addLayer(labels);
          map.addLayer(drawnItems);

          api.earthwork.earthwork.getEarthworkList({
            regionTreeId: scope.data.obj.RegionTreeId + '>' + scope.data.obj.Id,
            status: 4
          }).then(function (r) {
            r.data.forEach(function (ly) {
              var geojson = JSON.parse(ly.GeoJSON),
                options = geojson.options;
              if (scope.data.zy && options.zy != scope.data.zy) return;
              switch (geojson.geometry.type) {
                case 'Circle':
                  layer = L.circle(L.GeoJSON.coordsToLatLng(geojson.geometry.coordinates), options.radius, options);
                  break;
                default:
                  var layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);
                  layer.feature = L.GeoJSON.asFeature(geojson);

                  break;
              }
              layer.data = ly;
              drawnItems.addLayer(layer);
              updateText(layer);
              layer.on('mouseover', function () {
                console.log('mouseover');
              })
              layer.on('mouseout', function () {
                console.log('mouseout');
              })
              layer.on('click', function (e) {
                openPopup(layer);
              })
            })
          });


          var editing, isPopup, drawLine;
          map.on('draw:drawstart', function (e) {
            var type = e.layerType;
            if (type == 'polyline') {
              drawLine = true;
            }
            console.log('start', type);
          });
          map.on('draw:drawstop', function (e) {
            drawLine = false;
            console.log('end');
          });
          map.on('draw:pointChanged', function (e) {
            console.log('point', e);
          })
          map.on('draw:editstart', function () {
            editing = true;
          })
          map.on('draw:deletestart', function () {
            editing = true;
          })
          map.on('draw:editstop', function () {
            editing = false;
          })
          map.on('draw:deletestop', function () {
            editing = false;
          })
          map.on('draw:created', function (e) {
            var type = e.layerType,
              layer = e.layer;
            drawnItems.addLayer(layer);
            layer.on('click', function (e) {
              openPopup(layer);
            })
            openPopup(layer);
          });
          map.on('draw:edited', function (e) {
            var layers = e.layers;
            layers.eachLayer(function (layer) {
              var geojson = layer.toGeoJSON();
              geojson.geometry.type = geojson.geometry.type != 'Polygon' ? 'Circle' : 'Polygon';
              geojson.options = layer.options;
              geojson.options.radius = layer._mRadius;
              layer.data.GeoJSON = JSON.stringify(geojson);
              api.earthwork.earthwork.updateEarthworkArea(layer.data.Id, layer.data);
            });
          });
          map.on('draw:deleted', function (e) {
            var layers = e.layers;
            layers.eachLayer(function (layer) {
              api.earthwork.earthwork.delete(layer.data.Id).then(function () {
                var ly = null;
                labels.eachLayer(function (lb) {
                  if (lb.id == layer.options.id)
                    ly = lb;
                });
                if (ly) {
                  labels.removeLayer(ly);
                }
              })
            });
          });
          // map.on('popupclose', function (e) {
          //
          //   var text = $('input', el).val();
          //   var type = $('#zjtypeB', el).length ? $('#zjtypeB', el).prop('checked') ? 'B' : 'A' : null;
          //   if (text == '') {
          //     setTimeout(function () {
          //       //alert('请输入名称');
          //       e.popup.openOn(map);
          //     }, 10);
          //   }
          //   else {
          //     isPopup = false;
          //     var layer = e.popup.layer;
          //     layer.options.text = text;
          //     layer.options.type = type;
          //     var json = layer.toGeoJSON();
          //     json.geometry.type = json.geometry.type != 'Polygon' ? 'Circle' : 'Polygon';
          //     json.options = layer.options;
          //     json.options.radius = layer._mRadius;
          //     json.options.zy = scope.data.zy;
          //     json.options.id = json.options.id || sxt.uuid();
          //     layer.data = {
          //       Id: json.options.id,
          //       RegionName: text,
          //       RegionType: scope.data.obj.RegionType,
          //       RegionTreeId: scope.data.obj.RegionTreeId + '>' + scope.data.obj.Id,
          //       RegionTreeName: scope.data.obj.RegionTreeName + '>' + scope.data.obj.RegionName,
          //       UserId: json.options.type,
          //       GeoJSON: JSON.stringify(json)
          //     }
          //
          //     api.earthwork.earthwork.createEarthworkArea(layer.data).then(function () {
          //       $('input', el).val('');
          //       updateText(layer);
          //     });
          //   }
          // });

          function updateText(layer) {
            if (!layer.options.text) return;
            var ly = null;
            labels.eachLayer(function (lb) {
              if (lb.id == layer.options.id)
                ly = lb;
            });
            if (ly) {
              labels.removeLayer(ly);
            }

            ly = L.marker(layer.getBounds().getCenter(), {
              icon: new ST.L.LabelIcon({
                html: layer.options.text,
                color: layer.options.color,
                iconAnchor: [(layer.options.text.length * 6), 12]
              }),
              saved: false,
              draggable: false,       // Allow label dragging...?
              zIndexOffset: 1000     // Make appear above other map features
            });
            ly.id = layer.options.id;
            labels.addLayer(ly);

          }

          function openPopup(layer) {
            // if (editing || isPopup) {
            //   map.closePopup();
            //   return;
            // };

            el = el || document.getElementById(scope.popup);
            $('input', el).val(layer.options.text);
            if (layer.options.type == 'B') {
              $('#zjtypeA', el).prop('checked', false);
              $('#zjtypeB', el).prop('checked', true);
            }
            else {
              $('#zjtypeB', el).prop('checked', false);
              $('#zjtypeA', el).prop('checked', true);
            }
            var popup = L.popup()
              .setLatLng(layer.getBounds().getCenter())
              .setContent(el)
              .openOn(map);
            isPopup = true;
            popup.layer = layer;
          }

          var drawControl = new L.Control.Draw({
            draw: {
              select: false,
              yun: false,
              arrow: false,
              pen: false,
              zi: false,
              hand: false,
              polygon: {
                allowIntersection: false,
                drawError: {
                  color: '#b00b00',
                  timeout: 1000
                },
                shapeOptions: {
                  color: '#ff0000'
                },
                showArea: false
              },
              rectangle: false,
              polyline: false,
              circleMarker: {
                shapeOptions: {
                  weight: 2
                }
              },
              video: false,
              marker: false
            },
            edit: {
              edit: true,
              remove: true,
              featureGroup: drawnItems
            }
          });
          map.addControl(drawControl);

        }

        function ran1() {
          $timeout(ran, 300);
        }

        scope.$watch('data', ran1);
        scope.$watch('data.zy', ran1);
        scope.$watch('isShow', ran1);
        scope.$watchCollection('data.files', function () {
          if (scope.data.files && scope.data.files.length) {
            ran1();
          }
          else {
            if (map) {
              map.remove();
              map = null;
            }
          }
        });
      }
    };
  }
})(angular, undefined);

/**
 * Created by lukehua on 2016/11/24.
 */

(function (angular, undefined) {
  'use strict';
  earthworkTest.$inject = ["$scope"];
  angular
    .module('app.earthwork')
    .component('earthworkTest', {
      templateUrl: 'app/main/earthwork/component/earthwork-test.html',
      controller: earthworkTest,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function earthworkTest($scope) {
    var vm = this;
    vm.tf = {};
    vm.tf.files = ['7d177bcf402e479f925e01704c76f74c'];
    vm.tf.obj = {

      CreateDate: "2016-11-21",
      GeoJSON: null,
      Id: "958b24a76bd2479ebe71bcff590833da",
      RegionName: "园建",
      RegionTreeId: "00042>0004200000",
      RegionTreeName: "金鹏测试项目>一期",
      RegionType: 128,
      Status: 4,
      UserId: null,
      FileId:'7d177bcf402e479f925e01704c76f74c'
    };
    vm.tf.data = [
      {
        Id: "0-f0dfa64566da446c9f30b41d55e3f34d",
        RegionType: 128,
        RegionName: "1区域",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Polygon\",\"coordinates\":[[[0.0703125,0.17578125],[0.32421875,0.169921875],[0.181640625,0.40234375],[0.0703125,0.17578125]]]},\"options\":{\"stroke\":true,\"color\":\"#ff0000\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":4,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"smoothFactor\":1,\"noClip\":false,\"text\":\"1区域\",\"type\":null}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }, {
        Id: "0-7932d634c5a04dc4b2fddd820fb05301",
        RegionType: 128,
        RegionName: "2区域",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Polygon\",\"coordinates\":[[[0.740234375,0.083984375],[0.802734375,0.080078125],[0.904296875,0.5625],[0.8515625,0.568359375],[0.740234375,0.083984375]]]},\"options\":{\"stroke\":true,\"color\":\"#ff0000\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":4,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"smoothFactor\":1,\"noClip\":false,\"text\":\"2区域\",\"type\":null}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }, {
        Id: "0-ac329fda39a841529695d59605cb917e",
        RegionType: 128,
        RegionName: "2",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Polygon\",\"coordinates\":[[[0.27734375,0.36328125],[0.345703125,0.671875],[0.69921875,0.525390625],[0.58984375,0.248046875],[0.29296875,0.36328125],[0.27734375,0.36328125]]]},\"options\":{\"stroke\":true,\"color\":\"#ff0000\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":4,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"smoothFactor\":1,\"noClip\":false,\"text\":\"2\",\"type\":null}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }, {
        Id: "0-5c1315f9b2b644b58e2b011a3ff7dfec",
        RegionType: 128,
        RegionName: "ppp",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Polygon\",\"coordinates\":[[[0.1796875,0.095703125],[0.46484375,0.138671875],[0.43359375,0.068359375],[0.189453125,0.09375],[0.1796875,0.095703125]]]},\"options\":{\"stroke\":true,\"color\":\"#ff0000\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":4,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"smoothFactor\":1,\"noClip\":false,\"text\":\"ppp\",\"type\":null}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }, {
        Id: "0-894ae56a708c4beaa52bcb73ef3edc27",
        RegionType: 128,
        RegionName: "sss",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Circle\",\"coordinates\":[1.142578125,0.171875]},\"options\":{\"stroke\":true,\"color\":\"#ff0000\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":2,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"text\":\"sss\",\"type\":null,\"radius\":12461.414843635388}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }, {
        Id: "0-c7ad3d2e047a4ef9846054c25a3eef7a",
        RegionType: 128,
        RegionName: "kkk",
        RegionTreeId: "00042>0004200000>958b24a76bd2479ebe71bcff590833da",
        RegionTreeName: "金鹏测试项目>一期>园建",
        GeoJSON: "{\"type\":\"Feature\",\"properties\":{},\"geometry\":{\"type\":\"Polygon\",\"coordinates\":[[[0.30078125,0.78125],[0.625,0.666015625],[0.671875,0.845703125],[0.296875,0.7890625],[0.30078125,0.78125]]]},\"options\":{\"stroke\":true,\"color\":\"#9e9e9e\",\"dashArray\":null,\"lineCap\":null,\"lineJoin\":null,\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":null,\"fillOpacity\":0.2,\"clickable\":true,\"smoothFactor\":1,\"noClip\":false,\"text\":\"kkk\",\"type\":null}}",
        Status: 0,
        CreateDate: "2016-11-23",
        UserId: null
      }];
  }
})(angular, undefined);


/**
 * Created by HuangQingFeng on 2016/11/22.
 */

(function (angular, undefined) {
  'use strict';
  earthworkList.$inject = ["$scope", "api", "utils", "$stateParams", "$state", "$compile", "sxt"];
  angular
    .module('app.earthwork')
    .component('earthworkList', {
      templateUrl: 'app/main/earthwork/component/earthwork-list.html',
      controller: earthworkList,
      controllerAs: 'vm'
    });

  /** @ngInject */
  function earthworkList($scope,api, utils, $stateParams, $state,$compile,sxt) {
    var vm = this;
    vm.data = {};
    vm.lst_html = [];
    vm.RegionName = '';
    vm.RegionTreeId = '';
    vm.RegionTreeName = '';
    //vm.rid = 'ed8f02b3cdd94f90b8343ae69d0c94b7';
    //vm.files = [];

    vm.tf = {};
    // vm.tf.obj = {
    //   CreateDate: null,
    //   GeoJSON: null,
    //   Id: null,
    //   RegionName: null,
    //   RegionTreeId: null,
    //   RegionTreeName: null,
    //   RegionType: 0,
    //   Status: 0,
    //   UserId: null
    // };
    // vm.tf.data = [
    //   {
    //     Id: null,
    //     RegionType: 0,
    //     RegionName: null,
    //     RegionTreeId: null,
    //     RegionTreeName: null,
    //     GeoJSON: null,
    //     Status: 0,
    //     CreateDate: null,
    //     UserId: null
    //   }
    // ];

    api.xhsc.Project.getMap().then(function (r) {
      vm.ProjectList = r.data||[];
    });

    $scope.$watch('vm.project',function () {
      if (vm.project==null) return;
      vm.StagesList = [];
        api.xhsc.Project.GetAreaChildenbyID(vm.project).then(function (r) {
        vm.StagesList = r.data||[];
        vm.lst_html = [];
      });
    });

    $scope.$watch('vm.Stages',function () {
      vm.lst_html = [];
      if(vm.Stages==null) return;
      vm.RegionTreeId = vm.project+'>'+vm.Stages;
      load(vm.RegionTreeId);
    });

    function load (regionTreeId) {
      vm.lst_html = [];
      api.earthwork.earthwork.getEarthworkByRegionTreeId({regionTreeId:vm.RegionTreeId}).then(function (r) {
        if(r.data && r.data.length>0){
          vm.lst_html = r.data;
          console.log(vm.lst_html)
        }
      });
    }

    vm.addRegion = function () {
      if(vm.RegionName==''){
        utils.alert('区域名称不能为空！');
        return;
      }

      var model = {
        Id:sxt.uuid(),
        GeoJSON:'',
        RegionName:vm.RegionName,
        RegionTreeId:vm.RegionTreeId,
        RegionTreeName:vm.RegionTreeName,
        RegionType:128,
        Status:4,
        CrateTime:new Date().Format('yyyy-MM-dd hh:mm:ss')
      };
      vm.lst_html.push(model);
      vm.RegionName = '';
    }

    vm.makeRegionTreeName = function (arg1,arg2){
      if (arg1!=null && arg1!=''){
        vm.RegionTreeName = arg1;
      }
      if (arg2!=null && arg2!=''){
        vm.RegionTreeName = vm.RegionTreeName +'>'+ arg2;
      }
    }

    vm.save = function (data) {
      api.earthwork.earthwork.save(data).then(function (r) {
        utils.alert('提交成功！');
        load(vm.RegionTreeId);
      });
    }

    // vm.showImg = function (data) {
    //   vm.rid = data.Id;
    //   vm.tf.obj = data ? data : [];
    //   vm.tf.files.push(data.FileId);
    // }
  }
})(angular, undefined);

/**
 * Created by jiuyuong on 2016/1/21.
 */
(function ()
{
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider", "authProvider"];
  angular
    .module('app.auth', ['JPushPlugin'])
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider,authProvider)
  {
    authProvider.interceptors.push('vankeAuth');

    // State
    $stateProvider
      .state('app.auth', {
        url    : '/auth',
        views    : {
          'main@': {
            templateUrl: 'app/core/layouts/content-only.html',
            controller : 'MainController as vm'
          }
        },
        abstract:true
      })
      .state('app.auth.login', {
        auth     : false,
        url      : '/login',
        views    : {
          'content@app.auth': {
            templateUrl: 'app/main/auth/login/login.html',
            controller: 'LoginController as vm'
          }
        }
      })
      .state('app.auth.resetpassword', {
       url: '/resetpassword',
        views    : {
          'content@app.auth': {
            templateUrl: 'app/main/auth/components/reset-password.html',
            controller: 'ResetPsdController as vm'
          }
        }
     });

    // Translation
    $translatePartialLoaderProvider.addPart('app/main/auth');

    //// Navigation
    //msNavigationServiceProvider.saveItem('auth', {
    //  title : '认证',
    //  group : true,
    //  weight: 1
    //});
    //
    //msNavigationServiceProvider.saveItem('auth.login', {
    //  title    : '登录',
    //  icon     : 'icon-tile-four',
    //  state    : 'app.auth.login',
    //  weight   : 1
    //});
  }
})();

(function ()
{
  'use strict';

  vankeAuth.$inject = ["$http", "$q", "$rootScope", "api", "utils", "JPushPlugin", "$timeout"];
  angular
    .module('app.auth')
    .factory('vankeAuth', vankeAuth);

  /** @ngInject */
  function vankeAuth($http,$q,$rootScope,api,utils,JPushPlugin,$timeout)
  {
    var service = {
      token   : token,
      profile : profile,
      refresh : refresh
    };
    $rootScope.$on('user:logout', function () {
      utils.cookies.remove('auth');
    });


/*    var userInfo = api.db({
      _id:'s_userinfo',
      idField:'UserId',
      filter:function () {
        return true;
      },
      dataType:3
    }).bind(function () {
      return $http.get(sxt.app.api + '/api/Security/profile', {t: new Date().getTime()});
    });*/
    return service;

    function refresh(s,response) {
      return $q(function (resolve,reject) {
        var authObj = utils.cookies.get('auth');
        if(authObj) {
          authObj = JSON.parse (authObj);
          s.login(authObj).then(function () {
            resolve();
          }).catch(function () {
            reject(response);
          });
        }
        else{
          reject(response);
        }
      })
    }

    function token(user) {

      return $q(function (resolve, reject) {
        if (user) {
          user.grant_type = 'password';
          $http({
            method: 'POST',
            url: sxt.app.api + '/token',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'//,
            },
            transformRequest: function (obj) {
              var str = [];
              for (var p in obj)
                str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
              return str.join("&");
            },
            data: user
          })
            .then(function (result) {
                if (result) {
                  utils.cookies.put('auth', JSON.stringify(user));
                  var token = result.data;
                  resolve(token);
                }
                else {
                  utils.cookies.remove('auth');
                  reject({})
                }
              },
              function () {
                utils.cookies.remove('auth');
                reject(user);
              });
        }
        else {
          return reject();
        }
      });

    }

    function profile(token){
      if(!token || !token.username) {
        return $q (function (resolve, reject) {
          api.setNetwork(0);
          api.xhsc.profile().then(function (d) {
            if(!d ||(!d.status && !d.data)){
              $rootScope.$emit('user:needlogin');
            }
            else{
              $timeout(function () {
                JPushPlugin.setAlias(d.data.UserId);
              },3000);
            }
            resolve(d && d.data);
            api.resetNetwork();
          }, function (rejection) {

            utils.alert(rejection.data && rejection.data.Message?rejection.data.Message:'网络错误');
            reject(token);
          });
        });
      }
      else{
        return token;
      }
    }
  }

})();

/**
 * Created by jiuyuong on 2016/1/22.
 */

(function ()
{
    'use strict';

    LoginController.$inject = ["auth", "utils"];
    angular
        .module('app.auth')
        .controller('LoginController', LoginController);

    /** @ngInject */
    function LoginController(auth,utils)
    {

      var vm = this;
        // Data

        // Methods
      vm.text="登入"
      vm.login = function(loginForm){
        //console.log('login',vm.form)
       // vm.form = {id: 1, RealName: "v-zhangqy03", Token: "429ad0b0d7ab966180cc4718324c50ddf176d099", Username: "v-zhangqy03"}
        vm.text="正在登入"
        auth.login(vm.form).then(function(){
          vm.text="登入"
          //utils.tips('登录成功');
        },function(reject){
          vm.text="登入"
          utils.tips('用户名或密码错误')
        })
      }


      //////////
    }
})();

/**
 * Created by khot on 2016/12/18.
 */
(function () {
  'use strict';

  ResetPsdController.$inject = ["$rootScope", "$state", "$scope", "api", "utils", "auth", "$timeout", "$mdDialog"];
  angular
    .module('app.auth')
    .controller('ResetPsdController', ResetPsdController)
    .component('resetPassword', {
      templateUrl: 'app/main/auth/components/reset-password.html',
      controller: ResetPsdController,
      controllerAs: 'vm'
    });

  /**@ngInject*/
  function ResetPsdController($rootScope, $state, $scope, api, utils, auth, $timeout, $mdDialog) {
    var vm = this;

    init();

    vm.sending = false;
    vm.send = function () {
      if (vm.sending) return;
      vm.timing = 60;
      vm.sending = 'S后重新发送';
      api.auth.verificationCode.post({ identitySign: $scope.d.username, type: 'ResetPassword' }).then(function () {
        $timeout(function () {
          updateTime();
        }, 1000);
      });
    }

    function updateTime() {
      vm.timing--;
      if (vm.timing == 0) {
        vm.sending = false;
        vm.timing = 0;
      } else {
        $timeout(function () {
          updateTime();
        }, 1000);
      }
    }

    vm.submit = function () {
      if ($scope.d.newPassword.length < 6) {
        vm.resetError = '*新密码不少于6位字符';
        return;
      }
      if ($scope.d.newPassword !== $scope.d.passwordConfirm) {
        vm.resetError = '*两次输入的密码不一致';
        return;
      }
      api.auth.user.reset({
        emailAddressOrMobileNo: $scope.d.username,
        oldPassword: $scope.d.oldPassword,
        newPassword: $scope.d.newPassword
      }).then(function (r) {
        vm.resetError = '';
        console.log(r);
        if (r.data != "") {
          $mdDialog.show(
            $mdDialog.alert()
              .textContent('原密码错误')
              .ok('确认')
          );
        } else {
          $mdDialog.show(
            $mdDialog.alert()
              .textContent('修改密码成功')
              .ok('确认')
          );
           $scope.d.oldPassword = '';
           $scope.d.newPassword = '';
           $scope.d.passwordConfirm = '';
        }

      }, function (reject) {
        console.log(reject);
      })
    }

    function init() {
      auth.getUser().then(function (r) {
        console.log('获取用户信息', r.data);
        $scope.d = {
          username: r.data.displayName
        }
      })
    }
  }
})();

/**
 * Created by leshuangshuang on 16/8/1.
 */
(function(){
  'use strict';

  angular
    .module('JPushPlugin',[]);
})();

/**
 * Created by leshuangshuang on 16/8/1.
 */
(function(){
  'use strict';

  JPushPlugin.$inject = ["$window", "$rootScope", "utils", "xhUtils", "$timeout", "$state"];
  angular
    .module('JPushPlugin')
    .factory('JPushPlugin',JPushPlugin);
  /** @ngInject */
  function JPushPlugin($window,$rootScope,utils,xhUtils,$timeout,$state){
    var JPushPlugin = $window.plugins && $window.plugins.jPushPlugin;

    if(!JPushPlugin){
      JPushPlugin = {
        setTagsWithAlias:emptyFn,
        setTags:emptyFn,
        init:emptyFn,
        setAlias:emptyFn
      }
    }

    JPushPlugin.init();
    return JPushPlugin;

    function emptyFn(){

    }

  }
})();

(function ()
{
    'use strict';

    MsWidgetController.$inject = ["$scope", "$element"];
    angular
        .module('app.core')
        .controller('MsWidgetController', MsWidgetController)
        .directive('msWidget', msWidgetDirective)
        .directive('msWidgetFront', msWidgetFrontDirective)
        .directive('msWidgetBack', msWidgetBackDirective);

    /** @ngInject */
    function MsWidgetController($scope, $element)
    {
        var vm = this;

        // Data
        vm.flipped = false;

        // Methods
        vm.flip = flip;

        //////////

        /**
         * Flip the widget
         */
        function flip()
        {
            if ( !isFlippable() )
            {
                return;
            }

            // Toggle flipped status
            vm.flipped = !vm.flipped;

            // Toggle the 'flipped' class
            $element.toggleClass('flipped', vm.flipped);
        }

        /**
         * Check if widget is flippable
         *
         * @returns {boolean}
         */
        function isFlippable()
        {
            return (angular.isDefined($scope.flippable) && $scope.flippable === true);
        }
    }

    /** @ngInject */
    function msWidgetDirective()
    {
        return {
            restrict  : 'E',
            scope     : {
                flippable: '=?'
            },
            controller: 'MsWidgetController',
            transclude: true,
            compile   : function (tElement)
            {
                tElement.addClass('ms-widget');

                return function postLink(scope, iElement, iAttrs, MsWidgetCtrl, transcludeFn)
                {
                    // Custom transclusion
                    transcludeFn(function (clone)
                    {
                        iElement.empty();
                        iElement.append(clone);
                    });

                    //////////
                };
            }
        };
    }

    /** @ngInject */
    function msWidgetFrontDirective()
    {
        return {
            restrict  : 'E',
            require   : '^msWidget',
            transclude: true,
            compile   : function (tElement)
            {
                tElement.addClass('ms-widget-front');

                return function postLink(scope, iElement, iAttrs, MsWidgetCtrl, transcludeFn)
                {
                    // Custom transclusion
                    transcludeFn(function (clone)
                    {
                        iElement.empty();
                        iElement.append(clone);
                    });

                    // Methods
                    scope.flipWidget = MsWidgetCtrl.flip;
                };
            }
        };
    }

    /** @ngInject */
    function msWidgetBackDirective()
    {
        return {
            restrict  : 'E',
            require   : '^msWidget',
            transclude: true,
            compile   : function (tElement)
            {
                tElement.addClass('ms-widget-back');

                return function postLink(scope, iElement, iAttrs, MsWidgetCtrl, transcludeFn)
                {
                    // Custom transclusion
                    transcludeFn(function (clone)
                    {
                        iElement.empty();
                        iElement.append(clone);
                    });

                    // Methods
                    scope.flipWidget = MsWidgetCtrl.flip;
                };
            }
        };
    }

})();
(function ()
{
    'use strict';

    msTimelineItemDirective.$inject = ["$timeout", "$q"];
    angular
        .module('app.core')
        .controller('MsTimelineController', MsTimelineController)
        .directive('msTimeline', msTimelineDirective)
        .directive('msTimelineItem', msTimelineItemDirective);

    /** @ngInject */
    function MsTimelineController()
    {
        var vm = this;

        // Data
        vm.scrollEl = undefined;

        // Methods
        vm.setScrollEl = setScrollEl;
        vm.getScrollEl = getScrollEl;

        //////////

        /**
         * Set scroll element
         *
         * @param scrollEl
         */
        function setScrollEl(scrollEl)
        {
            vm.scrollEl = scrollEl;
        }

        /**
         * Get scroll element
         *
         * @returns {undefined|*}
         */
        function getScrollEl()
        {
            return vm.scrollEl;
        }
    }

    /** @ngInject */
    function msTimelineDirective()
    {
        return {
            scope     : {
                loadMore: '&?msTimelineLoadMore'
            },
            controller: 'MsTimelineController',
            compile   : function (tElement)
            {
                tElement.addClass('ms-timeline');

                return function postLink(scope, iElement, iAttrs, MsTimelineCtrl)
                {
                    // Create an element for triggering the load more action and append it
                    var loadMoreEl = angular.element('<div class="ms-timeline-loader md-accent-bg md-whiteframe-4dp"><span class="spinner animate-rotate"></span></div>');
                    iElement.append(loadMoreEl);

                    // Grab the scrollable element and store it in the controller for general use
                    var scrollEl = angular.element('#content');
                    MsTimelineCtrl.setScrollEl(scrollEl);

                    // Threshold
                    var threshold = 144;

                    // Register onScroll event for the first time
                    registerOnScroll();

                    /**
                     * onScroll Event
                     */
                    function onScroll()
                    {
                        if ( scrollEl.scrollTop() + scrollEl.height() + threshold > loadMoreEl.position().top )
                        {
                            // Show the loader
                            loadMoreEl.addClass('show');

                            // Unregister scroll event to prevent triggering the function over and over again
                            unregisterOnScroll();

                            // Trigger load more event
                            scope.loadMore().then(
                                // Success
                                function ()
                                {
                                    // Hide the loader
                                    loadMoreEl.removeClass('show');

                                    // Register the onScroll event again
                                    registerOnScroll();
                                },

                                // Error
                                function ()
                                {
                                    // Remove the loader completely
                                    loadMoreEl.remove();
                                }
                            );
                        }
                    }

                    /**
                     * onScroll event registerer
                     */
                    function registerOnScroll()
                    {
                        scrollEl.on('scroll', onScroll);
                    }

                    /**
                     * onScroll event unregisterer
                     */
                    function unregisterOnScroll()
                    {
                        scrollEl.off('scroll', onScroll);
                    }

                    // Cleanup
                    scope.$on('$destroy', function ()
                    {
                        unregisterOnScroll();
                    });
                };
            }
        };
    }

    /** @ngInject */
    function msTimelineItemDirective($timeout, $q)
    {
        return {
            scope  : true,
            require: '^msTimeline',
            compile: function (tElement)
            {
                tElement.addClass('ms-timeline-item').addClass('hidden');

                return function postLink(scope, iElement, iAttrs, MsTimelineCtrl)
                {
                    var threshold = 72,
                        itemLoaded = false,
                        itemInViewport = false,
                        scrollEl = MsTimelineCtrl.getScrollEl();

                    //////////

                    init();

                    /**
                     * Initialize
                     */
                    function init()
                    {
                        // Check if the timeline item has ms-card
                        if ( iElement.find('ms-card') )
                        {
                            // If the ms-card template loaded...
                            scope.$on('msCard::cardTemplateLoaded', function (event, args)
                            {
                                var cardEl = angular.element(args[0]);

                                // Test the card to see if there is any image on it
                                testForImage(cardEl).then(function ()
                                {
                                    $timeout(function ()
                                    {
                                        itemLoaded = true;
                                    });
                                });
                            });
                        }
                        else
                        {
                            // Test the element to see if there is any image on it
                            testForImage(iElement).then(function ()
                            {
                                $timeout(function ()
                                {
                                    itemLoaded = true;
                                });
                            });
                        }

                        // Check if the loaded element also in the viewport
                        scrollEl.on('scroll', testForVisibility);

                        // Test for visibility for the first time without waiting for the scroll event
                        testForVisibility();
                    }

                    // Item ready watcher
                    var itemReadyWatcher = scope.$watch(
                        function ()
                        {
                            return itemLoaded && itemInViewport;
                        },
                        function (current, old)
                        {
                            if ( angular.equals(current, old) )
                            {
                                return;
                            }

                            if ( current )
                            {
                                iElement.removeClass('hidden').addClass('animate');

                                // Unbind itemReadyWatcher
                                itemReadyWatcher();
                            }
                        }, true);

                    /**
                     * Test the given element for image
                     *
                     * @param element
                     * @returns promise
                     */
                    function testForImage(element)
                    {
                        var deferred = $q.defer(),
                            imgEl = element.find('img');

                        if ( imgEl.length > 0 )
                        {
                            imgEl.on('load', function ()
                            {
                                deferred.resolve('Image is loaded');
                            });
                        }
                        else
                        {
                            deferred.resolve('No images');
                        }

                        return deferred.promise;
                    }

                    /**
                     * Test the element for visibility
                     */
                    function testForVisibility()
                    {
                        if ( scrollEl.scrollTop() + scrollEl.height() > iElement.position().top + threshold )
                        {
                            $timeout(function ()
                            {
                                itemInViewport = true;
                            });

                            // Unbind the scroll event
                            scrollEl.off('scroll', testForVisibility);
                        }
                    }
                };
            }
        };
    }
})();
(function ()
{
    'use strict';

    MsStepperController.$inject = ["$timeout"];
    angular
        .module('app.core')
        .controller('MsStepperController', MsStepperController)
        .directive('msStepper', msStepperDirective)
        .directive('msStepperStep', msStepperStepDirective);

    /** @ngInject */
    function MsStepperController($timeout)
    {
        var vm = this;

        // Data
        vm.mainForm = undefined;

        vm.steps = [];
        vm.currentStep = undefined;
        vm.currentStepNumber = 1;

        // Methods
        vm.registerMainForm = registerMainForm;
        vm.registerStep = registerStep;
        vm.setupSteps = setupSteps;
        vm.resetForm = resetForm;

        vm.setCurrentStep = setCurrentStep;

        vm.gotoStep = gotoStep;
        vm.gotoPreviousStep = gotoPreviousStep;
        vm.gotoNextStep = gotoNextStep;
        vm.gotoFirstStep = gotoFirstStep;
        vm.gotoLastStep = gotoLastStep;

        vm.isFirstStep = isFirstStep;
        vm.isLastStep = isLastStep;

        vm.isStepCurrent = isStepCurrent;
        vm.isStepDisabled = isStepDisabled;
        vm.isStepOptional = isStepOptional;
        vm.isStepValid = isStepValid;
        vm.isStepNumberValid = isStepNumberValid;

        vm.isFormValid = isFormValid;

        //////////

        /**
         * Register the main form
         *
         * @param form
         */
        function registerMainForm(form)
        {
            vm.mainForm = form;
        }

        /**
         * Register a step
         *
         * @param element
         * @param scope
         * @param form
         */
        function registerStep(element, scope, form)
        {
            var step = {
                element   : element,
                scope     : scope,
                form      : form,
                stepNumber: scope.step || (vm.steps.length + 1),
                stepTitle : scope.stepTitle
            };

            // Push the step into steps array
            vm.steps.push(step);

            // Sort steps by stepNumber
            vm.steps.sort(function (a, b)
            {
                return a.stepNumber - b.stepNumber;
            });
        }

        /**
         * Setup steps for the first time
         */
        function setupSteps()
        {
            vm.setCurrentStep(vm.currentStepNumber);
        }

        /**
         * Reset steps and the main form
         */
        function resetForm()
        {
            // Timeout is required here because we need to
            // let form model to reset before setting the
            // statuses
            $timeout(function ()
            {
                // Reset all the steps
                for ( var x = 0; x < vm.steps.length; x++ )
                {
                    vm.steps[x].form.$setPristine();
                    vm.steps[x].form.$setUntouched();
                }

                // Reset the main form
                vm.mainForm.$setPristine();
                vm.mainForm.$setUntouched();

                // Go to first step
                gotoFirstStep();
            })
        }

        /**
         * Set current step
         *
         * @param stepNumber
         */
        function setCurrentStep(stepNumber)
        {
            // If the stepNumber is not a valid step number, bail...
            if ( !isStepNumberValid(stepNumber) )
            {
                return;
            }

            // Update the current step number
            vm.currentStepNumber = stepNumber;

            // Hide all steps
            for ( var i = 0; i < vm.steps.length; i++ )
            {
                vm.steps[i].element.hide();
            }

            // Show the current step
            vm.steps[vm.currentStepNumber - 1].element.show();
        }

        /**
         * Go to a step
         *
         * @param stepNumber
         */
        function gotoStep(stepNumber)
        {
            vm.setCurrentStep(stepNumber);
        }

        /**
         * Go to the previous step
         */
        function gotoPreviousStep()
        {
            vm.setCurrentStep(vm.currentStepNumber - 1);
        }

        /**
         * Go to the next step
         */
        function gotoNextStep()
        {
            vm.setCurrentStep(vm.currentStepNumber + 1);
        }

        /**
         * Go to the first step
         */
        function gotoFirstStep()
        {
            vm.setCurrentStep(1);
        }

        /**
         * Go to the last step
         */
        function gotoLastStep()
        {
            vm.setCurrentStep(vm.steps.length);
        }

        /**
         * Check if the current step is the first step
         *
         * @returns {boolean}
         */
        function isFirstStep()
        {
            return vm.currentStepNumber === 1;
        }

        /**
         * Check if the current step is the last step
         *
         * @returns {boolean}
         */
        function isLastStep()
        {
            return vm.currentStepNumber === vm.steps.length;
        }

        /**
         * Check if the given step is the current one
         *
         * @param stepNumber
         * @returns {null|boolean}
         */
        function isStepCurrent(stepNumber)
        {
            // If the stepNumber is not a valid step number, bail...
            if ( !isStepNumberValid(stepNumber) )
            {
                return null;
            }

            return vm.currentStepNumber === stepNumber;
        }

        /**
         * Check if the given step should be disabled
         *
         * @param stepNumber
         * @returns {null|boolean}
         */
        function isStepDisabled(stepNumber)
        {
            // If the stepNumber is not a valid step number, bail...
            if ( !isStepNumberValid(stepNumber) )
            {
                return null;
            }

            var disabled = false;

            for ( var i = 1; i < stepNumber; i++ )
            {
                if ( !isStepValid(i) )
                {
                    disabled = true;
                    break;
                }
            }

            return disabled;
        }

        /**
         * Check if the given step is optional
         *
         * @param stepNumber
         * @returns {null|boolean}
         */
        function isStepOptional(stepNumber)
        {
            // If the stepNumber is not a valid step number, bail...
            if ( !isStepNumberValid(stepNumber) )
            {
                return null;
            }

            return vm.steps[stepNumber - 1].scope.optionalStep;
        }

        /**
         * Check if the given step is valid
         *
         * @param stepNumber
         * @returns {null|boolean}
         */
        function isStepValid(stepNumber)
        {
            // If the stepNumber is not a valid step number, bail...
            if ( !isStepNumberValid(stepNumber) )
            {
                return null;
            }

            // If the step is optional, always return true
            if ( isStepOptional(stepNumber) )
            {
                return true;
            }

            return vm.steps[stepNumber - 1].form.$valid;
        }

        /**
         * Check if the given step number is a valid step number
         *
         * @param stepNumber
         * @returns {boolean}
         */
        function isStepNumberValid(stepNumber)
        {
            return !(stepNumber < 1 || stepNumber > vm.steps.length);
        }

        /**
         * Check if the entire form is valid
         *
         * @returns {boolean}
         */
        function isFormValid()
        {
            return vm.mainForm.$valid;
        }
    }

    /** @ngInject */
    function msStepperDirective()
    {
        return {
            restrict        : 'A',
            require         : ['form', 'msStepper'],
            priority        : 1001,
            controller      : 'MsStepperController as MsStepper',
            bindToController: {
                model: '=ngModel'
            },
            transclude      : true,
            templateUrl     : 'app/core/directives/ms-stepper/templates/horizontal/horizontal.html',
            compile         : function (tElement)
            {
                tElement.addClass('ms-stepper');

                return function postLink(scope, iElement, iAttrs, ctrls)
                {
                    var FormCtrl = ctrls[0],
                        MsStepperCtrl = ctrls[1];

                    // Register the main form and setup
                    // the steps for the first time
                    MsStepperCtrl.registerMainForm(FormCtrl);
                    MsStepperCtrl.setupSteps();
                };
            }
        }
    }

    /** @ngInject */
    function msStepperStepDirective()
    {
        return {
            restrict: 'E',
            require : ['form', '^msStepper'],
            priority: 1000,
            scope   : {
                step        : '=?',
                stepTitle   : '=?',
                optionalStep: '=?'
            },
            compile : function (tElement)
            {
                tElement.addClass('ms-stepper-step');

                return function postLink(scope, iElement, iAttrs, ctrls)
                {
                    var FormCtrl = ctrls[0],
                        MsStepperCtrl = ctrls[1];

                    // Is it an optional step?
                    scope.optionalStep = angular.isDefined(iAttrs.optionalStep);

                    // Register the step
                    MsStepperCtrl.registerStep(iElement, scope, FormCtrl);

                    // Hide the step by default
                    iElement.hide();
                };
            }
        }
    }
})();

(function ()
{
    'use strict';

    msSplashScreenDirective.$inject = ["$animate"];
    angular
        .module('app.core')
        .directive('msSplashScreen', msSplashScreenDirective);

    /** @ngInject */
    function msSplashScreenDirective($animate)
    {
        return {
            restrict: 'E',
            link    : function (scope, iElement)
            {
                var splashScreenRemoveEvent = scope.$on('msSplashScreen::remove', function ()
                {
                    $animate.leave(iElement).then(function ()
                    {
                        // De-register scope event
                        splashScreenRemoveEvent();

                        // Null-ify everything else
                        scope = iElement = null;
                    });
                });
            }
        };
    }
})();

(function ()
{
    'use strict';

    angular
        .module('app.core')
        .directive('msSidenavHelper', msSidenavHelperDirective);

    /** @ngInject */
    function msSidenavHelperDirective()
    {
        return {
            restrict: 'A',
            require : '^mdSidenav',
            link    : function (scope, iElement, iAttrs, MdSidenavCtrl)
            {
                // Watch md-sidenav open & locked open statuses
                // and add class to the ".page-layout" if only
                // the sidenav open and NOT locked open
                scope.$watch(function ()
                {
                    return MdSidenavCtrl.isOpen() && !MdSidenavCtrl.isLockedOpen();
                }, function (current)
                {
                    if ( angular.isUndefined(current) )
                    {
                        return;
                    }

                    iElement.parent().toggleClass('full-height', current);
                    angular.element('html').toggleClass('sidenav-open', current);
                });
            }
        };
    }
})();
(function ()
{
    'use strict';

    msSearchBarDirective.$inject = ["$document"];
    angular
        .module('app.core')
        .directive('msSearchBar', msSearchBarDirective);

    /** @ngInject */
    function msSearchBarDirective($document)
    {
        return {
            restrict   : 'E',
            scope      : true,
            templateUrl: 'app/core/directives/ms-search-bar/ms-search-bar.html',
            compile    : function (tElement)
            {
                // Add class
                tElement.addClass('ms-search-bar');

                return function postLink(scope, iElement)
                {
                    var expanderEl,
                        collapserEl;

                    // Initialize
                    init();

                    function init()
                    {
                        expanderEl = iElement.find('#ms-search-bar-expander');
                        collapserEl = iElement.find('#ms-search-bar-collapser');

                        expanderEl.on('click', expand);
                        collapserEl.on('click', collapse);
                    }

                    /**
                     * Expand
                     */
                    function expand()
                    {
                        iElement.addClass('expanded');

                        // Esc key event
                        $document.on('keyup', escKeyEvent);
                    }

                    /**
                     * Collapse
                     */
                    function collapse()
                    {
                        iElement.removeClass('expanded');
                    }

                    /**
                     * Escape key event
                     *
                     * @param e
                     */
                    function escKeyEvent(e)
                    {
                        if ( e.keyCode === 27 )
                        {
                            collapse();
                            $document.off('keyup', escKeyEvent);
                        }
                    }
                };
            }
        };
    }
})();
(function ()
{
    'use strict';

    msScrollDirective.$inject = ["$timeout", "msScrollConfig", "msUtils", "fuseConfig"];
    angular
        .module('app.core')
        .provider('msScrollConfig', msScrollConfigProvider)
        .directive('msScroll', msScrollDirective);

    /** @ngInject */
    function msScrollConfigProvider()
    {
        // Default configuration
        var defaultConfiguration = {
            wheelSpeed            : 1,
            wheelPropagation      : false,
            swipePropagation      : true,
            minScrollbarLength    : null,
            maxScrollbarLength    : null,
            useBothWheelAxes      : false,
            useKeyboard           : true,
            suppressScrollX       : false,
            suppressScrollY       : false,
            scrollXMarginOffset   : 0,
            scrollYMarginOffset   : 0,
            stopPropagationOnClick: true
        };

        // Methods
        this.config = config;

        //////////

        /**
         * Extend default configuration with the given one
         *
         * @param configuration
         */
        function config(configuration)
        {
            defaultConfiguration = angular.extend({}, defaultConfiguration, configuration);
        }

        /**
         * Service
         */
        this.$get = function ()
        {
            var service = {
                getConfig: getConfig
            };

            return service;

            //////////

            /**
             * Return the config
             */
            function getConfig()
            {
                return defaultConfiguration;
            }
        };
    }

    /** @ngInject */
    function msScrollDirective($timeout, msScrollConfig, msUtils, fuseConfig)
    {
        return {
            restrict: 'AE',
            compile : function (tElement)
            {
                // Do not replace scrollbars if
                // 'disableCustomScrollbars' config enabled
                if ( fuseConfig.getConfig('disableCustomScrollbars') )
                {
                    return;
                }

                // Do not replace scrollbars on mobile devices
                // if 'disableCustomScrollbarsOnMobile' config enabled
                if ( fuseConfig.getConfig('disableCustomScrollbarsOnMobile') && msUtils.isMobile() )
                {
                    return;
                }

                // Add class
                tElement.addClass('ms-scroll');

                return function postLink(scope, iElement, iAttrs)
                {
                    var options = {};

                    // If options supplied, evaluate the given
                    // value. This is because we don't want to
                    // have an isolated scope but still be able
                    // to use scope variables.
                    // We don't want an isolated scope because
                    // we should be able to use this everywhere
                    // especially with other directives
                    if ( iAttrs.msScroll )
                    {
                        options = scope.$eval(iAttrs.msScroll);
                    }

                    // Extend the given config with the ones from provider
                    options = angular.extend({}, msScrollConfig.getConfig(), options);

                    // Initialize the scrollbar
                    $timeout(function ()
                    {
                        PerfectScrollbar.initialize(iElement[0], options);
                    }, 0);

                    // Update the scrollbar on element mouseenter
                    iElement.on('mouseenter', updateScrollbar);

                    // Watch scrollHeight and update
                    // the scrollbar if it changes
                    scope.$watch(function ()
                    {
                        return iElement.prop('scrollHeight');
                    }, function (current, old)
                    {
                        if ( angular.isUndefined(current) || angular.equals(current, old) )
                        {
                            return;
                        }

                        updateScrollbar();
                    });

                    // Watch scrollWidth and update
                    // the scrollbar if it changes
                    scope.$watch(function ()
                    {
                        return iElement.prop('scrollWidth');
                    }, function (current, old)
                    {
                        if ( angular.isUndefined(current) || angular.equals(current, old) )
                        {
                            return;
                        }

                        updateScrollbar();
                    });

                    /**
                     * Update the scrollbar
                     */
                    function updateScrollbar()
                    {
                        PerfectScrollbar.update(iElement[0]);
                    }

                    // Cleanup on destroy
                    scope.$on('$destroy', function ()
                    {
                        iElement.off('mouseenter');
                        PerfectScrollbar.destroy(iElement[0]);
                    });
                };
            }
        };
    }
})();
(function ()
{
    'use strict';

    angular
        .module('app.core')
        .directive('msResponsiveTable', msResponsiveTableDirective);

    /** @ngInject */
    function msResponsiveTableDirective()
    {
        return {
            restrict: 'A',
            link    : function (scope, iElement)
            {
                // Wrap the table
                var wrapper = angular.element('<div class="ms-responsive-table-wrapper"></div>');
                iElement.after(wrapper);
                wrapper.append(iElement);

                //////////
            }
        };
    }
})();
(function () {
  'use strict';

  MsNavigationController.$inject = ["$scope", "msNavigationService", "remote", "nav"];
  msNavigationDirective.$inject = ["$rootScope", "$timeout", "$mdSidenav", "msNavigationService"];
  MsNavigationNodeController.$inject = ["$scope", "$element", "$rootScope", "$animate", "$state", "msNavigationService"];
  msNavigationHorizontalDirective.$inject = ["msNavigationService"];
  MsNavigationHorizontalNodeController.$inject = ["$scope", "$element", "$rootScope", "$state", "msNavigationService"];
  msNavigationHorizontalItemDirective.$inject = ["$mdMedia"];
  angular
    .module('app.core')
    .constant('nav', [])
    .provider('msNavigationService', msNavigationServiceProvider)
    .controller('MsNavigationController', MsNavigationController)
    // Vertical
    .directive('msNavigation', msNavigationDirective)
    .controller('MsNavigationNodeController', MsNavigationNodeController)
    .directive('msNavigationNode', msNavigationNodeDirective)
    .directive('msNavigationItem', msNavigationItemDirective)
    //Horizontal
    .directive('msNavigationHorizontal', msNavigationHorizontalDirective)
    .controller('MsNavigationHorizontalNodeController', MsNavigationHorizontalNodeController)
    .directive('msNavigationHorizontalNode', msNavigationHorizontalNodeDirective)
    .directive('msNavigationHorizontalItem', msNavigationHorizontalItemDirective);

  /** @ngInject */
  function msNavigationServiceProvider() {
    // Inject $log service
    var $log = angular.injector(['ng']).get('$log');

    // Navigation array
    var navigation = [];

    var service = this;

    // Methods
    service.saveItem = saveItem;
    service.deleteItem = deleteItem;
    service.sortByWeight = sortByWeight;

    //////////

    /**
     * Create or update the navigation item
     *
     * @param path
     * @param item
     */
    function saveItem(path, item) {
      if (!angular.isString(path)) {
        $log.error('path must be a string (eg. `dashboard.project`)');
        return;
      }

      var parts = path.split('.');

      // Generate the object id from the parts
      var id = parts[parts.length - 1];

      // Get the parent item from the parts
      var parent = _findOrCreateParent(parts);

      // Decide if we are going to update or create
      var updateItem = false;

      for (var i = 0; i < parent.length; i++) {
        if (parent[i]._id === id) {
          updateItem = parent[i];

          break;
        }
      }

      // Update
      if (updateItem) {
        angular.extend(updateItem, item);

        // Add proper ui-sref
        updateItem.uisref = _getUiSref(updateItem);
      }
      // Create
      else {
        // Create an empty children array in the item
        item.children = [];

        // Add the default weight if not provided or if it's not a number
        if (angular.isUndefined(item.weight) || !angular.isNumber(item.weight)) {
          item.weight = 1;
        }

        // Add the item id
        item._id = id;

        // Add the item path
        item._path = path;

        // Add proper ui-sref
        item.uisref = _getUiSref(item);

        // Push the item into the array
        parent.push(item);
      }
    }

    /**
     * Delete navigation item
     *
     * @param path
     */
    function deleteItem(path) {
      if (!angular.isString(path)) {
        $log.error('path must be a string (eg. `dashboard.project`)');
        return;
      }

      // Locate the item by using given path
      var item = navigation,
        parts = path.split('.');

      for (var p = 0; p < parts.length; p++) {
        var id = parts[p];

        for (var i = 0; i < item.length; i++) {
          if (item[i]._id === id) {
            // If we have a matching path,
            // we have found our object:
            // remove it.
            if (item[i]._path === path) {
              item.splice(i, 1);
              return true;
            }

            // Otherwise grab the children of
            // the current item and continue
            item = item[i].children;
            break;
          }
        }
      }

      return false;
    }

    /**
     * Sort the navigation items by their weights
     *
     * @param parent
     */
    function sortByWeight(parent) {
      // If parent not provided, sort the root items
      if (!parent) {
        parent = navigation;
        parent.sort(_byWeight);
      }

      // Sort the children
      for (var i = 0; i < parent.length; i++) {
        var children = parent[i].children;

        if (children.length > 1) {
          children.sort(_byWeight);
        }

        if (children.length > 0) {
          sortByWeight(children);
        }
      }
    }

    /* ----------------- */
    /* Private Functions */
    /* ----------------- */

    /**
     * Find or create parent
     *
     * @param parts
     * @returns {Array|Boolean}
     * @private
     */
    function _findOrCreateParent(parts) {
      // Store the main navigation
      var parent = navigation;

      // If it's going to be a root item
      // return the navigation itself
      if (parts.length === 1) {
        return parent;
      }

      // Remove the last element from the parts as
      // we don't need that to figure out the parent
      parts.pop();

      // Find and return the parent
      for (var i = 0; i < parts.length; i++) {
        var _id = parts[i],
          createParent = true;

        for (var p = 0; p < parent.length; p++) {
          if (parent[p]._id === _id) {
            parent = parent[p].children;
            createParent = false;

            break;
          }
        }

        // If there is no parent found, create one, push
        // it into the current parent and assign it as a
        // new parent
        if (createParent) {
          var item = {
            _id: _id,
            _path: parts.join('.'),
            title: _id,
            weight: 1,
            children: []
          };

          parent.push(item);
          parent = item.children;
        }
      }

      return parent;
    }

    /**
     * Sort by weight
     *
     * @param x
     * @param y
     * @returns {number}
     * @private
     */
    function _byWeight(x, y) {
      return parseInt(x.weight) - parseInt(y.weight);
    }

    /**
     * Setup the ui-sref using state & state parameters
     *
     * @param item
     * @returns {string}
     * @private
     */
    function _getUiSref(item) {
      var uisref = '';

      if (angular.isDefined(item.state)) {
        uisref = item.state;

        if (angular.isDefined(item.stateParams) && angular.isObject(item.stateParams)) {
          uisref = uisref + '(' + angular.toJson(item.stateParams) + ')';
        }
      }

      return uisref;
    }

    /* ----------------- */
    /* Service           */
    /* ----------------- */

    this.$get = function () {
      var activeItem = null,
        navigationScope = null,
        folded = null,
        foldedOpen = null;

      var service = {
        saveItem: saveItem,
        deleteItem: deleteItem,
        sort: sortByWeight,
        clearNavigation: clearNavigation,
        setActiveItem: setActiveItem,
        getActiveItem: getActiveItem,
        getNavigationObject: getNavigationObject,
        setNavigationScope: setNavigationScope,
        setFolded: setFolded,
        getFolded: getFolded,
        setFoldedOpen: setFoldedOpen,
        getFoldedOpen: getFoldedOpen,
        toggleFolded: toggleFolded
      };

      return service;

      //////////

      /**
       * Clear the entire navigation
       */
      function clearNavigation() {
        // Clear the navigation array
        navigation = [];

        // Clear the vm.navigation from main controller
        if (navigationScope) {
          navigationScope.vm.navigation = [];
        }
      }

      /**
       * Set active item
       *
       * @param node
       * @param scope
       */
      function setActiveItem(node, scope) {
        activeItem = {
          node: node,
          scope: scope
        };
      }

      /**
       * Return active item
       */
      function getActiveItem() {
        return activeItem;
      }

      /**
       * Return navigation object
       *
       * @param root
       * @returns {Array}
       */
      function getNavigationObject(root) {
        if (root) {
          for (var i = 0; i < navigation.length; i++) {
            if (navigation[i]._id === root) {
              return [navigation[i]];
            }
          }
        }
        console.log(navigation);
        return navigation;
      }

      /**
       * Store navigation's scope for later use
       *
       * @param scope
       */
      function setNavigationScope(scope) {
        navigationScope = scope;
      }

      /**
       * Set folded status
       *
       * @param status
       */
      function setFolded(status) {
        folded = status;
      }

      /**
       * Return folded status
       *
       * @returns {*}
       */
      function getFolded() {
        return folded;
      }

      /**
       * Set folded open status
       *
       * @param status
       */
      function setFoldedOpen(status) {
        foldedOpen = status;
      }

      /**
       * Return folded open status
       *
       * @returns {*}
       */
      function getFoldedOpen() {
        return foldedOpen;
      }


      /**
       * Toggle fold on stored navigation's scope
       */
      function toggleFolded() {
        navigationScope.toggleFolded();
      }
    };
  }

  /** @ngInject */
  function MsNavigationController($scope, msNavigationService, remote,nav) {
    var vm = this;
    // Data
    //if (!nav.length){
    //  nav=nav.length?nav:
    //    $scope.root? msNavigationService.getNavigationObject($scope.root):msNavigationService.getNavigationObject();
    //}
    //var  navigation=nav;
    //remote.profile().then(function (role) {
    //  //if ($scope.root) {
    //  //  vm.navigation = msNavigationService.getNavigationObject($scope.root);
    //  //}
    //  //else {
    //  //  vm.navigation = msNavigationService.getNavigationObject();
    //  //}
    //  var arr=[];
    //  navigation.forEach(function(k){
    //    arr.push($.extend(true,{},k));
    //  })
    //  vm.navigation=arr;
    //  if (role && role.data && role.data) {
    //    var mem = role.data.Role.MemberType;
    //    if (mem===0||mem===2){
    //      var  child=vm.navigation.length?vm.navigation[0].children:null;
    //      if (child&&child.length){
    //        for (var  i=child.length-1;i>=0;i--){
    //            if (child[i]._id!=="pcenter"){
    //              child.splice(i,1);
    //            }
    //        }
    //      }
    //    }
    //  }
    //  init();
    //}).catch(function(){
    //  vm.navigation=navigation;
    //  init();
    //});
    // Methods
    vm.toggleHorizontalMobileMenu = toggleHorizontalMobileMenu;

    //////////
    vm.navigation= $scope.root? msNavigationService.getNavigationObject($scope.root):msNavigationService.getNavigationObject();
    init();

    /**
     * Initialize
     */
    function init() {
      // Sort the navigation before doing anything else
      msNavigationService.sort();
    }

    /**
     * Toggle horizontal mobile menu
     */
    function toggleHorizontalMobileMenu() {
      angular.element('body').toggleClass('ms-navigation-horizontal-mobile-menu-active');
    }
  }

  /** @ngInject */
  function msNavigationDirective($rootScope, $timeout, $mdSidenav, msNavigationService) {
    return {
      restrict: 'E',
      scope: {
        folded: '=',
        root: '@'
      },
      controller: 'MsNavigationController as vm',
      templateUrl: 'app/core/directives/ms-navigation/templates/vertical.html',
      transclude: true,
      compile: function (tElement) {
        tElement.addClass('ms-navigation');

        return function postLink(scope, iElement) {
          var bodyEl = angular.element('body'),
            foldExpanderEl = angular.element('<div id="ms-navigation-fold-expander"></div>'),
            foldCollapserEl = angular.element('<div id="ms-navigation-fold-collapser"></div>'),
            sidenav = $mdSidenav('navigation');

          // Store the navigation in the service for public access
          msNavigationService.setNavigationScope(scope);

          // Initialize
          init();

          /**
           * Initialize
           */
          function init() {
            // Set the folded status for the first time.
            // First, we have to check if we have a folded
            // status available in the service already. This
            // will prevent navigation to act weird if we already
            // set the fold status, remove the navigation and
            // then re-initialize it, which happens if we
            // change to a view without a navigation and then
            // come back with history.back() function.

            // If the service didn't initialize before, set
            // the folded status from scope, otherwise we
            // won't touch anything because the folded status
            // already set in the service...
            if (msNavigationService.getFolded() === null) {
              msNavigationService.setFolded(scope.folded);
            }

            if (msNavigationService.getFolded()) {
              // Collapse everything.
              // This must be inside a $timeout because by the
              // time we call this, the 'msNavigation::collapse'
              // event listener is not registered yet. $timeout
              // will ensure that it will be called after it is
              // registered.
              $timeout(function () {
                $rootScope.$broadcast('msNavigation::collapse');
              });

              // Add class to the body
              bodyEl.addClass('ms-navigation-folded');

              // Set fold expander
              setFoldExpander();
            }
          }

          // Sidenav locked open status watcher
          scope.$watch(function () {
            return sidenav.isLockedOpen();
          }, function (current, old) {
            if (angular.isUndefined(current) || angular.equals(current, old)) {
              return;
            }

            var folded = msNavigationService.getFolded();

            if (folded) {
              if (current) {
                // Collapse everything
                $rootScope.$broadcast('msNavigation::collapse');
              }
              else {
                // Expand the active one and its parents
                var activeItem = msNavigationService.getActiveItem();
                if (activeItem) {
                  activeItem.scope.$emit('msNavigation::stateMatched');
                }
              }
            }
          });

          // Folded status watcher
          scope.$watch('folded', function (current, old) {
            if (angular.isUndefined(current) || angular.equals(current, old)) {
              return;
            }

            setFolded(current);
          });

          /**
           * Set folded status
           *
           * @param folded
           */
          function setFolded(folded) {
            // Store folded status on the service for global access
            msNavigationService.setFolded(folded);

            if (folded) {
              // Collapse everything
              $rootScope.$broadcast('msNavigation::collapse');

              // Add class to the body
              bodyEl.addClass('ms-navigation-folded');

              // Set fold expander
              setFoldExpander();
            }
            else {
              // Expand the active one and its parents
              var activeItem = msNavigationService.getActiveItem();
              if (activeItem) {
                activeItem.scope.$emit('msNavigation::stateMatched');
              }

              // Remove body class
              bodyEl.removeClass('ms-navigation-folded ms-navigation-folded-open');

              // Remove fold collapser
              removeFoldCollapser();
            }
          }

          /**
           * Set fold expander
           */
          function setFoldExpander() {
            iElement.parent().append(foldExpanderEl);

            // Let everything settle for a moment
            // before registering the event listener
            $timeout(function () {
              foldExpanderEl.on('mouseenter touchstart', onFoldExpanderHover);
            });
          }

          /**
           * Set fold collapser
           */
          function setFoldCollapser() {
            bodyEl.find('#main').append(foldCollapserEl);
            foldCollapserEl.on('mouseenter touchstart', onFoldCollapserHover);
          }

          /**
           * Remove fold collapser
           */
          function removeFoldCollapser() {
            foldCollapserEl.remove();
          }

          /**
           * onHover event of foldExpander
           */
          function onFoldExpanderHover(event) {
            if (event) {
              event.preventDefault();
            }

            // Set folded open status
            msNavigationService.setFoldedOpen(true);

            // Expand the active one and its parents
            var activeItem = msNavigationService.getActiveItem();
            if (activeItem) {
              activeItem.scope.$emit('msNavigation::stateMatched');
            }

            // Add class to the body
            bodyEl.addClass('ms-navigation-folded-open');

            // Remove the fold opener
            foldExpanderEl.remove();

            // Set fold collapser
            setFoldCollapser();
          }

          /**
           * onHover event of foldCollapser
           */
          function onFoldCollapserHover(event) {
            if (event) {
              event.preventDefault();
            }

            // Set folded open status
            msNavigationService.setFoldedOpen(false);

            // Collapse everything
            $rootScope.$broadcast('msNavigation::collapse');

            // Remove body class
            bodyEl.removeClass('ms-navigation-folded-open');

            // Remove the fold collapser
            foldCollapserEl.remove();

            // Set fold expander
            setFoldExpander();
          }

          /**
           * Public access for toggling folded status externally
           */
          scope.toggleFolded = function () {
            var folded = msNavigationService.getFolded();

            setFolded(!folded);
          };

          /**
           * On $stateChangeStart
           */
          scope.$on('$stateChangeStart', function () {
            // Close the sidenav
            sidenav.close();

            // If navigation is folded open, close it
            if (msNavigationService.getFolded()) {
              onFoldCollapserHover();
            }
          });

          // Cleanup
          scope.$on('$destroy', function () {
            foldCollapserEl.off('mouseenter touchstart');
            foldExpanderEl.off('mouseenter touchstart');
          });
        };
      }
    };
  }

  /** @ngInject */
  function MsNavigationNodeController($scope, $element, $rootScope, $animate, $state, msNavigationService) {
    var vm = this;

    // Data
    vm.element = $element;
    vm.node = $scope.node;
    vm.hasChildren = undefined;
    vm.collapsed = undefined;
    vm.collapsable = undefined;
    vm.group = undefined;
    vm.animateHeightClass = 'animate-height';

    // Methods
    vm.toggleCollapsed = toggleCollapsed;
    vm.collapse = collapse;
    vm.expand = expand;
    vm.getClass = getClass;
    vm.isHidden = isHidden;

    //////////

    init();

    /**
     * Initialize
     */
    function init() {
      // Setup the initial values

      // Has children?
      vm.hasChildren = vm.node.children.length > 0;

      // Is group?
      vm.group = !!(angular.isDefined(vm.node.group) && vm.node.group === true);

      // Is collapsable?
      if (!vm.hasChildren || vm.group) {
        vm.collapsable = false;
      }
      else {
        vm.collapsable = !!(angular.isUndefined(vm.node.collapsable) || typeof vm.node.collapsable !== 'boolean' || vm.node.collapsable === true);
      }

      // Is collapsed?
      if (!vm.collapsable) {
        vm.collapsed = false;
      }
      else {
        vm.collapsed = !!(angular.isUndefined(vm.node.collapsed) || typeof vm.node.collapsed !== 'boolean' || vm.node.collapsed === true);
      }

      // Expand all parents if we have a matching state or
      // the current state is a child of the node's state
      if (vm.node.state === $state.current.name || $state.includes(vm.node.state)) {
        // If state params are defined, make sure they are
        // equal, otherwise do not set the active item
        if (angular.isDefined(vm.node.stateParams) && angular.isDefined($state.params) && !angular.equals(vm.node.stateParams, $state.params)) {
          return;
        }

        $scope.$emit('msNavigation::stateMatched');

        // Also store the current active menu item
        msNavigationService.setActiveItem(vm.node, $scope);
      }

      $scope.$on('msNavigation::stateMatched', function () {
        // Expand if the current scope is collapsable and is collapsed
        if (vm.collapsable && vm.collapsed) {
          $scope.$evalAsync(function () {
            vm.collapsed = false;
          });
        }
      });

      // Listen for collapse event
      $scope.$on('msNavigation::collapse', function (event, path) {
        if (vm.collapsed || !vm.collapsable) {
          return;
        }

        // If there is no path defined, collapse
        if (angular.isUndefined(path)) {
          vm.collapse();
        }
        // If there is a path defined, do not collapse
        // the items that are inside that path. This will
        // prevent parent items from collapsing
        else {
          var givenPathParts = path.split('.'),
            activePathParts = [];

          var activeItem = msNavigationService.getActiveItem();
          if (activeItem) {
            activePathParts = activeItem.node._path.split('.');
          }

          // Test for given path
          if (givenPathParts.indexOf(vm.node._id) > -1) {
            return;
          }

          // Test for active path
          if (activePathParts.indexOf(vm.node._id) > -1) {
            return;
          }

          vm.collapse();
        }
      });

      // Listen for $stateChangeSuccess event
      $scope.$on('$stateChangeSuccess', function () {
        if (vm.node.state === $state.current.name) {
          // If state params are defined, make sure they are
          // equal, otherwise do not set the active item
          if (angular.isDefined(vm.node.stateParams) && angular.isDefined($state.params) && !angular.equals(vm.node.stateParams, $state.params)) {
            return;
          }

          // Update active item on state change
          msNavigationService.setActiveItem(vm.node, $scope);

          // Collapse everything except the one we're using
          $rootScope.$broadcast('msNavigation::collapse', vm.node._path);
        }
      });
    }

    /**
     * Toggle collapsed
     */
    function toggleCollapsed() {
      if (vm.collapsed) {
        vm.expand();
      }
      else {
        vm.collapse();
      }
    }

    /**
     * Collapse
     */
    function collapse() {
      // Grab the element that we are going to collapse
      var collapseEl = vm.element.children('ul');

      // Grab the height
      var height = collapseEl[0].offsetHeight;

      $scope.$evalAsync(function () {
        // Set collapsed status
        vm.collapsed = true;

        // Add collapsing class to the node
        vm.element.addClass('collapsing');

        // Animate the height
        $animate.animate(collapseEl,
          {
            'display': 'block',
            'height': height + 'px'
          },
          {
            'height': '0px'
          },
          vm.animateHeightClass
        ).then(
          function () {
            // Clear the inline styles after animation done
            collapseEl.css({
              'display': '',
              'height': ''
            });

            // Clear collapsing class from the node
            vm.element.removeClass('collapsing');
          }
        );

        // Broadcast the collapse event so child items can also be collapsed
        $scope.$broadcast('msNavigation::collapse');
      });
    }

    /**
     * Expand
     */
    function expand() {
      // Grab the element that we are going to expand
      var expandEl = vm.element.children('ul');

      // Move the element out of the dom flow and
      // make it block so we can get its height
      expandEl.css({
        'position': 'absolute',
        'visibility': 'hidden',
        'display': 'block',
        'height': 'auto'
      });

      // Grab the height
      var height = expandEl[0].offsetHeight;

      // Reset the style modifications
      expandEl.css({
        'position': '',
        'visibility': '',
        'display': '',
        'height': ''
      });

      $scope.$evalAsync(function () {
        // Set collapsed status
        vm.collapsed = false;

        // Add expanding class to the node
        vm.element.addClass('expanding');

        // Animate the height
        $animate.animate(expandEl,
          {
            'display': 'block',
            'height': '0px'
          },
          {
            'height': height + 'px'
          },
          vm.animateHeightClass
        ).then(
          function () {
            // Clear the inline styles after animation done
            expandEl.css({
              'height': ''
            });

            // Clear expanding class from the node
            vm.element.removeClass('expanding');
          }
        );

        // If item expanded, broadcast the collapse event from rootScope so that the other expanded items
        // can be collapsed. This is necessary for keeping only one parent expanded at any time
        $rootScope.$broadcast('msNavigation::collapse', vm.node._path);
      });
    }

    /**
     * Return the class
     *
     * @returns {*}
     */
    function getClass() {
      return vm.node.class;
    }

    /**
     * Check if node should be hidden
     *
     * @returns {boolean}
     */
    function isHidden() {
      if (angular.isDefined(vm.node.hidden) && angular.isFunction(vm.node.hidden)) {
        return vm.node.hidden();
      }

      return false;
    }
  }

  /** @ngInject */
  function msNavigationNodeDirective() {
    return {
      restrict: 'A',
      bindToController: {
        node: '=msNavigationNode'
      },
      controller: 'MsNavigationNodeController as vm',
      compile: function (tElement) {
        tElement.addClass('ms-navigation-node');

        return function postLink(scope, iElement, iAttrs, MsNavigationNodeCtrl) {
          // Add custom classes
          iElement.addClass(MsNavigationNodeCtrl.getClass());

          // Add group class if it's a group
          if (MsNavigationNodeCtrl.group) {
            iElement.addClass('group');
          }
        };
      }
    };
  }

  /** @ngInject */
  function msNavigationItemDirective() {
    return {
      restrict: 'A',
      require: '^msNavigationNode',
      compile: function (tElement) {
        tElement.addClass('ms-navigation-item');

        return function postLink(scope, iElement, iAttrs, MsNavigationNodeCtrl) {
          // If the item is collapsable...
          if (MsNavigationNodeCtrl.collapsable) {
            iElement.on('click', MsNavigationNodeCtrl.toggleCollapsed);
          }

          // Cleanup
          scope.$on('$destroy', function () {
            iElement.off('click');
          });
        };
      }
    };
  }

  /** @ngInject */
  function msNavigationHorizontalDirective(msNavigationService) {
    return {
      restrict: 'E',
      scope: {
        root: '@'
      },
      controller: 'MsNavigationController as vm',
      templateUrl: 'app/core/directives/ms-navigation/templates/horizontal.html',
      transclude: true,
      compile: function (tElement) {
        tElement.addClass('ms-navigation-horizontal');

        return function postLink(scope) {
          // Store the navigation in the service for public access
          msNavigationService.setNavigationScope(scope);
        };
      }
    };
  }

  /** @ngInject */
  function MsNavigationHorizontalNodeController($scope, $element, $rootScope, $state, msNavigationService) {
    var vm = this;

    // Data
    vm.element = $element;
    vm.node = $scope.node;
    vm.hasChildren = undefined;
    vm.group = undefined;

    // Methods
    vm.getClass = getClass;

    //////////

    init();

    /**
     * Initialize
     */
    function init() {
      // Setup the initial values

      // Is active
      vm.isActive = false;

      // Has children?
      vm.hasChildren = vm.node.children.length > 0;

      // Is group?
      vm.group = !!(angular.isDefined(vm.node.group) && vm.node.group === true);

      // Mark all parents as active if we have a matching state
      // or the current state is a child of the node's state
      if (vm.node.state === $state.current.name || $state.includes(vm.node.state)) {
        // If state params are defined, make sure they are
        // equal, otherwise do not set the active item
        if (angular.isDefined(vm.node.stateParams) && angular.isDefined($state.params) && !angular.equals(vm.node.stateParams, $state.params)) {
          return;
        }

        $scope.$emit('msNavigation::stateMatched');

        // Also store the current active menu item
        msNavigationService.setActiveItem(vm.node, $scope);
      }

      $scope.$on('msNavigation::stateMatched', function () {
        // Mark as active if has children
        if (vm.hasChildren) {
          $scope.$evalAsync(function () {
            vm.isActive = true;
          });
        }
      });

      // Listen for clearActive event
      $scope.$on('msNavigation::clearActive', function () {
        if (!vm.hasChildren) {
          return;
        }

        var activePathParts = [];

        var activeItem = msNavigationService.getActiveItem();
        if (activeItem) {
          activePathParts = activeItem.node._path.split('.');
        }

        // Test for active path
        if (activePathParts.indexOf(vm.node._id) > -1) {
          $scope.$evalAsync(function () {
            vm.isActive = true;
          });
        }
        else {
          $scope.$evalAsync(function () {
            vm.isActive = false;
          });
        }

      });

      // Listen for $stateChangeSuccess event
      $scope.$on('$stateChangeSuccess', function () {
        if (vm.node.state === $state.current.name) {
          // If state params are defined, make sure they are
          // equal, otherwise do not set the active item
          if (angular.isDefined(vm.node.stateParams) && angular.isDefined($state.params) && !angular.equals(vm.node.stateParams, $state.params)) {
            return;
          }

          // Update active item on state change
          msNavigationService.setActiveItem(vm.node, $scope);

          // Clear all active states everything except the one we're using
          $rootScope.$broadcast('msNavigation::clearActive');
        }
      });
    }

    /**
     * Return the class
     *
     * @returns {*}
     */
    function getClass() {
      return vm.node.class;
    }
  }

  /** @ngInject */
  function msNavigationHorizontalNodeDirective() {
    return {
      restrict: 'A',
      bindToController: {
        node: '=msNavigationHorizontalNode'
      },
      controller: 'MsNavigationHorizontalNodeController as vm',
      compile: function (tElement) {
        tElement.addClass('ms-navigation-horizontal-node');

        return function postLink(scope, iElement, iAttrs, MsNavigationHorizontalNodeCtrl) {
          // Add custom classes
          iElement.addClass(MsNavigationHorizontalNodeCtrl.getClass());

          // Add group class if it's a group
          if (MsNavigationHorizontalNodeCtrl.group) {
            iElement.addClass('group');
          }
        };
      }
    };
  }

  /** @ngInject */
  function msNavigationHorizontalItemDirective($mdMedia) {
    return {
      restrict: 'A',
      require: '^msNavigationHorizontalNode',
      compile: function (tElement) {
        tElement.addClass('ms-navigation-horizontal-item');

        return function postLink(scope, iElement, iAttrs, MsNavigationHorizontalNodeCtrl) {
          iElement.on('click', onClick);

          function onClick() {
            if (!MsNavigationHorizontalNodeCtrl.hasChildren || $mdMedia('gt-md')) {
              return;
            }

            iElement.toggleClass('expanded');
          }

          // Cleanup
          scope.$on('$destroy', function () {
            iElement.off('click');
          });
        };
      }
    };
  }

})();

(function ()
{
    'use strict';

    angular
        .module('app.core')
        .directive('msRandomClass', msRandomClassDirective);

    /** @ngInject */
    function msRandomClassDirective()
    {
        return {
            restrict: 'A',
            scope   : {
                msRandomClass: '='
            },
            link    : function (scope, iElement)
            {
                var randomClass = scope.msRandomClass[Math.floor(Math.random() * (scope.msRandomClass.length))];
                iElement.addClass(randomClass);
            }
        };
    }
})();
(function ()
{
    'use strict';

    msNavIsFoldedDirective.$inject = ["$document", "$rootScope", "msNavFoldService"];
    msNavDirective.$inject = ["$rootScope", "$mdComponentRegistry", "msNavFoldService"];
    msNavToggleDirective.$inject = ["$rootScope", "$q", "$animate", "$state"];
    angular
        .module('app.core')
        .factory('msNavFoldService', msNavFoldService)
        .directive('msNavIsFolded', msNavIsFoldedDirective)
        .controller('MsNavController', MsNavController)
        .directive('msNav', msNavDirective)
        .directive('msNavTitle', msNavTitleDirective)
        .directive('msNavButton', msNavButtonDirective)
        .directive('msNavToggle', msNavToggleDirective);

    /** @ngInject */
    function msNavFoldService()
    {
        var foldable = {};

        var service = {
            setFoldable    : setFoldable,
            isNavFoldedOpen: isNavFoldedOpen,
            toggleFold     : toggleFold,
            openFolded     : openFolded,
            closeFolded    : closeFolded
        };

        return service;

        //////////

        /**
         * Set the foldable
         *
         * @param scope
         * @param element
         */
        function setFoldable(scope, element)
        {
            foldable = {
                'scope'  : scope,
                'element': element
            };
        }

        /**
         * Is folded open
         */
        function isNavFoldedOpen()
        {
            return foldable.scope.isNavFoldedOpen();
        }

        /**
         * Toggle fold
         */
        function toggleFold()
        {
            foldable.scope.toggleFold();
        }

        /**
         * Open folded navigation
         */
        function openFolded()
        {
            foldable.scope.openFolded();
        }

        /**
         * Close folded navigation
         */
        function closeFolded()
        {
            foldable.scope.closeFolded();
        }
    }

    /** @ngInject */
    function msNavIsFoldedDirective($document, $rootScope, msNavFoldService)
    {
        return {
            restrict: 'A',
            link    : function (scope, iElement, iAttrs)
            {
                var isFolded = (iAttrs.msNavIsFolded === 'true'),
                    isFoldedOpen = false,
                    body = angular.element($document[0].body),
                    openOverlay = angular.element('<div id="ms-nav-fold-open-overlay"></div>'),
                    closeOverlay = angular.element('<div id="ms-nav-fold-close-overlay"></div>'),
                    sidenavEl = iElement.parent();

                // Initialize the service
                msNavFoldService.setFoldable(scope, iElement, isFolded);

                // Set the fold status for the first time
                if ( isFolded )
                {
                    fold();
                }
                else
                {
                    unfold();
                }

                /**
                 * Is nav folded open
                 */
                function isNavFoldedOpen()
                {
                    return isFoldedOpen;
                }

                /**
                 * Toggle fold
                 */
                function toggleFold()
                {
                    isFolded = !isFolded;

                    if ( isFolded )
                    {
                        fold();
                    }
                    else
                    {
                        unfold();
                    }
                }

                /**
                 * Fold the navigation
                 */
                function fold()
                {
                    // Add classes
                    body.addClass('ms-nav-folded');

                    // Collapse everything and scroll to the top
                    $rootScope.$broadcast('msNav::forceCollapse');
                    iElement.scrollTop(0);

                    // Append the openOverlay to the element
                    sidenavEl.append(openOverlay);

                    // Event listeners
                    openOverlay.on('mouseenter touchstart', function (event)
                    {
                        openFolded(event);
                        isFoldedOpen = true;
                    });
                }

                /**
                 * Open folded navigation
                 */
                function openFolded(event)
                {
                    if ( angular.isDefined(event) )
                    {
                        event.preventDefault();
                    }

                    body.addClass('ms-nav-folded-open');

                    // Update the location
                    $rootScope.$broadcast('msNav::expandMatchingToggles');

                    // Remove open overlay
                    sidenavEl.find(openOverlay).remove();

                    // Append close overlay and bind its events
                    sidenavEl.parent().append(closeOverlay);
                    closeOverlay.on('mouseenter touchstart', function (event)
                    {
                        closeFolded(event);
                        isFoldedOpen = false;
                    });
                }

                /**
                 * Close folded navigation
                 */
                function closeFolded(event)
                {
                    if ( angular.isDefined(event) )
                    {
                        event.preventDefault();
                    }

                    // Collapse everything and scroll to the top
                    $rootScope.$broadcast('msNav::forceCollapse');
                    iElement.scrollTop(0);

                    body.removeClass('ms-nav-folded-open');

                    // Remove close overlay
                    sidenavEl.parent().find(closeOverlay).remove();

                    // Append open overlay and bind its events
                    sidenavEl.append(openOverlay);
                    openOverlay.on('mouseenter touchstart', function (event)
                    {
                        openFolded(event);
                        isFoldedOpen = true;
                    });
                }

                /**
                 * Unfold the navigation
                 */
                function unfold()
                {
                    body.removeClass('ms-nav-folded ms-nav-folded-open');

                    // Update the location
                    $rootScope.$broadcast('msNav::expandMatchingToggles');

                    iElement.off('mouseenter mouseleave');
                }

                // Expose functions to the scope
                scope.toggleFold = toggleFold;
                scope.openFolded = openFolded;
                scope.closeFolded = closeFolded;
                scope.isNavFoldedOpen = isNavFoldedOpen;

                // Cleanup
                scope.$on('$destroy', function ()
                {
                    openOverlay.off('mouseenter touchstart');
                    closeOverlay.off('mouseenter touchstart');
                    iElement.off('mouseenter mouseleave');
                });
            }
        };
    }


    /** @ngInject */
    function MsNavController()
    {
        var vm = this,
            disabled = false,
            toggleItems = [],
            lockedItems = [];

        // Data

        // Methods
        vm.isDisabled = isDisabled;
        vm.enable = enable;
        vm.disable = disable;
        vm.setToggleItem = setToggleItem;
        vm.getLockedItems = getLockedItems;
        vm.setLockedItem = setLockedItem;
        vm.clearLockedItems = clearLockedItems;

        //////////

        /**
         * Is navigation disabled
         *
         * @returns {boolean}
         */
        function isDisabled()
        {
            return disabled;
        }

        /**
         * Disable the navigation
         */
        function disable()
        {
            disabled = true;
        }

        /**
         * Enable the navigation
         */
        function enable()
        {
            disabled = false;
        }

        /**
         * Set toggle item
         *
         * @param element
         * @param scope
         */
        function setToggleItem(element, scope)
        {
            toggleItems.push({
                'element': element,
                'scope'  : scope
            });
        }

        /**
         * Get locked items
         *
         * @returns {Array}
         */
        function getLockedItems()
        {
            return lockedItems;
        }

        /**
         * Set locked item
         *
         * @param element
         * @param scope
         */
        function setLockedItem(element, scope)
        {
            lockedItems.push({
                'element': element,
                'scope'  : scope
            });
        }

        /**
         * Clear locked items list
         */
        function clearLockedItems()
        {
            lockedItems = [];
        }
    }

    /** @ngInject */
    function msNavDirective($rootScope, $mdComponentRegistry, msNavFoldService)
    {
        return {
            restrict  : 'E',
            scope     : {},
            controller: 'MsNavController',
            compile   : function (tElement)
            {
                tElement.addClass('ms-nav');

                return function postLink(scope)
                {
                    // Update toggle status according to the ui-router current state
                    $rootScope.$broadcast('msNav::expandMatchingToggles');

                    // Update toggles on state changes
                    var stateChangeSuccessEvent = $rootScope.$on('$stateChangeSuccess', function ()
                    {
                        $rootScope.$broadcast('msNav::expandMatchingToggles');

                        // Close navigation sidenav on stateChangeSuccess
                        $mdComponentRegistry.when('navigation').then(function (navigation)
                        {
                            navigation.close();

                            if ( msNavFoldService.isNavFoldedOpen() )
                            {
                                msNavFoldService.closeFolded();
                            }
                        });
                    });

                    // Cleanup
                    scope.$on('$destroy', function ()
                    {
                        stateChangeSuccessEvent();
                    })
                };
            }
        };
    }

    /** @ngInject */
    function msNavTitleDirective()
    {
        return {
            restrict: 'A',
            compile : function (tElement)
            {
                tElement.addClass('ms-nav-title');

                return function postLink()
                {

                };
            }
        };
    }

    /** @ngInject */
    function msNavButtonDirective()
    {
        return {
            restrict: 'AE',
            compile : function (tElement)
            {
                tElement.addClass('ms-nav-button');

                return function postLink()
                {

                };
            }
        };
    }

    /** @ngInject */
    function msNavToggleDirective($rootScope, $q, $animate, $state)
    {
        return {
            restrict: 'A',
            require : '^msNav',
            scope   : true,
            compile : function (tElement, tAttrs)
            {
                tElement.addClass('ms-nav-toggle');

                // Add collapsed attr
                if ( angular.isUndefined(tAttrs.collapsed) )
                {
                    tAttrs.collapsed = true;
                }

                tElement.attr('collapsed', tAttrs.collapsed);

                return function postLink(scope, iElement, iAttrs, MsNavCtrl)
                {
                    var classes = {
                        expanded         : 'expanded',
                        expandAnimation  : 'expand-animation',
                        collapseAnimation: 'collapse-animation'
                    };

                    // Store all related states
                    var links = iElement.find('a');
                    var states = [];
                    var regExp = /\(.*\)/g;

                    angular.forEach(links, function (link)
                    {
                        var state = angular.element(link).attr('ui-sref');

                        if ( angular.isUndefined(state) )
                        {
                            return;
                        }

                        // Remove any parameter definition from the state name before storing it
                        state = state.replace(regExp, '');

                        states.push(state);
                    });

                    // Store toggle-able element and its scope in the main nav controller
                    MsNavCtrl.setToggleItem(iElement, scope);

                    // Click handler
                    iElement.children('.ms-nav-button').on('click', toggle);

                    // Toggle function
                    function toggle()
                    {
                        // If navigation is disabled, do nothing...
                        if ( MsNavCtrl.isDisabled() )
                        {
                            return;
                        }

                        // Disable the entire navigation to prevent spamming
                        MsNavCtrl.disable();

                        if ( isCollapsed() )
                        {
                            // Clear the locked items list
                            MsNavCtrl.clearLockedItems();

                            // Emit pushToLockedList event
                            scope.$emit('msNav::pushToLockedList');

                            // Collapse everything but locked items
                            $rootScope.$broadcast('msNav::collapse');

                            // Expand and then...
                            expand().then(function ()
                            {
                                // Enable the entire navigation after animations completed
                                MsNavCtrl.enable();
                            });
                        }
                        else
                        {
                            // Collapse with all children
                            scope.$broadcast('msNav::forceCollapse');
                        }
                    }

                    // Cleanup
                    scope.$on('$destroy', function ()
                    {
                        iElement.children('.ms-nav-button').off('click');
                    });

                    /*---------------------*/
                    /* Scope Events        */
                    /*---------------------*/

                    /**
                     * Collapse everything but locked items
                     */
                    scope.$on('msNav::collapse', function ()
                    {
                        // Only collapse toggles that are not locked
                        var lockedItems = MsNavCtrl.getLockedItems();
                        var locked = false;

                        angular.forEach(lockedItems, function (lockedItem)
                        {
                            if ( angular.equals(lockedItem.scope, scope) )
                            {
                                locked = true;
                            }
                        });

                        if ( locked )
                        {
                            return;
                        }

                        // Collapse and then...
                        collapse().then(function ()
                        {
                            // Enable the entire navigation after animations completed
                            MsNavCtrl.enable();
                        });
                    });

                    /**
                     * Collapse everything
                     */
                    scope.$on('msNav::forceCollapse', function ()
                    {
                        // Collapse and then...
                        collapse().then(function ()
                        {
                            // Enable the entire navigation after animations completed
                            MsNavCtrl.enable();
                        });
                    });

                    /**
                     * Expand toggles that match with the current states
                     */
                    scope.$on('msNav::expandMatchingToggles', function ()
                    {
                        var currentState = $state.current.name;
                        var shouldExpand = false;

                        angular.forEach(states, function (state)
                        {
                            if ( currentState === state )
                            {
                                shouldExpand = true;
                            }
                        });

                        if ( shouldExpand )
                        {
                            expand();
                        }
                        else
                        {
                            collapse();
                        }
                    });

                    /**
                     * Add toggle to the locked list
                     */
                    scope.$on('msNav::pushToLockedList', function ()
                    {
                        // Set expanded item on main nav controller
                        MsNavCtrl.setLockedItem(iElement, scope);
                    });

                    /*---------------------*/
                    /* Internal functions  */
                    /*---------------------*/

                    /**
                     * Is element collapsed
                     *
                     * @returns {bool}
                     */
                    function isCollapsed()
                    {
                        return iElement.attr('collapsed') === 'true';
                    }

                    /**
                     * Is element expanded
                     *
                     * @returns {bool}
                     */
                    function isExpanded()
                    {
                        return !isCollapsed();
                    }

                    /**
                     * Expand the toggle
                     *
                     * @returns $promise
                     */
                    function expand()
                    {
                        // Create a new deferred object
                        var deferred = $q.defer();

                        // If the menu item is already expanded, do nothing..
                        if ( isExpanded() )
                        {
                            // Reject the deferred object
                            deferred.reject({'error': true});

                            // Return the promise
                            return deferred.promise;
                        }

                        // Set element attr
                        iElement.attr('collapsed', false);

                        // Grab the element to expand
                        var elementToExpand = angular.element(iElement.find('ms-nav-toggle-items')[0]);

                        // Move the element out of the dom flow and
                        // make it block so we can get its height
                        elementToExpand.css({
                            'position'  : 'absolute',
                            'visibility': 'hidden',
                            'display'   : 'block',
                            'height'    : 'auto'
                        });

                        // Grab the height
                        var height = elementToExpand[0].offsetHeight;

                        // Reset the style modifications
                        elementToExpand.css({
                            'position'  : '',
                            'visibility': '',
                            'display'   : '',
                            'height'    : ''
                        });

                        // Animate the height
                        scope.$evalAsync(function ()
                        {
                            $animate.animate(elementToExpand,
                                {
                                    'display': 'block',
                                    'height' : '0px'
                                },
                                {
                                    'height': height + 'px'
                                },
                                classes.expandAnimation
                            ).then(
                                function ()
                                {
                                    // Add expanded class
                                    elementToExpand.addClass(classes.expanded);

                                    // Clear the inline styles after animation done
                                    elementToExpand.css({'height': ''});

                                    // Resolve the deferred object
                                    deferred.resolve({'success': true});
                                }
                            );
                        });

                        // Return the promise
                        return deferred.promise;
                    }

                    /**
                     * Collapse the toggle
                     *
                     * @returns $promise
                     */
                    function collapse()
                    {
                        // Create a new deferred object
                        var deferred = $q.defer();

                        // If the menu item is already collapsed, do nothing..
                        if ( isCollapsed() )
                        {
                            // Reject the deferred object
                            deferred.reject({'error': true});

                            // Return the promise
                            return deferred.promise;
                        }

                        // Set element attr
                        iElement.attr('collapsed', true);

                        // Grab the element to collapse
                        var elementToCollapse = angular.element(iElement.find('ms-nav-toggle-items')[0]);

                        // Grab the height
                        var height = elementToCollapse[0].offsetHeight;

                        // Animate the height
                        scope.$evalAsync(function ()
                        {
                            $animate.animate(elementToCollapse,
                                {
                                    'height': height + 'px'
                                },
                                {
                                    'height': '0px'
                                },
                                classes.collapseAnimation
                            ).then(
                                function ()
                                {
                                    // Remove expanded class
                                    elementToCollapse.removeClass(classes.expanded);

                                    // Clear the inline styles after animation done
                                    elementToCollapse.css({
                                        'display': '',
                                        'height' : ''
                                    });

                                    // Resolve the deferred object
                                    deferred.resolve({'success': true});
                                }
                            );
                        });

                        // Return the promise
                        return deferred.promise;
                    }
                };
            }
        };
    }
})();
(function ()
{
    'use strict';

    msMaterialColorPicker.$inject = ["$mdMenu", "$mdColorPalette", "fuseGenerator"];
    angular
        .module('app.core')
        .directive('msMaterialColorPicker', msMaterialColorPicker);

    /** @ngInject */
    function msMaterialColorPicker($mdMenu, $mdColorPalette, fuseGenerator)
    {
        return {
            require    : 'ngModel',
            restrict   : 'E',
            scope      : {
                ngModel    : '=',
                msModelType: '@?'
            },
            templateUrl: 'app/core/directives/ms-material-color-picker/ms-material-color-picker.html',
            link       : function ($scope, element, attrs, ngModel)
            {
                // Material Color Palette
                $scope.palettes = $mdColorPalette;
                $scope.selectedPalette = false;
                $scope.selectedHues = false;

                /**
                 * ModelType: 'obj', 'class'(default)
                 * @type {string|string}
                 */
                $scope.msModelType = $scope.msModelType || 'class';

                /**
                 * Initialize / Watch model changes
                 */
                $scope.$watch('ngModel', setSelectedColor);

                /**
                 * Activate Hue Selection
                 * @param palette
                 * @param hues
                 */
                $scope.activateHueSelection = function (palette, hues)
                {
                    $scope.selectedPalette = palette;
                    $scope.selectedHues = hues;
                };

                /**
                 * Select Color
                 * @type {selectColor}
                 */
                $scope.selectColor = function (palette, hue)
                {
                    // Update Selected Color
                    updateSelectedColor(palette, hue);

                    // Update Model Value
                    updateModel();

                    // Hide The picker
                    $mdMenu.hide();
                };

                $scope.removeColor = function ()
                {

                    $scope.selectedColor = {
                        palette: '',
                        hue    : '',
                        class  : ''
                    };

                    $scope.activateHueSelection(false, false);

                    updateModel();
                };

                /**
                 * Set SelectedColor by model type
                 */
                function setSelectedColor()
                {
                    if ( !ngModel.$viewValue || ngModel.$viewValue === '' )
                    {
                        return;
                    }

                    var palette, hue;

                    // If ModelType Class
                    if ( $scope.msModelType === 'class' )
                    {
                        var color = ngModel.$viewValue.split('-');
                        if ( color.length >= 5 )
                        {
                            palette = color[1] + '-' + color[2];
                            hue = color[3];
                        }
                        else
                        {
                            palette = color[1];
                            hue = color[2];
                        }
                    }
                    // If ModelType Object
                    else if ( $scope.msModelType === 'obj' )
                    {
                        palette = ngModel.$viewValue.palette;
                        hue = ngModel.$viewValue.hue || 500;
                    }

                    // Update Selected Color
                    updateSelectedColor(palette, hue);
                }


                /**
                 * Update Selected Color
                 * @param palette
                 * @param hue
                 */
                function updateSelectedColor(palette, hue)
                {
                    $scope.selectedColor = {
                        palette     : palette,
                        hue         : hue,
                        class       : 'md-' + palette + '-' + hue + '-bg',
                        bgColorValue: fuseGenerator.rgba($scope.palettes[palette][hue].value),
                        fgColorValue: fuseGenerator.rgba($scope.palettes[palette][hue].contrast)
                    };

                    // If Model object not Equals the selectedColor update it
                    // it can be happen when the model only have pallete and hue values
                    if ( $scope.msModelType === 'obj' && !angular.equals($scope.selectedColor, ngModel.$viewValue) )
                    {
                        // Update Model Value
                        updateModel();
                    }

                    $scope.activateHueSelection(palette, $scope.palettes[palette]);
                }

                /**
                 * Update Model Value by model type
                 */
                function updateModel()
                {
                    if ( $scope.msModelType === 'class' )
                    {
                        ngModel.$setViewValue($scope.selectedColor.class);
                    }
                    else if ( $scope.msModelType === 'obj' )
                    {
                        ngModel.$setViewValue($scope.selectedColor);
                    }
                }
            }
        };
    }
})();
(function ()
{
    'use strict';

    msDatepickerFix.$inject = ["msDatepickerFixConfig"];
    angular
        .module('app.core')
        .provider('msDatepickerFixConfig', msDatepickerFixConfigProvider)
        .directive('msDatepickerFix', msDatepickerFix);

    /** @ngInject */
    function msDatepickerFixConfigProvider()
    {

        // Default configuration
        var defaultConfiguration = {
            // To view
            formatter: function (val)
            {
                if ( !val )
                {
                    return '';
                }

                return val === '' ? val : new Date(val);
            },
            // To model
            parser   : function (val)
            {
                if ( !val )
                {
                    return '';
                }
                var offset = moment(val).utcOffset();
                var date = new Date(moment(val).add(offset, 'm'));
                return date;
            }
        };

        // Methods
        this.config = config;

        //////////

        /**
         * Extend default configuration with the given one
         *
         * @param configuration
         */
        function config(configuration)
        {
            defaultConfiguration = angular.extend({}, defaultConfiguration, configuration);
        }

        /**
         * Service
         */
        this.$get = function ()
        {
            return defaultConfiguration;
        };
    }

    /** @ngInject */
    function msDatepickerFix(msDatepickerFixConfig)
    {
        return {
            require: 'ngModel',
            link   : function (scope, elem, attrs, ngModel)
            {
                ngModel.$formatters.unshift(msDatepickerFixConfig.formatter); // to view
                ngModel.$parsers.unshift(msDatepickerFixConfig.parser); // to model
            }
        };
    }
})();
(function ()
{
    'use strict';

    angular
        .module('app.core')
        .controller('MsFormWizardController', MsFormWizardController)
        .directive('msFormWizard', msFormWizardDirective)
        .directive('msFormWizardForm', msFormWizardFormDirective);

    /** @ngInject */
    function MsFormWizardController()
    {
        var vm = this;

        // Data
        vm.forms = [];
        vm.selectedIndex = 0;

        // Methods
        vm.registerForm = registerForm;

        vm.previousStep = previousStep;
        vm.nextStep = nextStep;
        vm.firstStep = firstStep;
        vm.lastStep = lastStep;

        vm.totalSteps = totalSteps;
        vm.isFirstStep = isFirstStep;
        vm.isLastStep = isLastStep;

        vm.currentStepInvalid = currentStepInvalid;
        vm.previousStepInvalid = previousStepInvalid;
        vm.formsIncomplete = formsIncomplete;
        vm.resetForm = resetForm;

        //////////

        /**
         * Register form
         *
         * @param form
         */
        function registerForm(form)
        {
            vm.forms.push(form);
        }

        /**
         * Go to previous step
         */
        function previousStep()
        {
            if ( isFirstStep() )
            {
                return;
            }

            vm.selectedIndex--;
        }

        /**
         * Go to next step
         */
        function nextStep()
        {
            if ( isLastStep() )
            {
                return;
            }

            vm.selectedIndex++;
        }

        /**
         * Go to first step
         */
        function firstStep()
        {
            vm.selectedIndex = 0;
        }

        /**
         * Go to last step
         */
        function lastStep()
        {
            vm.selectedIndex = totalSteps() - 1;
        }

        /**
         * Return total steps
         *
         * @returns {int}
         */
        function totalSteps()
        {
            return vm.forms.length;
        }

        /**
         * Is first step?
         *
         * @returns {boolean}
         */
        function isFirstStep()
        {
            return vm.selectedIndex === 0;
        }

        /**
         * Is last step?
         *
         * @returns {boolean}
         */
        function isLastStep()
        {
            return vm.selectedIndex === totalSteps() - 1;
        }

        /**
         * Is current step invalid?
         *
         * @returns {boolean}
         */
        function currentStepInvalid()
        {
            return angular.isDefined(vm.forms[vm.selectedIndex]) && vm.forms[vm.selectedIndex].$invalid;
        }

        /**
         * Is previous step invalid?
         *
         * @returns {boolean}
         */
        function previousStepInvalid()
        {
            return vm.selectedIndex > 0 && angular.isDefined(vm.forms[vm.selectedIndex - 1]) && vm.forms[vm.selectedIndex - 1].$invalid;
        }

        /**
         * Check if there is any incomplete forms
         *
         * @returns {boolean}
         */
        function formsIncomplete()
        {
            for ( var x = 0; x < vm.forms.length; x++ )
            {
                if ( vm.forms[x].$invalid )
                {
                    return true;
                }
            }

            return false;
        }

        /**
         * Reset form
         */
        function resetForm()
        {
            // Go back to the first step
            vm.selectedIndex = 0;

            // Make sure all the forms are back in the $pristine & $untouched status
            for ( var x = 0; x < vm.forms.length; x++ )
            {
                vm.forms[x].$setPristine();
                vm.forms[x].$setUntouched();
            }
        }
    }

    /** @ngInject */
    function msFormWizardDirective()
    {
        return {
            restrict  : 'E',
            scope     : true,
            controller: 'MsFormWizardController as msWizard',
            compile   : function (tElement)
            {
                tElement.addClass('ms-form-wizard');

                return function postLink()
                {

                };
            }
        }

    }

    /** @ngInject */
    function msFormWizardFormDirective()
    {
        return {
            restrict: 'A',
            require : ['form', '^msFormWizard'],
            compile : function (tElement)
            {
                tElement.addClass('ms-form-wizard-form');

                return function postLink(scope, iElement, iAttrs, ctrls)
                {
                    var formCtrl = ctrls[0],
                        MsFormWizardCtrl = ctrls[1];

                    MsFormWizardCtrl.registerForm(formCtrl);
                }
            }
        }
    }

})();
(function ()
{
    'use strict';

    angular
        .module('app.core')
        .directive('msCard', msCardDirective);

    /** @ngInject */
    function msCardDirective()
    {
        return {
            restrict: 'E',
            scope   : {
                templatePath: '=template',
                card        : '=ngModel',
                vm          : '=viewModel'
            },
            template: '<div class="ms-card-content-wrapper" ng-include="templatePath" onload="cardTemplateLoaded()"></div>',
            compile : function (tElement)
            {
                // Add class
                tElement.addClass('ms-card');

                return function postLink(scope, iElement)
                {
                    // Methods
                    scope.cardTemplateLoaded = cardTemplateLoaded;

                    //////////

                    /**
                     * Emit cardTemplateLoaded event
                     */
                    function cardTemplateLoaded()
                    {
                        scope.$emit('msCard::cardTemplateLoaded', iElement);
                    }
                };
            }
        };
    }
})();
/**
 * Created by shaoshun on 2016/11/28.
 */
/**
 * Created by Corning on 16/11/15.
 */
(function () {
  'use strict';

  msGenSelect.$inject = ["$rootScope"];
  msGenSelectController.$inject = ["$scope", "remote", "xhscService", "$q"];
  angular
    .module('app.core')
    .controller('msGenSelectController', msGenSelectController)
    .directive('msGenSelect', msGenSelect);

  /** @ngInject */
  function msGenSelect($rootScope) {
    return {
      restrict: 'E',
      scope: {
        areas: '=',
        procedure: "=",
        current:"=",
        level:"=",
        arearId:"=",
        name:"="
      },
      templateUrl: 'app/core/directives/ms-area-select/ms-general-select.html',
      controller: 'msGenSelectController',
      link: function ($scope, element, attr, ctrl) {
        $scope.toggle=function (status) {
           var  _status=['region','part','procedure'];
           if (!$scope.status){
             $scope.status={};
           }
          _status.forEach(function (r) {
            if (r!==status){
              $scope.status[r]=false;
            }
          })
          $scope.status[status]=! $scope.status[status];
        }
        $scope.setBuilding=function (area,siblings) {
          $scope.setActive(area,siblings);
          $scope.source.parts=[];
          $scope.source.floors=[];
          $scope.source.rooms=[];
          $scope.source.parts=area.Children;
          if ( $scope.source.parts.length){
            $scope.setFloor($scope.source.parts[0],$scope.source.parts);
          }
          $scope.current=$scope.current?$scope.current:{};
          $scope.current.region=null;
          $scope.current.selectedArea=area;
          $scope.toggle('part');
        }
        $scope.setFloor=function (area,siblings) {
          $scope.setActive(area,siblings);
          $scope.source.floors=[];
          $scope.source.rooms=[];
          if ($scope.current){
            $scope.current.region=null;
          }
          $scope.source.floors=area.Children;
        }
        $scope.setRoom=function (area,siblings) {
          $scope.setActive(area,siblings);
          if($scope.level&&parseInt($scope.level)<5){
            $scope.selectedRegion(area,siblings);
          }else if($scope.level=="5"){
            if ($scope.current){
              $scope.current.region=null;
            }
            $scope.source.rooms=area.Children;
          }else {
            // $scope.setActive(area,siblings);
            if ($scope.current){
              $scope.current.region=null;
            }
            $scope.source.rooms=[{
              RegionID:"no",
              RegionName:"不到户",
              parent:area,
              active:true
            }].concat(area.Children);
          }
        }
        $scope.selectedRegion=function (item,siblings) {
          $scope.setActive(item,siblings);
          if (item.RegionID=="no"||item.RegionID.length>10){
            if (!$scope.current||!$scope.current.procedure){
              $scope.toggle('procedure');
            }else {
              $scope.toggle('part');
            }
          }else {
            $scope.toggle('region');
          }
          $scope.current=$scope.current?$scope.current:{};
          $scope.current.region=item.RegionID=="no"?item.parent:item;
        }
        $scope.selectedProcedure=function (item,siblings) {
          $scope.setActive(item,siblings);
          if (!$scope.current||!$scope.current.region){
            $scope.toggle('part');
          }else {
            $scope.toggle('procedure');
          }
          $scope.current=$scope.current?$scope.current:{};
          $scope.current.procedure=item;
        }

        $scope.setSpecialty=function (item,siblings) {
          $scope.setActive(item,siblings);
          $scope.source.wpAcceptanceList=[];
          if ($scope.current){
            $scope.current.procedure=null;
          }
          $scope.source.wpAcceptanceList=item.WPAcceptanceList
        }

        $scope.$watch("areas",function (v,o) {
            if (!v){
               return;
            }
            v.then(function (r) {
              $scope.build=null;
              if ($scope.arearId){
                  var area;
                  r.forEach(function (m) {
                    area=m.Children.find(function (k) {
                      return k.RegionID==$scope.arearId;
                    })
                    if (area){
                      $scope.build=area.Children;
                    }
                  })
              }
              if ($scope.build&&$scope.build.length>0){
                $scope.source.parts=$scope.build
                $scope.setRegion($scope.source.parts[0],$scope.build);
                $scope.status={
                  region:false,
                  part:true,
                  procedure:false
                };

              }else {
                $scope.source.areasData=r
                $scope.setRegion($scope.source.areasData[0]);
                $scope.status={
                  region:true,
                  part:false,
                  procedure:false
                };
              }
              $scope.loaded = true;
              $rootScope.$emit("msGenSelect_loaded");
            }).catch(function () {
              $scope.loaded = true;
            });

        })
        $scope.$watch("procedure",function (v,o) {
          if (!v){
            return;
          }
          v.then(function (r) {
            $scope.source.procedureData=r.data;
            if ($scope.source.procedureData.length){
              $scope.setProcedure($scope.source.procedureData[0],$scope.source.procedureData);
            }
          })
        })
      }
    };
  }

  function msGenSelectController($scope, remote, xhscService, $q) {
    $scope.source={};
    $scope.setActive=function (area,siblings) {
      function setChild(t) {
        if (t.Children){
          t.Children.forEach(function (m) {
            m.active=false;
            setChild(m);
          })
        }
        if (t.SpecialtyChildren){
          t.SpecialtyChildren.forEach(function (m) {
            m.active=false;
            setChild(m);
          })
        }
        if (t.WPAcceptanceList){
          t.WPAcceptanceList.forEach(function (m) {
            m.active=false;
            setChild(m);
          })
        }
      }
      siblings.forEach(function (o) {
        o.active=false; //选中背景设置
        setChild(o);
      });
      setChild(area);
      area.active=true;
    }
    //初始化部位
    $scope.setRegion=function (area,build) {
      if ($scope.current){
        $scope.current.selectedArea=null;
        $scope.current.region=null;
      }
      if ($scope.build){
        $scope.source.floors=[];
        $scope.source.rooms=[];
        $scope.setActive(area,$scope.source.parts);
        $scope.source.floors=area.Children;
      }else {
        $scope.source.fq=[];
        $scope.source.parts=[];
        $scope.source.floors=[];
        $scope.source.rooms=[];
        $scope.setActive(area,$scope.source.areasData);
        $scope.source.fq=area.Children;
      }
    }
    $scope.setProcedure=function (procedure,procedureLst) {
      $scope.setActive(procedure,procedureLst);
      $scope.source.wpAcceptanceList=[];
      $scope.source.specialtyChildren=procedure.SpecialtyChildren;
      if ($scope.current){
        $scope.current.procedure=null;
      }
      if ($scope.source.specialtyChildren){
        $scope.source.specialtyChildren.sort(function (a,b) {
          return a.SpecialtyName.localeCompare(b.SpecialtyName);
        });
      }
    }
  }
})();

/**
 * Created by Corning on 16/11/15.
 */
(function ()
{
  'use strict';

  msAreaSelectController.$inject = ["$scope", "remote", "xhscService"];
  angular
    .module('app.core')
    .controller('msAreaSelectController', msAreaSelectController)
    .directive('msAreaSelect', msAreaSelectDirective);


  /** @ngInject */
  // function msAreaSelectController($scope,remote,xhscService){
  //
  //   //隐藏与显示列表
  //   function toggleList(isShow) {
  //       !!isShow
  //       ?
  //       (function () {
  //         $('.md-area-select .md-area-select-content').fadeOut();
  //       }())
  //       :
  //       (function () {
  //         $('.md-area-select .md-area-select-content').fadeIn();
  //       }());
  //   }
  //
  //   //由RegionID得到子级列表
  //   function getItems(RegionID,isRoot) {
  //     var res=[],
  //       rt=$scope.resultTree||[];
  //
  //     angular.forEach(rt,function (v,i) {
  //       if(!!isRoot){
  //         if(!v.ParentID){
  //           res.push(v);
  //         }
  //       }else{
  //         if(v.ParentID&&v.ParentID===RegionID){
  //           res.push(v);
  //         }
  //       }
  //     });
  //
  //     return res;
  //   }
  //
  //   /* 远程获取数据 */
  //   remote.Project.getRegionWithRight_wrap("", 31,"msAreaRegions").then(function(r){
  //     var data=r.data&&r.data.data?r.data.data:[];
  //     if (data.length == 0) {
  //       return;
  //     }
  //
  //     $scope.resultTree=data;
  //     $scope.showAreaData();
  //     //第一次加载把工序数据加载出来
  //     remote.Procedure.queryProcedure().then(function(result){
  //       $scope.procedureTree=result.data||[];
  //     });
  //
  //   });
  //
  //   /* Region */
  //   $scope.SelectedRegion=null;
  //
  //   /* Procedure */
  //   $scope.SelectedProcedure=null;
  //
  //   /* 初始化数据变量 */
  //   $scope.areaData={
  //     type:'area',//当前列表的数据类型
  //     selectedItems:[null,null],//选中的数据
  //     initText:'区域',//初始化时的文本值
  //     showText:'',//选中时展示的文本
  //     flexes:[50,50,0],//每列布局数值
  //     lever:1//有多少显示的列与flexes数值有关
  //   };
  //
  //   $scope.showAreaData=function(){
  //     $scope.itemAList=getItems(null,true);
  //     var secItem=$scope.areaData.selectedItems[0]||$scope.itemAList[0];
  //     $scope.areaData.selectedItems[0]=secItem;
  //     $scope.itemBList=getItems(secItem.RegionID);
  //     $scope.itemCList=[];
  //     $scope.flexes=[50,50,0];
  //     $scope.currentType='area';
  //
  //   };
  //
  //   $scope.departmentData={
  //     type:'department',
  //     selectedItems:[null,null,null],
  //     initText:'部位',
  //     showText:'',
  //     flexes:[25,25,50],
  //     lever:2
  //   };
  //
  //   $scope.showDepartmentData=function () {
  //
  //     $scope.itemAList=getItems($scope.areaData.selectedItems[1].RegionID);
  //
  //     var secAItem=$scope.departmentData.selectedItems[0]||$scope.itemAList[0];
  //     $scope.departmentData.selectedItems[0]=secAItem;
  //
  //     $scope.itemBList=getItems(secAItem.RegionID);
  //
  //     var secBItem=$scope.departmentData.selectedItems[1]||$scope.itemBList[0];
  //     $scope.departmentData.selectedItems[1]=secBItem;
  //
  //     $scope.flexes=[25,25,50];
  //     $scope.currentType='department';
  //     getOtherRegionList($scope.departmentData,1);
  //
  //   };
  //
  //   $scope.procedureData={
  //     type:'procedure',
  //     selectedItems:[null,null,null],
  //     initText:'工序',
  //     showText:'',
  //     flexes:[25,25,50],
  //     lever:2
  //   };
  //
  //   $scope.showProcedureData=function () {
  //     //debugger
  //     $scope.itemAList=$scope.procedureTree;
  //
  //     var secAItem=$scope.procedureData.selectedItems[0]||$scope.itemAList[0];
  //     $scope.procedureData.selectedItems[0]=secAItem;
  //
  //     $scope.itemBList=secAItem['SpecialtyChildren'];
  //
  //     var secBItem=$scope.procedureData.selectedItems[1]||$scope.itemBList[0]||[];
  //
  //     $scope.itemCList=secBItem['WPAcceptanceList'];
  //
  //     $scope.flexes=[50,50,0];
  //     $scope.currentType='procedure';
  //
  //   };
  //
  //   //每列数据及布局的数值
  //   $scope.flexes=[50,50,0];
  //   //当前选中哪种数据类型
  //   $scope.currentType=$scope.areaData.type||'area';
  //   //每列数据值 分a b c三列
  //   $scope.itemAList=[];
  //   $scope.itemBList=[];
  //   $scope.itemCList=[];
  //   //每列选中的项添加选中class值
  //   $scope.getCurrentSelectedItem=function (flexIndex,listItem) {
  //     var resItem={};
  //     switch($scope.currentType){
  //       case 'area':
  //         resItem=$scope.areaData.selectedItems[flexIndex];
  //         break;
  //       case 'department':
  //         resItem=$scope.departmentData.selectedItems[flexIndex];
  //         break;
  //       case 'procedure':
  //         resItem=$scope.procedureData.selectedItems[flexIndex];
  //         break;
  //     }
  //     if(
  //       resItem&&listItem&&
  //       (resItem.RegionUnSelected||resItem.RegionID&&(resItem.RegionID===listItem.RegionID)
  //       ||
  //       (resItem.SpecialtyID&&(resItem.SpecialtyID===listItem.SpecialtyID))
  //         ||
  //       (resItem.AcceptanceItemID&&(resItem.AcceptanceItemID===listItem.AcceptanceItemID))
  //       )
  //     ){
  //       return 'selected';
  //     }else{
  //       return ''
  //     }
  //   };
  //
  //   /* 点击下拉列表 */
  //   $scope.clickDrownList=function(e,type,i){
  //
  //     if(!type)
  //       return false;
  //     //如果前面的最后一项没有选中值，则不做任何操作
  //     var typeArray=['areaData','departmentData','procedureData'];
  //     if(i>0){
  //       var preVal=$scope[typeArray[i-1]];
  //       if(!preVal['selectedItems'][preVal['lever']]){
  //         return false;
  //       }
  //     }
  //
  //     var selectedElement=$(e.target);
  //
  //     if(selectedElement.length>0){
  //
  //       var hasClass=selectedElement.hasClass('on');
  //       selectedElement.parents('.md-area-select-top').find('.md-select-value').removeClass('on');
  //
  //       if(hasClass){
  //         selectedElement.removeClass('on');
  //       }else{
  //         selectedElement.addClass('on');
  //       }
  //
  //       var dataArrNames=['showAreaData','showDepartmentData','showProcedureData'];
  //
  //       toggleList(hasClass);
  //
  //       $scope[dataArrNames[i]]();
  //     }
  //
  //   };
  //
  //   //用递规方法遍历其它列
  //   function getOtherRegionList(typeInstance,flexIndex){
  //     if(flexIndex<typeInstance.lever){
  //       var listName=['itemAList','itemBList','itemCList'];
  //       var Children=getItems(typeInstance['selectedItems'][flexIndex].RegionID)||[];
  //       var firstChildren=[];
  //       if(flexIndex==1&&$scope.currentType==='department'){
  //         firstChildren.push({
  //           Children:null,
  //           ParentID:null,
  //           RegionID:null,
  //           RegionName:'不到户',
  //           RegionType:null,
  //           RegionUnSelected:true
  //         });
  //       }
  //
  //       $scope[listName[flexIndex+1]]=firstChildren.concat(Children);
  //
  //       if(flexIndex+1<typeInstance.lever){
  //         typeInstance['selectedItems'][flexIndex+1]=$scope[listName[flexIndex+1]][0];
  //       }
  //
  //       getOtherRegionList(typeInstance,flexIndex+1);
  //
  //     }
  //
  //   }
  //
  //   //选中项的触发方法
  //   function selectedRegionListItem(e,listItem, flexIndex) {
  //     function combineName(data) {
  //       var res='';
  //       angular.forEach(data.selectedItems,function (v,i){
  //         res+=(v.RegionName||v.SpecialtyName||v.AcceptanceItemName);
  //         res+='->';
  //       });
  //       return res.replace(/\->$/,'');
  //     }
  //
  //     var currData=$scope[$scope.currentType+'Data'];
  //     currData['selectedItems'][flexIndex]=listItem;
  //
  //     if($scope.currentType==='procedure'){
  //
  //       if(flexIndex==0){
  //
  //         $scope.itemBList=$scope.procedureData.selectedItems[0]['SpecialtyChildren']||[];
  //         $scope.itemCList=[];
  //         $scope.flexes=[50,50,0];
  //
  //       }else if(flexIndex==1){
  //
  //         var selB=$scope.procedureData.selectedItems[1]||{};
  //         $scope.itemCList=selB['WPAcceptanceList']||[];
  //         if($scope.itemCList.length>0){
  //           $scope.flexes=[25,25,50];
  //         }else{
  //           $scope.SelectedProcedure=selB;
  //           $scope.flexes=[50,50,0];
  //           toggleList(true);//隐藏列表
  //         }
  //       }else{
  //         $scope.SelectedProcedure=$scope.procedureData.selectedItems[2];
  //         toggleList(true);//隐藏列表
  //       }
  //       //console.log($scope.SelectedProcedure);
  //       return false;
  //     }
  //
  //     //进入部门选择
  //     getOtherRegionList(currData,flexIndex);
  //
  //     if(currData['lever']===flexIndex){
  //
  //       var arrNames=['showAreaData','showDepartmentData','showProcedureData'];
  //
  //       var arrIndex={
  //         area:0,
  //         department:1,
  //         procedure:2
  //       };
  //
  //       currData.showText=combineName(currData);
  //
  //       var i=arrIndex[$scope.currentType];
  //
  //       $(e.target)
  //         .parents('.md-area-select')
  //         .find('.md-select-value')
  //         .eq(i)
  //         .addClass('selected');
  //
  //       $(e.target)
  //         .parents('.md-area-select')
  //         .find('.md-select-value')
  //         .removeClass('on')
  //         .eq(i+1)
  //         .addClass('on');
  //
  //       if(i===0){//选中区域项的最后一个
  //
  //       }else if(i===1){//选中部门项的最后一个
  //         var selectedRegion=$scope.departmentData['selectedItems'][2];
  //         $scope.SelectedRegion=(!!selectedRegion['RegionID'])?selectedRegion:$scope.departmentData['selectedItems'][1];
  //         //console.log($scope.SelectedRegion);
  //       }
  //
  //       $scope[arrNames[i+1]]();
  //
  //
  //     }
  //
  //   }
  //
  //   /* selectRegionItems */
  //   $scope.selectRegionItems=function (e,listItem,flexIndex) {
  //     var currentItem=$(e.target);
  //     if(currentItem.length>0){
  //       //如果已经选中
  //       if(currentItem.hasClass('selected')){
  //         return false;
  //       }
  //       selectedRegionListItem(e,listItem,flexIndex);
  //     }
  //   };
  //
  // }

  function msAreaSelectController($scope,remote,xhscService){

    //隐藏与显示列表
    function toggleList(isShow) {
      !!isShow
        ?
        (function () {
          $('.md-area-select .md-area-select-content').fadeOut();
        }())
        :
        (function () {
          $('.md-area-select .md-area-select-content').fadeIn();
        }());
    }

    //由RegionID得到子级列表
    function getItems(RegionID,isRoot) {
      var res=[],
        rt=$scope.resultTree||[];

      angular.forEach(rt,function (v,i) {
        if(!!isRoot){
          if(!v.ParentID){
            res.push(v);
          }
        }else{
          if(v.ParentID&&v.ParentID===RegionID){
            res.push(v);
          }
        }
      });

      return res;
    }

    /* 远程获取数据 */
    remote.Project.getRegionWithRight_wrap("", 31,"msAreaRegions").then(function(r){
      var data=r.data&&r.data.data?r.data.data:[];
      if (data.length == 0) {
        return;
      }

      $scope.resultTree=data;
      $scope.showAreaData();
      //第一次加载把工序数据加载出来
      remote.Procedure.queryProcedure().then(function(result){
        $scope.procedureTree=result.data||[];
      });

    });

    /* Region */
    $scope.SelectedRegion=null;

    /* Procedure */
    $scope.SelectedProcedure=null;

    /* 初始化数据变量 */
    $scope.areaData={
      type:'area',//当前列表的数据类型
      selectedItems:[null,null],//选中的数据
      initText:'区域',//初始化时的文本值
      showText:'',//选中时展示的文本
      flexes:[50,50,0],//每列布局数值
      lever:1//有多少显示的列与flexes数值有关
    };

    $scope.showAreaData=function(){
      $scope.itemAList=getItems(null,true);
      var secItem=$scope.areaData.selectedItems[0]||$scope.itemAList[0];
      $scope.areaData.selectedItems[0]=secItem;
      $scope.itemBList=getItems(secItem.RegionID);
      $scope.itemCList=[];
      $scope.flexes=[50,50,0];
      $scope.currentType='area';

    };

    $scope.departmentData={
      type:'department',
      selectedItems:[null,null,null],
      initText:'部位',
      showText:'',
      flexes:[25,25,50],
      lever:2
    };

    $scope.showDepartmentData=function () {

      $scope.itemAList=getItems($scope.areaData.selectedItems[1].RegionID);

      var secAItem=$scope.departmentData.selectedItems[0]||$scope.itemAList[0];
      $scope.departmentData.selectedItems[0]=secAItem;

      $scope.itemBList=getItems(secAItem.RegionID);

      var secBItem=$scope.departmentData.selectedItems[1]||$scope.itemBList[0];
      $scope.departmentData.selectedItems[1]=secBItem;

      $scope.flexes=[25,25,50];
      $scope.currentType='department';
      getOtherRegionList($scope.departmentData,1);

    };

    $scope.procedureData={
      type:'procedure',
      selectedItems:[null,null,null],
      initText:'工序',
      showText:'',
      flexes:[25,25,50],
      lever:2
    };

    $scope.showProcedureData=function () {
      //debugger
      $scope.itemAList=$scope.procedureTree;

      var secAItem=$scope.procedureData.selectedItems[0]||$scope.itemAList[0];
      $scope.procedureData.selectedItems[0]=secAItem;

      $scope.itemBList=secAItem['SpecialtyChildren'];

      var secBItem=$scope.procedureData.selectedItems[1]||$scope.itemBList[0]||[];

      $scope.itemCList=secBItem['WPAcceptanceList'];

      $scope.flexes=[50,50,0];
      $scope.currentType='procedure';

    };

    //每列数据及布局的数值
    $scope.flexes=[50,50,0];
    //当前选中哪种数据类型
    $scope.currentType=$scope.areaData.type||'area';
    //每列数据值 分a b c三列
    $scope.itemAList=[];
    $scope.itemBList=[];
    $scope.itemCList=[];
    //每列选中的项添加选中class值
    $scope.getCurrentSelectedItem=function (flexIndex,listItem) {
      var resItem={};
      switch($scope.currentType){
        case 'area':
          resItem=$scope.areaData.selectedItems[flexIndex];
          break;
        case 'department':
          resItem=$scope.departmentData.selectedItems[flexIndex];
          break;
        case 'procedure':
          resItem=$scope.procedureData.selectedItems[flexIndex];
          break;
      }
      if(
        resItem&&listItem&&
        (resItem.RegionUnSelected||resItem.RegionID&&(resItem.RegionID===listItem.RegionID)
          ||
          (resItem.SpecialtyID&&(resItem.SpecialtyID===listItem.SpecialtyID))
          ||
          (resItem.AcceptanceItemID&&(resItem.AcceptanceItemID===listItem.AcceptanceItemID))
        )
      ){
        return 'selected';
      }else{
        return ''
      }
    };

    /* 点击下拉列表 */
    $scope.clickDrownList=function(e,type,i){

      if(!type)
        return false;
      //如果前面的最后一项没有选中值，则不做任何操作
      var typeArray=['areaData','departmentData','procedureData'];
      if(i>0){
        var preVal=$scope[typeArray[i-1]];
        if(!preVal['selectedItems'][preVal['lever']]){
          return false;
        }
      }

      var selectedElement=$(e.target);

      if(selectedElement.length>0){

        var hasClass=selectedElement.hasClass('on');
        selectedElement.parents('.md-area-select-top').find('.md-select-value').removeClass('on');

        if(hasClass){
          selectedElement.removeClass('on');
        }else{
          selectedElement.addClass('on');
        }

        var dataArrNames=['showAreaData','showDepartmentData','showProcedureData'];

        toggleList(hasClass);

        $scope[dataArrNames[i]]();
      }

    };

    //用递规方法遍历其它列
    function getOtherRegionList(typeInstance,flexIndex){
      if(flexIndex<typeInstance.lever){
        var listName=['itemAList','itemBList','itemCList'];
        var Children=getItems(typeInstance['selectedItems'][flexIndex].RegionID)||[];
        var firstChildren=[];
        if(flexIndex==1&&$scope.currentType==='department'){
          firstChildren.push({
            Children:null,
            ParentID:null,
            RegionID:null,
            RegionName:'不到户',
            RegionType:null,
            RegionUnSelected:true
          });
        }

        $scope[listName[flexIndex+1]]=firstChildren.concat(Children);

        if(flexIndex+1<typeInstance.lever){
          typeInstance['selectedItems'][flexIndex+1]=$scope[listName[flexIndex+1]][0];
        }

        getOtherRegionList(typeInstance,flexIndex+1);

      }

    }

    //选中项的触发方法
    function selectedRegionListItem(e,listItem, flexIndex) {
      function combineName(data) {
        var res='';
        angular.forEach(data.selectedItems,function (v,i){
          res+=(v.RegionName||v.SpecialtyName||v.AcceptanceItemName);
          res+='->';
        });
        return res.replace(/\->$/,'');
      }

      var currData=$scope[$scope.currentType+'Data'];
      currData['selectedItems'][flexIndex]=listItem;

      if($scope.currentType==='procedure'){

        if(flexIndex==0){

          $scope.itemBList=$scope.procedureData.selectedItems[0]['SpecialtyChildren']||[];
          $scope.itemCList=[];
          $scope.flexes=[50,50,0];

        }else if(flexIndex==1){

          var selB=$scope.procedureData.selectedItems[1]||{};
          $scope.itemCList=selB['WPAcceptanceList']||[];
          if($scope.itemCList.length>0){
            $scope.flexes=[25,25,50];
          }else{
            $scope.SelectedProcedure=selB;
            $scope.flexes=[50,50,0];
            toggleList(true);//隐藏列表
          }
        }else{
          $scope.SelectedProcedure=$scope.procedureData.selectedItems[2];
          toggleList(true);//隐藏列表
        }
        //console.log($scope.SelectedProcedure);
        return false;
      }

      //进入部门选择
      getOtherRegionList(currData,flexIndex);

      if(currData['lever']===flexIndex){

        var arrNames=['showAreaData','showDepartmentData','showProcedureData'];

        var arrIndex={
          area:0,
          department:1,
          procedure:2
        };

        currData.showText=combineName(currData);

        var i=arrIndex[$scope.currentType];

        $(e.target)
          .parents('.md-area-select')
          .find('.md-select-value')
          .eq(i)
          .addClass('selected');

        $(e.target)
          .parents('.md-area-select')
          .find('.md-select-value')
          .removeClass('on')
          .eq(i+1)
          .addClass('on');

        if(i===0){//选中区域项的最后一个

        }else if(i===1){//选中部门项的最后一个
          var selectedRegion=$scope.departmentData['selectedItems'][2];
          $scope.SelectedRegion=(!!selectedRegion['RegionID'])?selectedRegion:$scope.departmentData['selectedItems'][1];
          //console.log($scope.SelectedRegion);
        }

        $scope[arrNames[i+1]]();


      }

    }

    /* selectRegionItems */
    $scope.selectRegionItems=function (e,listItem,flexIndex) {
      var currentItem=$(e.target);
      if(currentItem.length>0){
        //如果已经选中
        if(currentItem.hasClass('selected')){
          return false;
        }
        selectedRegionListItem(e,listItem,flexIndex);
      }
    };

  }




  /** @ngInject */
  function msAreaSelectDirective()
  {
    return {
      restrict: 'E',
      scope:{
        dataList2:'='
      },
      templateUrl: 'app/core/directives/ms-area-select/ms-area-select.html',
      compile : function (tElement) {

      },
      controller:'msAreaSelectController',
      link:function ($scope,element,attr,ctrl) {

      }
    };
  }
})();

/**
 * Created by shaoshun on 2016/11/29.
 */
/**
 * Created by lss on 2016/10/18.
 */

(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    $stateProvider
      .state('app.xhsc.xj',{
        url:'/xj',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.xj.main', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '巡检',
        url: '',
        templateUrl: 'app/main/xhsc/cycleLook/cycleLookMain.html',
        controller: 'cycleLookMainController as vm'
      })
      .state('app.xhsc.xj.base', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '巡检',
        url: '/xj/{yw}',
        templateUrl: 'app/main/xhsc/cycleLook/cycleLookBase.html',
        controller: 'cycleLookBaseController as vm'
      })
      .state('app.xhsc.xj.accept', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '巡检',
        url: '/xjAccept/{InspectionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/cycleLook/cycleLookAccept.html',
        controller: 'cycleLookAcceptController as vm'
      })
      .state('app.xhsc.xj.rectify', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '巡检',
        url: '/xjRectify/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/cycleLook/cycleLookRectify.html',
        controller: 'cycleLookRectifyController as vm'
      })
  }
})();

/**
 * Created by UUI on 2016/11/29.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    $stateProvider
      .state('app.xhsc.yf',{
        url:'/yf',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.yf.Main', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '移动验房',
        url: '/Mian',
        templateUrl: 'app/main/xhsc/yf/yfMain.html',
        controller: 'yfMainController as vm'
      })

      .state('app.xhsc.yf.yfBase', {
      noBack:true,
      sendBt: false,
      rightArrow: false,
      leftArrow: false,
      title: '移动验房',
      url: '/yf/{yw}',
      templateUrl: 'app/main/xhsc/yf/yfBase.html',
      controller: 'yfBaseController as vm'
    })
      .state('app.xhsc.yf.yfAccept', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '移动验房',
        url: '/yfAccept/{InspectionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/yf/yfAccept.html',
        controller: 'yfAcceptController as vm'
      })
      .state('app.xhsc.yf.yfRectify', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '移动验房',
        url: '/yfRectify/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/yf/yfRectify.html',
        controller: 'yfRectifyController as vm'
      })
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    // State
    $stateProvider
      .state('app.xhsc.xxjd',{
        url:'/xxjd',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.xxjd.xxjdmain', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序验收',
        url: '/{projectId}/{projectName}',
        templateUrl: 'app/main/xhsc/xxjd/xxjdmain.html',
        controller: 'xxjdmainController as vm'
      })
      .state('app.xhsc.xxjd.xxjdbuildings', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '项目名称',
        url: '/xxjdbuildings/{projectId}/{projectName}',
        templateUrl: 'app/main/xhsc/xxjd/xxjdbuildings.html',
        controller: 'xxjdbuildingsController as vm'
      })
      .state('app.xhsc.xxjd.xxjdbuilding', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '项目名称',
        url: '/xxjdbuilding/{name}/{id}',
        templateUrl: 'app/main/xhsc/xxjd/xxjdbuilding.html',
        controller: 'xxjdbuildingController as vm',
        resolve:{
          details:['remote',function(remote){
            return remote.Assessment.EngineeringProcess.getWorkingProcess($stateParams.id).then(function(result){

                var pageload = {
                  name: '',
                  datapoints: []
                }, gx = [
                  { x: '橱柜', id: '1c419fcc-24a9-4e38-9132-ce8076051e6a',color:'rgba(193,35,43,1)' },
                  { x: '油漆', id: 'a3776dab-9d80-4ced-b229-e6bfc51f7988',color:'rgba(181,195,52,1)' },
                  { x: '瓷砖', id: '702d964d-cd97-4217-8038-ce9b62d7584b',color:'rgba(252,206,16,1)' },
                  { x: '墙板', id: '8bfc6626-c5ed-4267-ab8f-cb2294885c25', color:'rgba(193,35,43,1)'},
                  { x: '门窗', id: '51bb20e2-92a2-4c9f-85a9-c4545e710cf0',color:'rgba(181,195,52,1)' }
                ]
                result.data.Rows.forEach(function (r) {
                  var g = gx.find(function (g) { return g.id == r.ProcedureId; });
                  if (g) {
                    g.y = r.gx1;
                  }
                  //console.log('g',g)
                });
                var tempdata = [];
                tempdata = gx;

                tempdata.forEach(function(item){
                  if(!item.y){
                    // pageload.datapoints.push(item);
                    item.color = null;
                  }
                  pageload.datapoints.push(item);
                })
                var char = angular.copy(pageload);
                //char.datapoints.splice(0, 1);
              console.log('char',char)
                return [char];
            })
          }]
        }
      })

  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    // State
    $stateProvider
      .state('app.xhsc.home',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        showgrzx:true,
        title :'工程管理',
        url   :'/',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/home/home.html',
            controller:'HomeController as vm'
          }
        }
      })
      .state('app.xhsc.ch2',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测实量',
        url   :'/choose2/{areaID}/{areaName}/{assessmentID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/ch2.html',
            controller:'ChooseScController as vm'
          }
        }
      })
      .state('app.xhsc.ch1',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实体质量',
        url   :'/stzl/{assessmentID}/{AssessmentTypeID}/{aname}/{aid}/{typename}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/ch1.html',
            controller:'xtzlChooseController as vm'
          }
        }
      })
      .state('app.xhsc.ch3',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/scxq/{assessmentID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/ch3.html',
            controller:'ChooseController as vm'
          }
        }
      })
      .state('app.xhsc.chooseHouse',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'抹灰工程',
        url   :'/chooseHouse/{id}/{areaId}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/chooseHouse.html',
            controller:'ChooseHouseController as vm'
          }
        }
      })
      .state('app.xhsc.choose',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        url   :'/choose/{acceptanceItemID}/{projectId}/{acceptanceItemName}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/choose.html',
            controller:'ChooseController as vm'
          }
        }
      })
      .state('app.xhsc.download',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'现场评估',
        url   :'/download',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/download.html',
            controller:'downloadController as vm'
          }
        }
      })
      .state('app.xhsc.xcpk',{
        noBack:true,
        sendBt:false,
        refreshBtn:false,
        rightArrow:false,
        leftArrow:false,
        title :'现场评估',
        url   :'/xcpk',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/ddetail.html',
            controller:'downdetailController as vm'
          }
        }
      })
      .state('app.xhsc.evaluate',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'评估',
        url   :'/evaluate',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/evaluate.html',
            controller:'evaluateController as vm'
          }
        }
      })
      .state('app.xhsc.evaluatelist',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        url   :'/list/{AssessmentID}/{RegionID}/{RegionName}/{AssessmentTypeID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/evaluatelist.html',
            controller:'evaluatelistController as vm'
          }
        }
      })
      .state('app.xhsc.sc',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测',
        url   :'/sc/{areaId}/{acceptanceItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/sc.html',
            controller:'scController as vm'
          }
        }
      })
      .state('app.xhsc.sc2',{
        noBack:true,
        sendBt:true,
        rightArrow:false,
        leftArrow:false,
        title :'实测',
        url   :'/sc2/{db}/{areaId}/{measureItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/sc2.html',
            controller:'sc2Controller as vm'
          }
        }
      })
      .state('app.xhsc.sctb',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/sctb/{db}/{areaId}/{measureItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/scdetail.html',
            controller:'detailscController as vm'
          }
        }
      })
      .state('app.xhsc.scv',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测查看',
        url   :'/scv/{areaId}/{acceptanceItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/scv.html',
            controller:'scController as vm'
          }
        }
      })
      .state('app.xhsc.scd',{
        noBack:false,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测结果',
        url   :'/scd/{areaId}/{acceptanceItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/scd.html',
            controller:'scdController as vm'
          }
        }
      })
      .state('app.xhsc.glxwSetting',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'',
        url   :'/glxwSetting/{AssessmentID}/{AssessmentTypeID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/glxwSetting.html',
            controller:'glxwSettingController as vm'
          }
        }
      })
      .state('app.xhsc.stzlDetail',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'lx',
        url   :'/stzlDetail/{AssessmentID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/stzlDetail.html',
            controller:'stzlDetailController as vm'
          }
        }
      })
      .state('app.pc', {
        url:'/pc',
        abstract:true,
        views:{
          'main@':{
            controller:['$scope','$rootScope',function ($scope,$rootScope) {
              $scope.$on('$viewContentAnimationEnded', function (event) {
                if (event.targetScope.$id === $scope.$id) {
                  $rootScope.$broadcast('msSplashScreen::remove');
                }
              });
            }],
            template:'<div layout="column" fullscreen="" flex ui-view="content" ></div>'
          }
        }
      })
      .state('app.pc.list',{
        url   :'/list/{AssessmentID}',
        views :{
          'content':{
            templateUrl : 'app/main/xhsc/ys/evaluatelist_pc.html',
            controller:'evaluatelistPcController as vm'
          }
        }
      })
      .state('app.xhsc.ch31',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/scxq/{year}/{projectID}/{quarter}/{assessmentStage}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/ch31.html',
            controller:'ChoosePcController as vm'
          }
        }
      })
      .state('app.pc.ch3',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/scxq/{year}/{projectID}/{quarter}/{assessmentStage}',
        views :{
          'content':{
            templateUrl : 'app/main/xhsc/ys/ch3_pc.html',
            controller:'ChoosePcController as vm'
          }
        }
      })
      .state('app.pc.sctb',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/sctb/{db}/{areaId}/{measureItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content':{
            templateUrl : 'app/main/xhsc/ys/scdetail_pc.html',
            controller:'detailscController as vm'
          }
        }
      })
      .state('app.xhsc.sctbdetail',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/sctbdetail/{recordId}/{itemId}/{MeasureRecordID}/{AcceptanceItemID}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/sctbdetail.html',
            controller:'sctbdetailController as vm'
          }
        }
      })
      .state('app.pc.sctbdetail',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'实测详情',
        url   :'/sctbdetail/{recordId}/{itemId}/{AcceptanceItemID}/{MeasureRecordID}',
        views :{
          'content':{
            templateUrl : 'app/main/xhsc/ys/sctbdetail_pc.html',
            controller:'sctbdetailController as vm'
          }
        }
      })
      .state('app.xhsc.pkresult',{
        //url   :'/pkresult/{AssessmentID}/{RegionID}/{RegionName}/{AssessmentTypeID}',
        url:'/pkresult/{year}/{projectID}/{quarter}/{assessmentStage}',
        noBack:true,
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/ys/evaluatelist_pc.html',
            controller:'evaluatelistPcController as vm'
          }
        }
      })
      .state('app.pc.pkresult', {
        url: '/pkresult/{year}/{projectID}/{quarter}/{assessmentStage}',
        views: {
          'content': {
            templateUrl: 'app/main/xhsc/ys/evaluatelist_pc.html',
            controller: 'evaluatelistPcController as vm'
          }
        }
      });

  }
})();


(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {


    msNavigationServiceProvider.saveItem('xh.pcmain', {
      title: '设置',
      state: 'app.xhsc.pcmain',
      icon:'icon-account',
      weight:1
    });

    // State
    $stateProvider
      .state('app.xhsc.scsl',{
        url:'/scsl',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.scsl.scslmain', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        showgrzx:false,
        title: '实测实量',
        url: '',
        templateUrl: 'app/main/xhsc/procedurepg/scslmain.html',
        controller: 'scslmainController as vm'
      })
      .state('app.xhsc.scsl.sclist', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '选择实测项',
        url: '/sclist/{projectId}/{assessmentID}/{area}/{isReport}',
        templateUrl: 'app/main/xhsc/procedurepg/sclist.html',
        controller: 'sclistController as vm'
      })
      .state('app.xhsc.scsl.scRegion', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/scRegion/{assessmentID}/{area}/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{maxRegion}/{isReport}',
        templateUrl: 'app/main/xhsc/procedurepg/scRegion.html',
        controller: 'scRegionController as vm'
      })
      .state('app.xhsc.scsl.schztb', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/schztb/{db}/{areaId}/{measureItemID}/{regionId}/{regionType}/{name}/{pname}',
        templateUrl: 'app/main/xhsc/procedurepg/schztb.html',
        controller: 'schztbController as vm'
      })
      .state('app.xhsc.scsl.schztbdetail', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/schztbdetail/{regionId}/{itemId}/{acceptanceItemID}/{relative}',
        templateUrl: 'app/main/xhsc/procedurepg/schztbdetail.html',
        controller: 'schztbdetailController as vm'
      })
      .state('app.xhsc.scsl._sc',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        url   :'/_sc/{db}/{areaId}/{measureItemID}/{regionId}/{regionType}/{name}/{pname}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/procedurepg/_sc.html',
            controller:'_scController as vm'
          }
        }
      })
      .state('app.xhsc.scsl.chooseArea',{
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title :'请选择分期',
        url   :'/chooseArea/{assessmentID}/{projectId}/{role}/{isReport}',
        views :{
          'content@app':{
            templateUrl : 'app/main/xhsc/procedurepg/chooseArea.html',
            controller:'chooseAreaController as vm'
          }
        }
      })
  }
})();

/**
 * Created by lss on 2016/10/18.
 */

(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    $stateProvider
      .state('app.xhsc.sf',{
        url:'/sf',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.sf.sfmain', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        showgrzx:false,
        leftArrow: false,
        title: '安全验收',
        url: '',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_main.html',
        controller: 'safe_civiliz_mainController as vm'
      })
      .state('app.xhsc.sf.sfbase', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        //showgrzx:true,
        leftArrow: false,
        title: '安全验收',
        url: '/ys/{yw}',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_base.html',
        controller: 'safe_civiliz_baseController as vm'
      })
      .state('app.xhsc.sf.sfitem', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        //showgrzx:true,
        leftArrow: false,
        title: '安全项选择',
        url: '/sfitem/{role}/{projectId}',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_item.html',
        controller: 'safe_civiliz_itemController as vm'
      })
      .state('app.xhsc.sf.sfhouse', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '区域选择',
        url: '/sfhouse/{InspectionId}/{role}/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{areaId}/{maxRegion}',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_house.html',
        controller: 'safe_civiliz_houseController as vm'
      })
      .state('app.xhsc.sf.sfaccept', {
        noBack: true,
        sendBt: true,
        title: '监理验收',
        rightArrow: false,
        leftArrow: false,
        url: '/sfaccept/{InspectionId}/{acceptanceItemID}/{acceptanceItemName}/{name}/{regionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_accept.html',
        controller: 'safe_civiliz_acceptController as vm'
      })
      .state('app.xhsc.sf.rectify',{
        noBack: true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        url: '/rectify/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/safeCiviliz/safe_civiliz_rectify.html',
        controller: 'safe_civiliz_rectifyController as vm'
      })

      .state('app.xhsc.sf.selfMain',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'安全自检',
        url   :'/self/selfMain',
        templateUrl : 'app/main/xhsc/safeCiviliz/self/safe_self_main.html',
        controller:'safeSelfMainController as vm',

      })
      .state('app.xhsc.sf.selfItem',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'安全项范围',
        url   :'/self/selfItem',
        templateUrl : 'app/main/xhsc/safeCiviliz/self/safe_self_item.html',
        controller:'safeSelfItemController as vm',

      })
      .state('app.xhsc.sf.selfRegion',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'测量区域范围',
        url   :'/self/selfRegion/{acceptanceitemIDs}',
        templateUrl : 'app/main/xhsc/safeCiviliz/self/safe_region.html',
        controller:'safeSelfRegionController as vm',

      })
      .state('app.xhsc.gx.selfAccept',{
        noBack:true,
        sendBt: true,
        rightArrow:false,
        leftArrow:false,
        title :'安全自检',
        url   :'/self/selfAccept/{inspectionID}',
        templateUrl : 'app/main/xhsc/safeCiviliz/self/safe_self_accept.html',
        controller:'safeSelfAcceptController as vm',

      })



    $stateProvider
      .state('app.xhsc.dyn',{
        url:'/dyn',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.dyn.sfDynamicMain', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '动态安全源',
        url: '/sfDynamicMain',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfDynamicMain.html',
        controller: 'sfDynamicMainController as vm'
      })
      .state('app.xhsc.dyn.sfDynamicBase', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '动态安全源',
        url: '/dynamic/{yw}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfDynamicBase.html',
        controller: 'sfDynamicBaseController as vm'
      })
      .state('app.xhsc.dyn.sfDynamicRectify', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '动态安全源',
        url: '/sfDynamicRectify/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfDynamicRectify.html',
        controller: 'sfDynamicRectifyController as vm'
      })
      .state('app.xhsc.dyn.sfDynamicAccept', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '动态安全源',
        url: '/sfDynamicAccept/{InspectionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfDynamicAccept.html',
        controller: 'sfDynamicAcceptController as vm'
      })


    $stateProvider
      .state('app.xhsc.week',{
        url:'/week',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.week.sfWeekMain', {
        // noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '安全检查',
        url: '/sfWeekMain',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfWeekMain.html',
        controller: 'sfWeekMainController as vm'
      })
      .state('app.xhsc.week.sfWeekBase', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '安全检查',
        url: '/week/{yw}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfWeekBase.html',
        controller: 'sfWeekBaseController as vm'
      })
      .state('app.xhsc.week.sfWeekAccept', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '安全检查',
        url: '/ sfWeekAccept/{InspectionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfWeekAccept.html',
        controller: 'sfWeekAcceptController as vm'
      })
      .state('app.xhsc.week.sfWeekRectify', {
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '安全检查',
        url: '/sfWeekRectify/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/safeCiviliz/sfWeekRectify.html',
        controller: 'sfWeekRectifyController as vm'
      })
  }

})();

/**
 * Created by lss on 2016/8/16.
 */
/**
 * Created by jiuyuong on 2016/6/22.
 */
/**
 * Created by lss on 2016/8/16.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    // State
    $stateProvider
      .state('app.xhsc.report',{
        url:'/report',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.report.default', {
        noBack:false,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '报表中心',
        url: '',
        templateUrl: 'app/main/xhsc/report/reportDefault.html',
        controller: 'reportDefault as vm'
      })
      .state('app.xhsc.report.ysReport', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '验收报表',
        url: '/{acceptanceItemID}',
        templateUrl: 'app/main/xhsc/report/ysReport.html',
        controller: 'ysReportController as vm'
      })
  }
})();

/**
 * Created by jiuyuong on 2016/6/22.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider)
  {
    // State
    $stateProvider
      .state('app.xhsc.gx',{
        url:'/gx',
        abstract:true,
        views:{
          'content@app':{
            template:'<ui-view flex layout="column"></ui-view>'
          }
        }
      })
      .state('app.xhsc.gx.gxmain', {
        // noBack:true,
        sendBt: false,
        showgrzx:false,
        rightArrow: false,
        leftArrow: false,
        title: '工序验收',
        url: '',
        swap:[
          {active:true,label:'材料验收',material:true},
          {active:false,label:'工序验收',material:false}
        ],
        templateUrl: 'app/main/xhsc/procedure/gxmain.html',
        controller: 'gxmainController as vm'
      })
      .state('app.xhsc.gx.yw', {
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序验收',
        url: '/{yw}',
        templateUrl: 'app/main/xhsc/procedure/yw.html',
        controller: 'ywController as vm'
      })
      .state('app.xhsc.gx.gxlist', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序选择',
        url: '/gxlist/{role}/{projectId}',
        templateUrl: 'app/main/xhsc/procedure/gxlist.html',
        controller: 'gxlistController as vm'
      })
      .state('app.xhsc.gx.gxhousechoose', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/gxhousechoose/{InspectionId}/{role}/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{areaId}/{maxRegion}',
        templateUrl: 'app/main/xhsc/procedure/gxhousechoose.html',
        controller: 'gxhousechooseController as vm'
      })
      .state('app.xhsc.gx.zjhouseChoose', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/zjhouseChoose/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{areaId}/{maxRegion}',
        templateUrl: 'app/main/xhsc/procedure/zjhouseChoose.html',
        controller: 'zjhouseChooseController as vm'
      })
      .state('app.xhsc.gx.gxtest', {
        noBack: true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        url: '/gxtest/{InspectionId}/{acceptanceItemID}/{acceptanceItemName}/{name}/{regionId}/{projectId}/{areaId}',
        templateUrl: 'app/main/xhsc/procedure/gxtest.html',
        controller: 'gxtestController as vm'
      })
      .state('app.xhsc.gx.gxalllist', {
        noBack: true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        url: '/gxalllist/{acceptanceItemName}/{acceptanceItemID}/{name}/{areaId}/{projectId}/{InspectionId}',
        templateUrl: 'app/main/xhsc/procedure/gxalllist.html',
        controller: 'gxalllistController as vm'
      })
      .state('app.xhsc.gx.gxzjcheck', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序自检',
        url: '/gxzjcheck/{acceptanceItemID}/{acceptanceItemName}/{name}/{areaId}/{projectId}/{InspectionId}',
        templateUrl: 'app/main/xhsc/procedure/gxzjcheck.html',
        controller: 'gxzjcheckController as vm'
      })
      .state('app.xhsc.gx.gxresult', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序结果',
        url: '/gxresult/{acceptanceItemName}/{acceptanceItemID}/{name}/{areaId}/{projectId}/{InspectionId}',
        templateUrl: 'app/main/xhsc/procedure/gxresult.html',
        controller: 'gxresultController as vm'
      })
      .state('app.xhsc.gx.jlgxtest', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序',
        url: '/jlgxtest',
        templateUrl: 'app/main/xhsc/procedure/jlgxtest.html',
        controller: 'jlgxtestController as vm'
      })
      .state('app.xhsc.gx.fgxtest', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序',
        url: '/fgxtest',
        templateUrl: 'app/main/xhsc/procedure/fgxtest.html',
        controller: 'fgxtestController as vm'
      })
      .state('app.xhsc.gx.gxresult.gxdetail',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'工序详情',
        url   :'/gxdetail',
        templateUrl : 'app/main/xhsc/procedure/gxdetail.html',
        controller:'gxdetailController as vm'
      })
      .state('app.xhsc.gx.gxzgdetail',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'工序整改详情',
        url   :'/gxzgdetail/{acceptanceItemID}/{acceptanceItemName}/{projectId}/{InspectionId}',
        templateUrl : 'app/main/xhsc/procedure/gxzgdetail.html',
        controller:'gxzgdetailController as vm'
      })
      .state('app.xhsc.gx.gxzgreport', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '验收详情',
        url: '/gxzgreport/{acceptanceItemID}/{acceptanceItemName}/{projectId}/{InspectionId}',
        templateUrl: 'app/main/xhsc/procedure/gxzgreport.html',
        controller: 'gxzgreportController as vm'
      })
      .state('app.xhsc.gx.gxbdchoose', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '标段选择',
        url: '/bdchoose/{projectId}',
        templateUrl: 'app/main/xhsc/procedure/gxbdchoose.html',
        controller: 'gxbdchooseController as vm'
      })
      .state('app.xhsc.gx.gxbdchoose.gxlist', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        title: '工序选择',
        url: '/gxbdchoose/{projectId}',
        templateUrl: 'app/main/xhsc/procedure/gxlist.html',
        controller: 'gxlistController as vm'
      })
      .state('app.xhsc.gx.gxbdchoose.gxhousechoose', {
        noBack: true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url: '/gxhousechoose/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{areaId}',
        templateUrl: 'app/main/xhsc/procedure/gxhousechoose.html',
        controller: 'gxhousechooseController as vm'
      })
      .state('app.xhsc.gx.gxzg',{
        noBack: true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '整改',
        url: '/gxzg/{Role}/{InspectionID}/{AcceptanceItemID}/{RectificationID}/{AcceptanceItemName}',
        templateUrl: 'app/main/xhsc/procedure/gxzg.html',
        controller: 'gxzgController as vm'
      })
      .state('app.xhsc.gx.gxfy',{
        noBack: true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        title: '复验',
        url: '/gxfy/{ProjectID}/{InspectionID}/{AcceptanceItemID}/{RectificationID}',
        templateUrl: 'app/main/xhsc/procedure/gxfy.html',
        controller: 'gxfyController as vm'
      })
      .state('app.xhsc.gx.gxresult.gxrychoose',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'人员选择',
        url   :'/rychoose',
        templateUrl : 'app/main/xhsc/procedure/gxrychoose.html',
        controller:'gxrychooseController as vm',
      })
      .state('app.xhsc.gx.regionStates',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'人员选择',
        url   :'/regionStates/{acceptanceItemID}/{projectId}/{acceptanceItemName}/{maxRegion}',
        templateUrl : 'app/main/xhsc/procedure/regionStates.html',
        controller:'regionStatesController as vm',
      })
      .state('app.xhsc.gx.selfMain',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'工序自检',
        url   :'/self/selfMain',
        templateUrl : 'app/main/xhsc/procedure/self/selfMain.html',
        controller:'selfMainController as vm',

      })
      .state('app.xhsc.gx.selfGx',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'工序范围',
        url   :'/self/selfGx',
        templateUrl : 'app/main/xhsc/procedure/self/selfGx.html',
        controller:'selfGxController as vm',

      })
      .state('app.xhsc.gx.selfRegion',{
        noBack:true,
        sendBt:false,
        rightArrow:false,
        leftArrow:false,
        title :'测量区域范围',
        url   :'/self/selfRegion/{acceptanceitemIDs}',
        templateUrl : 'app/main/xhsc/procedure/self/selfRegion.html',
        controller:'selfRegionController as vm',

      })
      .state('app.xhsc.gx.selfPicture',{
        noBack:true,
        sendBt: true,
        rightArrow:false,
        leftArrow:false,
        title :'工序自检',
        url   :'/self/selfPicture/{inspectionID}',
        templateUrl : 'app/main/xhsc/procedure/self/selfPicture.html',
        controller:'selfPictureController as vm',

      })
  }
})();

/**
 * Created by jiuyuong on 2016/4/11.
 */
(function(){
  'use strict';

  config.$inject = ["apiProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config(apiProvider) {
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    var r = function (data) {
      return $q(function (resolve) {
        resolve({
          data: data
        })
      });
    }
    apiProvider.register('xhsc', {
      profile: $http.db({
        _id: 's_userinfo',
        idField: 'UserId',
        mode: 2,
        filter: function () {
          return true;
        },
        dataType: 3
      }).bind(function () {
        return $http.get(sxt.app.api + '/api/UserInfo/profile');
      }),
      logout:function(){
       return  $http.get($http.url('/api/UserInfo/logout'))
      },
      offline: $http.db({
        _id: 's_offline',
        idField: 'Id',
        methods: {
          query: {
            dataType: 1,
            filter: function (item, prjectId) {
              return !prjectId || prjectId == item.Id;
            }
          },
          create: {
            upload: true
          },
          delete: {
            delete: true
          }
        }
      }),
      reset:function () {
        return $http.post('/Api/User/ChangePassword',input);
      },
      Project: {
        getMap: $http.db({
          db: function (db) {
            if (db == "nodb") {
              return null;
            }
            return db ? db : "mapPoroject";
          },
          idField: 'ProjectID',
          mode: 2,
          dataType: 1
        }).bind(function (db) {
          return $http.get($http.url('/api/ProjectInfoApi/GetMapProjectList'))
        }),
        getDrawingRelations: $http.db({
          db: function (projectId, db) {
            if (db == "nodb") {
              return null;
            }
            return db ? db : 'DrawingRelation';
          },
          filter: function (item, projectId) {
            return item.ProjectId == projectId;
          },
          idField: 'ProjectId',
          dataType: 3
        }).bind(function (projectId, db) {
          return $http.get($http.url('/Api/WPAcceptanceApi/GetGxDrawingRelation', {projectId: projectId})).then(function (result) {
            return {
              data: {
                ProjectId: projectId,
                Relations: result.data
              }
            }
          });
        }, function (result) {
          return {
            data: result.data.Relations
          }
        }),
        GetAreaChildenbyID: function (regionID, regionType) {
          return $http.get($http.url('/api/ProjectInfoApi/GetAreaChildenById', {areaId: regionID}))
        },
        getAllRegionWithRight: $http.db({
          db: function (regionID, regionType, db) {
            if (db) {
              return db;
            }
            return "sxtRigthRetions"
          },
          idField: function (d) {
            return d.RegionID;
          },
          mode: 2,
          dataType: 1,
        }).bind(function (regionID, regionType) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectRelationRole', {
            areaId: regionID,
            regionType: regionType
          }));
        }),
        getRegionWithRight_wrap: $http.wrap({
          _id: "msAreaRegions",
          offline: true,
          mode:2,
          idField: "regions",
          dataType: 3,
          fn: function (regionID, regionType) {
            return $http.get($http.url('/api/ProjectInfoApi/GetProjectRelationRole', {
              areaId: regionID,
              regionType: regionType
            })).then(function (r) {
              return {
                data: {
                  data: r.data
                }
              }
            });
          }
        }),
        getAllRegionWithRight_no_db: function (regionID, regionType) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectRelationRole', {
            areaId: regionID,
            regionType: regionType
          }));
        },

        getZTjd: function (areaId) {
          return $http.get($http.url('/api/ProjectInfoApi/GetSubjectSchedule', {areaId: areaId}))
        },
        getUserProjectSection:function(role){
          return  $http.get($http.url('/api/ProjectInfoApi/GetUserSection/' + role))
        },
        getDrawings: $http.db({
          _id: 'Drawing',
          idField: 'DrawingID',
          dataType: 1,
          filter: function (item, projectId) {
            return item.ProjectID == projectId;
          }
        }).bind(function (projectId) {
          return $http.get($http.url('/Api/WPAcceptanceApi/GetGxDrawingList', {projectId: projectId}));
        }),
        getDrawing: $http.db({
          _id: 'Drawing',
          idField: 'DrawingID',
          dataType: 3,
          mode: 1,
          firstIsId: true,
          fileField: ['DrawingContent'],
          filter: function (item, drawingId) {
            return item.DrawingID == drawingId;
          }
        }).bind(function (drawingId) {
          return $http.get($http.url('/Api/WPAcceptanceApi/GetGxDrawing', {drawingId: drawingId}));
        }),
        getDrawingOnline: function (drawingId) {
          return $http.get($http.url('/Api/WPAcceptanceApi/GetGxDrawing', {drawingId: drawingId}));
        },
        queryAllBulidings: $http.db({
          _id: 'Projects',
          idField: 'ProjectID',
          dataType: 1,
          filter: function (item, projectId) {
            return item.ProjectID == projectId;
          }
        }).bind(function (projectId) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectListByid', {projectId: projectId}));
        }),
        getRegionAndChildren: $http.db({
          _id: 'regions',
          idField: 'RegionID',
          dataType: 1,
          filter: function (item, regionId) {
            return item.RegionID == regionId;
          }
        }).bind(function (regionId) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectListByIdEx', {areaId: regionId}));
        }),
        getRegionWithRight: $http.db({
          db: function (regionId, db) {
            return db ? db : null;
          },
          idField: function () {
            return "regionId";
          },
          dataType: 3,
        }).bind(function (regionId) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectListByIdExAuthority', {areaId: regionId})).then(function (result) {
            return {
              data: result.data
            }
          });
        }),
        getInspectionList: $http.db({
          db: function (inspectionId, db) {
            if (db) {
              return db
            }
            return "Inspection"
          },
          idField: 'InspectionId',
          dataType: 1,
          filter: function (item, inspectionId) {
            return item.InspectionId == inspectionId;
          }
        }).bind(function (inspectionId) {
          return $http.get($http.url('/api/InspectionApi/GetInspectionInfoByInspection', {inspectionId: inspectionId}));
        }),
        getZjInspectionList: $http.db({
          _id: 'InspectionApi',
          idField: 'InspectionID',
          dataType: 1,
          filter: function (item, inspectionId) {
            return item.InspectionID == inspectionId;
          }
        }).bind(),
        insertInspectionList: $http.db({
          _id: 'Inspection',
          idField: 'InspectionId',
          upload: true
        }).bind(),
        GetRegionTreeInfo: function (ProjectID) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetRegionTreeInfo', {areaID: ProjectID}))
        },
        GetMeasureItemInfoByAreaID: function (ProjectID) {
          return $http.get($http.url('/Api/MeasureInfo/GetMeasureItemInfo', {areaID: ProjectID}))
        },
        GetMeasureItemInfoFilter: function (ProjectID) {
          return $http.get($http.url('/Api/MeasureInfo/GetMeasureItemInfoFilter', {areaID: ProjectID}))
        }
      },
      Procedure: {
        queryProcedure: $http.db({
          _id: 'AcceptanceInfo',
          idField: 'SpecialtyID',
          dataType: 1
        }).bind(function () {
          return $http.get($http.url('/Api/WPAcceptanceApi/GetWPAcceptanceInfo'));
        }),
        InspectionPoint: $http.db({
          db: function (inspectionId, acceptanceItemId, areaId, db) {
            if (db == "nodb") {
              return null
            }
            return db ? db : "InspectionPoint";
          },
          mark: "allUp",
          idField: 'MeasurePointID',
          methods: {
            query: {
              dataType: 1,
              filter: function (item, inspectionId, acceptanceItemId, areaId) {
                return true;
              },
              fn: function (inspectionId, acceptanceItemId, areaId, db) {
                return $http.get($http.url('/api/InspectionCheckpointApi/GetMeasurePoint', {
                  inspectionId: inspectionId,
                  areaId: areaId,
                  acceptanceItemId: acceptanceItemId
                }));
              }
            },
            create: {
              upload: true,
              fn: function (point) {
                if (point.geometry) {
                  point.Geometry = point.geometry;
                }
                if (typeof point.Geometry === 'string') {
                  point.Geometry = JSON.parse(point.Geometry);
                }
                return $http.post('/Api/MeasurePointApi/CreatePoint', [point]);
              }
            },
            delete: {
              delete: true,
              fn: function (measurePointID) {
                return $http.post($http.url('/Api/MeasurePointApi/DeletePoint', measurePointID))
              }
            }
          }
        }),
        InspectionIndex: {
          query: $http.db({
            _id: 'EMBDInspectionIndex',
            idField: 'InspectionIndexID',
            dataType: 1,
            filter: function (item, areaID, acceptanceItemID, userID, count) {
              return item.AreaID == areaID
                && item.AcceptanceItemID == acceptanceItemID
                && item.UserID == userID
                && item.Count == count
            }
          }).bind(function (areaID, acceptanceItemID, userID, count) {
            return $http.get($http.url('/Api/InspectionApi/GetInspectionIndex', {
              AreaID: areaID,
              AcceptanceItemID: acceptanceItemID,
              UserID: userID,
              Count: count
            }));
          }),
          create: $http.db({
            name: '检查点',
            _id: 'EMBDInspectionIndex',
            idField: 'InspectionIndexID',
            upload: true,
            local: true
          }).bind(function (inspectionIndex) {
            return $http.post($http.url('/Api/InspectionApi/CreateInspectionIndex', inspectionIndex));
          }),
          delete: $http.db({
            _id: 'EMBDInspectionIndex',
            idField: 'InspectionIndexID',
            delete: true,
            local: true
          }).bind()
        },
        InspectionCheckpoint: $http.db({
          db: function (acceptanceItemId, areaId, inspectionId, db) {
            if (db) {
              return db;
            }
            return "InspectionCheckpoint";
          },
          idField: 'CheckpointID',
          methods: {
            query: {
              dataType: 1,
              filter: function (item, AcceptanceItemID, AreaID) {
                return item.AcceptanceItemID == AcceptanceItemID && item.AreaID == AreaID;
              },
              fn: function (acceptanceItemId, areaId, inspectionId) {
                return $http.get($http.url('/Api/InspectionCheckpointApi/ByAreaIdAndAcceptanceItemId', {
                  areaId: areaId,
                  acceptanceItemId: acceptanceItemId,
                  inspectionId: inspectionId
                }));
              }
            },
            create: {
              name: '检查记录',
              upload: true,
              dataType: 3,
              fn: function (InspectionCheckpoint) {
                return $http.post('/Api/InspectionCheckpointApi/Insert', InspectionCheckpoint);
              }
            },
            delete: {
              delete: true,
              fn: function (CheckpointID) {
                $http.post('/Api/InspectionCheckpointApi/Delete', {CheckpointID: CheckpointID});
              }
            }
          }
        }),
        InspectionProblemRecord: {
          query: $http.db({
            db: function (checkpointId, db) {
              if (db) return db;
              return "InspectionProblemRecord";
            },
            idField: 'ProblemRecordID',
            dataType: 1,
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID;
            }
          }).bind(function (checkpointId) {
            return $http.get($http.url('/api/InspectionProblemRecordApi/ByCheckpointId', {checkpointId: checkpointId}))
          }),
          create: $http.db({
            name: '问题记录',
            _id: 'InspectionProblemRecord',
            idField: 'ProblemRecordID',
            upload: true
          }).bind(function (InspectionProblemRecord) {
            return $http.post('/Api/InspectionProblemRecordApi/Insert', InspectionProblemRecord);
          }),
          delete: $http.db({
            _id: 'InspectionProblemRecord',
            idField: 'ProblemRecordID',
            local: true,
            delete: true
          }).bind()
        },
        InspectionProblemRecordFile: {
          query: $http.db({
            db: function (problemRecordId, arg, db) {
              if (db) {
                return db;
              }
              return "InspectionProblemRecordFile";
            },
            idField: function (d) {
              return d.Id || d.ProblemRecordFileID
            }, dataType: 1,
            filter: function (item, ProblemRecordID) {
              return item.ProblemRecordID == ProblemRecordID;
            }
          }).bind(function (problemRecordId) {
            return $http.get($http.url('/Api/InspectionProblemRecordFileApi/GetProblemRecordFile',{problemRecordId:problemRecordId}))
          }),
          create: $http.db({
            name: '照片',
            _id: 'InspectionProblemRecordFile',
            idField: 'ProblemRecordFileID',
            upload: true
          }).bind(function (InspectionProblemRecordFile) {
            return $http.post('/Api/InspectionProblemRecordFileApi/Insert', InspectionProblemRecordFile);
          }),
          delete: $http.db({
            _id: 'InspectionProblemRecordFile',
            idField: 'ProblemRecordFileID',
            delete: true
          }).bind()
        },
        InspectionIndexJoinApi: {
          create: $http.db({
            _id: 'InspectionIndexJoinApi',
            idField: 'ProblemID',
            upload: true,
            //filter:function(item,InspectionID,ProblemID,AreaID){
            //  return item.InspectionID == InspectionID && item.ProblemID == ProblemID && item.AreaID ==AreaID
            //}
          }).bind(function (params) {
            return $http.post('/api/InspectionIndexJoinApi/Insert', params);
          }),
          query: $http.db({
            _id: 'InspectionIndexJoinApi',
            idField: 'ProblemID',
            dataType: 1,
            filter: function (item, InspectionID) {
              return item.InspectionID == InspectionID
            }
          }).bind(function (InspectionID) {
            return $http.get($http.url('/api/InspectionIndexJoinApi/GetList', {inspectionID: InspectionID}));
          })
        },
        getRegionStatus: $http.db({
          db: function (projectId, Sign, db) {
            return db ? db : null;
          },
          idField: function (item) {
            return "items";
          },
          dataType: 3,
        }).bind(function (projectId, Sign) {
          return $http.get($http.url('/Api/InspectionApi/GetUserInspectionInfo', {
            projectId: projectId,
            Sign: !Sign ? 5 : Sign
          })).then(function (r) {
            r.data.forEach(function (row) {
              row.projectId = projectId;
              row.Sign = Sign;
            });
            return {
              data: r.data
            };
          });
        }),
        getRegionStatusEx: $http.db({
          db: function (projectId, Sign, AcceptanceItemID, db) {
            if (db) {
              return db;
            }
            return "project_status_right"
          },
          idField: function (item) {
            return item.Sign + item.AcceptanceItemID + item.AreaId;
          },
          dataType: 1,
          filter: function (item, projectId, Sign) {
            return item.AreaId.indexOf(projectId) > -1 && item.Sign == Sign
          }
        }).bind(function (projectId, Sign, AcceptanceItemID) {
          var param = {
            projectId: projectId,
            sign: Sign ? Sign : 5
          }
          if (AcceptanceItemID) {
            param.AcceptanceItemID = AcceptanceItemID;
          }
          return $http.get($http.url('/api/InspectionApi/GetUserInspectionInfoEx', param)).then(function (r) {
            r.data.forEach(function (row) {
              row.projectId = projectId;
              row.Sign = Sign;
            });
            return r;
          });
        }),
        getRegionStatusEx_v2: $http.db({
          db: function (projectId, Sign, AcceptanceItemID, db) {
            if (db) {
              return db;
            }
            return "project_status_right"
          },
          idField: function (item) {
            return item.indentiy;
          },
          dataType: 3
        }).bind(function (projectId, Sign, AcceptanceItemID) {
          var param = {
            projectId: projectId,
            sign: Sign ? Sign : 5
          }
          if (AcceptanceItemID) {
            param.AcceptanceItemID = AcceptanceItemID;
          }
          return $http.get($http.url('/api/InspectionApi/GetUserInspectionInfoEx', param)).then(function (r) {
            r.data.forEach(function (row) {
              row.projectId = projectId;
              row.Sign = Sign;
            });
            return {
              data: {
                indentiy: "status",
                data: r.data
              }
            }
          });
        }),

        getMeasureMosaic: $http.db({
          db: function (projectId, acceptanceItemId, db) {
            if (db) {
              return db;
            }
            return "scStutas";
          },
          idField: function () {
            return "sc";
          },
          dataType: 3
        }).bind(function (projectId, acceptanceItemId, db) {
          var param = {
            projectId: projectId,
          }
          if (acceptanceItemId) {
            param.acceptanceItemId = acceptanceItemId;
          }
          return $http.get($http.url('/api/MeasureInfo/GetMeasureMosaic', param))
        }),
        postInspection: $http.db({
          _id: 'Inspection',
          upload: true,
          idField: 'InspectionId'
        }).bind(function (params) {
          return $http.post($http.url('/Api/InspectionApi/insert'), params)
        }, function (r, cfg, args) {
          if (!r.data) {
            r = r[0];
            return this.root.xhsc.Project.insertInspectionList({
              "InspectionId": r.InspectionId,
              "ProjectID": r.AreaList[0].AreaID.substring(0, 5),
              "Percentage": 100.0,
              "Describe": "",
              "AcceptanceItemID": r.AcceptanceItemID,
              "Status": 1,
              "Sign": r.Sign,
              "Children": r.AreaList
            }).then(function () {
              return {
                data: {
                  ErrorCode: 0,
                  Data: r
                }
              }
            });
          }
          return r;
        }),
        getInspections: $http.db({
          _id: 'InspectionInfoList',
          idField: function () {
            return "InspectionInfoList";
          },
          filter:function (item) {
            return item.id='InspectionInfoList';
          },
          dataType: 3,
          mode: 2
          // filter: function (item, status) {
          //   return item.status | status == status;
          // }
        }).bind(function (status) {
          return $http.get($http.url('/api/InspectionApi/GetInspectionInfoList', {status: status})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          })
        }),
        getZGlistbyProjectId: function (projectID) {
          return $http.get($http.url('/api/InspectionRectificationApi/List', {projectId: projectID}))
        },
        GetInspectionInfoListEx: function (params) {
          return $http.post($http.url('/api/InspectionApi/GetInspectionInfoListEx'), params)
        },
        getZGById: $http.db({
          _id: 'zgById',
          idField: 'RectificationID',
          dataType: 1,
          filter: function (item, rectificationID) {
            return item.RectificationID == rectificationID;
          }
        }).bind(function (rectificationID) {
          return $http.get($http.url('/api/InspectionRectificationApi/GetById', {rectificationID: rectificationID})).then(function (result) {
            result.data = [result.data];
            return result;
          });
        }),
        getZGReginQues: $http.db({
          _id: 'InspectionCheckpoint',
          idField: 'CheckpointID',
          dataType: 1,
          filter: function (item, areaId, rectificationID) {
            if (areaId) {
              return item.AreaID == areaId && item.RectificationID == rectificationID;
            } else {
              return item.RectificationID == rectificationID;
            }

          }
        }).bind(function (areaId, rectificationID) {
          return $http.get($http.url('/api/InspectionRectificationApi/ByAreaIdAndAcceptanceItemId', {
            areaId: areaId,
            rectificationID: rectificationID
          }))
        }),
        getZGReginQuesPoint: $http.db({
          _id: 'InspectionPoint',
          idField: 'MeasurePointID',
          dataType: 1,
          filter: function () {
            return true;
          }
        }).bind(function (areaId, rectificationID) {
          return $http.get($http.url('/api/InspectionRectificationApi/GetPointByAreaIdAndAcceptanceItemId', {
            areaId: areaId,
            rectificationID: rectificationID
          }))
        }),
        getZGlist: $http.db({
          _id: 'tblEMBDInspectionRectification',
          idField: function () {
             return "rectifications";
          },
          filter:function (item) {
            return item.id='rectifications';
          },
          dataType: 3,
          mode: 2
        }).bind(function (status) {
          return $http.get($http.url('/api/InspectionRectificationApi/GetByStatus', {status: status})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data:{
                data: result.data
              }
            }
          });
        }),
        getRectification: $http.db({
          _id: 'ByRectificationId',
          idField: 'rectificationId',
          dataType: 1,
          filter: function (item, rectificationId) {
            return item.rectificationId == rectificationId;
          }
        }).bind(function (rectificationId) {
          return $http.get($http.url('/api/InspectionApi/ByRectificationId', {rectificationId: rectificationId})).then(function (r) {
            if (r.data) {
              r.data.rectificationId = rectificationId;
            }
            return {
              data: [r.data]
            };
          })
        }, function (r) {
          return {data: r.data[0]};
        }),
        createZGReceipt: $http.db({
          _id: 'createZGReceipt',
          idField: 'InspectionID',
          prioirty: 10,
          upload: true
        }).bind(function (data) {
          return $http.post($http.url('/api/InspectionRectificationApi/Insert'), data);
        }),
        InspectionRectificationUpdateStatus: $http.db({
          _id: 'IRUpdateStatus',
          idField: 'RectificationId',
          upload: true
        }).bind(function (data) {
          return $http.post($http.url('/api/InspectionRectificationApi/UpdateStatus'), data);
        }),
        updataZjPoint: $http.db({
          _id: 'updataZjPoint',
          idField: 'CheckpointID',
          upload: true
        }).bind(function (data) {
          return $http.post($http.url('/api/InspectionCheckpointApi/UpdateStatus'), data)
        }),
        getInspectionInfoBySign: $http.db({
          _id: 'Inspection_8',
          idField: 'InspectionId',
          dataType: 1,
          fitler: function () {
            return true;
          }
        }).bind(function (sign) {
          return $http.get($http.url('/Api/InspectionApi/BySign', {sign: sign}))
        }),
        insertJlfy: $http.db({
          _id: 'ReviewInsert',
          prioirty: 10,
          idField: 'RectificationID',
          upload: true
        }).bind(function (data) {
          return $http.post($http.url('/api/InspectionRectificationApi/ReviewInsert'), data)
        }),
        //根据当前登陆人获取权限
        authorityByUserId: $http.db({
          mode: 1,
          _id: 'ProjectPermissions',
          idField: 'ProjectID',
          dataType: 1,
        }).bind(function () {
          return $http.get($http.url('/Api/ProjectInfoApi/GetProjectPermissions'));
        }),
        //根据项目ID获取项目人员权限
        GetPermissionsByProjectId: function (ProjectId) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetPermissionsByProjectId', {projectId: ProjectId}));
        },
        getZgReport: function (InspetionID) {
          return $http.get($http.url('/api/InspectionApi/GetInspectionReport', {inspectionID: InspetionID}));
        }
      },
      Assessment: {
        GetMeasureList: function (params) {
          return $http.post($http.url('/api/ReportApi/GetMeasureList'), {
            ProjectId: params.ProjectId,
            AcceptanceItemIDs: params.AcceptanceItemIDs,
            PageSize: params.PageSize,
            CurPage: params.CurPage

          })
        },
        getCheckArea: function (assessmentID) {
          return $http.get($http.url('/api/AssessmentApi/PQAssessmentMeasurItemExtractLoadData', {assessmentID: assessmentID}))

        },
        GetAsssmentReportLst: function (param) {
          return $http.post($http.url('/Api/PQAssessment/GetAsssmentReportLst'), {
            Curpage: param.Curpage,
            PageSize: param.PageSize,
            Year: param.Year,
            Quarter: param.Quarter
          });
        },
        GetMeasureItemInfoByAreaID: $http.db({
          db: function (AreaID, db) {
            return db;
          },
          idField: function () {
            return 'GetMeasureItemInfoByAreaID';
          },
          filter: function (item) {
            return item._id == 'GetMeasureItemInfoByAreaID'||item.id=='GetMeasureItemInfoByAreaID '
          },
          dataType: 3
        }).bind(function (AreaID, db) {
          return $http.get($http.url('/Api/MeasureInfo/GetMeasureItemInfo', {areaID: AreaID})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          });
        }),
        GetRegionTreeInfoNotUser: $http.db({
          db: function (AreaID, db) {
            return db;
          },
          idField: function () {
            return 'GetRegionTreeInfo';
          },
          dataType: 3,
          filter: function (item) {
            return item._id == 'GetRegionTreeInfo'||item.id == 'GetRegionTreeInfo'
          },
        }).bind(function (AreaID, db) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetRegionTreeInfoNotUser', {AreaID: AreaID})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          });
        }),
        GetRegionTreeInfo: $http.db({
          db: function (AreaID, db) {
            return db;
          },
          idField: function () {
            return 'GetRegionTreeInfo';
          },
          dataType: 3,
          filter: function (item) {
            return item._id == 'GetRegionTreeInfo'
          },
        }).bind(function (AreaID, db) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetRegionTreeInfo', {AreaID: AreaID})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          });
        }),
        GetBaseMeasure: $http.db({
          db: function (db) {
            return db;
          },
          idField: function () {
            return 'GetBaseMeasure';
          },
          dataType: 3,
          filter: function (item) {
            return item._id == 'GetBaseMeasure'|| item.id == 'GetBaseMeasure'
          },
        }).bind(function (db) {
          return $http.get($http.url('/api/MeasureInfo/GetBaseMeasure')).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          });
        }),

        getUserMeasureValue: $http.db({
          db: function (projectId, recordType, relationId, db) {
            return db;
          },
          idField: function (item) {
            return item.AcceptanceIndexID + item.MeasurePointID
          },
          dataType: 1
        }).bind(function (projectId, recordType, relationId, db, sxt) {
          return $http.get($http.url('/api/MeasureInfo/GetUserMeasureValue', {
            projectId: projectId,
            recordType: recordType,
            relationId: relationId
          })).then(function (r) {
            r.data.forEach(function (item) {
              if (!item.MeasureValueId) {
                item.MeasureValueId = sxt.uuid();
              }
            });
            return r;
          });
        }),
        GetMeasurePointAll: $http.db({
          _id: 'prePoint',
          idField: "projectID",
          dataType: 3
        }).bind(function (projectID, drawingID) {
          return $http.get($http.url('/api/MeasurePointApi/GetMeasurePointAll', {
            projectID: projectID,
            drawingID: drawingID
          })).then(function (result) {
            return {
              data: {
                projectID: projectID,
                data: result.data
              }
            }
          });
        }),
        GetMeasurePointByRole: $http.db({
          _id: 'pointRelate',
          idField: "projectID",
          dataType: 3
        }).bind(function (projectID, role) {
          return $http.get($http.url('/api/MeasurePointApi/GetMeasurePointByRole', {
            projectID: projectID,
            role: role
          })).then(function (result) {
            return {
              data: {
                projectID: projectID,
                data: result.data
              }
            }
          });
        }),
        GetMeasurePointGeometry: $http.db({
          _id: 'geometrys',
          idField: 'projectID',
          dataType: 3
        }).bind(function (projectID) {
          return $http.get($http.url('/api/MeasurePointApi/GetMeasurePointGeometry', {projectID: projectID})).then(function (result) {
            return {
              data: {
                projectID: projectID,
                data: result.data
              }
            };
          })
        }),
        getUserMeasurePoint: $http.db({
          db: function (projectId, recordType, db) {
            return db;
          },
          idField: '$id',
          dataType: 1
        }).bind(function (projectId, recordType, db) {
          return $http.get($http.url('/api/MeasureInfo/GetUserMeasurePoint', {
            projectId: projectId,
            recordType: recordType
          })).then(function (r) {
            r.data.forEach(function (item) {
              item.$id = item.MeasurePointID;
              item.geometry = JSON.parse(item.Geometry);
            });
            return r;
          });
        }),
        queryRegions: function (arg) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentSectionExtractRegion', arg))
        },
        queryRegions_9090: function (arg) {
          return $http.get($http.url('http://xhszgc.sxtsoft.com:9090/Api/AssessmentApi/GetAssessmentSectionExtractRegion', arg))
        },
        GetMeasureIndexMeasureInfo: function (regionId, itemId) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexMeasureInfoNew', {
            RegionID: regionId,
            acceptanceIndexID: itemId
          }));
        },
        GetMeasureIndexMeasureInfo_v2: function (regionId,acceptanceIndexID, relate) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexMeasureInfoNew_v2', {
            regionId: regionId,
            acceptanceIndexID: acceptanceIndexID,
            RelationID:relate
          }));
        },

        GetMeasureIndexMeasureInfo_new: function (regionId, itemId, measureRecordID) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexMeasureInfoNew2', {
            RegionID: regionId,
            acceptanceIndexID: itemId,
            measureRecordID: measureRecordID
          }));
        },
        query: $http.db({
          _id: 'projects',
          mode:2,
          idField: 'AssessmentID',
          dataType: 1
        }).bind(function () {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentProject'));
        }),
        queryById: function (assessmentID) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentProjectSingle', {assessmentID: assessmentID}))
        },
        GetAssessmentStatus: function (assessmentID) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentStatus', {assessmentID: assessmentID}))
        },
        queryRegion: function (areaID) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetRegionTreeInfo', {AreaID: areaID}));
        },
        getMeasure: $http.db({
          db: function (param, db) {
            return db == "nodb" ? null : 'getAllMeasureReportData';
          },
          idField: function (item) {
            return item.RegionID + item.AcceptanceItemID;
          },
          filter: function (item, param) {
            return item.CheckRegionID == param.RegionID && item.AcceptanceItemID == param.AcceptanceItemID;
          },
          dataType: 1
        }).bind(function (param) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexResult', param)).then(function (result) {
            var data = result.data;
            result.data = [{
              CheckRegionID: param.RegionID,
              AcceptanceItemID: param.AcceptanceItemID,
              data: data
            }]
            return result;
          });
        }),
        getMeasure_v2:function (param) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexResult_v2', param)).then(function (result) {
            var data = result.data;
            result.data = [{
              CheckRegionID: param.RegionID,
              AcceptanceItemID: param.AcceptanceItemID,
              data: data
            }]
            return result;
          });
        },
        getMeasureNew: $http.db({
          db: function (param, db) {
            if (db == "nodb") {
              return null;
            }
            return db ? db : "getAllMeasureReportDataNew";
          },
          idField: function (item) {
            return item.RegionID + item.AcceptanceItemID;
          },
          filter: function (item, param) {
            return item.CheckRegionID == param.RegionID && item.AcceptanceItemID == param.AcceptanceItemID;
          },
          dataType: 1
        }).bind(function (param, db) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexResultNew', param));
        }),
        getAllMeasureReportData: $http.db({
          _id: 'getAllMeasureReportData',
          idField: function (item) {
            return item.CheckRegionID + item.AcceptanceItemID;
          },
          dataType: 1
        }).bind(function (param) {
          return $http.get($http.url('/Api/MeasureValueApi/GetMeasureIndexResultByProjectId', param));
        }),
        queryResult: function (assessmentID) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentItemResult', {AssessmentID: assessmentID}))
        },
        modifyScore: function (data) {
          return $http.post($http.url('/Api/AssessmentApi/SubmitAssessmentItemModifyScore'), data);
        },
        deleteScoreItem: function (deducScoretItemID) {
          return $http.delete('/Api/AssessmentApi/DeleteDeducScoretItem/' + deducScoretItemID);
        },
        queryResutTotal: function (assessmentID) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentTotalReport', {AssessmentID: assessmentID}));
        },
        queryItemResults: function () {
          return $http.get($http.url('/Api/AssessmentApi/GetAllAssessmentProject'));
        },
        queryReport: function (year, quarter, projectID, assessmentStage) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentItemStatisticsResult', {
            year: year,
            projectID: projectID,
            quarter: quarter,
            assessmentStage: assessmentStage
          }));
        },
        queryReport_9090: function (year, quarter, projectID, assessmentStage) {
          return $http.get($http.url(sxt.app.fs + '/Api/AssessmentApi/GetAssessmentItemStatisticsResult', {
            year: year,
            projectID: projectID,
            quarter: quarter,
            assessmentStage: assessmentStage
          }));
        },
        queryTotalReport: function (year, quarter, projectID, assessmentStage) {
          return $http.get($http.url('/Api/AssessmentApi/GetAssessmentTotalReport', {
            year: year,
            projectID: projectID,
            quarter: quarter,
            assessmentStage: assessmentStage
          }));
        },
        queryTotalReport_9090: function (year, quarter, projectID, assessmentStage) {
          return $http.get($http.url(sxt.app.fs + '/Api/AssessmentApi/GetAssessmentTotalReport', {
            year: year,
            projectID: projectID,
            quarter: quarter,
            assessmentStage: assessmentStage
          }));
        },
        queryProjectRegionInfo: function (projectID) {
          return $http.get($http.url('/Api/ProjectInfoApi/GetProjectRegionRelationByProjectID', {projectID: projectID}));
        },
        queryProjectRegionInfo_9090: function (projectID) {
          return $http.get($http.url(sxt.app.fs + '/Api/ProjectInfoApi/GetProjectRegionRelationByProjectID', {projectID: projectID}));
        },
        sumReportTotal: function (assessmentID) {
          return $http.post($http.url('/Api/AssessmentApi/SumReportTotal'), {assessmentID: assessmentID});
        },
        queryProcessBuildings: function (regionId) {
          return $http.get($http.url('/api/ImageSignApi/GetBuildingList?stageId=' + regionId))
        },
        EngineeringProcess: {
          getWorkingMap: function (projectId) {
            return $q(function (resolve) {
              resolve({
                data: {
                  Application: null,
                  AreaImage: "a13d7f27-f320-40ed-aa43-242075e6c4cf",
                  AreaRemark: {
                    "type": "FeatureCollection",
                    "features": [{
                      "type": "Feature",
                      "properties": {},
                      "geometry": {"type": "Point", "coordinates": [0.5732421875, 0.4951171875]},
                      "options": {
                        "icon": {
                          "options": {
                            "className": "",
                            "shadowUrl": null,
                            "iconAnchor": [15, 15],
                            "iconSize": [30, 30],
                            "iconUrl": "/dp/libs/leaflet/images/photo.png",
                            "color": "#ff0000"
                          }, "_initHooksCalled": true
                        },
                        "title": "",
                        "alt": "",
                        "clickable": true,
                        "draggable": false,
                        "keyboard": true,
                        "zIndexOffset": 0,
                        "opacity": 1,
                        "riseOnHover": false,
                        "riseOffset": 250,
                        "gid": "e5bf57b4-7d71-4161-9b4f-c460766e7398"
                      }
                    }, {
                      "type": "Feature",
                      "properties": {},
                      "geometry": {"type": "Point", "coordinates": [0.21875, 0.49609375]},
                      "options": {
                        "icon": {
                          "options": {
                            "className": "",
                            "shadowUrl": null,
                            "iconAnchor": [15, 15],
                            "iconSize": [30, 30],
                            "iconUrl": "/dp/libs/leaflet/images/photo.png",
                            "color": "#ff0000"
                          }, "_initHooksCalled": true
                        },
                        "title": "",
                        "alt": "",
                        "clickable": true,
                        "draggable": false,
                        "keyboard": true,
                        "zIndexOffset": 0,
                        "opacity": 1,
                        "riseOnHover": false,
                        "riseOffset": 250,
                        "gid": "0f8696fa-f1e7-4f08-be50-5228eaddf32f"
                      }
                    }, {
                      "type": "Feature",
                      "properties": {},
                      "geometry": {"type": "Point", "coordinates": [0.3975830078125, 0.3734130859375]},
                      "options": {
                        "icon": {
                          "options": {
                            "className": "leaflet-div-label",
                            "html": "万科时代广场一期",
                            "color": "#ff0000"
                          }, "_initHooksCalled": true, "_div": {"_leaflet_pos": {"x": 568, "y": 193}}
                        },
                        "title": "",
                        "alt": "",
                        "clickable": true,
                        "draggable": true,
                        "keyboard": true,
                        "zIndexOffset": 1000,
                        "opacity": 1,
                        "riseOnHover": false,
                        "riseOffset": 250,
                        "saved": false
                      }
                    }, {
                      "type": "Feature",
                      "properties": {},
                      "geometry": {
                        "type": "Polygon",
                        "coordinates": [[[0.15966796875, 0.338623046875], [0.2236328125, 0.338134765625], [0.223388671875, 0.347412109375], [0.22314453125, 0.353759765625], [0.2236328125, 0.357666015625], [0.22607421875, 0.364501953125], [0.231201171875, 0.3740234375], [0.2392578125, 0.380126953125], [0.24462890625, 0.382568359375], [0.249755859375, 0.384033203125], [0.255615234375, 0.384521484375], [0.264404296875, 0.3837890625], [0.2705078125, 0.381591796875], [0.27978515625, 0.375], [0.28466796875, 0.3662109375], [0.2880859375, 0.35693359375], [0.2890625, 0.35107421875], [0.28759765625, 0.3447265625], [0.2880859375, 0.3388671875], [0.35107421875, 0.3388671875], [0.35205078125, 0.370361328125], [0.365966796875, 0.37060546875], [0.375244140625, 0.361328125], [0.41552734375, 0.36083984375], [0.439697265625, 0.3505859375], [0.56591796875, 0.21533203125], [0.56591796875, 0.2001953125], [0.61474609375, 0.199951171875], [0.635498046875, 0.218994140625], [0.330078125, 0.541015625], [0.2822265625, 0.546875], [0.16015625, 0.5234375], [0.15966796875, 0.338623046875]]]
                      },
                      "options": {
                        "stroke": true,
                        "color": "#ff0000",
                        "dashArray": null,
                        "lineCap": null,
                        "lineJoin": null,
                        "weight": 4,
                        "opacity": 0.5,
                        "fill": true,
                        "fillColor": null,
                        "fillOpacity": 0.2,
                        "clickable": true,
                        "smoothFactor": 1,
                        "noClip": false,
                        "itemId": "5514f7a571fe65ac066cb091",
                        "itemName": "万科时代广场一期",
                        "areaLabel": {
                          "text": "万科时代广场一期",
                          "id": "5514f7a571fe65ac066cb091",
                          "lat": 0.3734130859375,
                          "lng": 0.3975830078125
                        }
                      }
                    }]
                  },
                  BuildArea: 0,
                  CreatedId: "e2f0e8396443beab00eaa1f7cb6c2cf7ad8a346a",
                  CreatedTime: "2016-03-02",
                  GreenArea: 0,
                  LandUseType: 0,
                  Latitude: "22.7172406798959",
                  Longitude: "114.250833392143",
                  ModefiedId: "d51474c887fe38b89cf6f4eff740309789f93034",
                  ModefiedTime: "2016-06-14",
                  ProjectId: "5513e1c7493fdce42f42d9b1",
                  ProjectNo: "深圳万科时代广场",
                  SellLine: "66.7%",
                  Status: 4,
                  TotalArea: 0
                }
              })
            })

          },
          getWorkingMapDetail: function (imageId) {
            return $q(function (resolve) {
              resolve({
                data: {
                  Files: [
                    {
                      CreateDate: "2016-05-03",
                      CreatedId: "13f93de383e643f7b586493c2b9045bb37888a34",
                      FileName: "2016三馆、龙城合并运营图20160503.jpg",
                      FileSize: 6918748,
                      FileType: null,
                      GroupId: "a13d7f27-f320-40ed-aa43-242075e6c4cf",
                      Id: "2b220029-1a90-4727-b1b7-98ac20c073d7",
                      IsOK: null,
                      PartionID: 0,
                      Project: null,
                      Remark: null,
                      Status: null,
                      Url: "~/upload/2016/05/s_2b220029-1a90-4727-b1b7-98ac20c073d7.jpg"
                    }
                  ],
                  Group: "a13d7f27-f320-40ed-aa43-242075e6c4cf"
                }
              })
            })
          },
          getWorkingProcess: function (regionId) {
            return $http.get($http.url('api/ImageSignApi/GetBuildingDetailed?buildingId=' + regionId));
          }
        },

        region: {
          query: function (areaID) {
            return $http.get($http.url('http://ggroupem.sxtsoft.com:9191/Api/ProjectInfoApi/GetRegionTreeInfo',
              {AreaID: areaID}));
          }

        },
        /**
         * 项目
         * */
        Project: {
          query: function () {
            return $http.get($http.url('/Api/ProjectInfoApi/GetProjectList'));
          },
          /**
           * 分期
           * */
          Area: {
            /**
             * 获取本人所有相关分期
             * */
            query: function () {
              return $http.get($http.url('/Api/ProjectInfoApi/GetProjectAreaList'));
            },
            /**
             * 获取分期所楼栋、层、房间数据
             * @param    {string}  areaID     分期ID
             * */
            queryRegion: function (areaID) {
              return $http.get($http.url('/api/ProjectInfoApi/GetRegionTreeByRegionID', {AreaID: areaID}));
            }
          },

          /**
           * 获取<tt>regionID</tt>户型图
           * @param {string} regionID the区域ID
           * @returns {object}
           * */
          getHouseDrawing: function (regionID) {
            return $http.get($http.url('/Api/MeasurePointApi/GetHouseDrawing', {regionID: regionID}));
          },
          /**
           * 获取楼层图
           * @param {string} regionID　区域ID
           * @returns {object}
           * */
          getFloorDrawing: function (regionID) {
            return $http.get($http.url('/Api/MeasurePointApi/getFloorDrawing', {regionID: regionID}));
          },
          /**
           * 更新户型图
           * @param {string} regionID 户型ID
           * @param {object} draw 户型描述
           *        {
           *          DrawingID:'',//使用图片
           *          Geometry:'' //几何信息
           *        }
           * @returns {*}
           * **/
          updateHouseDrawing: function (regionID, draw) {
            return $http.db({
              _id: 'updateHouseDrawing',
              data: 1,
              idField: 'regionID'
            }).post('/Api/MeasureInfo/ModifyHouseType', {regionID: regionID, draw: draw});
            /**return post(regionID,draw);**/
          },


        },

        /**
         * 验收状态
         * */
        MeasureCheckBatch: {
          /**
           * @param    {string}  acceptanceItemID     实测项ID/工序ID
           * @param    {string}  areaID  分期ID
           * @param    {int}     acceptanceItemIDType  返回状态类型（目前仅为1）
           *           1   --实测项
           *           2   --工序
           *           3   --整改
           * */
          getStatus: function (acceptanceItemID, areaID, acceptanceItemIDType) {
            return $http.get($http.url('/Api/MeasureInfo/getStatus', {
              acceptanceItemID: acceptanceItemID,
              areaID: areaID,
              acceptanceItemIDType: acceptanceItemIDType
            }));

            /** return query(array({
              RegionID:'string{0}',
              RegionType:1,
              AcceptanceItemID:'acceptanceItemID{0}',//自定义后的实测项目ID
              /**
               * 0：未验收
               * 1：进行中
               * 2：已验收
               *
              Status:Math.floor(Math.random()*2)
            }))
             }**/
          }
        },

        /**
         * 质量管理
         */
        ProjectQuality: {
          /**
           * 检查点
           *
           */
          MeasurePoint: {
            /**
             * 更新或添加测量标注点
             * @param {Array} points
             *        [{
             *        type:'Feature',//固定为Feature
             *        geometry:{
             *          type:'stamp' // 固定为stamp
             *          coordinates:[0.21,0.20003] //图形位置信息
             *        }，
             *        options:{       //几何图形配置项，属性不固定，不同的geometry.type不尽相同
             *          color:'red'
             *        },
             *        properties:{
             *          $id:'guid', //唯一ID
             *          $groupId:'guid' //所在属组（可以不用，但请保存为UI使用）
             *        }
             *      }]
             * **/
            create: function (points) {
              return $http.post('/Api/MeasurePointApi/CreatePoint', points)
              /**return post(points);**/
            },
            /**
             * 删除点
             *
             * @param {string} measurePointID 唯一ID
             * */
            delete: function (measurePointID) {
              return $http.delete($http.url('/Api/MeasurePointApi/DeletePoint', {measurePointID: measurePointID}))
            },

            /**
             * 获取点
             * @param {string} acceptanceItemID 实测项Id
             * @param {string} checkRegionID 区域ID
             * @param {int} flags 0或空时为返回当前层，-1返回上一层同户型
             *
             * @returns {object}
             *          {
             *            type:'FeatureCollection',固定为FeatureCollection
             *            features:[{
             *              type:'Feature',//固定为Feature
             *              geometry:{
             *                type:'lineGroup' // lineGroup 测量组 或　areaGroup　区域组 或　stamp　测量点，以后会更多类型
             *                coordinates:[] //图形位置信息
             *              }，
             *              options:{       //几何图形配置项，属性不固定，不同的geometry.type不尽相同
             *                color:'red'
             *              },
             *              properties:{
             *                $id:'guid', //唯一ID
             *                $groupId:'guid' //所在属组（可以不用，但请保存为UI使用）
             *               }
             *            }]
             *          }
             *
             * */
            query: function (acceptanceItemID, checkRegionID, regionType, flags) {
              return $http.get($http.url('/Api/MeasurePointApi/GetMeasurePoint', {
                acceptanceItemID: acceptanceItemID,
                checkRegionID: checkRegionID,
                regionType: regionType,
                flags: flags
              }))

            },

            submit: function (values) {
              return $http.post('/Api/MeasurePointApi/MeasureSubmit', values)
            }
          },
          /***
           * 检查值
           */
          MeasureValue: {
            /**
             * 添加或更新测试值
             * @param {Array} values 测试值
             *        [{
             *          AcceptanceItemID:"",//实测项ID 必填
             *          CheckRegionID:'',//测量区域Id 必填
             *          RegionType:'',//区域类型 必填
             *          ParentMeasurePointID:'',//所在测量组ID，如果没有为null，对应$groupId
             *          MeasurePointID:'',//测量点ID
             *          AcceptanceIndexID:'',//指标ID
             *          MeasureValue:''//测量值
             *          DesignValue:''//设计值
             *          CalculatedValue:''//计算值
             *          Remark:'',//备注
             *          ExtendedField1:'',//扩展字段1
             *          ExtendedField2:'',//扩展字段2
             *          ExtendedField3:''//扩展字段3
             *        }]
             * */
            create: function (values) {
              return $http.post('/Api/MeasureValueApi/CreateMeasureValue', values);
            },

            /**
             * 获取检查点值
             * @param {string} acceptanceItemID 实测项Id
             * @param {string} checkRegionID 区域ID
             * */
            query: function (acceptanceItemID, checkRegionID, flags) {
              return $http.get($http.url('/Api/MeasureValueApi/GetMeasureValues', {
                acceptanceItemID: acceptanceItemID,
                checkRegionID: checkRegionID
              }));
            },
            /**
             * 删除点
             *
             * @param {string} measureValueId 唯一ID
             * */
            delete: function (measureValueId) {
              return $http.delete($http.url('/Api/MeasureValueApi/DeleteMeasureValue', {measureValueId: measureValueId}))
            }
          },

          getNumber: function (acceptanceItemID, checkRegionID) {
            return $http.get($http.url('/Api/MeasureValueApi/GetMeasureRecordNum', {
              acceptanceItemID: acceptanceItemID,
              checkRegionID: checkRegionID
            }));
          },
          getMeasureCheckResult: function (measureRecordID) {
            return $http.get($http.url('/Api/MeasureValueApi/GetMeasureCheckResult', {measureRecordID: measureRecordID}))
          }
        },
        sxtHouseService: {
          getZ: function (totalW, totalH, m, w, h) {
            var x;
            var y;
            var z;
            z = Math.sqrt((totalH * totalW) / (h * w * m));
            x = Math.ceil(totalW / (z * w));
            y = Math.ceil(totalH / (z * h));
            z = Math.sqrt((totalH * totalW) / (h * x * y * w));
            //console.log('result', x, y, z);
            return {
              x: x,
              y: y,
              z: z
            }
          }
        }
      },
      message: {
        //messageList: $http.db({
        //  _id: 'messageList',
        //  idField: 'Id',
        //  dataType: 1
        //}).bind(function ( startIndex,maximunRows,checked) {
        //  return $http.get($http.url('/api/Message',{maximunRows:maximunRows,startIndex:startIndex,checked:checked}))
        //})
        messageList: function (startIndex, maximunRows, checked) {
          return $http.get($http.url('/api/Message', {
            maximunRows: maximunRows,
            startIndex: startIndex,
            checked: checked
          }))
        },
        deleteAllMessage: function () {
          return $http.post($http.url('/api/Message/Clear'));
        },
        deleteMessage: function (id) {
          return $http.delete($http.url('/api/Message/' + id));
        }
      },
      Report: {
        Summary: function () {
          return $http.get(sxt.app.api + '/api/ReportApi/Summary');
        }
      },
      PQMeasureStandard: {
        messageList: function (DrawingID, AcceptanceItemID, AcceptanceIndexID) {
          return $http.get($http.url('/api/MeasureStandardApi/GetListByDrawingOrIndex', {
            DrawingID: DrawingID,
            AcceptanceIndexID: AcceptanceIndexID,
            AcceptanceItemID: AcceptanceItemID
          }))
        },
        updateScStandar: function (id) {
          return $http.put($http.url('/api/MeasureStandardApi/' + id))
        },
        delectScStandar: function (AcceptanceIndexID, DrawingID, MeasurePointID) {
          return $http.post($http.url('/api/MeasureStandardApi'), {
            AcceptanceIndexID: AcceptanceIndexID,
            DrawingID: DrawingID,
            MeasurePointID: MeasurePointID
          })
        },
        getAllScStandar: function () {
          return $http.get($http.url('/api/MeasureStandardApi'))
        },
        GetProjectDrawing: function (projectID) {
          return $http.get($http.url('/api/MeasureStandardApi/GetProjectDrawing/' + projectID))
        },
        DeletePoin: function (MeasurePointID) {
          return $http.post($http.url('/api/MeasureStandardApi/DeletePoint'), {MeasurePointID: MeasurePointID})
        },
        UpdatePoint: function (MeasurePointID, Geometry) {
          return $http.put($http.url('/api/MeasureStandardApi/UpdatePoint'), {
            MeasurePointID: MeasurePointID,
            Geometry: Geometry
          })
        },
        UpdatePoint_tran: function (Point, ListStandards) {
          return $http.put($http.url('/api/MeasureStandardApi/UpdatePointTransaction'), {
            Point: Point,
            ListStandards: ListStandards
          })
        },
        insertStandar: function (arr) {
          return $http.post($http.url('/api/MeasureStandardApi/Insert'), arr)
        },
        standarSubmit: function (AcceptanceIndexID, AcceptanceItemID, DrawingID) {
          return $http.post($http.url('/api/MeasureStandardApi/Submit'), {
            AcceptanceIndexID: AcceptanceIndexID,
            AcceptanceItemID: AcceptanceItemID,
            DrawingID: DrawingID
          })
        },
        GetListByWhere: function (drawingId, acceptanceIndexId) {
          var params = {
            drawingId: drawingId
          };
          if (acceptanceIndexId) {
            params.acceptanceIndexId = acceptanceIndexId
          }
          return $http.get($http.url('/api/MeasureStandardApi/GetListByWhere', params))
        },

        GetListByExtend: $http.db({
          db: function (extend, db) {
            if (db) {
              return db;
            }
            return "";
          },
          idField: function () {
            return "points";
          },
          dataType: 3
        }).bind(function (extend, db) {
          return $http.get($http.url('/api/MeasureStandardApi/GetListByExtend', {extend: extend})).then(function (result) {
            result.data = result.data ? result.data : [];
            return {
              data: {
                data: result.data
              }
            }
          });
        })
      },

      safe: {
        dynPointCreate: $http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "dynUp",
          _id: "dynPoints",
          idField: 'CheckpointID',
          upload: true
        }),
        dynPointQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "dynPoints",
          idField: 'CheckpointID'
        }),
        dynPointDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "dynPoints",
          idField: 'CheckpointID'
        }),
        dynProblemRecordCreate: $http.wrap({ //创建记录
          offline: true,
          dataType: 1,
          upload: true,
          mark: "dynUp",
          _id: "dynProblemRecord",
          idField: 'ProblemRecordID'
        }),
        dynProblemRecordQuery: $http.wrap({ //查询记录
          offline: true,
          dataType: 1,
          filter: function (item, CheckpointID) {
            return item.CheckpointID == CheckpointID;
          },
          _id: "dynProblemRecord",
          idField: 'ProblemRecordID'
        }),
        dynProblemRecordDelete: $http.wrap({// 删除记录
          offline: true,
          dataType: 1,
          delete: true,
          _id: "dynProblemRecord",
          idField: 'ProblemRecordID'
        }),
        dynProblemRecordFileCreate: $http.wrap({ //创建文件
          offline: true,
          dataType: 1,
          mark: "dynUp",
          _id: 'dynInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          upload: true
        }),
        dynProblemRecordFileQuery: $http.wrap({ //查询文件
          offline: true,
          _id: 'dynInspectionProblemRecordFile',
          idField: function (d) {
            return d.Id || d.ProblemRecordFileID
          },
          fn: function (ProblemRecordFileID) {
            return $http.get($http.url('/api/WeekInspects/SecurityCheckpoint/GetProblemRecordFile/' + ProblemRecordFileID)).then(function (r) {
              if (r && !angular.isArray(r.data)) {
                r.data = [r.data];
                r.data.forEach(function (t) {
                  t.isUpload = true;
                })
              }
              return r;
            });
          },
          dataType: 1,
          filter: function (item, ProblemRecordID) {
            return item.ProblemRecordID == ProblemRecordID;
          }
        }),
        dynProblemRecordFileDelete: $http.wrap({ //删除文件
          offline: true,
          dataType: 1,
          _id: 'dynInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          delete: true
        }),




        weekGetSafePointGeo: $http.wrap({
          _id: 'weekPointGeos',
          offline: true,
          idField: 'MeasurePointID',
          dataType: 1,
          fn: function (inspectionId, acceptanceItemId, areaId) {
            return $http.get($http.url('/api/WeekInspects/SecurityCheckpoint/GetSecurityPoint/' + inspectionId + '/' + areaId + '/' + acceptanceItemId));
          }
        }),
        weekPointGeoCreate:$http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "weekUp",
          _id: "weekPointGeos",
          idField: 'MeasurePointID',
          upload: true
        }),
        weekPointGeoQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "weekPointGeos",
          idField: 'MeasurePointID'
        }),
        weekpointGeoDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "weekPointGeos",
          idField: 'MeasurePointID'
        }),
        weekPointCreate: $http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "weekUp",
          _id: "weekPoints",
          idField: 'CheckpointID',
          upload: true
        }),
        weekPointQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "weekPoints",
          idField: 'CheckpointID'
        }),
        weekPointDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "weekPoints",
          idField: 'CheckpointID'
        }),
        weekproblemRecordCreate: $http.wrap({ //创建记录
          offline: true,
          dataType: 1,
          upload: true,
          mark: "weekUp",
          _id: "weekProblemRecord",
          idField: 'ProblemRecordID'
        }),
        weekproblemRecordQuery: $http.wrap({ //查询记录
          offline: true,
          dataType: 1,
          filter: function (item, CheckpointID) {
            return item.CheckpointID == CheckpointID;
          },
          _id: "weekProblemRecord",
          idField: 'ProblemRecordID'
        }),
        weekproblemRecordDelete: $http.wrap({// 删除记录
          offline: true,
          dataType: 1,
          delete: true,
          _id: "weekProblemRecord",
          idField: 'ProblemRecordID'
        }),
        weekProblemRecordFileCreate: $http.wrap({ //创建文件
          offline: true,
          dataType: 1,
          mark: "weekUp",
          _id: 'weekInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          upload: true
        }),
        weekProblemRecordFileQuery: $http.wrap({ //查询文件
          offline: true,
          _id: 'weekInspectionProblemRecordFile',
          idField: function (d) {
            return d.Id || d.ProblemRecordFileID
          },
          fn: function (ProblemRecordFileID) {
            return $http.get($http.url('/api/WeekInspects/SecurityCheckpoint/GetProblemRecordFile/' + ProblemRecordFileID)).then(function (r) {
              if (r && !angular.isArray(r.data)) {
                r.data = [r.data];
                r.data.forEach(function (t) {
                  t.isUpload = true;
                })
              }
              return r;
            });
          },
          dataType: 1,
          filter: function (item, ProblemRecordID) {
            return item.ProblemRecordID == ProblemRecordID;
          }
        }),
        weekProblemRecordFileDelete: $http.wrap({ //删除文件
          offline: true,
          dataType: 1,
          _id: 'weekInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          delete: true
        }),



        safePointGeo: $http.wrap({
          _id: 'PointGeos',
          offline: true,
          idField: 'MeasurePointID',
          dataType: 1,
          fn: function (inspectionId, acceptanceItemId, areaId) {
            return $http.get($http.url('/api/Acceptances/SecurityCheckpoint/GetSecurityPoint/' + inspectionId + '/' + areaId + '/' + acceptanceItemId));
          }
        }),
        pointGeoCreate:$http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "up",
          _id: "PointGeos",
          idField: 'MeasurePointID',
          upload: true
        }),
        pointGeoQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "PointGeos",
          idField: 'MeasurePointID'
        }),
        pointGeoDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "PointGeos",
          idField: 'MeasurePointID'
        }),

        ckPointCreate: $http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "up",
          _id: "ckPoints",
          idField: 'CheckpointID',
          upload: true
        }),
        ckPointQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "ckPoints",
          idField: 'CheckpointID'
        }),
        ckPointDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "ckPoints",
          idField: 'CheckpointID'
        }),
        problemRecordCreate: $http.wrap({ //创建记录
          offline: true,
          dataType: 1,
          upload: true,
          mark: "up",
          _id: "problemRecord",
          idField: 'ProblemRecordID'
        }),
        problemRecordQuery: $http.wrap({ //查询记录
          offline: true,
          dataType: 1,
          filter: function (item, CheckpointID) {
            return item.CheckpointID == CheckpointID;
          },
          _id: "problemRecord",
          idField: 'ProblemRecordID'
        }),
        problemRecordDelete: $http.wrap({// 删除记录
          offline: true,
          dataType: 1,
          delete: true,
          _id: "problemRecord",
          idField: 'ProblemRecordID'
        }),
        ProblemRecordFileCreate: $http.wrap({ //创建文件
          offline: true,
          dataType: 1,
          mark: "up",
          _id: 'secInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          upload: true
        }),
        ProblemRecordFileQuery: $http.wrap({ //查询文件
          offline: true,
          _id: 'secInspectionProblemRecordFile',
          idField: function (d) {
            return d.Id || d.ProblemRecordFileID
          },
          fn: function (ProblemRecordFileID) {
            return $http.get($http.url('/api/Acceptances/SecurityCheckpoint/GetProblemRecordFile/' + ProblemRecordFileID)).then(function (r) {
              if (r && !angular.isArray(r.data)) {
                r.data = [r.data];
                r.data.forEach(function (t) {
                  t.isUpload = true;
                })
              }
              return r;
            });
          },
          dataType: 1,
          filter: function (item, ProblemRecordID) {
            return item.ProblemRecordID == ProblemRecordID;
          }
        }),
        ProblemRecordFileDelete: $http.wrap({ //删除文件
          offline: true,
          dataType: 1,
          _id: 'secInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          delete: true
        }),

        inserFile:$http.wrap({ //删除文件
          fn:function (params) {
            return $http.post($http.url('/api/FileServer/Insert'),params);
          }
        }),
        //获取验收批列表
        getSafeInspections: $http.wrap({
          _id: "safeInspections",
          idField: 'InspectionId',
          dataType: 1,
          offline: true,
          fn: function () {
            return $http.get($http.url('/api/Acceptances/SecurityInfo/GetSecurityInfo/1/Status'));
          }
        }),
        //获取单个验收批
        getSafeInspectionSingle: $http.wrap({
          _id: "safeInspectionSingle",
          idField: 'InspectionId',
          dataType: 1,
          offline: true,
          fn: function (id) {
            return $http.get($http.url('/api/Acceptances/SecurityInfo/GetSecurityInfo/' + id + '/Id'));
          }
        }),
        getAcceptancesRec:$http.wrap({
          offline: true,
          _id:'safeRectification',
          idField: 'RectificationID',
          dataType: 1,
          fn: function (identity,role) {
            var url='/api/Acceptances/SecurityRectification/GetList';
            return $http.get($http.url(url));
          }
        }),
        //获取整改单列表
        getRectifications: $http.wrap({
          offline: true,
          db:function (identity) {
            return 'safeRectification'+(identity?identity:"");
          },
          idField: 'InspectionExtendID',
          dataType: 1,
          fn: function (identity,role) {
            var url='/api/Acceptances/SecurityRectification/GetList';
            if (identity){
              url='/api/'+identity+'/SecurityRectification/GetList';
            }
            return $http.get($http.url(url)).then(function (r) {
              if (r&&angular.isArray(r.data)){
                var batchs=r.data;
                batchs.forEach(function (k) {
                  if ((!role||role=="zb")&&Array.isArray(k.Rectifications)){
                    k.Rectifications= k.Rectifications.filter(function (o) {
                      return o.Status==1||o.Status==8;
                    });
                  }else if(role=="jl"&&Array.isArray(k.Rectifications)){
                    k.Rectifications= k.Rectifications.filter(function (o) {
                      return o.Status==64;
                    });
                  }
                });
              }
              return r;
            });
          }
        }),
        getRectificationsWrap: $http.wrap({
          offline: true,
          db:function (identity) {
            return 'safeRectification'+(identity?identity:"");
          },
          idField: 'InspectionExtendID',
          dataType: 1,
          fn: function (identity,role) {
            var url='/api/Acceptances/SecurityRectification/GetList/GetListByInspectionExtend';
            if (identity){
              url='/api/'+identity+'/SecurityRectification/GetList/GetListByInspectionExtend';
            }
            return $http.get($http.url(url)).then(function (r) {
              if (r&&angular.isArray(r.data)){
                var batchs=r.data;
                batchs.forEach(function (k) {
                  if ((!role||role=="zb")&&Array.isArray(k.Rectifications)){
                    k.Rectifications= k.Rectifications.filter(function (o) {
                      return o.Status==1||o.Status==8;
                    });
                    if (k.Rectifications.length){
                      k.Status=1;
                    }
                  }else if(role=="jl"&&Array.isArray(k.Rectifications)){
                    k.Rectifications= k.Rectifications.filter(function (o) {
                      return o.Status==64;
                    });
                    if (k.Rectifications.length){
                      k.Status=64;
                    }
                  }
                });
              }
              return r;
            });
          }
        }),
        getRectificationSingle: $http.wrap({
          offline: true,
          db:function (RectificationID,identity) {
            return 'safeRectification'+(identity?identity:"");
          },
          // _id: 'safeRectification',
          idField: 'RectificationID',
          dataType: 1,
          filter: function (item, RectificationID) {
            return item.RectificationID == RectificationID;
          },
        }),
        //获取整个单相关的所有信息
        getRecPackage: $http.wrap({
          fn: function (rectificationId,identity) {
            var url='/api/Acceptances/SecurityRectification/GetList/'+rectificationId;
            if (identity){
              url='/api/'+identity+'/SecurityRectification/GetList/'+rectificationId;
            }
            return $http.get($http.url(url));
          }
        }),
        //获取检查点与整改单的关系
        getCkpointRelateWithRec: $http.wrap({
          offline: true,
          _id: "safeCkpointRelateWithRec",
          idField: 'ID',
          filter: function (item, RectificationID) {
            return item.RectificationID == RectificationID;
          },
          dataType: 1
        }),
        //创建检查点与整改单的关系
        CreateCkpointRelateWithRec: $http.wrap({
          offline: true,
          _id: "safeCkpointRelateWithRec",
          idField: 'ID',
          upload: true,
          dataType: 1
        }),
        getSafePointGeo: $http.wrap({
          _id: 'InspectionPoint',
          offline: true,
          idField: 'MeasurePointID',
          dataType: 1,
          fn: function (inspectionId, acceptanceItemId, areaId) {
            return $http.get($http.url('/api/WeekInspects/SecurityCheckpoint/GetSecurityPoint/' + inspectionId + '/' + areaId + '/' + acceptanceItemId));
          }
        }),
        //获取安全验收项
        getSecurityItem: $http.wrap({
          db: function (identity) {
            return "safeItems"+(identity?identity:"");
          },
          idField: 'SpecialtyID',
          dataType: 1,
          fn: function (identity) {
            var url="/api/Acceptances/SecurityItem";
            if (identity){
              url="/api/"+identity+"/SecurityItem";
            }
            return $http.get($http.url(url));
          }
        }),
        //安全验收上传
        safeUp: function (params,identity) {
          var url='/api/Acceptances/SecurityCheckpoint/CheckPointAdapter';
          if (identity){
            url='/api/'+identity+'/SecurityCheckpoint/CheckPointAdapter';
          }
          return $http.post($http.url(url), params);
        },
        //创建安全验收批
        createSafeBatch: function (params) {
          return $http.post($http.url('/api/Acceptances/SecurityInfo/Insert'), params);
        },
        //获取验收区域状态
        getSafeStatus: $http.wrap({
          fn: function (RegionID) {
            return $http.get($http.url('/api/Acceptances/SecurityInfo/GetUserSecurityInfo', {
              RegionID: RegionID
            }));
          }
        }),
        //插入动态安全源，周安全检查，巡检批次
        //WeekInspects:周安全检查
        insertBatchWrap:$http.wrap({
          fn: function (receipt,identity) {
            return $http.post($http.url('/api/'+identity+'/SecurityInfoExtend/insert'), receipt);
          }
        }),
        getBatchWrap:$http.wrap({
          offline: true,
          db:function (identity) {
            return "securityInfo"+ (identity?identity:"");
          },
          idField:"InspectionID",
          dataType: 1,
          fn: function (identity,receipt) {
            return $http.get($http.url('/api/'+identity+'/SecurityInfoExtend/GetList'));
          }
        }),
        getDrawingRelate:$http.wrap({
          db:function (identity) {
            return "relate"+ (identity?identity:"");
          },
          callback:function (result) {
            return {
              data: result.data.Relations
            }
          },
          filter:function (item,identity,areaId) {
              return item.ProjectID==areaId;
          },
          idField:"ProjectID",
          dataType:3,
          fn:function (identity,areaId){
            return $http.get($http.url('/api/'+identity+'/SecurityItem/DrawingRelation/'+areaId+'/areaId')).then(function (result) {
              return {
                data: {
                  ProjectID: areaId,
                  Relations: result.data
                }
              }
            });
          }
        })
      },
      cycleLook:{
        cyclePointGeo: $http.wrap({
          _id: 'cyclePointGeos',
          offline: true,
          idField: 'MeasurePointID',
          dataType: 1,
          fn: function (inspectionId, acceptanceItemId, areaId) {
            return $http.get($http.url('/api/cycle/SecurityCheckpoint/GetSecurityPoint/' + inspectionId + '/' + areaId + '/' + acceptanceItemId));
          }
        }),
        cycleGeoCreate:$http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "cycleUp",
          _id: "cyclePointGeos",
          idField: 'MeasurePointID',
          upload: true
        }),
        cycleGeoQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "cyclePointGeos",
          idField: 'MeasurePointID'
        }),
        cycleGeoDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "cyclePointGeos",
          idField: 'MeasurePointID'
        }),


        cyclePointCreate: $http.wrap({ //创建点
          offline: true,
          dataType: 1,
          mark: "cycleUp",
          _id: "cyclePoints",
          idField: 'CheckpointID',
          upload: true
        }),
        cyclePointQuery: $http.wrap({ //查询点
          offline: true,
          dataType: 1,
          _id: "cyclePoints",
          idField: 'CheckpointID'
        }),
        cyclePointDelete: $http.wrap({ //删除点
          offline: true,
          dataType: 1,
          delete: true,
          _id: "cyclePoints",
          idField: 'CheckpointID'
        }),
        cycleProblemRecordCreate: $http.wrap({ //创建记录
          offline: true,
          dataType: 1,
          upload: true,
          mark: "cycleUp",
          _id: "cycleProblemRecord",
          idField: 'ProblemRecordID'
        }),
        cycleProblemRecordQuery: $http.wrap({ //查询记录
          offline: true,
          dataType: 1,
          filter: function (item, CheckpointID) {
            return item.CheckpointID == CheckpointID;
          },
          _id: "cycleProblemRecord",
          idField: 'ProblemRecordID'
        }),
        cycleProblemRecordDelete: $http.wrap({// 删除记录
          offline: true,
          dataType: 1,
          delete: true,
          _id: "cycleProblemRecord",
          idField: 'ProblemRecordID'
        }),
        cycleProblemRecordFileCreate: $http.wrap({ //创建文件
          offline: true,
          dataType: 1,
          mark: "cycleUp",
          _id: 'cycleInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          upload: true
        }),
        cycleProblemRecordFileQuery: $http.wrap({ //查询文件
          offline: true,
          _id: 'cycleInspectionProblemRecordFile',
          idField: function (d) {
            return d.Id || d.ProblemRecordFileID
          },
          fn: function (ProblemRecordFileID) {
            return $http.get($http.url('/api/cycle/SecurityCheckpoint/GetProblemRecordFile/' + ProblemRecordFileID)).then(function (r) {
              if (r && !angular.isArray(r.data)) {
                r.data = [r.data];
                r.data.forEach(function (t) {
                  t.isUpload = true;
                })
              }
              return r;
            });
          },
          dataType: 1,
          filter: function (item, ProblemRecordID) {
            return item.ProblemRecordID == ProblemRecordID;
          }
        }),
        cycleProblemRecordFileDelete: $http.wrap({ //删除文件
          offline: true,
          dataType: 1,
          _id: 'cycleInspectionProblemRecordFile',
          idField: 'ProblemRecordFileID',
          delete: true
        })
      },
      report:{
        getWrapList:function (identity,params) {
          return $http.post($http.url('/api/'+identity+'/SecurityReport/GetReportInfoExtendList'),params)
        },
        getdetail:function (identity,inspectionExtendId	) {
          return $http.get($http.url('/api/'+identity+'/SecurityReport/GetReportInfoExtendDetailed/'+inspectionExtendId))
        },
        getYsReportList:function (params) {
          return $http.post($http.url('/api/Acceptances/SecurityReport/GetReportInfoExtendList/Acceptances'),params)
        },
        getReportFormMeasure:function (areaId) {
          return $http.get($http.url('/api/ReportFormMeasure?areaId='+areaId))
        },
        getJtReport:function(){
          return $http.get($http.url('/api/ReportFormInspection/jt'));
        },
        getReportFormInspection:function(areaId){
          return $http.get($http.url('/api/ReportFormInspection?areaId='+areaId))
        },getReportFormAssessmentXmb:function(quarter){
            return $http.get($http.url('/api/ReportFormAssessment/xmb/'+quarter))
        },getReportFormAssessmentZb:function(quarter){
          return $http.get($http.url('/api/ReportFormAssessment/zb/'+quarter))
        },getReportFormAssessmentJl:function(quarter){
          return $http.get($http.url('/api/ReportFormAssessment/jl/'+quarter))
        },getReportFormAssessmentClass:function(quarter){
          return $http.get($http.url('/api/ReportFormAssessment/AssessmentClass/'+quarter))
        }, getReportFormAssessmentTrial:function(areaId){
          return $http.get($http.url('/api/ReportFormAssessment/AssessmentTrial/'+areaId))
        }, getReportFormAssessmentRate:function(){
          return $http.get($http.url('/api/ReportFormAssessment/AssessmentRate'))
        },
        getReportFormSummary:function () {

        }
        // /api/ReportFormSummary
      },
      self:{
        insertInspection:function (info,selfCheckType) {
          return $http.post($http.url('/api/'+selfCheckType+'/SelfCheckInfo'),info)
        },
        getInspection:$http.wrap ({
          offline:true,
          dataType:3,
          model:2,
          filter:function (item,type) {
            return item.identity==type+"info";
          },
          _id: 'selfZbInfo',
          idField: "identity",
          fn:function (type) {
            return $http.get($http.url('/api/'+type+'/SelfCheckInfo')).then(function (r) {
              return {
                data:{
                  identity:type+"info",
                  data:r.data
                }
              }
            })
          }
        }),
        getBaseInfo:$http.wrap ({
          fn:function (type,inspectionId) {
            return $http.get($http.url('/api/'+type+'/SelfCheckInfo/baseInfo',{inspection:inspectionId}));
          }
        }),
        fileQuery:function (fileId) {
          return $http.get($http.url('/api/FileServer/Query/'+fileId+'/Base64'));
        },
        self_upload:function (type,params) {
          return $http.post($http.url('/api/'+type+'/SelfCheckInfo/AreaInfo'),params);
        },
        getSafePointGeo: $http.wrap({
          _id: 'InspectionPoint',
          offline: true,
          idField: 'MeasurePointID',
          dataType: 1,
          fn: function (type,inspectionId) {
            return $http.get($http.url('/api/'+type+'/SelfCheckInfo/getSelfPoint',{inspectionId:inspectionId}));
          }
        }),
        updateStatus: function (type,inspectionId) {
          return $http.put($http.url('/api/'+type+'/SelfCheckInfo/UpdateStatus',{inspectionId:inspectionId}));
        },
        zb:{
          pointCreate: $http.wrap({ //创建点
            offline: true,
            dataType: 1,
            mark: "selfZbUp",
            _id: "selfZbPoints",
            idField: 'Id',
            upload: true
          }),
          pointQuery: $http.wrap({ //查询点
            offline: true,
            dataType: 1,
            _id: "selfZbPoints",
            idField: 'Id'
          }),
          pointDelete: $http.wrap({ //删除点
            offline: true,
            dataType: 1,
            delete: true,
            _id: "selfZbPoints",
            idField: 'Id'
          }),
          problemRecordCreate: $http.wrap({ //创建记录
            offline: true,
            dataType: 1,
            upload: true,
            mark: "selfZbUp",
            _id: "selfZbProblemRecord",
            idField: 'Id'
          }),
          problemRecordQuery: $http.wrap({ //查询记录
            offline: true,
            dataType: 1,
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID;
            },
            _id: "selfZbProblemRecord",
            idField: 'Id'
          }),
          problemRecordDelete: $http.wrap({// 删除记录
            offline: true,
            dataType: 1,
            delete: true,
            _id: "selfZbProblemRecord",
            idField: 'Id'
          }),
          problemRecordFileCreate: $http.wrap({ //创建文件
            offline: true,
            dataType: 1,
            mark: "selfZbUp",
            _id: 'selfZbInspectionProblemRecordFile',
            idField: 'Id',
            upload: true
          }),
          problemRecordFileQuery: $http.wrap({ //查询文件
            offline: true,
            _id: 'selfZbInspectionProblemRecordFile',
            idField: function (d) {
              return d.Id || d.ProblemRecordFileID
            },
            dataType: 1,
            filter: function (item, ProblemRecordID) {
              return item.ProblemRecordID == ProblemRecordID;
            }
          }),
          problemRecordFileDelete: $http.wrap({ //删除文件
            offline: true,
            dataType: 1,
            _id: 'selfZbInspectionProblemRecordFile',
            idField: 'Id',
            delete: true
          })
        },
        safe:{
          pointCreate: $http.wrap({ //创建点
            offline: true,
            dataType: 1,
            mark: "selfSafeUp",
            _id: "selfSafePoints",
            idField: 'Id',
            upload: true
          }),
          pointQuery: $http.wrap({ //查询点
            offline: true,
            dataType: 1,
            _id: "selfSafePoints",
            idField: 'Id'
          }),
          pointDelete: $http.wrap({ //删除点
            offline: true,
            dataType: 1,
            delete: true,
            _id: "selfSafePoints",
            idField: 'Id'
          }),
          problemRecordCreate: $http.wrap({ //创建记录
            offline: true,
            dataType: 1,
            upload: true,
            mark: "selfSafeUp",
            _id: "selfSafeProblemRecord",
            idField: 'Id'
          }),
          problemRecordQuery: $http.wrap({ //查询记录
            offline: true,
            dataType: 1,
            filter: function (item, CheckpointID) {
              return item.CheckpointID == CheckpointID;
            },
            _id: "selfSafeProblemRecord",
            idField: 'Id'
          }),
          problemRecordDelete: $http.wrap({// 删除记录
            offline: true,
            dataType: 1,
            delete: true,
            _id: "selfSafeProblemRecord",
            idField: 'Id'
          }),
          problemRecordFileCreate: $http.wrap({ //创建文件
            offline: true,
            dataType: 1,
            mark: "selfSafeUp",
            _id: 'selfSafeInspectionProblemRecordFile',
            idField: 'Id',
            upload: true
          }),
          problemRecordFileQuery: $http.wrap({ //查询文件
            offline: true,
            _id: 'selfSafeInspectionProblemRecordFile',
            idField: function (d) {
              return d.Id || d.ProblemRecordFileID
            },
            dataType: 1,
            filter: function (item, ProblemRecordID) {
              return item.ProblemRecordID == ProblemRecordID;
            }
          }),
          problemRecordFileDelete: $http.wrap({ //删除文件
            offline: true,
            dataType: 1,
            _id: 'selfSafeInspectionProblemRecordFile',
            idField: 'Id',
            delete: true
          })
        }

      }
    });
  }
})();

(function ()
{
    'use strict';

    config.$inject = ["$stateProvider", "$translatePartialLoaderProvider", "msNavigationServiceProvider", "apiProvider"];
    angular
        .module('app.sample', [])
        .config(config);

    /** @ngInject */
    function config($stateProvider, $translatePartialLoaderProvider, msNavigationServiceProvider,apiProvider)
    {
      // State
      $stateProvider
          .state('app.sample', {
              url    : '/sample',
              views  : {
                  'content@app': {
                      templateUrl: 'app/main/sample/sample.html',
                      controller : 'SampleController as vm'
                  }
              },
              resolve: {
                  SampleData: ["apiResolver", function (apiResolver)
                  {
                      return apiResolver.resolve('sample@get');
                  }]
              }
          });

      // Translation
      $translatePartialLoaderProvider.addPart('app/main/sample');

      //// Navigation
      //msNavigationServiceProvider.saveItem('fuse', {
      //    title : 'SAMPLE',
      //    group : true,
      //    weight: 1
      //});
      //
      //msNavigationServiceProvider.saveItem('fuse.sample', {
      //    title    : 'Sample',
      //    icon     : 'icon-tile-four',
      //    state    : 'app.sample',
      //    /*stateParams: {
      //        'param1': 'page'
      //     },*/
      //    translate: 'SAMPLE.SAMPLE_NAV',
      //    weight   : 1
      //});

      var $http = apiProvider.$http;
      apiProvider.register('sample',$http.resource('app/data/sample/sample.json'));

    }
})();

(function ()
{
    'use strict';

    SampleController.$inject = ["SampleData"];
    angular
        .module('app.sample')
        .controller('SampleController', SampleController);

    /** @ngInject */
    function SampleController(SampleData)
    {
        var vm = this;
 console.log('SampleController')
        // Data
        vm.helloText = SampleData.data.helloText;

        // Methods

        //////////
    }
})();

/**
 * Created by jiuyuong on 2016/9/26.
 */
(function (angular, undefined) {
  'use strict';

  config.$inject = ["apiProvider"];
  angular
    .module('app.plan')
    .config(config);

  /** @ngInject */
  function config(apiProvider) {
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('plan',{
      /** /api/TaskTemplates 模板 **/
      TaskTemplates:{
        GetList:function(param){
          return $http.get($http.url('/api/TaskTemplates',{Skip:param.Skip,Limit:param.Limit,ProjectId:param.ProjectId}));
        },
        Create:function (param) {
          return $http.post('/api/TaskTemplates', param)
        },
        getItem:function(id){
          return $http.get($http.url('/api/TaskTemplates/'+id));
        },
        update:function(param){
          return $http.put('/api/TaskTemplates/'+param.Id,param);
        },
        delete:function(id){
          return $http.delete('/api/TaskTemplates/'+id);
        },
        copyTemplate:function(id){
          return $http.put($http.url('/api/TaskTemplates/'+id+'/Copy'))
        }
      },
      TaskFlow:{
        post:function(param){
          return $http.post($http.url('/api/TaskLibrarys/'+param.TaskLibraryId+'/TaskFlows'),param)
        },
        getTaskFlow:function(param){
          return $http.get($http.url('/api/TaskLibrarys/',{Type:param.type,Level:param.level,Skip:param.Skip,Limit:param.Limit}))
        },
        postTaskFlow:function(param){
          return $http.post('/api/TaskLibrarys', param)
        },
        //getFlowById:function(taskFlowId){
        //  return $http.get($http.url('/api/TaskLibrarys/'+taskFlowId))
        //},
        updateFlowById:function(taskFlowId){
          return $http.put($http.url('/api/TaskLibrarys/'+taskFlowId))
        },
        //getFlowTree:function(taskFlowId){
        //  return $http.get($http.url('/api/TaskLibrarys/'+taskFlowId+'/Tree'))
        //},
        deleteFlow:function (id) {
          return $http.delete('/api/TaskFlows/'+id)
        },
        resetTaskFlowRoles:function(id,data){
          return $http.post($http.url('/api/TaskFlows/'+id+'/TaskFlowRoles/Reset'),data)
        },
        resetTaskFlowRolesByType:function(id,type,data){
          return $http.post($http.url('/api/TaskFlows/'+id+'/TaskFlowRoles/Reset/'+type),data)
        },
        getRoleByFlowId:function(id){
          return $http.get($http.url('/api/TaskFlows/'+id+'/TaskFlowRoles'))
        },
        resetTaskFlow:function(id,data){
          return $http.post($http.url('/api/TaskFlows/'+id+'/TaskLibrarys/Reset'),data)
        },
        getSubTasks:function(id){
          return $http.get($http.url('/api/TaskFlows/'+id+'/TaskLibrarys'))
        },
        updateTaskById:function(data){
          return $http.put($http.url('/api/TaskFlows/'+data.Id),data)
        }
      },
      BuildPlan:{
        getList:function(param){
          return $http.get($http.url('/api/BuildingPlans',{status:param.status,Skip:param.Skip,Limit:param.Limit}))
        },
        post:function(params){
          return $http.post($http.url('/api/BuildingPlans'),params)
        },
        update:function (id,params) {
          return $http.put($http.url('/api/BuildingPlans/'+id),params)
        },
        getBuildPlanRoleUsers:function(id){
          return $http.get($http.url('/api/BuildingPlans/'+id+'/BuildingPlanRoleUsers'))
        },
        getBuildPlanFlowTree:function(id){
          return $http.get($http.url('/api/BuildingPlans/'+id+'/FlowTree'))
        },
        flowTasksReset:function (id,items) {
          return $http.post('/api/BuildingPlans/'+id+'/BuildingPlanFlowTasks/Reset',items)
        },
        getBuildingPlanRoles:function (id) {
          return $http.get('/api/BuildingPlans/'+id+'/BuildingPlanRoles')
        },
        getBuildingPlanRoleUsers:function(id){
          return $http.get('/api/BuildingPlans/'+id+'/BuildingPlanRoleUsers')
        },
        buildingRolesReset:function (id,items) {
          return $http.post('/api/BuildingPlans/'+id+'/BuildingPlanRoleUsers/Reset',items)
        },
        generate:function (id) {
          return $http.post('/api/BuildingPlans/'+id+'/Generate',{id:id});
        },
        deleteBuildPlan:function(id){
          return $http.delete('/api/BuildingPlans/'+id);
        },
        deleteTaskLibById:function(id,buildingPlanFlowId){
          return $http.delete($http.url('/api/BuildingPlans/'+id+'/BuildingPlanFlows/'+buildingPlanFlowId))
        },
        getMileStone:function(id){
          return $http.get($http.url('/api/BuildingPlans/'+id+'/Milestones'))
        },
        setMileStoneTime:function(pid,id,time){
          return $http.get($http.url('/api/BuildingPlans/'+pid+'/Milestones/'+id+'/UpdateCheck',{MilestoneTime:time}))
        },
        updateMileStone:function(pid,id,params){
          return $http.put($http.url('/api/BuildingPlans/'+pid+'/Milestones/'+id),params)
        },
        adjustPlan:function(id,params){
          return $http.post($http.url('/api/BuildingPlans/'+id+'/Adjust'),params)
        },
        swapOrder:function(id,data){
          return $http.put($http.url('/api/BuildingPlans/'+id+'/BuildingPlanFlows/SwapOrder'),data)
        },
        statisticsReport:function(){
          return $http.get('/api/BuildingPlans/GroupStatisticsReport');
        },
        personPlans:function(){
          return $http.get('/api/BuildingPlans/PersonalTasks')
        },
        mainProcess:function(id){
          return $http.get('/api/BuildingPlans/'+id+'/MainProgress')
        },
        startInsert:function(id,taskId,startTime){
          return $http.post('/api/BuildingPlans/'+id+'/Tasks/'+taskId+'/StartPlan',{StartTime:startTime})
        },
        getGantt:function(query){
          return $http.get($http.url('/api/BuildingPlans/'+query.Source+'/Tasks',query))
        },
        endTask:function(id,query){
          return $http.post($http.url('/api/BuildingPlans/'+id+'/Tasks/'+query.TaskId+'/End'),query)
        },
        //开启精装修
        startRenovation:function(id){
          return $http.put($http.url('/api/BuildingPlans/'+id+'/StartUpRenovation'))
        }
      },
      MileStone:{
        create:function(data){
          return $http.post($http.url('/api/MileStones'),data)
        },
        queryByTaskId:function (taskId) {
          return $http.get('/api/Milestones/ByTaskLibraryId',{TaskLibraryId:taskId});
        },
        query:function(params){
          return $http.get($http.url('/api/MileStones',{RelatedFlowId:params.RelatedFlowId}))
        },
        update:function(Id,data){
          return $http.put($http.url('/api/MileStones/'+Id),data)
        },
        delete:function(id){
          return $http.delete($http.url('/api/MileStones/'+id));
        }
      },
      /** /api/TaskLibrary 任务 **/
      TaskLibrary:{
        create:function (taskLibrary) {
          return $http.post('/api/TaskLibrarys',taskLibrary);
        },
        update:function (taskLibrary) {
          var item= angular.extend(taskLibrary,{Id:taskLibrary._taskFlowId});

          return $http.put('/api/TaskLibrarys/'+taskLibrary._taskFlowId,item);
        },
        delete:function(id){
          return $http.delete($http.url('/api/TaskLibrarys/'+id))
        },
        GetList:function(param){
          return $http.get($http.url('/api/TaskLibrarys',param));
        },
        getItem:function(id){
          return $http.get($http.url('/api/TaskLibrarys/'+id));
        },
        copyTaskLibrary:function(id){
          return $http.put($http.url('/api/TaskLibrarys/'+id+'/Copy'));
        },
        /**
         *
         * @param taskId 任务ID
         * @returns {object}
         */
        getTaskFlow:function (taskId) {
          return $http.get($http.url('/api/TaskLibrarys/'+taskId+'/Tree'));
        }
      },
      compensate:{
        createBc:function (values) {
          return $http.post('/api/Compensates', values);
        },
        getList:function(param){
          return $http.get($http.url('/api/Compensates',{Skip:param.Skip,Limit:param.Limit}));
        },
        getCompensate:function(id){
          return $http.get($http.url('/api/Compensates/'+id));
        },
        putCompensate:function(data){
          return $http.put('/api/Compensates/'+data.CompensateId,data);
        },
        delete:function(id){
          return $http.delete('/api/Compensates/'+id);
        },
        getBaseRegion:function(){
          return $http.get($http.url('/api/SysDataDictionarys?ddicType=SXT.EMBD.Base.Region'));
        },
        postAreaReset:function (param) {
          return $http.post('/api/Compensates/' + param.id + '/Area/Reset', param.areaIds);
        }
      },
      UserGroup:{
        create:function (data) {
          return $http.post('/api/UserGroup',data);
        },
        query:function (param) {
          return $http.get($http.url('/api/UserGroup',param))
        },
        //reset:function(param){
        //  return $http.post($http.url('/api/TaskFlowRoles/Reset'),param)
        //}
      },
      TaskFlowRole:{
        queryByFlowId:function (flowId) {
          return $http.get('/api/TaskFlowRoles/'+flowId);
        }
      },
      /**  /api/SysDataDictionary 获取集字典 **/
      SysDataDictionary:{
        Get:function(ddicType){
          var param = {Skip:0,Limit:100,ddicType:ddicType};
          return $http.get($http.url('/api/SysDataDictionarys',param));
        }
      },
      procedure:{
        query:function(){
          //return $http.get($http.url('/api/WPAcceptanceApi/GetWPAcceptanceInfo'));
          return $http.get($http.url('/api/WPAcceptanceApi/GetWPAcceptances'));
        }
      },
      MeasureInfo:{
        query:function(){
          return $http.get($http.url('/api/MeasureInfo/GetMeasureItemInfo'))
        }
      },
      //fileservice
      fileService:{
        get:function(id){
          return $http.get($http.url('/api/FileServer/Query/'+id+'/Base64'))
        }
      },
      Task:{
        query:function (query) {
          return $http.get($http.url('/api/Task',query));
        },
        start:function (taskId,force,actualStartTime) {
          return $http.post('/api/Task/'+taskId+'/Start', {
            "TaskId": taskId,
            "ActualStartTime":actualStartTime,
            "Force": force || false
          });
        },
        end:function (taskId,force,actualEndTime,EndDescription,PhotoFile,PhotoFileName) {
          return $http.post('/api/Task/'+taskId+'/End', {
            "TaskId": taskId,
            "ActualEndTime":actualEndTime,
            "Force": force || false,
            "EndDescription":EndDescription,
            "PhotoFileName":PhotoFileName,
            "PhotoFile":PhotoFile
          });
        },
        Categories:{
          query:function () {
            return $q(function (resolve,reject) {
              resolve({
                data:[
                  {
                    name:'商业',
                    children:[
                      {
                        name:'多层办公楼、酒店'
                      },
                      {
                        name:'高层办公楼、酒店'
                      },{
                        name:'商场'
                      }
                    ]
                  },
                  {name:'住宅',children:[
                    {name:'别墅'},
                    {name:'多层'},
                    {name:'小高层'},
                    {name:'高层'},
                    {name:'超高层'}
                  ]},
                  {name:'关键节点',children:[
                    {name:'基坑支护'},
                    {name:'基坑土方'},
                    {name:'桩基础'},
                    {name:'基础土方'},
                    {name:'结构基础'},
                    {name:'落架前工作'},
                    {name:'落架'},
                    {name:'屋面结构'},
                    {name:'内外饰面与落架'},
                    {name:'公装/室外'}
                  ]},
                  {
                    name:'其它'
                  }
                ]
              })
            })
          }
        }
      },
      users:{
        query:function(){
          return $http.get($http.url('/api/User'));
        },
        queryById:function(params){
          return $http.get($http.url('/api/User/ByProjectId',params))
        }
      },
      Project:{
        query:function (buildingId) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectBuildingFloors',{buildingId:buildingId}));
        }
      }

    });
  }
})(angular,undefined);

/**
 * Created by HuangQingFeng on 2016/11/28.
 */
(function(angular,undefined){
  'use strict';
  config.$inject = ["apiProvider"];
  angular
    .module('app.pileFoundation')
    .config(config);

  /** @ngInject */
  function config(apiProvider){
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('pileFoundation', {
      pileFoundation: {
        save: function (data) {
          return $http.post('/api/PileFoundation/SaveAsync', data);
        },
        getPileFoundationByRegionTreeId:function (args) {
          return $http.get($http.url('/api/PileFoundation/GetPileFoundationByRegionTreeId',{regionTreeId:args.regionTreeId}));
        },
        getPileFoundationList:function (args) {
          return $http.get($http.url('/api/PileFoundation/GetPileFoundationList',{regionTreeId:args.regionTreeId,status:args.status}));
        },
        createPileFoundationArea: function (data) {
          return $http.post('/api/PileFoundation/CreatePileFoundationArea', data);
        },
        updatePileFoundationArea: function (id,data) {
          return $http.put('/api/PileFoundation/UpdatePileFoundationArea/' + id, data);
        },
        delete:function (id) {
          return $http.delete('/api/PileFoundation/' + id);
        }
      }
    })
  }
})(angular,undefined);

/**
 * Created by lss on 2016/9/8.
 */
(function ()
{
  'use strict';

  config.$inject = ["msNavigationServiceProvider", "$stateProvider", "$mdIconProvider"];
  angular
    .module('app.pcReport', [
      'app.pcReport_sl',
      'app.pcReport_ys',
      'app.pcReport_pg',
      'bw.paging',
      'app.pcReport_yf',
      'app.pcReport_cycle',
      'app.pcReport_week',
      'app.pcReport_safeys',
      'app.insideYs'
    ])
    .config(config);
  /** @ngInject */
  function config(msNavigationServiceProvider,$stateProvider,$mdIconProvider)
  {
    $stateProvider
      .state('app.pcReport_hz',{
        title:"汇总报表",
        url:'/pcReport_hz',
        noBack:true,
        sendBt:false,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/hzReport.html',
            controller : 'hzReportController as vm',
          }
        }
      })
      .state('app.pcReport_main',{
        title:"报表中心",
        noBack:false,
        sendBt:false,
        showgrzx:true,
        url:'/pcReport_main',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/pcReportMain.html',
            controller : 'pcReportMainController as vm',
          }
        }
      })
      .state('app.pcReport_bd',{
        title:"区域",
        noBack:true,
        sendBt:false,
        url:'/pcReport_bd/{projectId}/{projectName}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/build.html',
            controller : 'buildController as vm',
          }
        }
      })
      .state('app.progress',{
        url:'/progress/{projectId}/{projectName}',
        noBack:true,
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/progress.html',
            controller : 'progressController as vm',
          }
        }
      })
      .state('app.pcReport_bdd',{
        title:"验收状态",
        noBack:true,
        sendBt:false,
        url:'/pcReport_bdd/{regionID}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/buildDetail.html',
            controller : 'buildDetailController as vm',
          }
        }
      })
      .state('app.pcReport_scbdd',{
        title:"实测状态",
        noBack:true,
        sendBt:false,
        url:'/pcReport_scbdd/{regionID}',
        views:{
          'content@app':{
            templateUrl: 'app/main/pcReport/scBuildDetail.html',
            controller : 'scBuildDetailController as vm',
          }
        }
      })





    // Navigation
    msNavigationServiceProvider.saveItem('xh', {
      title : '星河集团',
      group : true,
      weight: 1
    });
    msNavigationServiceProvider.saveItem('xh.pcenter', {
      title: '主页',
      state: 'app.xhsc.home',
      icon:'icon-account',
      weight:1
    });

    msNavigationServiceProvider.saveItem('xh.ysReport', {
      title: '验收',
      icon : 'icon-poll',
      weight:1
    });
    msNavigationServiceProvider.saveItem('xh.ysReport.yshzReport', {
      title: '汇总报表',
      state: 'app.pcReport_hz',
      weight:1
    });

    msNavigationServiceProvider.saveItem('xh.ysReport.gxysReport', {
      title: '工序验收报表',
      state: 'app.pcReport_ys_gx',
      weight:2
    });

    msNavigationServiceProvider.saveItem('xh.ysReport.scslReport', {
      title: '实测实量报表',
      state: 'app.pcReport_sl_sc',
      weight:3
    });

    msNavigationServiceProvider.saveItem('xh.pgReport', {
      title: '评估',
      icon  : 'icon-tile-four',
      weight:2
    });
    msNavigationServiceProvider.saveItem('xh.pgReport.xcpgReport', {
      title: '现场评估',
      weight:1,
      state:'app.pcReport_pg'
    });
  }
})();

/**
 * Created by lss on 2016/10/10.
 */
/**
 * Created by lss on 2016/10/7.
 */
(function(){
  'use strict';

  scBuildDetailController.$inject = ["$scope", "$stateParams", "$mdSidenav", "api", "$q", "utils", "remote", "$timeout", "cookie"];
  angular
    .module('app.pcReport')
    .controller('scBuildDetailController', scBuildDetailController);

  /** @ngInject */
  function scBuildDetailController($scope,$stateParams,$mdSidenav,api,$q,utils,remote,$timeout,cookie)
  {
    function buildToggler(navID) {
      return function() {
        $mdSidenav(navID)
          .toggle()
          .then(function () {
          });
      }
    }
    var vm = this;
    vm.loading=true;
    $scope.gxSelected=[];
    vm.build={};
    var  regionID=$stateParams.regionID;

    function  setgxSelectedValue(procedures){
      if (!angular.isArray(cookie.sc)||!cookie.sc.length){
        cookie.sc=[];
        return;
      }
      var t;
      cookie.sc.forEach(function(k){
        t= procedures.find(function(m){
          return m.AcceptanceItemID== k.AcceptanceItemID;
        })
        if (t){
          t.checked=true;
          $scope.gxSelected.push(t);
        }
      });
    }

    var pro=[
      remote.Project.getRegionAndChildren(regionID),
      remote.Procedure.getMeasureMosaic(regionID),
      remote.Assessment.GetMeasureItemInfoByAreaID(regionID)
    ]
    function render(){
      $timeout(function(){
        if (!cookie.sc||!cookie.sc.length){
          vm.openGx();
          return;
        }
        vm.query();
      });
    }

    $q.all(pro).then(function(res){
      vm.build.regions=res[0].data;
      var b=vm.build.regions.find(function(k){
        return k.RegionType==4;
      })
      vm.build.name=b? b.RegionName:"";
      vm.build.status=res[1].data;
      var r=res[2];
      if (r.data&&angular.isArray(r.data.data)){
        $scope.procedures= r.data.data;
        setgxSelectedValue($scope.procedures);
      }
      render();
      vm.loading=false;
    }).catch(function(){
      vm.loading=false;
      render();
    });


    vm.query = function () {
      vm.build.query();
    };

    $scope.$watch('vm.build.isOpen',function () {
      if (!vm.build.isOpen&&vm.build.isOpen!==false){
        return;
      }
      if (!vm.build.isOpen){
        if (!$scope.gxSelected.length){
          utils.alert('请选择要显示的工序').then(function () {
            vm.openGx();
          });
          return;
        }
        if ($scope.gxSelected.length>4){
          utils.alert('最多只能选择4个实测项').then(function () {
            vm.openGx();
          })
          return;
        }
        vm.query();
      }
    })

    $scope.remove=function(item){
      $timeout(function(){
        if (item.checked){
          $scope.gxSelected.push(item)
        }else {
          var index=$scope.gxSelected.indexOf(item);
          if (index>-1){
            $scope.gxSelected.splice(index,1);
          }
        }
        cookie.sc= $scope.gxSelected;
      })
    }
    vm.openGx = buildToggler('procedure_right');
  }
})();

/**
 * Created by shaoshun on 2017/3/17.
 */
/**
 * Created by lss on 2016/10/10.
 */
/**
 * Created by lss on 2016/10/7.
 */
(function(){
  'use strict';

  progressController.$inject = ["$scope", "$stateParams", "$rootScope", "$mdSidenav", "api", "$q", "utils", "remote", "$timeout", "cookie", "authToken"];
  angular
    .module('app.pcReport')
    .controller('progressController', progressController);

  /** @ngInject */
  function progressController($scope,$stateParams,$rootScope,$mdSidenav,api,$q,utils,remote,$timeout,cookie,authToken)
  {
    var vm = this;
    var projectName=$stateParams.projectName;
    var projectId=$stateParams.projectId;
    $rootScope.title=projectName;
    var token=authToken.getToken();
    vm.href="www/index.html?projectId="+projectId+"&token="+token;
  }
})();

/**
 * Created by lss on 2016/9/12.
 */
/**
 * Created by lss on 2016/8/16.
 */
(function(){
  'use strict';

  pcReportMainController.$inject = ["remote", "$state", "$q", "utils", "$mdSidenav", "$rootScope", "$mdDialog", "api", "xhscService"];
  angular
    .module('app.pcReport')
    .controller('pcReportMainController',pcReportMainController);

  /** @ngInject */
  function pcReportMainController(remote,$state,$q,utils,$mdSidenav,$rootScope,$mdDialog,api,xhscService ){
    var vm=this;
    api.setNetwork(0).then(function(){
      function show(ok,cancel,level) {
        function empty() {
          $mdDialog.hide();
        }
        function no() {
          $mdDialog.cancel();
        }
        ok=ok?ok:empty;
        cancel=cancel?cancel:empty;
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.ok=function () {
              if ($scope.level&&$scope.level>=7){
                ok($scope.currentBuild);
              }else {
                ok($scope.currentArea);
              }
            };
            $scope.currentBuild=null;
            $scope.level=level;
            $scope.cancel=cancel;
            xhscService.getRegionTreeOffline("",7,1).then(function (r) {
              $scope.projects=r;
              if(angular.isArray($scope.projects)&&$scope.projects.length){
                $scope.currentProject=$scope.projects[0];
                if ($scope.currentProject.Children.length){
                  $scope.currentArea=$scope.currentProject.Children[0];
                }
              }
            })

            $scope.$watch("currentArea",function (v) {
              if (v&&v.Children){
                $scope.builds=$.extend(true,[],v.Children);
                 $scope.currentBuild= $scope.builds[0];
              }
            })

          }],
          templateUrl: 'app/main/pcReport/showTemplate.html',
          parent: angular.element(document.body),
          clickOutsideToClose: true,
          fullscreen: false
        })
      }

      function pg_show(ok,cancel) {
        function empty() {
          $mdDialog.hide();
        }

        ok=ok?ok:empty;
        cancel=cancel?cancel:empty;
        $mdDialog.show({
          controller: ['$scope', 'utils', '$mdDialog', function ($scope, utils, $mdDialog) {
            $scope.cancel=cancel;
            $scope.yearArray = [];
            for (var i = 0; i < 5; i++)
            {
              $scope.yearArray.push({id:(2015+i),value:(2015+i)});
            }

            $scope.ok=function () {
              if ($scope.year){
                ok($scope.year.value);
              }
            };
          }],
          templateUrl: 'app/main/pcReport/pg_showTemplate.html',
          parent: angular.element(document.body),
          clickOutsideToClose: true,
          fullscreen: false
        })
      }

      vm.scBuild=function () {
        show(function (area) {
          $mdDialog.hide();
          $state.go("app.pcReport_sl_jt",{areaId:area.RegionID});
        },null,7);
      }

      vm.scProject=function () {
        show(function (area) {
          $mdDialog.hide();
          $state.go("app.pcReport_sl_jt",{areaId:area.RegionID});
        });
      }

      vm.ysProject=function () {
        show(function (area) {
          $mdDialog.hide();
          $state.go("app.pcReport_ys_hz",{areaId:area.RegionID});
        });
      }

      vm.pg_xmb_zb_jl=function(stateCmd){
        pg_show(function(quarter){
          $mdDialog.hide();
          $state.go(stateCmd,{quarter:quarter});
        });
      }
      vm.pg_xmb_zb_class=function(stateCmd){
        pg_show(function(quarter){
          $mdDialog.hide();
          $state.go(stateCmd,{quarter:quarter});
        });
      }

      vm.pg_trial=function () {
        show(function (area) {
          $mdDialog.hide();
          $state.go("app.pcReport_pg_trial",{areaId:area.RegionID});
        },null,4);
      }
    })
  }
})();
/**
 * Created by lss on 2016/10/8.
 */

/**
 * Created by lss on 2016/9/12.
 */
/**
 * Created by lss on 2016/8/16.
 */
(function() {
    'use strict';

    hzReportController.$inject = ["remote", "$state", "$q", "utils", "$mdDialog", "$mdSidenav", "$rootScope", "$scope", "api", "sxt"];
    angular
        .module('app.pcReport')
        .controller('hzReportController', hzReportController);

    /** @ngInject */
    function hzReportController(remote, $state, $q, utils, $mdDialog, $mdSidenav, $rootScope, $scope, api, sxt) {
        var vm = this;
        vm.rendered = false;
        //$mdDialog.show({
        //  controller: ['$scope','utils','$mdDialog',function ($scope,utils,$mdDialog) {
        //  }],
        //  template: '<md-dialog   ng-cloak><md-dialog-content layout="column"> <md-progress-circular class="md-accent md-hue-1" md-diameter="20" md-mode="indeterminate"></md-progress-circular><p style="padding-left: 6px;">数据加载中...</p></md-dialog-content></md-dialog>',
        //  parent: angular.element(document.body),
        //  clickOutsideToClose:false,
        //  fullscreen: false
        //});

        var mobileDetect = new MobileDetect(window.navigator.userAgent);
        vm.isMobile = mobileDetect.mobile();
        vm.selecte = function(item) {
            vm.current = item;
            $mdSidenav("reportDT")
                .toggle()
        }
        vm.pageAction = function(info, page, pageSize, total) {
            console.log(info + '-' + page);
        }
        vm.goDetail = function(flag) {
            switch (flag) {
                case 0:
                    $rootScope.gxParams = {
                        secSelected: [{
                            RegionID: vm.current.ProjectID,
                            RegionName: vm.current.ProjectName
                        }],
                        gxSelected: []
                    };
                    $state.go("app.pcReport_ys_rp");
                    break;
                case 1:
                    $state.go("app.pcReport_sl_rp", {
                        scSelected: "",
                        secSelected: vm.current.ProjectID
                    });
                    break;
            }
        }
        remote.Report.Summary().then(function(r) {
            vm.report = r.data ? r.data : [];
            vm.rendered = true;
            //$mdDialog.hide();
        }).catch(function() {
            vm.rendered = true;
            vm.report = [];
            //$mdDialog.cancel();
        });


        vm.printBatchCount = function() {
            var html = $("#divReport").html();
            $('#export').val(html);
        }

    }

})();
/**
 * Created by lss on 2016/10/7.
 */
(function(){
  'use strict';

  buildDetailController.$inject = ["$scope", "$stateParams", "$mdSidenav", "api", "$q", "utils", "remote", "$timeout", "cookie"];
  angular
    .module('app.pcReport')
    .controller('buildDetailController', buildDetailController)
    .constant('cookie', {})
  /** @ngInject */
  function buildDetailController($scope,$stateParams,$mdSidenav,api,$q,utils,remote,$timeout,cookie)
  {
    function buildToggler(navID) {
      return function() {
        $mdSidenav(navID)
          .toggle()
          .then(function () {
          });
      }
    }

    var vm = this;
    vm.loading=true;
    $scope.gxSelected=[];
    vm.build={};
    vm.showTab=function(item){
      if (!item.SpecialtyChildren||!item.SpecialtyChildren.length){
          return false;
      }
      var gx= item.SpecialtyChildren;
      for (var  i=0;i<gx.length;i++){
        if (gx[i].WPAcceptanceList&&gx[i].WPAcceptanceList.length){
          return true;
        }
      }
      return false;
    }
    var  regionID=$stateParams.regionID;

    function  setgxSelectedValue(procedures){
      if (!angular.isArray(cookie.gx)||!cookie.gx.length){
        cookie.gx=[];
        return;
      }
      var arr=[];
      procedures.forEach(function(m){
        m.SpecialtyChildren.forEach(function(n){
          n.WPAcceptanceList.forEach(function(k){
            arr.push(k);
          });
        })
      });
      var t;
      cookie.gx.forEach(function(k){
        t= arr.find(function(m){
          return m.AcceptanceItemID== k.AcceptanceItemID;
        })
        if (t){
          t.checked=true;
          $scope.gxSelected.push(t);
        }
      });
    }
    var pro=[
      remote.Project.getRegionAndChildren(regionID),
      remote.Procedure.getRegionStatusEx(regionID),
      remote.Procedure.queryProcedure()
    ]
    function render(){
      $timeout(function(){
        if (!cookie.gx||!cookie.gx.length){
          vm.openGx();
          return;
        }
        vm.query();
      });
    }

    $q.all(pro).then(function(res){
      vm.build.regions=res[0].data;
      var b=vm.build.regions.find(function(k){
          return k.RegionType==4;
      })
      vm.build.name=b? b.RegionName:"";
      vm.build.status=res[1].data;
      var r=res[2];
      if (r.data&&angular.isArray(r.data)){
        $scope.procedures= r.data;
        setgxSelectedValue($scope.procedures);
      }
      render();
      vm.loading=false;
    }).catch(function(){
      vm.loading=false;
      render();
    });
    $scope.choosego=function(item){
      var p=$scope.gxSelected.find(function(o){
        return o.AcceptanceItemID==item.AcceptanceItemID;
      });
      if (!p&&!item.checked){
        $scope.gxSelected.push(item)
      }
      if (p&&item.checked){
        var index=$scope.gxSelected.indexOf(p);
        $scope.gxSelected.splice(index,1);
      }
      cookie.gx=$scope.gxSelected;
    }


    vm.query = function () {
      vm.build.query();
    };

    $scope.$watch('vm.build.isOpen',function () {
      if (!vm.build.isOpen&&vm.build.isOpen!==false){
        return;
      }
      if (!vm.build.isOpen){
        if (!$scope.gxSelected.length){
          utils.alert('请选择要显示的工序').then(function () {
            vm.openGx();
          });
          return;
        }
        if ($scope.gxSelected.length>4){
          utils.alert('最多只能选择4个工序').then(function () {
            vm.openGx();
          })
          return;
        }
        vm.query();
      }
    })

    $scope.remove=function(item){
      $timeout(function(){
        var index=$scope.gxSelected.indexOf(item);
        if (index>-1){
          $scope.gxSelected.splice(index,1);
        }
        cookie.gx=$scope.gxSelected;
      })
    }
    vm.openGx = buildToggler('procedure_right');
  }
})();

/**
 * Created by lss on 2016/9/18.
 */
/**
 * Created by jiuyuong on 2016/3/30.
 */
(function(){
  'use strict';

  buildController.$inject = ["$scope", "$stateParams", "remote", "$mdDialog", "$state", "$q"];
  angular
    .module('app.pcReport')
    .controller('buildController',buildController);

  /** @ngInject */
  function buildController($scope,$stateParams,remote,$mdDialog,$state ,$q){
    var vm=this;
    vm.projectName=$stateParams.projectName;
    $q.all([
      remote.Project.getRegionAndChildren($stateParams.projectId),
      remote.Project.getZTjd($stateParams.projectId)
    ]).then(function(res){
        var r=res[0];
        var zt=res[1].data;
        vm.areas = [];
        var builds = [];
        var floors = [];

        r.data.forEach(function (k) {
          if (k.RegionType == 2) {
            vm.areas.push(k);
          }
          if (k.RegionType == 4) {
            builds.push({
              building_id: k.RegionID,
              gx1: 0,
              gx2: 0,
              name: k.RegionName,
              //sellLine: -100,
              summary: ""
            })
          }
          if (k.RegionType == 8) {
            floors.push({
              regionID: k.RegionID,
              regionName: k.RegionName
            });
          }
        });
        var arr;
        builds.forEach(function (k) {
          arr = [];
          floors.forEach(function (n) {
            if (n.regionID.indexOf(k.building_id) > -1) {
              arr.push(n);
            }
          })

          var x= zt.find(function(n){
            return n.RegionID== k.building_id;
          });
          if (x){
            k.gx1= x.Max;
          }

          k.floors = arr.length;
          k.sellLine=parseInt(k.floors*0.67)
          k.floorData = arr;
        })

        vm.maxLen=0
        vm.areas.forEach(function(k){
          k.builds=[];
          builds.forEach(function(n){
            if (n.building_id.indexOf(k.RegionID)>-1){
              k.builds.push(n);
            }
          });
          k.builds.forEach(function(u){
            if (vm.maxLen< u.floors){
              vm.maxLen=u.floors;
            }
          })
        })
    });

    remote.Project.getRegionAndChildren($stateParams.projectId).then(function(r){

    });



    vm.showECs = function(evt,item) {
      $mdDialog.show({
          controller: ['$scope', '$mdDialog','item', function DialogController(scope, $mdDialog,item) {

            scope.goSC=function(){
              $state.go("app.pcReport_scbdd",{regionID:item.building_id});
              $mdDialog.hide();
            }
            scope.goGX=function(){
              $state.go("app.pcReport_bdd",{regionID:item.building_id});
              $mdDialog.hide();
            }
          }],
          templateUrl: 'app/main/pcReport/htmlTemplate/actiongxOrsc.html',
          parent: angular.element(document.body),
          targetEvent: evt,
          focusOnOpen:false,
          locals:{
            item:item
          },
          clickOutsideToClose: true
        })
        .then(function(answer) {
        });
    };
  }
})();
/**
 * Created by lss on 2016/10/7.
 */
;

/**
 * Created by 陆科桦 on 2016/10/23.
 */

(function () {
  'use strict';

  config.$inject = ["apiProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config(apiProvider) {
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('xhsc',{
      materialPlan:{
        getMaterialPlanBatch: $http.db({
          _id: 'materialPlan',
          idField: 'Id',
          dataType: 1,
          filter: function (item, sectionId) {
            return item.SectionId == sectionId;
          }
        }).bind(function (sectionId,status) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialPlansBatchBySectionId',{sectionId:sectionId,status:status}));
        }),
        deleteMaterialPlanBatch:$http.db({
          _id:'materialPlan',
          idField:'Id',
          delete:true,
          local:true
        }).bind(),
        getMaterialBatchIntoFactory:$http.db({
          _id:'materialBatchIntoFactory',
          idField:'Id',
          dataType:1
        }).bind(),
        updateMaterialBatchIntoFactory:$http.db({
          _id:'materialBatchIntoFactory',
          idField:'Id',
          update:true,
          local:true
        }).bind(),
        getMaterialPlanDetailList:$http.db({
          _id:'materialPlanDetailList',
          idField:'Id',
          dataType:1
        }).bind(function (sectionId,status) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialPlanListAsync',{sectionId:sectionId,status:status}));
        }),
        getMaterialPlanDetail:$http.db({
          _id:'materialPlanDetailList',
          idField:'Id',
          dataType:3
          }).bind(function (batchId) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialPlanAsync?batchId='+batchId));
        }),
        getMaterialPlanBatchById:function (id) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialPlanBatchById?id='+id));
        },
        // GetMaterialPlanBatchByPlanId:function (planId) {
        //   return $http.get($http.url('/api/MaterialPlan/GetMaterialPlanBatchByPlanId?planId='+planId));
        // },
        // GetExcessMaterialExitByPlanId:function (planId) {
        //     return $http.get($http.url('/api/MaterialPlan/GetExcessMaterialExitAsync?planId='+planId));
        // },
        GetMaterialPlanInfolById:function (id) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialPlanInfolById/'+id));
        },
        PostCheckInfo: $http.db({
          _id: 'materialPlanCheckInfo',
          idField: 'Id',
          upload:true
        }).bind(function (data) {
          return $http.put('/api/MaterialPlan/InsertCheckInfo', data);
        }),
        PostReportInfo: $http.db({
          _id: 'materialPlanReportInfo',
          idField: 'Id',
          upload:true
        }).bind(function (data) {
          return $http.put('/api/MaterialPlan/InsertReportInfo', data);
        }),
        PostApprovalInfo: $http.db({
          _id: 'materialPlanApprovalInfo',
          idField: 'Id',
          upload:true
        }).bind(function (flag,data) {
          return $http.put('/api/MaterialPlan/InsertApproval?flag='+flag, data);
        }),
        PostExitInfo: $http.db({
          _id: 'materialExitInfo',
          idField: 'ExitId',
          upload:true
        }).bind(function (data) {
          return $http.post('/api/MaterialPlan/InsertExitInfo', data);
        }),
        IntoFactoryMaterialBatch:$http.db({
          _id:'materialBatchIntoFactory',
          idField:'Id',
          upload:true
        }).bind(function (data) {
          return $http.post('/api/MaterialPlan/IntoFactoryMaterialBatch',data);
        }),
        MaterialInspection:$http.db({
          _id:'materialBatchInspection',
          idField:'Id',
          dataType:3,
          upload:true
        }).bind(function (data) {
          return $http.put('/api/MaterialPlan/MaterialInspection',data);
        }),
        materialUnqualifiedExit:$http.db({
          _id:'materialUnqualifiedExit',
          idField:'Id',
          dataType:3,
          upload:true
        }).bind(function (data) {
          return $http.put('/api/MaterialPlan/UnMaterialExit',data);
        }),
        getMaterialBatchProgress:$http.db({
          _id:'materialBatchProgress',
          idField:'Id',
          dataType:1
        }).bind(function (sectionId,status) {
          return $http.get($http.url('/api/MaterialPlan/GetMaterialBatchProgress',{sectionId:sectionId,status:status}));
        }),
        getBatchProgressById:$http.db({
          _id:'materialBatchProgress',
          idField:'Id',
          dataType:3
        }).bind()
      }
    });
  }

})(angular,undefined);

/**
 * Created by 陆科桦 on 2016/10/14.
 */
(function(angular,undefined){
  'use strict';
  config.$inject = ["apiProvider"];
  angular
    .module('app.material')
    .config(config);

  /** @ngInject */
  function config(apiProvider){
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('material', {
      type: {
        getList: function (param) {
          return $http.get($http.url('/api/MaterialClass', {Skip: param.Skip, Limit: param.Limit}));
        },
        getItem: function (id) {
          return $http.get($http.url('/api/MaterialClass/' + id));
        },
        create: function (id,param) {
          return $http.post('/api/MaterialClass/', id);
        },
        delete: function (id) {
          return $http.delete('/api/MaterialClass/' + id);
        },
        update: function (param) {
          return $http.put('/api/MaterialClass/' + param.Id, param);
        },
        getParent:function(){
          return $http.get($http.url('/api/MaterialClass/GetParentMaterialClass'));
        }
      },
      materialScience: {
        Create: function (args) {
          return $http.post('/api/MaterialScience', args)
        },
        getList:function(args){
          return $http.get($http.url('/api/MaterialScience',{Skip:args.Skip,Limit:args.Limit}))
        },
        getMaterial:function(id){
          return $http.get($http.url('/api/MaterialScience/'+id));
        },
        putMaterial:function(data){
          return $http.put('/api/MaterialScience/' + data.Id,data);
        },
        delete:function(id){
          return $http.delete('/api/MaterialScience/'+id);
        },
        getMaterialList:function () {
          return $http.get($http.url('/api/MaterialScience/GetMaterialListAsync'))
        },
        GetMaterialByTypeId:function (typeId) {
          return $http.get($http.url('/api/MaterialScience/GetMaterialByTypeId/' + typeId))
        },
        GetMaterialTreeList:function (cid) {
          return $http.get($http.url('/api/MaterialScience/GetMaterialTreeListAsync/'+cid))
        },
        GetMaterialListByTypeId:function (cid) {
          return $http.get($http.url('/api/MaterialScience/GetMaterialListByTypeId/'+cid))
        },
        batchCreate:function (data) {
          return $http.put('/api/MaterialScience/BatchCreateMaterial',data);
        }
      },
      materialPlan:{
        Create:function (args) {
          return $http.post('/api/MaterialPlan', args)
        },
        getList:function(args){
          return $http.get($http.url('/api/MaterialPlan',{RegionId:args.RegionId,SectionId:args.SectionId,Skip:args.Skip,Limit:args.Limit}))
        },
        getMaterial:function(id){
          return $http.get($http.url('/api/MaterialPlan/'+id));
        },
        putMaterial:function(data){
          return $http.put('/api/MaterialPlan/'+data.Id,data);
        },
        delete:function(id){
          return $http.delete('/api/MaterialPlan/'+id);
        },
        GetProjectSection:function (args) {
          return $http.get($http.url('/api/ProjectInfoApi/GetProjectSection',{areaId:args}));
        },
        getUserProjectSectionForPc:function(){
          return $http.get($http.url('/api/ProjectInfoApi/GetUserSectionForPc'))
        },
        getMaterialReport:function(sid,param){
          return $http.get($http.url('/api/MaterialPlan/GetMaterialReportBySectionId/' + sid, {Skip: param.Skip, Limit: param.Limit}))
        }
      },
      contract:{
        getSysOrgOU:function (args) {
          return $http.get($http.url('/api/ProjectInfoApi/GetOrgOU',{projects:args}));
        },
        create: function (args) {
          return $http.post('/api/MaterialContract', args)
        },
        update:function(data){
          return $http.put('/api/MaterialContract/'+data.Id,data);
        },
        getList: function (param) {
          return $http.get($http.url('/api/MaterialContract?projects='+param.projects, {Skip: param.Skip, Limit: param.Limit}));
        },
        getById:function(id){
          return $http.get($http.url('/api/MaterialContract/'+id));
        },
        GetContractDetailById:function (cid,mid) {
          return $http.get($http.url('/api/MaterialContract/GetContractDetailById/'+cid+'/'+mid));
        },
        UpdateContract:function (data) {
          return $http.put('/api/MaterialContract/UpdateContract',data);
        },
        delete:function(id){
          return $http.delete('/api/MaterialContract/'+id);
        }
      }
    })
  }
})(angular,undefined);


/**
 * Created by HuangQingFeng on 2016/11/22.
 */
(function(angular,undefined){
  'use strict';
  config.$inject = ["apiProvider"];
  angular
    .module('app.earthwork')
    .config(config);

  /** @ngInject */
  function config(apiProvider){
    var $http = apiProvider.$http,
      $q = apiProvider.$q;
    apiProvider.register('earthwork', {
      earthwork: {
        save: function (data) {
          return $http.post('/api/Eartwork/SaveAsync', data);
        },
        getEarthworkByRegionTreeId:function (args) {
          return $http.get($http.url('/api/Eartwork/GetEarthworkByRegionTreeId',{regionTreeId:args.regionTreeId}));
        },
        getEarthworkList:function (args) {
          return $http.get($http.url('/api/Eartwork/GetEarthworkList',{regionTreeId:args.regionTreeId,status:args.status}));
        },
        createEarthworkArea: function (data) {
          return $http.post('/api/Eartwork/CreateEarthworkArea', data);
        },
        updateEarthworkArea: function (id,data) {
          return $http.put('/api/Eartwork/UpdateEarthworkArea/' + id, data);
        },
        delete:function (id) {
          return $http.delete('/api/Eartwork/' + id);
        },
        upLoadImage:function (file) {
          return $http.post('/api/Eartwork/UpLoadImage/' + file.RelationId, file);
        },
        DeleteFile:function (id) {
          return $http.delete('/api/Eartwork/DeleteFile/' + id);
        },
        getFileByRid:function (rid) {
          return $http.get($http.url('/api/Eartwork/GetFileByRid/' + rid));
        }
      }
    })
  }
})(angular,undefined);

(function ()
{
    'use strict';

    angular
        .module('app.core')
        .provider('fuseTheming', fuseThemingProvider);

    /** @ngInject */
    function fuseThemingProvider()
    {
        // Inject Cookies Service
        var $cookies;

        angular.injector(['ngCookies']).invoke([
            '$cookies', function (_$cookies)
            {
                $cookies = _$cookies;
            }
        ]);

        // Inject $log service
        var $log = angular.injector(['ng']).get('$log');

        var registeredPalettes,
            registeredThemes;

        // Methods
        this.setRegisteredPalettes = setRegisteredPalettes;
        this.setRegisteredThemes = setRegisteredThemes;

        //////////

        /**
         * Set registered palettes
         *
         * @param _registeredPalettes
         */
        function setRegisteredPalettes(_registeredPalettes)
        {
            registeredPalettes = _registeredPalettes;
        }

        /**
         * Set registered themes
         *
         * @param _registeredThemes
         */
        function setRegisteredThemes(_registeredThemes)
        {
            registeredThemes = _registeredThemes;
        }

        /**
         * Service
         */
        this.$get = function ()
        {
            var service = {
                getRegisteredPalettes: getRegisteredPalettes,
                getRegisteredThemes  : getRegisteredThemes,
                setActiveTheme       : setActiveTheme,
                setThemesList        : setThemesList,
                themes               : {
                    list  : {},
                    active: {
                        'name' : '',
                        'theme': {}
                    }
                }
            };

            return service;

            //////////

            /**
             * Get registered palettes
             *
             * @returns {*}
             */
            function getRegisteredPalettes()
            {
                return registeredPalettes;
            }

            /**
             * Get registered themes
             *
             * @returns {*}
             */
            function getRegisteredThemes()
            {
                return registeredThemes;
            }

            /**
             * Set active theme
             *
             * @param themeName
             */
            function setActiveTheme(themeName)
            {
                // If theme does not exist, fallback to the default theme
                if ( angular.isUndefined(service.themes.list[themeName]) )
                {
                    // If there is no theme called "default"...
                    if ( angular.isUndefined(service.themes.list.default) )
                    {
                        $log.error('You must have at least one theme named "default"');
                        return;
                    }

                    $log.warn('The theme "' + themeName + '" does not exist! Falling back to the "default" theme.');

                    // Otherwise set theme to default theme
                    service.themes.active.name = 'pink';
                    service.themes.active.theme = service.themes.list.default;
                    $cookies.put('selectedTheme', service.themes.active.name);

                    return;
                }

                service.themes.active.name = themeName;
                service.themes.active.theme = service.themes.list[themeName];
                $cookies.put('selectedTheme', themeName);
            }

            /**
             * Set available themes list
             *
             * @param themeList
             */
            function setThemesList(themeList)
            {
                service.themes.list = themeList;
            }
        };
    }
})();

(function ()
{
    'use strict';

    config.$inject = ["$mdThemingProvider", "fusePalettes", "fuseThemes", "fuseThemingProvider"];
    angular
        .module('app.core')
        .config(config);

    /** @ngInject */
    function config($mdThemingProvider, fusePalettes, fuseThemes, fuseThemingProvider)
    {
        // Inject Cookies Service
        var $cookies;
        angular.injector(['ngCookies']).invoke([
            '$cookies', function (_$cookies)
            {
                $cookies = _$cookies;
            }
        ]);

        // Check if custom theme exist in cookies
        var customTheme = $cookies.getObject('customTheme');
        if ( customTheme )
        {
            fuseThemes['custom'] = customTheme;
        }

        $mdThemingProvider.alwaysWatchTheme(true);

        // Define custom palettes
        angular.forEach(fusePalettes, function (palette)
        {
            $mdThemingProvider.definePalette(palette.name, palette.options);
        });

        // Register custom themes
        angular.forEach(fuseThemes, function (theme, themeName)
        {
            $mdThemingProvider.theme(themeName)
                .primaryPalette(theme.primary.name, theme.primary.hues)
                .accentPalette(theme.accent.name, theme.accent.hues)
                .warnPalette(theme.warn.name, theme.warn.hues)
                .backgroundPalette(theme.background.name, theme.background.hues);
        });
        // Store generated PALETTES and THEMES objects from $mdThemingProvider
        // in our custom provider, so we can inject them into other areas
        fuseThemingProvider.setRegisteredPalettes($mdThemingProvider._PALETTES);
        fuseThemingProvider.setRegisteredThemes($mdThemingProvider._THEMES);
    }

})();

(function ()
{
    'use strict';

    var fuseThemes = {
        'default'  : {
            primary   : {
                name: 'fuse-pale-blue',
                hues: {
                    'default': '700',
                    'hue-1'  : '500',
                    'hue-2'  : '600',
                    'hue-3'  : '400'
                }
            },
            accent    : {
                name: 'light-blue',
                hues: {
                    'default': '600',
                    'hue-1'  : '400',
                    'hue-2'  : '700',
                    'hue-3'  : 'A100'
                }
            },
            warn      : {name: 'red'},
            background: {
                name: 'grey',
                hues: {
                    'default': 'A100',
                    'hue-1'  : '100',
                    'hue-2'  : '50',
                    'hue-3'  : '300'
                }
            }
        },
        'pink': {
            primary   : {
                name: 'blue-grey',
                hues: {
                    'default': '800',
                    'hue-1'  : '600',
                    'hue-2'  : '400',
                    'hue-3'  : 'A100'
                }
            },
            accent    : {
                name: 'pink',
                hues: {
                    'default': '400',
                    'hue-1'  : '300',
                    'hue-2'  : '600',
                    'hue-3'  : 'A100'
                }
            },
            warn      : {name: 'blue'},
            background: {
                name: 'grey',
                hues: {
                    'default': 'A100',
                    'hue-1'  : '100',
                    'hue-2'  : '50',
                    'hue-3'  : '300'
                }
            }
        },
        'teal'     : {
            primary   : {
                name: 'fuse-blue',
                hues: {
                    'default': '900',
                    'hue-1'  : '600',
                    'hue-2'  : '500',
                    'hue-3'  : 'A100'
                }
            },
            accent    : {
                name: 'teal',
                hues: {
                    'default': '500',
                    'hue-1'  : '400',
                    'hue-2'  : '600',
                    'hue-3'  : 'A100'
                }
            },
            warn      : {name: 'deep-orange'},
            background: {
                name: 'grey',
                hues: {
                    'default': 'A100',
                    'hue-1'  : '100',
                    'hue-2'  : '50',
                    'hue-3'  : '300'
                }
            }
        },
      //'vanke'     : {
      //  primary   : {
      //    name: 'blue-1',
      //    hues: {
      //      'default': '500',
      //      'hue-1'  : '500',
      //      'hue-2'  : '500',
      //      'hue-3'  : '500'
      //    }
      //  },
      //  accent    : {
      //    name: 'blue-1',
      //    hues: {
      //      'default': '500',
      //      'hue-1'  : '500',
      //      'hue-2'  : '500',
      //      'hue-3'  : '500'
      //    }
      //  },
      //  warn      : {name: 'blue-1'},
      //  background: {
      //    name: 'grey',
      //    hues: {
      //      'default': 'A100',
      //      'hue-1'  : '100',
      //      'hue-2'  : '50',
      //      'hue-3'  : '300'
      //    }
      //  }
      //}
      'vanke'     : {
        primary   : {
          name: 'red',
          hues: {
            'default': '900',
            'hue-1'  : '600',
            'hue-2'  : '500',
            'hue-3'  : 'A100'
          }
        },
        accent    : {
          name: 'red',
          hues: {
            'default': '500',
            'hue-1'  : '400',
            'hue-2'  : '600',
            'hue-3'  : 'A100'
          }
        },
        warn      : {name: 'red'},
        background: {
          name: 'grey',
          hues: {
            'default': 'A100',
            'hue-1'  : '100',
            'hue-2'  : '50',
            'hue-3'  : '300'
          }
        }
      }
    };

    angular
        .module('app.core')
        .constant('fuseThemes', fuseThemes);
})();

(function () {
    'use strict';

    var fusePalettes = [
        {
            name: 'fuse-blue',
            options: {
                '50': '#ebf1fa',
                '100': '#c2d4ef',
                '200': '#9ab8e5',
                '300': '#78a0dc',
                '400': '#5688d3',
                '500': '#3470ca',
                '600': '#2e62b1',
                '700': '#275498',
                '800': '#21467e',
                '900': '#1a3865',
                'A100': '#c2d4ef',
                'A200': '#9ab8e5',
                'A400': '#5688d3',
                'A700': '#275498',
                'contrastDefaultColor': 'light',
                'contrastDarkColors': '50 100 200 A100',
                'contrastStrongLightColors': '300 400'
            }
        },
        {
        name: 'fuse-pale-blue',
        options: {
          '50': '#ececee',
          '100': '#c5c6cb',
          '200': '#9ea1a9',
          '300': '#7d818c',
          '400': '#5c616f',
          '500': '#3c4252',
          '600': '#353a48',
          '700': '#2d323e',
          '800': '#262933',
          '900': '#1e2129',
          'A100': '#c5c6cb',
          'A200': '#9ea1a9',
          'A400': '#5c616f',
          'A700': '#2d323e',
          'contrastDefaultColor': 'light',
          'contrastDarkColors': '50 100 200 A100',
          'contrastStrongLightColors': '300 400'
        }
      }
    ];

    angular
        .module('app.core')
        .constant('fusePalettes', fusePalettes);
})();

(function ()
{
    'use strict';

    fuseGeneratorService.$inject = ["$cookies", "$log", "fuseTheming", "msUtils"];
    angular
        .module('app.core')
        .factory('fuseGenerator', fuseGeneratorService);

    /** @ngInject */
    function fuseGeneratorService($cookies, $log, fuseTheming,msUtils)
    {
        // Storage for simplified themes object
        var themes = {};

        var service = {
            generate: generate,
            rgba    : rgba
        };

        return service;

        //////////

        /**
         * Generate less variables for each theme from theme's
         * palette by using material color naming conventions
         */
        function generate()
        {
            var registeredThemes = fuseTheming.getRegisteredThemes();
            var registeredPalettes = fuseTheming.getRegisteredPalettes();

            // First, create a simplified object that stores
            // all registered themes and their colors

            // Iterate through registered themes
            angular.forEach(registeredThemes, function (registeredTheme)
            {
                themes[registeredTheme.name] = {};

                // Iterate through color types (primary, accent, warn & background)
                angular.forEach(registeredTheme.colors, function (colorType, colorTypeName)
                {
                    themes[registeredTheme.name][colorTypeName] = {
                        'name'  : colorType.name,
                        'levels': {
                            'default': {
                                'color'    : rgba(registeredPalettes[colorType.name][colorType.hues.default].value),
                                'contrast1': rgba(registeredPalettes[colorType.name][colorType.hues.default].contrast, 1),
                                'contrast2': rgba(registeredPalettes[colorType.name][colorType.hues.default].contrast, 2),
                                'contrast3': rgba(registeredPalettes[colorType.name][colorType.hues.default].contrast, 3),
                                'contrast4': rgba(registeredPalettes[colorType.name][colorType.hues.default].contrast, 4)
                            },
                            'hue1'   : {
                                'color'    : rgba(registeredPalettes[colorType.name][colorType.hues['hue-1']].value),
                                'contrast1': rgba(registeredPalettes[colorType.name][colorType.hues['hue-1']].contrast, 1),
                                'contrast2': rgba(registeredPalettes[colorType.name][colorType.hues['hue-1']].contrast, 2),
                                'contrast3': rgba(registeredPalettes[colorType.name][colorType.hues['hue-1']].contrast, 3),
                                'contrast4': rgba(registeredPalettes[colorType.name][colorType.hues['hue-1']].contrast, 4)
                            },
                            'hue2'   : {
                                'color'    : rgba(registeredPalettes[colorType.name][colorType.hues['hue-2']].value),
                                'contrast1': rgba(registeredPalettes[colorType.name][colorType.hues['hue-2']].contrast, 1),
                                'contrast2': rgba(registeredPalettes[colorType.name][colorType.hues['hue-2']].contrast, 2),
                                'contrast3': rgba(registeredPalettes[colorType.name][colorType.hues['hue-2']].contrast, 3),
                                'contrast4': rgba(registeredPalettes[colorType.name][colorType.hues['hue-2']].contrast, 4)
                            },
                            'hue3'   : {
                                'color'    : rgba(registeredPalettes[colorType.name][colorType.hues['hue-3']].value),
                                'contrast1': rgba(registeredPalettes[colorType.name][colorType.hues['hue-3']].contrast, 1),
                                'contrast2': rgba(registeredPalettes[colorType.name][colorType.hues['hue-3']].contrast, 2),
                                'contrast3': rgba(registeredPalettes[colorType.name][colorType.hues['hue-3']].contrast, 3),
                                'contrast4': rgba(registeredPalettes[colorType.name][colorType.hues['hue-3']].contrast, 4)
                            }
                        }
                    };
                });
            });

            // Process themes one more time and then store them in the service for external use
            processAndStoreThemes(themes);

            // Iterate through simplified themes
            // object and create style variables
            var styleVars = {};

            // Iterate through registered themes
            angular.forEach(themes, function (theme, themeName)
            {
                styleVars = {};
                styleVars['@themeName'] = themeName;

                // Iterate through color types (primary, accent, warn & background)
                angular.forEach(theme, function (colorTypes, colorTypeName)
                {
                    // Iterate through color levels (default, hue1, hue2 & hue3)
                    angular.forEach(colorTypes.levels, function (colors, colorLevelName)
                    {
                        // Iterate through color name (color, contrast1, contrast2, contrast3 & contrast4)
                        angular.forEach(colors, function (color, colorName)
                        {
                            styleVars['@' + colorTypeName + ucfirst(colorLevelName) + ucfirst(colorName)] = color;
                        });
                    });
                });

                // Render styles
                render(styleVars);
            });
        }

        // ---------------------------
        //  INTERNAL HELPER FUNCTIONS
        // ---------------------------

        /**
         * Process and store themes for global use
         *
         * @param _themes
         */
        function processAndStoreThemes(_themes)
        {
            // Here we will go through every registered theme one more time
            // and try to simplify their objects as much as possible for
            // easier access to their properties.
            var themes = angular.copy(_themes);

            // Iterate through themes
            angular.forEach(themes, function (theme)
            {
                // Iterate through color types (primary, accent, warn & background)
                angular.forEach(theme, function (colorType, colorTypeName)
                {
                    theme[colorTypeName] = colorType.levels;
                    theme[colorTypeName].color = colorType.levels.default.color;
                    theme[colorTypeName].contrast1 = colorType.levels.default.contrast1;
                    theme[colorTypeName].contrast2 = colorType.levels.default.contrast2;
                    theme[colorTypeName].contrast3 = colorType.levels.default.contrast3;
                    theme[colorTypeName].contrast4 = colorType.levels.default.contrast4;
                    delete theme[colorTypeName].default;
                });
            });

            // Store themes and set selected theme for the first time
            fuseTheming.setThemesList(themes);

            // Remember selected theme.
/*            var selectedTheme = $cookies.get('selectedTheme');

            if ( selectedTheme )
            {
                fuseTheming.setActiveTheme(selectedTheme);
            }
            else
            {
                fuseTheming.setActiveTheme('default');
            }*/
          //fuseTheming.setActiveTheme('vanke');

          fuseTheming.setActiveTheme(msUtils.isMobile()? 'vanke':'fuse-red');
        }


        /**
         * Render css files
         *
         * @param styleVars
         */
        function render(styleVars)
        {
            var cssTemplate = '[md-theme="@themeName"] a {\n    color: @accentDefaultColor;\n}\n\n[md-theme="@themeName"] .secondary-text,\n[md-theme="@themeName"] .icon {\n    color: @backgroundDefaultContrast2;\n}\n\n[md-theme="@themeName"] .hint-text,\n[md-theme="@themeName"] .disabled-text {\n    color: @backgroundDefaultContrast3;\n}\n\n[md-theme="@themeName"] .fade-text,\n[md-theme="@themeName"] .divider {\n    color: @backgroundDefaultContrast4;\n}\n\n/* Primary */\n[md-theme="@themeName"] .md-primary-bg {\n    background-color: @primaryDefaultColor;\n    color: @primaryDefaultContrast1;\n}\n\n[md-theme="@themeName"] .md-primary-bg .secondary-text,\n[md-theme="@themeName"] .md-primary-bg .icon {\n    color: @primaryDefaultContrast2;\n}\n\n[md-theme="@themeName"] .md-primary-bg .hint-text,\n[md-theme="@themeName"] .md-primary-bg .disabled-text {\n    color: @primaryDefaultContrast3;\n}\n\n[md-theme="@themeName"] .md-primary-bg .fade-text,\n[md-theme="@themeName"] .md-primary-bg .divider {\n    color: @primaryDefaultContrast4;\n}\n\n/* Primary, Hue-1 */\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 {\n    background-color: @primaryHue1Color;\n    color: @primaryHue1Contrast1;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .secondary-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .icon {\n    color: @primaryHue1Contrast2;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .hint-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .disabled-text {\n    color: @primaryHue1Contrast3;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .fade-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-1 .divider {\n    color: @primaryHue1Contrast4;\n}\n\n/* Primary, Hue-2 */\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 {\n    background-color: @primaryHue2Color;\n    color: @primaryHue2Contrast1;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .secondary-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .icon {\n    color: @primaryHue2Contrast2;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .hint-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .disabled-text {\n    color: @primaryHue2Contrast3;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .fade-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-2 .divider {\n    color: @primaryHue2Contrast4;\n}\n\n/* Primary, Hue-3 */\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 {\n    background-color: @primaryHue3Color;\n    color: @primaryHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .secondary-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .icon {\n    color: @primaryHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .hint-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .disabled-text {\n    color: @primaryHue3Contrast3;\n}\n\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .fade-text,\n[md-theme="@themeName"] .md-primary-bg.md-hue-3 .divider {\n    color: @primaryHue3Contrast4;\n}\n\n/* Primary foreground */\n[md-theme="@themeName"] .md-primary-fg {\n    color: @primaryDefaultColor !important;\n}\n\n/* Primary foreground, Hue-1 */\n[md-theme="@themeName"] .md-primary-fg.md-hue-1 {\n    color: @primaryHue1Color !important;\n}\n\n/* Primary foreground, Hue-2 */\n[md-theme="@themeName"] .md-primary-fg.md-hue-2 {\n    color: @primaryHue2Color !important;\n}\n\n/* Primary foreground, Hue-3 */\n[md-theme="@themeName"] .md-primary-fg.md-hue-3 {\n    color: @primaryHue3Color !important;\n}\n\n\n/* Accent */\n[md-theme="@themeName"] .md-accent-bg {\n    background-color: @accentDefaultColor;\n    color: @accentDefaultContrast1;\n}\n\n[md-theme="@themeName"] .md-accent-bg .secondary-text,\n[md-theme="@themeName"] .md-accent-bg .icon {\n    color: @accentDefaultContrast2;\n}\n\n[md-theme="@themeName"] .md-accent-bg .hint-text,\n[md-theme="@themeName"] .md-accent-bg .disabled-text {\n    color: @accentDefaultContrast3;\n}\n\n[md-theme="@themeName"] .md-accent-bg .fade-text,\n[md-theme="@themeName"] .md-accent-bg .divider {\n    color: @accentDefaultContrast4;\n}\n\n/* Accent, Hue-1 */\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 {\n    background-color: @accentHue1Color;\n    color: @accentHue1Contrast1;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .secondary-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .icon {\n    color: @accentHue1Contrast2;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .hint-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .disabled-text {\n    color: @accentHue1Contrast3;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .fade-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-1 .divider {\n    color: @accentHue1Contrast4;\n}\n\n/* Accent, Hue-2 */\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 {\n    background-color: @accentHue2Color;\n    color: @accentHue2Contrast1;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .secondary-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .icon {\n    color: @accentHue2Contrast2;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .hint-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .disabled-text {\n    color: @accentHue2Contrast3;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .fade-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-2 .divider {\n    color: @accentHue2Contrast4;\n}\n\n/* Accent, Hue-3 */\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 {\n    background-color: @accentHue3Color;\n    color: @accentHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .secondary-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .icon {\n    color: @accentHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .hint-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .disabled-text {\n    color: @accentHue3Contrast3;\n}\n\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .fade-text,\n[md-theme="@themeName"] .md-accent-bg.md-hue-3 .divider {\n    color: @accentHue3Contrast4;\n}\n\n/* Accent foreground */\n[md-theme="@themeName"] .md-accent-fg {\n    color: @accentDefaultColor !important;\n}\n\n/* Accent foreground, Hue-1 */\n[md-theme="@themeName"] .md-accent-fg.md-hue-1 {\n    color: @accentHue1Color !important;\n}\n\n/* Accent foreground, Hue-2 */\n[md-theme="@themeName"] .md-accent-fg.md-hue-2 {\n    color: @accentHue2Color !important;\n}\n\n/* Accent foreground, Hue-3 */\n[md-theme="@themeName"] .md-accent-fg.md-hue-3 {\n    color: @accentHue3Color !important;\n}\n\n\n/* Warn */\n[md-theme="@themeName"] .md-warn-bg {\n    background-color: @warnDefaultColor;\n    color: @warnDefaultContrast1;\n}\n\n[md-theme="@themeName"] .md-warn-bg .secondary-text,\n[md-theme="@themeName"] .md-warn-bg .icon {\n    color: @warnDefaultContrast2;\n}\n\n[md-theme="@themeName"] .md-warn-bg .hint-text,\n[md-theme="@themeName"] .md-warn-bg .disabled-text {\n    color: @warnDefaultContrast3;\n}\n\n[md-theme="@themeName"] .md-warn-bg .fade-text,\n[md-theme="@themeName"] .md-warn-bg .divider {\n    color: @warnDefaultContrast4;\n}\n\n/* Warn, Hue-1 */\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 {\n    background-color: @warnHue1Color;\n    color: @warnHue1Contrast1;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .secondary-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .icon {\n    color: @warnHue1Contrast2;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .hint-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .disabled-text {\n    color: @warnHue1Contrast3;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .fade-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-1 .divider {\n    color: @warnHue1Contrast4;\n}\n\n/* Warn, Hue-2 */\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 {\n    background-color: @warnHue2Color;\n    color: @warnHue2Contrast1;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .secondary-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .icon {\n    color: @warnHue2Contrast2;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .hint-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .disabled-text {\n    color: @warnHue2Contrast3;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .fade-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-2 .divider {\n    color: @warnHue2Contrast4;\n}\n\n/* Warn, Hue-3 */\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 {\n    background-color: @warnHue3Color;\n    color: @warnHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .secondary-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .icon {\n    color: @warnHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .hint-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .disabled-text {\n    color: @warnHue3Contrast3;\n}\n\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .fade-text,\n[md-theme="@themeName"] .md-warn-bg.md-hue-3 .divider {\n    color: @warnHue3Contrast4;\n}\n\n/* Warn foreground */\n[md-theme="@themeName"] .md-warn-fg {\n    color: @warnDefaultColor !important;\n}\n\n/* Warn foreground, Hue-1 */\n[md-theme="@themeName"] .md-warn-fg.md-hue-1 {\n    color: @warnHue1Color !important;\n}\n\n/* Warn foreground, Hue-2 */\n[md-theme="@themeName"] .md-warn-fg.md-hue-2 {\n    color: @warnHue2Color !important;\n}\n\n/* Warn foreground, Hue-3 */\n[md-theme="@themeName"] .md-warn-fg.md-hue-3 {\n    color: @warnHue3Color !important;\n}\n\n/* Background */\n[md-theme="@themeName"] .md-background-bg {\n    background-color: @backgroundDefaultColor;\n    color: @backgroundDefaultContrast1;\n}\n\n[md-theme="@themeName"] .md-background-bg .secondary-text,\n[md-theme="@themeName"] .md-background-bg .icon {\n    color: @backgroundDefaultContrast2;\n}\n\n[md-theme="@themeName"] .md-background-bg .hint-text,\n[md-theme="@themeName"] .md-background-bg .disabled-text {\n    color: @backgroundDefaultContrast3;\n}\n\n[md-theme="@themeName"] .md-background-bg .fade-text,\n[md-theme="@themeName"] .md-background-bg .divider {\n    color: @backgroundDefaultContrast4;\n}\n\n/* Background, Hue-1 */\n[md-theme="@themeName"] .md-background-bg.md-hue-1 {\n    background-color: @backgroundHue1Color;\n    color: @backgroundHue1Contrast1;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .secondary-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .icon {\n    color: @backgroundHue1Contrast2;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .hint-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .disabled-text {\n    color: @backgroundHue1Contrast3;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .fade-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-1 .divider {\n    color: @backgroundHue1Contrast4;\n}\n\n/* Background, Hue-2 */\n[md-theme="@themeName"] .md-background-bg.md-hue-2 {\n    background-color: @backgroundHue2Color;\n    color: @backgroundHue2Contrast1;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .secondary-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .icon {\n    color: @backgroundHue2Contrast2;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .hint-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .disabled-text {\n    color: @backgroundHue2Contrast3;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .fade-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-2 .divider {\n    color: @backgroundHue2Contrast4;\n}\n\n/* Background, Hue-3 */\n[md-theme="@themeName"] .md-background-bg.md-hue-3 {\n    background-color: @backgroundHue3Color;\n    color: @backgroundHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .secondary-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .icon {\n    color: @backgroundHue3Contrast1;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .hint-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .disabled-text {\n    color: @backgroundHue3Contrast3;\n}\n\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .fade-text,\n[md-theme="@themeName"] .md-background-bg.md-hue-3 .divider {\n    color: @backgroundHue3Contrast4;\n}\n\n/* Background foreground */\n[md-theme="@themeName"] .md-background-fg {\n    color: @backgroundDefaultColor !important;\n}\n\n/* Background foreground, Hue-1 */\n[md-theme="@themeName"] .md-background-fg.md-hue-1 {\n    color: @backgroundHue1Color !important;\n}\n\n/* Background foreground, Hue-2 */\n[md-theme="@themeName"] .md-background-fg.md-hue-2 {\n    color: @backgroundHue2Color !important;\n}\n\n/* Background foreground, Hue-3 */\n[md-theme="@themeName"] .md-background-fg.md-hue-3 {\n    color: @backgroundHue3Color !important;\n}';

            var regex = new RegExp(Object.keys(styleVars).join('|'), 'gi');
            var css = cssTemplate.replace(regex, function (matched)
            {
                return styleVars[matched];
            });

            var headEl = angular.element('head');
            var styleEl = angular.element('<style type="text/css"></style>');
            styleEl.html(css);
            headEl.append(styleEl);
        }

        /**
         * Convert color array to rgb/rgba
         * Also apply contrasts if needed
         *
         * @param color
         * @param _contrastLevel
         * @returns {string}
         */
        function rgba(color, _contrastLevel)
        {
            var contrastLevel = _contrastLevel || false;

            // Convert 255,255,255,0.XX to 255,255,255
            // According to Google's Material design specs, white primary
            // text must have opacity of 1 and we will fix that here
            // because Angular Material doesn't care about that spec
            if ( color.length === 4 && color[0] === 255 && color[1] === 255 && color[2] === 255 )
            {
                color.splice(3, 4);
            }

            // If contrast level provided, apply it to the current color
            if ( contrastLevel )
            {
                color = applyContrast(color, contrastLevel);
            }

            // Convert color array to color string (rgb/rgba)
            if ( color.length === 3 )
            {
                return 'rgb(' + color.join(',') + ')';
            }
            else if ( color.length === 4 )
            {
                return 'rgba(' + color.join(',') + ')';
            }
            else
            {
                $log.error('Invalid number of arguments supplied in the color array: ' + color.length + '\n' + 'The array must have 3 or 4 colors.');
            }
        }

        /**
         * Apply given contrast level to the given color
         *
         * @param color
         * @param contrastLevel
         */
        function applyContrast(color, contrastLevel)
        {
            var contrastLevels = {
                'white': {
                    '1': '1',
                    '2': '0.7',
                    '3': '0.3',
                    '4': '0.12'
                },
                'black': {
                    '1': '0.87',
                    '2': '0.54',
                    '3': '0.26',
                    '4': '0.12'
                }
            };

            // If white
            if ( color[0] === 255 && color[1] === 255 && color[2] === 255 )
            {
                color[3] = contrastLevels.white[contrastLevel];
            }
            // If black
            else if ( color[0] === 0 && color[1] === 0, color[2] === 0 )
            {
                color[3] = contrastLevels.black[contrastLevel];
            }

            return color;
        }

        /**
         * Uppercase first
         */
        function ucfirst(string)
        {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    }

})();

(function ()
{
    'use strict';

    MsThemeOptionsController.$inject = ["$cookies", "fuseTheming"];
    angular
        .module('app.core')
        .controller('MsThemeOptionsController', MsThemeOptionsController)
        .directive('msThemeOptions', msThemeOptions);

    /** @ngInject */
    function MsThemeOptionsController($cookies, fuseTheming)
    {
        var vm = this;

        // Data
        vm.themes = fuseTheming.themes;
        vm.layoutMode = 'wide';
        vm.layoutStyle = $cookies.get('layoutStyle') || 'verticalNavigation';

        // Methods
        vm.setActiveTheme = setActiveTheme;
        vm.updateLayoutMode = updateLayoutMode;
        vm.updateLayoutStyle = updateLayoutStyle;

        //////////

        /**
         * Set active theme
         *
         * @param themeName
         */
        function setActiveTheme(themeName)
        {
            // Set active theme
            fuseTheming.setActiveTheme(themeName);
        }

        /**
         * Update layout mode
         */
        function updateLayoutMode()
        {
            var bodyEl = angular.element('body');

            // Update class on body element
            bodyEl.toggleClass('boxed', (vm.layoutMode === 'boxed'));
        }

        /**
         * Update layout style
         */
        function updateLayoutStyle()
        {
            // Update the cookie
            $cookies.put('layoutStyle', vm.layoutStyle);

            // Reload the page to apply the changes
            location.reload();
        }
    }

    /** @ngInject */
    function msThemeOptions()
    {
        return {
            restrict   : 'E',
            scope      : {
                panelOpen: '=?'
            },
            controller : 'MsThemeOptionsController as vm',
            templateUrl: 'app/core/theme-options/theme-options.html',
            compile    : function (tElement)
            {
                tElement.addClass('ms-theme-options');

                return function postLink(scope, iElement)
                {
                    var bodyEl = angular.element('body'),
                        backdropEl = angular.element('<div class="ms-theme-options-backdrop"></div>');

                    // Panel open status
                    scope.panelOpen = scope.panelOpen || false;

                    /**
                     * Toggle options panel
                     */
                    function toggleOptionsPanel()
                    {
                        if ( scope.panelOpen )
                        {
                            closeOptionsPanel();
                        }
                        else
                        {
                            openOptionsPanel();
                        }
                    }

                    function openOptionsPanel()
                    {
                        // Set panelOpen status
                        scope.panelOpen = true;

                        // Add open class
                        iElement.addClass('open');

                        // Append the backdrop
                        bodyEl.append(backdropEl);

                        // Register the event
                        backdropEl.on('click touch', closeOptionsPanel);
                    }

                    /**
                     * Close options panel
                     */
                    function closeOptionsPanel()
                    {
                        // Set panelOpen status
                        scope.panelOpen = false;

                        // Remove open class
                        iElement.removeClass('open');

                        // De-register the event
                        backdropEl.off('click touch', closeOptionsPanel);

                        // Remove the backdrop
                        backdropEl.remove();
                    }

                    // Expose the toggle function
                    scope.toggleOptionsPanel = toggleOptionsPanel;
                };
            }
        };
    }
})();

/**
 * Created by zhangzhaoyong on 16/1/29.
 */
(function(){
  'use strict';

  utilsFactory.$inject = ["$mdToast", "$mdDialog", "$window", "$rootScope"];
  angular
    .module('app.core')
    .factory('utils', utilsFactory);


  /** @ngInject */
  function  utilsFactory($mdToast,$mdDialog,$window,$rootScope){

    var storage = $window.localStorage;
    return {
      id:'52327c423debf68027000006',
      math: {

        //+
        sum:function(){
          var t=0,arg = arguments,p;
          for(var i=0;i<arg.length;i++){
            p = parseFloat(arg[i]);
            if (!isNaN(p))
              t = accAdd(t, p);
          }
          return t;
        },
        //"/"
        div: function (a, b) {
          return accDiv(a, b);
        },
        //*
        mul: function (a, b) {
          return accMul(a, b);
        },
        //-
        sub: function (a, b) {
          return accSub(a, b);
        }
      },
      tips:tipsMessage,
      alert:alertMessage,
      confirm:confirmMessage,
      error:errorMessage,
      copy:copyFn,
      getPage:getPage,
      onCmd:onCmd,
      cookies:{
        c:{},
        put:function(name,value){
          this.c[name] = value;
          storage && storage.setItem(name,value);
        },
        remove:function(name){
          delete this.c[name];
          storage && storage.removeItem(name);
        },
        get:function(name){
          var v = this.c[name];
          if(!v && storage)
            v=storage.getItem(name);
          return v;
        }
      }
    };

    function onCmd($scope,cmd,fn,seq) {
      $scope.$on('$destroy', $rootScope.$on('toolbar:cmd'+(seq||''), function (s, e) {
        cmd = angular.isString(cmd) ? [cmd] : cmd;
        if (cmd.indexOf(e.cmd) != -1) {
          fn && fn(e.cmd, e);
        }
      }));
    }

    function accSub(arg2, arg1) {
      var r1, r2, m, n;
      try { r1 = arg1.toString().split(".")[1].length } catch (e) { r1 = 0 }
      try { r2 = arg2.toString().split(".")[1].length } catch (e) { r2 = 0 }
      m = Math.pow(10, Math.max(r1, r2));
      n = (r1 >= r2) ? r1 : r2;
      return parseFloat(((arg2 * m - arg1 * m) / m).toFixed(n));
    }
    function accAdd(arg2, arg1) {
      var r1, r2, m;
      try { r1 = arg1.toString().split(".")[1].length } catch (e) { r1 = 0 }
      try { r2 = arg2.toString().split(".")[1].length } catch (e) { r2 = 0 }
      m = Math.pow(10, Math.max(r1, r2));
      return parseFloat((arg1 * m + arg2 * m) / m);
    }
    function accMul(arg2, arg1) {
      var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
      try { m += s1.split(".")[1].length } catch (e) { }
      try { m += s2.split(".")[1].length } catch (e) { }
      return parseFloat(Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m));
    }
    function accDiv(arg1, arg2) {
      var t1 = 0, t2 = 0, r1, r2;
      try { t1 = arg1.toString().split(".")[1].length } catch (e) { }
      try { t2 = arg2.toString().split(".")[1].length } catch (e) { }
      //with (Math) {

      r1 = Number(arg1.toString().replace(".", ""));
      r2 = Number(arg2.toString().replace(".", ""));
      return parseFloat((r1 / r2) * Math.pow(10, t2 - t1));
      //}
    }

    function tipsMessage(message){
      var to= $mdToast.show(
       $mdToast
          .simple()
          .textContent(message)
          .position({
            bottom:false,
            top:true,
            right:true

          })
          .hideDelay(6000)

      );

   return to;
    }




    function alertMessage(message,ev,fn){
      return $mdDialog.show(
        $mdDialog.alert()
          .parent(angular.element(document.querySelector('body')))
          .clickOutsideToClose(true)
          .title('温馨提示')
          .textContent(message)
          .ariaLabel('温馨提示')
          .ok('确定')
          .targetEvent(ev)
      ).then(function(){
        fn && fn();
      })
    }

    function confirmMessage(message,ev,ok,cancel){
      return $mdDialog.show(
        $mdDialog.confirm()
          .title('需要您的确认')
          .textContent(message)
          .ariaLabel('需要您的确认')
          .targetEvent(ev)
          .ok(ok || '确定')
          .cancel(cancel || '取消')
      )
    }

    function copyFn(a,b,c,d){
      return angular.copy(a,b,c,d)
    }

    function errorMessage(message,errorData){
      return $mdToast.show(
        $mdToast
          .simple()
          .textContent(message+(errorData?errorData:''))
          .position({
            bottom:false,
            top:true,
            right:true
          })
          .hideDelay(3000)
      );
    }

    function getPage(param){
      return {Skip:(param.page - 1) * param.pageSize,Limit:param.pageSize};
    }
  }
})();

/**
 * Created by jiuyuong on 2016/1/22.
 */
(function(){
  'use strict';
  authToken.$inject = ["$cookies", "$rootScope", "$injector", "$q"];
  angular
    .module('app.core')
    .factory('authToken',authToken);
  /** @ngInject */
  function authToken($cookies,$rootScope,$injector,$q){
    var token,tokenInjector,_401,lastTipTime;

    tokenInjector = {
      setToken      : setToken,
      getToken      : getToken,
      request       : onHttpRequest,
      responseError : onHttpResponseError,
      on401         : on401
    };

    return tokenInjector;

    function setToken(tk){
      token = tk && tk.access_token ? (tk.token_type||'Bearer') + ' ' + tk.access_token : null;
      if(token){
        $cookies.put('token',token);
        localStorage.setItem('token',token);
      }
      else{
        $cookies.remove('token');
        localStorage.removeItem('token',token)
      }
    }

    function getToken(){
      if(!token)
        token = $cookies.get('token');
      return token;
    }

    function onHttpRequest(config){
      var  url=config.url;
      if (url.indexOf(sxt.app.api)>-1){
        var token = getToken();
        if(token && !config.headers['Authorization'])
          config.headers['Authorization'] = token;
      }
      return config;
    }

    function onHttpResponseError(rejection) {
      if (rejection.status == 401 && !rejection.config.isRetry) {
        if (_401) {
          rejection.config.isRetry = true;
          return _401.call(tokenInjector, rejection).then(function () {
            return $injector.get('$http')(rejection.config);
          }).catch(function () {
            $rootScope.$emit('user:needlogin');
            return $q.reject(rejection);
          });
        }
        else {
          $rootScope.$emit('user:needlogin');
          return $q.reject(rejection);
        }
      }
      else {
        if (rejection && rejection.status != -1 && (rejection.status >= 500 || rejection.status<200)) {
          if (!lastTipTime || new Date().getTime() - lastTipTime < 10000) {
            lastTipTime = new Date().getTime();
            $injector.invoke(['utils', function (utils) {
              utils.alert(rejection.data && rejection.data.Message ? rejection.data.Message : '网络错误');
            }]);
          }
        }
      }
      return $q.reject(rejection);
    }

    function on401(fn) {
      _401 = fn;
    }

  }
})();

/**
 * Created by jiuyuong on 2016/1/22.
 */
/**
 * Created by jiuyuong on 2016/1/22.
 */
(function(){
  'use strict';
  sxtServe.$inject = ["$q", "$window"];
  angular
    .module('app.core')
    .factory('sxt',sxtServe);
  /** @ngInject */
  function sxtServe($q,$window){
    var s = window.sxt||{},forEach = angular.forEach;
    s.invoke = invokeFn;
    s.uuid = uuidfn;
    s.plugin = {
      playYs7:playYs7
    };
    return s;

    function invokeFn(array,name, config){
      var chain = [];
      var promise = $q.when (config);
      forEach (array, function (interceptor) {
        if (interceptor[name]) {
          chain.unshift(interceptor[name]);
        }
      });

      while (chain.length) {
        var thenFn = chain.shift ();
        promise = promise.then(thenFn);
      }
      return promise;
    }

    function uuidfn(){
      var d = new Date().getTime();
      if(window.performance && typeof window.performance.now === "function"){
        d += performance.now();
      }
      var uuid = 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c=='x' ? r : (r&0x3|0x8)).toString(16);
      });
      return uuid;
    }

    function playYs7(options) {
      var q = $q.defer();
      if($window.cordova) {
        $window.cordova.plugins.sxt.playYs7(
          function (result) {
            q.resolve(result);
          }, function (result) {
            q.reject(result);
          }, options);
      }
      else{
        q.reject({error:'no cordova'});
      }
      return q.promise;
    }
  }
})();

/**
 * Created by jiuyuong on 2016/1/27.
 */

(function ()
{
    'use strict';

    msUtils.$inject = ["$window"];
    angular
        .module('app.core')
        .factory('msUtils', msUtils);

    /** @ngInject */
    function msUtils($window)
    {
        // Private variables
        var mobileDetect = new MobileDetect($window.navigator.userAgent),
            browserInfo = null;

        var service = {
            exists       : exists,
            detectBrowser: detectBrowser,
            guidGenerator: guidGenerator,
            isMobile     : isMobile,
            toggleInArray: toggleInArray
        };

        return service;

        //////////

        /**
         * Check if item exists in a list
         *
         * @param item
         * @param list
         * @returns {boolean}
         */
        function exists(item, list)
        {
            return list.indexOf(item) > -1;
        }

        /**
         * Returns browser information
         * from user agent data
         *
         * Found at http://www.quirksmode.org/js/detect.html
         * but modified and updated to fit for our needs
         */
        function detectBrowser()
        {
            // If we already tested, do not test again
            if ( browserInfo )
            {
                return browserInfo;
            }

            var browserData = [
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'Edge',
                    versionSearch: 'Edge',
                    identity     : 'Edge'
                },
                {
                    string   : $window.navigator.userAgent,
                    subString: 'Chrome',
                    identity : 'Chrome'
                },
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'OmniWeb',
                    versionSearch: 'OmniWeb/',
                    identity     : 'OmniWeb'
                },
                {
                    string       : $window.navigator.vendor,
                    subString    : 'Apple',
                    versionSearch: 'Version',
                    identity     : 'Safari'
                },
                {
                    prop    : $window.opera,
                    identity: 'Opera'
                },
                {
                    string   : $window.navigator.vendor,
                    subString: 'iCab',
                    identity : 'iCab'
                },
                {
                    string   : $window.navigator.vendor,
                    subString: 'KDE',
                    identity : 'Konqueror'
                },
                {
                    string   : $window.navigator.userAgent,
                    subString: 'Firefox',
                    identity : 'Firefox'
                },
                {
                    string   : $window.navigator.vendor,
                    subString: 'Camino',
                    identity : 'Camino'
                },
                {
                    string   : $window.navigator.userAgent,
                    subString: 'Netscape',
                    identity : 'Netscape'
                },
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'MSIE',
                    identity     : 'Explorer',
                    versionSearch: 'MSIE'
                },
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'Trident/7',
                    identity     : 'Explorer',
                    versionSearch: 'rv'
                },
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'Gecko',
                    identity     : 'Mozilla',
                    versionSearch: 'rv'
                },
                {
                    string       : $window.navigator.userAgent,
                    subString    : 'Mozilla',
                    identity     : 'Netscape',
                    versionSearch: 'Mozilla'
                }
            ];

            var osData = [
                {
                    string   : $window.navigator.platform,
                    subString: 'Win',
                    identity : 'Windows'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'Mac',
                    identity : 'Mac'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'Linux',
                    identity : 'Linux'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'iPhone',
                    identity : 'iPhone'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'iPod',
                    identity : 'iPod'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'iPad',
                    identity : 'iPad'
                },
                {
                    string   : $window.navigator.platform,
                    subString: 'Android',
                    identity : 'Android'
                }
            ];

            var versionSearchString = '';

            function searchString(data)
            {
                for ( var i = 0; i < data.length; i++ )
                {
                    var dataString = data[i].string;
                    var dataProp = data[i].prop;

                    versionSearchString = data[i].versionSearch || data[i].identity;

                    if ( dataString )
                    {
                        if ( dataString.indexOf(data[i].subString) !== -1 )
                        {
                            return data[i].identity;

                        }
                    }
                    else if ( dataProp )
                    {
                        return data[i].identity;
                    }
                }
            }

            function searchVersion(dataString)
            {
                var index = dataString.indexOf(versionSearchString);

                if ( index === -1 )
                {
                    return;
                }

                return parseInt(dataString.substring(index + versionSearchString.length + 1));
            }

            var browser = searchString(browserData) || 'unknown-browser';
            var version = searchVersion($window.navigator.userAgent) || searchVersion($window.navigator.appVersion) || 'unknown-version';
            var os = searchString(osData) || 'unknown-os';

            // Prepare and store the object
            browser = browser.toLowerCase();
            version = browser + '-' + version;
            os = os.toLowerCase();

            browserInfo = {
                browser: browser,
                version: version,
                os     : os
            };

            return browserInfo;
        }

        /**
         * Generates a globally unique id
         *
         * @returns {*}
         */
        function guidGenerator()
        {
            var S4 = function ()
            {
                return (((1 + Math.random()) * 0x10000) || 0).toString(16).substring(1);
            };
            return (S4() + S4() + S4() + S4() + S4() + S4());
        }

        /**
         * Return if current device is a
         * mobile device or not
         */
        function isMobile()
        {
            return mobileDetect.mobile();
        }

        /**
         * Toggle in array (push or splice)
         *
         * @param item
         * @param array
         */
        function toggleInArray(item, array)
        {
            if ( array.indexOf(item) === -1 )
            {
                array.push(item);
            }
            else
            {
                array.splice(array.indexOf(item), 1);
            }
        }
    }
})();

/**
 * Created by shaoshunliu on 2016/11/20.
 */
/**
 * Created by jiuyuong on 2016/1/22.
 */
/**
 * Created by jiuyuong on 2016/1/22.
 */
(function(){
  'use strict';
  sxtlocaStorage.$inject = ["$q", "$window"];
  angular
    .module('app.core')
    .factory('sxtlocaStorage',sxtlocaStorage);
  /** @ngInject */
  function sxtlocaStorage($q,$window){
    return {
      getItem:function (name) {
        return window.localStorage.getItem(name);
      },
      setItem:function (name,val) {
        window.localStorage.removeItem(name);
        window.localStorage.setItem(name,val);
      },
      removeItem:function (name) {
        window.localStorage.removeItem(name);
      },
      setObj:function (name,obj) {
        window.localStorage.removeItem(name);
        if(angular.isObject(obj)){
          window.localStorage.setItem(name,JSON.stringify(obj));
        }else {
          window.localStorage.setItem(name,null);
        }
      },
      getObj:function (name) {
        var val=window.localStorage.getItem(name);
        if (val){
          try {
            return JSON.parse(val);
          }catch(ex){
            return null;
          }
        }
        return null;
      },
      getArr:function (name) {
        var arr=this.getObj(name);
        if (!angular.isArray(arr)){
          arr=[];
        }
        return arr;
      },
      setArr:function (name,arr,compare) {
        var old=this.getArr(name);
        if (!angular.isArray(arr)){
          arr=[arr];
        }
        if (!compare){
          compare=function (item) {
              return true;
          }
        }
        arr.forEach(function (o) {
           if (old.some(function (t) {
                 return compare(t);
             })){
             old.push(o);
           }
        });
        this.setObj(name,old);
      },
      setArr2:function (name,arr,compare) {
        var old=this.getArr(name);
        if (!angular.isArray(arr)){
          arr=[arr];
        }
        if (!compare){
          compare=function (_old,_new) {
            return _new;
          }
        }
        arr=compare(old,arr);
        arr.forEach(function (o) {
          old.push(o);
        });
        this.setObj(name,old);
      },
      removeArrItem:function (db,filter) {
        var arr=this.getArr(db);
        var t=[];
        if (!filter){
          filter=function (item) {
            return true;
          }
        }
        arr.forEach(function (o) {
          if (!filter(o)){
            t.push(o);
          }
        });
        this.setObj(db,t);
      },
      removeArrItem2:function (db,filter) {
        var arr=this.getArr(db);
        if (!filter){
          filter=function (source) {
            return source;
          }
        }
        arr=filter(arr);
        this.setObj(db,arr);
      },
      clear:function () {
        window.localStorage.clear();
      }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/1/23.
 */
(function(){
  'use strict';
  localAuth.$inject = ["sxt", "$q"];
  angular
    .module('app.core')
    .factory('localAuth',localAuth);
  /** @ngInject */
  function localAuth(sxt,$q){
    var auth = {
      token:token,
      profile:profile
    };

    return auth;

    function token(user){
      return user;
    }
    function profile(token,user){
      if(!token || !token.RealName){
        if(sxt.connection.isOnline())return token;
        return $q(function(resolve) {
          sxt.cache.getProfile (function (profile) {
            resolve(profile||token);
          },user);
        });
      }
    }
  }
})();

/**
 * Created by jiuyuong on 2016/4/28.
 */
(function(angular){
  'use strict';

  angular
    .module('app.core')
    .provider('db',adapter);

  function adapter() {
    var $get;
    if (!window.cordova) {
      $get = new pouchDB().$get;
    }
    else {
      $get =new db().$get;
    }
    var self = this;
    self.$get = $get;
  }


/** @ngInject */
  function pouchDB() {

  $get.$inject = ["$window", "$q", "sxtlocaStorage"];
  var self = this;
  self.methods = {
    destroy: 'qify',
    put: 'qify',
    post: 'qify',
    get: 'qify',
    remove: 'qify',
    bulkDocs: 'qify',
    bulkGet: 'qify',
    allDocs: 'qify',
    putAttachment: 'qify',
    getAttachment: 'qify',
    removeAttachment: 'qify',
    query: 'qify',
    viewCleanup: 'qify',
    info: 'qify',
    compact: 'qify',
    revsDiff: 'qify',
    changes: 'eventEmitter',
    sync: 'eventEmitter',
    replicate: {
      to: 'eventEmitter',
      from: 'eventEmitter'
    },
    add:function () {
      var args = Array.prototype.slice.call(arguments);
      this.create(args);
    },
    addOrUpdate:function(obj){
      var self = this;
      if(obj._id){
        return self.get(obj._id).then(function(doc){
          obj._rev = doc._rev;
          return self.put(obj);
        }).catch(function(){
          return self.put(obj);
        });
      }
    },
    bulkAddOrUpdate:function(arr){
     var self=this;
     return this.findAll().then(function(o){
         var  rows= o.rows,tmp;
         arr.forEach(function(t){
            if (t._id){
              tmp=rows.find(function(e){ return t._id= e._id });
              if (tmp){
                t._rev=tmp._rev
              }
            }
         })
         return self.bulkDocs(arr);
      });
    },
    getOrAdd:function (obj) {
      var self = this;
      if(obj._id){
        return self.get(obj._id).then(function(doc){
          return doc;
        }).catch(function(){
          return self.put(obj).then(function () {
            return obj;
          });
        });
      }
    },
    update:function (obj) {
      var self = this;
      if(obj._id){
        return self.get(obj._id).then(function(doc){
          obj._rev = doc._rev;
          return self.put(obj);
        });
      }
      //this.create(Array.prototype.slice.call(arguments));
    },
    create:function(obj){
      if(!angular.isArray(obj)){
        obj = [obj];
      }
      obj.forEach(function (o) {
        if(!o._id)
          o._id = o.id;
      });
      return this.bulkDocs(obj);
    },
    delete:function (id) {
      var db = this;
      return db.get(id).then(function (doc) {
        return db.remove(doc);
      });
    },
    findAll:function (filter,options) {
      if (!options){
        options={};
      }
      if (!options.include_docs){
        options.include_docs=true;
      }
      return _allDoc.apply(this,[filter,options])
    },
    find:function (filter,option) {
      var def={include_docs:true};
      if (angular.isObject(option)){
        angular.extend(def,option);
      }
      return this.allDocs(def).then(function (result) {
        for(var i=0,l=result.rows.length;i<l;i++){
          if(!filter || filter(result.rows[i].doc)!==false){
            return result.rows[i].doc;
          }
        }
      })
    }
  };

  function _allDoc (filter,option){
    return this.allDocs(option).then(function (result) {
      var r = {
        "total_rows":result.total_rows,
        "offset":result.offset,
        "rows":[],
        "_id":result._id,
        "_rev":result._rev
      }
      for(var i=0,l=result.rows.length;i<l;i++){
        if(!filter || filter(result.rows[i].doc)!==false){
          r.rows.push(result.rows[i].doc);
        }
      }
      return r;
    })
  }

  self.$get = $get;

  /** @ngInject */
  function $get($window, $q,sxtlocaStorage) {
    // PouchDB.plugin(PouchAdapterCordovaSqlite);
    var pouchDBDecorators = {
      qify: function (fn) {
        return function () {
          return $q.when(fn.apply(this, arguments));
        }
      },
      eventEmitter: function (fn) {
        return function () {
          var deferred = $q.defer();
          var emitter = fn.apply(this, arguments)
            .on('change', function (change) {
              return deferred.notify({
                change: change
              });
            })
            .on('paused', function (paused) {
              return deferred.notify({
                paused: paused
              });
            })
            .on('active', function (active) {
              return deferred.notify({
                active: active
              });
            })
            .on('denied', function (denied) {
              return deferred.notify({
                denied: denied
              });
            })
            .on('complete', function (response) {
              return deferred.resolve(response);
            })
            .on('error', function (error) {
              return deferred.reject(error);
            });
          emitter.$promise = deferred.promise;
          return emitter;
        };
      }
    };
    function wrapMethods(db, methods, parent) {
      for (var method in methods) {
        var wrapFunction = methods[method];


        if(angular.isFunction(wrapFunction)){
          db[method] = wrapFunction;
          continue;
        }

        if (!angular.isString(wrapFunction)) {
          wrapMethods(db, wrapFunction, method);
          continue;
        }

        wrapFunction = pouchDBDecorators[wrapFunction];

        if (!parent) {
          db[method] = wrapFunction(db[method]);
          continue;
        }

        if (db[parent]&&db[parent][method]){
          db[parent][method] = wrapFunction(db[parent][method]);
        }
      }
      return db;
    }
    return function pouchDB(name) {
      var dbs= sxtlocaStorage.getItem("dbs");
      if (!dbs){
        dbs=[];
        dbs.push(name);
        sxtlocaStorage.setItem("dbs",dbs);

      }else {
        dbs=dbs.split(",");
        if (!dbs.find(function (o) {
            return name==o;
          })){
          dbs.push(name);
          sxtlocaStorage.setItem("dbs",dbs);
        }
      }
      // var db = new $window.PouchDB(name,{
      //   adapter: 'cordova-sqlite',
      //   iosDatabaseLocation: 'Library'
      // });
      var db = new $window.PouchDB(name);
      return wrapMethods(db, self.methods);
    };
  };

  function toDoc(doc) {
    if(doc instanceof Error)
      return doc;
    return doc;
  }
  function now() {
    return new Date().toISOString();
  }

  function addTimestamps(object) {
    object.updatedAt = now();
    object.createdAt = object.createdAt || object.updatedAt

    if (object._deleted) {
      object.deletedAt = object.deletedAt || object.updatedAt
    }

    return object
  }
}

  /** @ngInject */
  function db() {
    getApi.$inject = ["$q", "$window", "$cordovaFileTransfer", "$timeout", "$cordovaFile", "$rootScope"];
    var provider = this,globalDb={
      id:'sxt-global'
    };
    var poolss = {};

    function  cache() {
      var defaultOptions={
        timeout:60000
      }

      function  _cache() {
        this.cacheContainer={};
        this.options=defaultOptions;
        this.clearfun={};
      }

      _cache.prototype.setOption=function (options) {
        if (angular.isObject(options)){
          this.options=angular.extend(this.options,options)
        }
      }

      _cache.prototype.clear=function (key) {
        if (!key){
          this.cacheContainer={};
        }else {
          if (this.cacheContainer.hasOwnProperty(key)){
            this.cacheContainer[key]=null;
          }
        }

      }


      _cache.prototype.getValue=function (key) {
        var self=this;
        if (this.clearfun.hasOwnProperty(key)&&this.clearfun[key]){
          clearTimeout(this.clearfun[key]);
        }
        this.clearfun[key]=setTimeout(function () {
          self.clear(key);
        },self.options.timeout);
        if (key&&this.cacheContainer.hasOwnProperty(key)){
          return this.cacheContainer[key];
        }
        return null;
      }

      _cache.prototype.setValue=function (key,value) {
        var self=this;
        if (!key){
          return;
        }
        if (this.clearfun.hasOwnProperty(key)&&this.clearfun[key]){
          clearTimeout(this.clearfun[key]);
        }
        this.clearfun[key]=setTimeout(function () {
          self.clear(key);
        },self.options.timeout);
        self.cacheContainer[key]=value;
      }

      return new  _cache();
    }
    provider.$get = getApi;
    /** @ngInject */
    function getApi($q, $window, $cordovaFileTransfer, $timeout,$cordovaFile,$rootScope) {
      provider.cache=cache();
      provider.$q = $q;
      provider.$cordovaFileTransfer = $cordovaFileTransfer;
      provider.$timeout = $timeout;
      provider.$window = $window;
      provider.$rootScope = $rootScope;
      provider.$cordovaFile = $cordovaFile;
      return function pouchDB(name, options) {
        var dbs= window.localStorage.getItem("dbs");
        if (!dbs){
          dbs=[];
          dbs.push(name);
          window.localStorage.removeItem("dbs");
          window.localStorage.setItem("dbs",dbs);

        }else {
          dbs=dbs.split(",");
          if (!dbs.find(function (o) {
              return name==o;
            })){
            dbs.push(name);
            window.localStorage.removeItem("dbs");
            window.localStorage.setItem("dbs",dbs);
          }
        }
        return new SingleDB({
          idField:'_id',
          _id:name,
          dataType:1,
          fileField:options && options.fileField
        });
      };
    }


    function SingleDB(cfg) {
      var self = this;
      self.cfg = cfg;
      var idIsFunction = angular.isFunction(cfg.idField);
      self.idFn = function (item) {
        return angular.isObject(item) ? (idIsFunction ? cfg.idField(item) : item[cfg.idField]) : item;
      };
    }

    SingleDB.prototype.destroy = function(){
      var self = this;
      if (self.cfg.fileField){
        return provider.$q(function (resolve,reject) {
          db_findAll(self.cfg).then(function (r) {
            if (r.rows && r.rows.length){
              r.rows.forEach(function (m) {
                get_globalDb().destroy(m._id)
              })
            }
            get_globalDb().destroy(self.cfg._id).then(function () {
              resolve();
            })
          }).catch(function () {
            get_globalDb().destroy(self.cfg._id).then(function () {
              resolve();
            })

          })
        })
      }else {
        return get_globalDb().destroy(self.cfg._id);
      }

    }
    SingleDB.prototype.clear = function(){
      return get_globalDb().clear();
    }
    SingleDB.prototype.findAll = function (filter) {
      var self = this;
      return db_findAll(this.cfg, filter).then(function (r) {
        if(self.cfg.fileField && r.rows && r.rows.length){
          var task=[];
          // return $q(function (resolve,reject) {
          //
          // })
          r.rows.forEach(function (k) {
            task.push(get_globalDb().get(k._id))
          })
          return provider.$q.all(task).then(function (res) {
             r.rows=[];
             res.forEach(function (m) {
               r.rows.push(m)
             })
            return r;
          })
        }
        return r;
      });
    }
    SingleDB.prototype.delete = function (id) {
      if (!angular.isArray(id))
        id = [id];

      return db_save({
        _id: this.cfg._id,
        delete: !0,
        fileField:this.cfg.fileField,
      }, id, this.idFn);
    }
    SingleDB.prototype.addOrUpdate = function (items) {
      var cfg = this.cfg;
      if (cfg.dataType == 3)
        return db_save(this.cfg, items, this.idFn);

      if (!angular.isArray(items))
        items = [items];
      return db_save({_id: cfg._id, fileField:cfg.fileField, upload: !0}, items, this.idFn);
    }
    SingleDB.prototype.bulkAddOrUpdate=function(arr){
      return db_save(this.cfg,arr,this.idFn);
    }
    SingleDB.prototype.getOrAdd=function (obj) {
      return this.addOrUpdate(obj).then(function () {
        return obj;
      });
    };
    SingleDB.prototype.saveItems = function (result) {
      return db_save(this.cfg, result, this.idFn);
    }
    SingleDB.prototype.get = function (id) {
      var self = this;
      return self.findAll(function (item) {
        return  (id && self.idFn(item) == id) || (self.cfg.filter && self.cfg.filter(id)) ||self.cfg.single===true;
      }).then(function (r) {
        if(self.cfg.fileField && r.rows && r.rows[0]){
          return get_globalDb().get(r.rows[0]._id)
        }
        return r.rows[0];
      });
    }
    SingleDB.prototype.allDocs = function () {
      return provider.$q(function (resolve) {
        resolve();
      })
    }

    function get_globalDb() {
      if(!globalDb.db && provider.$window.cordova){
        globalDb.db = (function () {
          var cache = {}, locks = {};
          return {
            get: get,
            put: put,
            allDocs: function () {
              return provider.$q(function (resolve) {
                resolve();
              })
            },
            clear: function () {
              provider.cache.clear();
              return provider.$cordovaFile.removeRecursively(provider.$window.cordova.file.dataDirectory, "")
                .then(function (success) {
                  alert(success);
                }, function (error) {
                  console.log(error);
                });
            },
            destroy: function (id) {
              delete cache[id];
              provider.cache.clear(id);
              return provider.$q(function (resolve, reject) {
                lock(id, function (cb) {
                  if(!provider.$window.cordova){
                    resolve();
                  }
                  else {
                    provider.$cordovaFile.removeFile(provider.$window.cordova.file.dataDirectory, id + '.bin').then(function () {
                      resolve();
                      cb();
                    }).catch(function () {
                      resolve();
                      cb();
                    })
                  }
                })
              });
            }
          }
          function lock(id, doFn) {
            var cb = function () {
              var buff = locks[id];
              buff.shift();
              run();
            }, run = function () {
              var buff = locks[id];
              if (buff && buff.length) {
                if (!buff.find(function (fn) {
                    return fn.runing === true;
                  })) {
                  var fn = locks[id][0];
                  fn.runing = true;
                  fn(cb);
                }
              }
            };
            if (!locks[id]) {
              locks[id] = [];
            }
            locks[id].push(doFn);
            run();
          }

          function get(id, cfg) {
            return provider.$q(function (resolve, reject) {
              lock(id, function (cb) {
                var value=provider.cache.getValue(id);
                if (value){
                  cb();
                  resolve(value)
                }else {
                  provider.$cordovaFile.readAsText(provider.$window.cordova.file.dataDirectory,id + '.bin').then(function (result) {
                      if (!result){
                        readText(provider.$window.cordova.file.dataDirectory,id + '.bin').then(function (k) {
                          var r = provider.$window.JSON.parse(k);
                          provider.cache.setValue(id,r);
                          cb();
                          resolve(r);
                        },function () {
                          cb();
                          reject(null);
                        });
                      }else {
                        var r = provider.$window.JSON.parse(result);
                        provider.cache.setValue(id,r);
                        cb();
                        resolve(r);
                      }
                  },function () {
                    cb();
                    reject(null);
                  })
                }
              })
            });
          }




          function utf8ByteToUnicodeStr(utf8Bytes) {
            var unicodes = [];
            for (var pos = 0; pos < utf8Bytes.length;){
              var flag= utf8Bytes[pos];
              var unicode = 0 ;
              if ((flag >>>7) === 0 ) {
                unicodes.push(String.fromCharCode(utf8Bytes[pos]));
                pos += 1;

              } else if ((flag &0xFC) === 0xFC ){
                unicode = (utf8Bytes[pos] & 0x3) << 30;
                unicode |= (utf8Bytes[pos+1] & 0x3F) << 24;
                unicode |= (utf8Bytes[pos+2] & 0x3F) << 18;
                unicode |= (utf8Bytes[pos+3] & 0x3F) << 12;
                unicode |= (utf8Bytes[pos+4] & 0x3F) << 6;
                unicode |= (utf8Bytes[pos+5] & 0x3F);
                unicodes.push(String.fromCharCode(unicode));
                pos += 6;

              }else if ((flag &0xF8) === 0xF8 ){
                unicode = (utf8Bytes[pos] & 0x7) << 24;
                unicode |= (utf8Bytes[pos+1] & 0x3F) << 18;
                unicode |= (utf8Bytes[pos+2] & 0x3F) << 12;
                unicode |= (utf8Bytes[pos+3] & 0x3F) << 6;
                unicode |= (utf8Bytes[pos+4] & 0x3F);
                unicodes.push(String.fromCharCode(unicode));
                pos += 5;

              } else if ((flag &0xF0) === 0xF0 ){
                unicode = (utf8Bytes[pos] & 0xF) << 18;
                unicode |= (utf8Bytes[pos+1] & 0x3F) << 12;
                unicode |= (utf8Bytes[pos+2] & 0x3F) << 6;
                unicode |= (utf8Bytes[pos+3] & 0x3F);
                unicodes.push(String.fromCharCode(unicode));
                pos += 4;

              } else if ((flag &0xE0) === 0xE0 ){
                unicode = (utf8Bytes[pos] & 0x1F) << 12;
                unicode |= (utf8Bytes[pos+1] & 0x3F) << 6;
                unicode |= (utf8Bytes[pos+2] & 0x3F);
                unicodes.push(String.fromCharCode(unicode));
                pos += 3;

              } else if ((flag &0xC0) === 0xC0 ){ //110
                unicode = (utf8Bytes[pos] & 0x3F) << 6;
                unicode |= (utf8Bytes[pos+1] & 0x3F);
                unicodes.push(String.fromCharCode(unicode));
                pos += 2;

              } else{
                unicodes.push(String.fromCharCode(utf8Bytes[pos]));
                pos += 1;
              }
            }
            return unicodes.join('');
          }


          function readText(dir,fileName) {
            return  provider.$q(function (resolve,reject) {
              provider.$cordovaFile.readAsArrayBuffer(dir, fileName).then(function (data) {
                  var arr= new Uint8Array(data);
                  var  res=utf8ByteToUnicodeStr(arr);
                  resolve(res);

              }).catch(function (err) {
                reject(err);
              })

            })
          }

          function put(doc, cfg) {
            //if((!cfg || !cfg.upload) && !globalDb.noCache && !cfg.fileField)
            //  cache[doc._id] = doc;

            //if(cfg && cfg.upload && cache[doc._id])
            //  delete cache[doc._id];
            provider.cache.setValue(doc._id,doc);
            return provider.$q(function (resolve, reject) {
              lock(doc._id, function (cb) {
                provider.$cordovaFile.writeFile(provider.$window.cordova.file.dataDirectory, doc._id + '.bin',provider.$window.JSON.stringify(doc) , true)
                  .then(function (result) {
                    resolve(result)
                    cb();
                  }).catch(function (result) {
                  reject(result);
                  cb();
                })
              })
            });
          }
        })();
      }
      return globalDb.db || (globalDb.db = pouchdb(globalDb.id));
    }

    function db_findAll(cfg, filter) {
      var db = get_globalDb();
      return provider.$q(function (resolve, reject) {
        var result = {
          "rows": []
        };
        db.get(cfg._id,cfg).then(function (r) {
          for (var i = 0, l = r.rows.length; i < l; i++) {
            if (!filter || filter(r.rows[i]) !== false) {
              result.rows.push(r.rows[i]);
            }
          }
          resolve(result);
        }).catch(function () {
          resolve(result);
        });
      })
    }

    function copySave(obj,exFields) {
      var o = {};
      for(var k in obj){
        if(obj.hasOwnProperty(k) && exFields.indexOf(k)==-1){
          o[k] = obj[k];
        }
      }
      return o;
    }

    function db_save(cfg, result, idFn) {
      return provider.$q(function (resolve, reject) {
        var pools = poolss[cfg._id];
        if(!pools)
          pools = poolss[cfg._id] = [];
        pools.push(task(cfg,result,idFn));
        if(pools.length===1){
          run();
        }
        function run() {
          var first = pools[0];
          if(first) {
            first().then(function (r) {
              pools.shift();
              return r;
            },function (r) {
              pools.shift();
              provider.$q.reject(r);
            }).then(run, run);
          }
        }
        function task(cfg, result, idFn) {
          return function () {
            return db_save1(cfg, result, idFn).then(resolve,reject);
          }
        }
      });
    }
    function db_save1(cfg, result, idFn) {
      if(!result) return provider.$q(function (resolve, reject) {resolve()});
      var db = get_globalDb();
      return provider.$q(function (resolve, reject) {
        db.get(cfg._id,cfg).then(save_to).catch(save_to);
        function save_to(doc) {
          provider.$q(function (resolve, reject) {
            if (cfg.fileField) {
              if (!angular.isArray(cfg.fileField)) {
                cfg.fileField = [cfg.fileField];
              }
              var _saveList = [],
                nResult;
              if (angular.isArray(result)) {
                nResult = [];
                result.forEach(function (r) {
                  r._id = idFn(r);
                  _saveList.push(db.put(r, {
                    upload: true
                  }));
                  nResult.push(copySave(r, cfg.fileField));
                })
              }
              else {
                result._id = idFn(result);
                nResult = copySave(result, cfg.fileField);
                _saveList.push(db.put(result, {
                  upload: true
                }));
              }
              provider.$q.all(_saveList).then(function () {
                resolve(nResult);
              }, function () {
                resolve(nResult);
              });
            }
            else {
              resolve(result);
            }
          }).then(function (result) {
            if (!doc || !doc.rows)
              doc = {_id: cfg._id, rows: []};

            if (cfg.delete) {
              result.forEach(function (item) {
                delete_db(item, doc.rows, idFn);
              });
            }
            else {
              if (cfg.upload || cfg.dataType == 1) {
                if(angular.isArray(result))
                  replace_db(result, doc.rows, idFn);
                else
                  replace_db_single(result, doc.rows, idFn);
              }
              /*          else if (cfg.dataType == 1) {
               replace_db(result, doc.rows, idFn);
               }*/
              else if (cfg.dataType == 3) {
                if (cfg.single)
                  doc.rows = [result];
                else
                  replace_db_single(result, doc.rows, idFn);
              }
              else if (result.rows && angular.isArray(result.rows)) {
                replace_db(result.rows, doc.rows, idFn);
              }
              else if (result.data && angular.isArray(result.data)) {
                replace_db(result.data, doc.rows, idFn);
              }
              else if (result.Rows && angular.isArray(result.Rows)) {
                replace_db(result.Rows, doc.rows, idFn);
              }
            }
            return db.put(doc, cfg).then(resolve, reject);

          });
        }
      });

      function replace_db(src, dist, id) {
        src.forEach(function (item) {
          replace_db_single(item, dist, id);
        });
      }

      function replace_db_single(item, dist, id) {
        var _id = id(item), flag = false;
        for (var i = 0, l = dist.length; i < l; i++) {
          if (_id == id(dist[i])) {
            dist[i] = item;
            flag = true;
            break;
          }
        }
        if (!flag) {
          dist.push(item);
        }
      }
      function delete_db(item, dist, id) {
        var _id = id(item);
        for (var i = 0, l = dist.length; i < l; i++) {
          if (_id == id(dist[i])) {
            dist.splice(i, 1);
            break;
          }
        }
      }
    }
  }
})(angular);

/**
 * Created by shaoshunliu on 2017/2/25.
 */
(function ()
{
  'use strict';

  cacheService.$inject = ["$q", "$log", "api"];
  angular
    .module('app.core')
    .factory('cache', cacheService);

  /** @ngInject */
  function cacheService($q, $log, api)
  {
      var defaultOptions={
          timeout:60000
      }

      function  _cache() {
          this.cacheContainer={};
          this.options=defaultOptions;
          this.clearfun=null;
      }

      _cache.prototype.setOption=function (options) {
         if (angular.isObject(options)){
           this.options=angular.extend(this.options,options)
         }
      }

      _cache.prototype.clear=function (key) {
        if (!key){
          this.cacheContainer={};
        }else {
          if (this.cacheContainer.hasOwnProperty(key)){
            this.cacheContainer[key]=null;
          }
        }

      }


      _cache.prototype.getValue=function (key) {
        if (key&&this.cacheContainer.hasOwnProperty(key)){
         return this.cacheContainer[key];
        }
        return null;
      }

      _cache.prototype.setValue=function (key,value) {
          var self=this;
          if (!key){
            return;
          }
          if (this.clearfun){
            clearTimeout(this.clearfun);
          }
          this.clearfun=setTimeout(function () {
            self.clear(key);
          },self.options.timeout);
          self.cacheContainer[key]=value;
      }

      return new  _cache();
  }

})();

(function ()
{
  'use strict';

  angular
    .module('app.core')
    .provider('auth', appAuthProvider)

  /** @ngInject */
  function appAuthProvider()
  {
    // 第三方登录插件
    appAuth.$inject = ["$q", "$injector", "authToken", "$state", "$rootScope", "$location", "sxt", "api", "$http"];
    var interceptorFactories = this.interceptors = [];
    var forEach = angular.forEach,loginedUser;
    // 是否转跳的登录
    var autoLoginPath = false;

    this.$get = appAuth;

    appAuth.$injector = ['$q','$injector','authToken','$state','$rootScope','$location','sxt','$http'];

    function appAuth($q,$injector,authToken,$state,$rootScope,$location, sxt,api,$http){

      var s = {
        isLoggedIn : isLoggedIn,
        token      : token,
        profile    : profile,
        login      : login,
        getUser    : getUser,
        autoLogin  : autoLogin,
        current    : currentUser,
        logout     : logout,
        reset      : reset,
      };

      authToken.on401(function (response) {
        var self = this;
        if(!self.lastTry || (new Date().getTime()-self.lastTry)>100000){
          self.lastTry = new Date().getTime();
          autoLoginPath = true;
          return (self.lastRefresh = $q(function (resolve,reject) {
            refresh(s,response).then(function () {
              resolve();
            }).catch(function () {
              autoLoginPath =false;
              reject(response);
            });
          }));
        }
        else return self.lastRefresh || $q(function (resolve,reject) {
          reject(response);
        })
      });
/*    $rootScope.$on('sxt:online', function(event, state){
        refresh(s);
      });*/

      $rootScope.$on('user:needlogin',function(){
        $state.go('app.auth.login');
      });
      var reversedInterceptors = [];

      forEach(interceptorFactories, function(interceptorFactory) {
        reversedInterceptors.unshift($injector.get(interceptorFactory));
      });

      return s;

      //判断用户是否登录
      function isLoggedIn(){
        return !!loginedUser;
      }

      //根据用户凭据获取token
      function token(user) {
        return sxt.invoke(reversedInterceptors, 'token' ,user)
      }

      //根据token获取个人信息调用
      function profile(token) {
        return sxt.invoke(reversedInterceptors, 'profile' ,token)
      }

      function refresh(s) {
        return sxt.invoke(reversedInterceptors, 'refresh' ,s);
      }

      // 根据用户凭据登录系统
      function login(user){
        return token(user).then(function(token){
          authToken.setToken(token);
          getProfile(token,user);
        },function(){
          //$state.go('app.auth.login');
          return $q.reject("用户名或密码错误");

        });
      }

      // 根据用户token登录系统
      function getProfile(token,user){
         profile(token).then(function(profile){
           if(token == profile)
            profile = null;

           loginedUser = profile;
          if(!loginedUser) {
            //$state.go('app.auth.login');
          }
          else {
            profile.username = profile.username || profile.Id;
            profile.token = token;
            profile.user = user;
            $rootScope.$emit('user:login', profile);
            if (!autoLoginPath) {
              $state.go('app.xhsc.home')
              //$location.path('/');
            }
          }
        });
      }

      // 获取当前用户
      function getUser(){
        return $q(function(resolve){
          if(loginedUser)
            resolve(loginedUser);
          else {
            $rootScope.$on ('user:login', function () {
              resolve (loginedUser);
            });
            getProfile();
          }
        })
      }

      //修改密码
      function reset(input){
          return $http.post('http://emp.chngalaxy.com:9090/Api/User/ChangePassword',input);
        }

      // 自动登录获取，不跳转
      function autoLogin(){
        autoLoginPath = true;
        return getUser().then(function(user){
          autoLoginPath = false;
          return user;
        });
      }

      // 退出登录
      function logout() {
        $rootScope.$emit('user:logout', loginedUser);
        $state.go('app.auth.login');
        api.xhsc.logout();
      }

      function currentUser(){
        return loginedUser;
      }
    }
  }
}());


(function(){
  'use strict';

  angular
    .module('app.core')
    .provider('api', apiProvider);

  /** @ngInject */
  function apiProvider() {
    var api = {},
      provider = this,
      injector,
      cfgs=[],
      pouchdb,
      uploadDb,
      networkState = 1;

    provider.register = register;
    //provider.getNetwork = getNetwork;
    //provider.setNetwork = function (state) { networkState = state;};
    provider.$http = bindHttp({
      url:url,
      db:bindDb,
      wrap:wrap
    });
    provider.$q = function(){
      return provider.$q.$q.apply(provider,toArray(arguments));
    }



    provider.$get = getApi;
    provider.get = getServer;
    provider.setting = setting;

    getApi.$injector = ['$resource','$http','$injector','$q','db','$rootScope','$cordovaNetwork','$window','$cordovaFileTransfer','$timeout'];

    function getServer(name){
      return injector.get(name);
    }

    function getApi($resource,$http,$injector,$q,db,$rootScope,$cordovaNetwork,$window,$cordovaFileTransfer,$timeout){
      injector = $injector;
      provider.$http.$http = $http;
      provider.$q.$q = $q;
      provider.$cordovaFileTransfer = $cordovaFileTransfer;
      provider.$timeout = $timeout;
      provider.$window = $window;
      provider.$rootScope = $rootScope;
      pouchdb = db;
      resolveApi(api,$resource,$http);
      api.setting = setting;
      api.getUploadData=getUploadData;
      api.getDBs=getDBs;
      api.task = task;
      api.upload = upload;
      api.uploadTask = uploadTask;
      api.event = event;
      provider.setNetwork = api.setNetwork = function (state) {
        return provider.$q.$q(function(resolve,reject){
          networkState = state;
          if(networkState==0)
            $rootScope.$emit('sxt:online');
          else
            $rootScope.$emit('sxt:offline');
          resolve(networkState);
        })
      };
      api.getNetwork = provider.getNetwork = function () {
        return networkState;
      };
      api.resetNetwork = function () {
        var type = $window.navigator && $window.navigator.connection && $cordovaNetwork.getNetwork();
        switch (type) {
          case 'ethernet':
          case 'wifi':
            networkState = 0;
            break;
          case 'unknown':
          case 'none':
          case '2g':
          case '3g':
          case '4g':
          case 'cellular':
            networkState = 1;
            break;
          default:
            networkState = 0;
            break;
        }
        api.setNetwork(networkState);
      };
      api.wrap=wrap;
      api.useNetwork = function (state) {
        var cState,type = $window.navigator && $window.navigator.connection && $cordovaNetwork.getNetwork();
        switch (type) {
          case 'ethernet':
          case 'wifi':
          case '2g':
          case '3g':
          case '4g':
          case 'cellular':
            cState = 0;
            break;
          case 'unknown':
          case 'none':
            cState = 1;
            break;
          default:
            cState = 0;
            break;
        }
        if(state!=0 || cState==0) {
          api.oNetwork = networkState;
          networkState = state;
          api.networkState(networkState);
        }
      };
      api.resolveNetwork = function () {
        api.networkState(api.oNetwork);
      };
      api.db = provider.$http.db;
      api.clearDb = clearDb;
      api.download = download;
      return api;
    }

    function event(name,fn,scope) {
      var destroy = provider.$rootScope.$on(name,fn);
      scope && scope.$on('$destroy',destroy);
    }

    function resolveApi(p,$resource,$http){
      if(p!==api)
        p.root = api;
      angular.forEach(p,function(o,k){
        if(k === 'root' || !angular.isObject(o))return;
        if(o.method && o.args){
          if(o.method == 'custom'){
            p[k] = custom(o.args[0],p,o.fn);
          }
          else if(o.method == 'resource'){
            p[k] = $resource(o.args[0]);
          }
        }
        else{
          resolveApi(o,$resource,$http);
        }
      });
    }

    function register(name,apiObj){
      api[name] = angular.extend(api[name]||{},apiObj);
    }

    function cfg(method){
      if(method == 'custom' || method=='resource'){
        return function (){
          return {
            method : method,
            args: toArray(arguments)
          };
        }
      }
      return function () {
        var args = toArray(arguments),
          url = args[0];
        if (url.indexOf('http') == -1)
          args[0] = sxt.app.api + url;
        return provider.$http.$http[method].apply(self, args);
      };
    }


    function custom(fn,scope){
      return function (){
        var args = toArray(arguments);
        return fn.apply(scope,args);
      }
    }

    function encodeUriQuery(val, pctEncodeSpaces) {
      return encodeURIComponent(val).
      replace(/%40/gi, '@').
      replace(/%3A/gi, ':').
      replace(/%24/g, '$').
      replace(/%2C/gi, ',').
      replace(/%20/g, (pctEncodeSpaces ? '%20' : '+'));
    }

    function params(params) {
      var parts = [];
      angular.forEach(params, function (value, key) {
        if (value === null || angular.isUndefined(value)) return;
        if (!angular.isArray(value)) value = [value];

        angular.forEach(value, function (v) {
          if (angular.isDate(v)) {
            v = moment(v).format('YYYY-MM-DD')
          }
          else if (angular.isObject(v)) {
            v = angular.toJson(v);
          }
          parts.push(encodeUriQuery(key) + '=' + encodeUriQuery(v));
        });
      });
      return parts.join('&');
    }

    function url(path,args) {
      if (!args) return path;
      return path + ((path.indexOf('?') == -1) ? '?' : '&') + params(args);
    }

    /**
     *
     * @param obj
     * @returns {Object}
       */
    function bindHttp(obj) {
      return angular.extend(obj,{
        get:cfg('get'),
        put:cfg('put'),
        post:cfg('post'),
        delete:cfg('delete'),
        options:cfg('options'),
        head:cfg('head'),
        resource:cfg('resource'),
        custom:cfg('custom')
      });
    }

    function setting(key,value) {
      return provider.$q(function (resolve) {
        var settingDb= pouchdb('systemstting');
        if(value){
          settingDb.addOrUpdate({
            _id:key,
            value:value
          }).then(function () {
            resolve(value);
          });
        }
        else if(value===null){
          settingDb.delete(key).then(function (result) {
            result(result);
          }).catch(function () {
            resolve(null);
          })
        }
        else{
          settingDb.get(key).then(function (result) {
            resolve(result);
          }).catch(function () {
            resolve(null);
          });
        }
      })
    }
    function upload(filter,progress,complete,fail,options) {
      var tasks = [],
        self =this,
        groups = [];
      appendTasks(tasks,groups,filter,options).then(function (tasks) {
        self.task(tasks,options)(function (percent,current,total) {
          groups.forEach(function (g) {
            if(current>=g.end)
              g.percent = 1;
            else if(current<=g.start)
              g.percent = 0;
            else {
              g.current = current - g.start;
              g.percent = g.current * 1.0 / g.total;
            }
          });
          progress && progress(percent,current,total);
        },complete,fail,options);
      });
      return groups;
    }
    function appendTasks(tasks,groups,filter,options) {
      return provider.$q.$q(function(resolve,reject) {
        var p=[];
        cfgs.sort(function(s1,s2){
          var p1 = s1.prioirty|| 0,
            p2 = s2.prioirty||0;
          return p1 - p2;
        });
        cfgs.forEach(function (cfg) {
          if (cfg.upload && cfg.fn) {
            if (filter && filter(cfg) === false)return;
            //if (cfg.)

            var group = {
              name: cfg.name || '其它-' + cfg._id,
              start: tasks.length,
              cfg:cfg
            };
            var db = initDb(cfg)
            groups.push(group);
            p.push(db.findAll(function (item) {
              if (filter)return filter(cfg, item);
              return true;
            }));
          }
        });
        provider.$q.$q.all(p).then(function (rs) {
          var i=0;
          rs.forEach(function (result) {
            var group = groups[i++],cfg = group.cfg;
            result.rows.forEach(function (row) {
              tasks.push(function () {
                return cfg.fn.call(cfg, row).then(function (result) {
                  if (result&&result.status==200&&result.data&&!result.data.ErrorCode){
                    options.uploaded && options.uploaded(cfg,row,result);
                  }
                });
              });
            });
            group.end = tasks.length;
            group.current = 0;
            group.total = group.end - group.start;
          });
          resolve(tasks);
        }).catch(function () {
          reject();
        })
      });
    }
    function getUploadData(filter) {
      return provider.$q.$q(function (resolve,reject) {
        var p=[];
        var keys=[];
        cfgs.forEach(function (cfg) {
          if (cfg.upload && (!filter||filter(cfg))) {
            if (filter && filter(cfg) === false)return;
            var db = initDb(cfg)
            keys.push(db);
            p.push(db.findAll());
          }
        });
        provider.$q.$q.all(p).then(function (rs) {
          var arr=[];
          var i=0;
          rs.forEach(function (result) {
            if ( result.rows&& result.rows.length){
              arr.push({
                key:keys[i].name?keys[i].name:(keys[i]._db_name?keys[i]._db_name:keys[i].cfg._id),
                vals:result.rows,
                db:keys[i]
              })
            }
            i++;
          });
          resolve(arr);
        }).catch(function (err) {
          reject(err);
        });
      })
    }
    function getDBs(filter) {
      return provider.$q.$q(function (resolve,reject) {
        var p=[];
        cfgs.forEach(function (cfg) {
          if (!filter||filter(cfg)) {
            if (filter && filter(cfg) === false)return;
            var db = initDb(cfg)
            p.push(db);
          }
        });
        resolve(p)
      })
    }
    function download(tasks) {
      var oNetworkState = networkState;
      networkState = 0;
      var t = task(tasks);

      return function (progress,success,fail,options) {
        return t(progress,function () {
          networkState = oNetworkState;
          success && success();
        },function () {
          networkState = oNetworkState;
          fail && fail();
        },options);
      };
    }
    function donwfile(dir,uname,url) {

      return provider.$q.$q(function (resolve) {
        if (provider.$window.cordova) {
          var rootPath = provider.$window.cordova.file.dataDirectory + '/' + dir + '/';
          provider.$cordovaFileTransfer.download(url, rootPath + uname).then(function (r) {
            resolve();
          }).catch(function (err) {
            resolve();
          });
        }
        else {
          resolve();
        }
      })
    }
    function task(tasks,config) {
      return function start(progress,success,fail,options) {
        run(0,progress,success,fail,options);
      }
      function run(i,progress,success,fail,options) {
        var len = tasks.length,fn = tasks[i];
        if(config && config.event)
          provider.$rootScope.$emit(config.event,{
            target:config.target,
            event:'progress',
            percent:i * 1.0 / len,
            current:i,
            total:len
          });

        if (!progress || progress(i * 1.0 / len, i, len) !== false) {
          if (!fn) {
            if(config && config.event)
              provider.$rootScope.$emit(config.event,{
                target:config.target,
                event:'success'
              });
            success && success(tasks);
          }
          else {
            var d = new Date().getTime(),next = function () {
              run(i + 1, progress, success, fail, options);
            };
            var isTimeout=false;
            provider.$timeout(function(){
              if (!isTimeout){
                isTimeout=true;
                if(config && config.event)
                  provider.$rootScope.$emit(config.event,{
                    target:config.target,
                    event:'fail'
                  });
                fail && fail(true);
              }
            },60000);
            fn(tasks,donwfile).then(function (k) {
              if (!isTimeout){
                isTimeout=true;
                if(d && !next.r) {
                  d = 0;
                  next.r = true;
                  next();
                }
              }
            }).catch(function (err) {
              isTimeout=true;
              d = 0;
              if(config && config.event)
                provider.$rootScope.$emit(config.event,{
                  target:config.target,
                  event:'fail'
                });
              fail && fail();
            });
          }
        }
      }
    }
    function uploadTask(itemOrFilter,value) {
      return provider.$q(function (resolve) {
        if (!uploadDb) {
          uploadDb = pouchdb('systemupload');
        }
        if(!angular.isFunction(itemOrFilter)){
          if(networkState==1) {
            uploadDb.addOrUpdate(itemOrFilter).then(function () {
              resolve(itemOrFilter);
            });
          }
          else{
            resolve(itemOrFilter);
          }
        }
        else{
          uploadDb.findAll(itemOrFilter).then(function (result) {
            if(value===null){
              result.rows.forEach(function (row) {
                uploadDb.remove(row);
              });
            }
            resolve(result);
          }).catch(function () {
            resolve(null);
          });
        }
      })
    }

    function wrap(cfg) {

      function cfgSet(config) {
        var _cfg=$.extend(true,{},cfg,config);
        _cfg=bindDb(_cfg)
        function f() {
          var args = toArray(arguments);
          if (!_cfg.offline){
            return _cfg.fn.apply(_cfg,args);
          }
          var excute=_cfg.bind(_cfg.fn,_cfg.callback);
          return excute.apply(_cfg,args);
        }
        return f;
      }
      var  cfg=bindDb(cfg);
      function f() {
        var args = toArray(arguments);
        if (!cfg.offline){
           return cfg.fn.apply(cfg,args);
        }
        var excute=cfg.bind(cfg.fn,cfg.callback);
        return excute.apply(cfg,args);
      }
      f.cfgSet=cfgSet;
      return f;
    }

    /**
     * 绑定配置
     * @param cfg
       * @returns {*}
       */
    function bindDb (cfg) {
      if (cfg.methods) {
        var o = {}, methods = cfg.methods;
        delete cfg.methods;
        for (var k in methods) {
          o[k] = bindDb(angular.extend(angular.copy(cfg), methods[k])).bind(methods[k].fn);
        }
        return o;
      }
      else {
        cfgs.push(cfg);
        cfg.bind = function (fn, cb) {
          cfg.fn = fn;
          cfg.mode = cfg.mode || 0;
          var callFn = function () {
            var args = toArray(arguments),
              lodb = initDb(cfg,args),
              caller = this;
            if (cfg.mode == 1) { //1 离线优先，无离线数据尝试网络；
              var oRaiseError = cfg.raiseError;
              cfg.raiseError = true;
              return userOffline(caller, lodb, args, cb, fn).catch(function () {
                return userNetwork(caller, lodb, args, cb, fn).then(function (r) {
                  cfg.raiseError = oRaiseError;
                  return r;
                });
              });
            }
            else if (cfg.mode == 2) { //2 网络优先，无网络尝试离线数据
              return userNetwork(caller, lodb, args, cb, fn).catch(function () {
                return userOffline(caller, lodb, args, cb, fn);
              })
            }
            else {  //0 有网络只走网络，没网络只走离线；
              if (cfg.local || !cfg.fn || provider.getNetwork() == 1) {
                return userOffline(caller, lodb, args, cb, fn);
              }
              else {
                return userNetwork(caller, lodb, args, cb, fn);
              }
            }
          }
          callFn.cfg = cfg;
          callFn.db = function () {
            return initDb(cfg, toArray(arguments));
          }
          return callFn;
        };
        return cfg;
      }



      function id(d, db, args, cfg, cb) {
        return provider.$q.$q(function (resolve,reject) {
          var _id = angular.isFunction(cfg.idField) ? cfg.idField(d,args) : (d[cfg.idField]?d[cfg.idField]:cfg.idField);
          if (_id && db){
            return db.addOrUpdate(cfg.data ? cfg.data.apply(cfg, [angular.extend({_id: _id}, d)].concat(args))
              : angular.extend({_id: _id}, d)).then(function (defer) {
              if (cb && cb(defer));
              resolve(_id);
            }).catch(function (r) {
              reject(_id);
            })
          }else {
            resolve(_id);
          }
        })
      }

      function bindData(result, rows, cfg) {
        switch (cfg.dataType) {
          case 1:
            result.data = rows;
            break;
          case 2:
            result.data = {rows: rows};
            break;
          case 3:
            result.data = rows[0];
            break;
          case 4:
            result.data = {
              data: rows
            };
            break;
          case 5:
            result.data = {
              Rows: rows
            };
            break;
        }
        return result;
      }

      function _task(task) {
        return provider.$q.$q(function (resolve,reject) {
          if (!angular.isArray(task)||!task.length){
            resolve();
            return;
          }
          var len=task.length;
          function  execute(fn,index) {
            fn(task,index).then(function () {
              if (index>0){
                execute(task[index-1],index-1);
              }else {
                resolve();
              }
            }).catch(function () {
               reject();
            });
          }
          execute(task[task.length-1],task.length-1);
        });
      }

      function userOffline(caller, lodb, args, cb, fn) {
        var p2 = provider.$q.$q(function (resolve, reject) {
          if (!cfg._id&&!lodb) {
            resolve(bindData({}, [], cfg));
          }
          else if (cfg.delete) {
            var tasks=[];
            args.forEach(function (d) {
              tasks.push(function (arr,index) {
                return lodb.delete((angular.isFunction(cfg.idField) ? cfg.idField(d,args) : (d[cfg.idField]?d[cfg.idField]:cfg.idField)) || d)
              })
            });
            _task(tasks).then(function () {
              resolve(args);
            }).catch(function () {
              reject(args);
            });
          }
          else if (cfg.upload) {
            var updates = [];
            args.forEach(function (d) {
              updates.push(function (arr,index) {
                return id(d, lodb, args, cfg)
              });
            });
            _task(updates).then(function () {
              resolve({data:{ErrorCode:0,args:args}});
            }).catch(function (r) {
              console.log(r);
              reject(r);
            });
            // provider.$q.$q.all(updates).then(function () {
            //   resolve({data:{ErrorCode:0,args:args}});
            // });
          }
          else {
            var result = {};
            if (cfg.dataType == 3) {
              if ((args.length == 1 && !cfg.filter) || cfg.firstIsId) {
                lodb.get(args[0]).then(function (r) {
                  if (r || !cfg.raiseError) {
                    result.data = r;
                    resolve(result);
                  }
                  else {
                    reject();
                  }
                }).catch(function (r) {
                  result.data = r;
                  reject(result);
                });
              }
              else {
                lodb.findAll(function (item) {
                  if (cfg.filter)
                    return cfg.filter.apply(cfg, [item].concat(args));
                  return true;
                }, cfg.search, args).then(function (r) {
                  result.data = r.rows[0];
                  if (!cfg.raiseError || result.data)
                    resolve(result);
                  else
                    reject(result);
                })
              }
            }
            else {
              lodb.findAll(function (item) {
                if (cfg.filter)
                  return cfg.filter.apply(cfg, [item].concat(args));
                return true;
              }, cfg.search, args).then(function (r) {
                if (cfg.raiseError && !r.rows.length) {
                  reject(result);
                }
                else {
                  bindData(result, r.rows, cfg);
                  resolve(result);
                }
              });
            }
          }
        });
        return cb ? p2.then(function (result) {
          return cb.call(caller, result, cfg, args);
        }) : p2;
      }

      function userNetwork(caller, lodb, args, cb, fn) {
        var q = provider.$q.$q(function (resolve, reject) {
          var p = fn && fn.apply(caller, args);
          if (p) {
            p.then(function (result) {
              if(result && ((result.status>=200 && result.status<=299) || result.data)) {
                if (result.data) {
                  var data = result.data;
                  data.data=data.data?data.data:data.Data;
                  if (!data.data){
                    data.data={};
                  }
                  if (cfg.dataType == 1) {
                    var arr=[];
                    data.forEach(function (d) {
                      arr.push(function (arr,index) {
                        return id(d, lodb, args, cfg);
                      })
                    })
                    _task(arr).then(function () {
                      resolve(result);
                    }).catch(function () {
                      reject(result);
                    });
                  }
                  else {
                    if (cfg.dataType == 3) {
                      id(data, lodb, args, cfg).then(function () {
                        resolve(result);
                      }).catch(function () {
                        reject(result);
                      });
                    }
                    else if (data.rows && angular.isArray(data.rows)) {
                      var  arr=[];
                      data.rows.forEach(function (d) {
                        arr.push(function () {
                          return id(d, lodb, args, cfg);
                        })
                      })
                      arr.then(function () {
                        resolve(result);
                      }).catch(function () {
                        reject(result);
                      })
                    }
                    else if (data.data && angular.isArray(data.data)) {
                      data.data.forEach(function (d) {
                        arr.push(function () {
                          return id(d, lodb, args, cfg);
                        })
                      })
                      arr.then(function () {
                        resolve(result);
                      }).catch(function () {
                        reject(result);
                      })
                    }
                    else if (data.Rows && angular.isArray(data.Rows)) {
                      data.Rows.forEach(function (d) {
                        arr.push(function () {
                          return id(d, lodb, args, cfg);
                        })
                      })
                      arr.then(function () {
                        resolve(result);
                      }).catch(function () {
                        reject(result);
                      })
                    }else {
                      resolve(result);
                    }
                  }

                }
                else {
                  resolve(result);
                }
              }
              else {
                  reject(result);
                }
              }).catch(function () {
              reject()
            })
          }
          else {
            resolve();
          }
        })
        return q && cb ? q.then(function (result) {
          return cb.call(caller, result, cfg, args);
        }) : q;
      }
    }

    function initDb(cfg,args) {
      var  localBD;
      if(cfg._id && cfg.db)
        localBD= cfg.db;
      if(cfg._id)
        localBD= cfg.db = pouchdb(cfg._id,cfg);
      else if(cfg.db){
        var id = cfg.db.apply(cfg,args);
        if(id)
          localBD= cfg._db=pouchdb(id,cfg);
      }
      return localBD;
    }


    function getNetwork() {
      return networkState;
    }
    function toArray(args) {
      return Array.prototype.slice.call(args);
    }

    function clearDb(progress,complete,fail,options) {
      var files=['weekInspectionProblemRecordFile','InspectionProblemRecordFile','cycleInspectionProblemRecordFile','yfInspectionProblemRecordFile'];
      var tasks = [];
      task([function (tasks) {
        return provider.$q.$q(function (resove,reject) {
          var dbs= window.localStorage.getItem("dbs");
          if (dbs){
            dbs=dbs.split(",");
            dbs= dbs.filter(function (o) {
              return o.toString()!="undefined"&&o.toString()!="NaN";
            })
            dbs.forEach(function (t) {

              if(!(options.exclude && options.exclude.indexOf(t)!=-1)){
                tasks.push(function(){
                  var option={}
                  if(files.find(function (k) {
                      return k==t;
                    }))
                    option.fileField=[];
                  return pouchdb(t,option).destroy().catch(function(err){
                  });
                });
              }
            });
          }
          resove();
        })
      }],options)(progress,complete,fail,options);
    }
  }

})();

(function ()
{
    'use strict';

    apiResolverService.$inject = ["$q", "$log", "api"];
    angular
        .module('app.core')
        .factory('apiResolver', apiResolverService);

    /** @ngInject */
    function apiResolverService($q, $log, api)
    {
        var service = {
            resolve: resolve
        };

        return service;

        //////////
        /**
         * Resolve api
         * @param action
         * @param parameters
         */
        function resolve(action, parameters)
        {
            var actionParts = action.split('@'),
                resource = actionParts[0],
                method = actionParts[1],
                params = parameters || {};

            if ( !resource || !method )
            {
                $log.error('apiResolver.resolve requires correct action parameter (ResourceName@methodName)');
                return false;
            }

            // Create a new deferred object
            var deferred = $q.defer();

            // Get the correct api object from api service
            var apiObject = getApiObject(resource);

            if ( !apiObject )
            {
                $log.error('Resource "' + resource + '" is not defined in the api service!');
                deferred.reject('Resource "' + resource + '" is not defined in the api service!');
            }
            else
            {
                apiObject[method](params,

                    // Success
                    function (response)
                    {
                        deferred.resolve(response);
                    },

                    // Error
                    function (response)
                    {
                        deferred.reject(response);
                    }
                );
            }

            // Return the promise
            return deferred.promise;
        }

        /**
         * Get correct api object
         *
         * @param resource
         * @returns {*}
         */
        function getApiObject(resource)
        {
            // Split the resource in case if we have a dot notated object
            var resourceParts = resource.split('.'),
                apiObject = api;

            // Loop through the resource parts and go all the way through
            // the api object and return the correct one
            for ( var l = 0; l < resourceParts.length; l++ )
            {
                if ( angular.isUndefined(apiObject[resourceParts[l]]) )
                {
                    $log.error('Resource part "' + resourceParts[l] + '" is not defined!');
                    apiObject = false;
                    break;
                }

                apiObject = apiObject[resourceParts[l]];
            }

            if ( !apiObject )
            {
                return false;
            }

            return apiObject;
        }
    }

})();
(function ()
{
    'use strict';

    angular
        .module('app.core')
        .filter('filterByTags', filterByTags)
        .filter('filterSingleByTags', filterSingleByTags);

    /** @ngInject */
    function filterByTags()
    {
        return function (items, tags)
        {
            if ( items.length === 0 || tags.length === 0 )
            {
                return items;
            }

            var filtered = [];

            items.forEach(function (item)
            {
                var match = tags.every(function (tag)
                {
                    var tagExists = false;

                    item.tags.forEach(function (itemTag)
                    {
                        if ( itemTag.name === tag.name )
                        {
                            tagExists = true;
                            return;
                        }
                    });

                    return tagExists;
                });

                if ( match )
                {
                    filtered.push(item);
                }
            });

            return filtered;
        };
    }

    /** @ngInject */
    function filterSingleByTags()
    {
        return function (itemTags, tags)
        {
            if ( itemTags.length === 0 || tags.length === 0 )
            {
                return;
            }

            if ( itemTags.length < tags.length )
            {
                return [];
            }

            var filtered = [];

            var match = tags.every(function (tag)
            {
                var tagExists = false;

                itemTags.forEach(function (itemTag)
                {
                    if ( itemTag.name === tag.name )
                    {
                        tagExists = true;
                        return;
                    }
                });

                return tagExists;
            });

            if ( match )
            {
                filtered.push(itemTags);
            }

            return filtered;
        };
    }

})();
(function () {
  'use strict';

  nav.$inject = ["$stateParams", "$rootScope", "auth"];
  angular
    .module('app.core')
    .filter('nav', nav);

  /** @ngInject */
  function nav($stateParams, $rootScope,auth) {
    var user = auth.current();
    console.log(user);
    return function (items) {
      if (!user) {
        return [];

      }
      else {
        var list = items.filter(function (item) {
          var allow = true;
          // if (item.state=="app.enterprise.sysadmin.project"){
          if (item.allow) {
            allow = !!item.allow.find(function (allow) {
              switch (allow.user) {
                case 'm':
                  item.children = item.children.filter(function(c){
                    return !!c.allow.find(function (a) {
                      return (user.Role.MemberType|a.memberType) == a.memberType && user.Role.MemberType != 0;
                    });
                  });
                  return (user.Role.MemberType|allow.memberType) == allow.memberType && user.Role.MemberType != 0;
                break;
              }
            });
          }
          return allow;
        });
        return list;
      }
    };
  }

})();

(function ()
{
    'use strict';

    toTrustedFilter.$inject = ["$sce"];
    angular
        .module('app.core')
        .filter('toTrusted', toTrustedFilter)
        .filter('htmlToPlaintext', htmlToPlainTextFilter)
        .filter('nospace', nospaceFilter)
        .filter('humanizeDoc', humanizeDocFilter);

    /** @ngInject */
    function toTrustedFilter($sce)
    {
        return function (value)
        {
            return $sce.trustAsHtml(value);
        };
    }

    /** @ngInject */
    function htmlToPlainTextFilter()
    {
        return function (text)
        {
            return String(text).replace(/<[^>]+>/gm, '');
        };
    }

    /** @ngInject */
    function nospaceFilter()
    {
        return function (value)
        {
            return (!value) ? '' : value.replace(/ /g, '');
        };
    }

    /** @ngInject */
    function humanizeDocFilter()
    {
        return function (doc)
        {
            if ( !doc )
            {
                return;
            }
            if ( doc.type === 'directive' )
            {
                return doc.name.replace(/([A-Z])/g, function ($1)
                {
                    return '-' + $1.toLowerCase();
                });
            }
            return doc.label || doc.name;
        };
    }

})();
(function ()
{
    'use strict';

    hljsDirective.$inject = ["$timeout", "$q", "$interpolate"];
    angular
        .module('app.core')
        .directive('hljs', hljsDirective);

    /** @ngInject */
    function hljsDirective($timeout, $q, $interpolate)
    {
        return {
            restrict: 'EA',
            compile : function (tElement, tAttrs)
            {
                var code;
                //No attribute? code is the content
                if ( !tAttrs.code )
                {
                    code = tElement.html();
                    tElement.empty();
                }

                return function (scope, iElement, iAttrs)
                {
                    if ( iAttrs.code )
                    {
                        // Attribute? code is the evaluation
                        code = scope.$eval(iAttrs.code);
                    }
                    var shouldInterpolate = scope.$eval(iAttrs.shouldInterpolate);

                    $q.when(code).then(function (code)
                    {
                        if ( code )
                        {
                            if ( shouldInterpolate )
                            {
                                code = $interpolate(code)(scope);
                            }

                            var contentParent = angular.element(
                                '<pre><code class="highlight" ng-non-bindable></code></pre>'
                            );

                            iElement.append(contentParent);

                            // Defer highlighting 1-frame to prevent GA interference...
                            $timeout(function ()
                            {
                                render(code, contentParent);
                            }, 34, false);
                        }
                    });

                    function render(contents, parent)
                    {
                        var codeElement = parent.find('code');
                        var lines = contents.split('\n');

                        // Remove empty lines
                        lines = lines.filter(function (line)
                        {
                            return line.trim().length;
                        });

                        // Make it so each line starts at 0 whitespace
                        var firstLineWhitespace = lines[0].match(/^\s*/)[0];
                        var startingWhitespaceRegex = new RegExp('^' + firstLineWhitespace);

                        lines = lines.map(function (line)
                        {
                            return line
                                .replace(startingWhitespaceRegex, '')
                                .replace(/\s+$/, '');
                        });

                        var highlightedCode = hljs.highlight(iAttrs.language || iAttrs.lang, lines.join('\n'), true);
                        highlightedCode.value = highlightedCode.value
                            .replace(/=<span class="hljs-value">""<\/span>/gi, '')
                            .replace('<head>', '')
                            .replace('<head/>', '');
                        codeElement.append(highlightedCode.value).addClass('highlight');
                    }
                };
            }
        };
    }
})();
/**
 * Created by jiuyuong on 2016/5/9.
 */
(function () {
  'use strict';
  angular
    .module('app.core')
    .directive('fastClick',fastClick);

  /** @ngInject */
  function fastClick() {
    var fn = function(scope,attr) {
      scope.$apply(function() {
        scope.$eval(attr.fastClick);
      });
    };
    return {
      link:link
    };
    function link(scope,element,attr) {
      element.on('touchstart', function(event) {
        scope._usingTouch = true;
        fn(scope,attr);
      });

      element.on('click',function (event) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
      })
      element.on('mousedown', function(event) {
        if(!scope._usingTouch)
          fn(scope,attr);
      });
    }

  }
})();

(function ()
{
    'use strict';

    angular
        .module('app.core')
        .provider('fuseConfig', fuseConfigProvider);

    /** @ngInject */
    function fuseConfigProvider()
    {
        // Default configuration
        var fuseConfiguration = {
            'disableCustomScrollbars'        : false,
            'disableMdInkRippleOnMobile'     : true,
            'disableCustomScrollbarsOnMobile': true
        };

        // Methods
        this.config = config;

        //////////

        /**
         * Extend default configuration with the given one
         *
         * @param configuration
         */
        function config(configuration)
        {
            fuseConfiguration = angular.extend({}, fuseConfiguration, configuration);
        }

        /**
         * Service
         */
        this.$get = function ()
        {
            var service = {
                getConfig: getConfig,
                setConfig: setConfig
            };

            return service;

            //////////

            /**
             * Returns a config value
             */
            function getConfig(configName)
            {
                if ( angular.isUndefined(fuseConfiguration[configName]) )
                {
                    return false;
                }

                return fuseConfiguration[configName];
            }

            /**
             * Creates or updates config object
             *
             * @param configName
             * @param configValue
             */
            function setConfig(configName, configValue)
            {
                fuseConfiguration[configName] = configValue;
            }
        };
    }

})();

(function ()
{
    'use strict';

    config.$inject = ["$translatePartialLoaderProvider"];
    angular
        .module('app.toolbar', [])
        .config(config);

    /** @ngInject */
    function config($translatePartialLoaderProvider)
    {
        $translatePartialLoaderProvider.addPart('app/toolbar');
    }
})();

(function ()
{
    'use strict';

    ToolbarController.$inject = ["$rootScope", "xhscService", "$mdSidenav", "$translate", "$mdToast", "auth", "$state", "sxtlocaStorage", "$mdDialog", "remote", "$http"];
    angular
        .module('app.toolbar')
        .controller('ToolbarController', ToolbarController);

    /** @ngInject */
    function ToolbarController($rootScope, xhscService,$mdSidenav, $translate, $mdToast, auth, $state,sxtlocaStorage,$mdDialog,remote,$http)
    {
    resetPasswordController.$inject = ["$rootScope", "$state", "$scope", "api", "utils", "auth", "$timeout", "$mdDialog", "remote", "$q", "$http"];
        var vm = this;
        vm.is = isRoute;
      $rootScope.toggle = false;
      vm.role='';
      vm.OUType='';
      xhscService.getProfile().then(function(profile){
        vm.role=profile.role;
        vm.OUType=profile.ouType;
        vm.user=profile.user;
      });

      // remote.profile().then(function(r){
      //      if (r.data&& r.data.Role){
      //        vm.user=r.data;
      //        vm.role= r.data.Role.MemberType===0||r.data.Role.MemberType?r.data.Role.MemberType:-100;
      //        vm.OUType=r.data.Role.OUType===0||r.data.Role.OUType?r.data.Role.OUType:-100;
      //      }
      //   });

        // auth.getUser().then(function(user){
        //   vm.user = user;
        // });
        $rootScope.$on('user:logout',function(user){
          vm.user = null;
          sxtlocaStorage.setObj("profile", null)
        });
        // Data
        $rootScope.global = {
            search: ''
        };

        vm.back=function () {
          $rootScope.$emit("back")
        }

      $rootScope.toLeft = function(){
          $rootScope.$emit('leftEvent');
        }
      $rootScope.toRight = function(){
          $rootScope.$emit('rightEvent');
        }
      $rootScope.toggleRight = function(){
          $rootScope.$emit('toggleRightEvent');
      }
        vm.bodyEl = angular.element('body');
        vm.userStatusOptions = [
            {
                'title': '在线',
                'icon' : 'icon-checkbox-marked-circle',
                'color': '#4CAF50'
            },
            {
                'title': '忙碌',
                'icon' : 'icon-clock',
                'color': '#FFC107'
            },
            {
                'title': '请勿打扰',
                'icon' : 'icon-minus-circle',
                'color': '#F44336'
            },
            {
                'title': '隐身',
                'icon' : 'icon-checkbox-blank-circle-outline',
                'color': '#BDBDBD'
            },
            {
                'title': '离线',
                'icon' : 'icon-checkbox-blank-circle-outline',
                'color': '#616161'
            }
        ];
        vm.languages = {
            en: {
                'title'      : 'English',
                'translation': 'TOOLBAR.ENGLISH',
                'code'       : 'en',
                'flag'       : 'us'
            },
            cn: {
                'title'      : '中文',
                'translation': 'TOOLBAR.SPANISH',
                'code'       : 'cn',
                'flag'       : 'cn'
            }
        };

        // Methods
        vm.toggleSidenav = toggleSidenav;
        vm.logout = logout;
        vm.changeLanguage = changeLanguage;
        vm.setUserStatus = setUserStatus;
        vm.toggleHorizontalMobileMenu = toggleHorizontalMobileMenu;
        vm.resetPassword = resetPassword;

        //////////

        init();

        /**
         * Initialize
         */
        function init()
        {
            // Select the first status as a default
            vm.userStatus = vm.userStatusOptions[0];

            // Get the selected language directly from angular-translate module setting
            vm.selectedLanguage = vm.languages[$translate.preferredLanguage()];
        }

        function isRoute(route){
           return $state.includes(route);
        }

        vm.active_selected=function(route){
          vm.current_active=route;
        }
        vm.current_active="app.xhsc.home";





        /**
         * Toggle sidenav
         *
         * @param sidenavId
         */
        function toggleSidenav(sidenavId)
        {
            $mdSidenav(sidenavId).toggle();
        }

        /**
         * Sets User Status
         * @param status
         */
        function setUserStatus(status)
        {
            vm.userStatus = status;
        }

        /**
         * Logout Function
         */
        function logout()
        {
            auth.logout();
        }

        /**
         * Change Language
         */
        function changeLanguage(lang)
        {
            vm.selectedLanguage = lang;

            /**
             * Show temporary message if user selects a language other than English
             *
             * angular-translate module will try to load language specific json files
             * as soon as you change the language. And because we don't have them, there
             * will be a lot of errors in the page potentially breaking couple functions
             * of the template.
             *
             * To prevent that from happening, we added a simple "return;" statement at the
             * end of this if block. If you have all the translation files, remove this if
             * block and the translations should work without any problems.
             */
            //if ( lang.code !== 'en' )
            //{
            //    var message = 'Fuse supports translations through angular-translate module, but currently we do not have any translations other than English language. If you want to help us, send us a message through ThemeForest profile page.';
            //
            //    $mdToast.show({
            //        template : '<md-toast id="language-message" layout="column" layout-align="center start"><div class="md-toast-content">' + message + '</div></md-toast>',
            //        hideDelay: 7000,
            //        position : 'top right',
            //        parent   : '#content'
            //    });
            //
            //    return;
            //}

            // Change the language
            $translate.use(lang.code);
        }

        /**
         * Toggle horizontal mobile menu
         */
        function toggleHorizontalMobileMenu()
        {
            vm.bodyEl.toggleClass('ms-navigation-horizontal-mobile-menu-active');
        }
      function resetPassword(ev, item) {
      $mdDialog.show({
        controller: resetPasswordController,
        templateUrl: 'app/main/auth/components/reset-password.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        locals: {
          model: angular.copy(item)
        },
        clickOutsideToClose: false
      }).then(function () {
      }, function () {
      });
    };
    function resetPasswordController($rootScope, $state, $scope, api, utils, auth, $timeout, $mdDialog,remote,$q,$http) {
      var vm = this;
      init();

      $scope.sending = false;
      $scope.send = function () {
        if ($scope.sending) return;
        $scope.timing = 60;
        $scope.sending = 'S后重新发送';
        api.auth.verificationCode.post({ identitySign: $scope.d.LoginID, type: 'ResetPassword' }).then(function () {
          $timeout(function () {
            updateTime();
          }, 1000);
        });
      }

      function updateTime() {
        $scope.timing--;
        if ($scope.timing == 0) {
          $scope.sending = false;
          $scope.timing = 0;
        } else {
          $timeout(function () {
            updateTime();
          }, 1000);
        }
      }

      $scope.submit = function () {
        if ($scope.d.NewPassword.length < 6) {
          $scope.resetError = '*新密码不少于6位字符';
          return;
        }

        if ($scope.d.NewPassword !== $scope.d.passwordConfirm) {
          $scope.resetError = '*两次输入的密码不一致';
          return;
        }
        // auth.reset({
        //   LoginID: $scope.d.username,
        //   CurrentPassword: $scope.d.oldPassword,
        //   NewPassword: $scope.d.newPassword,
        //   IsSaveButtonClick:true
        // }).then(function (r) {
        //   $mdDialog.cancel();
        //   $rootScope.$emit('user:needlogin');
        // }, function (reject) {
        //   $scope.resetError = '*原密码不正确';
        // })
        $http({
        method  : 'POST',
        url     : 'http://emp.chngalaxy.com:9090/Api/User/ChangePassword',
        data    : $.param($scope.d),  // pass in data as strings
        headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  // set the headers so angular passing info as form data (not request payload)
      }).then(function (r) {
        console.log(r)
        if(r.data.ErrorMessage=="密码验证失败"){
          $scope.resetError = '*原密码不正确';
        }else if(r.data.ErrorMessage=="修改密码成功"){
          $scope.resetTrue = '修改成功,即将跳转到登录页';
          setTimeout(function(){
            $mdDialog.cancel(),
            $rootScope.$emit('user:needlogin')
          },3000)
        }
        })
      }

     function init() {
      var pro=[
          remote.profile()
        ];
        $q.all(pro).then(function(r){
          console.log(r)
          var role=r[0];
          if (role&&role.data&&role.data){
                      $scope.d = {
              LoginID:role.data.UserName,
              IsSaveButtonClick:true,
              IsSaveCloseButtonClick:null,
              IsEdit:true
            }
          }
        });
      }

      $scope.cancel = function () {
        $mdDialog.cancel();
      };
    }
    }

})();

(function ()
{
    'use strict';

    TopToolbarController.$inject = ["$scope", "api", "$rootScope", "remote", "$state", "$timeout", "utils", "delopy"];
    angular
        .module('app.toolbar')
        .controller('TopToolbarController', TopToolbarController);

    /** @ngInject */
    function TopToolbarController($scope,api,$rootScope,remote,$state,$timeout,utils,delopy) {
      var vm=this;
      vm.is = isRoute;
      function isRoute(route){
        return $state.includes(route);
      }
      $rootScope.$on('sxt:online', function(event, state){
        vm.networkState = api.getNetwork();
      });
      $rootScope.$on('sxt:offline', function(event, state){
        vm.networkState = api.getNetwork();
      });
      vm.networkState = api.getNetwork();
      vm.setNetwork = function () {
        vm.networkState = vm.networkState==0?1:0;
        api.setNetwork(vm.networkState);
      }

      $scope.ok=function () {
        $rootScope.$emit("ok")
      }

      $scope.goBack = function(){
        if ($rootScope.$$listeners&&$rootScope.$$listeners.goBack&&$rootScope.$$listeners.goBack.length>0){
          $rootScope.$emit("goBack");
          return;
        }

        history.go(-1);//返回
      }
/*      remote.Project.Area.query().then(function(result){
        vm.Areas = result.data;
        vm.selectedArea = vm.Areas[0];
      })*/

      vm.change = function(){
        $rootScope.$emit('areaSelect',vm.selectedArea)
      }
      vm.sendGxResult = function(){
        $rootScope.$emit('sendGxResult')
      }
      vm.sendClResult = function(){
        $rootScope.$emit('sendClResult')
      }
      vm.operateMsg = function(){
        $rootScope.$emit('operateMsg');
      }
      var updateVison= $rootScope.$on('updateVison:begion', function (s,v) {
         vm.updateVison=true;
      });

       var extract=  $rootScope.$on('extract:over',function () {
         vm.updateVison=false;
         utils.alert('新版本已经更新到本地，在程序下次启动的时候生效')
       });

      $scope.$on("$destroy",function(){
        updateVison()
        extract();
      });
      $scope.msgFlag=true;
      $scope.setMsg=function(flag){
        $rootScope.$emit('sendMsg',flag);
        $scope.msgFlag=!$scope.msgFlag;
      }
    }

})();

(function ()
{
    'use strict';

    QuickPanelController.$inject = ["msApi"];
    angular
        .module('app.quick-panel')
        .controller('QuickPanelController', QuickPanelController);

    /** @ngInject */
    function QuickPanelController(msApi)
    {
        var vm = this;

        // Data
        vm.date = new Date();
        vm.settings = {
            notify: true,
            cloud : false,
            retro : true
        };

        msApi.request('quickPanel.activities@get', {},
            // Success
            function (response)
            {
                vm.activities = response.data;
            }
        );

        msApi.request('quickPanel.events@get', {},
            // Success
            function (response)
            {
                vm.events = response.data;
            }
        );

        msApi.request('quickPanel.notes@get', {},
            // Success
            function (response)
            {
                vm.notes = response.data;
            }
        );

        // Methods

        //////////
    }

})();
(function ()
{
    'use strict';

    angular
        .module('app.navigation', [])
        .config(config);

    /** @ngInject */
    function config()
    {
        
    }

})();
(function ()
{
    'use strict';

    NavigationController.$inject = ["$scope"];
    angular
        .module('app.navigation')
        .controller('NavigationController', NavigationController);

    /** @ngInject */
    function NavigationController($scope)
    {
        var vm = this;

        // Data
        vm.bodyEl = angular.element('body');
        vm.folded = false;
        vm.msScrollOptions = {
            suppressScrollX: true
        };
        // Methods
        vm.toggleMsNavigationFolded = toggleMsNavigationFolded;

        //////////

        /**
         * Toggle folded status
         */
        function toggleMsNavigationFolded()
        {
            vm.folded = !vm.folded;
        }

        // Close the mobile menu on $stateChangeSuccess
        $scope.$on('$stateChangeSuccess', function ()
        {
            vm.bodyEl.removeClass('ms-navigation-horizontal-mobile-menu-active')
        })
    }

})();

(function ()
{
    'use strict';

    /**
     * Main module of the Fuse
     */
    angular
        .module('sxt', [
            'app.core',
            'app.navigation',
            'app.toolbar',
            'app.auth',
            'app.pcReport',
            'app.xhsc',
            'app.plan',
            'app.material',
            'app.earthwork',
            'app.pileFoundation'
        ]);
})();

(function () {
  'use strict';

  MainController.$inject = ["$scope", "$rootScope", "$cookies"];
  angular
    .module('sxt')
    .controller('MainController', MainController);

  /** @ngInject */
  function MainController($scope, $rootScope,$cookies) {
    $scope.$on('$viewContentAnimationEnded', function (event) {
      if (event.targetScope.$id === $scope.$id) {
        $rootScope.$broadcast('msSplashScreen::remove');
      }
    });
    $scope.$on('hidebar', function () {
      $scope.isHideBar = true;
    });
    $scope.theme= $cookies.get("selectedTheme");

  }
})();

(function ()
{
    'use strict';

    runBlock.$inject = ["msUtils", "fuseGenerator", "fuseConfig", "$httpBackend", "$rootScope", "$timeout", "$state", "auth", "$location", "$q"];
    angular
        .module('app.core')
        .run(runBlock);

    /** @ngInject */
    function runBlock(msUtils, fuseGenerator, fuseConfig, $httpBackend, $rootScope, $timeout, $state, auth,$location,$q)
    {
      /**
       * Generate extra classes based on registered themes so we
       * can use same colors with non-angular-material elements
       */
      fuseGenerator.generate();

      /**
       * Disable md-ink-ripple effects on mobile
       * if 'disableMdInkRippleOnMobile' config enabled
       */
      if ( fuseConfig.getConfig('disableMdInkRippleOnMobile') && msUtils.isMobile() )
      {
        var bodyEl = angular.element('body');
        bodyEl.attr('md-no-ink', true);
      }

      /**
       * Put isMobile() to the html as a class
       */
      if ( msUtils.isMobile() )
      {
        angular.element('html').addClass('is-mobile');
      }

      /**
       * Put browser information to the html as a class
       */
      var browserInfo = msUtils.detectBrowser();
      if ( browserInfo )
      {
        var htmlClass = browserInfo.browser + ' ' + browserInfo.version + ' ' + browserInfo.os;
        angular.element('html').addClass(htmlClass);
      }


      $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {
        if (toState.auth !== false && !auth.isLoggedIn()) {
          auth.autoLogin().then(function(){
            if(toState.name.indexOf('login')!=-1)
              $timeout(function(){$location.path('/');},100);
            else
              $state.go(toState.name, toParams);
          });
          event.preventDefault ();
        }
        else{
          $rootScope.noBack = toState.noBack;
          $rootScope.sendBt = toState.sendBt;
          $rootScope.sendPs = toState.sendPs;
          $rootScope.subtitle = toState.subtitle;
          $rootScope.leftArrow = toState.leftArrow;
          $rootScope.rightArrow = toState.rightArrow;
          $rootScope.refreshBtn = toState.refreshBtn;
          $rootScope.title = toState.title || $rootScope.title;
          $rootScope.showgrzx =  toState.showgrzx;
          $rootScope.opBtn = toState.opBtn;
          $rootScope.swap = toState.swap;
        }
      });

    }
})();

(function ()
{
    'use strict';

    config.$inject = ["$ariaProvider", "$logProvider", "msScrollConfigProvider", "$translateProvider", "fuseConfigProvider", "$httpProvider"];
    angular
        .module('app.core')
        .config(config);

    /** @ngInject */
    function config($ariaProvider, $logProvider, msScrollConfigProvider, $translateProvider, fuseConfigProvider,$httpProvider)
    {
      $httpProvider.interceptors.push('authToken');
      // Enable debug logging
      $logProvider.debugEnabled(true);

      // toastr configuration
      toastr.options.timeOut = 3000;
      toastr.options.positionClass = 'toast-top-right';
      toastr.options.preventDuplicates = true;
      toastr.options.progressBar = true;

      // angular-translate configuration
      $translateProvider.useLoader('$translatePartialLoader', {
          urlTemplate: '{part}/i18n/{lang}.json'
      });
        $translateProvider.preferredLanguage('en');
      $translateProvider.useSanitizeValueStrategy('sanitize');

        /*eslint-disable */

        // ng-aria configuration
        $ariaProvider.config({
            tabindex: false
        });

        // Fuse theme configurations
        fuseConfigProvider.config({
            'disableCustomScrollbars'        : false,
            'disableCustomScrollbarsOnMobile': true,
            'disableMdInkRippleOnMobile'     : true
        });

        // msScroll configuration
        msScrollConfigProvider.config({
            wheelPropagation: true
        });

        /*eslint-enable */
    }
})();

(function () {
  'use strict';

  runBlock.$inject = ["$rootScope", "$timeout", "$state", "amMoment", "api"];
  angular
    .module('sxt')
    .run(runBlock);

  /** @ngInject */
  function runBlock($rootScope, $timeout, $state, amMoment,api) {
    moment.defineLocale('zh-cn', {
      months: '一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月'.split('_'),
      monthsShort: '1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月'.split('_'),
      weekdays: '星期日_星期一_星期二_星期三_星期四_星期五_星期六'.split('_'),
      weekdaysShort: '周日_周一_周二_周三_周四_周五_周六'.split('_'),
      weekdaysMin: '日_一_二_三_四_五_六'.split('_'),
      longDateFormat: {
        LT: 'Ah点mm分',
        LTS: 'Ah点m分s秒',
        L: 'YYYY-MM-DD',
        LL: 'YYYY年MMMD日',
        LLL: 'YYYY年MMMD日Ah点mm分',
        LLLL: 'YYYY年MMMD日ddddAh点mm分',
        l: 'YYYY-MM-DD',
        ll: 'YYYY年MMMD日',
        lll: 'YYYY年MMMD日Ah点mm分',
        llll: 'YYYY年MMMD日ddddAh点mm分'
      },
      meridiemParse: '/凌晨|早上|上午|中午|下午|晚上/',
      meridiemHour: function (hour, meridiem) {
        if (hour === 12) {
          hour = 0;
        }
        if (meridiem === '凌晨' || meridiem === '早上' ||
          meridiem === '上午') {
          return hour;
        } else if (meridiem === '下午' || meridiem === '晚上') {
          return hour + 12;
        } else {
          // '中午'
          return hour >= 11 ? hour : hour + 12;
        }
      },
      meridiem: function (hour, minute, isLower) {
        return hour < 12 ? '上午' : '下午';
      },
      calendar: {
        sameDay: function () {
          return this.minutes() === 0 ? '[今天]Ah[点整]' : '[今天]LT';
        },
        nextDay: function () {
          return this.minutes() === 0 ? '[明天]Ah[点整]' : '[明天]LT';
        },
        lastDay: function () {
          return this.minutes() === 0 ? '[昨天]Ah[点整]' : '[昨天]LT';
        },
        nextWeek: function () {
          var startOfWeek, prefix;
          startOfWeek = moment().startOf('week');
          prefix = this.unix() - startOfWeek.unix() >= 7 * 24 * 3600 ? '[下]' : '[本]';
          return this.minutes() === 0 ? prefix + 'dddAh点整' : prefix + 'dddAh点mm';
        },
        lastWeek: function () {
          var startOfWeek, prefix;
          startOfWeek = moment().startOf('week');
          prefix = this.unix() < startOfWeek.unix() ? '[上]' : '[本]';
          return this.minutes() === 0 ? prefix + 'dddAh点整' : prefix + 'dddAh点mm';
        },
        sameElse: 'LL'
      },
      ordinalParse: /\d{1,2}(日|月|周)/,
      ordinal: function (number, period) {
        switch (period) {
          case 'd':
          case 'D':
          case 'DDD':
            return number + '日';
          case 'M':
            return number + '月';
          case 'w':
          case 'W':
            return number + '周';
          default:
            return number;
        }
      },
      relativeTime: {
        future: '%s内',
        past: '%s前',
        s: '几秒',
        m: '1 分钟',
        mm: '%d 分钟',
        h: '1 小时',
        hh: '%d 小时',
        d: '1 天',
        dd: '%d 天',
        M: '1 个月',
        MM: '%d 个月',
        y: '1 年',
        yy: '%d 年'
      },
      week: {
        // GB/T 7408-1994《数据元和交换格式·信息交换·日期和时间表示法》与ISO 8601:1988等效
        dow: 1, // Monday is the first day of the week.
        doy: 4  // The week that contains Jan 4th is the first week of the year.
      }
    });
    api.xhsc.logout();
    amMoment.changeLocale('zh-cn');
    function runBlock($rootScope, $timeout, $state, msNavigationService, remote) {
      // Activate loading indicator
      var stateChangeStartEvent = $rootScope.$on('$stateChangeStart', function () {
        $rootScope.loadingProgress = true;
      });

      // De-activate loading indicator
      var stateChangeSuccessEvent = $rootScope.$on('$stateChangeSuccess', function () {
        $timeout(function () {
          $rootScope.loadingProgress = false;
        });
      });

      //清除缓存


      // Store state in the root scope for easy access
      $rootScope.state = $state;

      // Cleanup
      $rootScope.$on('$destroy', function () {
        stateChangeStartEvent();
        stateChangeSuccessEvent();
      })
      //window.plugins &&  window.plugins.jPushPlugin && window.plugins.jPushPlugin.init();
    }
  }
})();

(function ()
{
    'use strict';

    routeConfig.$inject = ["$stateProvider", "$urlRouterProvider"];
    angular
        .module('sxt')
        .config(routeConfig);

    /** @ngInject */
    function routeConfig($stateProvider, $urlRouterProvider)
    {
        //$locationProvider.html5Mode(true);

        $urlRouterProvider.otherwise('/');

        /**
         * Layout Style Switcher
         *
         * This code is here for demonstration purposes.
         * If you don't need to switch between the layout
         * styles like in the demo, you can set one manually by
         * typing the template urls into the `State definitions`
         * area and remove this code
         */
        // Inject $cookies
        var $cookies;

        angular.injector(['ngCookies']).invoke([
            '$cookies', function (_$cookies)
            {
                $cookies = _$cookies;
            }
        ]);
        var mobileDetect = new MobileDetect(window.navigator.userAgent)
        // Get active layout
        var layoutStyle = mobileDetect.mobile()?'contentWithFootbar':'verticalNavigation';// : 'verticalNavigation';

        var layouts = {
            verticalNavigation  : {
                main      : 'app/core/layouts/vertical-navigation.html',
                toolbar   : 'app/toolbar/layouts/vertical-navigation/toolbar.html',
                navigation: 'app/navigation/layouts/vertical-navigation/navigation.html'
            },
            horizontalNavigation: {
                main      : 'app/core/layouts/horizontal-navigation.html',
                toolbar   : 'app/toolbar/layouts/horizontal-navigation/toolbar.html',
                navigation: 'app/navigation/layouts/horizontal-navigation/navigation.html'
            },
            contentOnly         : {
                main      : 'app/core/layouts/content-only.html',
                toolbar   : '',
                navigation: ''
            },
            contentWithToolbar  : {
                main      : 'app/core/layouts/content-with-toolbar.html',
                toolbar   : 'app/toolbar/layouts/content-with-toolbar/toolbar.html',
                navigation: ''
            },
            contentWithFootbar  : {
              main      : 'app/core/layouts/content-with-footbar.html',
              toolbar   : 'app/toolbar/layouts/content-with-footbar/footbar.html',
              navigation: '',
              toptoolbar:'app/toolbar/layouts/content-with-footbar/toptoolbar.html'
            }
        };
        // END - Layout Style Switcher

        // State definitions
        $stateProvider
            .state('app', {
                abstract: true,
                views   : {
                    'main@'         : {
                        templateUrl: layouts[layoutStyle].main,
                        controller : 'MainController as vm'
                    },
                    'toolbar@app'   : {
                        templateUrl: layouts[layoutStyle].toolbar,
                        controller : 'ToolbarController as vm'
                    },
                    'navigation@app': {
                        templateUrl: layouts[layoutStyle].navigation,
                        controller : 'NavigationController as vm'
                    },
                    'toptoolbar@app':{
                      templateUrl: layouts[layoutStyle].toptoolbar,
                      controller : 'TopToolbarController as vm'
                    }
                }
            });
    }

})();

(function ()
{
    'use strict';

    IndexController.$inject = ["fuseTheming"];
    angular
        .module('sxt')
        .controller('IndexController', IndexController);

    /** @ngInject */
    function IndexController(fuseTheming)
    {
        var vm = this;

        // Data
        vm.themes = fuseTheming.themes;

        //////////
    }
})();

(function ()
{
    'use strict';

    angular
      .module('sxt')
      .constant('appConfig',{
        apiUrl:'http://localhost:5000'
      })
      .factory('tokenInjector', ['$cookies', '$q', '$location', '$rootScope', 'appConfig', function ($cookies, $q, $location, $rootScope, appConfig) {
      var token = $cookies.get('token'),
        getToken = function () {
          if (!token)
            token = $cookies.get('token');
          return token;
        };
      var s = document.location.search;
      var isApp = s && s.length > 36;
      var tokenInjector = {
        setToken: function (tk) {
          if (tk) {
            token = 'Bearer ' + tk;
            $cookies.put('token', token);
          }
          else {
            token = null;
            $cookies.remove('token');
          }
        },
        getToken: getToken,
        request: function (config) {
          if (config.url.indexOf('/api/') != -1 || config.url.indexOf('/auth/') != -1)
            config.url = appConfig.apiUrl + config.url;
          else if (config.url.indexOf('.html') != -1 && config.url.indexOf('.tpl') == -1 && config.url.indexOf('dp/') == -1 && config.url.indexOf('template') == -1) {
            config.url = appConfig.localPath + config.url;
          }
          //console.log(config.url)
          //if (config.url.indexOf('dp/') != -1)
          //    config.url = config.url + (config.url.indexOf('?') == -1 ? '?' : '&') + 'version=1.2.23';
          if (token && config.url.indexOf('szapi.vanke.com') == -1)
            config.headers['Authorization'] = getToken();
          return config;
        },
        responseError: function (rejection) {
          if (!isApp) {
            if (rejection.status == 401) {
              if (!appConfig.localAuth && rejection.config.url.toLowerCase().indexOf('szapi.vanke.com') != -1) {
                tokenInjector.setToken(null);
                top.location = '/login';
              }
              else {
                if (appConfig.localAuth) {
                  $location.path('/login')
                } else {
                  $.ajax({
                    url: appConfig.authUrl + '/auth/connect/token',
                    type: 'post',
                    headers: {
                      'Access-Control-Allow-Origin': '*',
                      'Content-Type': 'application/x-www-form-urlencoded',
                      'Authorization': 'Basic ' + btoa('59EEDFCCB53C451488E067522992853B:9d6ab75f921942e61fb43a9b1fc25c63')
                    },
                    dataType: 'json',
                    data: {
                      grant_type: 'password',
                      scope: 'sxt',
                      username: 'token',
                      password: USER.TOKEN
                    }
                  }).then(function (result) {
                    tokenInjector.setToken(result.access_token);
                    document.location.reload();
                  })
                }
              }
              return $q(function (resolve, reject) {
                reject(rejection);
              });
            }
            return rejection
          }
          else {
            return $q(function (resolve, reject) {
              reject(rejection);
            });
          }
        }
      };
      return tokenInjector;
    }])

})();

(function ()
{
    'use strict';

    config.$inject = ["authProvider", "apiProvider", "$mdDateLocaleProvider"];
    angular
        .module('sxt')
        .config(config);

    /** @ngInject */
    function config(authProvider,apiProvider,$mdDateLocaleProvider)
    {
      $mdDateLocaleProvider.shortDays = ['日', '一', '二', '三', '四', '五', '六'];
      $mdDateLocaleProvider.shortMonths = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
    }

})();

/**
 * Created by 陆科桦 on 2016/10/23.
 */
(function(angular,undefined){
  'use strict';
  config.$inject = ["$stateProvider", "msNavigationServiceProvider"];
  angular
    .module('app.xhsc')
    .config(config);

  /** @ngInject */
  function config($stateProvider,msNavigationServiceProvider){
    $stateProvider
      .state('app.xhsc.materialys', {
        url: '/ys',
        views: {
          'content@app': {
            template: '<ui-view flex layout="column"></ui-view>'
          }
        },
        abstract: true
      })
      // .state('app.xhsc.materialys.download',{
      //   noBack:false,
      //   sendBt: false,
      //   rightArrow: false,
      //   leftArrow: false,
      //   url:'',
      //   swap:[
      //     {active:true,label:'材料验收',url:'app.xhsc.materialys.download'},
      //     {active:false,label:'工序验收',url:'app.xhsc.gx.gxmain'}
      //   ],
      //   template: '<materialys-download flex layout="column"></materialys-download>'
      // })
      .state('app.xhsc.materialys.planList',{
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url:'/planList/{id}/{title}',
        template: '<material-plan-list flex layout="column"></material-plan-list>'
      })
      .state('app.xhsc.materialys.planDetail',{
        noBack:true,
        sendBt: false,
        rightArrow: false,
        leftArrow: false,
        url:'/planDetail/{batchId}',
        template:'<material-plan-detail></material-plan-detail>'
      })
      .state('app.xhsc.materialys.intoFactory',{
        title:'材料进场',
        noBack:true,
        sendBt: true,
        rightArrow: false,
        leftArrow: false,
        url:'/intoFactory/{status}/{BatchId}/{PlanId}/{PlanCount}/{Brand}',
        template:'<material-into-factory flex layout="column"></material-into-factory>'
      })
      .state('app.xhsc.materialys.checkInfo',{
        noBack:true,
        sendBt:true,
        title:'材料验收',
        url:'/checkInfo/{id}',
        template: '<material-ys-check-info flex layout="column"></material-ys-check-info>'
      })
      .state('app.xhsc.materialys.inspectionReport',{
        noBack:true,
        sendBt:true,
        title:'送检报告归档',
        url:'/inspectionReport/{id}',
        template: '<material-ys-inspection-report flex layout="column"></material-ys-inspection-report>'
      })
      .state('app.xhsc.materialys.approval',{
        noBack:true,
        sendPs:true,
        title:'材料验收详情',
        url:'/approval/{planId}/{id}',
        template: '<material-ys-approval flex layout="column"></material-ys-approval>'
      })
      .state('app.xhsc.materialys.inspection',{
        noBack:true,
        sendBt:true,
        title:'材料送检',
        url:'/inspection/{id}',
        template: '<material-plan-inspection flex layout="column"></material-plan-inspection>'
      })
      .state('app.xhsc.materialys.exit',{
        noBack:true,
        sendBt:true,
        title:'材料退场',
        url:'/exit/{id}',
        template: '<material-ys-exit flex layout="column"></material-ys-exit>'
      })
      .state('app.xhsc.materialys.unqualifiedExit',{
        noBack:true,
        sendBt:true,
        title:'材料退场',
        url:'/unqualifiedExit/{id}/{unit}',
        template: '<material-unqualified-exit flex layout="column"></material-unqualified-exit>'
      })
      .state('app.xhsc.materialys.materialPlanProgress',{
        noBack:true,
        title:'流程跟踪',
        url:'/materialPlanProgress/{id}',
        template: '<material-plan-progress flex layout="column"></material-plan-progress>'
      })
      .state('app.xhsc.materialys.materialdownload',{
        noBack:true,
        title:'材料验收',
        url:'/materialYsDownload',
        template: '<material-ys-download flex layout="column"></material-ys-download>'
      })
  }
})(angular,undefined);

angular.module("sxt").run(["$templateCache", function($templateCache) {$templateCache.put("app/quick-panel/quick-panel.html","<md-content><md-tabs md-no-pagination=\"\" md-swipe-content=\"\" md-stretch-tabs=\"always\"><md-tab><md-tab-label translate=\"QUICKPANEL.TODAY\">TODAY</md-tab-label><md-tab-body><md-content class=\"today-tab scrollable\" ms-scroll=\"\" ng-include=\"\'app/quick-panel/tabs/today/today-tab.html\'\"></md-content></md-tab-body></md-tab><md-tab><md-tab-label translate=\"QUICKPANEL.CHAT\">CHAT</md-tab-label><md-tab-body><md-content class=\"chat-tab scrollable\" ms-scroll=\"\" ng-include=\"\'app/quick-panel/tabs/chat/chat-tab.html\'\" ng-controller=\"ChatTabController as vm\"></md-content></md-tab-body></md-tab><md-tab><md-tab-label translate=\"QUICKPANEL.ACTIVITY\">ACTIVITY</md-tab-label><md-tab-body><md-content class=\"activity-tab scrollable\" ms-scroll=\"\" ng-include=\"\'app/quick-panel/tabs/activity/activity-tab.html\'\"></md-content></md-tab-body></md-tab></md-tabs></md-content>");
$templateCache.put("app/core/layouts/content-only.html","<div id=\"layout-content-only\" class=\"template-layout\" layout=\"column\" flex=\"\"><md-content id=\"content\" class=\"animate-slide-up md-background md-hue-1\" ui-view=\"content\" flex=\"\"></md-content></div>");
$templateCache.put("app/core/layouts/content-with-footbar.html","<div id=\"layout-content-with-footbar\" class=\"template-layout\" layout=\"column\" flex=\"\"><md-toolbar id=\"toptoolbar\" style=\"padding-bottom: 5px;\" ng-if=\"!isHideBar\" class=\"md-menu-toolbar md-whiteframe-1dp\" ui-view=\"toptoolbar\"></md-toolbar><md-content id=\"content\" class=\"md-background md-hue-1\" layout=\"column\" ui-view=\"content\" flex=\"\"></md-content><md-toolbar id=\"toolbar2\" ng-if=\"!isHideBar\" class=\"md-menu-toolbar md-whiteframe-1dp\" ui-view=\"toolbar\"></md-toolbar></div>");
$templateCache.put("app/core/layouts/content-with-toolbar.html","<div id=\"layout-content-with-toolbar\" class=\"template-layout\" layout=\"column\" flex=\"\"><md-toolbar id=\"toolbar\" class=\"md-menu-toolbar md-whiteframe-1dp\" ui-view=\"toolbar\"></md-toolbar><md-content id=\"content\" class=\"animate-slide-up md-background md-hue-1\" ui-view=\"content\" flex=\"\"></md-content></div>");
$templateCache.put("app/core/layouts/horizontal-navigation.html","<div id=\"layout-horizontal-navigation\" class=\"template-layout\" layout=\"column\" flex=\"\"><md-toolbar id=\"toolbar\" class=\"md-menu-toolbar\" ui-view=\"toolbar\"></md-toolbar><div id=\"horizontal-navigation\" class=\"md-whiteframe-1dp\" ui-view=\"navigation\"></div><div id=\"content-container\" flex=\"\" layout=\"column\"><md-content id=\"content\" class=\"animate-slide-up md-background md-hue-1\" ms-scroll=\"\" ui-view=\"content\" flex=\"\"></md-content></div><md-sidenav id=\"quick-panel\" class=\"md-sidenav-right md-whiteframe-4dp\" md-component-id=\"quick-panel\" ms-scroll=\"\" ui-view=\"quickPanel\"></md-sidenav></div>");
$templateCache.put("app/core/layouts/vertical-navigation.html","<div id=\"layout-vertical-navigation\" class=\"template-layout\" layout=\"row\" flex=\"\"><md-sidenav id=\"vertical-navigation\" class=\"md-primary-bg\" md-is-locked-open=\"$mdMedia(\'gt-sm\')\" md-component-id=\"navigation\" ms-scroll=\"\" ui-view=\"navigation\"></md-sidenav><div id=\"content-container\" flex=\"\" layout=\"column\"><md-toolbar id=\"toolbar\" class=\"md-menu-toolbar md-whiteframe-1dp\" ui-view=\"toolbar\"></md-toolbar><md-content id=\"content\" class=\"md-background md-hue-2\" ms-scroll=\"\" ui-view=\"content\" layout=\"column\" flex=\"\"></md-content></div></div>");
$templateCache.put("app/core/theme-options/theme-options.html","<div class=\"ms-theme-options-panel\" layout=\"row\" layout-align=\"start start\"><div class=\"ms-theme-options-panel-button md-primary-bg\" ng-click=\"toggleOptionsPanel()\"><md-icon md-font-icon=\"icon-cog\" class=\"white-text\"></md-icon></div><div class=\"ms-theme-options-list\" layout=\"column\"><div class=\"theme-option\"><div class=\"option-title\">Layout Style:</div><md-radio-group layout=\"column\" ng-model=\"vm.layoutStyle\" ng-change=\"vm.updateLayoutStyle()\"><md-radio-button value=\"verticalNavigation\">Vertical Navigation</md-radio-button><md-radio-button value=\"horizontalNavigation\">Horizontal Navigation</md-radio-button><md-radio-button value=\"contentOnly\">Content Only</md-radio-button><md-radio-button value=\"contentWithToolbar\">Content with Toolbar</md-radio-button></md-radio-group></div><md-divider></md-divider><div class=\"theme-option\"><div class=\"option-title\">Layout Mode:</div><md-radio-group layout=\"row\" layout-align=\"start center\" ng-model=\"vm.layoutMode\" ng-change=\"vm.updateLayoutMode()\"><md-radio-button value=\"boxed\">Boxed</md-radio-button><md-radio-button value=\"wide\">Wide</md-radio-button></md-radio-group></div><md-divider></md-divider><div class=\"theme-option\"><div class=\"option-title\">Color Palette:</div><md-menu-item ng-repeat=\"(themeName, theme) in vm.themes.list\" class=\"theme\"><md-button class=\"md-raised theme-button\" aria-label=\"{{themeName}}\" ng-click=\"vm.setActiveTheme(themeName)\" ng-style=\"{\'background-color\': theme.primary.color,\'border-color\': theme.accent.color,\'color\': theme.primary.contrast1}\" ng-class=\"themeName\"><span><md-icon ng-style=\"{\'color\': theme.primary.contrast1}\" md-font-icon=\"icon-palette\"></md-icon><span>{{themeName}}</span></span></md-button></md-menu-item></div></div></div>");
$templateCache.put("app/main/pcReport/build.html","<md-tabs flex=\"\" md-border-bottom=\"\"><md-tab ng-repeat=\"area in vm.areas\" label=\"{{area.RegionName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div hm-dir=\"\" style=\"width:100%;\"><div id=\"pinch\" hm-drag=\"dragEvent($event)\" hm-dragend=\"dragend($event)\" hm-pinch=\"pinch($event)\" hm-pinchmove=\"pinchmove($event)\" hm-pinchend=\"pinchend($event)\" style=\"position: relative;\"><div id=\"floorlayer\" style=\"margin:10px 0;position:relative;\"><floor-layer style=\"float:left;\" build-len=\"area.builds.length\" ng-repeat=\"sxtfloor in area.builds\" sxtfloor=\"sxtfloor\" floor-num=\"vm.maxLen\" sell-line=\"vm.sellLine\" ng-click=\"vm.showECs($event,sxtfloor)\"></floor-layer><div style=\"clear:both;display:table;\"></div></div></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/pcReport/buildDetail.html","<section layout=\"column\" flex=\"\"><div flex=\"none\" layout=\"row\"><md-progress-circular flex=\"none\" ng-if=\"vm.loading\" md-mode=\"indeterminate\" md-diameter=\"20px\"></md-progress-circular><h4 flex=\"\" ng-if=\"!vm.loading\" style=\"text-align: center\">{{vm.build.name}}</h4></div><div flex=\"\" sxt-msk-charts=\"\" build=\"vm.build\" procedures=\"gxSelected\"></div><md-sidenav layout=\"column\" class=\"md-sidenav-right\" md-is-open=\"vm.build.isOpen\" md-component-id=\"procedure_right\"><md-toolbar flex=\"none\" class=\"md-theme-indigo\"><h4 class=\"md-toolbar-tools\">选择工序(点击左侧灰色区关闭)</h4></md-toolbar><md-tabs md-border-bottom=\"\" flex=\"\"><md-tab label=\"已选工序({{gxSelected.length}})\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"row\"><md-list flex=\"\" ms-scroll=\"\"><md-list-item style=\"background: white\" ng-repeat=\"item in gxSelected\"><md-checkbox ng-click=\"remove(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\">{{item.AcceptanceItemName}}</md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p><md-divider style=\"margin-left: 16px;\" ng-if=\"!$last\"></md-divider></md-list-item><span flex=\"\"></span></md-list></md-content></md-tab-content></md-tab><md-tab ng-if=\"vm.showTab(gx1)\" ng-repeat=\"gx1 in procedures\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"item.WPAcceptanceList.length\" ng-repeat=\"item in gx1.SpecialtyChildren\"><md-subheader class=\"md-no-sticky\" style=\"background:transparent\">{{item.SpecialtyName}}</md-subheader><md-list-item layout=\"row\" style=\"background: white\" ng-repeat=\"k in item.WPAcceptanceList\"><md-checkbox ng-click=\"choosego(k)\" ng-model=\"k.checked\" style=\"margin-right: 8px\"></md-checkbox><p flex=\"\">{{k.AcceptanceItemName}}</p><md-divider style=\"margin-left: 16px;\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs></md-sidenav><div style=\"position: fixed; top:45px; right:0px;\" ng-if=\"!vm.loading\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.openGx()\">工序</md-button></div></section>");
$templateCache.put("app/main/pcReport/hzReport.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.rendered\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular><md-tabs ng-show=\"vm.rendered\" flex=\"\" layout=\"column\"><md-tab flex=\"\" layout=\"column\" label=\"汇总清单\"><md-tab-content ms-scroll=\"\" class=\"download\" style=\"padding: 0px\"><form method=\"post\" action=\"http://emp.chngalaxy.com:9091/api/MaterialPlan/GetMaterialReportXls\" target=\"_blank\"><input id=\"export\" type=\"hidden\" name=\"table\"> <input id=\"tital\" type=\"hidden\" name=\"tital\" value=\"汇总清单\"><md-button class=\"md-raised md-primary\" type=\"submit\" ng-click=\"vm.printBatchCount()\" ng-if=\"vm.isMobile == null\">Excel导出</md-button></form><div id=\"divReport\"><table class=\"summaryReport\"><thead><tr><th style=\"border: 1px solid #ddd\">序号</th><th style=\"border: 1px solid #ddd\">城市公司</th><th style=\"border: 1px solid #ddd\">项目名称</th><th style=\"border: 1px solid #ddd\">工序验收报表</th><th style=\"border: 1px solid #ddd\">实测实量报表</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.report\"><td style=\"border: 1px solid #ddd\">{{$index+1}}</td><td style=\"border: 1px solid #ddd\">{{item.OUName}}</td><td style=\"border: 1px solid #ddd\"><md-button ng-click=\"vm.selecte(item)\" class=\"md-accent\" style=\"font-family: \'Roboto\', \'Helvetica Neue\', \'Arial\', \'sans-serif\';font-size: 13px;\">{{item.ProjectName}}</md-button></td><td style=\"border: 1px solid #ddd\"><table><tr><td style=\"border: 1px solid #ddd\">总计</td><td style=\"border: 1px solid #ddd\">{{item.Inspection.Count}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本月已提交</td><td style=\"border: 1px solid #ddd\">{{item.Inspection.SubmitMonth}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本月已验收</td><td style=\"border: 1px solid #ddd\">{{item.Inspection.Month}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本日已提交</td><td style=\"border: 1px solid #ddd\">{{item.Inspection.SubmitDay}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本日已验收</td><td style=\"border: 1px solid #ddd\">{{item.Inspection.Day}}</td></tr></table></td><td><table><tr><td style=\"border: 1px solid #ddd\">总计</td><td style=\"border: 1px solid #ddd\">{{item.PQMeasureRecord.Count}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本月总包</td><td style=\"border: 1px solid #ddd\">{{item.PQMeasureRecord.Month}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本月监理</td><td style=\"border: 1px solid #ddd\">{{item.PQMeasureRecord.SupervisionMonth}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本日总包</td><td style=\"border: 1px solid #ddd\">{{item.PQMeasureRecord.Day}}</td></tr><tr><td style=\"border: 1px solid #ddd\">本日监理</td><td style=\"border: 1px solid #ddd\">{{item.PQMeasureRecord.SupervisionDay}}</td></tr></table></td></tr></tbody></table></div></md-tab-content></md-tab></md-tabs><md-sidenav id=\"reportDT\" layout=\"column\" style=\"min-width: 80%\" class=\"md-sidenav-right md-whiteframe-4dp\" md-component-id=\"reportDT\"><md-toolbar><div class=\"md-toolbar-tools\"><h4>子报表</h4><span flex=\"\"></span></div></md-toolbar><md-content><md-list class=\"md-dense\" flex=\"\"><md-list-item layout=\"row\"><md-button ng-click=\"vm.goDetail(0)\" flex=\"\" layout=\"row\"><md-icon md-font-icon=\"icon-clock\" class=\"s16\"></md-icon>工序验收 <span flex=\"\"></span></md-button></md-list-item><md-list-item layout=\"row\"><md-button ng-click=\"vm.goDetail(1)\" flex=\"\" layout=\"row\"><md-icon md-font-icon=\"icon-border-color\" class=\"s16\"></md-icon>实测实量 <span flex=\"\"></span></md-button></md-list-item></md-list></md-content></md-sidenav>");
$templateCache.put("app/main/pcReport/pcReportMain.html","<md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-content flex=\"\"><md-list ng-cloak=\"\"><md-list-item ui-sref=\"app.pcReport_hz\"><img src=\"app/main/xhsc/images/bbhz.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>汇总报表</p></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">质量</md-subheader><md-list-item ui-sref=\"app.pcReport_ys_gx\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>工序验收报表</p></md-list-item><md-list-item ng-click=\"vm.ysProject()\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>工序验收(问题分类统计)</p></md-list-item><md-list-item ui-sref=\"app.pcReport_sl_sc\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>实测实量报表</p></md-list-item><md-list-item ui-sref=\"app.pcReport_sl_jt\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>实测实量汇总(集团)</p></md-list-item><md-list-item ng-click=\"vm.scProject()\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>实测实量汇总(项目)</p></md-list-item><md-list-item ng-click=\"vm.scBuild()\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>实测实量汇总(楼栋)</p></md-list-item><md-list-item ui-sref=\"app.pcReport_cycle_default.filter\"><img src=\"app/main/xhsc/images/bbzl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>日常巡检报表</p></md-list-item><md-list-item ng-click=\"vm.pg_trial()\"><img src=\"app/main/xhsc/images/bbzlbs.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>淋水闭水报表</p></md-list-item><md-list-item ui-sref=\"app.material.materialReport\"><img src=\"app/main/xhsc/images/bbzlbs.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>材料验收报表</p></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">安全</md-subheader><md-list-item ui-sref=\"app.pcReport_safeys_default.filter\"><img src=\"app/main/xhsc/images/bbaq.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>安全验收报表</p></md-list-item><md-list-item ui-sref=\"app.pcReport_week_default.filter\"><img src=\"app/main/xhsc/images/bbaq.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>周安全检查报表</p></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">评估</md-subheader><md-list-item ui-sref=\"app.pcReport_pg\"><img src=\"app/main/xhsc/images/bbpg.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>现场评估报表</p></md-list-item><md-list-item ng-click=\"vm.pg_xmb_zb_jl(\'app.pcReport_pg_xmb\')\"><img src=\"app/main/xhsc/images/bbpg.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>项目评估报表(项目部)</p></md-list-item><md-list-item ng-click=\"vm.pg_xmb_zb_jl(\'app.pcReport_pg_jl\')\"><img src=\"app/main/xhsc/images/bbpg.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>项目评估报表(监理)</p></md-list-item><md-list-item ng-click=\"vm.pg_xmb_zb_jl(\'app.pcReport_pg_zb\')\"><img src=\"app/main/xhsc/images/bbpg.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>项目评估报表(总包)</p></md-list-item><md-list-item ng-click=\"vm.pg_xmb_zb_class(\'app.pcReport_pg_class\')\"><img src=\"app/main/xhsc/images/bbpgpf.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>项目评估报表(各分项评分)</p></md-list-item><md-list-item ui-sref=\"app.pcReport_pg_rate\"><img src=\"app/main/xhsc/images/bbpghkl.svg\" class=\"md-avatar\" style=\"width:28px;\"><p>项目评估报表(实测合格率)</p></md-list-item></md-list></md-content></md-tab-content>");
$templateCache.put("app/main/pcReport/pg_showTemplate.html","<md-dialog aria-label=\"新建\" style=\"min-height: 150px;width: 80%;max-width: 450px\" ng-cloak=\"\"><md-dialog-content layout=\"column\" style=\"margin:15px 8px 8px 0px\"><form name=\"myForm\" flex=\"\" layout=\"column\"><md-input-container><label>年度选择</label><md-select ng-model=\"year\" required=\"\" name=\"year\"><md-option ng-value=\"item\" ng-repeat=\"item in yearArray\">{{item.value}}</md-option></md-select></md-input-container><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\">取消</md-button><md-button type=\"submit\" flex=\"\" ng-disabled=\"myForm.$invalid\" ng-click=\"ok(myForm)\">确定</md-button></div></form></md-dialog-content></md-dialog>,");
$templateCache.put("app/main/pcReport/progress.html","<iframe flex=\"\" style=\"border: 0px;padding: 0px;margin: 0px\" ng-src=\"{{vm.href}}\"></iframe>");
$templateCache.put("app/main/pcReport/scBuildDetail.html","<!DOCTYPE html><section layout=\"column\" flex=\"\"><div flex=\"none\" layout=\"row\"><md-progress-circular flex=\"none\" ng-if=\"vm.loading\" md-mode=\"indeterminate\" md-diameter=\"20px\"></md-progress-circular><h4 flex=\"\" ng-if=\"!vm.loading\" style=\"text-align: center\">{{vm.build.name}}</h4></div><div flex=\"\" sxt-sc-msk-charts=\"\" build=\"vm.build\" procedures=\"gxSelected\"></div><md-sidenav layout=\"column\" class=\"md-sidenav-right\" md-is-open=\"vm.build.isOpen\" md-component-id=\"procedure_right\"><md-toolbar flex=\"none\" class=\"md-theme-indigo\"><h4 class=\"md-toolbar-tools\">选择实测项(点击左侧灰色区关闭)</h4></md-toolbar><md-tabs md-border-bottom=\"\" flex=\"\" style=\"background-color:white\"><md-tab label=\"实测实量({{gxSelected.length}})\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"row\"><md-list style=\"box-shadow:1px 0px 15px 0 #d8d8d8\" flex=\"\" ms-scroll=\"\"><md-list-item ng-repeat=\"item in procedures\" style=\"background: white\"><md-checkbox ng-click=\"remove(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\"></md-checkbox><p flex=\"\">{{item.MeasureItemName}}</p><md-divider style=\"margin-left: 16px;\" ng-if=\"!$last\"></md-divider></md-list-item></md-list></md-content></md-tab-content></md-tab></md-tabs></md-sidenav><div style=\"position: fixed; top:45px; right:0px;\" ng-if=\"!vm.loading\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.openGx()\">实测</md-button></div></section>");
$templateCache.put("app/main/pcReport/showTemplate.html","<md-dialog aria-label=\"新建\" style=\"min-height: 250px;width: 80%;max-width: 450px\" ng-cloak=\"\"><md-dialog-content layout=\"column\" style=\"margin:15px 8px 8px 0px\"><form name=\"myForm\" flex=\"\" layout=\"column\"><md-input-container><label>项目</label><md-select ng-model=\"currentProject\" required=\"\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select><div ng-messages=\"myForm.currentProject.$error\"><div ng-message=\"required\">项目不能为空</div></div></md-input-container><md-input-container><label>分期</label><md-select ng-model=\"currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in currentProject.Children\">{{item.RegionName}}</md-option></md-select><div ng-messages=\"myForm.currentArea.$error\"><div ng-message=\"required\">分期不能为空</div></div></md-input-container><md-input-container ng-show=\"level&&level>=7\"><label>楼栋</label><md-select ng-model=\"currentBuild\" required=\"\" name=\"currentBuild\"><md-option ng-value=\"item\" ng-repeat=\"item in builds\">{{item.RegionName}}</md-option></md-select><div ng-messages=\"myForm.currentBuild.$error\"><div ng-message=\"required\">楼栋不能为空</div></div></md-input-container><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\">取消</md-button><md-button type=\"submit\" flex=\"\" ng-disabled=\"myForm.$invalid\" ng-click=\"ok(myForm)\">确定</md-button></div></form></md-dialog-content></md-dialog>,");
$templateCache.put("app/main/sample/sample.html","<h1>{{vm.helloText}}</h1>");
$templateCache.put("app/core/directives/ms-area-select/ms-area-select.html","<md-content class=\"md-area-select\" ng-controller=\"msAreaSelectController\"><div class=\"md-area-select-top\" layout=\"row\"><div flex=\"33\" ng-click=\"clickDrownList($event,\'area\',0)\"><div class=\"md-select-value md-select-placeholder top-dot on\"><span title=\"{{areaData.showText||areaData.initText}}\">{{areaData.showText||areaData.initText}}</span> <span class=\"md-select-icon\"></span></div></div><div flex=\"33\" ng-click=\"clickDrownList($event,\'department\',1)\"><div class=\"md-select-value md-select-placeholder top-dot\"><span title=\"{{departmentData.showText||departmentData.initText}}\">{{departmentData.showText||departmentData.initText}}</span> <span class=\"md-select-icon\"></span></div></div><div flex=\"33\" ng-click=\"clickDrownList($event,\'procedure\',2)\"><div class=\"md-select-value md-select-placeholder top-dot\"><span title=\"{{procedureData.showText||procedureData.initText}}\">{{procedureData.showText||procedureData.initText}}</span> <span class=\"md-select-icon\"></span></div></div></div><md-divider></md-divider><div hidden=\"\" class=\"md-area-select-content\" layout=\"row\"><div flex=\"{{flexes[0]}}\" class=\"item\"><md-virtual-repeat-container layout=\"row\" class=\"repeatContainer\"><div md-virtual-repeat=\"list in itemAList\" class=\"repeated-item\" flex=\"\"><div ng-class=\"getCurrentSelectedItem(0,list)\" class=\"md-3-line\" ng-click=\"selectRegionItems($event,list,0)\"><span>{{list.SpecialtyName||list.RegionName}}</span></div><md-divider></md-divider></div></md-virtual-repeat-container></div><div flex=\"{{flexes[1]}}\" class=\"item\"><md-virtual-repeat-container layout=\"row\" class=\"repeatContainer\"><div md-virtual-repeat=\"list in itemBList\" class=\"repeated-item\" flex=\"\"><div ng-class=\"getCurrentSelectedItem(1,list)\" class=\"md-3-line\" ng-click=\"selectRegionItems($event,list,1)\"><span>{{list.SpecialtyName||list.RegionName}}</span></div><md-divider></md-divider></div></md-virtual-repeat-container></div><div flex=\"{{flexes[2]}}\" class=\"item\"><md-virtual-repeat-container layout=\"row\" class=\"repeatContainer\"><div md-virtual-repeat=\"list in itemCList\" class=\"repeated-item\" flex=\"\"><div ng-class=\"getCurrentSelectedItem(3,list)\" class=\"md-3-line\" ng-click=\"selectRegionItems($event,list,2)\"><span>{{list.AcceptanceItemName||list.SpecialtyName||list.RegionName||\'\'}}</span></div><md-divider></md-divider></div></md-virtual-repeat-container></div></div><div flex=\"100\"><md-divider></md-divider></div></md-content>");
$templateCache.put("app/core/directives/ms-area-select/ms-general-select.html","<div class=\"gen\" ng-if=\"loaded\"><div layout=\"row\" class=\"top\"><div flex=\"33\" ng-if=\"!arearId\" ng-click=\"toggle(\'region\')\" layout=\"row\" layout-align=\"center center\"><span title=\"区域\" class=\"md-select-icon\">{{current.selectedArea?current.selectedArea.RegionName:\"区域\"}}</span> <span class=\"caret spare\"></span></div><div flex=\"{{!arearId?33:50}}\" ng-click=\"toggle(\'part\')\" layout=\"row\" layout-align=\"center center\"><span>{{current.region? current.region.fullName:\'部 位\'}}</span> <span class=\"caret spare\"></span></div><div flex=\"{{!arearId?33:50}}\" ng-click=\"toggle(\'procedure\')\" layout=\"row\" layout-align=\"center center\"><span>{{current.procedure?current.procedure.AcceptanceItemName:(name?name:\"工 序\")}}</span> <span class=\"caret spare\"></span></div></div><md-divider></md-divider><div class=\"content\" layout=\"column\" layout-align=\"stretch start\"><div class=\"region\" flex=\"\" ng-if=\"status.region\" layout=\"row\"><div flex=\"\"><md-list><md-list-item ng-repeat=\"item in source.areasData\" ng-click=\"setRegion(item)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\">{{item.RegionName}}</span></md-list-item></md-list></div><div flex=\"\"><md-list><md-list-item class=\"clickbg\" ng-repeat=\"item in source.fq\" ng-click=\"setBuilding(item,source.fq)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\">{{item.RegionName}}</span></md-list-item></md-list></div></div><div class=\"part\" flex=\"\" ng-if=\"status.part\" layout=\"row\"><div flex=\"{{source.rooms&&source.rooms.length>0?30:50}}\"><md-list><md-list-item ng-if=\"!item.hide\" ng-repeat=\"item in source.parts\" ng-click=\"setFloor(item,source.parts)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.RegionName}}</span></md-list-item></md-list></div><div flex=\"{{source.rooms&&source.rooms.length>0?30:50}}\"><md-list><md-list-item class=\"clickbg\" ng-if=\"!item.hide\" ng-repeat=\"item in source.floors\" ng-click=\"setRoom(item,source.floors)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.RegionName}}</span></md-list-item></md-list></div><div flex=\"{{source.rooms&&source.rooms.length>0?40:50}}\" ng-if=\"source.rooms&&source.rooms.length>0\"><md-list><md-list-item class=\"clickbg\" ng-if=\"!item.hide\" ng-repeat=\"item in source.rooms\" ng-click=\"selectedRegion(item,source.rooms)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.RegionName}}</span></md-list-item></md-list></div></div><div class=\"procedure\" flex=\"\" ng-show=\"status.procedure\" layout=\"row\"><div flex=\"{{source.wpAcceptanceList&&source.wpAcceptanceList.length>0?30:50}}\"><md-list><md-list-item ng-repeat=\"item in source.procedureData\" ng-click=\"setProcedure(item,source.procedureData)\" ng-class=\"{\'active\':item.active}\" layout=\"row\" layout-align=\"center center\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.SpecialtyName}}</span></md-list-item></md-list></div><div flex=\"{{source.wpAcceptanceList&&source.wpAcceptanceList.length>0?30:50}}\"><md-list><md-list-item class=\"clickbg\" ng-repeat=\"item in source.specialtyChildren\" ng-click=\"setSpecialty(item,source.specialtyChildren)\" ng-class=\"{\'active\':item.active}\" layout=\"row\" layout-align=\"center center\" style=\"white-space:nowrap;\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.SpecialtyName}}</span></md-list-item></md-list></div><div flex=\"{{source.wpAcceptanceList&&source.wpAcceptanceList.length>0?40:50}}\" ng-if=\"source.wpAcceptanceList&&source.wpAcceptanceList.length>0\"><md-list ng-if=\"lay!=\'row\'\"><md-list-item class=\"clickbg\" ng-repeat=\"item in source.wpAcceptanceList\" ng-click=\"selectedProcedure(item,source.wpAcceptanceList)\" ng-class=\"{\'active\':item.active}\" layout=\"row\"><span flex=\"\" style=\"text-overflow:ellipsis;text-align: left;white-space:nowrap\">{{item.AcceptanceItemName}}</span></md-list-item></md-list><div style=\"padding-bottom: 5px;padding-right: 5px\"><md-list layout=\"row\" ng-if=\"lay==\'row\'\" layout-wrap=\"true\"><div flex=\"50\" flex-gt-xs=\"33\" layout=\"row\" style=\"height: 40px;\" ng-repeat=\"item in source.wpAcceptanceList\" ng-click=\"selectedProcedure(item,source.wpAcceptanceList)\" ng-class=\"{\'active\':item.active}\"><div flex=\"\" style=\"border: 1px solid #d8d8d8;border-radius:5px;margin: 5px 0px 0px 5px;\" layout=\"row\" layout-align=\"center center\"><span flex=\"\" style=\"max-width: 80%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;padding-left: 5%\">{{item.AcceptanceItemName}}</span></div></div></md-list></div></div></div><md-divider></md-divider></div></div>");
$templateCache.put("app/core/directives/ms-material-color-picker/ms-material-color-picker.html","<md-menu md-position-mode=\"target-right target\"><md-button aria-label=\"Row Color\" md-menu-origin=\"\" ng-click=\"$mdOpenMenu($event)\" ng-class=\"selectedColor.class\"><span ng-show=\"selectedColor.palette\">{{selectedColor.palette}} {{selectedColor.hue}}</span> <span ng-show=\"!selectedColor.palette\">Select Color</span></md-button><md-menu-content class=\"ms-material-color-picker-menu-content\" layout-column=\"\"><header ng-class=\"selectedColor.class || \'md-accent-bg\'\" class=\"md-whiteframe-4dp\" layout=\"row\" layout-align=\"space-between center\"><md-button md-prevent-menu-close=\"\" ng-click=\"activateHueSelection(false,false)\" class=\"md-icon-button\" ng-class=\"{\'hidden\':!selectedPalette}\" aria-label=\"Palette\"><md-icon md-font-icon=\"icon-arrow-left\" class=\"s20\"></md-icon></md-button><span ng-if=\"selectedColor.palette\">{{selectedColor.palette}} {{selectedColor.hue}}</span> <span ng-if=\"!selectedColor.palette\">Select Color</span><md-button class=\"remove-color-button md-icon-button\" ng-click=\"removeColor()\" aria-label=\"Remove Color\"><md-icon md-font-icon=\"icon-delete\" class=\"s20\"></md-icon></md-button></header><div class=\"colors\" ms-scroll=\"\"><div ng-if=\"!selectedPalette\" layout=\"row\" layout-wrap=\"\"><div class=\"color\" ng-class=\"\'md-\'+palette+\'-500-bg\'\" ng-repeat=\"(palette, hues) in palettes\" ng-click=\"activateHueSelection(palette,hues)\" layout=\"row\" layout-align=\"start end\" md-prevent-menu-close=\"\" md-ink-ripple=\"\"><span class=\"label\">{{palette}}</span></div></div><div ng-if=\"selectedPalette\" layout=\"row\" layout-wrap=\"\"><div class=\"color\" ng-class=\"\'md-\'+selectedPalette+\'-\'+hue+\'-bg\'\" ng-repeat=\"(hue, values) in selectedHues\" ng-click=\"selectColor(selectedPalette,hue)\" layout=\"row\" layout-align=\"start end\" md-ink-ripple=\"\"><span class=\"label\">{{hue}}</span> <i ng-if=\"selectedPalette == selectedColor.palette && hue == selectedColor.hue\" class=\"s16 icon-check\"></i></div></div></div></md-menu-content></md-menu>");
$templateCache.put("app/core/directives/ms-search-bar/ms-search-bar.html","<div flex=\"\" layout=\"row\" layout-align=\"start center\"><label for=\"ms-search-bar-input\"><md-icon id=\"ms-search-bar-expander\" md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon><md-icon id=\"ms-search-bar-collapser\" md-font-icon=\"icon-close\" class=\"icon s24\"></md-icon></label> <input id=\"ms-search-bar-input\" type=\"text\" ng-model=\"global.search\" placeholder=\"Search\" translate=\"\" translate-attr-placeholder=\"TOOLBAR.SEARCH\" flex=\"\"></div>");
$templateCache.put("app/main/auth/components/reset-password.html","<md-dialog style=\"width:400px;\" aria-label=\"修改密码\"><form name=\"resetPasswordForm\" novalidate=\"\"><md-toolbar class=\"toolbar-background-image\"><div class=\"md-toolbar-tools\"><h2>修改密码</h2><span flex=\"\"></span></div></md-toolbar><md-dialog-content class=\"md-dialog-content\"><div class=\"title\" style=\"text-align: center;\">{{d.LoginID}}</div><div class=\"mt20 m15 bindemail\" flex=\"\"><div layout=\"row\" flex=\"\"><md-input-container style=\"width:100%\"><label for=\"curpwd\">请输入原密码</label> <input class=\"ng-pristine ng-valid md-input ng-not-empty ng-touched\" id=\"curpwd\" style=\"background-color: #fff;width:100%;\" type=\"password\" name=\"CurrentPassword\" ng-model=\"d.CurrentPassword\" required=\"\"></md-input-container><div ng-messages=\"form.CurrentPassword.$error\" role=\"alert\"><div ng-message=\"required\"><span>原密码不能为空</span></div></div></div><div layout=\"row\" flex=\"\"><md-input-container style=\"width:100%\"><label for=\"newpwd\">请输入新密码</label> <input class=\"ng-pristine ng-valid md-input ng-not-empty ng-touched\" id=\"newpwd\" style=\"background-color: #fff;border:1px solid #d9d9d9;border-radius:4px;line-height:30px;padding:0 5px;width:100%;\" type=\"password\" name=\"NewPassword\" ng-model=\"d.NewPassword\" required=\"\"></md-input-container><div ng-messages=\"form.NewPassword.$error\" role=\"alert\"><div ng-message=\"required\"><span>新密码不能为空</span></div></div></div><div layout=\"row\" flex=\"\"><md-input-container style=\"width:100%\"><label for=\"newpwdw\">请再次输入新密码</label> <input class=\"ng-pristine ng-valid md-input ng-not-empty ng-touched\" id=\"newpwdw\" style=\"background-color: #fff;border:1px solid #d9d9d9;border-radius:4px;line-height:30px;padding:0 5px;width:100%;\" type=\"password\" name=\"passwordConfirm\" ng-model=\"d.passwordConfirm\" required=\"\"></md-input-container><div ng-messages=\"form.passwordConfirm.$error\" role=\"alert\"><div ng-message=\"required\"><span>确认密码不能为空</span></div></div></div><div layout=\"row\" flex=\"\" class=\"bind-input\"><p flex=\"\" layout-align=\"center center\"></p><div ng-messages=\"form.passwordConfirm.$error\" role=\"alert\"><div ng-message=\"required\"><span>确认密码不能为空</span></div></div></div><div layout=\"row\" flex=\"\"><p flex=\"\" style=\"color: red;\">{{resetError}}</p></div><div layout=\"row\" flex=\"\"><p flex=\"\" style=\"color: limegreen;\">{{resetTrue}}</p></div></div></md-dialog-content><md-dialog-actions layout-align=\"center center\" layout=\"row\"><md-button class=\"md-raised\" ng-click=\"cancel()\">取消</md-button><md-button class=\"md-raised md-primary\" ng-click=\"submit()\" ng-disabled=\"resetPasswordForm.$invalid || resetPasswordForm.$pristine\">保存</md-button></md-dialog-actions></form></md-dialog>");
$templateCache.put("app/main/auth/login/login.html","<md-content class=\"login\" layout=\"column\"><div id=\"login\"><div id=\"login-form-wrapper\" layout=\"column\" layout-align=\"center center\" layout-align-xs=\"center start\"><div id=\"login-form\" style=\"\"><div class=\"logo1\"><span><img src=\"app/main/xhsc/images/logo.png\"></span></div><form name=\"loginForm\" novalidate=\"\" ng-submit=\"vm.login(loginForm)\"><div class=\"login-name\"><md-input-container class=\"md-block\" md-no-float=\"\" style=\"display: flex;\"><img ng-src=\"app/main/auth/images/user.svg\" style=\"height: 24px;width: 24px\"> <input type=\"text\" style=\"margin-left: 5%\" name=\"username\" ng-model=\"vm.form.username\" placeholder=\"请输入用户名\" required=\"\"></md-input-container><md-divider></md-divider><md-input-container class=\"md-block\" md-no-float=\"\" style=\"display: flex;\"><img ng-src=\"app/main/auth/images/password.svg\" style=\"height: 24px;width: 24px\"> <input type=\"password\" style=\"margin-left: 5%\" name=\"password\" ng-model=\"vm.form.password\" placeholder=\"请输入密码\" required=\"\"></md-input-container></div><div layout=\"row\" layout-align=\"center center\"><md-button type=\"submit\" flex=\"\" class=\"md-raised md-warn\" aria-label=\"登录\">{{vm.text}}</md-button></div></form></div></div></div></md-content>");
$templateCache.put("app/main/earthwork/component/earthwork-list.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>土方管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-padding=\"\"><div layout=\"row\"><md-input-container flex=\"45\" style=\"padding:0px 15px;\"><label>项目</label><md-select name=\"ProjectID\" ng-model=\"vm.project\"><md-option ng-repeat=\"item in vm.ProjectList\" ng-value=\"item.ProjectID\" ng-click=\"vm.makeRegionTreeName(item.ProjectName,null)\">{{item.ProjectName}}</md-option></md-select></md-input-container><md-input-container flex=\"45\" style=\"padding:0px 15px\"><label>分期</label><md-select name=\"RegionID\" ng-model=\"vm.Stages\"><md-option ng-repeat=\"item in vm.StagesList\" ng-value=\"item.RegionID\" ng-click=\"vm.makeRegionTreeName(null,item.RegionName)\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\" style=\"margin: 0 5px;\"><div style=\"border: 2px solid darkgray;border-radius: 5px; margin: 0px 5px 10px 5px;min-width: 203px; float: left;\" ng-repeat=\"item in vm.lst_html\"><input type=\"text\" style=\"min-width: 110px; width: 114px; height: 35px;padding: 0 10px;\" ng-value=\"item.RegionName\" ng-model=\"item.RegionName\" required=\"\"><md-button class=\"md-raised\" style=\"min-width:41px;height:35px;padding: 0;margin:0;border-left: 2px solid darkgray;border-right: 0; margin-right: -2px;\" ng-click=\"vm.save(item)\">保存</md-button><md-button class=\"md-raised\" ng-click=\"vm.tf.obj = item;vm.tf.files = []\" style=\"min-width:41px;height:35px; margin:0;padding: 0;border-left: 2px solid darkgray;border-right: 0;\">管理</md-button></div><div style=\"border: 2px solid darkgray;border-radius: 5px; margin: 0px 5px 10px 5px;min-width: 206px;width: 206px;float: left;\"><input type=\"text\" ng-model=\"vm.RegionName\" style=\"min-width: 118px; width: 118px; height: 35px;padding: 0 10px;\" required=\"\"><md-button class=\"md-raised\" style=\"min-width: 82px;height:35px;padding: 0;margin:0;border-left: 2px solid darkgray;border-right: 0;;float: right;\" ng-click=\"vm.addRegion()\" ng-disabled=\"vm.project==null || vm.Stages==null\">添加</md-button></div></div><div ng-show=\"vm.tf.obj.Id\"><div style=\"height:500px;background: #ddd;\" is-show=\"true\" popup=\"tfPopup\" sxt-area-tf=\"\" data=\"vm.tf\"></div><div ng-hide=\"true\"><div id=\"tfPopup\" class=\"form-group\"><input type=\"text\" style=\"width: 150px;\"></div></div><sxt-images-tf ng-model=\"vm.tf.obj.Id\" single=\"true\" files=\"vm.tf.files\" edit=\"true\"></sxt-images-tf></div></md-content>");
$templateCache.put("app/main/earthwork/component/earthwork-test.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>画图控件</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><div style=\"height:500px\" is-show=\"true\" popup=\"tfPopup\" sxt-area-tf=\"\" data=\"vm.tf\"></div><div ng-hide=\"true\"><div id=\"tfPopup\" class=\"form-group\"><input type=\"text\" style=\"width: 150px;\"></div></div></md-content>");
$templateCache.put("app/main/earthwork/directives/sxtImages_Template.html","<div class=\"imageEdit\"><div class=\"edititem\" ng-repeat=\"item in uploader.queue\"><img style=\"height:150px;margin:0 5px; width: 200px;\" ng-click=\"editPic(item.file)\" osrc=\"{{item.file.Url.substring(1).replace(\'/s_\',\'/\')}}\" ng-src=\"{{item.file.Url.replace(\'/s_\',\'/\')}}\" class=\"img-thumbnail\"><div class=\"imgleft\" ng-if=\"isPartions==\'true\'\"><div class=\"dropdown\"><button class=\"btn btn-white btn-xs dropdown-toggle\" type=\"button\" data-toggle=\"dropdown\" my-select=\"\" style=\"font-size: smaller;font-weight:400\">{{item.showPartion?item.showPartion:\'部位\'}} <span class=\"caret\"></span></button><ul class=\"dropdown-menu\" ng-show=\"true\"><li ng-repeat=\"_item in partions\" ng-click=\"modify(_item.Id,item)\"><a href=\"javascript:void(0)\">{{_item.desc}}</a></li></ul></div></div><div ng-if=\"edit\" class=\"text\" style=\"padding: 5px; text-align: right;\"><div style=\"position: relative;\"><a ng-if=\"edit\" style=\"position: absolute; right: 30px;width: 50px; color: #428bca;\">替换</a> <input type=\"file\" style=\"position: absolute; right: 30px; width: 50px; opacity: 0;cursor: pointer; font-size: 0; height: 20px;\" nv-file-select=\"\" uploader=\"uploader\" multiple=\"\" ng-click=\"inputChange()\" ;=\"\"></div><a ng-click=\"remove($event,item)\" style=\"cursor: pointer; color: #428bca;\">删除</a></div></div><div style=\"float:left;padding:10px;\" ng-if=\"edit\" ng-show=\"uploader.queue.length == 0\"><div class=\"file-drop-zone\" style=\"height:140px;margin:0 5px;line-height:140px; padding:5px;\" nv-file-drop=\"\" uploader=\"uploader\"><input type=\"file\" nv-file-select=\"\" uploader=\"uploader\" multiple=\"\" ng-click=\"inputChange()\" ;=\"\"></div></div></div>");
$templateCache.put("app/main/material/component/material-add.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>{{(vm.cid && vm.cid!=0)?\"合同材料管理\":\"材料管理\" }}</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form name=\"myForm\" ng-submit=\"vm.save()\"><md-input-container class=\"md-block\" style=\"height: 58px;\"><label>材料分类</label><md-select name=\"MaterialClassId\" required=\"\" ng-model=\"vm.data.MaterialClassId\" ng-disabled=\"vm.pageState\"><md-option ng-value=\"item.Id\" ng-repeat=\"item in vm.materialType\">{{item.CategoryName}}</md-option></md-select></md-input-container><md-input-container class=\"md-block\"><label>材料名称</label> <input name=\"MaterialName\" required=\"\" type=\"text\" ng-model=\"vm.data.MaterialName\" ng-disabled=\"vm.pageState\"><div ng-messages=\"myForm.MaterialName.$error\" ng-show=\"myForm.MaterialName.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请材料分类.</span></div></div></md-input-container><md-input-container ng-if=\"!vm.pageState\" class=\"md-block\"><label>型号</label> <input type=\"text\" ng-model=\"vm.data.Model\" ng-disabled=\"vm.pageState\"><div class=\"hint\">多个型号请用、|,|，|；|;分隔</div></md-input-container><md-input-container ng-if=\"!vm.pageState\" class=\"md-block\"><label>规格</label> <input type=\"text\" ng-model=\"vm.data.Specifications\" ng-disabled=\"vm.pageState\"><div class=\"hint\">多个规格请用、|,|，|；|;分隔</div></md-input-container><md-input-container class=\"md-block\" ng-if=\"!vm.pageState\"><label>厂家/品牌</label> <input type=\"text\" ng-model=\"vm.data.Brands\"><div class=\"hint\">多个厂家/品牌请用、|,|，|；|;分隔</div></md-input-container><label ng-if=\"vm.pageState\">厂家/品牌</label><md-chips ng-if=\"vm.pageState\" ng-model=\"vm.Brands\" name=\"fruitName\" readonly=\"false\" placeholder=\"输入按下Enter添加...\" md-removable=\"true\"><md-chip-template><strong>{{$chip}}</strong></md-chip-template></md-chips><div layout=\"row\" flex=\"\"><md-button type=\"submit\" class=\"md-primary md-raised\">保存</md-button><md-button ui-sref=\"app.material.materialLibrary({cid:vm.cid!=0?vm.cid:null})\" class=\"md-primary md-raised\">返回</md-button></div></form></md-content>");
$templateCache.put("app/main/material/component/material-batchDetail.html","<div ng-cloak=\"\"><md-content style=\"font-size: 1.1em;\"><md-tabs md-dynamic-height=\"\" md-border-bottom=\"\"><md-tab label=\"材料计划信息\"><md-content class=\"md-padding\"><md-list flex=\"\" style=\"padding-top: 0;\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料计划信息</div><md-list-item><p flex=\"15\" style=\"display: block; word-break:keep-all;white-space:nowrap;\">计划名称：</p><p>{{vm.data.PlanModel.PlanDetail.PlanName}}</p></md-list-item><md-list-item><p flex=\"15\">材料/设备名称：</p><p>{{vm.data.PlanModel.PlanDetail.MaterialName}}</p></md-list-item><md-list-item><p flex=\"15\">规格：</p><p>{{vm.data.PlanModel.PlanDetail.Specifications}}</p></md-list-item><md-list-item><p flex=\"15\">型号：</p><p>{{vm.data.PlanModel.PlanDetail.Model}}</p></md-list-item><md-list-item><p flex=\"15\">计划进场时间：</p><p>{{vm.data.PlanModel.PlanDetail.PlanTime | date:\'yyyy-MM-dd\'}}</p></md-list-item><md-list-item><p flex=\"15\">计划进场数量：</p><p>{{vm.data.PlanModel.PlanDetail.PlanCount + vm.data.PlanDetail.Unit}}</p></md-list-item><md-list-item><p flex=\"15\">使用部位：</p><p>{{vm.data.PlanModel.PlanDetail.Position}}</p></md-list-item><md-list-item><p flex=\"15\">合同编号：</p><p>{{vm.data.PlanModel.PlanDetail.Contract}}</p></md-list-item><md-list-item><p flex=\"15\">供货方式：</p><p ng-if=\"vm.data.PlanModel.PlanDetail.SupplyType == 1\">甲供</p><p ng-if=\"vm.data.PlanModel.PlanDetail.SupplyType == 2\">认质认价</p><p ng-if=\"vm.data.PlanModel.PlanDetail.SupplyType == 4\">甲指乙供</p></md-list-item><md-list-item><p flex=\"15\">状态：</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 1\">未进场</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 2\">未验收</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 4\">未送检</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 8\">未归档</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 16\">未批示</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 32\">未退场</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 64\">已完成</p><p ng-if=\"vm.data.PlanModel.PlanDetail.Status == 128\">分批进场</p></md-list-item></md-list></md-content></md-tab><md-tab label=\"批次 {{$index+1}}\" ng-repeat=\"item in vm.data.PlanModel.PlanBatchDetail\"><md-content class=\"md-padding\"><md-list ng-hide=\"item.ApproachTime == null\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料进场信息</div><md-list-item><p flex=\"15\">进场时间：</p><p>{{item.ApproachTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">进场数量：</p><p>{{item.ApproachCount + item.Unit}}</p></md-list-item><md-list-item><p flex=\"15\" style=\"display: block; word-break:keep-all;white-space:nowrap;\">厂家/品牌：</p><p>{{item.Brand}}</p></md-list-item><md-list-item><p flex=\"15\">供货方：</p><p>{{item.Supplier}}</p></md-list-item><md-list-item><p flex=\"15\">有无封样：</p><p>{{item.IsPacking?\'有\':\'无\'}}</p></md-list-item><md-list-item><p flex=\"15\">状态：</p><p ng-if=\"item.Status == 1\">未进场</p><p ng-if=\"item.Status == 2\">未验收</p><p ng-if=\"item.Status == 4\">未送检</p><p ng-if=\"item.Status == 8\">未归档</p><p ng-if=\"item.Status == 16\">未批示</p><p ng-if=\"item.Status == 32\">未退场</p><p ng-if=\"item.Status == 64\">已完成</p></md-list-item><md-list-item><p flex=\"15\">检查人：</p><p>{{item.Inspector}}</p></md-list-item><md-list-item><p flex=\"15\">进场照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><label flex=\"15\">车辆：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:256}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">货物：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:512}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">检查人：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:1024}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">检查人：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:2048}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list><md-list ng-hide=\"item.AcceptanceTime == null\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">监理验收信息</div><md-list-item><p flex=\"15\">验收时间：</p><p>{{item.AcceptanceTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">现场检查：</p><p>{{item.WgCheck?\'合格\':\'不合格\'}}</p></md-list-item><md-list-item><p flex=\"15\">是否送检：</p><p>{{item.IsInspection?\'需要\':\'不需要\'}}</p></md-list-item><md-list-item><p flex=\"15\">验收人：</p><p>{{item.Accepter}}</p></md-list-item><md-list-item><p flex=\"15\">验收照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><label flex=\"15\">车辆：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:1}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">货物：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:2}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">验收人：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:4}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">合格证：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:8}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list><md-list ng-hide=\"!item.IsInspection || item.InspectionTime==null\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">监理送检信息</div><md-list-item><p flex=\"15\">送检时间：</p><p>{{item.InspectionTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">送检人：</p><p>{{item.Inspectioner}}</p></md-list-item><md-list-item><p flex=\"15\">送检单编号：</p><p>{{item.CheckList}}</p></md-list-item><md-list-item><p flex=\"15\">送检照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><label flex=\"15\">抽样过程：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:16}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item><md-list-item style=\"padding-left:0;\"><label flex=\"15\">检查单：</label><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:32}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list><md-list ng-hide=\"item.ReportTime == null\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">送检报告信息</div><md-list-item><p flex=\"15\">报告日期：</p><p>{{item.ReportTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">报告单单号：</p><p>{{item.Report}}</p></md-list-item><md-list-item><p flex=\"15\">实验室检查：</p><p>{{item.LabCheck?\"合格\":\"不合格\"}}</p></md-list-item><md-list-item><p flex=\"15\">报告单照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:64}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list><md-list ng-hide=\"item.ExitCount != 0\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料退场信息</div><md-list-item><p flex=\"15\">退场原因：</p><p>{{item.ExitReason}}</p></md-list-item><md-list-item><p flex=\"15\">退场数量：</p><p>{{item.ExitCount + item.Unit}}</p></md-list-item><md-list-item><p flex=\"15\">退场见证人：</p><p>{{item.ExitWitness}}</p></md-list-item><md-list-item><p flex=\"15\">退场操作时间：</p><p>{{item.ExitOperatorTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">退场照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><div flex=\"\" ng-repeat=\"img in item.MaterialFiles | filter:{OptionType:128}:true\" sxt-images=\"item.MaterialFiles\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list><md-list ng-hide=\"item.ApprovalTime == null\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料批示信息</div><md-list-item><p flex=\"15\">甲方经理：</p><p>{{item.PartyA}}</p></md-list-item><md-list-item><p flex=\"15\">批示时间：</p><p>{{item.ApprovalTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">批示处理情况：</p><p>{{item.Handle?\"合格\":\"不合格\"}}</p></md-list-item><md-list-item><p flex=\"15\">甲方处理原因：</p><p>{{item.Reason}}</p></md-list-item><md-list-item><p flex=\"15\">甲方意见：</p><p>{{item.Opinion}}</p></md-list-item></md-list></md-content></md-tab><md-tab label=\"多余材料退场\" ng-if=\"vm.data.PlanModel.PlanBatchExit.length>0\"><md-content class=\"md-padding\"><md-list ng-repeat=\"item in vm.data.PlanModel.PlanBatchExit\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">多余材料退场批次 {{$index+1}}</div><md-list-item><p flex=\"15\">退场数量：</p><p>{{item.ExitCount + item.Unit}}</p></md-list-item><md-list-item><p flex=\"15\">退场见证人：</p><p>{{item.ExitWitness}}</p></md-list-item><md-list-item><p flex=\"15\">退场操作时间：</p><p>{{item.ExitOperatorTime | date:\'yyyy-MM-dd HH:mm\'}}</p></md-list-item><md-list-item><p flex=\"15\">退场照片：</p><md-list flex=\"85\" ng-cloak=\"\"><md-list-item style=\"padding-left:0;\"><div flex=\"\" ng-repeat=\"img in item.Images | filter:{OptionType:128}:true\" sxt-images=\"item.Images\" style=\"text-align: left;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 150px;\" flex=\"95\"></div></md-list-item></md-list></md-list-item></md-list></md-content></md-tab></md-tabs></md-content></div>");
$templateCache.put("app/main/material/component/material-classAdd.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>材料分类管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form name=\"myForm\" ng-submit=\"vm.save()\"><md-input-container class=\"md-block\"><label>分类名称</label> <input name=\"CategoryName\" type=\"text\" ng-model=\"vm.data.CategoryName\" required=\"\"><div ng-messages=\"myForm.CategoryName.$error\" ng-show=\"myForm.CategoryName.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入分类名称.</span></div></div></md-input-container><div layout=\"row\" flex=\"\"><md-button type=\"submit\" class=\"md-primary md-raised\">保存</md-button><md-button ui-sref=\"app.material.type\" class=\"md-primary md-raised\">返回</md-button></div></form></md-content>");
$templateCache.put("app/main/material/component/material-contract.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>合同管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form name=\"myForm\" flex=\"\" ng-submit=\"vm.save()\"><div layout=\"row\"><md-input-container class=\"md-block\" style=\"height: 58px;\" flex=\"100\"><label>乙方</label><md-select name=\"PartnerId\" required=\"\" ng-model=\"vm.data.PartnerId\" md-on-close=\"vm.clearSearchTerm()\" data-md-container-class=\"selectdemoSelectHeader\"><md-select-header class=\"demo-select-header\"><input ng-model=\"vm.searchTerm\" type=\"search\" placeholder=\"搜索..\" class=\"demo-header-searchbox md-text\"></md-select-header><md-option ng-value=\"item.Id\" ng-repeat=\"item in vm.Partners | filter:vm.searchTerm\">{{item.OUName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"100\" class=\"md-block\"><label>合同名称</label> <input type=\"text\" name=\"Name\" required=\"\" ng-model=\"vm.data.Name\"><div ng-messages=\"myForm.Name.$error\" ng-show=\"myForm.Name.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入合同名称.</span></div></div></md-input-container></div><div layout=\"row\"><md-input-container flex=\"100\" class=\"md-block\"><label>合同编号</label> <input type=\"text\" name=\"Number\" required=\"\" ng-model=\"vm.data.Number\"><div ng-messages=\"myForm.Number.$error\" ng-show=\"myForm.Number.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入合同编号.</span></div></div></md-input-container></div><div layout=\"row\"><md-input-container class=\"md-block\" style=\"height: 58px;\" flex=\"100\"><label>材料库</label><md-select name=\"MaterialTypeId\" required=\"\" ng-model=\"vm.MaterialIds\" multiple=\"\"><md-option ng-value=\"item.Id\" ng-repeat=\"item in vm.materialClass\">{{item.CategoryName}}</md-option></md-select></md-input-container></div><md-button type=\"submit\" class=\"md-primary md-raised\">保存</md-button><md-button ui-sref=\"app.material.contracts\" class=\"md-primary md-raised\">返回</md-button></form></md-content>");
$templateCache.put("app/main/material/component/material-contracts.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>合同管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.material.contract\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th style=\"width: 45px;\">序号</th><th>乙方（总包）</th><th>合同名称</th><th>合同编号</th><th style=\"width: 200px;\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.data\"><td>{{$index+1}}</td><td>{{item.PartnerName}}</td><td>{{item.Name}}</td><td>{{item.Number}}</td><td class=\"actions\"><md-button class=\"md-icon-button\" title=\"编辑\" aria-label=\"Settings\" ui-sref=\"app.material.contract({id:item.Id})\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" title=\"合同材料管理\" aria-label=\"Settings\" ui-sref=\"app.material.materialLibrary({cid:item.Id})\"><md-icon md-font-icon=\"icon-checkerboard\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" title=\"删除\" aria-label=\"Settings\" ng-click=\"vm.delete(item.Id)\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/material/component/material-library.html","<link rel=\"stylesheet\" href=\"/app/assets/bootstrap.min.css\"><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>{{(vm.cid && vm.cid!=0)?\"合同材料管理\":\"材料管理\" }}</span></h2></div></md-toolbar><div class=\"row\" style=\"padding:0px 15px;\"><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\" id=\"treeCls\"><script type=\"text/ng-template\" id=\"nodes_renderer.html\"><div ui-tree-handle class=\"tree-node tree-node-content ng-scope angular-ui-tree-handle\"> <span class=\"pull-right treespan\"> <a data-nodrag ng-if=\"node.level==1 && !vm.cid\" ng-click=\"vm.alertPromat(node,$event)\"><span class=\"glyphicon\">批量管理</span></a> <a data-nodrag ng-if=\"node.level==1 && !vm.cid\"><span class=\"glyphicon\" ng-click=\"vm.addMaterial(node)\">新增</span></a> <a data-nodrag ng-click=\"vm.btnEdit(node,true,$event)\" ng-if=\"!vm.cid\"><span class=\"glyphicon\">编辑</span></a> <a data-nodrag ng-click=\"vm.btnEdit(node,true,$event)\" ng-if=\"vm.cid && node.level==2\"><span class=\"glyphicon\">编辑</span></a> <a data-nodrag ng-click=\" vm.btnRemove(node)\" ng-if=\"!vm.cid\"><span class=\"glyphicon\">删除</span></a> </span> <a ng-if=\"node.level != 2\"> <span class=\"glyphicon\" ng-class=\"{\'glyphicon-plus\': !collapsed,\'glyphicon-minus\': collapsed}\" ng-click=\"vm.toggleClick(node,this)\"></span> </a> <span class=\"nodetitle\">{{node.title}}<i class=\"fa fa-refresh fa-spin\"></i></span> </div> <ol ui-tree-nodes ng-model=\"node.nodes\" ng-class=\"{hidden: !collapsed}\"> <li ng-repeat=\"node in node.nodes\" ui-tree-node ng-include=\"\'nodes_renderer.html\'\"> </li> </ol></script><div ng-if=\"!vm.cid\"><a class=\"angular-ui-tree-handle\" data-nodrag=\"\" style=\"padding-top: 3px;padding-bottom: 3px;\"><span class=\"glyphicon glyphicon-plus\" ng-click=\"vm.showPrompt(null,false,$event)\">&nbsp;新增材料库</span></a></div><div style=\"margin-top: -10px;\"><div ui-tree=\"\" data-drag-enabled=\"false\" id=\"tree-root\"><ol ui-tree-nodes=\"\" ng-model=\"data\"><li ng-repeat=\"node in data.nodeList\" ui-tree-node=\"\" ng-include=\"\'nodes_renderer.html\'\" class=\"ng-scope angular-ui-tree-node\"></li></ol></div></div></md-content></div>");
$templateCache.put("app/main/material/component/material-list.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>材料管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.material.add\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th>材料分类</th><th>材料名称</th><th>型号</th><th>规格</th><th style=\"width:350px;\">厂家/品牌</th><th style=\"width:160px;\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.data\"><td>{{item.CategoryName}}</td><td>{{item.MaterialName}}</td><td>{{item.Model}}</td><td>{{item.Specifications}}</td><td>{{item.Brands}}</td><td class=\"actions\"><md-button class=\"md-icon-button\" aria-label=\"Settings\" ui-sref=\"app.material.add({id:item.Id})\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Settings\" ng-click=\"vm.delete(item.Id)\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/material/component/material-plan.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>材料进场计划</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form name=\"myForm\" ng-submit=\"vm.save()\"><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"40\"><label>项目</label><md-select name=\"ProjectId\" required=\"\" md-on-open=\"vm.getMaps()\" ng-model=\"vm.data.ProjectId\"><md-option ng-value=\"p.ProjectID\" ng-click=\"vm.upNext()\" ng-repeat=\"p in vm.projects\">{{p.ProjectName}}</md-option></md-select><div ng-messages=\"myForm.ProjectID.$error\" ng-show=\"myForm.ProjectID.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择项目.</span></div></div></md-input-container><md-input-container class=\"md-block\" flex=\"30\"><label>分期</label><md-select name=\"RegionId\" required=\"\" md-on-open=\"vm.getAreas(vm.data.ProjectId)\" ng-model=\"vm.RegionId\"><md-option ng-value=\"p.RegionID\" ng-click=\"vm.upSection()\" ng-repeat=\"p in vm.regions\">{{p.RegionName}}</md-option></md-select><div ng-messages=\"myForm.RegionId.$error\" ng-show=\"myForm.RegionId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择分期.</span></div></div></md-input-container><md-input-container class=\"md-block\" flex=\"30\"><label>标段</label><md-select name=\"SectionId\" required=\"\" md-on-open=\"vm.getSections(vm.RegionId)\" ng-model=\"vm.SectionId\"><md-option ng-value=\"p.RegionID\" ng-click=\"vm.getContracts()\" ng-repeat=\"p in vm.sections\">{{p.RegionName}}</md-option></md-select><div ng-messages=\"myForm.SectionId.$error\" ng-show=\"myForm.SectionId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择标段.</span></div></div></md-input-container></div><div layout=\"row\"><md-input-container style=\"height: 58px;\" flex=\"100\"><label>合同</label><md-select name=\"ContractId\" required=\"\" ng-model=\"vm.data.ContractId\" md-on-close=\"clearSearchC()\" data-md-container-class=\"selectdemoSelectHeader\"><md-select-header class=\"demo-select-header\"><input ng-model=\"searchC\" type=\"search\" placeholder=\"搜索..\" class=\"demo-header-searchbox md-text\"></md-select-header><md-option ng-value=\"item.Id\" ng-click=\"vm.data.Contract = item.Number;vm.typeId=item.Id\" ng-repeat=\"item in vm.contracts | filter:searchC\">{{item.Name + \'/\' + item.Number}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container style=\"height: 58px;\" flex=\"40\"><label>材料/设备名称</label><md-select name=\"material\" required=\"\" ng-model=\"vm.data.Material\" md-on-open=\"vm.getMaterial()\" md-on-close=\"clearSearchTerm()\" data-md-container-class=\"selectdemoSelectHeader\"><md-select-header class=\"demo-select-header\"><input ng-model=\"searchTerm\" type=\"search\" placeholder=\"搜索..\" class=\"demo-header-searchbox md-text\"></md-select-header><md-option ng-value=\"m\" ng-selected=\"m.selected\" ng-repeat=\"m in vm.materials | filter:searchTerm\" ng-click=\"vm.init(m)\">{{m.MaterialName}}</md-option></md-select><div ng-messages=\"myForm.material.$error\" ng-show=\"myForm.material.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择材料.</span></div></div></md-input-container><md-autocomplete flex=\"30\" style=\"margin:10px 0px 10px 10px;\" ng-disabled=\"false\" md-no-cache=\"true\" md-selected-item=\"vm.selectedItem\" md-search-text=\"vm.searchText\" md-items=\"item in vm.querySearch(vm.searchText,1)\" md-item-text=\"item.display\" md-min-length=\"0\" placeholder=\"请输入或选择材料规格\"><md-item-template><span md-highlight-text=\"vm.searchText\" md-highlight-flags=\"^i\">{{item.display}}</span></md-item-template></md-autocomplete><md-autocomplete flex=\"30\" style=\"margin:10px 0px 10px 10px;\" ng-disabled=\"false\" md-no-cache=\"true\" md-selected-item=\"vm.selectedItem2\" md-search-text=\"vm.searchText2\" md-items=\"item2 in vm.querySearch(vm.searchText2,2)\" md-item-text=\"item2.display\" md-min-length=\"0\" placeholder=\"请输入或选择材料型号\"><md-item-template><span md-highlight-text=\"vm.searchText2\" md-highlight-flags=\"^i\">{{item2.display}}</span></md-item-template></md-autocomplete></div><md-input-container class=\"md-block\"><label>计划进场时间</label><md-datepicker ng-model=\"vm.data.PlanTime\" md-open-on-focus=\"\"></md-datepicker></md-input-container><md-input-container class=\"md-block\"><label>计划进场数量</label> <input name=\"PlanCount\" type=\"number\" required=\"\" ng-model=\"vm.data.PlanCount\" min=\"0\"><div ng-messages=\"myForm.PlanCount.$error\" ng-show=\"myForm.PlanCount.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入计划进场数量.</span></div></div></md-input-container><md-input-container class=\"md-block\"><label>计量单位</label> <input name=\"Unit\" type=\"text\" required=\"\" ng-model=\"vm.data.Unit\"><div ng-messages=\"myForm.Unit.$error\" ng-show=\"myForm.Unit.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入计量单位.</span></div></div></md-input-container><md-input-container class=\"md-block\"><label>使用部位</label> <input name=\"Position\" type=\"text\" required=\"\" ng-model=\"vm.data.Position\"><div ng-messages=\"myForm.Position.$error\" ng-show=\"myForm.Position.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入使用部位.</span></div></div></md-input-container><md-input-container class=\"md-block\" style=\"height: 58px;\"><label>供货方式</label><md-select name=\"SupplyType\" required=\"\" ng-model=\"vm.data.SupplyType\"><md-option ng-value=\"item.type\" ng-repeat=\"item in vm.SupplyType\">{{item.name}}</md-option></md-select><div ng-messages=\"myForm.SupplyType.$error\" ng-show=\"myForm.SupplyType.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择供货方式.</span></div></div></md-input-container><md-input-container class=\"md-block\"><label>计划名称</label> <input name=\"PlanName\" required=\"\" type=\"text\" ng-change=\"vm.change()\" ng-model=\"vm.data.PlanName\"><div ng-messages=\"myForm.PlanName.$error\" ng-show=\"myForm.PlanName.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入计划名称.</span></div></div></md-input-container><div layout=\"row\" flex=\"\"><md-button type=\"submit\" class=\"md-primary md-raised\">保存</md-button><md-button ui-sref=\"app.material.plans\" class=\"md-primary md-raised\">返回</md-button></div></form></md-content>");
$templateCache.put("app/main/material/component/material-plans.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>材料进场计划</span></h2><span flex=\"5\"></span><md-select style=\"font-size:13px;margin-right:20px;\" name=\"projectId\" ng-model=\"vm.ProjectId\"><md-option ng-value=\"p.ProjectID\" ng-selected=\"p.selected\" ng-repeat=\"p in vm.projects\">{{p.ProjectName}}</md-option></md-select><md-select style=\"font-size:13px;margin-right:20px;\" name=\"sectionId\" ng-model=\"vm.RegionId\"><md-option ng-value=\"p.RegionID\" ng-selected=\"p.selected\" ng-repeat=\"p in vm.regions\">{{p.RegionName}}</md-option></md-select><md-select style=\"font-size:13px;margin-right:20px;\" name=\"sectionId\" ng-model=\"vm.SectionId\"><md-option ng-value=\"p.RegionID\" ng-selected=\"p.selected\" ng-repeat=\"p in vm.sections\">{{p.RegionName}}</md-option></md-select><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.material.plan\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th style=\"min-width: 60px;padding-left: 12px;\">序号</th><th>计划名称</th><th>进场计划时间</th><th style=\"text-align: center;\">进场计划数量</th><th>使用部位</th><th>合同编号</th><th style=\"min-width: 80px;\">供货方式</th><th style=\"min-width: 70px;\">状态</th><th style=\"width: 160px; text-align: center;\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.data\"><td ng-bind=\"$index+1\" style=\"min-width: 60px;\">1</td><td>{{item.PlanName}}</td><td>{{item.PlanTime | date:\'yyyy-MM-dd\'}}</td><td style=\"text-align: center;\">{{item.PlanCount + item.Unit}}</td><td>{{item.Position}}</td><td>{{item.Contract}}</td><td><label ng-if=\"item.SupplyType == 1\">甲供</label> <label ng-if=\"item.SupplyType == 2\">认质认价</label> <label ng-if=\"item.SupplyType == 4\">甲指乙供</label></td><td><label ng-if=\"item.Status == 1\">未进场</label> <label ng-if=\"item.Status == 2\">未验收</label> <label ng-if=\"item.Status == 4\">未送检</label> <label ng-if=\"item.Status == 8\">未归档</label> <label ng-if=\"item.Status == 16\">未批示</label> <label ng-if=\"item.Status == 32\">未退场</label> <label ng-if=\"item.Status == 64\">已完成</label> <label ng-if=\"item.Status == 128\">分批进场</label></td><td class=\"actions\"><md-button class=\"md-icon-button\" aria-label=\"Settings\" ui-sref=\"app.material.plan({id:item.Id})\" ng-hide=\"item.Status!=1\" style=\"margin: 0;\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Settings\" ng-click=\"vm.delete(item.Id)\" ng-hide=\"item.Status!=1\" style=\"margin: 0;\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Settings\" ui-sref=\"app.material.batchDetail({planId:item.Id})\" style=\"margin: 0;\"><md-icon md-font-icon=\"icon-document\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/material/component/material-report.html","<div><md-card style=\"background-color: white;\" md-theme-watch=\"\"><md-card-content><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>项目</label><md-select md-on-open=\"vm.getProjects()\" ng-model=\"vm.projectId\"><md-option ng-click=\"vm.clearRegion()\" ng-repeat=\"item in vm.projects\" ng-value=\"item.ProjectID\">{{item.ProjectName}}</md-option></md-select></md-input-container></div><div style=\"width: 20px\"></div><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>分期</label><md-select md-on-open=\"vm.getAreas(vm.projectId)\" ng-model=\"vm.regionId\"><md-option ng-click=\"vm.clearSection()\" ng-repeat=\"item in vm.regions\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"width: 20px\"></div><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>标段</label><md-select md-on-open=\"vm.getSections(vm.regionId)\" ng-model=\"vm.sectionId\"><md-option ng-click=\"vm.getData(item.RegionID)\" ng-repeat=\"item in vm.sections\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div></md-card-content></md-card><form method=\"post\" action=\"http://emp.chngalaxy.com:9091/api/MaterialPlan/GetMaterialReportXls\" target=\"_blank\"><input id=\"export\" type=\"hidden\" name=\"table\"> <input id=\"tital\" type=\"hidden\" name=\"tital\" value=\"材料验收统计\"><md-button class=\"md-raised md-primary\" type=\"submit\" ng-click=\"vm.printBatchCount()\" ng-if=\"vm.isiPad == null\">Excel导出</md-button></form><div layout=\"row\" flex=\"\"><div id=\"divReport\" style=\"margin: 24px 16px;overflow:auto;\"><table class=\"materialReport\"><thead><tr><th style=\"border: 1px solid #ddd\">进场计划</th><th style=\"border: 1px solid #ddd\">材料设备名称</th><th style=\"border: 1px solid #ddd\">计划进场时间</th><th style=\"border: 1px solid #ddd\">计划进场数量</th><th style=\"border: 1px solid #ddd\">使用部位</th><th style=\"border: 1px solid #ddd\">合同编号</th><th style=\"border: 1px solid #ddd\">供货方式</th><th style=\"border: 1px solid #ddd\">型号</th><th style=\"border: 1px solid #ddd\">规格</th><th style=\"border: 1px solid #ddd\">厂家品牌</th><th style=\"border: 1px solid #ddd\">实际进场数量</th><th style=\"border: 1px solid #ddd\">有无封样</th><th style=\"border: 1px solid #ddd\">进场时间</th><th style=\"border: 1px solid #ddd\">供货方</th><th style=\"border: 1px solid #ddd\">进场验收时间</th><th style=\"border: 1px solid #ddd\">验收人</th><th style=\"border: 1px solid #ddd\">验收情况</th><th style=\"border: 1px solid #ddd\">送检需要</th><th style=\"border: 1px solid #ddd\">不合格处理</th><th style=\"border: 1px solid #ddd\">送检时间</th><th style=\"border: 1px solid #ddd\">送检人</th><th style=\"border: 1px solid #ddd\">检验单编号</th><th style=\"border: 1px solid #ddd\">报告日期</th><th style=\"border: 1px solid #ddd\">报告单编号</th><th style=\"border: 1px solid #ddd\">检验情况</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td style=\"border: 1px solid #ddd; min-width: 200px; min-height: 70px;height: 70px;\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.PlanName}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.MaterialName}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.PlanTime | date:\'yyyy-MM-dd\'}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.PlanCount}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.Position}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.Contract}}</td><td style=\"border: 1px solid #ddd\" rowspan=\"{{item.colp}}\" ng-if=\"item.colp\">{{item.SupplyType==1?\'甲供\':item.SupplyType==2?\'认质认价\':\'甲指乙供\'}}</td><td style=\"border: 1px solid #ddd\">{{item.Model}}</td><td style=\"border: 1px solid #ddd\">{{item.Specifications}}</td><td style=\"border: 1px solid #ddd\">{{item.Brand}}</td><td style=\"border: 1px solid #ddd\">{{item.ApproachCount!=null?item.ApproachCount:\'\'}}</td><td style=\"border: 1px solid #ddd\">{{item.IsPacking!=null?item.IsPacking?\'有\':\'无\':\'\'}}</td><td style=\"border: 1px solid #ddd;min-width: 150px;\">{{item.ApproachTime|date:\'yyyy-MM-dd hh:mm\'}}</td><td style=\"border: 1px solid #ddd\">{{item.Supplier}}</td><td style=\"border: 1px solid #ddd;min-width: 150px;\">{{item.CheckTime|date:\'yyyy-MM-dd hh:mm\'}}</td><td style=\"border: 1px solid #ddd\">{{item.CurrentInspectorName}}</td><td style=\"border: 1px solid #ddd\">{{item.WgCheck!=null?item.WgCheck?\'合格\':\'不合格\':\'\'}}</td><td style=\"border: 1px solid #ddd\">{{item.IsInspection!=null?item.IsInspection?\'需要\':\'不需要\':\'\'}}</td><td style=\"border: 1px solid #ddd\">{{item.Opinion}}</td><td style=\"border: 1px solid #ddd;min-width: 150px;\">{{item.InspectionTime|date:\'yyyy-MM-dd hh:mm\'}}</td><td style=\"border: 1px solid #ddd\">{{item.Inspectioner}}</td><td style=\"border: 1px solid #ddd\">{{item.CheckList}}</td><td style=\"border: 1px solid #ddd;min-width: 150px;\">{{item.ReportTime|date:\'yyyy-MM-dd hh:mm\'}}</td><td style=\"border: 1px solid #ddd\">{{item.Report}}</td><td style=\"border: 1px solid #ddd\">{{item.LabCheck!=null?item.LabCheck?\'合格\':\'不合格\':\'\'}}</td></tr></tbody></table></div></div></div><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/material/component/materialClass-list.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>材料分类管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.material.typeAdd\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th>分类名称</th><th style=\"width: 160px;\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.data\"><td>{{item.CategoryName}}</td><td class=\"actions\"><md-button class=\"md-icon-button\" aria-label=\"Settings\" ui-sref=\"app.material.typeAdd({id:item.Id})\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Settings\" ng-click=\"vm.delete(item.Id)\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/materialYs/component/inspection-report.html","<form name=\"projectForm\"><md-list ng-cloak=\"\"><md-list-item style=\"height: 48px;\"><p flex=\"50\">报告日期</p><p style=\"text-align: right;\">{{vm.outPutDate | date:\'yyyy年MM月dd日\' }}</p></md-list-item><md-divider></md-divider><md-list-item style=\"height: 48px;\"><p flex=\"30\">报告单编号</p><md-input-container flex=\"70\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input ng-model=\"vm.data.Report\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider></md-divider><md-list-item><p>实验室检查</p>{{vm.data.LabCheck?\'合格\':\'不合格\'}}<md-switch class=\"md-secondary\" ng-model=\"vm.data.LabCheck\"></md-switch></md-list-item><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">报告单照片</div><md-list-item style=\"padding-right: 0;\"><div flex=\"60\" ng-repeat=\"img in vm.reportImgs\" sxt-images=\"vm.reportImgs\" style=\"text-align: center;margin: 5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(64)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider></md-list></form>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-approval.html","<md-content><md-list flex=\"\" style=\"padding-top: 0;\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料计划信息</div><md-list-item><p flex=\"30\">计划名称</p><p>{{vm.data.PlanName}}</p></md-list-item><md-list-item><p flex=\"30\">材料/设备名称</p><p>{{vm.data.MaterialName}}</p></md-list-item><md-list-item><p flex=\"30\">规格</p><p>{{vm.data.Specifications}}</p></md-list-item><md-list-item><p flex=\"30\">型号</p><p>{{vm.data.Model}}</p></md-list-item><md-list-item><p flex=\"30\">厂家/品牌</p><p>{{vm.data.Brand}}</p></md-list-item><md-list-item><p flex=\"30\">计划进场时间</p><p>{{vm.data.PlanTime | date:\'yyyy-MM-dd\'}}</p></md-list-item><md-list-item><p flex=\"30\">计划进场数量</p><p>{{vm.data.PlanCount + vm.data.Unit}}</p></md-list-item><md-list-item><p flex=\"30\">使用部位</p><p>{{vm.data.Position}}</p></md-list-item><md-list-item><p flex=\"30\">合同编号</p><p>{{vm.data.Contract}}</p></md-list-item><md-list-item><p flex=\"30\">供货方式</p><p ng-if=\"vm.data.SupplyType == 1\">甲供</p><p ng-if=\"vm.data.SupplyType == 2\">认质认价</p><p ng-if=\"vm.data.SupplyType == 4\">甲指乙供</p></md-list-item><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料进场信息</div><md-list-item><p flex=\"30\">进场时间</p><p>{{vm.data.ApproachTime | date:\'yyyy-MM-dd hh:mm\'}}</p></md-list-item><md-list-item><p flex=\"30\">进场数量</p><p>{{vm.data.ApproachCount + vm.data.Unit}}</p></md-list-item><md-list-item><p flex=\"30\">厂家/品牌</p><p>{{vm.data.Brand}}</p></md-list-item><md-list-item><p flex=\"30\">供货方</p><p>{{vm.data.Supplier}}</p></md-list-item><md-list-item><p flex=\"30\">有无封样</p><p>{{vm.data.IsPacking?\'有\':\'无\'}}</p></md-list-item><md-list-item><p flex=\"30\">检查人</p><p>{{vm.data.Inspector}}</p></md-list-item><md-list-item><p flex=\"30\">进场照片</p></md-list-item><md-list-item><div flex=\"\" ng-repeat=\"img in vm.data.Images | filter:{ApproachStage:1}:true\" sxt-images=\"vm.data.Images\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\"></div></md-list-item><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">监理验收信息</div><md-list-item><p flex=\"30\">验收时间</p><p>{{vm.data.AcceptanceTime | date:\'yyyy-MM-dd hh:mm\'}}</p></md-list-item><md-list-item><p flex=\"30\">现场检查</p><p>{{vm.data.WgCheck?\'合格\':\'不合格\'}}</p></md-list-item><md-list-item><p flex=\"30\">验收人</p><p>{{vm.data.Accepter}}</p></md-list-item><md-list-item><p flex=\"30\">验收照片</p></md-list-item><md-list-item><div flex=\"\" ng-repeat=\"img in vm.data.Images | filter:{ApproachStage:2}:true\" sxt-images=\"vm.data.Images\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\"></div></md-list-item></md-list></md-content>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-checkInfo.html","<form name=\"projectForm\"><md-list ng-cloak=\"\" flex=\"\"><md-list-item><p flex=\"40\">验收时间</p><p flex=\"60\" style=\"text-align: right;\">{{vm.outPutDate | date:\'yyyy年MM月dd日\'}}</p></md-list-item><md-divider></md-divider><md-list-item><p>现场检查</p>{{vm.data.WgCheck?\'合格\':\'不合格\'}}&nbsp;<md-switch class=\"md-secondary\" ng-model=\"vm.data.WgCheck\"></md-switch></md-list-item><md-divider></md-divider><md-list-item ng-hide=\"!vm.data.WgCheck\"><p>是否送检</p>{{vm.data.IsInspection?\'需要\':\'不需要\'}}&nbsp;<md-switch class=\"md-secondary\" ng-model=\"vm.data.IsInspection\"></md-switch></md-list-item><md-divider ng-hide=\"!vm.data.WgCheck\"></md-divider><md-list-item style=\"height: 48px;\"><p flex=\"40\">验收人</p><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input ng-model=\"vm.data.Accepter\" style=\"padding: 0;margin-top: 10px;text-align: right;\"></md-input-container></md-list-item><md-subheader class=\"md-no-sticky\" style=\"font-size: 1.1em;background-color: #F2F2F2;\">验收照片</md-subheader><md-list-item style=\"padding-right: 0;\"><p flex=\"30\" class=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">车辆</p><div flex=\"30\" ng-repeat=\"img in vm.vehicleImgs\" sxt-images=\"vm.vehicleImgs\" style=\"text-align: center;margin: 5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\" style=\"display: block;\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(1)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" class=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">货物</label><div flex=\"30\" ng-repeat=\"img in vm.goodsImgs\" sxt-images=\"vm.goodsImgs\" style=\"text-align: center;margin: 5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\" style=\"display: block;\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(2)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" class=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">验收人</label><div flex=\"30\" ng-repeat=\"img in vm.checkerImgs\" sxt-images=\"vm.checkerImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\" style=\"display: block;\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(4)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" class=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">合格证</label><div flex=\"30\" ng-repeat=\"img in vm.certificateImgs\" sxt-images=\"vm.certificateImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\" style=\"display: block;\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(8)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider></md-list></form>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-detail.html","<md-content><md-list flex=\"\" style=\"padding-top: 0;\"><div style=\"background-color: lightgrey; padding: 16px 16px 16px 8px;\">材料计划信息</div><md-list-item><p flex=\"30\">计划名称</p><p>{{vm.data.PlanName}}</p></md-list-item><md-list-item><p flex=\"30\">材料/设备名称</p><p>{{vm.data.MaterialName}}</p></md-list-item><md-list-item><p flex=\"30\">规格</p><p>{{vm.data.Specifications}}</p></md-list-item><md-list-item><p flex=\"30\">型号</p><p>{{vm.data.Model}}</p></md-list-item><md-list-item><p flex=\"30\">计划进场时间</p><p>{{vm.data.PlanTime | date:\'yyyy-MM-dd\'}}</p></md-list-item><md-list-item><p flex=\"30\">计划进场数量</p><p>{{vm.data.PlanCount + vm.data.Unit}}</p></md-list-item><md-list-item><p flex=\"30\">使用部位</p><p>{{vm.data.Position}}</p></md-list-item><md-list-item><p flex=\"30\">合同编号</p><p>{{vm.data.Contract}}</p></md-list-item><md-list-item><p flex=\"30\">供货方式</p><p ng-if=\"vm.data.SupplyType == 1\">甲供</p><p ng-if=\"vm.data.SupplyType == 2\">认质认价</p><p ng-if=\"vm.data.SupplyType == 4\">甲指乙供</p></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"height: 80px;\"><md-checkbox aria-label=\"Disabled checkbox\" ng-model=\"vm.confirm\"></md-checkbox><p>本人确认本批进场材料与上述材料计划信息相符</p></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"height: 80px;\"><md-button flex=\"50\" class=\"md-raised md-primary\" ng-disabled=\"vm.btnEnable\" ui-sref=\"app.xhsc.materialys.intoFactory({status:1,BatchId:vm.data.Id,PlanId:vm.data.PlanId,PlanCount:vm.data.PlanCount,Brand:vm.data.Brands})\">分批进场</md-button><md-button flex=\"50\" class=\"md-raised md-primary\" ng-disabled=\"!vm.confirm\" ui-sref=\"app.xhsc.materialys.intoFactory({status:0,BatchId:vm.data.Id,PlanId:vm.data.PlanId,PlanCount:vm.data.PlanCount,Brand:vm.data.Brands})\">一次性进场</md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider></md-list></md-content>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-inspection.html","<form name=\"projectForm\"><md-content flex=\"\"><md-list><md-list-item><label flex=\"40\">送检时间</label><p flex=\"60\" style=\"text-align: right;\">{{vm.outPutDate | date:\'yyyy年MM月dd日\'}}</p></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"40\">送检人</label><md-input-container flex=\"60\" style=\"margin:0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.Inspectioner\" style=\"top: 10px;position: relative; text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"40\">送检单号</label><md-input-container flex=\"60\" style=\"margin:0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.CheckList\" style=\"top: 10px;position: relative; text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-subheader class=\"md-no-sticky\" style=\"font-size: 1.1em;background-color: #F2F2F2;\">送检照片</md-subheader><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">抽样过程</label><div flex=\"60\" ng-repeat=\"img in vm.samplingProcessImgs\" sxt-images=\"vm.samplingProcessImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(16)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">检查单</label><div flex=\"60\" ng-repeat=\"img in vm.checkListImgs\" sxt-images=\"vm.checkListImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(32)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider></md-list></md-content></form>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-intoFactory.html","<md-content><md-list ng-cloak=\"\"><md-list-item><label flex=\"50\">进场时间</label><p flex=\"50\" style=\"text-align: right;\">{{vm.outPutDate | date:\'yyyy年MM月dd日\'}}</p></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"50\">进场数量</label><md-input-container flex=\"\" style=\"margin:0;padding: 0;\"><input type=\"number\" ng-model=\"vm.data.ApproachCount\" style=\"top: 10px;position: relative; text-align: right;\" min=\"0\" required=\"\"></md-input-container><label style=\"text-align:right;\" flex=\"10\">{{vm.data.Unit}}</label></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"height: 54px;\"><label flex=\"50\">厂家/品牌</label><md-select name=\"type\" ng-model=\"vm.data.Brand\" flex=\"50\" style=\"top: 10px;text-align: right;\"><md-option ng-value=\"brand\" ng-repeat=\"brand in vm.Brands\">{{brand}}</md-option></md-select></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"50\">供货方</label><md-input-container flex=\"50\" style=\"margin:0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.Supplier\" style=\"top: 10px;position: relative; text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"50\">有无封样</label><div flex=\"50\"><label style=\"float: right; padding-right: 10px;\">{{vm.data.IsPacking?\'有\':\'无\'}}</label><md-switch class=\"md-secondary\" ng-model=\"vm.data.IsPacking\" required=\"\"></md-switch></div></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"50\">配合检查人</label><md-input-container flex=\"50\" style=\"margin:0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.Inspector\" style=\"top: 10px;position: relative; text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-subheader class=\"md-no-sticky\" style=\"font-size: 1.1em;background-color: #F2F2F2;\">检查照片</md-subheader><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">车辆</label><div flex=\"60\" ng-repeat=\"img in vm.vehicleImgs\" sxt-images=\"vm.vehicleImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(256)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">货物</label><div flex=\"60\" ng-repeat=\"img in vm.goodsImgs\" sxt-images=\"vm.goodsImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(512)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">配合检查人</label><div flex=\"60\" ng-repeat=\"img in vm.rummagerImgs\" sxt-images=\"vm.rummagerImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(1024)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><label flex=\"30\" style=\"display: block; word-break:keep-all;white-space:nowrap;padding-right: 5px;\">合格证</label><div flex=\"60\" ng-repeat=\"img in vm.CertificateImgs\" sxt-images=\"vm.CertificateImgs\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"10\" class=\"md-secondary\" ng-click=\"vm.addPhoto(2048)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider></md-list></md-content>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-list.html","<div ng-cloak=\"\"><md-content><md-tabs md-dynamic-height=\"\" md-border-bottom=\"\"><md-tab label=\"全部\" ng-if=\"vm.status == 46\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 1\">未进</md-button><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 2\">未验</md-button><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 4\">未检</md-button><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 8\">未档</md-button><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 16\">未批</md-button><md-button ng-disabled=\"true\" class=\"md-fab md-mini\" ng-if=\"item.Status == 32\">未退</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button ng-if=\"item.Status == 1\" ui-sref=\"app.xhsc.materialys.planDetail({batchId:item.Id})\" style=\"color: black;margin-right: 0px\">进场</md-button><md-button ng-if=\"item.Status == 2\" ui-sref=\"app.xhsc.materialys.checkInfo({id:item.Id})\" style=\"color: black;margin-right: 0px\">验收</md-button><md-button ng-if=\"item.Status == 4\" ui-sref=\"app.xhsc.materialys.inspection({id:item.Id})\" style=\"color: black;margin-right: 0px\">送检</md-button><md-button ng-if=\"item.Status == 8\" ui-sref=\"app.xhsc.materialys.inspectionReport({id:item.Id})\" style=\"color: black;margin-right: 0px\">归档</md-button><md-button ng-if=\"item.Status == 16\" style=\"color: black;margin-right: 0px\" ui-sref=\"app.xhsc.materialys.approval({planId:item.PlanId,id:item.Id})\">批示</md-button><md-button ng-if=\"item.Status == 32\" style=\"color: black;margin-right: 0px\" ui-sref=\"app.xhsc.materialys.unqualifiedExit({id:item.Id,unit:item.Unit})\">退场</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-tab><md-tab label=\"未进场\" ng-if=\"vm.status == 1\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:1}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未进</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button ng-if=\"item.Status == 1\" ui-sref=\"app.xhsc.materialys.planDetail({batchId:item.Id})\" style=\"color: black;margin-right: 0px\">进场</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-tab><md-tab label=\"未验收\" ng-if=\"vm.status == 46\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:2}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未验</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button style=\"color: black;margin-right: 0px\" ui-sref=\"app.xhsc.materialys.checkInfo({id:item.Id})\">验收</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-tab><md-tab label=\"未送检\" ng-if=\"vm.status == 46\"><md-content class=\"md-padding\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:4}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未检</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button ng-if=\"item.Status == 4\" ui-sref=\"app.xhsc.materialys.inspection({id:item.Id})\" style=\"color: black;margin-right: 0px\">送检</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-content></md-tab><md-tab label=\"未归档\" ng-if=\"vm.status == 46\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:8}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未归</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button style=\"color: black;margin-right: 0px\" ui-sref=\"app.xhsc.materialys.inspectionReport({id:item.Id})\">归档</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-tab><md-tab label=\"未批示\" ng-if=\"vm.status == 16\"><md-content class=\"md-padding\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:16}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未批</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button style=\"color: black;margin-right: 0px\" ui-sref=\"app.xhsc.materialys.approval({planId:item.PlanId,id:item.Id})\">批示</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-content></md-tab><md-tab label=\"未退场\" ng-if=\"vm.status == 46\"><md-content class=\"md-padding\"><md-list flex=\"\"><md-list-item ng-repeat=\"item in vm.planList | filter:{Status:32}:true\" class=\"md-long-text\" ui-sref=\"app.xhsc.materialys.materialPlanProgress({id:item.Id})\"><md-button ng-disabled=\"true\" class=\"md-fab md-mini\">未退</md-button><div flex=\"\" class=\"md-3-line md-list-item-text\"><p>{{item.PlanName}}</p></div><md-button style=\"color: black;margin-right: 0px\" ng-if=\"item.Status == 32\" ui-sref=\"app.xhsc.materialys.unqualifiedExit({id:item.Id,unit:item.Unit})\">退场</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-content></md-tab></md-tabs></md-content></div>");
$templateCache.put("app/main/materialYs/component/materialPlanYs-progress.html","<div class=\"track-rcol\"><div class=\"track-list\"><ul><li ng-hide=\"vm.data.ExitOperatorTime==null\" aria-label=\"材料退场\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.ExitOperatorTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>{{vm.data.ExitReason}}</label>{{vm.data.ExitOperatorName}}</span></li><li ng-hide=\"vm.data.ApprovalTime==null\" aria-label=\"甲方经理批示\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.ApprovalTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>甲方经理批示</label>{{vm.data.PartyA}}</span></li><li ng-hide=\"vm.data.ReportTime==null\" aria-label=\"送检报告归档\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.ReportTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>送检报告归档</label>{{vm.data.InspectionReporterName}}</span></li><li ng-hide=\"vm.data.InspectionTime==null\" aria-label=\"监理送检\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.InspectionTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>监理送检</label>{{vm.data.Inspectioner}}</span></li><li ng-hide=\"vm.data.AcceptanceTime==null\" aria-label=\"监理验收\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.AcceptanceTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>监理验收</label>{{vm.data.Accepter}}</span></li><li ng-hide=\"vm.data.ApproachTime==null\" aria-label=\"材料进场\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.ApproachTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>材料进场</label>{{vm.data.Inspector}}</span></li><li aria-label=\"创建计划\"><i class=\"node-icon icon-album\"></i> <span class=\"time\">{{vm.data.PlanCreateTime | date:\'yyyy-MM-dd HH:mm\'}}</span> <span class=\"txt\"><label>创建计划</label>{{vm.data.PlanCreatorName}}</span></li></ul></div></div>");
$templateCache.put("app/main/materialYs/component/materialYs-UnqualifiedExit.html","<form name=\"projectForm\"><md-content flex=\"\"><md-list ng-cloak=\"\"><md-list-item style=\"height: 48px;\"><label flex=\"40\">退场原因</label><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.ExitReason\" ng-disabled=\"true\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item><label flex=\"40\">退场数量</label><md-input-container flex=\"\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input type=\"number\" required=\"\" ng-model=\"vm.data.ExitCount\" min=\"0\" style=\"padding: 0;margin-top: 10px;text-align: right;\"></md-input-container><label style=\"text-align:right;\" flex=\"10\">{{vm.data.Unit}}</label></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"height: 48px;\"><label flex=\"40\">退场见证人</label><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input ng-model=\"vm.data.ExitWitness\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-subheader class=\"md-no-sticky\" style=\"font-size: 1.1em;background-color: #F2F2F2;\">退场照片</md-subheader><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right:0;\"><div flex=\"70\" ng-repeat=\"img in vm.data.MaterialFiles\" sxt-images=\"vm.data.MaterialPlanFiles\" style=\"text-align: center;margin:5px 0;\"><img ng-src=\"{{img.ImageByte}}\" flex=\"95\" class=\"uploadPhoto\"></div><md-button flex=\"30\" class=\"md-secondary\" ng-click=\"vm.addPhoto(128)\" style=\"padding-right: 0;\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider class=\"md-no-sticky\"></md-divider></md-list></md-content></form>");
$templateCache.put("app/main/materialYs/component/materialYs-exit.html","<form name=\"projectForm\"><md-list ng-cloak=\"\"><md-list-item style=\"height: 48px;\"><label flex=\"40\">退场原因</label><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input type=\"text\" ng-model=\"vm.data.ExitReason\" ng-disabled=\"true\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider></md-divider><md-list-item><p flex=\"40\">退场数量</p><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input type=\"number\" ng-model=\"vm.data.ExitCount\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider></md-divider><md-list-item style=\"height: 48px;\"><p flex=\"40\">退场见证人</p><md-input-container flex=\"60\" class=\"md-block\" style=\"height: 48px; margin: 0;padding: 0;\"><input ng-model=\"vm.data.ExitWitness\" style=\"padding: 0;margin-top: 10px;text-align: right;\" required=\"\"></md-input-container></md-list-item><md-divider class=\"md-no-sticky\"></md-divider><md-subheader class=\"md-no-sticky\" style=\"font-size: 1.1em;background-color: #F2F2F2;\">退场照片</md-subheader><md-divider class=\"md-no-sticky\"></md-divider><md-list-item style=\"padding-right: 0;\"><div flex=\"60\" ng-repeat=\"img in vm.exitImgs\" sxt-images=\"vm.exitImgs\" style=\"text-align: center;margin: 5px 0;\"><img ng-src=\"{{img.ImageByte}}\" class=\"uploadPhoto\" flex=\"95\" style=\"display: block;\"></div><md-button class=\"md-secondary\" ng-click=\"vm.addPhoto(128)\"><md-icon md-font-icon=\"icon-camera\" class=\"icon s40\"></md-icon></md-button></md-list-item><md-divider></md-divider></md-list></form>");
$templateCache.put("app/main/materialYs/component/materialys-download.html","<div flex=\"\" ng-if=\"vm.material\" layout=\"column\" class=\"download\"><div style=\"background-color: #F5F5F5;\" layout=\"row\" ng-if=\"vm.offlines.length\"><span style=\"display: inline-block; font-size: 12px; color: #757575; padding: 16px 32px;\" flex=\"80\">已下载列表</span><md-button ng-click=\"vm.upload()\" style=\"color: black;margin-right: 0;font-size: 14px;\" flex=\"20\" ng-if=\"vm.userType != \'xmjl\'\">上传</md-button></div><span class=\"border1px\" ng-if=\"vm.offlines.length\"></span><md-list style=\"overflow-x: hidden; padding: 0;\"><md-list-item layout=\"row\" ng-repeat=\"item in vm.offlines\" ui-sref=\"app.xhsc.materialys.planList({id:item.SectionID,title:item.FullName})\"><p style=\"font-size:14px; padding-left: 3%\"><span>{{item.FullName}}</span></p><span flex=\"\"></span><md-button ng-click=\"vm.Refresh(item,$event)\" style=\"min-width: 40px;width: 40px;padding: 6px 0px;\" ng-if=\"vm.userType != \'xmjl\'\">刷新</md-button></md-list-item></md-list><md-subheader ng-if=\"vm.section.length\">未下载列表</md-subheader><span class=\"border1px\" ng-if=\"vm.section.length\"></span><md-list style=\"overflow-x: hidden; padding: 0;\"><md-list-item layout=\"row\" ng-repeat=\"item in vm.section\"><p style=\"font-size:14px; padding-left: 5%\"><span>{{item.FullName}}</span></p><span flex=\"\"></span><md-button ng-click=\"vm.downloadPlan(item,null,$event)\" style=\"margin: 6px 0px\"><i class=\"icon icon-download s30\"></i></md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div>");
$templateCache.put("app/main/pcReport/cycle/cycle_default.html","<ui-view></ui-view><div ng-if=\"display\" style=\"position: relative\" flex=\"\"><table class=\"table table-hover table-bordered sa\"><thead><tr><th>序号</th><th>项目</th><th style=\"min-width: 150px\">描述</th><th>时间</th><th>状态</th><th>操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.AreaFullName}}</td><td>{{item.Describe}}</td><td>{{item.CreateTime}}</td><td>{{item.StatusName}}</td><td><md-button class=\"md-primary\" ng-click=\"vm.go(item)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table><div layout=\"row\" layout-align=\"end start\" style=\"min-width: 542px\"><md-select ng-model=\"vm.selectSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageIndex\" page-size=\"PageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></div>");
$templateCache.put("app/main/pcReport/cycle/cycle_detail.html","<table class=\"table table-bordered tableWrap\"><th colspan=\"8\">{{vm.source.ExtendDescribe}}</th><tr><td>项目名称</td><td colspan=\"7\">{{vm.source.ProjectName}}</td></tr><tr class=\"min80\"><td style=\"min-width: 98px\">施工单位</td><td>{{vm.source.rectifysItem.CompanyName}}</td><td>项目经理</td><td>{{vm.source.rectifysItem.HeadName}}</td><td>整改人</td><td>{{vm.source.rectifysItem.NickName}}</td><td>整改时间</td><td>{{vm.source.rectifysItem.Time}}</td></tr><tr class=\"min80\"><td style=\"min-width: 98px\" rowspan=\"2\">监理单位</td><td rowspan=\"2\">{{vm.source.supervisionsItem.CompanyName}}</td><td rowspan=\"2\">项目总监</td><td rowspan=\"2\">{{vm.source.supervisionsItem.HeadName}}</td><td>检查人</td><td>{{vm.source.supervisionsItem.NickName}}</td><td>检查时间</td><td>{{vm.source.supervisionsItem.Time}}</td></tr><tr class=\"min80\"><td>复查人</td><td>{{vm.source.reviewsItem.NickName}}</td><td>复查时间</td><td>{{vm.source.reviewsItem.Time}}</td></tr><tr class=\"min80\"><td>建设单位</td><td>{{vm.source.companysItem.CompanyName}}</td><td>项目经理</td><td colspan=\"5\">{{vm.source.companysItem.HeadName}}</td></tr><tr><td>检查状态</td><td colspan=\"7\">{{vm.source.StatusName}}</td></tr><tr ng-repeat=\"item in vm.source.AreaList\"><td colspan=\"8\" style=\"padding: 8px 0px;border: 0px solid\"><table class=\"table table-bordered\"><tr><td colspan=\"8\">{{item.AreaFullName}}</td></tr><tr ng-if=\"item.QualifiedPicList.length\"><td colspan=\'8\"\'><div class=\"imgWrap\"><img ng-repeat=\"k in item.QualifiedPicList\" ng-src=\"{{k.Url}}\"></div></td></tr><tr><td colspan=\"8\">原位标注 <span ng-if=\"item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 5px\">展开</span> <span ng-if=\"!item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 12px\">关闭</span></td></tr><tr><td colspan=\"8\" style=\"padding: 5px\" ng-if=\"!item.up\"><div class=\"ywWrap\" sxt-report-view=\"\" loaded=\"vm.loaded\" ponits=\"item.PointList\" region-id=\"item.AreaID\" type=\"\'week\'\" layout=\"column\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"!vm.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div></td></tr><tr ng-repeat=\"k in item.RectificationPic\"><td colspan=\"8\"><table class=\"table table-hover table-bordered\"><tr><td colspan=\"8\">{{k.ProblemSortName+\'.\'+k.ProblemDescription}}</td></tr><tr><td>验收照片</td><td>整改照片</td></tr><tr><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Front\" ng-src=\"{{m.Url}}\" ng-click=\"vm.showImg(m)\"></div></td><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Back\" ng-src=\"{{ m.Url}}\" ng-click=\"vm.showImg(m)\"></div></td></tr></table></td></tr></table></td></tr></table>");
$templateCache.put("app/main/pcReport/cycle/cycle_filter.html","<md-toolbar ng-if=\"!vm.isMobile\" class=\"md-hue-1\"><div class=\"md-toolbar-tools\"><h4><span>日常巡检</span></h4></div></md-toolbar><div ng-if=\"vm.isiPad||!vm.isMobile\"><md-card style=\"background-color: white\" md-theme-watch=\"\"><md-card-content><form name=\"myForm\" flex=\"\" layout=\"column\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div></form></md-card-content></md-card></div><div ng-if=\"vm.isMobile&&!vm.isiPad&&vm.display\" style=\"position: relative\"><section style=\"padding: 18px 18px\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\" layout-xs=\"column\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div><div layout=\"row\"><md-button type=\"submit\" tyle=\"margin: 24px 0px\" class=\"md-raised md-primary\" flex=\"\" ng-click=\"ok()\">确定</md-button></div></section></div>");
$templateCache.put("app/main/pcReport/directive/sxt-select.html","<div layout=\"row\" flex=\"\" class=\"sxt-select\"><div ng-show=\"selectors.length && selectors[0].selected\"><md-button style=\"min-height: 24px;height: 24px;line-height:24px;padding: 0px 3px;margin: 0;\" ng-repeat=\"st in selectors\" ng-click=\"item_clear(st.index)\" ng-if=\"st.selected\" title=\"{{st.selected.$name}}\"><b style=\"color: #428bca;font-weight: 400;\" class=\"ng-binding\">{{st.label}}：</b><em style=\"font-style: normal;font-weight: 400;color: #e4393c;\">{{st.selected.$name}}</em><md-icon md-font-icon=\"icon-close s16\"></md-icon></md-button><span style=\"display: inline-block;width: 12px\"></span><md-button class=\"md-raised\" ng-click=\"item_clear(0)\" style=\"min-height: 24px;height: 24px;line-height:24px;min-width: 86px;padding: 0px;margin: 0px;\"><em style=\"font-style: normal;font-weight: 400;color:grey\">全部撤消</em></md-button><md-button class=\"md-raised\" ng-click=\"item_back(1)\" style=\"min-height: 24px;height: 24px;line-height:24px;min-width: 86px;padding: 0px;margin: 0px;\"><em style=\"font-style: normal;font-weight: 400;color:grey\">返回上一步</em></md-button></div></div><div id=\"J_searchWrap\" style=\"margin-top:10px;\"><div id=\"J_container\"><div id=\"J_selector\" class=\"selector\"><div ng-repeat=\"st in selectors\" data-title=\"{{st.label}}\" ng-if=\"st.items.length\" class=\"J_selectorLine s-brand\" ng-show=\"isShow(st)\"><div class=\"sl-wrap\" ng-class=\"{\'extend\':st.extend}\" layout=\"row\"><div class=\"sl-key\" flex=\"none\"><span>{{st.label}}：</span></div><div class=\"sl-value\" flex=\"\"><ul class=\"sl-b-letter J_brandLetter\" style=\"padding-left:0;margin: 0px\"><li style=\"border:1px solid #dedede;padding-right:10px;height: 24px\"><input type=\"text\" ng-model=\"st.key\" placeholder=\"输入拼音首字母搜索\" ng-change=\"st.keyChanged()\" style=\"height:22px;border:none;border-right:1px solid #dedede;line-height:28px;display:inline-block;vertical-align:top;width:140px;padding-left:2px\"><md-icon ng-click=\"st.key=\'\';st.keyChanged()\" style=\"margin-left:8px;margin-top:-2px;\" md-font-icon=\"icon-close s16\"></md-icon></li></ul><div class=\"clr\" style=\"clear:both;\"></div><div class=\"sl-v-list\"><div class=\"J-valueList v-fixed\" style=\"overflow: hidden\"><md-list style=\"padding:0;\"><md-list-item ng-repeat=\"item in st.filters | orderBy:\'RegionID\'\" data-initial=\"t\" style=\"float: left;height: 32px;min-height: 32px;width: 160px;text-align: left\"><md-button style=\"height: 24px;min-height: 24px;padding: 0px 3px;\" ng-click=\"item_selected(item, st.index)\" title=\"{{item.$name}}\"><i></i><span style=\"font-size: 10px;color: #005aa0;position: relative;bottom: 5px\">{{item.$name}}</span></md-button></md-list-item></md-list></div></div></div><div class=\"sl-ext\" ng-style=\"{top:st.extend?\'40px\':\'\'}\"><a href=\"javascript:;\" style=\"visibility: visible;\" ng-click=\"st.index<2?st.filter({$id:\'\'},(st.fff=!!!st.fff)):st.toggleExtend()\" class=\"sl-e-more J_extMore\">更多<i></i></a></div></div></div><div ng-transclude=\"\"></div></div></div><span class=\"clr\"></span><div id=\"Collect_Tip\" class=\"Tip360 w260\"></div></div>");
$templateCache.put("app/main/pcReport/htmlTemplate/actiongxOrsc.html","<md-dialog aria-label=\"1\" ng-cloak=\"\" style=\"background:transparent;box-shadow: none;max-width:100%;width:100%;\" class=\"e-dialog\"><md-list layout=\"row\" layout-align=\"space-around center\"><md-list-item layout=\"row\"><md-button ng-click=\"goSC()\"><img class=\"imgRep\" ng-src=\"app/main/xhsc/images/scsl.png\"></md-button></md-list-item><md-list-item layout=\"row\"><md-button ng-click=\"goGX()\"><img class=\"imgRep\" ng-src=\"app/main/xhsc/images/gxys.png\"></md-button></md-list-item></md-list></md-dialog>");
$templateCache.put("app/main/pcReport/pgReport/pchz.html","<md-tabs md-align-tabs=\"bottom\" style=\"min-width: 625px\" flex=\"\" md-selected=\"vm.selectedIndex\" class=\"zlpkwrap\"><md-tab label=\"{{b.AssessmentClassificationName}}\" ng-repeat=\"b in vm.items.AssessmentClassifys\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div flex=\"none\" layout=\"row\" style=\"border-right:0\" class=\"zlpkheader\"><div flex=\"\" layout=\"row\"><div flex=\"10\">检测内容</div><div flex=\"35\" style=\"border-left: 1px solid #d8d8d8;\">评判标准</div><div flex=\"55\" layout=\"row\"><div flex=\"\" style=\"border-left: 1px solid #d8d8d8;\">{{vm.isAddScore?\'加\':\'扣\'}}分标准</div><div style=\"width: 70px;border-left: 1px solid #d8d8d8;\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">评估对象</div><div flex=\"none\" style=\"width:50px; border-left: 1px solid #d8d8d8;border-right:1px solid #d8d8d8;text-align: center;\">权重</div><div flex=\"none\" ng-repeat=\"x in vm.sections\" layout=\"column\" class=\"bd\"><div flex=\"none\" layout=\"row\"><div flex=\"none\" class=\"bdtop\">{{x.SectionName}}</div></div><div flex=\"none\" layout=\"row\"><div flex=\"none\" style=\"width:50px;text-align: center;height:23px;line-height: 23px;\">{{vm.isAddScore?\'加\':\'扣\'}}分</div><div flex=\"none\" style=\"width:50px; border-left: 1px solid #d8d8d8;text-align: center;height:23px;line-height: 23px;\">得分</div></div></div></div></div><div flex=\"none\" fix-scrollbar-width=\"md-content.zlpksub\"></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\"><md-content flex=\"\" class=\"zlpksub\"><section class=\"zlpklist\" ng-if=\"c.show\" ng-repeat=\"c in b.AssessmentClassifys\"><md-subheader><div layout=\"row\" class=\"zlpksubheader\"><span>{{c.AssessmentClassificationName}}</span></div></md-subheader><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"zlpktables\"><tr ng-if=\"e.show\" ng-repeat=\"e in c.AssessmentClassifys\"><td style=\"width:{{vm.getW(1,2)}}%;\"><p>{{e.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-if=\"f.show\" ng-repeat=\"f in e.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(2,b.level)}}%;\"><p>{{f.AssessmentClassificationName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 70px\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">扣分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width:10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr><tr ng-if=\"item.show\" ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:5.26%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width:70px;text-align: center\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.isAddScore?\'加\':\'扣\'}}分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width: 10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr></table></td></tr><tr ng-if=\"item.show\" ng-repeat=\"item in c.AssessmentItems\"><td style=\"width:10%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width:70px;text-align: center;\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px;\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.isAddScore?\'加\':\'扣\'}}分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width: 10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr></table></section></md-content></div></md-tab-content></md-tab><md-tab label=\"项目评分汇总表\" ng-if=\"vm.inited\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"><div flex=\"none\" layout=\"row\" style=\"text-align: center;font-size:20px;border-right:0;padding: 0 8px;\"><div flex=\"\"><div style=\"text-align: center;width:100%;\">{{vm.params.year}} 年第 {{vm.params.quarter}}季度{{vm.toTalReport.projectName}}得分汇总表</div><table class=\"reportWrap\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><thead><tr><th style=\"text-align: center;font-size: 16px;font-family: \'Roboto\'\">检查评估项</th><th style=\"text-align: center;width:120px;font-size: 16px;font-family: \'Roboto\'\" ng-repeat=\"k in vm.toTalReport.Sections\">{{k.SectionName}}</th><th style=\"text-align: center;width:120px;font-size: 16px;font-family: \'Roboto\'\">备注</th></tr></thead></table></div><div flex=\"none\" fix-scrollbar-width=\"md-content.zlpksub\"></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\" style=\"padding: 0 8px;\"><md-content flex=\"\" class=\"zlpksub\"><table class=\"reportWrap\" width=\"99.9%\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td rowspan=\"2\" class=\"td_left\" style=\"padding-left: 10px;\">项目部得分</td><td colspan=\"{{vm.prjScores.length}}\"><span ng-if=\"vm.prjScores.avg\">{{vm.prjScores.avg*100|number:2}} %</span></td><td class=\"td_left\" style=\"width:120px\"></td></tr><tr><td style=\"width:120px\" ng-repeat=\"k in vm.prjScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td rowspan=\"2\" class=\"td_left\" style=\"padding-left: 10px;\">监理得分</td><td colspan=\"{{vm.jlScores.length}}\"><span ng-if=\"vm.jlScores.avg\">{{vm.jlScores.avg*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td ng-repeat=\"k in vm.jlScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td class=\"td_left\" style=\"padding-left: 10px;\">总包得分</td><td ng-repeat=\"k in vm.zbScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr></tbody><tbody><tr ng-repeat=\"k in vm.toTalReport.AssessmentTypes\"><td colspan=\"5\"><table class=\"report\" style=\"width: 100%\"><tr><td style=\"text-align: left;padding-left: 10px;\" colspan=\"{{k.CategorySections && k.CategorySections.length?1:vm.toTalReport.Sections.length+1}}\"><h3>{{k.AssessmentTypeName}}</h3></td><td style=\"width:120px;\" ng-repeat=\"n in k.CategorySections\">{{n.ScroePercent * 100|number:2}} {{n.ScroePercent||n.ScroePercent===0?\'%\':\'\'}}</td><td style=\"width:120px;\"></td></tr><tr ng-repeat=\"m in k.AssessmentCategorys\"><td class=\"td_left\" style=\"padding-left: 10px;\">{{m.AssessmentClassificationName}}</td><td style=\"width:120px;\" ng-repeat=\"n in m.sectionScore\">{{n.ScroePercent * 100|number:2}} {{n.ScroePercent||n.ScroePercent===0?\'%\':\'\'}}</td><td style=\"width:120px;\"></td></tr></table></td></tr></tbody></table></md-content></div></md-tab-content></md-tab></md-tabs><div flex=\"none\" style=\"position: absolute;top:45%;left:45%;\"><md-progress-circular class=\"md-accent md-hue-1\" md-diameter=\"28\" md-mode=\"indeterminate\" ng-show=\"vm.loading\"></md-progress-circular></div>");
$templateCache.put("app/main/pcReport/pgReport/pgDefault.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-show=\"vm.show\" style=\"position: absolute;right: 8px\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.goBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div><md-tabs ng-show=\"vm.show\" flex=\"\" layout=\"column\"><md-tab flex=\"\" layout=\"column\" label=\"现场评估\"><md-tab-content ms-scroll=\"\" class=\"download\" style=\"padding: 0px\"><table class=\"summaryReport\"><thead><tr><th>序号</th><th style=\"width: 30%\">项目</th><th style=\"min-width:80px;width: 80px\">年份</th><th style=\"min-width:80px;width: 80px\">季度</th><th style=\"width: 30%\">评估阶段</th><th>操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td style=\"text-align: left;padding-left: 15px;min-width: 120px\">{{item.ProjectName}}</td><td>{{item.Year}}</td><td>{{item.Quarter}}</td><td>{{item.AssessmentStageName}}</td><td layout=\"column\"><md-button style=\"text-align: left\" flex=\"\" ng-click=\"vm.gohz(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>评估汇总</md-button><md-button flex=\"\" style=\"text-align: left\" ng-click=\"vm.gosc(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>实测实量</md-button></td></tr></tbody></table><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/pcReport/pgReport/pgReportFilter.html","<md-toolbar ng-if=\"!vm.isMobile\" class=\"md-hue-1\"><div class=\"md-toolbar-tools\"><h4><span>现场评估</span></h4></div></md-toolbar><div ng-if=\"vm.isiPad||!vm.isMobile\"><md-card style=\"background-color: white\" md-theme-watch=\"\"><md-card-content><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>年份</label><md-select ng-model=\"year\" name=\"type\"><md-option ng-click=\"vm.ck(item)\" ng-repeat=\"item in vm.yearSource\" ng-value=\"item\">{{item}}</md-option></md-select></md-input-container></div><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>季度</label><md-select ng-model=\"quart\" name=\"type\"><md-option ng-click=\"vm.ck_quart(item)\" ng-repeat=\"item in vm.yearQuart\" ng-value=\"item.id\">{{item.text}}</md-option></md-select></md-input-container></div></md-card-content></md-card><div flex=\"\" style=\"margin: 24px 16px\"><table class=\"table table-hover\"><thead><tr><th style=\"text-align: center;width: 60px;\">序号</th><th style=\"width: 30%;text-align: center\">项目</th><th style=\"min-width:80px;width: 80px;text-align: center\">年份</th><th style=\"min-width:80px;width: 80px;text-align: center\">季度</th><th style=\"width: 30%;text-align: center\">评估阶段</th><th style=\"text-align: center\">操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td style=\"text-align: center;vertical-align: middle\">{{$index+1}}</td><td style=\"text-align: left;padding-left: 36px;min-width: 120px;vertical-align: middle\">{{item.ProjectName}}</td><td style=\"text-align: center;vertical-align: middle\">{{item.Year}}</td><td style=\"text-align: center;vertical-align: middle\">{{item.Quarter}}</td><td style=\"text-align: center;vertical-align: middle\">{{item.AssessmentStageName}}</td><td style=\"text-align: center;vertical-align: middle\"><md-button style=\"text-align: left\" flex=\"\" ng-click=\"vm.gohz(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>评估汇总</md-button><md-button flex=\"\" style=\"text-align: left\" ng-click=\"vm.gosc(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>实测实量</md-button></td></tr></tbody></table><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></div></div><div ng-if=\"vm.isMobile&&!vm.isiPad\" style=\"position: relative\"><section style=\"padding: 18px 18px\"><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>年份</label><md-select ng-model=\"year\" name=\"type\"><md-option ng-click=\"vm.ck(item)\" ng-repeat=\"item in vm.yearSource\" ng-value=\"item\">{{item}}</md-option></md-select></md-input-container></div><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>季度</label><md-select ng-model=\"quart\" name=\"type\"><md-option ng-click=\"vm.ck_quart(item)\" ng-repeat=\"item in vm.yearQuart\" ng-value=\"item.id\">{{item.text}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-button style=\"margin: 24px 0px\" class=\"md-raised md-primary\" flex=\"\" ng-click=\"vm.filter()\">确定</md-button></div></section></div>");
$templateCache.put("app/main/pcReport/pgReport/pg_class.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">公司名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">施工单位</th><th rowspan=\"2\" style=\"min-width: 80px;\">标段名称</th><th ng-repeat=\"item in vm.source.Heads\" colspan=\"4\">{{item.Name}}</th></tr><tr><th ng-repeat=\"item in vm.source.subTitle\" class=\"center w\">{{item.Value}}</th></tr><tr ng-repeat=\"item in vm.source.Body\"><td>{{$index+1}}</td><td>{{item.CompanyName}}</td><td>{{item.ProjectName}}</td><td>{{item.MainContractorName}}</td><td>{{item.SectionName}}</td><td ng-repeat=\"k in item.Children\">{{k.Value}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/pg_jl.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">公司名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">监理单位</th><th rowspan=\"2\" style=\"min-width: 80px;\">标段名称</th><th colspan=\"4\" style=\"min-width: 80px;\">监理综合评分</th></tr><tr><td>1季度</td><td>2季度</td><td>3季度</td><td>4季度</td></tr><tr ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.CompanyName}}</td><td>{{item.ProjectName}}</td><td>{{item.OuName}}</td><td>{{item.SectionName}}</td><td ng-repeat=\"sub in item.Items\">{{sub.Value}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/pg_rate.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">公司名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">总包单位</th><th rowspan=\"2\" style=\"min-width: 80px;\">标段名称</th><th ng-repeat=\"item in vm.source.Heads\" colspan=\"{{item.Sub.length}}\">{{item.Name}}</th></tr><tr><th ng-repeat=\"item in vm.source.subTitle\" class=\"center w\">{{item.Value}}</th></tr><tr ng-repeat=\"item in vm.source.Body\"><td>{{$index+1}}</td><td>{{item.CompanyName}}</td><td class=\"center w\">{{item.ProjectName}}</td><td class=\"center w\">{{item.MainContractorName}}</td><td class=\"center w\">{{item.SectionName}}</td><td ng-repeat=\"k in item.Children\">{{k.Value}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/pg_trial.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"3\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"3\" style=\"min-width: 80px;\">楼栋号</th><th rowspan=\"3\" style=\"min-width: 80px;\">总户数</th><th rowspan=\"3\" style=\"min-width: 80px;\">渗漏率</th><th colspan=\"6\" style=\"min-width: 80px;\">渗漏点数</th><th colspan=\"3\" style=\"min-width: 80px;\">淋水试验情况</th><th colspan=\"3\" style=\"min-width: 80px;\">蓄水试验情况</th></tr><tr><th rowspan=\"2\" class=\"center w\">合计</th><th rowspan=\"2\" class=\"center w\">外墙</th><th rowspan=\"2\" class=\"center w\">窗边</th><th rowspan=\"2\" class=\"center w\">屋面</th><th rowspan=\"2\" class=\"center w\">卫生间</th><th rowspan=\"2\" class=\"center w\">其他</th><th class=\"center w\">第一次</th><th class=\"center w\">第二次</th><th class=\"center w\">第三次</th><th class=\"center w\">第一次</th><th class=\"center w\">第二次</th><th class=\"center w\">第三次</th></tr><tr><th class=\"center w\">淋水时间</th><th class=\"center w\">淋水时间</th><th class=\"center w\">淋水时间</th><th class=\"center w\">蓄水时间</th><th class=\"center w\">蓄水时间</th><th class=\"center w\">蓄水时间</th></tr><tr ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.AreaName}}</td><td>{{item.DoorCount}}</td><td>{{item.LeakageRate}}</td><td>{{item.Count}}</td><td>{{item.WQ}}</td><td>{{item.CB}}</td><td>{{item.WM}}</td><td>{{item.WSJ}}</td><td>{{item.QT}}</td><td ng-repeat=\"lssj in item.LSSJ\">{{lssj.Time}}</td><td ng-repeat=\"sssj in item.XSSJ\">{{sssj.Time}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/pg_xmb.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">公司名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目负责人</th><th colspan=\"4\" style=\"min-width: 80px;\">项目部综合评分</th></tr><tr><td>1季度</td><td>2季度</td><td>3季度</td><td>4季度</td></tr><tr ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.CompanyName}}</td><td>{{item.ProjectName}}</td><td>{{item.HeadUser}}</td><td ng-repeat=\"sub in item.Items\">{{sub.Value}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/pg_zb.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">公司名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">项目名称</th><th rowspan=\"2\" style=\"min-width: 80px;\">总包单位</th><th rowspan=\"2\" style=\"min-width: 80px;\">标段名称</th><th colspan=\"4\" style=\"min-width: 80px;\">总包综合评分</th></tr><tr><td>1季度</td><td>2季度</td><td>3季度</td><td>4季度</td></tr><tr ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.CompanyName}}</td><td>{{item.ProjectName}}</td><td>{{item.OuName}}</td><td>{{item.SectionName}}</td><td ng-repeat=\"sub in item.Items\">{{sub.Value}}</td></tr></table>");
$templateCache.put("app/main/pcReport/pgReport/scRegion.html","<md-tabs flex=\"\" md-border-bottom=\"\"><md-tab ng-repeat=\"s in vm.sections.Sections\" label=\"{{s.SectionName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in s.MeasurItems\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.MeasureItemName}}</h2></div><md-list><div layout=\"row\" hide-xs=\"\" hide-sm=\"\" layout-wrap=\"\"><div flex=\"33\" ng-repeat=\"b in m.ExtractionRegions\"><md-button class=\"md-raised md-block\" style=\"display: block; text-align:left;\" ui-sref=\"app.xhsc.sctb({db:s.AssessmentID,regionId:b.RegionID,measureItemID:m.AcceptanceItemID,name:b.FullRegionName,pname:m.MeasureItemName})\">{{b.FullRegionName}}</md-button></div></div><div layout=\"column\" hide-gt-sm=\"\" layout-wrap=\"\"><div ng-repeat=\"b in m.ExtractionRegions\"><md-button class=\"md-raised md-block\" style=\"display: block; text-align:left;\" ui-sref=\"app.xhsc.sctb({db:s.AssessmentID,regionId:b.RegionID,measureItemID:m.AcceptanceItemID,name:b.FullRegionName,pname:m.MeasureItemName})\">{{b.FullRegionName}}</md-button></div></div></md-list></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/pcReport/safeys/safeys_default.html","<ui-view></ui-view><div ng-if=\"display\" style=\"position: relative\" flex=\"\"><table class=\"table table-hover table-bordered sa\"><thead><tr><th>序号</th><th style=\"min-width: 150px\">安全</th><th>部位</th><th>报验时间</th><th>状态</th><th>操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.AcceptanceItemName}}</td><td><span ng-repeat=\"children in item.AreaList\">{{children.AreaFullName}}<br></span></td><td>{{item.CreateTime}}</td><td>{{item.StatusName}}</td><td><md-button class=\"md-primary\" ng-click=\"vm.go(item)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table><div layout=\"row\" layout-align=\"end start\" style=\"min-width: 542px\"><md-select ng-model=\"vm.selectSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageIndex\" page-size=\"PageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></div>");
$templateCache.put("app/main/pcReport/safeys/safeys_detail.html","<table class=\"table table-bordered tableWrap\"><th colspan=\"8\">{{vm.source.ExtendDescribe}}</th><tr><td>项目名称</td><td colspan=\"3\">{{vm.source.ProjectName}}</td><td>验收部位</td><td colspan=\"3\"><span ng-repeat=\"item in vm.source.AreaList\">{{item.AreaFullName}}<br></span></td></tr><tr class=\"min80\"><td style=\"min-width: 98px\" rowspan=\"2\">施工单位</td><td rowspan=\"2\">{{vm.source.mainContractorsItem.CompanyName}}</td><td rowspan=\"2\">项目经理</td><td rowspan=\"2\">{{vm.source.mainContractorsItem.HeadName}}</td><td>报验人</td><td>{{vm.source.mainContractorsItem.NickName}}</td><td>报验时间</td><td>{{vm.source.mainContractorsItem.Time}}</td></tr><tr class=\"min80\"><td>整改人</td><td>{{vm.source.rectifysItem.NickName}}</td><td>整改时间</td><td>{{vm.source.rectifysItem.Time}}</td></tr><tr class=\"min80\"><td style=\"min-width: 98px\" rowspan=\"2\">监理单位</td><td rowspan=\"2\">{{vm.source.supervisionsItem.CompanyName}}</td><td rowspan=\"2\">项目总监</td><td rowspan=\"2\">{{vm.source.supervisionsItem.HeadName}}</td><td>验收人</td><td>{{vm.source.supervisionsItem.NickName}}</td><td>验收时间</td><td>{{vm.source.supervisionsItem.Time}}</td></tr><tr class=\"min80\"><td>复验人</td><td>{{vm.source.reviewsItem.NickName}}</td><td>复验时间</td><td>{{vm.source.reviewsItem.Time}}</td></tr><tr class=\"min80\"><td>建设单位</td><td>{{vm.source.companysItem.CompanyName}}</td><td>项目经理</td><td colspan=\"5\">{{vm.source.companysItem.HeadName}}</td></tr><tr><td>验收状态</td><td colspan=\"7\">{{vm.source.StatusName}}</td></tr><tr ng-repeat=\"item in vm.source.AreaList\"><td colspan=\"8\" style=\"padding: 8px 0px;border: 0px solid\"><table class=\"table table-bordered\"><tr><td colspan=\"8\">{{item.AreaFullName}}</td></tr><tr ng-if=\"item.QualifiedPicList.length\"><td colspan=\"8\"><div class=\"imgWrap\"><img ng-repeat=\"k in item.QualifiedPicList\" ng-src=\"{{k.Url}}\"></div></td></tr><tr><td colspan=\"8\">原位标注 <span ng-if=\"item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 5px\">展开</span> <span ng-if=\"!item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 12px\">关闭</span></td></tr><tr><td colspan=\"8\" style=\"padding: 5px\" ng-show=\"!item.up\"><div class=\"ywWrap\" sxt-report-view=\"\" loaded=\"vm.loaded\" ponits=\"item.PointList\" region-id=\"item.AreaID\" type=\"\'week\'\" layout=\"column\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"!vm.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div></td></tr><tr ng-repeat=\"k in item.RectificationPic\"><td colspan=\"8\"><table class=\"table table-hover table-bordered\"><tr><td colspan=\"8\">{{k.ProblemSortName+\'.\'+k.ProblemDescription}}</td></tr><tr><td>验收照片</td><td>整改照片</td></tr><tr><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Front\" ng-click=\"vm.showImg(m)\" ng-src=\"{{m.Url}}\"></div></td><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Back\" ng-click=\"vm.showImg(m)\" ng-src=\"{{ m.Url}}\"></div></td></tr></table></td></tr></table></td></tr></table>");
$templateCache.put("app/main/pcReport/safeys/safeys_filter.html","<md-toolbar ng-if=\"!vm.isMobile\" class=\"md-hue-1\"><div class=\"md-toolbar-tools\"><h4><span>周安全检查</span></h4></div></md-toolbar><div ng-if=\"vm.isiPad||!vm.isMobile\"><md-card style=\"background-color: white\" md-theme-watch=\"\"><md-card-content><form name=\"myForm\" flex=\"\" layout=\"column\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div></form></md-card-content></md-card></div><div ng-if=\"vm.isMobile&&!vm.isiPad&&vm.display\" style=\"position: relative\"><section style=\"padding: 18px 18px\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\" layout-xs=\"column\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div><div layout=\"row\"><md-button type=\"submit\" tyle=\"margin: 24px 0px\" class=\"md-raised md-primary\" flex=\"\" ng-click=\"ok()\">确定</md-button></div></section></div>");
$templateCache.put("app/main/pcReport/scReport/scslFilter.html","<md-toolbar ng-if=\"!vm.isMobile\" class=\"md-hue-1\"><div class=\"md-toolbar-tools\"><h4><span>实测实量</span></h4></div></md-toolbar><div ng-if=\"!vm.isMobile||vm.isiPad\"><md-card style=\"background-color: white\" md-theme-watch=\"\"><md-card-content><sxt-projects-jd ng-model=\"project.pid\" region-type=\"project.type\" region-name=\"project.typeName\" project-id=\"project.projectId\" project-name=\"project.projectName\" id-tree=\"project.idTree\" name-tree=\"project.nameTree\" on-queryed=\"project.onQueryed\" is-more=\"project.isMore\"></sxt-projects-jd><div layout=\"row\" flex=\"\" style=\"margin-top: -18px\"><md-input-container md-theme=\"default\" flex=\"\"><label>实测项</label><md-select ng-model=\"currentSC\" class=\"md-no-underline\" name=\"type\" style=\"border: 1px solid #ddd;height: 32px;border-radius: 5px;padding-left: 8px\"><md-option ng-repeat=\"item in vm.mes\" ng-value=\"item.AcceptanceItemID\">{{item.MeasureItemName}}</md-option></md-select></md-input-container></div></md-card-content></md-card><div flex=\"\" style=\"margin: 24px 16px\" id=\"divReport\"><table class=\"table table-hover sctable\" style=\"margin-top: 20px;\"><thead><tr><th style=\"width: 60px;text-align: center;border: 1px solid #ddd;\">序号</th><th style=\"text-align: center;border: 1px solid #ddd;\">区域</th><th style=\"width: 20%;text-align: center;border: 1px solid #ddd;\">实测项</th><th style=\"width:20%;text-align: center;border: 1px solid #ddd;\">时间</th><th style=\"min-width: 50px;text-align: center;border: 1px solid #ddd;\">操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td style=\"vertical-align: middle;border: 1px solid #ddd;\">{{$index+1}}</td><td style=\"text-align: left;padding-left: 15px;min-width: 120px;vertical-align: middle;border: 1px solid #ddd;\">{{item.AreaName}}</td><td style=\"text-align: left;min-width: 120px;padding-left: 15px;vertical-align: middle;border: 1px solid #ddd;\">{{item.MeasureItemName}}</td><td style=\"text-align: left;padding-left: 36px;min-width: 120px;vertical-align: middle;border: 1px solid #ddd;\">{{item.MeasureTime}}</td><td style=\"vertical-align: middle;border: 1px solid #ddd;\"><md-button style=\"text-align: left\" ng-if=\"vm.btnShow(item,\'_0\')\" class=\"md-primary\" ng-click=\"vm.go(item,0)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>总包</md-button><md-button style=\"text-align: left\" ng-if=\"vm.btnShow(item,\'_2\')\" class=\"md-primary\" ng-click=\"vm.go(item,2)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>监理</md-button><md-button style=\"text-align: left\" ng-if=\"vm.btnShow(item,\'_4\')\" class=\"md-primary\" ng-click=\"vm.go(item,4)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>项目部</md-button></td></tr></tbody></table><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></div></div><div flex=\"\" layout=\"column\" ng-if=\"vm.isMobile&&!vm.isiPad\"><section-filter flex=\"\" layout=\"column\" source=\"vm.source\" gx-selected=\"vm.gxSelected\" sec-selected=\"vm.secSelected\"></section-filter></div>");
$templateCache.put("app/main/pcReport/scReport/scslReport.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-show=\"vm.show\" style=\"position: absolute;right: 8px\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.goBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div><md-tabs ng-show=\"vm.show\" flex=\"\" layout=\"column\"><md-tab flex=\"\" layout=\"column\" label=\"实测实量\"><md-tab-content ms-scroll=\"\" class=\"download\" style=\"padding: 0px\"><table class=\"summaryReport\"><thead><tr><th>序号</th><th>区域</th><th style=\"min-width: 50px\">实测项</th><th style=\"width:20%\">时间</th><th style=\"min-width: 50px\">操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td style=\"text-align: left;padding-left: 15px;min-width: 120px\">{{item.AreaName}}</td><td style=\"text-align: left;min-width: 120px;padding-left: 15px;\">{{item.MeasureItemName}}</td><td style=\"text-align: left;padding-left: 15px;min-width: 120px\">{{item.MeasureTime}}</td><td><div layout=\"column\" layout-align=\"center center\"><md-button style=\"text-align: left\" class=\"md-primary\" ng-if=\"vm.btnShow(item,\'_0\')\" ng-click=\"vm.go(item,0)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>总包</md-button><md-button style=\"text-align: left\" class=\"md-primary\" ng-if=\"vm.btnShow(item,\'_2\')\" ng-click=\"vm.go(item,2)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>监理</md-button><md-button style=\"text-align: left\" class=\"md-primary\" ng-if=\"vm.btnShow(item,\'_4\')\" ng-click=\"vm.go(item,4)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>项目部</md-button></div></td></tr></tbody></table><div layout=\"row\" layout-align=\"end start\" style=\"min-width: 520px\"><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/pcReport/weekSafe/week_default.html","<ui-view></ui-view><div ng-if=\"display\" style=\"position: relative\" flex=\"\"><table class=\"table table-hover table-bordered sa\"><thead><tr><th>序号</th><th>项目</th><th style=\"min-width: 150px\">描述</th><th>检查时间</th><th>状态</th><th>操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td>{{item.AreaFullName}}</td><td>{{item.Describe}}</td><td>{{item.CreateTime}}</td><td>{{item.StatusName}}</td><td><md-button class=\"md-primary\" ng-click=\"vm.go(item)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table><div layout=\"row\" layout-align=\"end start\" style=\"min-width: 542px\"><md-select ng-model=\"vm.selectSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageIndex\" page-size=\"PageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></div>");
$templateCache.put("app/main/pcReport/weekSafe/week_detail.html","<table class=\"table table-bordered tableWrap\"><th colspan=\"8\">{{vm.source.ExtendDescribe}}</th><tr><td>项目名称</td><td colspan=\"7\">{{vm.source.ProjectName}}</td></tr><tr class=\"min80\"><td style=\"min-width: 98px\">施工单位</td><td>{{vm.source.rectifysItem.CompanyName}}</td><td>项目经理</td><td>{{vm.source.rectifysItem.HeadName}}</td><td>整改人</td><td>{{vm.source.rectifysItem.NickName}}</td><td>整改时间</td><td>{{vm.source.rectifysItem.Time}}</td></tr><tr class=\"min80\"><td style=\"min-width: 98px\" rowspan=\"2\">监理单位</td><td rowspan=\"2\">{{vm.source.supervisionsItem.CompanyName}}</td><td rowspan=\"2\">项目总监</td><td rowspan=\"2\">{{vm.source.supervisionsItem.HeadName}}</td><td>检查人</td><td>{{vm.source.supervisionsItem.NickName}}</td><td>检查时间</td><td>{{vm.source.supervisionsItem.Time}}</td></tr><tr class=\"min80\"><td>复查人</td><td>{{vm.source.reviewsItem.NickName}}</td><td>复查时间</td><td>{{vm.source.reviewsItem.Time}}</td></tr><tr class=\"min80\"><td>建设单位</td><td>{{vm.source.companysItem.CompanyName}}</td><td>项目经理</td><td colspan=\"5\">{{vm.source.companysItem.HeadName}}</td></tr><tr><td>检查状态</td><td colspan=\"7\">{{vm.source.StatusName}}</td></tr><tr ng-repeat=\"item in vm.source.AreaList\"><td colspan=\"8\" style=\"padding: 8px 0px;border: 0px solid\"><table class=\"table table-bordered\"><tr><td colspan=\"8\">{{item.AreaFullName}}</td></tr><tr ng-if=\"item.QualifiedPicList.length\"><td colspan=\'8\"\'><div class=\"imgWrap\"><img ng-repeat=\"k in item.QualifiedPicList\" ng-src=\"{{k.Url}}\"></div></td></tr><tr><td colspan=\"8\">原位标注 <span ng-if=\"item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 5px\">展开</span> <span ng-if=\"!item.up\" ng-click=\"vm.up(item)\" style=\"float: right;padding-right: 12px\">关闭</span></td></tr><tr><td colspan=\"8\" style=\"padding: 5px\" ng-if=\"!item.up\"><div class=\"ywWrap\" sxt-report-view=\"\" loaded=\"vm.loaded\" ponits=\"item.PointList\" region-id=\"item.AreaID\" type=\"\'week\'\" layout=\"column\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"!vm.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div></td></tr><tr ng-repeat=\"k in item.RectificationPic\"><td colspan=\"8\"><table class=\"table table-hover table-bordered\"><tr><td colspan=\"8\">{{k.ProblemSortName+\'.\'+k.ProblemDescription}}</td></tr><tr><td>验收照片</td><td>整改照片</td></tr><tr><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Front\" ng-src=\"{{m.Url}}\" ng-click=\"vm.showImg(m)\"></div></td><td style=\"width:50%\"><div class=\"zgWrap\"><img ng-repeat=\"m in k.Back\" ng-src=\"{{ m.Url}}\" ng-click=\"vm.showImg(m)\"></div></td></tr></table></td></tr></table></td></tr></table>");
$templateCache.put("app/main/pcReport/weekSafe/week_filter.html","<md-toolbar ng-if=\"!vm.isMobile\" class=\"md-hue-1\"><div class=\"md-toolbar-tools\"><h4><span>周安全检查</span></h4></div></md-toolbar><div ng-if=\"vm.isiPad||!vm.isMobile\"><md-card style=\"background-color: white\" md-theme-watch=\"\"><md-card-content><form name=\"myForm\" flex=\"\" layout=\"column\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div></form></md-card-content></md-card></div><div ng-if=\"vm.isMobile&&!vm.isiPad&&vm.display\" style=\"position: relative\"><section style=\"padding: 18px 18px\"><div layout=\"row\"><md-input-container flex=\"\"><label>项目</label><md-select ng-model=\"core.currentProject\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\"><md-input-container flex=\"\"><label>分期</label><md-select ng-model=\"core.currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in core.currentProject.Children\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\" layout-xs=\"column\"><md-input-container class=\"md-block\" flex=\"\"><label>起始时间</label><md-datepicker ng-model=\"core.minDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container><md-input-container flex=\"\"><label>结束时间</label><md-datepicker ng-model=\"core.maxDate\" class=\"picker\" layout=\"row\"></md-datepicker></md-input-container></div><div layout=\"row\"><md-button type=\"submit\" tyle=\"margin: 24px 0px\" class=\"md-raised md-primary\" flex=\"\" ng-click=\"ok()\">确定</md-button></div></section></div>");
$templateCache.put("app/main/pcReport/yf/yf_default.html","<table class=\"table table-hover table-bordered sa\"><thead><tr><th>序号</th><th>项目</th><th style=\"min-width: 150px\">描述</th><th>时间</th><th>操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index}}</td><td>{{item.AreaFullName}}</td><td>{{item.Describe}}</td><td>{{item.CreateTime}}</td><td><md-button class=\"md-primary\" ng-click=\"vm.go(item)\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table>");
$templateCache.put("app/main/pcReport/yf/yf_detail.html","<table class=\"table table-hover table-bordered\"><th colspan=\"6\">{{vm.source.ExtendDescribe}}</th><tr><td>项目名称：</td><td colspan=\"2\">{{vm.source.ProjectName}}</td><td>验收部位</td><td colspan=\"2\"></td></tr><tr><td>验收单位：</td><td>惠州长江</td><td>验收人</td><td>江建卫</td><td>验收时间</td><td>2016-7-10</td></tr><tr><td>验收状态</td><td colspan=\"5\">{{vm.source.StatusName}}</td></tr><tr ng-repeat=\"item in vm.source.AreaList\"><td colspan=\"6\"><table class=\"table table-hover table-bordered\"><tr><td colspan=\"6\">{{item.AreaFullName}}</td></tr><tr><td colspan=\"6\"><div class=\"imgWrap\"><img ng-repeat=\"k in item.QualifiedPicList\" ng-src=\"{{k.Url}}\"></div></td></tr><tr><td colspan=\"6\">原位标注</td></tr><tr><td colspan=\"6\"><div class=\"ywWrap\" sxt-report-view=\"\" ponits=\"item.PointList\" region-id=\"item.AreaID\" type=\"\'house\'\"></div></td></tr><tr ng-repeat=\"k in item.RectificationPic\"><td colspan=\"6\"><table class=\"table table-hover table-bordered\"><tr><td colspan=\"6\">{{k.ProblemSortName+\'.\'+k.ProblemDescription}}</td></tr><tr><td>验收照片</td><td>整改照片</td></tr><tr><td><div class=\"zgWrap\"><img ng-repeat=\"m in k.Front\" ng-src=\"{{m.Url}}\"></div></td><td><div class=\"zgWrap\"><img ng-repeat=\"m in k.Back\" ng-src=\"{{ m.Url}}\"></div></td></tr></table></td></tr></table></td></tr></table>");
$templateCache.put("app/main/pcReport/ysReport/gxysFilter.html","<md-toolbar class=\"md-hue-1\" ng-if=\"!vm.isMobile\"><div class=\"md-toolbar-tools\"><h4><span>工序验收</span></h4></div></md-toolbar><div ng-if=\"!vm.isMobile||vm.isiPad\"><md-card style=\"background-color: white;\" md-theme-watch=\"\"><md-card-content><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>项目</label><md-select ng-model=\"project\"><md-option ng-click=\"vm.ck(item)\" ng-repeat=\"item in vm.regions\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"width: 20px\"></div><div flex=\"\" layout=\"row\" ng-click=\"click()\"><md-input-container md-theme=\"default\" style=\"padding-left: 2px\" flex=\"\"><label style=\"left: 0px\">工序</label><div><input ng-model=\"gxNames\" disabled=\"\"><md-button class=\"md-icon-button md-primary\" style=\"position: absolute;right: -8px;\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon></md-button></div></md-input-container></div></md-card-content></md-card><div flex=\"\" style=\"margin: 24px 16px\"><table class=\"table table-hover\"><thead><tr><th style=\"text-align: center\">序号</th><th style=\"text-align: center\">工序</th><th style=\"text-align: center\">部位</th><th style=\"text-align: center\">报验时间</th><th style=\"min-width: 50px;text-align: center\">状态</th><th style=\"text-align: center\">操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td style=\"text-align: center;vertical-align: middle;width: 50px\">{{$index+1}}</td><td style=\"text-align: left;min-width: 120px;vertical-align: middle\">{{item.AcceptanceItemName}}</td><td style=\"text-align: left;min-width: 120px;vertical-align: middle\"><md-list style=\"padding: 0px 15px\" ng-cloak=\"\"><md-list-item ng-repeat=\"k in item.Children\">{{k.RegionName}}</md-list-item></md-list></td><td style=\"text-align: center;vertical-align: middle;\">{{item.InspectionTime}}</td><td style=\"text-align: center;vertical-align: middle;width: 80px\">{{item.statusName}}</td><td style=\"text-align: center;width: 80px;vertical-align: middle;\"><md-button ng-click=\"vm.Lookintoys(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'\', page, pageSize, total)\"></div></div></div></div><div ng-if=\"vm.isMobile&&!vm.isiPad\" style=\"position: relative\"><section style=\"padding: 22px 18px\"><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>项目</label><md-select ng-model=\"project\" name=\"type\"><md-option ng-click=\"vm.ck(item)\" ng-repeat=\"item in vm.regions\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"width: 20px\"></div><div flex=\"\" layout=\"row\" ng-click=\"click()\"><md-input-container md-theme=\"default\" style=\"padding-left: 2px\" flex=\"\"><label style=\"left: 0px\">工序</label><div><input ng-model=\"gxNames\" disabled=\"\" style=\"border-bottom: 1px solid #d8d8d8\"><md-button class=\"md-icon-button md-primary\" style=\"position: absolute;right: -8px;\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon></md-button></div></md-input-container></div><div layout=\"row\"><md-button style=\"margin: 12px 0px\" class=\"md-raised md-primary\" flex=\"\" ng-click=\"vm.filter()\">确定</md-button></div></section></div><md-sidenav id=\"gx_nav\" layout=\"column\" style=\"min-width: 80%\" class=\"md-sidenav-right md-whiteframe-4dp\" md-component-id=\"right\"><div flex=\"\" layout=\"column\" style=\"border-top: 1px solid #f5f5f9\"><md-tabs md-border-bottom=\"\" flex=\"\" style=\"background-color:white\"><md-tab label=\"已选工序({{gxSelected.length}})\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"row\"><md-list style=\"box-shadow:1px 0px 15px 0 #d8d8d8\" flex=\"40\" ms-scroll=\"\"><md-list-item ng-repeat=\"item in gxSelected\"><md-checkbox ng-click=\"remove(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\">{{item.AcceptanceItemName}}</md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item><span flex=\"\"></span></md-list></md-content></md-tab-content></md-tab><md-tab ng-repeat=\"gx1 in procedures\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"column\"><div flex=\"\" layout=\"row\"><div flex=\"40\" style=\"position: relative\" ms-scroll=\"\" layout=\"column\"><md-list style=\"margin-left:8px\"><md-list-item ng-click=\"selectSpecialtyLow(item,gx1)\" layout=\"row\" ng-repeat=\"item in gx1.SpecialtyChildren\"><p>{{item.SpecialtyName}}</p></md-list-item></md-list></div><md-list flex=\"\" style=\"box-shadow:-1px 0px 15px 0 #d8d8d8\"><md-list-item layout=\"row\" ng-repeat=\"item in gx1.WPAcceptanceList\"><md-checkbox ng-click=\"choosego(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\"></md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item></md-list></div></md-content></md-tab-content></md-tab></md-tabs></div></md-sidenav>");
$templateCache.put("app/main/pcReport/ysReport/gxysReport.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-show=\"vm.show\" style=\"position: absolute;right: 8px\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.goBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div><md-tabs ng-show=\"vm.show\" flex=\"\" layout=\"column\"><md-tab flex=\"\" layout=\"column\" label=\"工序验收\"><md-tab-content ms-scroll=\"\" class=\"download\" style=\"padding: 0px\"><table class=\"summaryReport\"><thead><tr><th>序号</th><th style=\"width:23%\">工序</th><th style=\"width:23%\">区域</th><th style=\"width:23%\">报验时间</th><th style=\"width: 10%;min-width: 50px\">状态</th><th style=\"min-width: 50px\">操作</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.source\"><td>{{$index+1}}</td><td style=\"text-align: left;padding-left: 15px;min-width: 120px\">{{item.AcceptanceItemName}}</td><td style=\"text-align: left;min-width: 120px\"><md-list style=\"padding: 0px 15px\" ng-cloak=\"\"><md-list-item ng-repeat=\"k in item.Children\">{{k.RegionName}}</md-list-item></md-list></td><td>{{item.InspectionTime}}</td><td>{{item.statusName}}</td><td><md-button ng-click=\"vm.Lookintoys(item)\" class=\"md-primary\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon>查看</md-button></td></tr></tbody></table><div layout=\"row\" layout-align=\"end center\" style=\"min-width: 550px\"><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/pileFoundation/component/pileFoundation-list.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>桩基管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-padding=\"\"><div layout=\"row\"><md-input-container flex=\"45\" style=\"padding:0px 15px;\"><label>项目</label><md-select name=\"ProjectID\" ng-model=\"vm.project\"><md-option ng-repeat=\"item in vm.ProjectList\" ng-value=\"item.ProjectID\" ng-click=\"vm.makeRegionTreeName(item.ProjectName,null)\">{{item.ProjectName}}</md-option></md-select></md-input-container><md-input-container flex=\"45\" style=\"padding:0px 15px\"><label>分期</label><md-select name=\"RegionID\" ng-model=\"vm.Stages\"><md-option ng-repeat=\"item in vm.StagesList\" ng-value=\"item.RegionID\" ng-click=\"vm.makeRegionTreeName(null,item.RegionName)\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div layout=\"row\" style=\"margin: 0 5px;\"><div style=\"border: 2px solid darkgray;border-radius: 5px; margin: 0px 5px 10px 5px;min-width: 203px; float: left;\" ng-repeat=\"item in vm.lst_html\"><input type=\"text\" style=\"min-width: 110px; width: 114px; height: 35px;padding: 0 10px;\" ng-value=\"item.RegionName\" ng-model=\"item.RegionName\" required=\"\"><md-button class=\"md-raised\" style=\"min-width:41px;height:35px;padding: 0;margin:0;border-left: 2px solid darkgray;border-right: 0; margin-right: -2px;\" ng-click=\"vm.save(item)\">保存</md-button><md-button class=\"md-raised\" style=\"min-width:41px;height:35px; margin:0;padding: 0;border-left: 2px solid darkgray;border-right: 0;\" ng-click=\"vm.zj.obj = item;vm.zj.files = []\">管理</md-button></div><div style=\"border: 2px solid darkgray;border-radius: 5px; margin: 0px 5px 10px 5px;min-width: 206px;width: 206px;float: left;\"><input type=\"text\" ng-model=\"vm.RegionName\" style=\"min-width: 118px; width: 118px; height: 35px;padding: 0 10px;\" required=\"\"><md-button class=\"md-raised\" style=\"min-width: 82px;height:35px;padding: 0;margin:0;border-left: 2px solid darkgray;border-right: 0;;float: right;\" ng-click=\"vm.addRegion()\" ng-disabled=\"vm.project==null || vm.Stages==null\">添加</md-button></div></div><div ng-show=\"vm.zj.obj.Id\"><div style=\"height:500px;background: #ddd;\" is-show=\"true\" popup=\"zjPopup\" sxt-area-zj=\"\" data=\"vm.zj\"></div><div ng-hide=\"true\"><div id=\"zjPopup\" class=\"form-group\"><input type=\"text\" style=\"width: 150px;\"></div></div><sxt-images-tf ng-model=\"vm.zj.obj.Id\" single=\"true\" files=\"vm.zj.files\" edit=\"true\"></sxt-images-tf></div></md-content>");
$templateCache.put("app/main/plan/component/plan-bc.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>补偿管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.plan.bc.detail\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th>名称</th><th>日期</th><th>日期类型</th><th>前补偿天数</th><th>后补偿天数</th><th>是否全面停工</th><th style=\"width: 160px\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.data\"><td>{{item.Sign}}</td><td>{{item.Time | date:\'MM-dd\'}}</td><td>{{item.TimeType == 0?\'公历\':\'农历\'}}</td><td>{{item.FrontDays}}</td><td>{{item.BackDay}}</td><td>{{item.IsAllStopWork?\'是\':\'否\'}}</td><td class=\"actions\"><md-button class=\"md-icon-button\" aria-label=\"Settings\" ui-sref=\"app.plan.bc.detail({id:item.CompensateId})\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Settings\" ng-click=\"vm.delete(item.CompensateId)\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/plan/component/plan-bcAdd.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>补偿管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>日期</label><md-datepicker ng-model=\"vm.data.Time\" md-open-on-focus=\"\" required=\"\" md-placeholder=\"日期\"></md-datepicker></md-input-container><md-input-container class=\"md-block\" style=\"height: 58px;\"><label>日期类型</label><md-select ng-model=\"vm.data.TimeType\"><md-option value=\"0\">公历</md-option><md-option value=\"1\">农历</md-option></md-select></md-input-container><md-input-container class=\"md-block\"><label>前补偿天数</label> <input type=\"number\" ng-model=\"vm.data.FrontDays\"></md-input-container><md-input-container class=\"md-block\"><label>后补偿天数</label> <input type=\"number\" ng-model=\"vm.data.BackDay\"></md-input-container><md-input-container class=\"md-block\" style=\"height: 58px;\"><label>适用区域</label><md-select ng-model=\"vm.data.AreaIds\" multiple=\"\"><md-option value=\"{{item.DDicMember}}\" ng-repeat=\"item in vm.Areas\">{{item.DDicMemberName}}</md-option></md-select></md-input-container><md-input-container class=\"md-block\"><label>标识</label> <input type=\"text\" ng-model=\"vm.data.Sign\" md-autofocus=\"\"></md-input-container><md-input-container class=\"md-block\"><span>是否全面停工</span>&nbsp;&nbsp;<md-radio-group ng-model=\"vm.data.IsAllStopWork\"><md-radio-button style=\"display: inline-block;\" value=\"true\">是</md-radio-button><md-radio-button style=\"display: inline-block;\" value=\"false\">否</md-radio-button></md-radio-group></md-input-container></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.save()\" class=\"md-primary md-raised\">保存</md-button></div></md-content>");
$templateCache.put("app/main/plan/component/plan-branch.html","<md-dialog><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>关联任务</span></h2><span flex=\"\"></span></div></md-toolbar><md-dialog-content style=\"padding: 0;width:400px;height:150px;padding-top:30px;\"><md-input-container flex=\"\" class=\"md-block\"><label>关联任务</label><md-select ng-model=\"vm.relatedTask\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"></md-input-container></md-select-header><md-optgroup><md-option ng-value=\"m\" ng-selected=\"vm.current == m\" ng-repeat=\"m in vm.subTasks | filter:searchTerm\">{{m.Name}}</md-option></md-optgroup></md-select></md-input-container></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-click=\"vm.select()\" class=\"md-raised\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/plan/component/plan-build.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>创建计划</span></h2></div></md-toolbar>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <md-content layout=\"column\" flex=\"\"><ms-form-wizard flex=\"\" class=\"create-plan\" ng-if=\"!vm.initLoading\" id=\"formWizard\"><div scroll-top=\"msWizard.selectedIndex\"><md-tabs md-dynamic-height=\"\" md-selected=\"msWizard.selectedIndex\" md-center-tabs=\"true\"><md-tab><md-tab-label><span class=\"ms-form-wizard-step-label\"><span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep1.$invalid\">1</span> <span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep1.$valid\"><i class=\"icon-check s16\"></i></span> <span class=\"ms-form-wizard-step-text\">基本信息</span></span></md-tab-label><md-tab-body><form name=\"wizardStep1\" flex=\"\" ms-form-wizard-form=\"\" novalidate=\"\"><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"40\"><label>请选择项目</label><md-select name=\"projectId\" ng-model=\"vm.formWizard.projectId\" required=\"\" md-on-open=\"vm.getMaps()\" md-on-close=\"vm.getYT(vm.formWizard.projectId)\"><md-option ng-value=\"p.ProjectID\" ng-repeat=\"p in vm.data.projects\">{{p.ProjectName}}</md-option></md-select><div ng-messages=\"wizardStep1.projectId.$error\" ng-show=\"wizardStep1.projectId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择项目.</span></div></div></md-input-container><md-input-container class=\"md-block\" flex=\"30\"><label>请选择分期</label><md-select name=\"sectionId\" ng-model=\"vm.formWizard.sectionId\" required=\"\" md-on-open=\"vm.getSections()\"><md-option ng-value=\"p.RegionID\" ng-repeat=\"p in vm.data.sections\">{{p.RegionName}}</md-option></md-select><div ng-messages=\"wizardStep1.projectId.$error\" ng-show=\"wizardStep1.projectId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择分期.</span></div></div></md-input-container><md-input-container class=\"md-block\" flex=\"30\"><label>请选择楼栋</label><md-select name=\"buildingId\" ng-model=\"vm.formWizard.BuildingId\" required=\"\" md-on-open=\"vm.getBuildings()\"><md-option ng-value=\"p.RegionID\" ng-repeat=\"p in vm.data.buildings\">{{p.RegionName}}</md-option></md-select><div ng-messages=\"wizardStep1.projectId.$error\" ng-show=\"wizardStep1.projectId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择楼栋.</span></div></div></md-input-container></div><div layout=\"row\"><md-input-container class=\"md-block\" flex=\"40\"><label>请选择模板</label><md-select name=\"templateId\" required=\"\" ng-disabled=\"!vm.formWizard.projectId\" ng-model=\"vm.formWizard.RootTaskLibraryId\"><md-option ng-value=\"p.RootTaskLibraryId\" ng-repeat=\"p in vm.data.templates\">{{p.Name}}</md-option></md-select><div ng-messages=\"wizardStep1.templateId.$error\" ng-show=\"wizardStep1.templateId.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请选择模板.</span></div></div></md-input-container><md-input-container flex=\"\"><label>开始日期</label><md-datepicker name=\"beginDate\" ng-model=\"vm.formWizard.StartTime\" md-placeholder=\"日期\" required=\"\" md-open-on-focus=\"\"></md-datepicker></md-input-container></div><div layout=\"row\"><md-input-container flex=\"100\" class=\"md-block\"><input type=\"text\" name=\"planName\" ng-change=\"vm.change()\" ng-model=\"vm.formWizard.Name\" placeholder=\"计划名称\" required=\"\"><div ng-messages=\"wizardStep1.planName.$error\" ng-show=\"wizardStep1.planName.$touched\" role=\"alert\"><div ng-message=\"required\"><span>请输入计划名称.</span></div></div></md-input-container></div></form></md-tab-body></md-tab><md-tab ng-disabled=\"wizardStep1.$invalid\"><md-tab-label><span class=\"ms-form-wizard-step-label\"><span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep2.$invalid\">2</span> <span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep2.$valid\"><i class=\"icon-check s16\"></i></span> <span class=\"ms-form-wizard-step-text\">设置任务</span></span></md-tab-label><md-tab-body><form name=\"wizardStep2\" ms-form-wizard-form=\"\" novalidate=\"\"><md-content layout=\"row\" flex=\"\" ms-scroll=\"\"><plan-creating flex=\"\" flow=\"vm.flows\" vars=\"vm.vars\" branch=\"vm.branches\" build-id=\"vm.formWizard.BuildingId\" begin=\"vm.formWizard.StartTime\" library-id=\"vm.formWizard.RootTaskLibraryId\" template-id=\"vm.formWizard.TaskTemplateId\" ct=\"ct\"></plan-creating></md-content></form></md-tab-body></md-tab><md-tab ng-disabled=\"wizardStep1.$invalid || wizardStep2.$invalid\"><md-tab-label><span class=\"ms-form-wizard-step-label\"><span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep3.$invalid\">3</span> <span class=\"ms-form-wizard-step-number md-accent-bg\" ng-if=\"wizardStep3.$valid\"><i class=\"icon-check s16\"></i></span> <span class=\"ms-form-wizard-step-text\">人员分配</span></span></md-tab-label><md-tab-body><form name=\"wizardStep3\" ms-form-wizard-form=\"\" novalidate=\"\"><div layout=\"row\" flex=\"\" ng-repeat=\"r in vm.currentRoles\"><md-select ng-model=\"r.Users\" placeholder=\"{{r.RoleName}}\" class=\"md-block\" multiple=\"\" flex=\"\" md-on-open=\"vm.loadUser()\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"></md-input-container></md-select-header><md-option ng-value=\"p.Id\" ng-repeat=\"p in vm.roleUsers|filter:searchTerm\">{{p.UserName}}</md-option></md-select></div></form></md-tab-body></md-tab></md-tabs><div class=\"navigation\" flex=\"none\" layout=\"row\" layout-align=\"center center\"><md-button class=\"md-raised md-accent\" ng-click=\"vm.loading=false;msWizard.previousStep()\" ng-disabled=\"msWizard.isFirstStep()\">上一步</md-button><div class=\"steps\"><span ng-repeat=\"form in msWizard.forms\" ng-class=\"{\'selected md-accent-bg\':msWizard.selectedIndex === $index}\"></span></div><md-button class=\"md-raised md-accent\" ng-click=\"vm.nextStep(msWizard.selectedIndex,msWizard.nextStep);\" ng-hide=\"msWizard.isLastStep()\" ng-disabled=\"msWizard.currentStepInvalid()\">下一步</md-button><md-button class=\"md-raised md-warn\" ng-click=\"vm.sendForm(msWizard.resetForm)\" ng-show=\"msWizard.isLastStep()\" ng-disabled=\"msWizard.formsIncomplete()\">生成任务</md-button></div></div></ms-form-wizard><div layout=\"column\" flex=\"\" layout-align=\"center center\" ng-if=\"vm.initLoading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div></md-content>");
$templateCache.put("app/main/plan/component/plan-create-vars.html","<md-dialog><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>设置变量</span></h2><span flex=\"\"></span></div></md-toolbar><md-dialog-content><div><md-input-container><label>公式</label> <input ng-model=\"vm.dur\"></md-input-container><md-input-container ng-repeat=\"v in vm.vars\"><label>{{v.key}}</label> <input ng-model=\"v.value\"></md-input-container></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-click=\"vm.select()\" class=\"md-raised\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/plan/component/plan-create.html","<table class=\"simple\"><thead><tr><th style=\"width: 24px;min-width: 24px\">启用</th><th style=\"width: 120px;min-width: 120px\">流程</th><th>任务</th><th style=\"width: 120px;min-width: 120px\">工期</th><th style=\"width: 24px;min-width: 24px\">天数</th><th style=\"width: 80px;min-width: 80px\">开始日期</th><th style=\"width: 80px;min-width: 80px\">结束日期</th><th style=\"width: 24px;min-width: 24px; text-align: center\">上</th><th style=\"width: 24px;min-width: 24px; text-align: center\">下</th></tr></thead><tr class=\"mainbar\"><td colspan=\"9\">主线</td></tr><tr ng-class=\"{deleted:!flow.selected,milestone:!!flow.type}\" ng-repeat=\"flow in vm.flows track by flow.TaskFlowId\"><td ng-if=\"!flow.type\"><input ng-if=\"!flow.IsRequired\" ng-click=\"vm.buildDate()\" type=\"checkbox\" ng-model=\"flow.selected\"></td><td ng-if=\"!flow.type\" ng-style=\"{\'padding-left\':(10+((t.line<5?t.line:(t.line % 5)+1)*12))+\'px\'}\">{{$index+1}}、{{flow.Name}}</td><td ng-if=\"!flow.type\"><md-menu><span aria-label=\"添加\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event)\">{{flow.currentTask.Name}}</span><md-menu-content><md-menu-item ng-repeat=\"task in flow.OptionalTasks\"><md-button ng-click=\"vm.setCurrent(flow,task)\">{{task.Name}}</md-button></md-menu-item></md-menu-content></md-menu></td><td ng-if=\"!flow.type\"><input type=\"text\" ng-click=\"vm.setVars(flow)\" ng-blur=\"vm.buildDate()\" ng-model=\"flow.currentTask.Duration\"></td><td ng-if=\"!flow.type\">{{flow.days}}</td><td ng-if=\"!flow.type\">{{flow.start && flow.start.format(\'YYYY-MM-DD\')}}</td><td ng-if=\"flow.type\" colspan=\"6\">{{flow.Name}}</td><td>{{flow.end && flow.end.format(\'YYYY-MM-DD\')}}</td><td><md-icon ng-if=\"!flow.type && !flow.IsFloor\" md-font-icon=\"icon-arrow-up\" ng-click=\"vm.up(flow)\"></md-icon></td><td><md-icon ng-if=\"!flow.type && !flow.IsFloor\" md-font-icon=\"icon-arrow-down\" ng-click=\"vm.down(flow)\"></md-icon></td></tr><tr class=\"mainbar\"><td colspan=\"9\">穿插</td></tr><tr ng-repeat=\"flow in vm.banchs track by flow.TaskFlowId\"><td colspan=\"3\">{{$index+1}}、{{flow.Name}}</td><td><input type=\"text\" ng-click=\"vm.setVars(flow)\" ng-blur=\"vm.buildDate()\" ng-model=\"flow.Expression\"></td><td>{{flow.days}}</td><td>{{flow.start && flow.start.format(\'YYYY-MM-DD\')}}</td><td>{{flow.end && flow.end.format(\'YYYY-MM-DD\')}}</td><td></td><td></td></tr></table>");
$templateCache.put("app/main/plan/component/plan-gantt-flow.html","<md-dialog><md-toolbar class=\"md-hue-2 h-50 sub-toolbar\"><div class=\"md-toolbar-tools\"><h2><span>{{vm.dialogData.formData.name}}</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" ng-click=\"vm.close()\"><md-icon md-font-icon=\"icon-close\"></md-icon></md-button></div></md-toolbar><md-dialog-content><div layout=\"row\"><div flex=\"80\"><table class=\"simple gantable\"><thead><tr><th style=\"width: 25px;min-width: 25px\"></th><th>流程</th><th>计划时间</th><th>实时时间</th><th>实际时间</th><th>状态</th><th>操作</th></tr></thead><tbody><tr ng-repeat=\"flow in vm.flows\"><td style=\"padding:4px;height:44px;\">{{$index+1}}、</td><td style=\"padding:4px;height:44px;\">{{flow.Name}}</td><td style=\"padding:4px\">{{flow.ScheduledStartTime|date:\'yyyy-MM-dd\'}}~<br>{{flow.ScheduledEndTime|date:\'yyyy-MM-dd\'}}</td><td style=\"padding:4px\">{{flow.RealScheduledStartTime|date:\'yyyy-MM-dd\'}}~<br>{{flow.RealScheduledEndTime|date:\'yyyy-MM-dd\'}}</td><td style=\"padding:4px\">{{flow.ActualStartTime|date:\'yyyy-MM-dd\'}}~<br>{{flow.ActualEndTime|date:\'yyyy-MM-dd\'}}</td><td style=\"padding:4px\">{{flow._State}}</td><td style=\"color:#f00;padding:4px;\"><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 40px;\" ng-click=\"vm.showTaskD(flow)\" ng-if=\"(flow.State==2)&&flow.ManuallyClose\">查看<md-tooltip md-delay=\"10\">{{flow.EndDescription}}</md-tooltip></md-button><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 40px;\" ng-click=\"vm.startTask(flow)\" ng-if=\"flow.IsAbleStart&&(flow.IsInterlude)\">开启穿插</md-button><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;;min-width: 40px;\" ng-click=\"vm.closeTask(flow)\" ng-if=\"flow.IsAbleStart&&!flow.IsInterlude&&(flow.ManuallyClose||flow.IsRelatedObject)\" ng-disabled=\"(flow.ManuallyClose||flow.IsRelatedObject)&&!flow.IsAbleStart\">完成</md-button></td></tr><tr><td colspan=\"5\" ng-if=\"!vm.flows.length\">无流程信息</td></tr></tbody></table></div><div flex=\"20\"><div style=\"height: 65px\"></div><canvas id=\"gitGraph\" ng-show=\"vm.hasFlow\"></canvas></div></div></md-dialog-content></md-dialog>");
$templateCache.put("app/main/plan/component/plan-gantt.html","<div flex=\"\" id=\"gantt-chart\" layout=\"column\" class=\"page-layout carded fullwidth\" ng-class=\"{\'date-filter-active\':vm.dateFilterActive, \'search-active\': vm.searchActive}\"><div class=\"md-accent-bg\"></div><div class=\"centera\" layout=\"column\" flex=\"\"><div class=\"content-card\" layout=\"column\" flex=\"\"><div class=\"toolbar\" layout=\"row\" layout-align=\"space-between center\"><div layout=\"row\" layout-align=\"start center\"></div><div layout=\"row\" layout-align=\"start center\"><div class=\"zoom\" layout=\"row\" layout-align=\"end center\"><span class=\"label\">缩放:</span><div class=\"input-wrapper\" layout=\"row\" layout-align=\"center center\"><md-button class=\"md-icon-button\" aria-label=\"minus\" ng-click=\"vm.options.zoom = vm.options.zoom - 0.1\"><md-icon md-font-icon=\"icon-minus\"></md-icon></md-button><input type=\"number\" ng-model=\"vm.options.zoom\" step=\"0.1\" min=\"0.1\" max=\"5\"><md-button class=\"md-icon-button\" aria-label=\"plus\" ng-click=\"vm.options.zoom =vm.options.zoom + 0.1\"><md-icon md-font-icon=\"icon-plus\"></md-icon></md-button></div></div><md-select class=\"simplified select-scale\" ng-model=\"vm.options.scale\" placeholder=\"Scale\"><md-option value=\"hour\">小时</md-option><md-option value=\"day\">天</md-option><md-option value=\"week\">周</md-option><md-option value=\"2 weeks\">2 周</md-option><md-option value=\"month\">月</md-option><md-option value=\"quarter\">季</md-option><md-option value=\"6 months\">半年</md-option><md-option value=\"year\">年</md-option></md-select></div></div><md-content id=\"chart-container\" class=\"content\" flex=\"\" layout=\"column\"><div flex=\"\" layout-fill=\"\" id=\"gantt\" gantt=\"\" data=\"vm.data\" timespans=\"vm.timespans\" show-side=\"vm.options.labelsEnabled\" daily=\"vm.options.daily\" filter-task=\"{\'name\': vm.options.filterTask}\" filter-row=\"{\'name\': vm.options.filterRow}\" sort-mode=\"vm.options.sortMode\" view-scale=\"vm.options.scale\" column-width=\"vm.getColumnWidth(vm.options.width, vm.options.scale, vm.options.zoom)\" auto-expand=\"vm.options.autoExpand\" task-out-of-range=\"vm.options.taskOutOfRange\" from-date=\"vm.options.fromDate\" to-date=\"vm.options.toDate\" side-width=\"vm.options.sideWidth\" allow-side-resizing=\"vm.options.allowSideResizing\" task-content=\"vm.options.taskContentEnabled ? vm.options.taskContent : undefined\" row-content=\"vm.options.rowContentEnabled ? vm.options.rowContent : undefined\" current-date=\"vm.options.currentDate\" current-date-value=\"vm.options.currentDateValue\" headers=\"vm.options.width && vm.options.shortHeaders || vm.options.longHeaders\" max-height=\"vm.options.maxHeight\" time-frames=\"vm.options.timeFrames\" date-frames=\"vm.options.dateFrames\" time-frames-non-working-mode=\"vm.options.timeFramesNonWorkingMode\" time-frames-magnet=\"vm.options.timeFramesMagnet\" api=\"vm.options.api\" column-magnet=\"vm.options.columnMagnet\"><gantt-tree header=\"vm.options.treeHeader\" enabled=\"vm.options.sideMode === \'Tree\' || vm.options.sideMode === \'TreeTable\'\" header-content=\"vm.options.treeHeaderContent\" keep-ancestor-on-filter-row=\"true\"></gantt-tree><gantt-table enabled=\"vm.options.sideMode === \'Table\' || vm.options.sideMode === \'TreeTable\'\" columns=\"vm.options.sideMode === \'TreeTable\' ? vm.options.treeTableColumns : vm.options.columns\" headers=\"vm.options.columnsHeaders\" classes=\"vm.options.columnsClasses\" formatters=\"vm.options.columnsFormatters\" contents=\"vm.options.columnsContents\" header-contents=\"vm.options.columnsHeaderContents\"></gantt-table><gantt-groups enabled=\"vm.options.groupDisplayMode === \'group\' || vm.options.groupDisplayMode === \'overview\' || vm.options.groupDisplayMode === \'promote\'\" display=\"vm.options.groupDisplayMode\"></gantt-groups><gantt-bounds></gantt-bounds><gantt-progress></gantt-progress><gantt-sortable></gantt-sortable><gantt-resize-sensor></gantt-resize-sensor><gantt-dependencies read-only=\"true\"></gantt-dependencies></div></md-content></div></div></div>");
$templateCache.put("app/main/plan/component/plan-ganttlist.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>计划管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.plan.buildPlan\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"simple\"><thead><tr><th>名称</th><th>时间</th><th style=\"width: 200px\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.items\"><td class=\"name\">{{item.Name}}</td><td class=\"time\">{{item.StartTime|date:\'yyyy-M-d\'}}</td><td class=\"actions\"><md-button ui-sref=\"app.plan.milestone.gantt({id:item.Id})\" class=\"md-icon-button\" aria-label=\"编辑\" title=\"编辑\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button ng-click=\"vm.Delete(item)\" class=\"md-icon-button\" aria-label=\"删除\" title=\"删除\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button><md-button class=\"md-icon-button\" ng-if=\"item.IsAbleStartUpRenovation\" aria-label=\"开启\" title=\"开启精装修\" ng-click=\"vm.openJzx(item)\"><md-icon md-font-icon=\"icon-format-paint\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"pageing.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/plan/component/plan-milestone.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>里程碑</span></h2></div></md-toolbar><div layout=\"row\" flex=\"\" layout-padding=\"\"><div flex=\"60\"><table class=\"simple milestone\"><thead><tr><th>里程碑名称</th><th>日期</th><th>编辑</th></tr></thead><tbody><tr ng-repeat=\"m in vm.data\" ng-click=\"vm.select(m)\"><td>{{m.Name}}</td><td><span ng-if=\"vm.current == m&&m.edit\"><md-datepicker name=\"beginDate\" ng-model=\"m.setTime\" md-open-on-focus=\"\" md-placeholder=\"日期\" required=\"\"></md-datepicker></span> <span ng-if=\"!m.edit\">{{m.MilestoneTime|date:\'yyyy-MM-dd\'}}</span></td><td><md-button ng-if=\"!m.IsComplete\" ng-click=\"vm.edit(m)\" class=\"md-icon-button\" aria-label=\"编辑\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button></td></tr><tr ng-if=\"!vm.data.length\"><td colspan=\"4\">无里程碑</td></tr></tbody></table><div layout=\"row\" layout-align=\"end center\"><md-button class=\"md-raised\" ui-sref=\"app.plan.milestone.item\">查看详情</md-button></div></div></div>");
$templateCache.put("app/main/plan/component/plan-personplan.html","<md-calendar class=\"pcalendar\" ng-if=\"vm.loading\" ng-model=\"vm.myDate\" md-date-filter=\"onlyWeekendsPredicate\"></md-calendar><md-content style=\"border-top:1px solid #dedede;\" class=\"p-10\"><div layout=\"row\" layout-align=\"center center\" ng-if=\"!vm.loading\" class=\"m-10\"><md-progress-circular md-diameter=\"20px\"></md-progress-circular>任务加载中</div><div ng-if=\"vm.loading\"><div ng-repeat=\"task in vm.tasksList\" ng-if=\"task.tasks.length\" style=\"border-bottom:1px solid #dedede;\"><div layout=\"row\" style=\"color:#f00;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\" class=\"pt-8 pb-8\" ng-if=\"task.tasks.length\">{{task.Name}}</div><div layout=\"row\" layout-align=\"space-between center\" ng-repeat=\"t in task.tasks\" class=\"pb-8\"><div flex=\"55\" style=\"white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{t.ParentFloorName}}{{t.Name}}</div><div flex=\"25\">{{t.ScheduledStartTime|date:\'yy/MM/dd\'}}</div><div flex=\"20\" style=\"text-align: right;\"><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 40px;margin:0;\" ng-click=\"vm.showTaskD(t)\" ng-if=\"(t.State==2)&&t.ManuallyClose&&(!t.IsAbleStart)\">查看</md-button><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 60px;margin:0;\" ng-click=\"vm.startTask(t)\" ng-if=\"t.IsAbleStart&&t.IsInterlude\">开启穿插</md-button><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 40px;margin:0;\" ng-click=\"vm.end(t)\" ng-if=\"t.IsAbleStart&&(!t.IsInterlude)&&(t.ManuallyClose||t.IsRelatedObject)\">完成</md-button></div></div></div><div layout=\"row\" style=\"border-bottom: 1px solid #dedede;\" class=\"pv-10\">未启动计划</div><div ng-repeat=\"noplan in vm.data\" ng-if=\"noplan.showNoPlan\"><div style=\"color:#f00;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\" class=\"pt-8 pb-8\">{{noplan.Name}}</div><div layout=\"row\" layout-align=\"space-between center\" ng-repeat=\"t in noplan.NoPlanTasks\"><div flex=\"55\">{{t.ParentFloorName}}{{t.Name}}</div><div flex=\"25\"></div><div flex=\"20\" style=\"text-align: right;\"><md-button style=\"min-height:24px;line-height: 24px;height:24px;padding:0;min-width: 60px;margin:0;\" ng-click=\"vm.startTask(t)\" ng-if=\"t.IsAbleStart&&(t.IsInterlude)\">开启穿插</md-button></div></div></div></div></md-content>");
$templateCache.put("app/main/plan/component/plan-report.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>报表</span></h2></div></md-toolbar><div style=\"min-width:744px;\" class=\"p-10\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"report\"><thead><tr><th colspan=\"8\" style=\"text-align: center\">节点完成统计报表</th><th style=\"text-align: center\"><span>统计日期</span></th><th style=\"text-align: center\"><span>{{vm.reportTime|date:\'yyyy-MM-dd\'}}</span></th></tr><tr><th style=\"width: 10%\">公司</th><th style=\"width: 10%\">项目</th><th style=\"width: 10%\">标段</th><th style=\"width:10%\">节点</th><th style=\"width:10%\"><span>计划完成时间</span></th><th style=\"width:10%\"><span>实际完成时间</span></th><th style=\"width:10%\">状态</th><th style=\"width:10%\"><span>延期天数</span></th><th style=\"width:10%\"><span>下一节点</span></th><th style=\"width:10%\"><span>下一节点工期</span></th></tr></thead><tbody ng-repeat=\"d in vm.data.CompanyStatisticss\"><tr ng-repeat=\"p in d.ProjectStatisticss\" style=\"width:10%\"><td rowspan=\"{{d.ProjectStatisticss.length}}\" ng-if=\"$index==0\"><span>{{d.CompanyName}}</span></td><td colspan=\"9\" style=\"width: 90%\"><table style=\"width: 100%\" cellpadding=\"0\" cellspacing=\"0\"><tr ng-repeat=\"s in p.SectionStatisticss\"><td rowspan=\"{{p.SectionStatisticss.length}}\" ng-if=\"$index==0\" style=\"width: 11%\"><span>{{p.ProjectName}}</span></td><td colspan=\"8\" style=\"width: 89%\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr ng-repeat=\"t in s.TaskStatisticss\"><td rowspan=\"{{s.TaskStatisticss.length}}\" ng-if=\"$index==0\"><span>{{s.SectionName}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\"><span>{{t.BuildName}}{{t.TaskName}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\"><span>{{t.ScheduledEndTime|date:\'yyyy-MM-dd\'}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\" ng-class=\"{\'sblue\':t.CompleteStatus==2,\'syellow\':t.CompleteStatus==3,\'sred\':t.CompleteStatus==4,\'sblack\':t.CompleteStatus==5}\"><span>{{t.ActualEndTime|date:\'yyyy-MM-dd\'}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\"><span>{{t.statusName}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\" ng-class=\"{\'sblue\':t.CompleteStatus==2,\'syellow\':t.CompleteStatus==3,\'sred\':t.CompleteStatus==4,\'sblack\':t.CompleteStatus==5}\"><span>{{t.DelayDays}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\"><span>{{t.BuildName}}{{t.NextTaskName}}</span></td><td ng-style=\"{\'border-bottom\':$last==true?\'none\':\'1px solid #dedede\'}\"><span>{{t.NextTaskDuration}}</span></td></tr></tbody></table></td></tr></table></td></tr><tr><td rowspan=\"3\"><span>统计结果</span></td><td><span>总节点</span></td><td><span>提前完成</span></td><td><span>正常完成</span></td><td><span>轻度延期</span></td><td><span>中度延期</span></td><td><span>重度延期</span></td><td><span>严重延期</span></td><td></td><td></td></tr><tr><td><span>{{d.StatisticsResult.TotalTaskNumber}}</span></td><td><span>{{d.StatisticsResult.AdvanceCompleteNumber}}</span></td><td><span>{{d.StatisticsResult.NormalCompleteNumber}}</span></td><td><span>{{d.StatisticsResult.LightDelayNumber}}</span></td><td><span>{{d.StatisticsResult.ModerateDelayNumber}}</span></td><td><span>{{d.StatisticsResult.HightDelayNumber}}</span></td><td><span>{{d.StatisticsResult.SeriousDelayNumber}}</span></td><td></td><td></td></tr><tr><td><span></span></td><td><span>{{d.StatisticsResult.AdvanceCompletePercent}}</span></td><td><span>{{d.StatisticsResult.NormalCompletePercent}}</span></td><td><span>{{d.StatisticsResult.LightDelayPercent}}</span></td><td><span>{{d.StatisticsResult.ModerateDelayPercent}}</span></td><td><span>{{d.StatisticsResult.HightDelayPercent}}</span></td><td><span>{{d.StatisticsResult.SeriousDelayPercent}}</span></td><td></td><td></td></tr></tbody><tbody><tr><td rowspan=\"3\"><span>地产集团统计结果</span></td><td><span>总节点</span></td><td><span>提前完成</span></td><td><span>正常完成</span></td><td><span>轻度延期</span></td><td><span>中度延期</span></td><td><span>重度延期</span></td><td><span>严重延期</span></td><td></td><td></td></tr><tr><td><span>{{vm.data.StatisticsResult.TotalTaskNumber}}</span></td><td><span>{{vm.data.StatisticsResult.AdvanceCompleteNumber}}</span></td><td><span>{{vm.data.StatisticsResult.NormalCompleteNumber}}</span></td><td><span>{{vm.data.StatisticsResult.LightDelayNumber}}</span></td><td><span>{{vm.data.StatisticsResult.ModerateDelayNumber}}</span></td><td><span>{{vm.data.StatisticsResult.HightDelayNumber}}</span></td><td><span>{{vm.data.StatisticsResult.SeriousDelayNumber}}</span></td><td><span></span></td><td><span></span></td></tr><tr><td><span></span></td><td><span>{{vm.data.StatisticsResult.AdvanceCompletePercent}}</span></td><td><span>{{vm.data.StatisticsResult.NormalCompletePercent}}</span></td><td><span>{{vm.data.StatisticsResult.LightDelayPercent}}</span></td><td><span>{{vm.data.StatisticsResult.ModerateDelayPercent}}</span></td><td><span>{{vm.data.StatisticsResult.HightDelayPercent}}</span></td><td><span>{{vm.data.StatisticsResult.SeriousDelayPercent}}</span></td><td><span></span></td><td><span></span></td></tr></tbody></table></div>");
$templateCache.put("app/main/plan/component/plan-task-close.html","<md-dialog><md-dialog-content><div layout=\"row\">关闭原因</div><div layout=\"row\" class=\"mt-10\"><div style=\"width: 50px;height:50px;\" sxt-images=\"img\"><img ng-repeat=\"i in img\" ng-src=\"{{i.ImageByte}}\" width=\"100%\" height=\"50\"></div></div><div layout=\"row\"><md-input-container class=\"md-block\" md-no-float=\"\" flex=\"\"><input type=\"text\" ng-model=\"description\"></md-input-container></div><div layout=\"row\"><md-button class=\"md-raised\" ng-click=\"cancel()\">取消</md-button><md-button class=\"md-raised\" ng-click=\"close(description)\">确定</md-button></div></md-dialog-content></md-dialog>");
$templateCache.put("app/main/plan/component/plan-task-level.html","<md-tabs md-border-bottom=\"\" flex=\"\" layout=\"column\"><md-tab label=\"任务流程\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"row\"><md-content layout=\"row\" flex=\"\" ms-scroll=\"\"><div flex=\"100\" layout=\"row\" layout-align=\"center start\" class=\"mt-20\" ng-show=\"vm.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div><div flex=\"80\" ng-show=\"!vm.loading\"><table class=\"simple\"><thead><tr><th>流程</th><th style=\"width: 24px;min-width: 24px\"><md-menu ng-show=\"vm.flows && vm.flows.length===0\"><span aria-label=\"任务流程\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event)\"><md-icon md-font-icon=\"icon-plus\" ng-click=\"$mdOpenMenu($event)\"></md-icon></span><md-menu-content><md-menu-item><md-button ng-click=\"vm.addNext($event,null, vm.flows.length)\">添加主线</md-button></md-menu-item></md-menu-content></md-menu></th><th ng-if=\"vm.data.Level==0\" style=\"width: 24px;min-width: 24px\">必选</th><th style=\"width: 24px;min-width: 24px\" ng-if=\"vm.data.Level==0\">变量</th><th ng-if=\"vm.data.Level==0\" style=\"width: 80px;min-width: 80px\">可选任务</th><th style=\"width: 60px;min-width: 60px\">通知</th><th style=\"width: 60px;min-width: 60px\">执行</th><th ng-if=\"vm.data.Level==0\" style=\"width: 110px;min-width: 110px\">里程碑/介入点</th><th ng-if=\"vm.data.Level==0\" style=\"width: 24px;min-width: 24px\">楼层</th></tr></thead><tr ng-repeat=\"flow in vm.flows track by flow.TaskFlowId\" style=\"height:44px;\"><td ng-style=\"{\'padding-left\':(10+(flow.line===0?0:1)*12)+\'px\'}\" style=\"white-space: nowrap;\">{{$index+1}}、<input type=\"text\" ng-blur=\"vm.updateFlowName(flow)\" ng-model=\"flow.Name\"></td><td><md-menu><span aria-label=\"添加\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event);vm.setBack(flow)\"><md-icon md-font-icon=\"icon-plus\"></md-icon></span><md-menu-content><md-menu-item ng-if=\"vm.data.Level!==0 || flow.line===0\"><md-button ng-click=\"vm.addNext($event,flow)\">下一主线</md-button></md-menu-item><md-menu-item ng-if=\"vm.data.Level!==0 || flow.line===0\"><md-button ng-click=\"vm.addNext($event,flow,true)\">添加分支</md-button></md-menu-item><md-menu-item ng-if=\"flow.line!==0\"><md-menu><md-button style=\"margin:0;padding: 0 16px;height: 48px\" ng-click=\"$mdOpenMenu()\">后置任务</md-button><md-menu-content><md-menu-item ng-if=\"flow.EndFlagTaskFlowId\"><md-button ng-click=\"vm.setEndFlow(flow)\">清除后置</md-button></md-menu-item><md-menu-item ng-repeat=\"f2 in vm.flows|filter:{showBack:true}\"><md-button ng-click=\"vm.setEndFlow(flow,f2)\">{{f2.Name}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-item><md-button ng-click=\"vm.removeFlow($event,flow)\">删除节点</md-button></md-menu-item></md-menu-content></md-menu></td><td ng-if=\"vm.data.Level==0\" align=\"center\"><input ng-if=\"flow.line==0\" type=\"checkbox\" ng-model=\"flow.IsRequired\" ng-click=\"vm.updateFlow(flow)\"></td><td ng-if=\"vm.data.Level == 0\"><input ng-if=\"flow.line==0\" style=\"width:90%;color:#C62828\" placeholder=\"无\" type=\"text\" ng-blur=\"vm.updateExpression(flow)\" ng-model=\"flow.Expression\"></td><td ng-if=\"vm.data.Level==0\"><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectOptionalTask(flow)\">{{flow.OptionalTask||\'未选择\'}}</div></td><td><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,7)\">{{flow.Notice7||\'未选择\'}}</div></td><td><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,8)\">{{flow.Notice8||\'未选择\'}}</div></td><td ng-if=\"vm.data.Level==0\"><input ng-show=\"!flow.IsFloor\" ng-if=\"flow.line===0\" style=\"width: 90%\" placeholder=\"无里程碑\" type=\"text\" ng-blur=\"vm.updateMilestone(flow)\" ng-model=\"flow.Milestone\"> <span ng-if=\"flow.line!==0\"><input style=\"width:100%;color:#C62828\" placeholder=\"无介入点\" type=\"text\" ng-blur=\"vm.updateExpression(flow)\" ng-model=\"flow.Expression\"></span></td><td ng-if=\"vm.data.Level==0\" align=\"center\"><input ng-if=\"flow.line===0\" type=\"checkbox\" ng-model=\"flow.IsFloor\" ng-click=\"vm.updateFlow(flow)\"></td></tr></table></div><div flex=\"20\" style=\"padding-top:60px\"><div id=\"gitGraph\"></div></div></md-content></md-tab-content><md-tab label=\"基础信息\"><md-tab-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"vm.data.Name\"></md-input-container></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.ClickSaveleft(vm.data)\" class=\"md-primary md-raised\">保存</md-button></div></md-tab-content></md-tab></md-tab></md-tabs>");
$templateCache.put("app/main/plan/component/plan-task-measureInfo.html","<md-dialog><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>关联项选择</span></h2><span flex=\"\"></span></div></md-toolbar><md-dialog-content style=\"padding: 0;width:400px;\"><div ng-if=\"!vm.loadMeasure\">loading...</div><div><md-tabs md-dynamic-height=\"\" ng-if=\"vm.loadMeasure\"><md-tab label=\"关联工序\"><md-content layout=\"column\" style=\"background-color: rgb(245,245,245)\" flex=\"\" class=\"p-15\"><md-input-container md-no-float=\"\"><input type=\"text\" ng-model=\"vm.searchT\" placeholder=\"搜索工序\"></md-input-container><div layout=\"row\" class=\"mb-10\"><span>已选工序</span><span flex=\"\"></span><md-icon md-font-icon=\"icon-close\" ng-click=\"vm.clrChoose()\" ng-if=\"vm.gxName\"></md-icon></div><div layout=\"row\" style=\"color:#999;\">{{vm.gxName}}</div><div><md-list flex=\"\" ng-if=\"vm.proceduresData.length\" class=\"ph-16\"><md-list-item ng-class=\"{\'gxselected\':vm.current ==ac}\" layout=\"row\" flex=\"\" ng-repeat=\"ac in vm.proceduresData|filter:vm.searchT\" ng-click=\"vm.choose(ac)\"><div flex=\"\" style=\"white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{ac.AcceptanceItemName}}</div></md-list-item></md-list></div></md-content></md-tab></md-tabs></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-click=\"vm.select(selectedIndex)\" class=\"md-raised\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/plan/component/plan-task-mini.html","<md-dialog aria-label=\"添加下级任务\"><form ng-cloak=\"\"><md-toolbar><div class=\"md-toolbar-tools\"><h2>添加下级任务</h2><span flex=\"\"></span></div></md-toolbar><md-dialog-content><div style=\"width: 500px\"><form><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"data.Name\" md-autofocus=\"\"></md-input-container><md-input-container class=\"md-block\"><label>变量名</label> <input type=\"text\" ng-model=\"data.Variable\"></md-input-container><md-input-container class=\"md-block\"><label>工期</label> <input type=\"text\" ng-model=\"data.Duration\"></md-input-container><md-input-container class=\"md-block\"><label>分类</label><task-categories ng-model=\"data.Type\"></task-categories></md-input-container></form></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-click=\"cancel()\">取消</md-button><span flex=\"\"></span><md-button ng-click=\"hide()\">添加</md-button></md-dialog-actions></form></md-dialog>");
$templateCache.put("app/main/plan/component/plan-task-roles.html","<md-dialog><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>角色选择</span></h2><span flex=\"\"></span><md-button ng-if=\"vm.current !=\'add\'\" class=\"md-icon-button\" aria-label=\"More\" ng-click=\"vm.current=\'add\'\"><md-icon md-font-icon=\"icon-plus\"></md-icon></md-button><md-button ng-if=\"vm.current ==\'add\'\" class=\"md-icon-button\" ng-click=\"vm.current =\'default\'\"><md-icon md-font-icon=\"icon-keyboard-return\"></md-icon></md-button></div></md-toolbar><md-dialog-content style=\"padding: 0;min-width: 300px;\"><div ng-switch=\"vm.current\"><div ng-switch-default=\"\"><md-list><md-list-item ng-repeat=\"item in vm.nextUserGroups\"><md-checkbox ng-model=\"item.selected\"></md-checkbox><div class=\"md-list-item-text\">{{item.GroupName}}</div><md-divider></md-divider></md-list-item></md-list></div><div ng-switch-when=\"add\" layout-padding=\"15\"><md-input-container class=\"md-block\"><label>角色名字</label> <input type=\"text\" ng-model=\"vm.dataName\" md-autofocus=\"\"></md-input-container></div></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-if=\"vm.current !=\'add\'\" ng-click=\"vm.select()\" class=\"md-raised\">确定</md-button><md-button ng-if=\"vm.current ==\'add\'\" ng-click=\"vm.add()\" class=\"md-raised\">添加</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/plan/component/plan-task-subs.html","<md-dialog><md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>任务选择</span></h2><task-categories ng-if=\"vm.current !=\'add\'\" data=\"vm.categories\" ng-model=\"vm.selectedCategory\" style=\"font-size:13px;\"></task-categories><span flex=\"\"></span><md-button ng-if=\"vm.current !=\'add\'\" class=\"md-icon-button\" aria-label=\"More\" ng-click=\"vm.add(\'add\')\"><md-icon md-font-icon=\"icon-plus\"></md-icon></md-button><md-button ng-if=\"vm.current ==\'add\'\" class=\"md-icon-button\" ng-click=\"vm.add(\'default\')\"><md-icon md-font-icon=\"icon-keyboard-return\"></md-icon></md-button></div></md-toolbar><md-dialog-content style=\"padding: 10px;min-width:400px;width:auto;\"><div ng-switch=\"vm.current\"><div ng-switch-default=\"\"><table class=\"simple\"><thead><tr><th>选择</th><th>名称</th><th>工期</th><th>工期类型</th><th>龄期</th></tr></thead><tbody><tr ng-repeat=\"item in vm.items|filter:{Type:vm.selectedCategory}\"><td><md-checkbox class=\"mv-5\" ng-model=\"item.selected\" aria-label=\"选择\"></md-checkbox></td><td class=\"name\">{{item.Name}}</td><td class=\"time\">{{item.Duration}}</td><td>{{item.DurationType==\'0\'?\'固定工期\':\'比例工期\'}}</td><td class=\"time\">{{item.ReservedEndDays}}</td></tr></tbody></table></div><div ng-switch-when=\"add\" layout-padding=\"15\"><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"vm.data.Name\" md-autofocus=\"\"></md-input-container><md-input-container class=\"md-block\"><label>工期</label> <input type=\"text\" ng-model=\"vm.data.Duration\"></md-input-container><md-input-container class=\"md-block\"><label>工期类型</label><md-select ng-model=\"vm.data.DurationType\"><md-option value=\"FixedDuration\">固定工期</md-option><md-option value=\"VariableDuration\">比例工期</md-option></md-select></md-input-container><div class=\"h-10\"></div><md-input-container class=\"md-block\"><label>龄期</label> <input type=\"text\" ng-model=\"vm.data.ReservedEndDays\"></md-input-container><md-input-container class=\"md-block\"><label>分类</label><task-categories ng-model=\"vm.data.Type\"></task-categories></md-input-container></div></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button ng-show=\"vm.current!=\'add\'\" class=\"md-raised\" ng-click=\"vm.select()\">确定</md-button><md-button ng-show=\"vm.current==\'add\'\" class=\"md-raised\" ng-click=\"vm.submit()\">添加</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/plan/component/plan-task-v.html","<md-tabs md-border-bottom=\"\" flex=\"\" layout=\"column\"><md-tab label=\"任务流程\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"row\"><md-content layout=\"row\" flex=\"\" ms-scroll=\"\"><div flex=\"100\" layout=\"row\" layout-align=\"center start\" class=\"mt-20\" ng-show=\"vm.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div><div flex=\"80\" ng-show=\"!vm.loading\"><div class=\"white-placeholder\" style=\"display: none;\"><input type=\"text\"></div><table class=\"simple\"><thead><tr><th>流程</th><th style=\"width: 24px;min-width: 24px\"><md-menu ng-show=\"vm.flows && vm.flows.length===0\"><span aria-label=\"任务流程\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event)\"><md-icon md-font-icon=\"icon-plus\" ng-click=\"$mdOpenMenu($event)\"></md-icon></span><md-menu-content><md-menu-item><md-button ng-click=\"vm.addNext($event)\">添加主线</md-button></md-menu-item></md-menu-content></md-menu></th><th style=\"width: 24px;min-width: 24px\" ng-if=\"vm.data.Level !=0\">必须完成</th><th style=\"width: 24px;min-width: 24px\" ng-if=\"vm.data.Level !=0\">手工关闭</th><th ng-if=\"vm.data.Level==1\" style=\"width: 30px;min-width: 24px\">工期</th><th ng-if=\"vm.data.Level==1\" style=\"width: 124px;min-width: 124px\">关联项</th><th style=\"width: 60px;min-width: 60px\">通知</th><th style=\"width: 60px;min-width: 60px\">执行</th></tr></thead><tr ng-repeat=\"flow in vm.flows\" style=\"height:44px;\"><td ng-style=\"{\'padding-left\':(10+(flow.line===0?0:1)*12)+\'px\'}\">{{$index+1}}、<input type=\"text\" ng-blur=\"vm.updateFlowName(flow)\" ng-model=\"flow.Name\"></td><td><md-menu><span aria-label=\"添加\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event);vm.setBack(flow)\"><md-icon md-font-icon=\"icon-plus\"></md-icon></span><md-menu-content><md-menu-item ng-if=\"(vm.data.Level!==0 || flow.line===0)&&!flow.isChuancha\"><md-button ng-click=\"vm.addNext($event,flow)\">下一主线</md-button></md-menu-item><md-menu-item ng-if=\"(vm.data.Level!==0 || flow.line===0)&&!flow.isChuancha && !flow.root\"><md-button ng-click=\"vm.addNext($event,flow,true)\">添加分支</md-button></md-menu-item><md-menu-item ng-if=\"(vm.data.Level!==0 || flow.line===0)&&!flow.isChuancha && !flow.root\"><md-button ng-click=\"vm.addBranch($event,flow,true)\">添加穿插</md-button></md-menu-item><md-menu-item ng-if=\"flow.line!==0&&!flow.isChuancha\"><md-menu><md-button style=\"margin:0;padding: 0 16px;height: 48px\" ng-click=\"$mdOpenMenu()\">后置任务</md-button><md-menu-content><md-menu-item ng-if=\"flow.EndFlagTaskFlowId\"><md-button ng-click=\"vm.setEndFlow(flow)\">清除后置</md-button></md-menu-item><md-menu-item ng-repeat=\"f2 in vm.flows|filter:{showBack:true}\"><md-button ng-click=\"vm.setEndFlow(flow,f2)\">{{f2.Name}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-item ng-if=\"!flow.root\"><md-button ng-click=\"vm.removeFlow($event,flow)\">删除节点</md-button></md-menu-item></md-menu-content></md-menu></td><td ng-if=\"vm.data.Level !=0\"><input type=\"checkbox\" ng-if=\"!flow.isChuancha && !flow.root\" ng-model=\"flow.IsMustComplete\" ng-click=\"vm.updateMust(flow)\"></td><td ng-if=\"vm.data.Level !=0\"><input type=\"checkbox\" ng-model=\"flow.ManuallyClose\" ng-if=\"!flow.root\" ng-click=\"vm.updateManuallyClose(flow)\"></td><td ng-if=\"vm.data.Level==1\"><input type=\"text\" ng-if=\"!flow.isChuancha && !flow.root\" style=\"width:25px\" placeholder=\"无\" ng-model=\"flow.Duration\" ng-blur=\"vm.updateDuration(flow)\"></td><td ng-if=\"vm.data.Level==1\"><div ng-if=\"!flow.isChuancha&&!flow.root\" style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.setMeasureInfo(flow)\">{{flow.MeasureInfo||\'未关联\'}}<md-icon md-font-icon=\"\"></md-icon></div></td><td><div ng-if=\"!flow.root\" style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,7)\">{{flow.Notice7||\'未选择\'}}</div></td><td><div ng-if=\"!flow.root\" style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,8)\">{{flow.Notice8||\'未选择\'}}</div></td></tr></table></div><div flex=\"20\" style=\"padding-top:60px\"><div id=\"gitGraph\"></div></div></md-content></md-tab-content><md-tab label=\"基础信息\"><md-tab-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><md-input-container><label>级别</label><md-select ng-model=\"vm.data.Level\"><md-option ng-value=\"1\">三级</md-option></md-select></md-input-container><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"vm.data.Name\"></md-input-container><md-input-container class=\"md-block\" ng-if=\"vm.data.Level !=0\"><label>工期</label> <input type=\"text\" ng-model=\"vm.data.Duration\"></md-input-container><md-input-container class=\"md-block mb-40\" ng-if=\"vm.data.Level !=0\"><label>工期类型</label><md-select ng-model=\"vm.data.DurationType\"><md-option value=\"FixedDuration\">固定工期</md-option><md-option value=\"VariableDuration\">比例工期</md-option></md-select></md-input-container><md-input-container class=\"md-block\"><label>模板</label><md-select style=\"font-size:13px;margin-right:20px;\" ng-model=\"vm.data.TemplateId\"><md-option ng-value=\"temp.Id\" ng-repeat=\"temp in vm.tempDatas\">{{temp.Name}}</md-option></md-select></md-input-container><md-checkbox ng-model=\"vm.data.ManuallyClose\" aria-label=\"手工关闭\" ng-if=\"vm.data.Level !=0\">手工关闭</md-checkbox><div ng-if=\"vm.data.Level!=0\" ng-hide=\"true\"><md-input-container class=\"md-block nomargin\"><label>分类</label><task-categories ng-model=\"vm.data.Type\"></task-categories></md-input-container><md-input-container class=\"md-block\"><label>变量名</label> <input type=\"text\" ng-model=\"vm.data.Variable\"></md-input-container><md-input-container class=\"md-block\"><label>工期</label> <input type=\"text\" ng-model=\"vm.data.Duration\"></md-input-container><md-input-container class=\"md-block\"><label>关联项选择</label><md-select flex=\"\" class=\"md-block\" ng-model=\"vm.data.CloseRelatedObjectType\" placeholder=\"关联项选择\"><md-option ng-value=\"p.type\" ng-repeat=\"p in vm.relationTypes\">{{p.name}}</md-option></md-select></md-input-container><div layout=\"row\" flex=\"\"><div flex=\"\" ng-click=\"vm.selectProcedure()\" ng-if=\"vm.data.CloseRelatedObjectType == \'Inspection\'\"><md-input-container layout=\"row\" flex=\"\"><label>关联工序</label> <input ng-model=\"vm.gxNames\" disabled=\"\"></md-input-container></div><md-input-container flex=\"\" ng-if=\"vm.data.CloseRelatedObjectType == \'PQMeasure\'\"><label>关联实测项</label><md-select ng-model=\"vm.data.CloseRelatedObjectId\" placeholder=\"关联实测项\" flex=\"\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"></md-input-container></md-select-header><md-optgroup><md-option ng-value=\"m.AcceptanceItemID\" ng-repeat=\"m in vm.measureInfo | filter:searchTerm\">{{m.MeasureItemName}}</md-option></md-optgroup></md-select></md-input-container></div></div></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.ClickSaveleft(vm.data)\" class=\"md-primary md-raised\">保存</md-button></div></md-tab-content></md-tab></md-tab></md-tabs>");
$templateCache.put("app/main/plan/component/plan-task.html","<md-tabs md-border-bottom=\"\" flex=\"\" layout=\"column\"><md-tab label=\"基础信息\"><md-tab-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"vm.data.Name\"></md-input-container><div ng-if=\"vm.data.Level!==0\"><md-input-container class=\"md-block nomargin\"><label>分类</label><task-categories ng-model=\"vm.data.Type\"></task-categories></md-input-container><md-input-container class=\"md-block\"><label>变量名</label> <input type=\"text\" ng-model=\"vm.data.Variable\"></md-input-container><md-input-container class=\"md-block\"><label>工期</label> <input type=\"text\" ng-model=\"vm.data.Duration\"></md-input-container><md-input-container class=\"md-block\"><label>关联项选择</label><md-select flex=\"\" class=\"md-block\" ng-model=\"vm.data.CloseRelatedObjectType\" placeholder=\"关联项选择\"><md-option ng-value=\"p.type\" ng-repeat=\"p in vm.relationTypes\">{{p.name}}</md-option></md-select></md-input-container><div layout=\"row\" flex=\"\"><div flex=\"\" ng-click=\"vm.selectProcedure()\" ng-if=\"vm.data.CloseRelatedObjectType == \'Inspection\'\"><md-input-container layout=\"row\" flex=\"\"><label>关联工序</label> <input ng-model=\"vm.gxNames\" disabled=\"\"></md-input-container></div><md-input-container flex=\"\" ng-if=\"vm.data.CloseRelatedObjectType == \'PQMeasure\'\"><label>关联实测项</label><md-select ng-model=\"vm.data.CloseRelatedObjectId\" placeholder=\"关联实测项\" flex=\"\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"></md-input-container></md-select-header><md-optgroup><md-option ng-value=\"m.AcceptanceItemID\" ng-repeat=\"m in vm.measureInfo | filter:searchTerm\">{{m.MeasureItemName}}</md-option></md-optgroup></md-select></md-input-container></div><md-checkbox ng-model=\"vm.data.ManuallyClose\" ng-if=\"vm.data.Level!==0\" aria-label=\"手工关闭\">手工关闭</md-checkbox></div></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.ClickSaveleft(vm.data)\" class=\"md-primary md-raised\">保存</md-button></div></md-tab-content></md-tab><md-tab label=\"任务流程\" ng-disabled=\"!vm.data.TaskLibraryId\" md-on-select=\"vm.onLoadTemplate()\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"row\"><md-content layout=\"column\" class=\"md-padding\" flex=\"\" ms-scroll=\"\"><canvas id=\"gitGraph\"></canvas></md-content><md-sidenav layout=\"column\" class=\"md-sidenav-right md-whiteframe-4dp white-bg\" style=\"max-width: 600px;width:600px\" md-component-id=\"right\"><md-tabs md-border-bottom=\"\" flex=\"\"><md-tab label=\"流程信息\" ng-disabled=\"!vm.current\"><md-tab-content layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>名称</label> <input type=\"text\" ng-model=\"vm.current.Name\" md-autofocus=\"\"></md-input-container><div layout=\"row\"><md-checkbox ng-model=\"vm.current.IsRequired\">必选</md-checkbox><md-checkbox ng-model=\"vm.current.IsFloor\" ng-if=\"vm.data.Level===0\">此节点对应楼层</md-checkbox><md-checkbox ng-model=\"vm.current.Memorial\">里程碑</md-checkbox></div><div layout=\"row\" ng-if=\"vm.current.Memorial\"><md-input-container class=\"mb-0\" flex=\"\"><label>里程碑名称</label> <input type=\"text\" ng-model=\"vm.current.MemorialName\"></md-input-container><span flex=\"5\"></span><md-input-container flex=\"\" class=\"mb-0\"><label>百分比</label> <input type=\"text\" ng-model=\"vm.current.Percentage\"></md-input-container></div><div layout=\"row\" class=\"nomar\"><task-categories flex=\"\" ng-model=\"vm.selectedCategory\"></task-categories><span flex=\"5\"></span><md-select flex=\"\" ng-model=\"vm.saveTasks\" placeholder=\"备选任务\" class=\"md-block\" md-on-open=\"vm.getNextTasks()\" multiple=\"\" md-on-close=\"vm.saveSubTasks()\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"vm.searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"><md-icon md-font-icon=\"icon-plus\" style=\"display:inline-block;\" ng-click=\"vm.addSubTask()\"></md-icon></md-input-container></md-select-header><md-option ng-value=\"tk.TaskLibraryId\" ng-selected=\"tk.selected\" ng-repeat=\"tk in vm.nextTasks|filter:{Name:vm.searchTerm,Type:vm.selectedCategory}\">{{tk.Name}}</md-option></md-select></div><md-select ng-model=\"vm.saveNotice7\" placeholder=\"通知\" class=\"md-block\" md-on-open=\"vm.getUsers()\" multiple=\"\" md-on-close=\"vm.saveUserGroup(\'7\')\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"><md-icon md-font-icon=\"icon-plus\" style=\"display:inline-block;\" ng-click=\"vm.addRole(1)\"></md-icon></md-input-container></md-select-header><md-option ng-value=\"g.GroupID\" ng-selected=\"g.selected7\" ng-repeat=\"g in vm.nextUserGroups|filter:searchTerm\">{{g.GroupName}}</md-option></md-select><md-select ng-model=\"vm.saveNotice8\" placeholder=\"执行\" class=\"md-block\" md-on-open=\"vm.getUsers()\" multiple=\"\" md-on-close=\"vm.saveUserGroup(\'8\')\"><md-select-header class=\"sxt-select-header\"><md-input-container md-no-float=\"\" class=\"md-block\"><input ng-keydown=\"vm.stop($event)\" type=\"search\" name=\"search\" ng-model=\"searchTerm\" class=\"md-text\" placeholder=\"输入关键字\"><md-icon md-font-icon=\"icon-plus\" style=\"display:inline-block;\" ng-click=\"vm.addRole(3)\"></md-icon></md-input-container></md-select-header><md-option ng-value=\"g.GroupID\" ng-selected=\"g.selected8\" ng-repeat=\"g in vm.nextUserGroups|filter:searchTerm\">{{g.GroupName}}</md-option></md-select></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.save()\" class=\"md-primary md-raised md-mini\">保存</md-button><md-button ng-click=\"vm.remove()\" class=\"md-warn md-raised md-mini\">删除</md-button></div></md-tab-content></md-tab><md-tab label=\"添加下一流程\" ng-disabled=\"vm.current && vm.current.hasNext\"><md-tab-content layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>下一流程名称</label> <input type=\"text\" ng-model=\"vm.next.Name\" md-autofocus=\"\"></md-input-container></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.nextSave()\" class=\"md-primary md-raised md-mini\">添加</md-button></div></md-tab-content></md-tab><md-tab label=\"添加分支\"><md-tab-content layout-padding=\"\"><form><md-input-container class=\"md-block\"><label>分支流程名称</label> <input type=\"text\" ng-model=\"vm.branch.Name\" md-autofocus=\"\"></md-input-container></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.nextBranch()\" class=\"md-primary md-raised md-mini\">添加</md-button></div></md-tab-content></md-tab></md-tabs></md-sidenav></md-tab-content></md-tab></md-tabs><md-sidenav id=\"gx_nav\" layout=\"column\" style=\"min-width: 80%\" class=\"md-sidenav-right md-whiteframe-4dp\" md-component-id=\"gx_nav\"><div flex=\"\" layout=\"column\" style=\"border-top: 1px solid #f5f5f9\"><md-tabs md-border-bottom=\"\" flex=\"\" style=\"background-color:white\"><md-tab ng-repeat=\"gx1 in vm.procedures\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"column\"><div flex=\"\" layout=\"row\"><div flex=\"40\" style=\"position: relative\" ms-scroll=\"\" layout=\"column\"><md-list style=\"margin-left:8px\"><md-list-item ng-click=\"vm.selectSpecialtyLow(item,gx1)\" layout=\"row\" ng-repeat=\"item in gx1.SpecialtyChildren\"><p>{{item.SpecialtyName}}</p></md-list-item></md-list></div><md-list flex=\"\" style=\"box-shadow:-1px 0px 15px 0 #d8d8d8\"><md-list-item layout=\"row\" ng-repeat=\"item in gx1.WPAcceptanceList\" ng-click=\"vm.choosego(item)\"><p flex=\"\">{{item.AcceptanceItemName}}{{item.checked}}</p></md-list-item></md-list></div></md-content></md-tab-content></md-tab></md-tabs></div></md-sidenav>");
$templateCache.put("app/main/plan/component/plan-tasks.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools tasks-list\"><h2><span>任务管理</span></h2><span flex=\"5\"></span><md-select style=\"font-size:13px;margin-right:20px;\" ng-model=\"vm.selectedMoban\" placeholder=\"请选择模板\"><md-option ng-value=\"temp.Id\" ng-repeat=\"temp in vm.tempDatas\">{{temp.Name}}</md-option></md-select><task-categories ng-model=\"vm.selectedCategory\" style=\"font-size:13px;\"></task-categories><span flex=\"\"></span><div class=\"white-placeholder\" style=\"border:1px solid rgb(245,245,245);border-radius:14px;padding:0 5px;\"><md-icon md-font-icon=\"icon-magnify\"></md-icon><input placeholder=\"搜索\" ng-model=\"vm.search\" style=\"color:rgb(245,245,245);padding:4px;font-size:13px;background: transparent;outline: 0;border:none;\"></div><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.plan.task.detail({id:\'add\'})\"></md-icon></md-button></div></md-toolbar><md-content layout=\"column\" flex=\"\" ms-scroll=\"\" layout-padding=\"15\"><table class=\"simple\"><thead><tr><th>名称</th><th ng-if=\"vm.selectedFilter!=0\">变量</th><th ng-if=\"vm.selectedFilter != 0\">工期</th><th>预留开始</th><th>预留结束</th><th style=\"width: 200px\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-if=\"!vm.loading\"><td colspan=\"6\"><div layout=\"row\" layout-align=\"center center\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div></td></tr><tr ng-if=\"vm.loading\" ng-repeat=\"item in vm.items|filter:{Type:vm.selectedCategory}|filter:vm.search\"><td class=\"name\">{{item.Name}}</td><td class=\"time\" ng-if=\"vm.selectedFilter!=0\">{{item.Variable}}</td><td class=\"time\" ng-if=\"vm.selectedFilter != 0\">{{item.Duration}}</td><td class=\"time\">{{item.ReservedStartDays}}</td><td class=\"time\">{{item.ReservedEndDays}}</td><td class=\"actions\"><md-button ng-click=\"vm.Query(item)\" class=\"md-icon-button\" aria-label=\"编辑\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button ng-click=\"vm.copyTaskLib(item)\" class=\"md-icon-button\" aria-label=\"复制\" title=\"复制\"><md-icon md-font-icon=\"icon-content-copy\" class=\"icon s24\"></md-icon></md-button><md-button ng-click=\"vm.Delete(item)\" class=\"md-icon-button\" aria-label=\"删除\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content>");
$templateCache.put("app/main/plan/component/plan-template-new.html","<md-tabs md-border-bottom=\"\" flex=\"\" layout=\"column\"><md-tab label=\"任务流程\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"row\"><md-content layout=\"row\" flex=\"\" ms-scroll=\"\"><div flex=\"100\" layout=\"row\" layout-align=\"center start\" class=\"mt-20\" ng-show=\"vm.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div><div flex=\"80\" ng-show=\"!vm.loading\"><div class=\"white-placeholder\" style=\"display: none;\"><input type=\"text\"></div><table class=\"simple\"><thead><tr><th>流程</th><th style=\"width: 24px;min-width: 24px\"><md-menu ng-show=\"vm.flows && vm.flows.length===0\"><span aria-label=\"任务流程\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event)\"><md-icon md-font-icon=\"icon-plus\" ng-click=\"$mdOpenMenu($event)\"></md-icon></span><md-menu-content><md-menu-item><md-button ng-click=\"vm.addNext($event,null, vm.flows.length)\">添加主线</md-button></md-menu-item></md-menu-content></md-menu></th><th ng-if=\"vm.data.Level==0\" style=\"width: 24px;min-width: 24px\">必选</th><th style=\"width: 24px;min-width: 24px\" ng-if=\"vm.data.Level==0\">变量</th><th ng-if=\"vm.data.Level==0\" style=\"width: 80px;min-width: 80px\">可选任务</th><th style=\"width: 60px;min-width: 60px\">通知</th><th style=\"width: 60px;min-width: 60px\">执行</th><th ng-if=\"vm.data.Level==0\" style=\"width: 110px;min-width: 110px\">里程碑/介入点</th><th ng-if=\"vm.data.Level==0\" style=\"width: 24px;min-width: 24px\">楼层</th></tr></thead><tr ng-repeat=\"flow in vm.flows track by flow.TaskFlowId\" style=\"height:44px;\"><td ng-style=\"{\'padding-left\':(10+(flow.line===0?0:1)*12)+\'px\'}\" style=\"white-space: nowrap;\">{{$index+1}}、<input type=\"text\" ng-blur=\"vm.updateFlowName(flow)\" ng-model=\"flow.Name\"></td><td><md-menu><span aria-label=\"添加\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event);vm.setBack(flow)\"><md-icon md-font-icon=\"icon-plus\"></md-icon></span><md-menu-content><md-menu-item ng-if=\"vm.data.Level!==0 || flow.line===0\"><md-button ng-click=\"vm.addNext($event,flow)\">下一主线</md-button></md-menu-item><md-menu-item ng-if=\"vm.data.Level!==0 || flow.line===0\"><md-button ng-click=\"vm.addNext($event,flow,true)\">添加分支</md-button></md-menu-item><md-menu-item ng-if=\"flow.line!==0\"><md-menu><md-button style=\"margin:0;padding: 0 16px;height: 48px\" ng-click=\"$mdOpenMenu()\">后置任务</md-button><md-menu-content><md-menu-item ng-if=\"flow.EndFlagTaskFlowId\"><md-button ng-click=\"vm.setEndFlow(flow)\">清除后置</md-button></md-menu-item><md-menu-item ng-repeat=\"f2 in vm.flows|filter:{showBack:true}\"><md-button ng-click=\"vm.setEndFlow(flow,f2)\">{{f2.Name}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-item><md-button ng-click=\"vm.removeFlow($event,flow)\">删除节点</md-button></md-menu-item></md-menu-content></md-menu></td><td ng-if=\"vm.data.Level==0\" align=\"center\"><input ng-if=\"flow.line==0\" type=\"checkbox\" ng-model=\"flow.IsRequired\" ng-click=\"vm.updateFlow(flow)\"></td><td ng-if=\"vm.data.Level == 0\"><input ng-if=\"flow.line==0\" style=\"width:90%;color:#C62828\" placeholder=\"无\" type=\"text\" ng-blur=\"vm.updateExpression(flow)\" ng-model=\"flow.Expression\"></td><td ng-if=\"vm.data.Level==0\"><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectOptionalTask(flow)\">{{flow.OptionalTask||\'未选择\'}}</div></td><td><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,7)\">{{flow.Notice7||\'未选择\'}}</div></td><td><div style=\"white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;\" ng-click=\"vm.selectUsers(flow,8)\">{{flow.Notice8||\'未选择\'}}</div></td><td ng-if=\"vm.data.Level==0\"><input ng-show=\"!flow.IsFloor\" ng-if=\"flow.line===0\" style=\"width: 90%\" placeholder=\"无里程碑\" type=\"text\" ng-blur=\"vm.updateMilestone(flow)\" ng-model=\"flow.Milestone\"> <span ng-if=\"flow.line!==0\"><input style=\"width:100%;color:#C62828\" placeholder=\"无介入点\" type=\"text\" ng-blur=\"vm.updateExpression(flow)\" ng-model=\"flow.Expression\"></span></td><td ng-if=\"vm.data.Level==0\" align=\"center\"><input ng-if=\"flow.line===0\" type=\"checkbox\" ng-model=\"flow.IsFloor\" ng-click=\"vm.updateFlow(flow)\"></td></tr></table></div><div flex=\"20\" style=\"padding-top:60px\"><div id=\"gitGraph\"></div></div></md-content></md-tab-content><md-tab label=\"基础信息\"><md-tab-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><div layout=\"row\" flex=\"\" class=\"create-plan\"><md-input-container class=\"md-block\" flex=\"\"><label>名 称</label> <input type=\"text\" ng-model=\"vm.dataTemp.Name\" md-autofocus=\"\"></md-input-container></div><div layout=\"row\" flex=\"\"><md-input-container class=\"md-block\" flex=\"\"><label>区 域</label><md-select ng-model=\"vm.dataTemp.AreaId\" name=\"type\"><md-option ng-repeat=\"item in vm.AreaList\" ng-value=\"item.Value\">{{item.Text}}</md-option></md-select></md-input-container></div></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.ClickSave(vm.dataTemp)\" class=\"md-primary md-raised\">保存</md-button></div></md-tab-content></md-tab></md-tab></md-tabs>");
$templateCache.put("app/main/plan/component/plan-template.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>模板管理</span></h2><span flex=\"\"></span></div></md-toolbar><md-content flex=\"\" layout-fill=\"\" class=\"white-bg\" layout-padding=\"\"><form><div layout=\"row\" flex=\"\" class=\"create-plan\"><md-input-container class=\"md-block\" flex=\"\"><label>名 称</label> <input type=\"text\" ng-model=\"vm.data.Name\" md-autofocus=\"\"></md-input-container></div><div layout=\"row\" flex=\"\"><md-input-container class=\"md-block\" flex=\"\"><label>区 域</label><md-select ng-model=\"vm.data.AreaId\" name=\"type\"><md-option ng-repeat=\"item in vm.AreaList\" ng-value=\"item.Value\">{{item.Text}}</md-option></md-select></md-input-container></div></form><div layout=\"row\" flex=\"\"><md-button ng-click=\"vm.ClickSave(vm.data)\" class=\"md-primary md-raised\">保存</md-button></div></md-content>");
$templateCache.put("app/main/plan/component/plan-templates.html","<md-toolbar class=\"md-hue-2\"><div class=\"md-toolbar-tools\"><h2><span>模板管理</span></h2><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"More\"><md-icon md-font-icon=\"icon-plus\" ui-sref=\"app.plan.template.detail({id:\'add\'})\"></md-icon></md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\" ms-scroll=\"\" layout-padding=\"15\"><table class=\"simple\"><thead><tr><th>名称</th><th>时间</th><th style=\"width: 200px;\"><span class=\"pl-16\">管理</span></th></tr></thead><tbody><tr ng-repeat=\"item in vm.items\"><td class=\"name\">{{item.Name}}</td><td class=\"time\">{{item.CreationTime|date:\'yyyy-M-d\'}}</td><td class=\"actions\"><md-button ng-click=\"vm.Query(item)\" class=\"md-icon-button\" aria-label=\"编辑\" title=\"编辑\"><md-icon md-font-icon=\"icon-pencil\" class=\"icon s24\"></md-icon></md-button><md-button ng-click=\"vm.copyTemp(item)\" class=\"md-icon-button\" aria-label=\"复制\" title=\"复制\"><md-icon md-font-icon=\"icon-content-copy\" class=\"icon s24\"></md-icon></md-button><md-button ng-click=\"vm.Delete(item)\" class=\"md-icon-button\" aria-label=\"删除\" title=\"删除\"><md-icon md-font-icon=\"icon-delete\" class=\"icon s24\"></md-icon></md-button></td></tr></tbody></table></md-content><div layout=\"row\"><span flex=\"\"></span><md-select ng-model=\"pageing.pageSize\" class=\"pageSZ\"><md-option value=\"10\">10</md-option><md-option value=\"20\">20</md-option><md-option value=\"40\">40</md-option><md-option value=\"80\">80</md-option><md-option value=\"100\">100</md-option></md-select><div style=\"text-align: right;margin-right: 15px\" paging=\"\" page=\"pageing.page\" page-size=\"pageing.pageSize\" total=\"vm.total\" paging-action=\"vm.pageAction(\'bar\', page, pageSize, total)\"></div></div>");
$templateCache.put("app/main/plan/directives/plan-creating.html","<table class=\"simple\"><thead><tr><th style=\"width: 24px;min-width: 24px\">启用</th><th style=\"width: 120px;min-width: 120px\">流程</th><th>任务</th><th style=\"width: 120px;min-width: 120px\">工期</th><th style=\"width: 24px;min-width: 24px\">天数</th><th style=\"width: 80px;min-width: 80px\">开始日期</th><th style=\"width: 80px;min-width: 80px\">结束日期</th><th style=\"width: 24px;min-width: 24px; text-align: center\">上</th><th style=\"width: 24px;min-width: 24px; text-align: center\">下</th></tr></thead><tr class=\"mainbar\"><td colspan=\"9\">主线</td></tr><tr ng-class=\"{deleted:!flow.selected,milestone:!!flow.type,error:flow.show}\" ng-repeat=\"flow in flows track by flow.TaskFlowId\"><td ng-if=\"!flow.type\"><input ng-if=\"!flow.IsRequired\" ng-click=\"buildDate()\" type=\"checkbox\" ng-model=\"flow.selected\"></td><td ng-if=\"!flow.type\" ng-style=\"{\'padding-left\':10+(flow.line*12)+\'px\'}\">{{$index+1}}、{{flow.Name}}</td><td ng-if=\"!flow.type\"><md-menu><div ng-click=\"$mdOpenMenu($event)\"><span aria-label=\"添加\" class=\"md-icon-button\">{{flow.currentTask.Name}}</span><md-icon class=\"s24\" md-font-icon=\"icon-menu-down\"></md-icon></div><md-menu-content><md-menu-item ng-repeat=\"task in flow.OptionalTasks\"><md-button ng-click=\"setCurrent(flow,task)\">{{task.Name}}</md-button></md-menu-item></md-menu-content></md-menu></td><td ng-if=\"!flow.type\"><input type=\"text\" placeholder=\"工期\" ng-click=\"setVars(flow)\" ng-blur=\"buildDate(flow)\" ng-model=\"flow.currentTask.Duration\"></td><td ng-if=\"!flow.type\">{{flow.days}}</td><td ng-if=\"!flow.type\">{{flow.start && flow.start.format(\'YYYY-MM-DD\')}}</td><td ng-if=\"flow.type\" colspan=\"6\">{{flow.Name}}</td><td>{{flow.end && flow.end.format(\'YYYY-MM-DD\')}}</td><td><md-icon ng-if=\"!flow.type && !flow.IsFloor\" md-font-icon=\"icon-arrow-up\" ng-click=\"up(flow)\"></md-icon></td><td><md-icon ng-if=\"!flow.type && !flow.IsFloor\" md-font-icon=\"icon-arrow-down\" ng-click=\"down(flow)\"></md-icon></td></tr><tr class=\"mainbar\"><td colspan=\"9\">穿插</td></tr><tr ng-class=\"{deleted:!flow.selected}\" ng-repeat=\"flow in banchs track by flow.TaskFlowId\"><td colspan=\"3\">{{$index+1}}、{{flow.Name}}</td><td><input type=\"text\" ng-click=\"setVars(flow)\" ng-blur=\"buildDate()\" ng-model=\"flow.Expression\"></td><td>{{flow.days}}</td><td>{{flow.start && flow.start.format(\'YYYY-MM-DD\')}}</td><td>{{flow.end && flow.end.format(\'YYYY-MM-DD\')}}</td><td></td><td></td></tr></table>");
$templateCache.put("app/main/plan/directives/sxt-images2.html","<div class=\"imageEdit\" style=\"height:150px;width: 150px;margin:20px auto;\"><div class=\"edititem\" ng-if=\"img\"><img style=\"height:140px;margin:0 5px; width: 140px;\" src=\"{{img}}\" class=\"img-thumbnail\"><div class=\"text\" style=\"padding: 5px; text-align: right;\"><a style=\"cursor: pointer;font-size:12px;color:#333;\" ng-click=\"remove($event,img)\">删除</a></div></div><div ng-if=\"!img\"><div class=\"file-drop-zone\" style=\"height:140px;margin:0 5px;line-height:140px; padding:5px;\" nv-file-drop=\"\" uploader=\"uploader\"><input type=\"file\" nv-file-select=\"\" uploader=\"uploader\" multiple=\"\" ng-click=\"inputChange()\" ;=\"\"></div></div></div>");
$templateCache.put("app/main/plan/directives/taskCategories.html","<md-select ng-model=\"value\" placeholder=\"类别\"><md-option ng-value=\"\">所有</md-option><md-optgroup label=\"{{item.name}}\" ng-repeat=\"item in data\" ng-if=\"item.children && item.children.length\"><md-option value=\"{{it.name}}\" ng-repeat=\"it in item.children\">{{it.name}}</md-option></md-optgroup><md-optgroup label=\"其它\"><md-option ng-value=\"item.name\" ng-repeat=\"item in data\" ng-if=\"!item.children || !item.children.length\">{{item.name}}</md-option></md-optgroup></md-select>");
$templateCache.put("app/main/plan/directives/taskTable.html","<md-content flex=\"\" layout=\"column\" ms-scroll=\"\" ng-if=\"!tasks\"><table class=\"simple\"><thead><tr><th style=\"width: 20px\">序号</th><th style=\"width: 120px\">流程</th><th><span class=\"pl-16\">可选任务</span></th><th>工期</th><th><span class=\"pl-16\">操作</span></th></tr></thead><tbody><tr ng-repeat=\"task in data.template\" ng-class=\"{\'active\':task.selected}\"><td>{{$index+1}}</td><td>{{task.FullName || task.getFullName()}}</td><td><md-menu><md-button ng-click=\"$mdOpenMenu($event);\">{{task.selectedTask?task.selectedTask.Name:\'请选择\'}}<md-icon class=\"s24\" md-font-icon=\"icon-menu-down\"></md-icon></md-button><md-menu-content width=\"4\"><md-menu-item ng-repeat=\"op in (task.OptionalTasks||task.getOptionalTasks())\"><md-button ng-click=\"reloadTask(task,op);task.selectedTask = op\">{{op.Name}}</md-button></md-menu-item></md-menu-content></md-menu></td><td><label style=\"display: none;\">(公式={{getVars(task.selectedTask)}})</label><label style=\"position:relative;\"><input type=\"text\" style=\"border-bottom: 1px solid #dedede;width:50px;\" required=\"\" placeholder=\"工期值\" ng-model=\"task.selectedTask.eDuration\" ng-blur=\"batchDuration(task)\"><div style=\"position: absolute;left: 0;top:120%;font-size:12px;color:red;width:auto;background: #fff;white-space: nowrap;\" ng-show=\"task.show\">输入工期应大于基本工期80%</div></label> <span ng-repeat=\"v in vars\" ng-show=\"task.selectedTask\"><label>变量{{v.key}}值：</label> <input type=\"text\" style=\"border-bottom: 1px solid #dedede;width:50px;\" placeholder=\"变量值\" required=\"\" name=\"Duration\" ng-model=\"v.value\"></span></td><td><md-button class=\"md-icon-button\"><md-icon md-font-icon=\"icon-arrow-down\" ng-click=\"downDot(task)\"></md-icon></md-button><md-button class=\"md-icon-button\"><md-icon md-font-icon=\"icon-arrow-up\" ng-click=\"upDot(task)\"></md-icon></md-button><md-button class=\"md-icon-button\"><md-icon md-font-icon=\"icon-delete\" ng-if=\"!task.IsRequired\" ng-click=\"deleteDot(task)\"></md-icon></md-button></td></tr></tbody></table></md-content>");
$templateCache.put("app/navigation/layouts/horizontal-navigation/navigation.html","<div layout=\"row\" layout-align=\"start center\"><ms-navigation-horizontal></ms-navigation-horizontal></div>");
$templateCache.put("app/navigation/layouts/vertical-navigation/navigation.html","<md-toolbar class=\"navigation-header md-whiteframe-1dp\" layout=\"row\" layout-align=\"space-between center\"><div class=\"logo\" layout=\"row\" layout-align=\"start center\"><span class=\"logo-image\" style=\"background-color: transparent\"><img src=\"/assets/images/avatars/logo.png\"></span> <span class=\"logo-text\">星河大数据</span></div><md-icon class=\"fold-toggle s18\" md-font-icon=\"icon-backburger\" hide=\"\" show-gt-sm=\"\" ng-click=\"vm.toggleMsNavigationFolded()\"></md-icon></md-toolbar><ms-navigation class=\"scrollable\" folded=\"vm.folded\" ms-scroll=\"vm.msScrollOptions\"></ms-navigation>");
$templateCache.put("app/main/xhsc/center/changeTel.html","<md-dialog ng-cloak=\"\" style=\"max-width:50%;width:50%;\" class=\"changetel\"><md-dialog-content layout=\"row\"><div layout=\"column\" flex=\"\"><div layout=\"row\">电话号码</div><div layout=\"row\" flex=\"\"><md-input-container class=\"md-block\" flex=\"\"><input ng-model=\"tel\"></md-input-container></div></div></md-dialog-content><md-dialog-actions style=\"border-top:1px solid #d8d8d8;padding-top:0;padding-bottom:0;min-height: 40px;\"><a flex=\"50\" class=\"new-btn\" ng-click=\"cancel()\">取消</a> <a flex=\"\" class=\"new-btn noborder\" ng-click=\"submit(tel)\">确定</a></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/center/mcenter.html","<md-content flex=\"\"><md-list style=\"overflow: hidden;\" class=\"slide-del\" ng-repeat=\"item in vm.messages\"><md-list-item layout=\"row\" class=\"slideli\"><md-checkbox style=\"margin-right:0;\" ng-show=\"vm.showCheck\" ng-model=\"item.checked\"></md-checkbox><div class=\"slidelist\" layout=\"row\"><div class=\"circle\" flex=\"none\"><span>{{item.name}}</span></div><div flex=\"\"><h3 style=\"padding-right: 105px;\">{{item.title}}<span>{{item.time|date:\'MM-dd HH:mm\'}}</span></h3><p style=\"word-break: break-all;\">{{item.description}}</p></div></div><div style=\"position: absolute;right:-160px;top:0;height:100%;overflow: hidden;\"><md-button style=\"min-width:80px;height: 100%;background: #c8c7cd;color:#fff;padding:0;margin:0;font-size:0;-webkit-text-size-adjust:none;border-radius: 0;\"><img src=\"app/main/xhsc/images/plus.png\"><div style=\"font-size: 14px;\">更多</div></md-button><md-button style=\"min-width:81px;height: 100%;background: #ff3534;color:#fff;padding:0;margin:0;font-size:0;-webkit-text-size-adjust:none;border-radius:0;\"><img src=\"app/main/xhsc/images/plus.png\"><div style=\"font-size: 14px;\">删除</div></md-button></div></md-list-item></md-list></md-content>");
$templateCache.put("app/main/xhsc/center/message.html","<div flex=\"\" layout=\"column\"><md-virtual-repeat-container ng-show=\"!vm.sysMsg\" id=\"vertical-container\" class=\"slide-del\" flex=\"\"><div md-virtual-repeat=\"item in vm.dynamicItems\" class=\"repeat\" style=\"padding: 0px\" md-on-demand=\"\" flex=\"\"><md-list-item layout=\"row\" class=\"slideli\" ng-click=\"vm.action(item,$event)\" style=\"border-bottom: 0px solid\"><md-checkbox style=\"margin-right:0;\" ng-show=\"vm.showCheck\" ng-model=\"item.checked\"></md-checkbox><div class=\"slidelist\" layout=\"row\"><div class=\"circle\" flex=\"none\"><span style=\"background: #6ab1f3\">{{item.name}}</span></div><div class=\"my-md-hide\" flex=\"\"><h3>{{item.title}}<p style=\"margin: 0px\">{{item.time|date:\'MM-dd HH:mm\'}}</p></h3><p style=\"word-break: break-all;margin-top: 0px\">{{item.description}}</p></div><div flex=\"\" class=\"my-xs-hide\"><h3 style=\"padding-right: 105px;\">{{item.title}}<span>{{item.time|date:\'MM-dd HH:mm\'}}</span></h3><p style=\"word-break: break-all;\">{{item.description}}</p></div></div></md-list-item></div></md-virtual-repeat-container><md-virtual-repeat-container ng-show=\"vm.sysMsg\" id=\"vertical-container_\" class=\"slide-del\" flex=\"\"><div md-virtual-repeat=\"item in vm.sys_dynamicItems\" class=\"repeat\" style=\"padding: 0px\" md-on-demand=\"\" flex=\"\"><md-list-item layout=\"row\" class=\"slideli\" ng-click=\"vm.action(item,$event)\" style=\"border-bottom: 0px solid\"><md-checkbox style=\"margin-right:0;\" ng-show=\"vm.showCheck\" ng-model=\"item.checked\"></md-checkbox><div class=\"slidelist\" layout=\"row\"><div class=\"circle\" flex=\"none\"><span style=\"background: #6ab1f3\">{{item.name}}</span></div><div class=\"my-md-hide\" flex=\"\"><h3>{{item.title}}<p style=\"margin: 0px\">{{item.time|date:\'MM-dd HH:mm\'}}</p></h3><p style=\"word-break: break-all;margin-top: 0px\">{{item.description}}</p></div><div flex=\"\" class=\"my-xs-hide\"><h3 style=\"padding-right: 105px;\">{{item.title}}<span>{{item.time|date:\'MM-dd HH:mm\'}}</span></h3><p style=\"word-break: break-all;\">{{item.description}}</p></div></div></md-list-item></div></md-virtual-repeat-container></div>");
$templateCache.put("app/main/xhsc/center/pcIndexChoose.html","<md-dialog aria-label=\"Mango (Fruit)\" class=\"scchoose\" id=\"scchoose\"><md-toolbar><div class=\"md-toolbar-tools\"><h2>请选择测量项</h2><span flex=\"\"></span><md-button class=\"md-icon-button\" ng-disabled=\"getIsChecked()\" ng-click=\"ok(scList)\">确定</md-button></div></md-toolbar><md-dialog-content><md-list><md-list-item ng-repeat=\"sc in scList\" ng-click=\"checkSc(sc)\"><p ng-class=\"{\'red\':sc.checked}\">{{sc.IndexName}} {{sc.completed?\'(已完成)\':\'\'}}</p><md-switch class=\"md-secondary\" ng-model=\"sc.checked\"></md-switch><md-divider ng-if=\"!$last\"></md-divider></md-list-item></md-list></md-dialog-content></md-dialog>");
$templateCache.put("app/main/xhsc/center/pcenter.html","<md-tabs flex=\"\"><md-tab label=\"个人信息\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"></md-tab-content><div class=\"pcenter\"><md-list style=\"padding-top:0\"><md-list-item style=\"margin:0px;border: 0px solid\"><div class=\"md-list-item-text\" layout=\"row\" flex=\"\"><p style=\"width: 60px;text-align-last: justify\">姓名</p><p style=\"padding-left: 52px;letter-spacing:12px\">{{vm.user.name}}</p></div><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"margin:0px;border: 0px solid\"><div class=\"md-list-item-text\" layout=\"row\" flex=\"\"><p style=\"width: 60px;text-align-last: justify\">角色</p><p style=\"padding-left: 52px;letter-spacing:12px\" layout=\"row\">{{vm.user.role}}</p><span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item style=\"margin:0px;border: 0px solid\"><div class=\"md-list-item-text\" layout=\"row\" flex=\"\"><p style=\"width: 60px;text-align-last: justify\">手机号码</p><p style=\"padding-left: 52px\">{{vm.user.userName}}</p><span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item style=\"margin:0px;border: 0px solid\"><div class=\"md-list-item-text\" layout=\"row\" flex=\"\"><p style=\"width: 60px;text-align-last: justify\">当前版本</p><p style=\"padding-left: 52px\">{{ vm.serverAppVersion}}</p><span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><p>缓存</p><md-button class=\"md-secondary md-raised md-primary\" ng-click=\"vm.clearCache()\">清空</md-button></md-list-item><md-divider></md-divider></md-list><div flex=\"\"><md-button flex=\"\" style=\"display: block;width:100%;margin-left:0;margin-right:0;background:#fff;border:1px solid #d8d8d8;min-height:48px;line-height:48px;\" ng-click=\"vm.logout()\">退出登录</md-button></div></div></md-tab><md-tab label=\"消息中心\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"></md-tab-content></md-tab></md-tabs><my-dialog dialog-show=\"vm.showmyDialog\" dialog-sure=\"确定\" dialog-msg=\"确定退出登录\"></my-dialog>");
$templateCache.put("app/main/xhsc/center/pcenter_main.html","<div class=\"person_center\"><md-list><md-list-item><div layout=\"row\" ui-sref=\"app.xhsc.person\" flex=\"\" class=\"wrap\"><img style=\"display: inline-block;height: 24px;width: 24px;margin-right: 16px\" ng-src=\"app/main/xhsc/images/personal_data.svg\"> <span>个人资料</span> <span flex=\"\"></span> <img ng-src=\"app/main/xhsc/images/come_in.svg\"> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" ng-click=\"vm.scStandar()\" flex=\"\" class=\"wrap\"><img style=\"display: inline-block;height: 24px;width: 24px;margin-right: 16px\" ng-src=\"app/main/xhsc/images/current_vision.svg\"><span>实测标准化</span> <span flex=\"\"></span> <img ng-src=\"app/main/xhsc/images/come_in.svg\"> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" flex=\"\" class=\"wrap\"><img style=\"display: inline-block;height: 24px;width: 24px;margin-right: 16px\" ng-src=\"app/main/xhsc/images/current_vision.svg\"> <span>当前版本</span> <span flex=\"\"></span> <span style=\"color: #888\">{{ vm.serverAppVersion}}</span> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" ng-click=\"vm.resetPassword()\" flex=\"\" class=\"wrap\"><img style=\"display: inline-block;height: 14px;width: 14px;margin-right: 26px;position: relative;top:4px;left:4px;\" ng-src=\"app/main/auth/images/password.svg\"> <span>修改密码</span> <span flex=\"\"></span> <img ng-src=\"app/main/xhsc/images/come_in.svg\"> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" flex=\"\" ng-click=\"vm.logout()\" class=\"wrap\"><img style=\"display: inline-block;height: 24px;width: 24px;margin-right: 16px\" ng-src=\"app/main/xhsc/images/clear_cache.svg\"> <span>清除缓存</span> <span flex=\"\"></span> <img ng-src=\"app/main/xhsc/images/come_in.svg\"></div></md-list-item></md-list><div class=\"logout\" layout=\"row\" ng-click=\"vm.logout()\"><md-button flex=\"\">退出登录</md-button></div></div>");
$templateCache.put("app/main/xhsc/center/person.html","<div flex=\"\" class=\"person_center\" layout=\"column\"><md-list><md-list-item><div layout=\"row\" ng-click=\"vm.goPerson()\" ui-sref=\"app.xhsc.person\" flex=\"\" class=\"wrap\"><span style=\"color: #333;letter-spacing: 16px\">姓名</span> <span flex=\"\"></span> <span style=\"color: #888;font-size: 14px\">{{vm.user.name}}</span> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" ng-click=\"vm.logout()\" flex=\"\" class=\"wrap\"><span style=\"color: #333;letter-spacing: 16px\">部门</span> <span flex=\"\"></span> <span style=\"color: #888;font-size: 14px\">{{vm.user.OUName}}</span> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" ng-click=\"vm.logout()\" flex=\"\" class=\"wrap\"><span style=\"color: #333;letter-spacing: 16px\">角色</span> <span flex=\"\"></span> <span style=\"color: #888;font-size: 14px\">{{vm.user.role}}</span> <span class=\"border1px bottom1px\"></span></div></md-list-item><md-list-item><div layout=\"row\" flex=\"\" class=\"wrap\"><span style=\"color: #333;letter-spacing: 16px\">手机</span> <span flex=\"\"></span> <span style=\"color: #888;font-size: 14px\">{{vm.user.userName}}</span> <span class=\"border1px bottom1px\"></span></div></md-list-item></md-list></div>");
$templateCache.put("app/main/xhsc/center/projectlst.html","<md-dialog aria-label=\"正在下载\" flex=\"80%\" ng-cloak=\"\"><md-dialog-content><md-list><md-list-item ng-repeat=\"item in projects\"><div layout=\"row\" ng-click=\"go(item)\" flex=\"\" class=\"wrap\"><span>{{item.RegionName}}</span> <span flex=\"\"></span><md-icon md-svg-icon=\"app/main/xhsc/images/come_in.svg\"></md-icon><span class=\"border1px bottom1px\"></span></div></md-list-item></md-list></md-dialog-content></md-dialog>,");
$templateCache.put("app/main/xhsc/center/scPiclst.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs md-border-bottom=\"\" flex=\"\" ng-if=\"vm.show\"><md-tab ng-repeat=\"item in vm.scItems\" label=\"{{item.MeasureItemName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-input-container id=\"auto\" md-no-float=\"\" class=\"md-block\" style=\"margin-bottom: 0;margin-top: 6px;max-height: 36px\"><input ng-model=\"vm.searchKey\" type=\"text\" placeholder=\"关键字查找\"></md-input-container><md-virtual-repeat-container flex=\"\" layout=\"column\"><div md-virtual-repeat=\"d in item.pics |cnFilter:{DrawingName:vm.searchKey}\" class=\"repeat\" ng-click=\"vm.stretch(d)\" layout=\"column\" style=\"position: relative;margin:0px 3%\"><div layout=\"row\" style=\"line-height: 40px;\"><span style=\"font-size:14px;\">{{d.DrawingName}}</span> <span flex=\"\"></span><md-icon ng-class=\"{\'transform_90\':item.stretch}\" md-svg-icon=\"app/main/xhsc/images/come_in.svg\"></md-icon><span ng-if=\"item.stretch\" class=\"border1px bottom1px\"></span></div><md-list ng-if=\"d.stretch\" style=\"padding:0px;margin: 0px;\"><md-list-item ng-repeat=\"k in d.indexs\" layout=\"row\"><p ng-click=\"vm.click(k,$event)\" flex=\"\" style=\"font-size:12px;padding-left:1%\" layout=\"row\">{{k.IndexName}} <span ng-if=\"k.standar==\'completed\'\" style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">已完成</span> <span ng-if=\"k.standar==\'no\'\" style=\"margin-left:2%;color:white;background-color: #00b6de;font-size:12px;border-radius: 3px\">进行中</span></p><md-button ng-click=\"vm.action(k,$event)\" style=\"margin: 6px -28px\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div></md-virtual-repeat-container></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/center/sc_standar.html","<div layout=\"row\" class=\"scTop\" style=\"position: relative\"><div flex=\"\" class=\"scleft\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.scroll\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-if=\"vm.scroll\"><span>{{vm.title}}：</span><md-button class=\"md-mini\" ng-click=\"vm.scChoose($event)\"><label style=\"margin-bottom: 0;font-weight: normal;\"><span ng-repeat=\"sc in vm.selected\" style=\"color:#f00;\">{{sc.IndexName}}</span></label> <img src=\"app/main/xhsc/images/pop.png\" style=\"vertical-align: middle;margin-left: 10px;\"></md-button><span style=\"color:darkslategray;font-style: italic;\">{{vm.info.tooltip}}</span></div></div><md-button ng-if=\"!vm.show\" ng-click=\"vm.submit()\" style=\"position: absolute;right: 8px;top:0px;min-width: 50px;min-height: 50px;z-index: 999\" class=\"md-fab md-mini\">提交</md-button></div><sxt-sc-standar project-id=\"vm.info.projectId\" acceptance-item=\"vm.info.acceptanceItemID\" measure-indexes=\"vm.selected\" tooltip=\"\" drawing=\"vm.drawing\" flex=\"\"></sxt-sc-standar><div style=\"display: none\"><sxt-sc-standar-pop></sxt-sc-standar-pop></div>");
$templateCache.put("app/main/xhsc/center/standarRegion.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in vm.souce\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.RegionName}}</h2></div><md-list><md-list-item ng-repeat=\"b in m.Children\" style=\"float: left;width: 25%\"><md-button ui-sref=\"app.xhsc.scPiclst({projectID:b.RegionID})\"><p>{{b.RegionName}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/cycleLook/cycleLookAccept.html","<ms-gen-select flex=\"none\" areas=\"areas\" procedure=\"procedure\" current=\"current\" arear-id=\"vm.areaId\" level=\"4\"></ms-gen-select><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" xj-accept=\"vm.info.current\" inspection-id=\"vm.InspectionId\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\" gx=\"current.procedure\" img-id=\"vm.imgId\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><xj-accept-popup warter=\"vm.water\"></xj-accept-popup></div>");
$templateCache.put("app/main/xhsc/cycleLook/cycleLookBase.html","<div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">巡检复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/cycleLook/cycleLookMain.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" ng-if=\"vm.isOver&&vm.role==0||vm.role==32\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>巡检整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">巡检整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.isOver&&!(vm.role==0||vm.role==32)\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.create()\"><img src=\"app/main/xhsc/images/jlys.png\"><p>新建检查</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>巡检复查</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:12px;margin-bottom: 0px\"><span style=\"margin-left:1%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px;white-space: nowrap\">日常巡检</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display:inline-block;line-height:22px;padding-top: 8px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">巡检复查</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/cycleLook/cycleLookRectify.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" points=\"vm.points\" flex=\"\" xj-recheck=\"\" ct=\"vm.info\" inspection-id=\"vm.InspectionID\" procedure=\"vm.Rectification.AcceptanceItemID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\" sxt-map-show=\"vm.slideShow\" info=\"vm.regionSelect\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div><xj-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></xj-recheck-popup>");
$templateCache.put("app/main/xhsc/directive/listUp.html","<div style=\"position: fixed;top: 0;left: 0;right:0;bottom:0;background: rgba(0,0,0,.5);z-index: 20;\" ng-if=\"upShow\" id=\"quesUp\"></div><div class=\"slideTop\" ng-class=\"{\'slidedown\':upShow}\"><div class=\"gxtest gxtestdetail\" flex=\"\"><md-list class=\"gxque\" style=\"margin-top:0;\"><md-list-item ng-repeat=\"k in ques | orderBy:\'ProblemSortName\'\"><span flex=\"\" style=\"padding-left:8px;\">{{k.ProblemDescription}}</span> <span flex=\"none\" style=\"text-align: right;padding-right:8px\">{{k.Points}}处</span></md-list-item></md-list></div><div flex=\"\" style=\"border-bottom: 1px solid #dedede;height: 48px;line-height: 48px;text-align: center;\" ng-click=\"submit()\">确定</div></div>");
$templateCache.put("app/main/xhsc/directive/mydialog.html","<div class=\"my-dialog-mask\"><div class=\"my-dialog\"><div class=\"dialog-top\" layout=\"column\" ng-cloak=\"\"><div class=\"dialog-msg\" layout=\"column\" style=\"border-bottom: 1px solid #dedede;padding:20px;\"><p>{{dialogMsg}}</p><md-input-container ng-show=\"!logOut\"><label>描述</label> <input md-no-asterisk=\"\" name=\"description\" ng-model=\"description\"></md-input-container><md-slider-container layout=\"row\" layout-align=\"start center\" ng-show=\"!logOut\"><span flex=\"none\" style=\"display:inline-block;padding-right: 10px\">百分比</span><md-slider flex=\"\" min=\"0\" max=\"{{max}}\" ng-model=\"percentage\" aria-label=\"red\" id=\"red-slider\"></md-slider><md-input-container style=\"width:40px;\"><input type=\"number\" ng-model=\"percentage\" aria-label=\"red\" aria-controls=\"red-slider\"></md-input-container></md-slider-container></div><md-button flex=\"\" style=\"width:100%;\" ng-click=\"submit($event)\">{{dialogSure}}</md-button></div><div class=\"dialog-bottom\"><md-button flex=\"\" style=\"width:100%;\" ng-click=\"cancel($event)\">取消</md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/photoDraw.html","<md-content flex=\"\" layout=\"column\" class=\"photodraw\"><div flex=\"\" style=\"text-align: center\"><canvas></canvas></div><div flex=\"none\" layout=\"row\" style=\"background:#efefef;border-top:1px solid silver;\" class=\"photo-btn\"><md-button class=\"md-primary md-raise\" ng-click=\"cancel()\">取消</md-button><span flex=\"\"></span><md-button class=\"md-icon-button\" aria-label=\"red\" ng-click=\"setColor(\'red\')\" ng-style=\"{\'border-bottom-width\':is(\'red\')}\" style=\"border-bottom: solid 1px red;\"><md-icon md-font-icon=\"icon-checkbox-blank-circle\" style=\"color: red\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"blue\" ng-click=\"setColor(\'blue\')\" ng-style=\"{\'border-bottom-width\':is(\'blue\')}\" style=\"border-bottom: solid 1px blue;\"><md-icon md-font-icon=\"icon-checkbox-blank-circle\" style=\"color: blue\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"black\" ng-click=\"setColor(\'black\')\" ng-style=\"{\'border-bottom-width\':is(\'black\')}\" style=\"border-bottom: solid 1px black;\"><md-icon md-font-icon=\"icon-checkbox-blank-circle\" style=\"color: black\"></md-icon></md-button><span flex=\"\"></span><md-button class=\"md-primary md-raise\" ng-click=\"erase()\">清除</md-button><md-button class=\"md-primary md-raised md-mini\" ng-click=\"save()\" style=\"float: right\">保存</md-button></div></md-content>");
$templateCache.put("app/main/xhsc/directive/proceduce.html","<div flex=\"\" layout=\"column\"><md-toolbar><div class=\"md-toolbar-tools\"><h4>选择工序</h4><span flex=\"\"></span><md-button style=\"min-width:40px\" ng-click=\"ctrl.ok()\">确定</md-button><md-button id=\"_cancel\" ng-click=\"ctrl.close()\" style=\"min-width:50px\">取消</md-button></div></md-toolbar><md-tabs md-selected=\"1\" md-border-bottom=\"\" flex=\"\" style=\"background-color:white\"><md-tab label=\"已选工序\"><md-tab-content layout=\"column\"><div flex=\"\" layout=\"row\"><md-list style=\"box-shadow:1px 0px 15px 0 #d8d8d8\" flex=\"40\" ms-scroll=\"\"><md-list-item ng-repeat=\"item in ctrl.selected\"><md-checkbox ng-click=\"ctrl.remove(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\">{{item.AcceptanceItemName}}</md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item><span flex=\"\"></span></md-list></div></md-tab-content></md-tab><md-tab ng-repeat=\"gx1 in ctrl.procedures\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"column\"><div flex=\"\" layout=\"row\"><div flex=\"40\" style=\"position: relative\" ms-scroll=\"\" layout=\"column\"><md-list><md-list-item ng-click=\"ctrl.selectSpecialtyLow(item,gx1)\" layout=\"row\" ng-repeat=\"item in gx1.SpecialtyChildren\"><p>{{item.SpecialtyName}}</p></md-list-item></md-list></div><md-list flex=\"\" style=\"box-shadow:-1px 0px 15px 0 #d8d8d8\"><md-list-item layout=\"row\" ng-repeat=\"item in gx1.WPAcceptanceList\"><md-checkbox ng-click=\"ctrl.choosego(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\"></md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item></md-list></div></md-content></md-tab-content></md-tab></md-tabs></div>");
$templateCache.put("app/main/xhsc/directive/qlistUp.html","<div style=\"position: fixed;top: 0;left: 0;right:0;bottom:0;background: rgba(0,0,0,.5);z-index: 20;\" ng-if=\"listShow\" id=\"qlistUp\"></div><div class=\"slideTop\" ng-class=\"{\'slidedown\':listShow}\"><div class=\"gxtest gxtestdetail\" flex=\"\"><md-list class=\"gxque\" style=\"margin-top:0;\"><md-list-item ng-repeat=\"question in pList|orderBy:\'ProblemSortName\'\"><span flex=\"\" style=\"padding-left:8px;\">{{question.ProblemSortName}} {{question.ProblemDescription}}</span> <span flex=\"none\" style=\"text-align: right;padding-right:8px\">{{question.rows.length}}处</span></md-list-item></md-list></div><div flex=\"\" style=\"border-bottom: 1px solid #dedede;height: 48px;line-height: 48px;text-align: center;\" ng-click=\"submit()\">确定</div></div>");
$templateCache.put("app/main/xhsc/directive/rymenu.html","<div layout=\"row\">已选项：</div><div flex=\"\" layout=\"row\" class=\"gx-list\"><div flex=\"40\" layout=\"column\"><div class=\"list-left\" style=\"background: #f0f0f0;\"><md-list ng-cloak=\"\"><md-list-item ng-repeat=\"ry in ryData\"><md-button flex=\"\">{{ry.unit}}</md-button></md-list-item></md-list></div></div><div flex=\"60\" layout=\"column\" style=\"background: #fff;position:relative;\"><div class=\"list-right\"><div class=\"floors\" layout=\"column\"><md-list><md-list-item layout=\"row\"><p>aaa</p><md-checkbox class=\"md-secondary\"></md-checkbox></md-list-item></md-list></div></div></div></div>");
$templateCache.put("app/main/xhsc/directive/sectionFilter.html","<md-content flex=\"\" class=\"md-padding\" layout=\"column\"><div style=\"padding: 15px\"><h5>已选区域</h5><md-chips md-on-remove=\"vm.removeRegion($chip)\" ng-model=\"secSelected\" name=\"RegionName\" readonly=\"true\" md-removable=\"true\" md-max-chips=\"5\"><md-chip-template>{{$chip.RegionName}}</md-chip-template></md-chips></div><div style=\"padding:8px 15px\" ng-show=\"(!level||level>0)&&secSelected.length==0\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>项目</label><md-select ng-model=\"vm.ngModel[0]\" name=\"type\"><md-option ng-click=\"vm.getChild(item)\" ng-repeat=\"item in vm.secSource[0]\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"padding:8px 15px\" ng-show=\"(!level||level>1)&&secSelected.length==1\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>分期</label><md-select ng-model=\"vm.ngModel[1]\" name=\"type\"><md-option ng-click=\"vm.getChild(item)\" ng-repeat=\"item in vm.secSource[1]\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"padding:8px 15px\" ng-show=\"(!level||level>2)&&secSelected.length==2\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>楼栋</label><md-select ng-model=\"vm.ngModel[2]\" name=\"type\"><md-option ng-click=\"vm.getChild(item)\" ng-repeat=\"item in vm.secSource[2]\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"padding:8px 15px\" ng-show=\"(!level||level>3)&&secSelected.length==3\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>楼层</label><md-select ng-model=\"vm.ngModel[3]\" name=\"type\"><md-option ng-click=\"vm.getChild(item)\" ng-repeat=\"item in vm.secSource[3]\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"padding:8px 15px\" ng-show=\"(!level||level>4)&&secSelected.length==4\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>房间</label><md-select ng-model=\"vm.ngModel[4]\" name=\"type\"><md-option ng-repeat=\"item in vm.secSource[4]\" ng-value=\"item.RegionID\">{{item.RegionName}}</md-option></md-select></md-input-container></div><div style=\"padding:0px 15px\" layout=\"row\" ng-click=\"click()\"><md-input-container md-theme=\"default\" style=\"padding-left: 2px\" flex=\"\"><label style=\"left: 0px\">工序</label><div><input ng-model=\"gxNames\" disabled=\"\" style=\"border-bottom: 1px solid #d8d8d8\"><md-button class=\"md-icon-button md-primary\" style=\"position: absolute;right: -8px;\" aria-label=\"Settings\"><md-icon md-font-icon=\"icon-magnify\" class=\"icon s24\"></md-icon></md-button></div></md-input-container></div><div style=\"padding:8px 15px\" layout=\"row\"><md-button flex=\"\" ng-click=\"submit()\" class=\"md-raised md-primary\">确定</md-button></div><md-sidenav id=\"gx_nav\" layout=\"column\" style=\"min-width: 80%\" class=\"md-sidenav-right md-whiteframe-4dp\" md-component-id=\"right\"><md-toolbar><div class=\"md-toolbar-tools\"><h4>选择工序</h4><span flex=\"\"></span><md-button ng-click=\"ok()\">确定</md-button></div></md-toolbar><md-tabs md-border-bottom=\"\" flex=\"\" style=\"background-color:white\"><md-tab label=\"已选工序({{gxSelected.length}})\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"row\"><md-list style=\"box-shadow:1px 0px 15px 0 #d8d8d8\" flex=\"40\" ms-scroll=\"\"><md-list-item ng-repeat=\"item in gxSelected\"><md-checkbox ng-click=\"remove(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\">{{item.AcceptanceItemName}}</md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item><span flex=\"\"></span></md-list></md-content></md-tab-content></md-tab><md-tab ng-repeat=\"gx1 in procedures\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"column\"><div flex=\"\" layout=\"row\"><div flex=\"40\" style=\"position: relative\" ms-scroll=\"\" layout=\"column\"><md-list style=\"margin-left:8px\"><md-list-item ng-click=\"selectSpecialtyLow(item,gx1)\" layout=\"row\" ng-repeat=\"item in gx1.SpecialtyChildren\"><p>{{item.SpecialtyName}}</p></md-list-item></md-list></div><md-list flex=\"\" style=\"box-shadow:-1px 0px 15px 0 #d8d8d8\"><md-list-item layout=\"row\" ng-repeat=\"item in gx1.WPAcceptanceList\"><md-checkbox ng-click=\"choosego(item)\" ng-model=\"item.checked\" style=\"margin-right: 8px\"></md-checkbox><p flex=\"\">{{item.AcceptanceItemName}}</p></md-list-item></md-list></div></md-content></md-tab-content></md-tab></md-tabs></md-sidenav></md-content>");
$templateCache.put("app/main/xhsc/directive/slideMenu.html","<div flex=\"\" layout=\"row\" class=\"gx-list\" ng-class=\"{\'narrow\':level == 2}\"><div flex=\"33\" layout=\"column\"><md-content class=\"list-left\" flex=\"\" style=\"background: #f0f0f0;border-right:1px solid #dedede;\"><div ng-repeat=\"gx in slideData\"><label style=\"display: block;height:49px;line-height: 49px;padding:0 10px;margin-bottom: 0;border-bottom: 1px solid #dedede;white-space: nowrap;overflow: hidden;\" ng-hide=\"level == 2\">{{gx.SpecialtyName}}</label><md-list ng-cloak=\"\" style=\"padding-top:0;padding-bottom: 0;\"><md-list-item ng-class=\"{\'active\':gx1.checked}\" ng-repeat=\"gx1 in gx.SpecialtyChildren\"><md-button flex=\"\" ng-click=\"selectProcedure(gx1)\">{{gx1.SpecialtyName}}</md-button></md-list-item></md-list></div></md-content></div><div flex=\"66\" layout=\"column\" style=\"background: #fff;position:relative;\"><md-content class=\"list-right\" flex=\"\"><div class=\"floors\" layout=\"column\"><md-list ng-if=\"!showCheck\"><md-list-item layout=\"row\" ng-repeat=\"gxc in gxlevels\" ng-click=\"goToLink(gxc)\"><p>{{gxc.AcceptanceItemName}}</p></md-list-item></md-list><md-radio-group ng-if=\"showCheck\" ng-model=\"info.current\"><div style=\"height:49px;overflow: hidden;line-height: 49px;padding: 0 5px; border-bottom: 1px solid rgb(222, 222, 222);\" ng-repeat=\"gxc in gxlevels\"><md-radio-button ng-value=\"gxc\" aria-label=\"{{gxc.AcceptanceItemName}}\">{{gxc.AcceptanceItemName}}</md-radio-button></div></md-radio-group></div></md-content></div></div>");
$templateCache.put("app/main/xhsc/directive/slideTopView.html","<div class=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{disQues.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zg\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(data.images)\"><i>照片</i><i>{{data.images.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zg\'\"><label>整改照片</label><p><span class=\"photo\" ng-click=\"playImage()\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto()\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zg\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"disQues.note\"></p></md-list-item><md-list-item ng-if=\"role == \'zg\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{disQues.value}}<md-switch ng-model=\"disQues.value\" ng-true-value=\"\'整改\'\" ng-false-value=\"\'未整改\'\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'fy\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage()\"><i>照片</i><i>1</i></span></p></md-list-item><md-list-item ng-if=\"role == \'fy\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage()\"><i>照片</i><i>2</i></span></p></md-list-item><md-list-item ng-if=\"role == \'fy\'\"><label>备注</label><p>备注</p></md-list-item><md-list-item ng-if=\"role == \'fy\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{value}}<md-switch ng-model=\"value\" ng-true-value=\"\'合格\'\" ng-init=\"value=\'不合格\'\" ng-false-value=\"\'不合格\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><md-button flex=\"\" ng-click=\"submit()\" style=\"width: 100%;padding:6px 0;margin:0;\">确定</md-button></div>");
$templateCache.put("app/main/xhsc/directive/sxtLineGroup.html","<div layout-padding=\"\"><div class=\"mappopup\"><div layout=\"row\"><sxt-num-downdown ng-model=\"vm.bass\" show-number-panel=\"showNumberPanel\"></sxt-num-downdown></div></div><div layout-gt-sm=\"row\" class=\"takeph\"><span style=\"color:#fff;min-width:70px;display: inline-block;vertical-align: top;height:30px;line-height: 26px;padding: 2px;\">拍照</span><md-icon style=\"margin:0 0 0 10px;\"><img src=\"app/main/xhsc/images/camera.png\" width=\"35\"></md-icon></div><div layout=\"row\"><md-button class=\"md-mini\" flex=\"\" ng-click=\"removeLayer()\"><span>删除</span></md-button><md-button class=\"md-mini\" flex=\"\" ng-click=\"cancelEdit()\"><span>取消</span></md-button><span flex=\"\"></span><md-button class=\"md-mini\" flex=\"\" ng-click=\"updateValue()\"><span>确定</span></md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtMapCheckPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtMapSelfCheckPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div><div flex=\"\"><md-button class=\"md-fab md-mini\" ng-click=\"viewDetail()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-dots-horizontal\"></md-icon></md-button></div></div><div class=\"leaflet-draw-subbuttom sure\" style=\"display: none;\"><ul layout=\"row\"><li ng-if=\"!readonly\"><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li><li flex=\"\"></li></ul></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtNumInput.html","<div class=\"sxt-num-input\" layout=\"column\"><div layout=\"column\" class=\"newkeyboard\"><div flex=\"\" layout=\"row\"><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(7,$event)\">7</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(8,$event)\">8</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(9,$event)\">9</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(\'ac\',$event)\">清零</md-button></div></div><div flex=\"\" layout=\"row\"><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(4,$event)\">4</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(5,$event)\">5</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(6,$event)\">6</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(\'+-\',$event)\">+/-</md-button></div></div><div flex=\"\" layout=\"row\"><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(1,$event)\">1</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(2,$event)\">2</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(3,$event)\">3</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(-1,$event)\">←</md-button></div></div><div flex=\"\" layout=\"row\"><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(0,$event)\">0</md-button></div><div flex=\"25\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(\'.\',$event)\">.</md-button></div><div flex=\"50\" style=\"margin:5px 5px;\"><md-button class=\"md-raised\" ng-dblclick=\"cancel($event)\" fast-click=\"ck(\'ok\',$event)\" style=\"width:100%;margin:0\">确定</md-button></div></div></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(Record.jl.images)\"><i>照片</i><i>{{Record.jl.images.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && Record.zb.images.length\" class=\"photo\" ng-click=\"playImage(Record.zb.images)\"><i>照片</i><i>{{Record.zb.images.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==8?\'已整改\':\'未整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"8\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(Record.jl.images)\"><i>照片</i><i>{{Record.jl.images.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(Record.zb.images)\"><i>照片</i><i>{{Record.zb.images.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtScMapPopup.html","<div class=\"md-padding\" style=\"width: 300px;\"><div class=\"mappopup\"><div layout=\"row\" ng-if=\"PointType==\'Stamp\'\"><span flex=\"none\" style=\"color:#fff;display: inline-block;width:90px;text-align:right;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">点序号：</span><md-input-container flex=\"\"><input ng-model=\"value.seq\"></md-input-container></div><div class=\"stamp\"><div layout=\"row\" ng-repeat=\"idx in MeasureIndex.cds\" class=\"addPanel\"><span flex=\"none\" style=\"color:#fff;width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">{{idx.IndexName}}：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"value.cds[idx.AcceptanceIndexID].MeasureValue\"></sxt-num-downdown></span></div></div><div layout=\"row\" ng-if=\"(MeasureIndex.QSKey==\'1\'||MeasureIndex.QSKey==\'5\') && (!MeasureIndex.children||!MeasureIndex.children.length)\"><span flex=\"none\" style=\"color:#fff;width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ng-model=\"value.MeasureValue\"></sxt-num-downdown></span></div><div ng-if=\"MeasureIndex.QSKey==\'5\'\" layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: center; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">楼下值:</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;border-bottom: 1px solid #555;line-height: 30px;\">{{value.Prev && value.Prev.MeasureValue}}</span></div><div ng-if=\"MeasureIndex.QSKey==\'5\'\" layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: center; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">对比值:</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;border-bottom: 1px solid #555;line-height: 30px;\">{{value.CalculatedValue = (value.Prev?value.MeasureValue - value.Prev.MeasureValue:null) }}</span></div><table ng-if=\"MeasureIndex.QSKey==\'2\'\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom:15px;width:100%\"><thead><tr><th style=\"width:80px; text-align: center;\">实测值</th><th ng-repeat=\"item in MeasureIndex.children\">{{item.IndexName}}</th></tr></thead><tbody><tr><td style=\"width:80px; text-align: center;\">实测值</td><td ng-repeat=\"item in MeasureIndex.children\"><sxt-num-downdown ct=\"{\'ct\':$index == 0}\" ng-model=\"value[item.AcceptanceIndexID].MeasureValue\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">设计值</td><td ng-repeat=\"item in MeasureIndex.children\"><sxt-num-downdown ng-model=\"value[item.AcceptanceIndexID].DesignValue\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">结果</td><td ng-repeat=\"item in MeasureIndex.children\"><span>{{value[item.AcceptanceIndexID].MeasureValue-value[item.AcceptanceIndexID].DesignValue}}</span></td></tr></tbody></table><div layout=\"row\" ng-if=\"(MeasureIndex.QSKey==\'3\' || MeasureIndex.QSKey==\'4\') && PointType==\'Stamp\'\" class=\"addPanel nostamp\"><span style=\"text-align:right;color:#fff;min-width:90px;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;line-height:30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ng-model=\"value.MeasureValue\"></sxt-num-downdown></span></div><div ng-if=\"(MeasureIndex.QSKey==\'3\' || MeasureIndex.QSKey==\'4\') && PointType!=\'Stamp\'\" class=\"stamp\"><div layout=\"row\"><span style=\"color:#fff;min-width:90px;text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">组名称：</span><md-input-container><input ng-model=\"value.Remark\"></md-input-container></div></div><div ng-if=\"MeasureIndex.IndexType==\'SelectMaterial\' && MeasureIndex.children.length\"><div layout=\"row\"><span style=\"color:#fff;min-width:90px;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;\">选择类型</span><md-input-container flex=\"\"><md-select ng-model=\"value.AcceptanceIndexID\"><md-option ng-repeat=\"item in MeasureIndex.children\" value=\"{{item.AcceptanceIndexID}}\">{{item.IndexName}}</md-option></md-select></md-input-container></div><div layout=\"row\" style=\"margin-top:20px;\" class=\"addPanel\"><span style=\"color:#fff;min-width:90px;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值:</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;line-height:30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ng-model=\"value.MeasureValue\"></sxt-num-downdown></span></div></div></div><div class=\"leaflet-draw-subbuttom sure\"><ul layout=\"row\"><li ng-if=\"!readonly\"><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li><li flex=\"\"></li><li><a class=\"\" href=\"javascript:void(0)\" ng-click=\"cancelEdit()\">取消</a></li><li ng-if=\"!readonly\"><a class=\"\" href=\"javascript:void(0)\" ng-click=\"updateValue()\">确定</a></li></ul></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtScPopup.html","<div class=\"md-padding\" style=\"width: 300px;\"><div class=\"mappopup\"><div layout=\"row\" ng-repeat=\"item in edit.singleEdit\"><span flex=\"none\" style=\"color:#fff;min-width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div layout=\"row\" ng-repeat=\"item in edit.mutiEdit\" class=\"mutiEdit\"><span flex=\"none\" style=\"color:#fff;min-width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">{{item.m.IndexName}}：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div ng-repeat=\"item in edit.floorEdit\"><div layout=\"row\"><span flex=\"none\" style=\"color:#fff;width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">对比值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ng-model=\"item.v.DesignValue\"></sxt-num-downdown></span></div><div layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">结果：</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;border-bottom: 1px solid #555;line-height: 30px;\">{{item.v.CalculatedValue = (item.v.DesignValue?item.v.MeasureValue - item.v.DesignValue:null) }}</span></div></div><table ng-if=\"edit.sjzEdit.length\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom:15px;width:100%\"><thead><tr><th style=\"width:80px; text-align: center;\">实测项</th><th ng-repeat=\"item in edit.sjzEdit\">{{item.m.IndexName}}</th></tr></thead><tbody><tr class=\"sjzEdit\"><td style=\"width:80px; text-align: center;\">实测值</td><td ng-repeat=\"item in edit.sjzEdit\"><sxt-num-downdown ct=\"ct\" on-change=\"onMeasureValueChange(item.v,item)\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></td></tr><tr ng-if=\"edit.plasterDepth\"><td style=\"width:80px; text-align: center;\">抹灰厚度</td><td ng-repeat=\"item in edit.sjzEdit\" style=\"line-height: 30px; text-align: center\"><sxt-num-downdown ng-model=\"item.m.plasterDepth\" on-change=\"onMeasureValueChange(item.v,item)\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">设计值</td><td ng-repeat=\"item in edit.sjzEdit\"><sxt-num-downdown ng-model=\"item.v.DesignValue\" on-toggle=\"onDesignValueToggle(item.v,item)\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">结果</td><td ng-repeat=\"item in edit.sjzEdit\"><span style=\"line-height: 30px;\">&nbsp; {{getCalculatedValue(item)}}</span></td></tr></tbody></table><table ng-if=\"edit.groupEdit.length\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom:15px;width:100%\"><thead><tr><th style=\"width:80px; text-align: center;\">实测项</th><th ng-repeat=\"item in edit.groupEdit\">{{item.m.IndexName}}</th></tr></thead><tbody><tr class=\"sjzEdit\"><td style=\"width:80px; text-align: center;\">实测1</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.values[0]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测2</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[1]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测3</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[2]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测4</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[3]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测5</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[4]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测6</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[5]\"></sxt-num-downdown></td></tr></tbody></table><div ng-if=\"edit.group\" class=\"stamp\"><div layout=\"row\"><span style=\"color:#fff;min-width:90px;text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">组名称：</span><md-input-container><input ng-model=\"edit.group.v.Remark\"></md-input-container></div></div></div><div class=\"leaflet-draw-subbuttom sure\"><ul layout=\"row\"><li ng-if=\"!readonly\"><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li><li flex=\"\"></li></ul></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtScPopupNew.html","<div class=\"md-padding\" style=\"width: 300px;\"><div class=\"mappopup\"><div layout=\"row\" ng-repeat=\"item in edit.singleEdit\"><span flex=\"none\" style=\"color:#fff;min-width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div layout=\"row\" ng-repeat=\"item in edit.mutiEdit\" class=\"mutiEdit\"><span flex=\"none\" style=\"color:#fff;min-width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">{{item.m.IndexName}}：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div ng-repeat=\"item in edit.floorEdit\"><div layout=\"row\"><span flex=\"none\" style=\"color:#fff;width:90px;text-align:right;display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">实测值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></span></div><div layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">对比值：</span> <span flex=\"\" style=\"position: relative;display: inline-block;height:30px;line-height: 30px;border-bottom: 1px solid #555;\"><sxt-num-downdown ng-model=\"item.v.DesignValue\"></sxt-num-downdown></span></div><div layout=\"row\"><span style=\"color:#fff;min-width:90px; text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">结果：</span> <span style=\"position: relative;width:100%;display: inline-block;height:30px;border-bottom: 1px solid #555;line-height: 30px;\">{{item.v.CalculatedValue = (item.v.DesignValue?item.v.MeasureValue - item.v.DesignValue:null) }}</span></div></div><table ng-if=\"edit.sjzEdit.length\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom:15px;width:100%\"><thead><tr><th style=\"width:80px; text-align: center;\">实测项</th><th ng-repeat=\"item in edit.sjzEdit\">{{item.m.IndexName}}</th></tr></thead><tbody><tr class=\"sjzEdit\"><td style=\"width:80px; text-align: center;\">实测值</td><td ng-repeat=\"item in edit.sjzEdit\"><sxt-num-downdown ct=\"ct\" on-change=\"onMeasureValueChange(item.v,item)\" ng-model=\"item.v.MeasureValue\"></sxt-num-downdown></td></tr><tr ng-if=\"edit.plasterDepth\"><td style=\"width:80px; text-align: center;\">抹灰厚度</td><td ng-repeat=\"item in edit.sjzEdit\" style=\"line-height: 30px; text-align: center\"><sxt-num-downdown ng-model=\"item.m.plasterDepth\" on-change=\"onMeasureValueChange(item.v,item)\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">设计值</td><td ng-repeat=\"item in edit.sjzEdit\"><sxt-num-downdown ng-model=\"item.v.DesignValue\" on-toggle=\"onDesignValueToggle(item.v,item)\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">结果</td><td ng-repeat=\"item in edit.sjzEdit\"><span style=\"line-height: 30px;\">&nbsp; {{getCalculatedValue(item)}}</span></td></tr></tbody></table><table ng-if=\"edit.groupEdit.length\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-bottom:15px;width:100%\"><thead><tr><th style=\"width:80px; text-align: center;\">实测项</th><th ng-repeat=\"item in edit.groupEdit\">{{item.m.IndexName}}</th></tr></thead><tbody><tr class=\"sjzEdit\"><td style=\"width:80px; text-align: center;\">实测1</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ct=\"ct\" ng-model=\"item.v.values[0]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测2</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[1]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测3</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[2]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测4</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[3]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测5</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[4]\"></sxt-num-downdown></td></tr><tr><td style=\"width:80px; text-align: center;\">实测6</td><td ng-repeat=\"item in edit.groupEdit\"><sxt-num-downdown ng-model=\"item.v.values[5]\"></sxt-num-downdown></td></tr></tbody></table><div ng-if=\"edit.group\" class=\"stamp\"><div layout=\"row\"><span style=\"color:#fff;min-width:90px;text-align: right; display: inline-block;vertical-align: top;margin-top:0;height:30px;line-height: 26px;padding: 2px;margin-bottom:20px;\">组名称：</span><md-input-container><input ng-model=\"edit.group.v.Remark\"></md-input-container></div></div></div><div class=\"leaflet-draw-subbuttom sure\"><ul layout=\"row\"><li><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li><li flex=\"\"></li></ul></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtSelfcheckPopup.html","<div class=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:30;\" ng-show=\"slideShow\"></div><div class=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{slideContext.layer.options.v.ProblemDescription||ZjRecord.zj.Describe}}</p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{ZjRecord.zj.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"ZjRecord.zj.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/sxtStamp.html","<div class=\"mappopup\"><div style=\"width:300px\"><div layout=\"row\"><sxt-num-downdown ng-model=\"vm.bass\"></sxt-num-downdown></div></div><div layout-gt-sm=\"row\" class=\"takeph\"><span style=\"color:#fff;min-width:70px;display: inline-block;vertical-align: top;height:30px;line-height: 26px;padding: 2px;\">拍照</span><md-icon style=\"margin:0 0 0 10px;\"><img src=\"app/main/xhsc/images/camera.png\" width=\"35\"></md-icon></div><div class=\"leaflet-draw-subbuttom\"><ul layout=\"row\"><li><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li><li flex=\"\"></li><li><a class=\"\" href=\"javascript:void(0)\" ng-click=\"cancelEdit()\">取消</a></li><li><a class=\"\" href=\"javascript:void(0)\" ng-click=\"updateValue()\">确定</a></li></ul></div></div>");
$templateCache.put("app/main/xhsc/home/application.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.loaded\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-if=\"vm.loaded\" class=\"applicationPage\"><div ng-repeat=\"item in vm.yw\"><p class=\"subtitle\">{{item.name}}</p><p><div class=\"fl\" ng-repeat=\"k in item.items\" ng-if=\"k.right\"><a ng-click=\"vm.click(k)\" layout=\"column\" layout-align=\"center center\"><img ng-src=\"{{k.img}}\"><p>{{k.title}}</p></a></div><div class=\"clear\"></div></p></div></div>");
$templateCache.put("app/main/xhsc/home/demo.html","DEMO<div>{{vm.num}}</div><sxt-num-input ng-model=\"vm.num\"></sxt-num-input>");
$templateCache.put("app/main/xhsc/home/home.html","<div flex=\"\" layout=\"column\"><div flex=\"\" sxt-maps=\"\" markers=\"vm.markers\" marker-click=\"vm.markerClick($current)\"></div><div style=\"position: absolute;z-index: 10; top:10px;right:10px;\"><md-autocomplete md-no-cache=\"true\" md-selected-item-change=\"vm.changeItem(item)\" md-item-text=\"item.title\" placeholder=\"项目搜索\" md-min-length=\"0\" md-items=\"item in vm.querySearch(vm.searchText)\" md-search-text=\"vm.searchText\"><md-item-template>{{item.title}}</md-item-template><md-not-found>未找到匹配项</md-not-found></md-autocomplete></div></div>");
$templateCache.put("app/main/xhsc/home/homeBottom.html","<md-bottom-sheet ng-cloak=\"\" style=\"padding:0\"><div class=\"homeTab\"><h2>{{name}}</h2><md-content><md-tabs style=\"margin-bottom: 20px;\"><md-tab label=\"项目信息\"><md-content class=\"md-padding\"><md-list flex=\"\" layout=\"row\"><md-list-item flex=\"\"><md-button ui-sref=\"app.xhsc.download\" ng-click=\"hide()\"><img src=\"app/main/xhsc/images/scsl-icon.png\" style=\"margin:0 auto;max-width: 100%;width:75%\"><div class=\"md-grid-text\">实测实量</div></md-button></md-list-item><md-list-item flex=\"\"><md-button ui-sref=\"app.xhsc.gx.gxbdchoose({projectId:projectId})\" ng-click=\"hide()\"><img src=\"app/main/xhsc/images/gx-icon.png\" style=\"margin:0 auto;max-width: 100%;width:75%\"><div class=\"md-grid-text\">工序验收</div></md-button></md-list-item><md-list-item flex=\"\"><md-button ui-sref=\"app.xhsc.xxjd.xxjdmain\" ng-click=\"hide()\"><img src=\"app/main/xhsc/images/clgl-icon.png\" style=\"margin:0 auto;max-width: 100%;width:75%\"><div class=\"md-grid-text\">材料管理</div></md-button></md-list-item></md-list></md-content></md-tab><md-tab label=\"计划管理\"><md-content class=\"md-padding\"></md-content></md-tab><md-tab label=\"质量管理\"><md-content class=\"md-padding\"></md-content></md-tab><md-tab label=\"安全评估\"><md-content class=\"md-padding\"></md-content></md-tab><md-tab label=\"项目评估\"><md-content class=\"md-padding\"></md-content></md-tab></md-tabs></md-content></div></md-bottom-sheet>");
$templateCache.put("app/main/xhsc/offline/manage.html","<div ng-cloak=\"\" layout=\"column\" flex=\"\" layout-fill=\"\"><md-content><md-toolbar md-scroll-shrink=\"\"><div class=\"md-toolbar-tools\"><h3><span>离线数据管理</span></h3><span flex=\"\"></span><md-button class=\"md-raised\" ng-click=\"vm.download()\">下载</md-button></div></md-toolbar><md-list><md-subheader class=\"md-no-sticky\">区域信息</md-subheader><md-list-item class=\"secondary-button-padding\" ng-repeat=\"region in regions\"><p>{{region.RegionName}}</p><md-button class=\"md-secondary\">{{region.tate}}</md-button></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">实测实量项</md-subheader><md-list-item class=\"secondary-button-padding\" ng-repeat=\"item in AcceptanceItems\"><p>{{item.AcceptanceItemName}}</p><md-button class=\"md-secondary\">{{item.state}}</md-button></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">实测指标项</md-subheader><md-list-item class=\"secondary-button-padding\" ng-repeat=\"index in AcceptanceIndexs\"><p>{{index.IndexName}}</p><md-button class=\"md-secondary\">{{index.state}}</md-button></md-list-item><md-divider></md-divider><md-subheader class=\"md-no-sticky\">图纸</md-subheader><md-list-item class=\"secondary-button-padding\" ng-if=\"false\"><p>实测指标项</p><md-button class=\"md-secondary\">More Info</md-button></md-list-item><md-divider></md-divider></md-list></md-content></div>");
$templateCache.put("app/main/xhsc/procedure/action.html","<md-bottom-sheet><md-list><md-list-item ng-repeat=\"item in btns\" layout=\"row\" style=\"position: relative\"><md-button ng-click=\"item.action($event)\" flex=\"\" style=\"text-align: center;margin: 0px\"><span style=\"color: #359df5;font-size:16px;\">{{item.title}}</span></md-button><span class=\"border1px bottom1px\" style=\"bottom: 6px\"></span></md-list-item></md-list></md-bottom-sheet>");
$templateCache.put("app/main/xhsc/procedure/baseInforTemp.html","<md-dialog class=\"changetel\"><md-dialog-content style=\"padding:20px 0;border-bottom: 1px solid #dedede;\"><div class=\"gxtest gxtestdetail\"><p style=\"padding-left:10px;\">基本信息</p><md-list><md-list-item><label>工序</label><p>{{baseInfo.AcceptanceItemName}}</p></md-list-item><md-list-item><label>部位</label><p>{{area.RegionName}}</p></md-list-item><md-list-item><label>验收人员</label><p>{{baseInfo.InspectionUser}}</p></md-list-item><md-list-item><label>验收进度</label><p>{{baseInfo.Percentage}}%</p></md-list-item><md-list-item><label>验收时间</label><p>{{baseInfo.InspectionTime}}</p></md-list-item><md-list-item><label>备注信息</label><p>{{baseInfo.Describe || \'无\'}}</p></md-list-item></md-list></div></md-dialog-content><md-dialog-actions style=\"padding-top:0;padding-bottom:0;min-height: 44px;\"><a flex=\"\" class=\"new-btn noborder\" ng-click=\"submit()\">确定</a></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/procedure/fgxtest.html","<div flex=\"none\" style=\"position: relative;border-bottom: 1px solid #d8d8d8;\"><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;position: absolute;left:10px;top:0;\"><md-icon md-font-icon=\"icon-chevron-left\"></md-icon></md-button><p style=\"font-size:14px;padding:0 10px;text-align: center;margin-bottom: 0;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">深圳星河银河谷项目>一期>A栋>203</p><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;position: absolute;right:10px;top:0\"><md-icon md-font-icon=\"icon-chevron-right\"></md-icon></md-button></div><div class=\"gxtest gxtestdetail\"><md-list class=\"gxque\"><md-list-item><p>交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">说明</span><p>交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">照片</span><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">备注</span><p><input style=\"border:none;width:100%;\"></p></md-list-item><md-list-item><span>验收意见</span><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-model=\"vm.value\" ng-true-value=\"\'符合\'\" ng-init=\"vm.value=\'不符合\'\" ng-false-value=\"\'不符合\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><md-list class=\"gxque\"><md-list-item><p ui-sref=\"app.xhsc.gx.jlgxtest\">交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">说明</span><p>交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">照片</span><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">备注</span><p><input style=\"border:none;width:100%;\"></p></md-list-item><md-list-item><span>验收意见</span><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-model=\"vm.value\" ng-true-value=\"\'合格\'\" ng-init=\"vm.value=\'不合格\'\" ng-false-value=\"\'不合格\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><md-button flex=\"\" style=\"display: block;width:100%;margin:10px 0;padding:6px;border:1px solid #d8d8d8;background: #fff;\" ui-sref=\"app.xhsc.gx.fgxtest\">确认提交</md-button></div>");
$templateCache.put("app/main/xhsc/procedure/gxalllist.html","<md-content class=\"gxall\"><div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:100%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.current.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"gxtest gxtestdetail\" flex=\"\" ng-if=\"vm.pList.length\"><div style=\"margin-top: 20px;padding:0 8px;\" flex=\"\" layout=\"row\"><span flex=\"\">不合格列表</span><span flex=\"\"></span></div><md-list class=\"gxque\"><md-list-item ng-repeat=\"question in vm.pList|orderBy:\'ProblemSortName\'\"><span flex=\"\" style=\"padding-left:8px;\">{{question.ProblemSortName}} {{question.ProblemDescription}}</span> <span flex=\"none\" style=\"text-align: right;padding-right:8px\">{{question.rows.length}}处</span></md-list-item></md-list></div><div layout=\"column\" ng-repeat=\"item in vm.procedureData\" style=\"margin-top: 10px;\"><md-list ng-repeat=\"it in item.ProblemClassifyList\"><md-list-item ng-class=\"{\'disabled\':!i.checked}\" ng-repeat=\"i in it.ProblemLibraryList|filter:{show:true}\" ng-click=\"vm.checkedOrnot(i)\"><md-checkbox ng-model=\"i.checked\" ng-click=\"vm.checkedOrnot(i)\" style=\"margin-right: 5px;\"></md-checkbox><p style=\"padding-right: 75px;\">{{i.AcceptanceItemName}}</p><md-switch ng-if=\"i.checked\" ng-disabled=\"true\" ng-model=\"i.Status\" ng-true-value=\"\'合格\'\" ng-init=\"i.Status=\'合格\'\" ng-false-value=\"\'不合格\'\" class=\"md-secondary\">{{i.Status}}</md-switch></md-list-item></md-list></div></md-content>");
$templateCache.put("app/main/xhsc/procedure/gxbdchoose.html","<div layout=\"column\" class=\"gxdownload\"><md-subheader ng-if=\"vm.offlines.length\">已下载列表</md-subheader><md-list><md-list-item ng-repeat=\"item in vm.sections\"><p layout=\"column\" style=\"padding-right: 100px;font-size:16px;\">{{item.title}}</p><div class=\"md-secondary md-hue-3\" style=\"right:0;\"><md-button ui-sref=\"app.xhsc.gx.gxlist({projectId:vm.projectId,areaID:item.AreaID})\" class=\"md-raised md-primary\">工序验收</md-button></div></md-list-item><md-list-item ng-repeat=\"item in vm.offlines\" ng-hide=\"true\"><p layout=\"column\" style=\"padding-right: 100px;font-size:16px;\">{{item.AssessmentSubject}}</p><div class=\"md-secondary md-hue-3\" style=\"right:0;\"><md-button ui-sref=\"app.xhsc.gx.gxbdchoose.gxlist({projectId:item.ProjectID})\" class=\"md-raised md-primary\">工序验收</md-button></div></md-list-item></md-list><md-subheader ng-if=\"vm.onlines.length\">未下载列表</md-subheader><md-list><md-list-item ng-repeat=\"item in vm.onlines\"><p layout=\"column\" style=\"font-size: 16px;padding-right: 100px;\">{{item.AssessmentSubject}}</p><div class=\"md-secondary md-hue-3\"><span style=\"display:inline-block;width:50px;text-align: center;\"><md-button ng-if=\"!item.pack.isDown\" class=\"md-raised upload-btn\" ng-click=\"vm.download(item)\" style=\"min-width: 50px;\">下载</md-button><a ng-if=\"item.pack.isDown\" style=\"position: relative;display: inline-block;width:31px;height:31px;border:1px solid #f8f8f8;border-radius:50%\" ng-click=\"vm.cancel()\"><md-progress-circular md-mode=\"determinate\" value=\"{{item.progress}}\" md-diameter=\"30\"></md-progress-circular><md-icon style=\"width:10px;height:10px;background: #0185f1;position: absolute;left:10px;top:10px;\"></md-icon></a></span></div></md-list-item></md-list></div>");
$templateCache.put("app/main/xhsc/procedure/gxdetail.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.current.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" flex=\"\" sxt-map-check=\"false\" inspection-id=\"vm.InspectionId\" project-id=\"vm.projectId\" disable-inspect=\"true\" disable-drag=\"true\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.current.AreaID\"></div><div style=\"margin-top: 12px;padding:0 8px;margin-bottom:12px;\" flex=\"none\" layout=\"row\"><span flex=\"\" ng-click=\"vm.showQuesList()\">问题列表详情</span><span flex=\"\"></span></div><sxt-question-list list-show=\"vm.showList\" list-inspectid=\"vm.InspectionId\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.current.AreaID\"></sxt-question-list>");
$templateCache.put("app/main/xhsc/procedure/gxfy.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;position: absolute;left:10px;top:0;\" ng-click=\"vm.nextRegion(true)\"><md-icon md-font-icon=\"icon-chevron-left\"></md-icon></md-button><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.AreaName||\'区域\'}} <span class=\"caret\"></span></p><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;position: absolute;right:10px;top:0\" ng-click=\"vm.nextRegion()\"><md-icon md-font-icon=\"icon-chevron-right\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.AreaName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" flex=\"\" sxt-recheck-map=\"\" sxt-map-show=\"vm.slideShow\" project-id=\"vm.ProjectID\" procedure=\"vm.AcceptanceItemID\" region-id=\"vm.regionSelect.AreaID\"></div><md-content flex=\"\" style=\"background: transparent;\"><div class=\"gxtest gxtestdetail\" flex=\"\"><div style=\"margin-top: 20px;padding:0 8px;\" flex=\"\" layout=\"row\"><span flex=\"\">问题列表</span><span flex=\"\"></span><span ng-click=\"vm.showBaseInfor()\">基本信息</span></div><md-list class=\"gxque\"><md-list-item ng-repeat=\"k in vm.ques\"><span flex=\"\" style=\"padding-left:8px;\">{{k.IndexDesc}}</span> <span flex=\"none\" style=\"text-align: right;padding-right:8px\">{{k.points.length}}处</span></md-list-item></md-list><sxt-recheck-popup slide-show=\"vm.slideShow\" slide-role=\"vm.role\"></sxt-recheck-popup></div></md-content>");
$templateCache.put("app/main/xhsc/procedure/gxhousechoose.html","<div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == -1}\"><md-button ng-click=\"vm.filter(-1)\" style=\"margin:6px auto;\"><span>全部</span><span>{{vm.nums.qb}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(0)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 0}\"><md-button ng-click=\"vm.filter(0)\" style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未报验</span><span>{{vm.nums.wtj}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(1)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 1}\"><md-button ng-click=\"vm.filter(1)\" style=\"margin:6px auto;\"><span><i class=\"dy\"></i>待验</span><span>{{vm.nums.dy}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(2)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 2}\"><md-button ng-click=\"vm.filter(2)\" style=\"margin:6px auto;\"><span><i class=\"pass\"></i>合格</span><span>{{vm.nums.hg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(4)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 4}\"><md-button ng-click=\"vm.filter(4)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>不合格</span><span>{{vm.nums.bhg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(8)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 8}\"><md-button ng-click=\"vm.filter(8)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>未整改</span><span>{{vm.nums.wzg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(16)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 16}\"><md-button ng-click=\"vm.filter(16)\" style=\"margin:6px auto;\"><span><i class=\"yzg\"></i>已整改</span><span>{{vm.nums.yzg}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div flex=\"\" ng-repeat=\"h in vm.houses\" ng-if=\"h.selected\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\" ng-show=\"vm.loading\">{{h.projectTitle }}</p><div class=\"floor-list gxroomlist\" ng-show=\"vm.loading\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item md-virtual-repeat=\"d in vm.building\" class=\"repeat\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><div layout=\"column\" ng-if=\"!d.show&&vm.maxRegion ==8\"><md-list class=\"roomllist\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-if=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.Children\"><div class=\"room-st1 {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div ng-if=\"!r.single\" ng-repeat=\"d in r.inspectionRows\" class=\"{{d.style}}\" style=\"height:100%;width:{{d.Percentage}}%;display: inline-block;\"></div><div ng-if=\"r.single\" class=\"{{r.style}}\" style=\"height:100%;width:{{r.Percentage}}%\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div><md-list ng-if=\"!d.show&&vm.maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-if=\"c.Children.length&&vm.regionfilterByStatus(c)\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selected(c)\" class=\"room-st1 {{c.style}}\" ng-class=\"{\'checked\':c.checked}\"><div ng-if=\"!c.single\" ng-repeat=\"d in c.inspectionRows\" class=\"{{d.style}}\" style=\"height:100%;width:{{d.Percentage}}%;display: inline-block;\"></div><div ng-if=\"c.single\" class=\"{{c.style}}\" style=\"height:100%;width:{{c.Percentage}}%;display: inline-block;\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-if=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in c.Children\"><div class=\"room-st1 {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div ng-if=\"!r.single\" ng-repeat=\"d in r.inspectionRows\" class=\"{{d.style}}\" style=\"height:100%;width:{{d.Percentage}}%;display: inline-block;\"></div><div ng-if=\"r.single\" style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-show=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.floors\"><div class=\"room-st1 {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div ng-if=\"!r.single\" ng-repeat=\"d in r.inspectionRows\" class=\"{{d.style}}\" style=\"height:100%;width:{{d.Percentage}}%;display: inline-block;\"></div><div ng-if=\"r.single\" class=\"{{r.style}}\" style=\"height:100%;width:{{r.Percentage}}%\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list></div></md-list-item></md-virtual-repeat-container></div></div></md-content><my-dialog dialog-show=\"vm.showmyDialog\" call-back=\"vm.callBack()\" dialog-data=\"vm.data\" dialog-sure=\"报验\" dialog-msg=\"\"></my-dialog>");
$templateCache.put("app/main/xhsc/procedure/gxlist.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs flex=\"\" ng-if=\"vm.show\"><md-tab ng-if=\"vm.showTab(gx1)\" ng-repeat=\"gx1 in vm.data\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"item.WPAcceptanceList.length\" ng-repeat=\"item in gx1.SpecialtyChildren\"><md-subheader class=\"md-no-sticky\" style=\"background:#f0f0f0\">{{item.SpecialtyName}}</md-subheader><md-list-item ng-click=\"vm.choosego(k)\" style=\"background: white;\" ng-repeat=\"k in item.WPAcceptanceList\"><p flex=\"\">{{k.AcceptanceItemName}}</p><md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/procedure/gxmain.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" ng-if=\"vm.isOver&&vm.role==0||vm.role==32\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.goSelf()\"><img src=\"app/main/xhsc/images/zbzj.png\"><p>总包自检</p></li><li ng-click=\"vm.setModule(2)\"><img src=\"app/main/xhsc/images/zbby.png\"><p>总包报验</p></li><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>总包整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|filter:{Status:4}\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.isOver&&!(vm.role==0||vm.role==32)\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.setModule(16)\"><img src=\"app/main/xhsc/images/jlys.png\"><p>监理验收</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>监理复验</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">监理验收</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|filter:{Status:16}\"><div style=\"padding-bottom: 16px\" flex=\"80\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">监理复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/procedure/gxresult.html","<ui-view layout=\"column\" flex=\"\" style=\"background-color: rgb(244, 244, 246)\"><div class=\"gxtest\"><md-list><md-list-item><label>工序</label><p>{{vm.gxname}}{{vm.is(\'app.xhsc.gxresult.gxdetail\')}}</p></md-list-item><md-list-item><label>监理单位</label><p>{{vm.allRelations[0].SupervisionOUName}}</p></md-list-item><md-list-item><label>施工单位</label><p>{{vm.allRelations[0].MainContractorOUName}}</p></md-list-item><md-list-item><label>责任人</label><p>{{vm.allRelations[0].MainContractorName}}</p></md-list-item></md-list><md-list><md-list-item><label>验收详情</label><p style=\"text-align: right;\" ui-sref=\"app.xhsc.gx.gxresult.gxdetail\"><img src=\"app/main/xhsc/images/right.png\" style=\"height:20px;display: inline-block;\"></p></md-list-item></md-list><md-list><md-list-item><label style=\"width: 100px;\">最迟整改时间</label><p style=\"text-align: right;\"><md-input-container class=\"md-block\" style=\"margin:0\"><md-select ng-model=\"vm.time\"><md-option ng-repeat=\"time in vm.times\" ng-value=\"time.value\">{{time.time}}</md-option></md-select></md-input-container></p></md-list-item><md-list-item><label>备注</label><p><input style=\"border:none;width:100%;\" ng-model=\"vm.params.Remarks\" placeholder=\"备注\"></p></md-list-item></md-list><md-button flex=\"\" style=\"display: block;width:100%;margin:10px 0;padding:6px;border:1px solid #d8d8d8;background: #fff;\" ng-disabled=\"!vm.Isfail\" ng-click=\"vm.submitResult()\">确认提交</md-button></div></ui-view>");
$templateCache.put("app/main/xhsc/procedure/gxrychoose.html","<div flex=\"\" layout=\"column\" class=\"ryxz\" window-height=\"\"><div style=\"width:100%;\"><div style=\"padding:0 8px;color:#f00;background: #fff;border-bottom: 1px solid #d8d8d8;\" ng-show=\"vm.choosed.length\"><span style=\"display: block;width:50px;float: left;margin-top:15px;\">已选：</span><div style=\"margin-left:50px;\"><span class=\"labs\" ng-repeat=\"item in vm.choosed\">{{item.UserName}}<i ng-click=\"vm.rydel(item)\"></i></span></div></div><div style=\"clear:both;\"></div></div><md-content flex=\"\" layout=\"row\" class=\"gx-list\" style=\"overflow: hidden;\"><div flex=\"40\" layout=\"column\" style=\"background: #f0f0f0;overflow: auto;border-right:1px solid #dedede;\"><div class=\"list-left\" style=\"background: #f0f0f0;\"><md-list ng-cloak=\"\" style=\"padding-top:0;\"><md-list-item ng-repeat=\"ry in vm.persons\" ng-class=\"{\'active\':ry.checked}\"><md-button flex=\"\" ng-click=\"vm.choosery(ry)\">{{ry.unit}}</md-button></md-list-item></md-list></div></div><div flex=\"60\" layout=\"column\" style=\"background: #fff;position:relative;overflow: auto;\"><div class=\"list-right\"><div class=\"floors\" layout=\"column\"><md-list><md-list-item layout=\"row\" ng-repeat=\"user in vm.current.users\" ng-click=\"vm.choose(user)\"><p ng-class=\"{\'active\':user.checked}\">{{user.UserName}}</p><md-checkbox class=\"md-secondary\" ng-checked=\"user.checked\" ng-click=\"vm.choose(user)\"></md-checkbox></md-list-item></md-list></div></div></div></md-content><div class=\"inner-footerbar\" flex=\"none\"><md-toolbar style=\"height:44px;line-height: 44px;\"><md-button ng-click=\"vm.userSubmit(vm.choosed)\">确定</md-button></md-toolbar></div></div>");
$templateCache.put("app/main/xhsc/procedure/gxtest.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:100%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.info.selected.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" sxt-map-check=\"vm.info.current\" inspection-id=\"vm.InspectionId\" procedure=\"vm.info.acceptanceItemID\" ct=\"vm.info\" region-id=\"vm.info.selected.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><slide-menu flex=\"none\" style=\"height: 195px\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></slide-menu><div style=\"display: none\"><sxt-map-check-popup warter=\"vm.water\"></sxt-map-check-popup></div>");
$templateCache.put("app/main/xhsc/procedure/gxzg.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" sxt-recheck-map=\"vm.Rectification.RectificationID\" ct=\"vm.info\" sxt-map-show=\"vm.slideShow\" project-id=\"vm.regionSelect.AreaID\" procedure=\"vm.Rectification.AcceptanceItemID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div></div><sxt-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></sxt-recheck-popup><div style=\"margin-top: 12px;padding:0 8px;margin-bottom:12px;\" flex=\"none\" layout=\"row\"><span ng-click=\"vm.showQuesList()\" style=\"background: url(app/main/xhsc/images/right.png) no-repeat right 2px;background-size:auto 14px;padding-right:12px;\">问题列表详情</span><span flex=\"\"></span><span ng-click=\"vm.showBaseInfor()\" style=\"background: url(app/main/xhsc/images/right.png) no-repeat right 2px;background-size:auto 14px;padding-right:12px;\">基本信息</span></div><sxt-ques-detail-up up-show=\"vm.showUp\" selected-area=\"vm.regionSelect.AreaID\" current-rectificationid=\"vm.RectificationID\"></sxt-ques-detail-up>");
$templateCache.put("app/main/xhsc/procedure/gxzgdetail.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.current.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" flex=\"\" sxt-zg-map-check=\"false\" layout=\"column\" ct=\"vm.info\" inspection-id=\"vm.InspectionId\" sxt-map-show=\"vm.slideShow\" project-id=\"vm.projectId\" disable-inspect=\"true\" disable-drag=\"true\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.current.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div></div><sxt-recheck-popup slide-show=\"vm.slideShow\" slide-role=\"vm.role\"></sxt-recheck-popup><div style=\"margin-top: 12px;padding:0 8px;margin-bottom:12px;\" flex=\"none\" layout=\"row\"><span flex=\"\" ng-click=\"vm.showQuesList()\">问题列表详情</span><span flex=\"\"></span></div><sxt-question-list list-show=\"vm.showList\" list-inspectid=\"vm.InspectionId\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.current.AreaID\"></sxt-question-list>");
$templateCache.put("app/main/xhsc/procedure/gxzgreport.html","<md-tabs flex=\"\"><md-tab flex=\"\" layout=\"column\" label=\"工序验收明细\"><md-tab-content ms-scroll=\"\" class=\"download\" style=\"padding: 0px\"><div flex=\"\" layout=\"column\"><md-content class=\"subheader\" style=\"position:relative;\" flex=\"\" layout-padding=\"\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"gxzgtb\" border=\"0\"><thead><tr><th colspan=\"8\" style=\"text-align: center;\" class=\"head\">{{vm.AcceptanceName}}验收记录表</th></tr><tr><th width=\"12.5%\">项目名称：</th><th colspan=\"3\" width=\"37.5%\">{{vm.result.ProjectName}}</th><th width=\"12.5%\">验收部位</th><th colspan=\"3\" width=\"37.5%\">{{vm.result.CheckAreas}}</th></tr><tr><th width=\"12.5%\">施工单位</th><th width=\"12.5%\">{{vm.result.MainContractorName}}</th><th width=\"12.5%\">项目经理</th><th width=\"12.5%\">{{vm.result.MainContractorHeadName}}</th><th width=\"12.5%\">报验人</th><th width=\"12.5%\">{{vm.result.InspectionUser}}</th><th width=\"12.5%\">报验时间</th><th width=\"12.5%\">{{vm.result.InspectionTime}}</th></tr><tr><th>监理单位</th><th>{{vm.result.SupervisionName}}</th><th>项目总监</th><th>{{vm.result.SupervisionHeadName}}</th><th>验收人</th><th>{{vm.result.SupervisionCollectName}}</th><th>验收时间</th><th>{{vm.result.SupervisionTime}}</th></tr><tr><th>建设单位</th><th>{{vm.result.CompanyName || \'星河地产\'}}</th><th>项目经理</th><th>{{vm.result.CompanyHeadName}}</th><th>验收人</th><th></th><th>验收时间</th><th>{{vm.result.CompanyTime}}</th></tr><tr><th>验收状态</th><th colspan=\"7\">{{vm.result.Status == 2 ? \' 同意\':\'不同意\'}}验收</th></tr></thead><tbody><tr ng-repeat=\"items in vm.result.Areas\"><td colspan=\"8\" style=\"padding:0;\"><table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" class=\"gxtb2\" border=\"0\"><tbody><tr><td colspan=\"8\" style=\"border-top:none;border-right:none;\">{{items.Area}}验收项及验收情况</td></tr><tr><td width=\"12.5%\">序号</td><td width=\"12.5%\">分类</td><td width=\"12.5%\">管控要点</td><td width=\"12.5%\">质量标准</td><td colspan=\"2\" width=\"25%\">问题描述</td><td width=\"12.5%\">验收情况</td><td width=\"12.5%\">复验情况</td></tr></tbody><tbody ng-repeat=\"item in items.Classification\" ng-if=\"item.Children.length\"><tr ng-repeat=\"i in item.Children\" ng-class=\"{\'biaozhu\':i.Inspection == \'不符合\'}\"><td width=\"12.5%\">{{i.ProblemSortName}}</td><td rowspan=\"{{item.rowspan}}\" ng-if=\"$index == 0\" width=\"12.5%\">{{item.ClassificationName}}</td><td width=\"12.5%\">{{i.ControlPoint}}</td><td width=\"12.5%\">{{i.QualityStandard}}</td><td colspan=\"2\" width=\"25%\">{{i.Standard}}</td><td width=\"12.5%\">{{i.Inspection}}</td><td width=\"12.5%\">{{i.ReInspection}}</td></tr></tbody></table></td></tr><tr><td colspan=\"8\" style=\"padding: 0;border-top:none;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"gxtb2\"><tbody><tr><td colspan=\"8\" style=\"border-top:none;border-right:none;\">验收现场照片</td></tr></tbody><tbody ng-repeat=\"pic in vm.pics\"><tr><td colspan=\"2\" ng-repeat=\"p in pic\">{{p.index}}</td></tr><tr><td colspan=\"2\" width=\"25%\" ng-repeat=\"p in pic\"><p style=\"text-align:center;\"><img ng-src=\"{{p.FilenName}}\" width=\"80%\"></p></td></tr></tbody></table></td></tr><tr><td colspan=\"8\" style=\"border-top: none;\">验收问题及原位标注</td></tr><tr ng-repeat=\"area in vm.Regions\"><td colspan=\"4\" width=\"50%\"><div style=\"height:500px;\" class=\"mapcheck\" layout=\"column\" flex=\"\" inspection-id=\"vm.Inspection\" disable-inspect=\"true\" sxt-report-map=\"vm.rectificationIDs\" ct=\"vm.info\" procedure=\"vm.acceptanceItemId\" disable-drag=\"\" region-id=\"area.AreaId\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div></td><td colspan=\"4\"><p>问题描述：</p><p ng-repeat=\"problem in area.Problems\" style=\"word-break: break-all;\">{{problem.ProblemSortName}} {{problem.ProblemDescription}}</p><p ng-if=\"!area.Problems\">合格</p></td></tr><tr><td colspan=\"8\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"gxtb2\"><tbody><tr><td colspan=\"8\" style=\"border-top:none;border-right:none;\">验收问题及整改情况</td></tr></tbody><tbody><tr><td colspan=\"8\" width=\"100%\" style=\"padding:0;border-top:none;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tbody ng-repeat=\"detail in vm.result.Detaileds\"><tr><td width=\"50%\">验收照片</td><td width=\"50%\">整改照片</td></tr><tr><td width=\"50%\"><p style=\"text-align:center;\"><span ng-repeat=\"img in detail.Fronts\"><img ng-src=\"{{img.FileUrl}}\" width=\"90%\"></span></p></td><td width=\"50%\"><p style=\"text-align:center;\"><span ng-repeat=\"img in detail.Backs\"><img ng-src=\"{{img.FileUrl}}\" width=\"90%\"></span></p></td></tr><tr><td colspan=\"2\">问题描述：{{detail.Describe}}</td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></md-content></div></md-tab-content></md-tab></md-tabs><div ng-click=\"vm.goback()\" style=\"position: absolute;right: 8px\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.comeBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div>");
$templateCache.put("app/main/xhsc/procedure/gxzjcheck.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:100%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.info.selected.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" sxt-map-self-check=\"vm.info.current\" ct=\"vm.info\" inspection-id=\"vm.InspectionId\" project-id=\"vm.projectId\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.info.selected.RegionID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><slide-menu flex=\"none\" style=\"height: 195px\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></slide-menu><div style=\"display: none\"><sxt-map-self-check-popup></sxt-map-self-check-popup></div><sxt-selfcheck-popup slide-id=\"vm.pid\" slide-show=\"vm.slideShow\" slide-role=\"\'zj\'\" slide-context=\"vm.context\" slide-inspection=\"vm.InspectionId\"></sxt-selfcheck-popup>");
$templateCache.put("app/main/xhsc/procedure/jlgxtest.html","<md-content style=\"background: transparent;\"><div class=\"gxtest gxtestdetail\"><div style=\"margin-top: 20px;padding-left:8px;\"><span>基本信息</span></div><md-list><md-list-item><label>工序</label><p>工序名称</p></md-list-item><md-list-item><label>部位</label><p>工序名称</p></md-list-item><md-list-item><label>监理单位</label><p>工序名称</p></md-list-item><md-list-item><label>验收人员</label><p>工序名称</p></md-list-item><md-list-item><label>施工单位</label><p>工序名称</p></md-list-item><md-list-item><label>责任人</label><p>工序名称</p></md-list-item><md-list-item><label>验收进度</label><p>工序名称</p></md-list-item><md-list-item><label>验收时间</label><p>工序名称</p></md-list-item><md-list-item><label style=\"width:100px;\">最迟整改时间</label><p>工序名称</p></md-list-item><md-list-item><label>备注信息</label><p>工序名称</p></md-list-item><md-list-item><label>验收状态</label><p>工序名称</p></md-list-item></md-list><div style=\"margin-top: 20px;padding:0 8px;\" flex=\"\" layout=\"row\"><span flex=\"\">遗留问题</span><span flex=\"\"></span><button ui-sref=\"app.xhsc.gx.gxtest\">新建问题</button></div><md-list class=\"gxque\"><md-list-item><span flex=\"none\" style=\"width:100px;\">2号问题</span> <span flex=\"\">二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述</span> <span flex=\"none\" style=\"width:50px;text-align: right;\">3处</span></md-list-item><md-list-item><span flex=\"none\" style=\"width:100px;\">2号问题</span> <span flex=\"\">二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述二号问题描述</span> <span flex=\"none\" style=\"width:50px;text-align: right;\">3处</span></md-list-item></md-list><div><md-content><md-tabs md-dynamic-height=\"\" style=\"background: rgb(245,245,245)\"><md-tab label=\"遗留问题\"><md-content><md-list class=\"gxque\" style=\"margin-top: 0;\"><md-list-item><p style=\"color:#333;\">交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">说明</span><p>交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">首验照片</span><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">备注</span><p>备注信息</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">整改照片</span><p><span class=\"photo\"><i>照片</i><i>1</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span>复验意见</span><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-disabled=\"true\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list></md-content></md-tab><md-tab label=\"已整改问题\"><md-content><md-list class=\"gxque\" style=\"margin-top: 0;\"><md-list-item><p style=\"color:#333;\">交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">说明</span><p>交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">照片</span><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">备注</span><p><input style=\"border:none;width:100%;\"></p></md-list-item><md-list-item><span>验收意见</span><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-model=\"vm.value\" ng-true-value=\"\'符合\'\" ng-init=\"vm.value=\'不符合\'\" ng-false-value=\"\'不符合\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><md-list class=\"gxque\"><md-list-item><p style=\"color:#333;\">交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">说明</span><p>交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内交流单芯电缆不得单独穿于钢导管内</p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">照片</span><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><span style=\"width:60px;display: block;\">备注</span><p><input style=\"border:none;width:100%;\"></p></md-list-item><md-list-item><span>验收意见</span><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-model=\"vm.value\" ng-true-value=\"\'符合\'\" ng-init=\"vm.value=\'不符合\'\" ng-false-value=\"\'不符合\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list></md-content></md-tab></md-tabs></md-content></div><div style=\"margin-top: 20px;padding:0 8px;\" flex=\"\" layout=\"row\"><span>原位标注</span></div><div flex=\"\">图纸</div><md-button flex=\"\" style=\"display: block;width:100%;margin:10px 0;padding:6px;border:1px solid #d8d8d8;background: #fff;\" ng-click=\"vm.showTop()\">提交复检报告</md-button><div class=\"slideTop\" ng-show=\"vm.show\" ng-class=\"{\'slidedown\':vm.show}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>工序名称</p></md-list-item><md-list-item><label>首验照片</label><p><span class=\"photo\"><i>照片</i><i>1</i></span> <span class=\"photo\"><i>照片</i><i>2</i></span></p></md-list-item><md-list-item><label>整改照片</label><p><span class=\"photo\"><i>照片</i><i>2</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\"><img src=\"app/main/xhsc/images/plus.png\" width=\"40\"></md-button></p></md-list-item><md-list-item><label>复验意见</label><p style=\"text-align: right;margin-right:70px;\">{{vm.value}}<md-switch ng-model=\"vm.value\" ng-true-value=\"\'合格\'\" ng-init=\"vm.value=\'不合格\'\" ng-false-value=\"\'不合格\'\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><md-button flex=\"\" style=\"display: block;width:100%;padding:0px;background: #fff;\" ng-click=\"vm.show = false\">确定</md-button></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedure/ngTemp.html","<md-dialog class=\"changetel\"><md-dialog-content style=\"padding:10px;padding-bottom:0;\"><md-list style=\"padding:0;\"><md-list-item ng-repeat=\"s in status|filter:{visible:1}\"><p>{{s.name}}：</p><p class=\"md-secondary\">{{s.num}}处</p></md-list-item></md-list></md-dialog-content><md-dialog-actions style=\"padding:0;\" layout=\"column\"><div layout=\"row\" style=\"width: 100%;\" ng-if=\"(status[0].num >0||status[2].num >0)&&(role ==\'jl\')\"><md-list flex=\"\" style=\"padding:0 10px;\"><md-list-item style=\"padding-left: 16px;\"><p>备注：</p><p class=\"md-secondary\"><input style=\"border:none;\" ng-model=\"remark\"></p></md-list-item><md-list-item><p>最迟整改时间：</p><p class=\"md-secondary\"><md-input-container class=\"md-block\" style=\"margin:0\"><md-select ng-model=\"time\"><md-option ng-repeat=\"time in times\" ng-value=\"time.value\">{{time.time}}</md-option></md-select></md-input-container></p></md-list-item></md-list></div><div layout=\"row\" style=\"min-height: 44px;border-top: 1px solid #dedede;width: 100%\"><a flex=\"\" class=\"new-btn\" ng-click=\"cancel()\">取消</a> <a flex=\"\" class=\"new-btn noborder\" ng-click=\"submit()\">确定</a></div></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/procedure/regionStates.html","<div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == -1}\"><md-button ng-click=\"vm.filter(-1)\" style=\"margin:6px auto;\"><span>全部</span><span>{{vm.nums.qb}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(0)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 0}\"><md-button ng-click=\"vm.filter(0)\" style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未报验</span><span>{{vm.nums.wtj}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(1)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 1}\"><md-button ng-click=\"vm.filter(1)\" style=\"margin:6px auto;\"><span><i class=\"dy\"></i>待验</span><span>{{vm.nums.dy}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(2)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 2}\"><md-button ng-click=\"vm.filter(2)\" style=\"margin:6px auto;\"><span><i class=\"pass\"></i>合格</span><span>{{vm.nums.hg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(4)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 4}\"><md-button ng-click=\"vm.filter(4)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>不合格</span><span>{{vm.nums.bhg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(8)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 8}\"><md-button ng-click=\"vm.filter(8)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>未整改</span><span>{{vm.nums.wzg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(16)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 16}\"><md-button ng-click=\"vm.filter(16)\" style=\"margin:6px auto;\"><span><i class=\"yzg\"></i>已整改</span><span>{{vm.nums.yzg}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loading\"><md-progress-circular md-mode=\"indeterminate\"></md-progress-circular></div><div ng-if=\"h.hasShowRight\" flex=\"\" ng-repeat=\"h in vm.houses\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\" ng-show=\"vm.loading\">{{h.projectTitle }}</p><div class=\"floor-list gxroomlist\" ng-show=\"vm.loading\"><div><md-list><md-list-item ng-if=\"d.hasShowRight\" ng-repeat=\"d in h.Children\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"!d.show\">展开</span><span ng-show=\"d.show\">收起</span></md-button></div><md-list ng-if=\"d.show\" style=\"padding-left:10px;padding-right:10px;\" ng-show=\"vm.maxRegion !=8\"><md-list-item ng-if=\"d.show&&c.hasShowRight&&vm.regionfilterByStatus(c)\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div class=\"room-st {{c.style}}\" ng-click=\"vm.go(c)\" ng-class=\"{\'checked\':c.checked}\"><div style=\"height:100%;width:{{c.Percentage}}%\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"!c.show\">展开</span><span ng-show=\"c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-if=\"c.show&&r.hasShowRight&&vm.regionfilterByStatus(r)\" ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.go(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item></md-list><div layout=\"column\" ng-if=\"d.show&&vm.maxRegion ==8\"><md-list class=\"roomllist\" ng-if=\"d.show\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-if=\"d.show&&r.hasShowRight&&vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.go(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-list></div></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedure/yw.html","<div ng-if=\"vm.yw==0\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.z_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list style=\"overflow-x: hidden;\"><div ng-repeat=\"item in vm.zj_project\" ng-click=\"vm.stretch(item)\" layout=\"column\" style=\"position: relative;margin:0px 3%\"><div layout=\"row\" style=\"position: relative\"><p style=\"font-size:14px;\">{{item.RegionName}}</p><span flex=\"\"></span> <img ng-class=\"{\'transform_90\':item.stretch}\" ng-src=\"app/main/xhsc/images/come_in.svg\"> <span ng-if=\"item.stretch\" class=\"border1px bottom1px\"></span></div><md-list ng-if=\"item.stretch&&item.Children&&item.Children.length\" style=\"padding:0px;margin: 0px;\"><md-list-item ng-click=\"vm.click(k,$event)\" ng-repeat=\"k in item.Children\" layout=\"row\"><p style=\"font-size:12px;padding-left:1%\">{{k.RegionName}}</p><span flex=\"\"></span><md-button ng-click=\"vm.downloadzj(k,$event)\" ng-if=\"!k.isComplete\" style=\"margin: 6px -28px\"><i class=\"icon icon-download s30\"></i></md-button><md-button ng-click=\"vm.zbzjbtnAction(k,$event)\" ng-if=\"k.isComplete\" style=\"margin: 6px -28px\" aria-label=\"More\"></md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div></md-list></div><div ng-if=\"vm.yw==2\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.z_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-repeat=\"item in vm.by_project\" ng-click=\"vm.stretch(item)\" layout=\"column\" style=\"position: relative;margin:0px 3%\"><div layout=\"row\" style=\"position: relative\"><p style=\"font-size:14px;\">{{item.RegionName}}</p><span flex=\"\"></span> <img ng-class=\"{\'transform_90\':item.stretch}\" ng-src=\"app/main/xhsc/images/come_in.svg\"> <span ng-if=\"item.stretch\" class=\"border1px bottom1px\"></span></div><md-list ng-if=\"item.stretch&&item.Children&&item.Children.length\" style=\"padding:0px;margin: 0px;\"><md-list-item ng-click=\"vm.by(k)\" ng-repeat=\"k in item.Children\" layout=\"row\"><p style=\"font-size:12px;padding-left:1%\">{{k.RegionName}}</p><span flex=\"\"></span><md-button ng-click=\"vm.by(k)\" style=\"margin: 6px -28px\" aria-label=\"More\"></md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div></div><div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|filter:{Status:4}\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==16\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.y_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">监理验收</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|filter:{Status:16}\"><div style=\"padding-bottom: 16px\" flex=\"80\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">监理复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/procedure/zbzjAction.html","<md-bottom-sheet><md-list><md-list-item layout=\"row\" style=\"position: relative\"><md-button flex=\"\" style=\"text-align: center;margin: 0px\"><span style=\"color: #359df5;font-size:16px;\">自检</span></md-button><span class=\"border1px bottom1px\" style=\"bottom: 6px\"></span></md-list-item><md-list-item layout=\"row\"><md-button flex=\"\" style=\"text-align: center;margin: 0px\"><span style=\"color: #359df5;font-size:16px\">下载</span></md-button><span class=\"border1px bottom1px\" style=\"bottom: 6px\"></span></md-list-item><md-list-item layout=\"row\"><md-button flex=\"\" style=\"text-align: center;margin: 0px\"><span style=\"color: #359df5;font-size:16px\">取消</span></md-button><span class=\"border1px bottom1px\" style=\"bottom: 6px\"></span></md-list-item></md-list></md-bottom-sheet>");
$templateCache.put("app/main/xhsc/procedure/zjhouseChoose.html","<div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == -1}\"><md-button ng-click=\"vm.filter(-1)\" style=\"margin:6px auto;\"><span>全部</span><span>{{vm.nums.qb}}</span></md-button></md-list-item><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == 0}\"><md-button ng-click=\"vm.filter(0)\" style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未检</span><span>{{vm.nums.wtj}}</span></md-button></md-list-item><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == 1}\"><md-button ng-click=\"vm.filter(1)\" style=\"margin:6px auto;\"><span><i class=\"pass\"></i>已检</span><span>{{vm.nums.ytj}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div ng-if=\"vm.selected\" flex=\"\" ng-repeat=\"h in vm.houses\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\" ng-show=\"vm.loading\">{{h.projectTitle }}</p><div class=\"floor-list gxroomlist\" ng-show=\"vm.loading\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item md-virtual-repeat=\"d in vm.dynamicItems\" md-on-demand=\"\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><md-list ng-show=\"!d.show&&vm.maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-show=\"c.Children.length&&vm.regionfilterByStatus(c)\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selected(c)\" class=\"room-st {{c.style}}\" ng-class=\"{\'checked\':c.checked}\"><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-show=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-show=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-show=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.floors\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list><div layout=\"column\" ng-show=\"!d.show&&vm.maxRegion ==8\"><md-list class=\"roomllist\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-if=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-virtual-repeat-container></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedurepg/_sc.html","<div layout=\"row\" class=\"scTop\"><div flex=\"\" class=\"scleft\"><span>{{vm.info.aItem.MeasureItemName}}：</span><md-button class=\"md-mini\" ng-click=\"vm.scChoose($event)\"><label style=\"margin-bottom: 0;font-weight: normal;\"><span ng-repeat=\"sc in vm.info.MeasureIndexes\" style=\"color:#f00;\">{{sc.IndexName}}</span></label> <img src=\"app/main/xhsc/images/pop.png\" style=\"vertical-align: middle;margin-left: 10px;\"></md-button><span style=\"color:darkslategray;font-style: italic;\">{{vm.info.tooltip}}</span></div></div><sxt-sc-new-v flex=\"\" layout=\"column\" area-id=\"vm.info.areaId\" tooltip=\"vm.info.tooltip\" db=\"vm.info.db\" image-url=\"vm.info.imageUrl\" region-id=\"vm.info.regionId\" region-type=\"vm.info.regionType\" acceptance-item=\"vm.info.acceptanceItemID\" region-name=\"vm.info.name\" measure-indexes=\"vm.info.MeasureIndexes\" pic-relate=\"vm.picRelate\" standar=\"vm.standar\" sc-choose=\"vm.scChoose()\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"!vm.info.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></sxt-sc-new-v><div style=\"display: none\"><sxt-sc-popup-new></sxt-sc-popup-new></div>");
$templateCache.put("app/main/xhsc/procedurepg/chooseArea.html","<md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{ vm.project.data.RegionName}}</h2></div><md-list><md-list-item ng-repeat=\"b in vm.areas\" style=\"width:25%;\"><md-button ng-click=\"vm.go(b)\" style=\"min-width:80px;border: 1px solid #e93030;color:#e93030\"><p>{{b.regionName}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedurepg/scRegion.html","<div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\" ng-if=\"vm.isReport==\'0\'||vm.isReport==0\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == -1}\"><md-button ng-click=\"vm.filter(-1)\" style=\"margin:6px auto;\"><span>全部</span><span>{{vm.nums.qb}}</span></md-button></md-list-item><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == 0}\"><md-button ng-click=\"vm.filter(0)\" style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未检</span><span>{{vm.nums.wtj}}</span></md-button></md-list-item><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == 1}\"><md-button ng-click=\"vm.filter(1)\" style=\"margin:6px auto;\"><span><i class=\"pass\"></i>已检</span><span>{{vm.nums.ytj}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div flex=\"\" ng-if=\"h.selected\" ng-repeat=\"h in vm.houses\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\" ng-show=\"vm.loading\">{{h.FullRegionName }}</p><div class=\"floor-list gxroomlist\" ng-show=\"vm.loading\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item md-virtual-repeat=\"d in vm.building\" class=\"repeat\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><md-list ng-if=\"!d.show&&vm.maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-if=\"c.Children.length&&vm.isRegionShow(c)\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selected(c)\" class=\"room-st {{c.style}}\" ng-class=\"{\'checked\':c.checked}\"><div style=\"height:100%;width:{{c.Percentage}}%\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-if=\"vm.isRegionShow(r)\" ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-show=\"vm.isRegionShow(r)\" ng-repeat=\"r in d.floors\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list><div layout=\"column\" ng-if=\"vm.maxRegion ==8\"><md-list class=\"roomllist\" ng-if=\"!d.show\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-if=\"vm.isRegionShow(r)\" ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-virtual-repeat-container></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedurepg/schztb.html","<div style=\"position: absolute;right: 8px\"><md-button class=\"md-fab md-mini\" ng-click=\"vm.goBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div><div flex=\"\" layout=\"column\"><md-content class=\"subheader\" style=\"position:relative;\" flex=\"\" layout-padding=\"\"><div style=\"font-size: 14px;\">文字说明：<span style=\"padding-right:10px;\">总包</span><span class=\"jlfont\" style=\"padding-right:10px;\">监理</span><span style=\"padding-right:10px;\" class=\"xmfont\">项目部</span></div><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable\"><thead><tr><th colspan=\"24\" style=\"text-align: center;\" class=\"head\">{{vm.info.pname}}</th></tr><tr ng-repeat=\"item in vm.checkUser\"><th colspan=\"10\" rowspan=\"{{vm.checkUser.length}}\" ng-if=\"$index == 0\">项目名称：{{vm.info.name}}</th><th colspan=\"5\">检查人：{{item.UserName}}</th><th colspan=\"9\">检查日期：{{item.MeasureTime}}</th></tr><tr><th style=\"width:60px;text-align: center;\">指标</th><th style=\"text-align: center;white-space: nowrap;\">结果</th><th style=\"text-align: center;white-space: nowrap;\">合格率</th><th ng-repeat=\"i in vm.twentyRows\">{{$index+1}}</th></tr></thead><tbody ng-repeat=\"item in vm.scData\" class=\"parentH\"><tr ng-repeat=\"row in item.rows\" ng-if=\"!item.Children\"><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\"><tr><td style=\"white-space: nowrap;\"><a ui-sref=\"app.xhsc.scsl.schztbdetail({regionId:vm.regionId,itemId:item.AcceptanceIndexID,acceptanceItemID:vm.AcceptanceItemID,relative:vm.db})\">{{item.IndexName}}</a></td></tr></table></td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" align=\"center\"><span ng-repeat=\"n in item.numbers\" ng-class=\"{\'jlfont\':n.Role == 2,\'xmfont\':n.Role == 4}\">{{n.allDot}}</span></td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\"><span ng-repeat=\"n in item.QualifiedRate\" ng-class=\"{\'jlfont\':n.Role == 2,\'xmfont\':n.Role == 4}\">{{n.Value|number:2}}%</span></td><td ng-repeat=\"point in row\" style=\"padding:0 6px;\"><span ng-repeat=\"v in point.MeasureValue|orderBy:\'Role\'\" ng-class=\"{\'yellow\':v.Status == 2,\'red\':v.Status == 3,\'jlfont\':v.Role == 2,\'xmfont\':v.Role == 4}\">{{v.Value}}</span></td></tr><tr ng-repeat=\"row in item.Children\" ng-if=\"item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\" table-auto-height=\"\"><tr ng-repeat=\"row in item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\">{{item.IndexName}}</td><td><a ui-sref=\"app.xhsc.scsl.schztbdetail({regionId:vm.regionId,itemId:item.AcceptanceIndexID,acceptanceItemID:vm.AcceptanceItemID,relative:vm.db})\">{{row.IndexName}}</a></td></tr></table></td><td align=\"center\" rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\" style=\"padding: 0;\"><span ng-class=\"{\'jlfont\':n.Role == 2,\'xmfont\':n.Role == 4}\" ng-repeat=\"n in item.allDot|orderBy:\'Role\'\">{{n.Value}}</span></td><td rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\" style=\"padding:0;\"><span ng-class=\"{\'jlfont\':n.Role == 2,\'xmfont\':n.Role == 4}\" ng-repeat=\"n in item.Qual|orderBy:\'Role\'\">{{n.Value*100|number:2}}%</span></td><td ng-repeat=\"point in row.rows[0]\"><span ng-class=\"{\'yellow\':v.Status == 2,\'red\':v.Status == 3,\'jlfont\':v.Role == 2,\'xmfont\':v.Role == 4}\" ng-repeat=\"v in point.MeasureValue\" ng-bind-html=\"v.Value\"></span></td></tr></tbody></table></md-content></div>");
$templateCache.put("app/main/xhsc/procedurepg/schztbdetail.html","<md-content flex=\"\" layout=\"column\"><sxt-sc-hz-view data=\"vm.data\" flex=\"\" procedure=\"vm.acceptanceItemID\" region-id=\"vm.regionId\"></sxt-sc-hz-view></md-content>");
$templateCache.put("app/main/xhsc/procedurepg/sclist.html","<md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">实测实量</h2></div><md-list layout=\"row\" layout-wrap=\"\"><md-list-item ng-repeat=\"b in vm.procedureData\" style=\"width:25%\"><md-button ng-click=\"vm.go(b)\" style=\"min-width:80px;border:1px solid #e93030;color:#e93030\"><p>{{b.MeasureItemName}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/procedurepg/scslmain.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-swipe-content=\"\"><md-tab label=\"实测实量\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"><md-content class=\"download\" style=\"padding: 0px\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-show=\"vm.isOver\" layout=\"column\"><md-subheader ng-if=\"vm.onlines.length\"><span style=\"margin-left: -18px\">实测列表</span></md-subheader><span class=\"border1px\"></span><div ng-repeat=\"item in vm.offlines track by item.RegionID\" ng-click=\"vm.stretch(item)\" layout=\"column\" style=\"position: relative;margin:0px 3%\"><div layout=\"row\" style=\"position: relative\"><p style=\"font-size:14px;\">{{item.RegionName}}</p><span flex=\"\"></span> <img ng-class=\"{\'transform_90\':item.stretch}\" ng-src=\"app/main/xhsc/images/come_in.svg\"> <span ng-if=\"item.stretch\" class=\"border1px bottom1px\"></span></div><md-list ng-if=\"item.stretch&&item.Children&&item.Children.length\" style=\"padding:0px;margin: 0px;\"><md-list-item ng-click=\"vm.click(k,$event)\" ng-repeat=\"k in item.Children track by k.RegionID\" layout=\"row\"><p style=\"font-size:12px;padding-left:1%\">{{k.RegionName}}</p><span flex=\"\"></span><md-button ng-click=\"vm.download(k,null,$event)\" ng-if=\"!k.isComplete\" style=\"margin: 6px -28px\"><i class=\"icon icon-download s30\"></i></md-button><md-button ng-if=\"k.isComplete\" ng-click=\"vm.uploadW(k,$event)\" style=\"min-width: 40px;width: 40px;padding: 6px 0px;\">上传</md-button><md-button ng-if=\"k.isComplete\" ng-click=\"vm.Refresh(k,$event)\" style=\"min-width: 40px;width: 40px;padding: 6px 0px;margin-right:2px\">刷新</md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div></div></md-content></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/report/reportDefault.html","<md-tabs flex=\"\"><md-tab label=\"汇总清单\"><md-content class=\"download\" style=\"padding: 0px\"><table class=\"summaryReport\"><thead><tr><th>序号</th><th>城市公司</th><th>项目名称</th><th>工序验收报表</th><th>实测实量报表</th></tr></thead><tbody><tr data-ng-repeat=\"item in vm.report\"><td>{{$index+1}}</td><td>{{item.OUName}}</td><td>{{item.ProjectName}}</td><td><table><tr><td>总计</td><td>{{item.Inspection.Count}}</td></tr><tr><td>本月</td><td>{{item.Inspection.Month}}</td></tr><tr><td>本日</td><td>{{item.Inspection.Day}}</td></tr></table></td><td><table><tr><td>总计</td><td>{{item.PQMeasureRecord.Count}}</td></tr><tr><td>本月</td><td>{{item.PQMeasureRecord.Month}}</td></tr><tr><td>本日</td><td>{{item.PQMeasureRecord.Day}}</td></tr></table></td></tr></tbody></table></md-content></md-tab><md-tab label=\"实测报告\"><md-content class=\"download\" style=\"padding: 0px\"><div layout=\"column\"><md-list style=\"padding:0px\"><md-list-item ng-repeat=\"item in vm.projects\" layout=\"row\"><p flex=\"\" style=\"font-size:16px;padding-left:12px;\">{{item.ProjectName}}</p><div class=\"md-secondary\"><md-button ng-click=\"vm.go(item)\" class=\"md-raised md-primary\" style=\"min-width:50px;padding:0px;margin:0px 0px 0px 5px ;line-height:35px\">查看</md-button></div><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></md-content></md-tab><md-tab label=\"验收报告\"><md-tab-content layout=\"column\"><md-content flex=\"\" layout=\"column\"><div flex=\"\" layout=\"row\" class=\"gx-list\" style=\"position: relative\" ng-class=\"{\'narrow\':level == 2}\"><div flex=\"33\" layout=\"column\"><md-content class=\"list-left\" flex=\"\"><md-list ng-cloak=\"\" style=\"padding-top:0;padding-bottom: 0;\"><md-list-item ng-class=\"{\'active\':gx1.checked}\" ng-repeat=\"gx1 in vm.data\"><md-button flex=\"\" ng-click=\"vm.selectSpecialty(gx1)\">{{gx1.SpecialtyName}}</md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></md-content></div><div flex=\"\" ng-show=\"!vm.acceptanceItem.length\" layout=\"column\" style=\"background: #fff;position:relative;\"><md-content class=\"list-right\" flex=\"\"><div class=\"floors\" layout=\"column\"><md-list><md-list-item ng-click=\"vm.selectSpecialtyLow(item)\" layout=\"row\" ng-repeat=\"item in vm.gxClassType\"><p>{{item.SpecialtyName}}</p><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></md-content></div><div flex=\"\" ng-show=\"vm.acceptanceItem.length\" layout=\"column\" style=\"background: #fff;position:relative;\"><md-content class=\"list-right\" flex=\"\"><div class=\"floors\" layout=\"column\"><md-list><md-list-item ng-click=\"vm.choosego(item)\" layout=\"row\" ng-repeat=\"item in vm.acceptanceItem\"><p flex=\"\">{{item.AcceptanceItemName}}</p><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></md-content></div><div ng-show=\"vm.acceptanceItem.length\" style=\"position: absolute;right:5px\"><md-button class=\"md-fab\" ng-click=\"vm.comeBack()\"><md-icon md-svg-src=\"app/main/xhsc/images/icon-comeback.svg\"></md-icon></md-button></div></div></md-content></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/report/ysReport.html","<div flex=\"\" layout=\"column\" class=\"gxdownload\"><md-list><md-list-item ng-repeat=\"item in vm.Inspections\"><div class=\"md-list-item-text\" layout=\"column\"><p layout=\"column\" style=\"padding-right: 120px;font-size:16px;line-height: 20px;padding-left:8px;\">{{item.AcceptanceItemName}}</p><p style=\"color:#999;padding-right: 120px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;\">{{area.RegionName}}</span></p></div><div class=\"md-secondary md-hue-3\" style=\"right:0;margin:0;\" layout=\"row\"><md-button class=\"md-raised md-primary\" ng-click=\"vm.Lookintoys(item)\">查看</md-button></div></md-list-item></md-list></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_accept.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:100%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.info.selected.RegionName}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.btBatch\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" sxt-map-accept=\"vm.info.current\" inspection-id=\"vm.InspectionId\" inspection-area-id=\"vm.info.selected.InspectionAreaID\" procedure=\"vm.info.acceptanceItemID\" ct=\"vm.info\" region-id=\"vm.info.selected.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><sxt-map-accept-popup warter=\"vm.water\"></sxt-map-accept-popup></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_base.html","<div ng-if=\"vm.yw==2\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.z_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div ng-repeat=\"item in vm.by_project\" ng-click=\"vm.stretch(item)\" layout=\"column\" style=\"position: relative;margin:0px 3%\"><div layout=\"row\" style=\"position: relative\"><p style=\"font-size:14px;\">{{item.RegionName}}</p><span flex=\"\"></span><md-icon ng-class=\"{\'transform_90\':item.stretch}\" md-svg-icon=\"app/main/xhsc/images/come_in.svg\"></md-icon><span ng-if=\"item.stretch\" class=\"border1px bottom1px\"></span></div><md-list ng-if=\"item.stretch&&item.Children&&item.Children.length\" style=\"padding:0px;margin: 0px;\"><md-list-item ng-click=\"vm.by(k)\" ng-repeat=\"k in item.Children\" layout=\"row\"><p style=\"font-size:12px;padding-left:1%\">{{k.RegionName}}</p><span flex=\"\"></span><md-button ng-click=\"vm.by(k)\" style=\"margin: 6px -28px\" aria-label=\"More\"></md-button></md-list-item></md-list><span class=\"border1px bottom1px\"></span></div></div><div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==16\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.y_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">监理验收</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">监理复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_createTemplate.html","<md-dialog aria-label=\"新建\" style=\"min-height: 250px;width: 80%;max-width: 450px\" ng-cloak=\"\"><md-dialog-content layout=\"column\" style=\"margin:15px 8px 8px 0px\"><form name=\"myForm\" flex=\"\" layout=\"column\"><md-input-container><label>主题</label> <input ng-model=\"subject\" required=\"\" name=\"subject\"><div ng-messages=\"myForm.subject.$error\"><div ng-message-exp=\"[\'required\']\">主题不能为空</div></div></md-input-container><md-input-container><label>项目</label><md-select ng-model=\"currentProject\" required=\"\" name=\"currentProject\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in projects\">{{item.RegionName}}</md-option></md-select><div ng-messages=\"myForm.currentProject.$error\"><div ng-message=\"required\">项目不能为空</div></div></md-input-container><md-input-container><label>分期</label><md-select ng-model=\"currentArea\" required=\"\" name=\"currentArea\" ng-model-options=\"{trackBy: \'$value.RegionID\'}\"><md-option ng-value=\"item\" ng-repeat=\"item in currentProject.Children\">{{item.RegionName}}</md-option></md-select><div ng-messages=\"myForm.currentArea.$error\"><div ng-message=\"required\">分期不能为空</div></div></md-input-container><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\">取消</md-button><md-button type=\"submit\" flex=\"\" ng-disabled=\"myForm.$invalid\" ng-click=\"ok(myForm)\">确定</md-button></div></form></md-dialog-content></md-dialog>,");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_house.html","<div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\" ng-class=\"{\'active\':vm.filterNum == -1}\"><md-button ng-click=\"vm.filter(-1)\" style=\"margin:6px auto;\"><span>全部</span><span>{{vm.nums.qb}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(0)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 0}\"><md-button ng-click=\"vm.filter(0)\" style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未报验</span><span>{{vm.nums.wtj}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(1)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 1}\"><md-button ng-click=\"vm.filter(1)\" style=\"margin:6px auto;\"><span><i class=\"dy\"></i>待验</span><span>{{vm.nums.dy}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(2)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 2}\"><md-button ng-click=\"vm.filter(2)\" style=\"margin:6px auto;\"><span><i class=\"pass\"></i>合格</span><span>{{vm.nums.hg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(4)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 4}\"><md-button ng-click=\"vm.filter(4)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>不合格</span><span>{{vm.nums.bhg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(8)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 8}\"><md-button ng-click=\"vm.filter(8)\" style=\"margin:6px auto;\"><span><i class=\"ng\"></i>未整改</span><span>{{vm.nums.wzg}}</span></md-button></md-list-item><md-list-item ng-if=\"vm.statusRight(16)\" flex=\"\" ng-class=\"{\'active\':vm.filterNum == 16}\"><md-button ng-click=\"vm.filter(16)\" style=\"margin:6px auto;\"><span><i class=\"yzg\"></i>已整改</span><span>{{vm.nums.yzg}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div flex=\"\" ng-repeat=\"h in vm.houses\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\" ng-show=\"vm.loading\">{{h.projectTitle }}</p><div class=\"floor-list gxroomlist\" ng-show=\"vm.loading\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item md-virtual-repeat=\"d in vm.dynamicItems\" class=\"repeat\" md-on-demand=\"\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><md-list ng-if=\"!d.show&&vm.maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-if=\"c.Children.length&&vm.regionfilterByStatus(c)\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selected(c)\" class=\"room-st {{c.style}}\" ng-class=\"{\'checked\':c.checked}\"><div style=\"height:100%;width:{{c.Percentage}}%\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-if=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-show=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.floors\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list><div layout=\"column\" ng-if=\"!d.show&&vm.maxRegion ==8\"><md-list class=\"roomllist\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-if=\"vm.regionfilterByStatus(r)\" ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selected(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-virtual-repeat-container></div></div></md-content><safe-dialog dialog-show=\"vm.showmyDialog\" call-back=\"vm.callBack()\" dialog-data=\"vm.data\" dialog-sure=\"报验\" dialog-msg=\"\"></safe-dialog>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_item.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs flex=\"\" ng-if=\"vm.show\"><md-tab ng-if=\"vm.showTab(gx1)\" ng-repeat=\"gx1 in vm.data\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"item.WPAcceptanceList.length\" ng-repeat=\"item in gx1.SpecialtyChildren\"><md-subheader class=\"md-no-sticky\" style=\"background:#f0f0f0\">{{item.SpecialtyName}}</md-subheader><md-list-item ng-click=\"vm.choosego(k)\" style=\"background: white;\" ng-repeat=\"k in item.WPAcceptanceList\"><p flex=\"\">{{k.AcceptanceItemName}}</p><md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_main.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" ng-if=\"vm.isOver&&vm.role==0||vm.role==32\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.setModule(2)\"><img src=\"app/main/xhsc/images/zbby.png\"><p>安全报验</p></li><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>安全整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.zbzgAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">安全整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.isOver&&!(vm.role==0||vm.role==32)\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.setModule(16)\"><img src=\"app/main/xhsc/images/jlys.png\"><p>安全验收</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>安全复验</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px;\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">安全验收</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item layout=\"row\" style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\" flex=\"80\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">安全复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/safe_civiliz_rectify.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" points=\"vm.points\" sxt-safe-recheck=\"vm.Rectification.RectificationID\" ct=\"vm.info\" sxt-map-show=\"vm.slideShow\" inspection-id=\"vm.InspectionID\" procedure=\"vm.Rectification.AcceptanceItemID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div><sxt-safe-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></sxt-safe-recheck-popup><sxt-ques-detail-up up-show=\"vm.showUp\" selected-area=\"vm.regionSelect.AreaID\" current-rectificationid=\"vm.RectificationID\"></sxt-ques-detail-up>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfDynamicAccept.html","<ms-gen-select flex=\"none\" areas=\"areas\" procedure=\"procedure\" current=\"current\"></ms-gen-select><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" sxt-dynamic-accept=\"vm.info.current\" inspection-id=\"vm.InspectionId\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><sxt-dynamic-accept-popup warter=\"vm.water\"></sxt-dynamic-accept-popup></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfDynamicBase.html","<div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==16\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.y_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">监理验收</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list><md-list-item ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">监理复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfDynamicMain.html","<div flex=\"\" ng-if=\"vm.role==0\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>动态危险源整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}}<span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.role==2\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.create()\"><img src=\"app/main/xhsc/images/jlys.png\"><p>新建检查</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>动态危险源复验</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px\">动态危险源</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span style=\"display:inline-block;line-height:22px;padding-top: 8px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{item.AcceptanceItemName}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">周安全复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;\"><span ng-repeat=\"area in item.Children\" style=\"display: block;height: 24px\">{{area.RegionName}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfDynamicRectify.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" sxt-dynamic-recheck=\"vm.Rectification.RectificationID\" ct=\"vm.info\" sxt-map-show=\"vm.slideShow\" inspection-id=\"vm.InspectionID\" procedure=\"vm.Rectification.AcceptanceItemID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div><sxt-dynamic-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></sxt-dynamic-recheck-popup><sxt-ques-detail-up up-show=\"vm.showUp\" selected-area=\"vm.regionSelect.AreaID\" current-rectificationid=\"vm.RectificationID\"></sxt-ques-detail-up>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfWeekAccept.html","<ms-gen-select flex=\"none\" areas=\"areas\" procedure=\"procedure\" level=\"4\" current=\"current\" arear-id=\"vm.areaId\" name=\"\'检查项\'\"></ms-gen-select><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" sxt-week-accept=\"vm.info.current\" inspection-id=\"vm.InspectionId\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><sxt-week-accept-popup warter=\"vm.water\"></sxt-week-accept-popup></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfWeekBase.html","<div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">周安全复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfWeekMain.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" ng-if=\"vm.isOver&&vm.role==0||vm.role==32\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>安全整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.isOver&&!(vm.role==0||vm.role==32)\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.create()\"><img src=\"app/main/xhsc/images/jlys.png\"><p>新建检查</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>安全复查</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:12px;margin-bottom: 0px\"><span style=\"margin-left:1%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px;white-space: nowrap\">安全检查</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display:inline-block;line-height:22px;padding-top: 8px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">安全复查</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/sfWeekRectify.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" points=\"vm.points\" flex=\"\" sxt-week-recheck=\"\" ct=\"vm.info\" sxt-map-show=\"vm.slideShow\" inspection-id=\"vm.InspectionID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div><sxt-week-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></sxt-week-recheck-popup>");
$templateCache.put("app/main/xhsc/xxjd/xxjdbuilding.html","<div layout=\"column\" flex=\"\"><bar-chart config=\"vm.data.config\" data=\"vm.data.data\"></bar-chart><div flex=\"\" style=\"position: relative;\"><div layout=\"row\" style=\"position: absolute;bottom:0;left:50%;transform: translateX(-50%)\" flex=\"\"><building-detail build-data=\"vm.build\" build-len=\"vm.buildLen\" bdetail-data=\"vm.data.data\"></building-detail></div></div></div>");
$templateCache.put("app/main/xhsc/xxjd/xxjdbuildings.html","<div id=\"floorlayer\" style=\"margin:10px 0;position:relative;\">{{sxtfloor}}<building-list style=\"float:left;\" ng-repeat=\"sxtfloor in vm.builds\" sxtfloor=\"sxtfloor\" floor-num=\"vm.builds.floorNum\" builds-len=\"vm.buildLen\"></building-list><div style=\"clear:both;display:table;\"></div></div>");
$templateCache.put("app/main/xhsc/xxjd/xxjdmain.html","<div flex=\"\" layout=\"column\" ui-view=\"\"><md-toolbar id=\"subtoolbar\"><div class=\"md-toolbar-tools\"><md-button aria-label=\"现场实景\" ng-click=\"vm.playSxt()\" flex=\"\">现场实景</md-button><span class=\"hr\"></span><md-button aria-label=\"质量总表\" style=\"min-width:10px!important;\" flex=\"\">质量总表</md-button><span class=\"hr\"></span><md-button aria-label=\"一户一档\" style=\"min-width:10px!important;\" flex=\"\">一户一档</md-button></div></md-toolbar><sxt-area-show flex=\"\" project-id=\"vm.project.projectId\" project-name=\"vm.project.projectName\"></sxt-area-show></div>");
$templateCache.put("app/main/xhsc/yf/yfAccept.html","<ms-gen-select flex=\"none\" areas=\"areas\" procedure=\"procedure\" arear-id=\"vm.areaId\" current=\"current\" level=\"5\" lay=\"\'row\'\" name=\"\'专业\'\"></ms-gen-select><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" cycle-accept=\"vm.info.current\" inspection-id=\"vm.InspectionId\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\" ctr=\"vm\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><cycle-accept-popup warter=\"vm.water\"></cycle-accept-popup></div>");
$templateCache.put("app/main/xhsc/yf/yfBase.html","<div ng-if=\"vm.yw==4\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div><div ng-if=\"vm.yw==32\" flex=\"none\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.f_isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">验房复验</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><md-icon md-svg-icon=\"app/main/xhsc/images/more_vert.svg\"></md-icon></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list>/</div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/xhsc/yf/yfMain.html","<div flex=\"\" ng-if=\"vm.role==0\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadzb\"><ul><li ng-click=\"vm.setModule(4)\"><img src=\"app/main/xhsc/images/zbzg.png\"><p>验房整改</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.zbzgAction(item)\" layout=\"row\" ng-repeat=\"item in vm.zglist|zgFilter:[1,8]\"><div layout=\"column\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">总包整改</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\">{{item.Describe}}</p></div><span flex=\"\"></span><md-button ng-click=\"vm.zbzgbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div><div flex=\"\" ng-if=\"vm.role==2||vm.role==4||vm.role==8\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\"><div class=\"gxheadjl\"><ul><li ng-click=\"vm.create()\"><img src=\"app/main/xhsc/images/jlys.png\"><p>新建验房</p></li><li ng-click=\"vm.setModule(32)\"><img src=\"app/main/xhsc/images/jlfy.png\"><p>验房复查</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-list ng-show=\"vm.isOver\" style=\"background-color: #FFFFFF\"><md-list-item style=\"background-color: #FFFFFF\" layout=\"row\" ng-click=\"vm.jlysAction(item)\" ng-repeat=\"item in vm.Inspections\"><div layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:12px;margin-bottom: 0px\"><span style=\"margin-left:1%;color:white;background-color: #359df5;font-size:12px;border-radius: 3px;white-space: nowrap\">验房检查</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display:inline-block;line-height:22px;padding-top: 8px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item><md-list-item style=\"background-color: #FFFFFF\" ng-click=\"vm.jlfyAction(item)\" ng-repeat=\"item in vm.zglist|zgFilter:[64]\"><div style=\"padding-bottom: 16px\" layout=\"column\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 12px\"><span style=\"margin-left:1%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px;white-space: nowrap\">验房复查</span></p><p style=\"color:#999;padding-right: 20px;margin:0;font-size:12px;padding-left:8px;line-height: 22px\"><span style=\"display: block;height: 24px\">{{item.Describe}}</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlfybtnAction(item,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/yf/yfRectify.html","<div flex=\"none\" style=\"position: relative;\" class=\"downcaret\"><div layout=\"row\" flex=\"\" style=\"height:48px;border-bottom: 1px solid #d8d8d8;position: relative;z-index: 10;background: rgb(245,245,245);\"><p ng-click=\"vm.qyslide()\" style=\"font-size:14px;padding:0 10px;text-align: center;margin: 0;height:48px;line-height:48px;width:70%;margin-left:auto;margin-right:auto;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\">{{vm.regionSelect.RegionName||\'区域\'}} <span class=\"caret\"></span></p></div><div flex=\"\" layout=\"row\" class=\"gxtest qyslide\" ng-class=\"{\'qydown\':vm.qyslideShow}\"><md-list layout=\"column\" flex=\"\" class=\"gxplist\"><md-list-item flex=\"\" ng-repeat=\"p in vm.pareaList\"><p ng-click=\"vm.selectQy(p)\">{{p.RegionName}}</p></md-list-item></md-list></div></div><div class=\"mapcheck\" layout=\"column\" flex=\"\" cycle-recheck=\"\" ct=\"vm.info\" sxt-map-show=\"vm.slideShow\" points=\"vm.points\" inspection-id=\"vm.InspectionID\" procedure=\"vm.Rectification.AcceptanceItemID\" disable-inspect=\"vm.role==\'zb\'\" disable-drag=\"\" region-id=\"vm.regionSelect.AreaID\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div></div><cycle-recheck-popup slide-show=\"vm.slideShow\" warter=\"vm.warter\" slide-role=\"vm.role\"></cycle-recheck-popup>");
$templateCache.put("app/main/xhsc/ys/Choose.html","<div flex=\"none\" layout=\"column\" style=\"max-height:60px;height:60px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" style=\"background:#fff;padding:0;border-bottom: 1px solid #d8d8d8;\"><md-list-item flex=\"20\" style=\"border-bottom: 2px solid #ff3434\"><md-button ng-click=\"vm.filter()\" style=\"margin:0 auto;\"><span>全部</span><span>(15)</span></md-button></md-list-item><md-list-item flex=\"20\"><md-button ng-click=\"vm.filter()\" style=\"margin:0 auto;\"><span><i class=\"pass\"></i>合格</span><span>(15)</span></md-button></md-list-item><md-list-item flex=\"20\"><md-button ng-click=\"vm.filter()\" style=\"margin:0 auto;\"><span><i class=\"ng\"></i>不合格</span><span>(15)</span></md-button></md-list-item><md-list-item flex=\"20\"><md-button ng-click=\"vm.filter()\" style=\"margin:0 auto;\"><span><i class=\"wait\"></i>待验</span><span>(15)</span></md-button></md-list-item><md-list-item flex=\"20\"><md-button ng-click=\"vm.filter()\" style=\"margin:0 auto;\"><span><i class=\"yet\"></i>未报验</span><span>(15)</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;\">{{vm.projectTitle }}</p><div class=\"floor-list gxroomlist\"><div><md-list style=\"padding:0 10px;\"><md-list-item ng-repeat=\"d in vm.houses.Children\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">折叠</span></md-button></div><md-list slide-up-down=\"\" ng-value=\"!d.show\"><md-list-item ng-repeat=\"c in d.Children\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\"><span class=\"roomname\">{{c.RegionName}}</span><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">折叠</span></md-button></div><md-list class=\"roomllist\" slide-up-down=\"\" ng-value=\"!c.show\"><md-list-item ng-repeat=\"r in c.Children\"><md-button ng-click=\"vm.chroom(r)\">{{r.RegionName}}</md-button></md-list-item></md-list></div></md-list-item></md-list></div></md-list-item></md-list></div></div></md-content><my-dialog dialog-show=\"vm.showmyDialog\" dialog-data=\"vm.data\" dialog-sure=\"报检\" dialog-msg=\"\"></my-dialog>");
$templateCache.put("app/main/xhsc/ys/addPartDescription.html","<md-dialog ng-cloak=\"\" style=\"max-width:50%;width:50%;\" class=\"questionlist\"><md-dialog-content layout=\"row\"><div layout=\"column\" flex=\"\"><div layout=\"row\">部位</div><div layout=\"row\" flex=\"\"><md-input-container class=\"md-block\" flex=\"\"><input ng-model=\"data.PartDescriptioin\" placeholder=\"请填写部位，可为空\"></md-input-container></div></div></md-dialog-content><md-dialog-actions><md-button class=\"md-raised\" ng-click=\"submit()\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/addQuestion.html","<md-dialog ng-cloak=\"\" style=\"max-width:90%;width:90%;\" class=\"questionlist\"><md-dialog-content layout=\"row\"><div layout=\"column\" flex=\"\"><div layout=\"row\">新增问题点</div><div layout=\"row\" flex=\"\"><md-input-container class=\"md-block\" flex=\"none\"><label>分值</label> <input ng-model=\"data.DeductValue\" type=\"number\" step=\"0.1\"></md-input-container><md-input-container required=\"\" class=\"md-block\" flex=\"\"><label>描述</label> <input ng-model=\"data.ProblemDescription\"></md-input-container></div></div></md-dialog-content><md-dialog-actions><md-button class=\"md-raised\" ng-click=\"cancel()\">取消</md-button><md-button class=\"md-raised\" ng-click=\"submit(e,$event)\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/ch1.html","<md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\"><md-list><md-list-item><md-button ui-sref=\"app.xhsc.evaluatelist({AssessmentID:vm.id,RegionID:vm.fq.RegionID,RegionName:vm.fq.RegionName,AssessmentTypeID:vm.assessmentTypeID})\">{{vm.fq.RegionName}}</md-button></md-list-item></md-list><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">抽检区域</h2></div><md-list><md-list-item style=\"width: 50%\" ng-repeat=\"b in vm.ms\"><md-button ui-sref=\"app.xhsc.evaluatelist({AssessmentID:b.AssessmentID,RegionID:b.RegionID,RegionName:b.RegionName,AssessmentTypeID:b.AssessmentTypeID})\"><p>{{b.fullName}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/ys/ch2.html","<md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in vm.ms\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.TemplateName}}</h2></div><md-list><md-list-item ng-repeat=\"b in m.Regions\" style=\"float: left;width: 50%\"><md-button ui-sref=\"app.xhsc.sc2(b)\"><p>{{b.name}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/ys/ch3.html","<md-content class=\"floor-list md-hue-1\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in vm.ms\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.TemplateName}}</h2></div><md-list><md-list-item ng-repeat=\"b in m.Regions\"><md-button ui-sref=\"app.xhsc.sctb(b)\"><p>{{b.name}}</p></md-button></md-list-item></md-list></div></div></md-content>");
$templateCache.put("app/main/xhsc/ys/ch31.html","<md-tabs flex=\"\" md-border-bottom=\"\"><md-tab ng-repeat=\"s in vm.sections.Sections\" label=\"{{s.SectionName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in s.MeasurItems\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.MeasureItemName}}</h2></div><md-list><div layout=\"row\" layout-wrap=\"\"><div flex=\"33\" ng-repeat=\"b in m.ExtractionRegions\"><md-button class=\"md-raised md-block\" style=\"display: block; text-align:left;\" ui-sref=\"app.xhsc.sctb({db:s.AssessmentID,regionId:b.RegionID,measureItemID:m.AcceptanceItemID,name:b.FullRegionName,pname:m.MeasureItemName})\">{{b.FullRegionName}}</md-button></div></div></md-list></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/ch3_pc.html","<md-tabs flex=\"\" md-border-bottom=\"\"><md-tab ng-repeat=\"s in vm.sections.Sections\" label=\"{{s.SectionName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div class=\"right engineer\"><div layout=\"column\" ng-repeat=\"m in s.MeasurItems\"><div style=\"border-bottom: 1px solid #d8d8d8;\"><h2 class=\"md-title\" style=\"color:#e93030;font-size:16px;margin:16px;\">{{m.MeasureItemName}}</h2></div><md-list><div layout=\"row\" layout-wrap=\"\"><div flex=\"33\" ng-repeat=\"b in m.ExtractionRegions\"><md-button class=\"md-raised md-block\" style=\"display: block; text-align:left;\" ui-sref=\"app.pc.sctb({db:s.AssessmentID,regionId:b.RegionID,measureItemID:m.AcceptanceItemID,name:b.FullRegionName,pname:m.MeasureItemName})\">{{b.FullRegionName}}</md-button></div></div></md-list></div></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/checkHouse.html","");
$templateCache.put("app/main/xhsc/ys/chooseHouse.html","<div flex=\"\" layout=\"row\" style=\"max-height:48px;height:48px;position: absolute;top:0;width:100%;\"><md-list flex=\"\" layout=\"row\" style=\"background:#fff;padding:0;\" class=\"filter\"><md-list-item flex=\"25\" ng-class=\"{\'active\':vm.tabStatus == -1}\" ng-click=\"vm.myFilter(\'-1\')\"><span>全部</span></md-list-item><md-list-item flex=\"25\" ng-class=\"{\'active\':vm.tabStatus == 0}\" ng-click=\"vm.myFilter(\'0\')\"><span class=\"yet\"><i></i>未测量</span></md-list-item><md-list-item flex=\"25\" ng-class=\"{\'active\':vm.tabStatus == 1}\" ng-click=\"vm.myFilter(\'1\')\"><span class=\"ing\"><i></i>测量中</span></md-list-item><md-list-item flex=\"25\" ng-class=\"{\'active\':vm.tabStatus == 2}\" ng-click=\"vm.myFilter(\'2\')\"><span class=\"done\"><i></i>已测量</span></md-list-item></md-list></div><md-content layout=\"row\" flex=\"\" class=\"floor-list\" style=\"border-top:1px solid #d8d8d8;margin-top:48px;\" ng-show=\"vm.loadCircle\"><div style=\"text-align: right;width:100%;position: relative;\"><div style=\"position: absolute;right:60px;\"><md-progress-circular class=\"md-accent md-hue-1\" md-diameter=\"70\"></md-progress-circular></div></div></md-content><md-content layout=\"row\" flex=\"\" class=\"floor-list\" style=\"border-top:1px solid #d8d8d8;margin-top:48px;\" ng-show=\"!vm.loadCircle\"><div flex=\"40\" layout=\"column\" style=\"border-right:1px solid #d8d8d8;background: #fff;\"><md-content style=\"background: #fff;;padding-bottom:44px;\"><md-list ng-cloak=\"\" class=\"md-padding\"><md-divider></md-divider><md-list-item ng-repeat=\"item in vm.Region| myFilter:vm.tabStatus\" ng-click=\"vm.open(item)\" ng-class=\"{\'active\':item.actived}\"><p ng-class=\"{\'ing\':item.status==1,\'done\':item.status==2,\'yet\':item.status==0}\">{{item.RegionName }}</p><md-icon class=\"md-secondary go\" ng-click=\"vm.goMeasure()\" md-font-icon=\"icon-pencil\"></md-icon><md-icon class=\"md-secondary\" ng-show=\"item.showArr\" md-font-icon=\"icon-chevron-right\"></md-icon><md-divider></md-divider></md-list-item></md-list></md-content></div><div flex=\"60\" layout=\"column\" class=\"right\"><md-content style=\"background: #fff;;padding-bottom:44px;\"><div class=\"search\"><div class=\"search_bar\" ng-click=\"vm.search()\"><i ng-if=\"!vm.showSearch && !vm.number\" class=\"searchicon\"></i> <input type=\"text\" class=\"inputtext\" ng-model=\"vm.number\" ng-blur=\"vm.hideSearch()\" placeholder=\"搜索\"></div></div><div ng-repeat=\"floor in vm.current.Children |filter:vm.number|myFilter:vm.tabStatus\" layout=\"column\"><h3><div class=\"header\"><div class=\"margin\" ng-class=\"{\'ing\':floor.status==1,\'done\':floor.status==2,\'yet\':floor.status==0}\"><md-button ng-click=\"vm.changeStat(floor,vm.floors)\"><p>{{floor.RegionName}}</p><i ng-if=\"vm.muti\" style=\"position: absolute;right:5px;top:6px;\" class=\"myselect\" ng-class=\"{\'selected\':floor.selected}\"></i></md-button></div></div></h3><md-list><md-list-item ng-repeat=\"room in floor.Children | filter:vm.number|myFilter:vm.tabStatus\"><md-button ng-click=\"vm.changeStat(room,floor.Children)\" ng-class=\"{\'ing\':room.status==1,\'done\':room.status==2,\'yet\':room.status==0}\"><p>{{ room.RegionName}}</p><i style=\"position: absolute;right:5px;top:6px;\" ng-if=\"vm.muti\" class=\"myselect\" ng-class=\"{\'selected\':room.selected}\"></i></md-button></md-list-item></md-list></div></md-content></div></md-content><div class=\"inner-footerbar\" ng-if=\"vm.muti\"><md-toolbar><md-list flex=\"\" layout=\"row\" style=\"background:#fff;padding:0;\"><md-list-item flex=\"\" style=\"border-right:1px solid #d8d8d8;\"><md-button style=\"color:#000;\">取消选择</md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"color:#000;\">确定</md-button></md-list-item></md-list></md-toolbar></div>");
$templateCache.put("app/main/xhsc/ys/ddetail.html","<div layout=\"column\" class=\"ddetail\"><div class=\"detailTop\"><div class=\"dTopl\" flex=\"\"><h3>星河智慧一期现场评估</h3><p>2016年 第一季度</p></div><div class=\"dTopr\"><a><md-progress-circular md-mode=\"determinate\" value=\"80\" md-diameter=\"30\"></md-progress-circular><md-icon></md-icon></a></div></div><md-list class=\"detaillist\"><md-list-item layout=\"row\"><div class=\"md-list-item-text\" flex=\"\"><p class=\"alread\"><span>图片文件</span>(245/245 files)</p><p style=\"text-align: center\">60%</p><p><md-progress-linear md-mode=\"determinate\" value=\"60\"></md-progress-linear></p></div></md-list-item><md-list-item><div class=\"md-list-item-text\" flex=\"\"><p class=\"downing\"><span>图片文件</span>(245/245 files)</p><p style=\"text-align: center\">60%</p><p><md-progress-linear md-mode=\"determinate\" value=\"60\"></md-progress-linear></p></div></md-list-item><md-list-item><div class=\"md-list-item-text\" flex=\"\"><p class=\"not\"><span>图片文件</span>(245/245 files)</p><p style=\"text-align: center\">60%</p><p><md-progress-linear md-mode=\"determinate\" value=\"60\"></md-progress-linear></p></div></md-list-item></md-list></div>");
$templateCache.put("app/main/xhsc/ys/detailChoose.html","<md-dialog aria-label=\"1\" ng-cloak=\"\" style=\"background:transparent;box-shadow: none;max-width:100%;width:100%;\" class=\"e-dialog\"><md-dialog-actions><md-list flex=\"\" layout=\"row\"><md-list-item flex=\"\"><md-button ng-click=\"cancel()\" ui-sref=\"app.xhsc.ch3({assessmentID:item.AssessmentID})\" md-autofocus=\"\"><img ng-src=\"app/main/xhsc/images/measure.png\"></md-button></md-list-item><md-list-item flex=\"\"><md-button ui-sref=\"app.xhsc.stzlDetail({assessmentID:item.AssessmentID})\" ng-click=\"cancel()\"><img ng-src=\"app/main/xhsc/images/quality.png\"></md-button></md-list-item><md-list-item flex=\"\"><md-button><img ng-src=\"app/main/xhsc/images/manage.png\"></md-button></md-list-item><md-list-item flex=\"\"><md-button><img ng-src=\"app/main/xhsc/images/culture.png\"></md-button></md-list-item></md-list></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/download.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-swipe-content=\"\"><md-tab label=\"评估列表\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"><md-content class=\"download\" style=\"padding: 0px\"><div layout=\"column\"><md-subheader ng-if=\"vm.offlines.length\">已下载列表</md-subheader><span class=\"border1px\"></span><md-list><md-list-item style=\"margin: 0px -32px\" ng-repeat=\"item in vm.offlines\"><img style=\"margin-left: 32px;\" src=\"app/main/xhsc/images/icon-downed.png\" class=\"md-avatar\"><p layout=\"column\" style=\"padding-right: 230px;font-size:18px;\">{{item.AssessmentSubject}}</p><div class=\"md-secondary md-hue-3\"><md-button ng-click=\"vm.showECs($event,item)\" class=\"md-raised md-primary\">评估</md-button><md-button ng-click=\"vm.delete(item,$event)\" class=\"md-raised md-primary\" style=\"vertical-align: top;border:1px solid #0185f1;\">删除</md-button><md-button class=\"md-raised upload-btn\" ng-click=\"vm.download(item,true)\">重下</md-button><span style=\"display:inline-block;text-align: center;\"><md-button ng-click=\"vm.upload(item)\" class=\"md-raised upload-btn\"><md-progress-circular ng-show=\"item.uploading && item.progress && item.progress!=100\" value=\"{{item.progress}}\" md-diameter=\"20\"></md-progress-circular>上传</md-button></span></div><span class=\"border1px bottom1px\"></span></md-list-item></md-list><md-subheader ng-if=\"vm.onlines.length\">未下载列表</md-subheader><span class=\"border1px\"></span><md-list><md-list-item style=\"margin: 0px -32px\" ng-repeat=\"item in vm.onlines\"><img src=\"app/main/xhsc/images/icon-down.png\" style=\"margin-left: 32px;\" class=\"md-avatar\"><p layout=\"column\" style=\"font-size: 18px;padding-right: 100px;\">{{item.AssessmentSubject}}</p><div class=\"md-secondary md-hue-3\"><span style=\"display:inline-block;padding-right: 20px;\"><md-button class=\"md-raised upload-btn\" ng-click=\"vm.download(item)\">下载</md-button></span></div><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></md-content></md-tab-content></md-tab><md-tab label=\"项目汇总列表\"><md-tab-content style=\"padding: 0px;\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"><md-content class=\"download\" style=\"padding: 0px\"><div layout=\"column\"><md-input-container id=\"auto\" md-no-float=\"\" class=\"md-block\" style=\"margin-bottom: 0;margin-top: 6px;max-height: 36px\"><input ng-model=\"vm.searchText\" type=\"text\" placeholder=\"关键字查找\"></md-input-container><md-list><md-list-item style=\"margin: 0px -32px\" ng-repeat=\"item in vm.projects|cnFilter:{fullName:vm.searchText}\" \"=\"\"><img src=\"app/main/xhsc/images/icon-downed.png\" style=\"margin-left: 32px;\" class=\"md-avatar\"><p layout=\"column\" style=\"padding-right: 230px;font-size:18px;\">{{item.fullName}}</p><div class=\"md-secondary md-hue-3\"><span style=\"display:inline-block;text-align: center;\"><md-button class=\"md-raised upload-btn\" ui-sref=\"app.xhsc.ch31({year:item.Year,projectID:item.ProjectID,quarter:item.Quarter,assessmentStage:item.AssessmentStage})\">实测</md-button></span></div><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></md-content></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/evaluate.html","<md-content layout=\"row\" style=\"background: #fff;\" flex=\"\"><md-list class=\"evaluate\" style=\"padding:32px 16px;\"><md-list-item class=\"evaluate-item\" ng-click=\"vm.showECs($event)\"><div class=\"evaluate-itemwrap\"><div class=\"left\"><p>2015年<br>第一季度</p></div><div class=\"md-list-item-text compact\"><p>星河某某第一期现场评估</p></div></div></md-list-item><md-list-item class=\"evaluate-item\" ng-click=\"vm.showECs($event)\"><div class=\"evaluate-itemwrap\"><div class=\"left\"><p>2015年<br>第一季度</p></div><div class=\"md-list-item-text compact\"><p>星河某某第一期现场评估</p></div></div></md-list-item><md-list-item class=\"evaluate-item\" ng-click=\"vm.showECs($event)\"><div class=\"evaluate-itemwrap\"><div class=\"left\"><p>2015年<br>第一季度</p></div><div class=\"md-list-item-text compact\"><p>星河某某第一期现场评估</p></div></div></md-list-item><md-list-item class=\"evaluate-item\" ng-click=\"vm.showECs($event)\"><div class=\"evaluate-itemwrap\"><div class=\"left\"><p>2015年<br>第一季度</p></div><div class=\"md-list-item-text compact\"><p>星河某某第一期现场评估</p></div></div></md-list-item></md-list><div layout=\"row\" style=\"width: 100%;display: none;\"><div style=\"position: absolute;left: 50%;top:50%;transform: translate(-50%,-50%)\"><img src=\"app/main/xhsc/images/bg.png\"><p style=\"font-size: 14px;text-align: center;margin-top: 16px;\">当前无评估任务</p></div></div></md-content>");
$templateCache.put("app/main/xhsc/ys/evaluateChoose.html","<md-dialog aria-label=\"1\" ng-cloak=\"\" style=\"background:transparent;box-shadow: none;max-width:100%;width:100%;\" class=\"e-dialog\"><md-dialog-actions><md-list flex=\"\" layout=\"row\"><md-list-item flex=\"\"><md-button ng-click=\"goSC(item)\"><img ng-src=\"app/main/xhsc/images/measure.png\"></md-button></md-list-item><md-list-item flex=\"\"><md-button ng-click=\"goST(item)\"><img ng-src=\"app/main/xhsc/images/quality.png\"></md-button></md-list-item><md-list-item flex=\"\"><md-button ng-click=\"goAQ(item)\"><img ng-src=\"app/main/xhsc/images/culture.png\"></md-button></md-list-item></md-list></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/evaluateQues.html","<md-dialog ng-cloak=\"\" style=\"max-width:90%;width:90%;\" class=\"questionlist\"><md-dialog-content layout=\"row\"><div layout=\"column\" flex=\"\"><div layout=\"row\" flex=\"\" ng-if=\"Problems.length\"><md-list flex=\"\"><md-list-item flex=\"\" layout=\"row\" ng-repeat=\"e in Problems\" ng-click=\"answer(e,$event)\"><md-button class=\"md-secondary\" ng-click=\"vm.show = true\">分值：<span ng-if=\"!vm.show\">{{e.DeductValue}}</span><md-input-container ng-if=\"vm.show\"><input ng-model=\"e.DeductValue\"></md-input-container></md-button><p>{{e.ProblemDescription}}</p><md-divider></md-divider></md-list-item></md-list></div><div layout=\"row\"><md-button ng-click=\"addQuestion()\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></div></div></md-dialog-content></md-dialog>");
$templateCache.put("app/main/xhsc/ys/evaluateQuesDetail.html","<md-dialog ng-cloak=\"\" style=\"max-width:90%;width:90%;\" class=\"quesdetail\"><md-toolbar><div class=\"md-toolbar-tools\"><span flex=\"\"></span><md-button class=\"md-icon-button\" ng-click=\"cancel()\"><md-icon class=\"icon s24\" md-font-icon=\"icon-close\"></md-icon></md-button></div></md-toolbar><md-dialog-content><div flex=\"\" layout=\"row\" style=\"border-bottom: 1px solid #d8d8d8;margin-bottom: 10px;\"><p flex=\"\" style=\"margin-bottom: 0\"><span>{{item.ProblemDescription}}</span><md-button ng-click=\"addPhoto(question)\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></p><md-button class=\"md-button\" ng-click=\"delete(item)\" style=\"margin:0;\"><md-icon style=\"width: 28px;height:28px;\"><img src=\"app/main/xhsc/images/del1.png\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" layout-wrap=\"\"><div flex=\"50\" ng-repeat=\"img in images\" sxt-images=\"images\" style=\"text-align: center;margin-bottom: 10px;\"><img ng-src=\"{{img.ImageByte}}\" style=\"width: 450px;\" flex=\"95\"></div></div><div>{{item.PartDescriptioin ? \'部位: \' + item.PartDescriptioin:\'\'}}</div></md-dialog-content></md-dialog>");
$templateCache.put("app/main/xhsc/ys/evaluateRecord.html","<md-dialog aria-label=\"Mango (Fruit)\" ng-cloak=\"\" style=\"background:transparent;box-shadow: none;max-width:100%;width:100%;\" class=\"typeNumber\"><md-dialog-actions><md-list flex=\"\" layout=\"row\" layout-wrap=\"\" layout-fill=\"\"><md-list-item flex=\"\" flex-sm=\"30\" md-autofocus=\"\"><md-button ng-click=\"answer(0.5)\"><span>0.5</span></md-button></md-list-item><md-list-item flex=\"\" flex-sm=\"30\"><md-button ng-click=\"answer(1)\"><span>1</span></md-button></md-list-item><md-list-item flex=\"\" flex-sm=\"30\"><md-button ng-click=\"answer(1.5)\"><span>1.5</span></md-button></md-list-item><md-list-item flex=\"\" flex-sm=\"30\"><md-button ng-click=\"answer(2)\"><span>2</span></md-button></md-list-item><md-list-item flex=\"\" flex-sm=\"30\"><md-button ng-click=\"answer(0.5)\"><span>2.5</span></md-button></md-list-item><md-list-item flex=\"\" flex-sm=\"30\"><md-button ng-click=\"answer(0.5)\"><span>3</span></md-button></md-list-item></md-list></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/evaluateinput.html","<md-dialog aria-label=\"Mango (Fruit)\" ng-cloak=\"\" style=\"background:#fff;box-shadow: none;max-width:100%;width:100%;\"><md-dialog-content><md-input-container class=\"md-block\"><input ng-model=\"evaluateNote\" autofocus=\"\"></md-input-container></md-dialog-content><md-dialog-actions><md-button ng-click=\"answer(evaluateNote)\" class=\"md-raised md-mini\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/evaluatelist.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-selected=\"vm.selectedIndex\" class=\"zlpkwrap\"><md-tab label=\"{{b.AssessmentClassificationName}}\" ng-repeat=\"b in vm.items.AssessmentClassifys\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div flex=\"none\" layout=\"row\" style=\"border-top: solid 1px silver\" class=\"zlpkheader\"><div flex=\"25\" style=\"border-right: 1px solid #d8d8d8;\">检测内容</div><div flex=\"35\" style=\"border-right: 1px solid #d8d8d8;\">评判标准</div><div flex=\"40\" layout=\"row\"><div flex=\"\" style=\"border-right: 1px solid #d8d8d8;\">扣分标准</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">权重</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">扣分</div><div flex=\"none\" style=\"width:50px;text-align: center;\">得分</div></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\"><md-content flex=\"\" class=\"zlpksub\"><section class=\"zlpklist\" ng-repeat=\"c in b.AssessmentClassifys\"><md-subheader><div layout=\"row\" class=\"zlpksubheader\"><span>{{c.AssessmentClassificationName}}</span></div></md-subheader><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"zlpktables\"><tr ng-repeat=\"e in c.AssessmentClassifys\"><td style=\"width:{{vm.getW(1,2)}}%;\"><p>{{e.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"f in e.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(2,b.level)}}%;\"><p>{{f.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"g in f.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(3,b.level)}}%;\"><p>{{g.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"item in g.AssessmentItems\"><td style=\"width:{{vm.getWidth(4,b.level)}}%\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:{{vm.getWidth(5,b.level)}}%\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr ng-repeat=\"region in item.regions\"><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">{{region.RegionName}}</td><td colspan=\"4\" class=\"lr\" style=\"position: relative;padding:3px 0;\"><span style=\"display: block;float: left;line-height: 36px;height: 36px;margin-top: 6px;margin-bottom: 6px;\">&nbsp;&nbsp;扣分信息：</span><p style=\"margin: 0;padding-right: 95px;margin-left:75px;\"><span ng-repeat=\"q in region.question\"><md-button style=\"min-width: 50px;\" ng-click=\"vm.quesDetail(q,item,region.question)\"><md-icon style=\"width:25px;height:25px;\"><img ng-src=\"{{ q.hasPic?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\" width=\"25\"></md-icon>{{q.DeductionScore}}</md-button></span><md-button style=\"min-width: 50px;\" aria-label=\"\" ng-if=\"!region.done\" ng-click=\"vm.check(item,$event)\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></p><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button></td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:6.25%;\"><p>{{item.AssessmentCheckItemName}}{{item}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr ng-repeat=\"region in item.regions\"><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">{{region.RegionName}}</td><td colspan=\"4\" class=\"lr\" style=\"position: relative;padding:3px 0;\"><span style=\"display: block;float: left;line-height: 36px;height: 36px;margin-top: 6px;margin-bottom: 6px;\">&nbsp;&nbsp;扣分信息：</span><p style=\"margin: 0;padding-right: 95px;margin-left:75px;\"><span ng-repeat=\"q in region.question\"><md-button style=\"min-width: 50px;\" ng-click=\"vm.quesDetail(q,item,region.question)\"><md-icon style=\"width:25px;height:25px;\"><img ng-src=\"{{ q.hasPic?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\" width=\"25\"></md-icon>{{q.DeductionScore}}</md-button></span><md-button style=\"min-width: 50px;\" aria-label=\"\" ng-if=\"!region.done\" ng-click=\"vm.check(item,$event)\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></p><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"region.question.length==0 && item.Weight==item.Score\" ng-click=\"vm.unfit(region,item)\" ng-class=\"{\'done\':region.done}\">撤消</md-button></td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:{{vm.getW(2,2)}}%\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr ng-repeat=\"region in item.regions\"><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">{{region.RegionName}}</td><td colspan=\"4\" class=\"lr\" style=\"position: relative;padding:3px 0;\"><span style=\"display: block;float: left;line-height: 36px;height: 36px;margin-top: 6px;margin-bottom: 6px;\">&nbsp;&nbsp;扣分信息：</span><p style=\"margin: 0;padding-right: 95px;margin-left:75px;\"><span ng-repeat=\"q in region.question\"><md-button style=\"min-width: 50px;\" ng-click=\"vm.quesDetail(q,item,region.question)\"><md-icon style=\"width:25px;height:25px;\"><img ng-src=\"{{ q.hasPic?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\" width=\"25\"></md-icon>{{q.DeductionScore}}</md-button></span><md-button style=\"min-width: 50px;\" aria-label=\"\" ng-if=\"!region.done\" ng-click=\"vm.check(item,$event)\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></p><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"region.question.length==0 && item.Weight==item.Score\" ng-click=\"vm.unfit(region,item)\" ng-class=\"{\'done\':region.done}\">撤消</md-button></td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in c.AssessmentItems\"><td style=\"width:25%;\"><p>{{item.AssessmentCheckItemName}}{{vm.levels}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr ng-repeat=\"region in item.regions\"><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">{{region.RegionName}}</td><td colspan=\"4\" class=\"lr\" style=\"position: relative;padding:3px 0;\"><span style=\"display: block;float: left;line-height: 36px;height: 36px;margin-top: 6px;margin-bottom: 6px;\">&nbsp;&nbsp;扣分信息：</span><p style=\"margin: 0;padding-right: 95px;margin-left:75px;\"><span ng-repeat=\"q in region.question\"><md-button style=\"min-width: 50px;\" ng-click=\"vm.quesDetail(q,item,region.question)\"><md-icon style=\"width:25px;height:25px;\"><img ng-src=\"{{ q.hasPic?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\" width=\"25\"></md-icon>{{q.DeductionScore}}</md-button></span><md-button style=\"min-width: 50px;\" aria-label=\"\" ng-if=\"!region.done\" ng-click=\"vm.check(item,$event)\"><md-icon><img src=\"app/main/xhsc/images/plus.png\"></md-icon></md-button></p><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"region.question.length==0 && item.Weight==item.Score\" ng-click=\"vm.unfit(region,item)\" ng-class=\"{\'done\':region.done}\">撤消</md-button></td></tr></table></td></tr></table></td></tr></table></section></md-content></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/evaluatelist_pc.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-selected=\"vm.selectedIndex\" class=\"zlpkwrap\"><md-tab label=\"{{b.AssessmentClassificationName}}\" ng-repeat=\"b in vm.items.AssessmentClassifys\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div flex=\"none\" layout=\"row\" style=\"border-right:0\" class=\"zlpkheader\"><div flex=\"\" layout=\"row\"><div flex=\"10\">检测内容</div><div flex=\"35\" style=\"border-left: 1px solid #d8d8d8;\">评判标准</div><div flex=\"55\" layout=\"row\"><div flex=\"\" style=\"border-left: 1px solid #d8d8d8;\">{{vm.isAddScore?\'加\':\'扣\'}}分标准</div><div style=\"width: 70px;border-left: 1px solid #d8d8d8;\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">评估对象</div><div flex=\"none\" style=\"width:50px; border-left: 1px solid #d8d8d8;border-right:1px solid #d8d8d8;text-align: center;\">权重</div><div flex=\"none\" ng-repeat=\"x in vm.sections\" layout=\"column\" class=\"bd\"><div flex=\"none\" layout=\"row\"><div flex=\"none\" class=\"bdtop\">{{x.SectionName}}</div></div><div flex=\"none\" layout=\"row\"><div flex=\"none\" style=\"width:50px;text-align: center;height:23px;line-height: 23px;\">{{vm.isAddScore?\'加\':\'扣\'}}分</div><div flex=\"none\" style=\"width:50px; border-left: 1px solid #d8d8d8;text-align: center;height:23px;line-height: 23px;\">得分</div></div></div></div></div><div flex=\"none\" fix-scrollbar-width=\"md-content.zlpksub\"></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\"><md-content flex=\"\" class=\"zlpksub\"><section class=\"zlpklist\" ng-if=\"c.show\" ng-repeat=\"c in b.AssessmentClassifys\"><md-subheader><div layout=\"row\" class=\"zlpksubheader\"><span>{{c.AssessmentClassificationName}}</span></div></md-subheader><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"zlpktables\"><tr ng-if=\"e.show\" ng-repeat=\"e in c.AssessmentClassifys\"><td style=\"width:{{vm.getW(1,2)}}%;\"><p>{{e.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-if=\"f.show\" ng-repeat=\"f in e.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(2,b.level)}}%;\"><p>{{f.AssessmentClassificationName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 70px\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">扣分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width:10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr><tr ng-if=\"item.show\" ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:5.26%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width:70px;text-align: center\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.isAddScore?\'加\':\'扣\'}}分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width: 10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr></table></td></tr><tr ng-if=\"item.show\" ng-repeat=\"item in c.AssessmentItems\"><td style=\"width:10%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:38.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width:70px;text-align: center;\" ng-if=\"vm.showfitObj && !(vm.isAddScore||vm.isDScore)\">{{item.ApplicableObjectName}}</td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width:100px;\" ng-repeat=\"k in vm.sections\"><table fit-table-height=\"\" style=\"width: 100px;\"><tr><td style=\"width: 50px;text-align: center;\" class=\"lr\"><button ng-if=\"vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.bindSectionScore(item,k.SectionID,\"DelScore\")}}</span></button> <button ng-if=\"!vm.showkf(item,k.SectionID,\'DelScore\')\" ng-click=\"vm.changeScore(item,k,$event)\"><span style=\"color: #0fb2fb\">{{vm.isAddScore?\'加\':\'扣\'}}分</span></button></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{vm.bindSectionScore(item,k.SectionID,\"ModifyScore\")}}</td></tr></table></td></tr><tr ng-if=\"!vm.showfitObj\" ng-repeat=\"m in item.AssessmentItemResults\"><td colspan=\"{{3+vm.sections.length*2+(vm.showfitObj?1:0)}}\"><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><td style=\"width: 10%\"><p>{{vm.getSectionName(m.SectionID)}}</p></td><td><table ng-if=\"m.AssessmentRegionItemResults.length\" fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"region in m.AssessmentRegionItemResults\"><td><table fit-table-height=\"\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:120px;text-align:left\"><p>{{region.RegionName}}</p></td><td><span ng-if=\"region.DeductScoreItems.length\" ng-repeat=\"q in region.DeductScoreItems\"><md-button ng-click=\"vm.quesDetail(q,region,$event)\"><md-icon style=\"width:16px;height:16px;\"><img ng-src=\"{{q.Images && q.Images.length?\'app/main/xhsc/images/pic.png\':\'app/main/xhsc/images/text.png\'}}\"></md-icon><span style=\"padding-left:3px\">{{q.DeductionScore}}</span></md-button></span><md-button ng-if=\"!region.DeductScoreItems.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></tr></table></td></tr></table><md-button ng-if=\"!m.AssessmentRegionItemResults.length\" aria-label=\"\" class=\"md-button\">符合要求</md-button></td></table></td></tr></table></td></tr></table></section></md-content></div></md-tab-content></md-tab><md-tab label=\"项目评分汇总表\" ng-if=\"vm.inited\"><md-tab-content style=\"padding: 0px\" flex=\"\" layout-fill=\"\" layout=\"column\" layout-padding=\"\" class=\"zb\"><div flex=\"none\" layout=\"row\" style=\"text-align: center;font-size:20px;border-right:0;padding: 0 8px;\"><div flex=\"\"><div style=\"text-align: center;width:100%;\">{{vm.params.year}} 年第 {{vm.params.quarter}}季度{{vm.toTalReport.projectName}}得分汇总表</div><table class=\"reportWrap\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><thead><tr><th style=\"text-align: center;font-size: 16px;font-family: \'Roboto\'\">检查评估项</th><th style=\"text-align: center;width:120px;font-size: 16px;font-family: \'Roboto\'\" ng-repeat=\"k in vm.toTalReport.Sections\">{{k.SectionName}}</th><th style=\"text-align: center;width:120px;font-size: 16px;font-family: \'Roboto\'\">备注</th></tr></thead></table></div><div flex=\"none\" fix-scrollbar-width=\"md-content.zlpksub\"></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\" style=\"padding: 0 8px;\"><md-content flex=\"\" class=\"zlpksub\"><table class=\"reportWrap\" width=\"99.9%\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td rowspan=\"2\" class=\"td_left\" style=\"padding-left: 10px;\">项目部得分</td><td colspan=\"{{vm.prjScores.length}}\"><span ng-if=\"vm.prjScores.avg\">{{vm.prjScores.avg*100|number:2}} %</span></td><td class=\"td_left\" style=\"width:120px\"></td></tr><tr><td style=\"width:120px\" ng-repeat=\"k in vm.prjScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td rowspan=\"2\" class=\"td_left\" style=\"padding-left: 10px;\">监理得分</td><td colspan=\"{{vm.jlScores.length}}\"><span ng-if=\"vm.jlScores.avg\">{{vm.jlScores.avg*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td ng-repeat=\"k in vm.jlScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr><tr><td class=\"td_left\" style=\"padding-left: 10px;\">总包得分</td><td ng-repeat=\"k in vm.zbScores\"><span ng-if=\"k.Score\">{{k.Score*100|number:2}} %</span></td><td class=\"td_left\"></td></tr></tbody><tbody><tr ng-repeat=\"k in vm.toTalReport.AssessmentTypes\"><td colspan=\"5\"><table class=\"report\" style=\"width: 100%\"><tr><td style=\"text-align: left;padding-left: 10px;\" colspan=\"{{k.CategorySections && k.CategorySections.length?1:vm.toTalReport.Sections.length+1}}\"><h3>{{k.AssessmentTypeName}}</h3></td><td style=\"width:120px;\" ng-repeat=\"n in k.CategorySections\">{{n.ScroePercent * 100|number:2}} {{n.ScroePercent||n.ScroePercent===0?\'%\':\'\'}}</td><td style=\"width:120px;\"></td></tr><tr ng-repeat=\"m in k.AssessmentCategorys\"><td class=\"td_left\" style=\"padding-left: 10px;\">{{m.AssessmentClassificationName}}</td><td style=\"width:120px;\" ng-repeat=\"n in m.sectionScore\">{{n.ScroePercent * 100|number:2}} {{n.ScroePercent||n.ScroePercent===0?\'%\':\'\'}}</td><td style=\"width:120px;\"></td></tr></table></td></tr></tbody></table></md-content></div></md-tab-content></md-tab></md-tabs><div flex=\"none\" style=\"position: absolute;top:45%;left:45%;\"><md-progress-circular md-mode=\"indeterminate\" ng-show=\"vm.loading\"></md-progress-circular></div>");
$templateCache.put("app/main/xhsc/ys/glxwInput.html","<md-dialog ng-cloak=\"\" aria-label=\"修改分值信息\" class=\"glxwdialog\"><md-dialog-content layout=\"column\"><div layout=\"row\" flex=\"\"></div><p class=\"md-title\" style=\"margin-bottom: 10px;\">分值</p><p>请输入分值，作为最终此项目的{{item.isAddScore?\'加\':\'扣\'}}分值。0分为不{{item.isAddScore?\'加\':\'扣\'}}分</p><div layout=\"row\"><md-input-container flex=\"\"><input placeholder=\"\" ng-model=\"item.value\" type=\"number\"></md-input-container></div><div ng-if=\"((item.value||item.value === 0) && showfitObj)||item.reason\"><p>{{item.isAddScore?\'加\':\'扣\'}}分原因</p><div layout=\"row\"><md-input-container flex=\"\"><input ng-model=\"item.reason\"></md-input-container></div></div></md-dialog-content><md-dialog-actions layout=\"row\"><md-button class=\"md-raised\" ng-hide=\"item.isAddScore||item.isDScore\" ng-click=\"noScore(item)\">符合要求</md-button><span flex=\"\"></span><md-button class=\"md-raised\" ng-click=\"cancel()\">取消</md-button><md-button class=\"md-raised\" ng-click=\"delScore(item)\" style=\"margin-right:20px;\">确定</md-button></md-dialog-actions></md-dialog>");
$templateCache.put("app/main/xhsc/ys/glxwSetting.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-swipe-content=\"\" md-selected=\"vm.selectedIndex\" class=\"zlpkwrap\"><md-tab label=\"{{b.AssessmentClassificationName}}\" ng-repeat=\"b in vm.items.AssessmentClassifys\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div flex=\"none\" layout=\"row\" style=\"border-top: solid 1px silver\" class=\"zlpkheader\"><div flex=\"25\">检测内容</div><div flex=\"35\">评判标准</div><div flex=\"40\" layout=\"row\"><div flex=\"\" style=\"border-right: 1px solid #d8d8d8;\">扣分标准</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">权重</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">扣分</div><div flex=\"none\" style=\"width:50px;text-align: center;\">得分</div></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\"><md-content flex=\"\" class=\"zlpksub\"><section class=\"zlpklist\" ng-repeat=\"c in b.AssessmentClassifys\"><md-subheader><div layout=\"row\" class=\"zlpksubheader\"><span>{{c.AssessmentClassificationName}}</span></div></md-subheader><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"zlpktables\"><tr ng-repeat=\"e in c.AssessmentClassifys\"><td style=\"width:{{vm.getW(1,2)}}%;\"><p>{{e.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"f in e.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(2,b.level)}}%;\"><p>{{f.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"g in f.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(3,b.level)}}%;\"><p>{{g.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"item in g.AssessmentItems\"><td style=\"width:{{vm.getWidth(4,b.level)}}%\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:{{vm.getWidth(5,b.level)}}%\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr><td colspan=\"5\" style=\"text-align: right\"><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button></td></tr><tr><td colspan=\"5\" style=\"text-align: right\"><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:6.25%;\"><p>{{item.AssessmentCheckItemName}}{{item}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:{{vm.getW(2,2)}}%\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr><td colspan=\"5\" style=\"text-align: right\"><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in c.AssessmentItems\"><td style=\"width:25%;\"><p>{{item.AssessmentCheckItemName}}{{vm.levels}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{ vm.getDelValue(item) }}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.Score}}</td></tr><tr><td colspan=\"5\" style=\"text-align: right\"><md-button aria-label=\"\" class=\"md-button md-raised zdybtn\" ng-if=\"(!region.question || region.question.length==0) && (item.Weight!=item.Score)\" ng-click=\"vm.fit(region,item)\" ng-class=\"{\'done\':region.done}\">符合要求</md-button></td></tr></table></td></tr></table></section></md-content></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/login.html","<md-content class=\"login\" layout=\"column\"><div id=\"login\"><div id=\"login-form-wrapper\" layout=\"column\" layout-align=\"center center\" layout-align-xs=\"center start\"><div id=\"login-form\" style=\"padding:40px 60px;background: rgba(255,255,255,.95);border-radius:8px;box-shadow: 0 0 8px #ccc;width: 50%;position: absolute;top:50%;left: 50%;transform: translate(-50%,-50%);\"><div class=\"logo1\"><span><img src=\"app/main/xhsc/images/logo.png\"></span></div><form name=\"loginForm\" novalidate=\"\" ng-submit=\"vm.login(loginForm)\"><div class=\"login-name\"><md-input-container class=\"md-block\" md-no-float=\"\"><md-icon md-svg-src=\"app/main/auth/images/user.svg\"></md-icon><input type=\"text\" name=\"username\" ng-model=\"vm.form.username\" placeholder=\"请输入用户名\" required=\"\"></md-input-container><md-divider></md-divider><md-input-container class=\"md-block\" md-no-float=\"\"><md-icon md-svg-src=\"app/main/auth/images/password.svg\"></md-icon><input type=\"password\" name=\"password\" ng-model=\"vm.form.password\" placeholder=\"请输入密码\" required=\"\"></md-input-container></div><md-checkbox>记住用户名</md-checkbox><div layout=\"row\" layout-align=\"center center\"><md-button type=\"submit\" flex=\"\" class=\"md-raised md-warn\" aria-label=\"登录\" translate=\"LOGIN.LOG_IN\" translate-attr-aria-label=\"LOGIN.LOG_IN\">登录</md-button></div></form></div></div></div></md-content>");
$templateCache.put("app/main/xhsc/ys/pcQuestion.html","<md-dialog ng-cloak=\"\" style=\"max-width:90%;width:90%;\" class=\"quesdetail\"><md-toolbar><div class=\"md-toolbar-tools\"><span flex=\"\"></span><md-button class=\"md-icon-button\" ng-click=\"cancel()\"><md-icon class=\"icon s24\" md-font-icon=\"icon-close\"></md-icon></md-button></div></md-toolbar><md-dialog-content><div flex=\"\" layout=\"row\" style=\"border-bottom: 1px solid #d8d8d8;margin-bottom: 10px;\"><p flex=\"\" style=\"margin-bottom: 0\"><span>{{item.ProblemDescription}}</span></p></div><div flex=\"\" layout=\"row\" layout-wrap=\"\"><div flex=\"50\" ng-repeat=\"img in item.images\" sxt-images=\"images\" style=\"text-align: center;margin-bottom: 10px;\"><img ng-src=\"{{img.ImageUrl}}\" style=\"width: 450px;\" flex=\"95\"></div></div><div>{{item.PartDescriptioin ? \'部位: \' + item.PartDescriptioin:\'\'}}</div></md-dialog-content></md-dialog>");
$templateCache.put("app/main/xhsc/ys/sc.html","<div layout=\"row\" class=\"scTop\"><div flex=\"none\" class=\"scleft\"><md-button class=\"md-fab md-mini\" style=\"line-height: 24px\" ng-click=\"vm.nextRegion(true)\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-left\"></md-icon></md-button><span>{{ vm.info.name}}</span><md-button class=\"md-fab md-mini\" style=\"line-height: 24px\" ng-click=\"vm.nextRegion()\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-right\"></md-icon></md-button></div><md-button class=\"md-link md-primary md-mini\" ng-click=\"vm.submit()\">提交</md-button><div flex=\"\" class=\"scright\"><span>{{vm.info.tips}}</span></div></div><div flex=\"none\" layout=\"row\" style=\"border-bottom: 1px solid rgba(0, 0, 0, 0.117647)\"><md-tabs md-dynamic-height=\"\" flex=\"\" md-selected=\"vm.selectedIndex\"><md-tab ng-repeat=\"m in vm.MeasureIndexes\" label=\"{{m.IndexName}}\"></md-tab></md-tabs></div><sxt-sc-map flex=\"\" area-id=\"vm.info.areaId\" project=\"vm.project\" image-url=\"vm.info.imageUrl\" region-id=\"vm.info.regionId\" region-type=\"vm.info.regionType\" acceptance-item=\"vm.info.acceptanceItemID\" region-name=\"vm.info.name\" tips=\"vm.info.tips\" measure-indexes=\"vm.MeasureIndexes\" current-index=\"vm.selectedIndex\"></sxt-sc-map><div style=\"display: none\"><sxt-sc-map-popup></sxt-sc-map-popup></div>");
$templateCache.put("app/main/xhsc/ys/sc2.html","<div layout=\"row\" class=\"scTop\"><div flex=\"\" class=\"scleft\"><span>当前测量项：</span><md-button class=\"md-mini\" ng-click=\"vm.scChoose($event)\"><label style=\"margin-bottom: 0;font-weight: normal;\"><span ng-repeat=\"sc in vm.info.MeasureIndexes\" style=\"color:#f00;\">{{sc.IndexName}}、</span></label> <img src=\"app/main/xhsc/images/pop.png\" style=\"vertical-align: middle;margin-left: 10px;\"></md-button><span style=\"color:darkslategray;font-style: italic;\">{{vm.info.tooltip}}</span></div><div flex=\"none\" class=\"scright\"><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;\" ng-click=\"vm.nextRegion(true)\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-left\"></md-icon></md-button><span style=\"font-size:16px;display: inline-block;vertical-align: middle;\">{{ vm.info.name}}</span><md-button class=\"md-fab\" style=\"line-height: 24px;width:36px;height:36px;\" ng-click=\"vm.nextRegion()\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-right\"></md-icon></md-button></div></div><div flex=\"none\" layout=\"row\" style=\"border-bottom: 1px solid rgba(0, 0, 0, 0.117647);display: none;\"><md-tabs md-dynamic-height=\"\" flex=\"\" md-selected=\"vm.selectedIndex\"><md-tab ng-repeat=\"m in vm.MeasureIndexes\" label=\"{{m.IndexName}}\"></md-tab></md-tabs></div><sxt-sc flex=\"\" area-id=\"vm.info.areaId\" tooltip=\"vm.info.tooltip\" db=\"vm.info.db\" image-url=\"vm.info.imageUrl\" region-id=\"vm.info.regionId\" region-type=\"vm.info.regionType\" acceptance-item=\"vm.info.acceptanceItemID\" region-name=\"vm.info.name\" measure-indexes=\"vm.info.MeasureIndexes\"></sxt-sc><div style=\"display: none\"><sxt-sc-popup></sxt-sc-popup></div>");
$templateCache.put("app/main/xhsc/ys/scChoose.html","<md-dialog aria-label=\"Mango (Fruit)\" class=\"scchoose\" id=\"scchoose\"><md-toolbar><div class=\"md-toolbar-tools\"><h2>请选择测量项</h2><span flex=\"\"></span><md-button class=\"md-icon-button\" ng-disabled=\"getIsChecked()\" ng-click=\"answer(scList)\">确定</md-button></div></md-toolbar><md-dialog-content><md-list><md-list-item ng-repeat=\"sc in scList\" ng-click=\"checkSc(sc)\"><p ng-class=\"{\'red\':sc.checked}\">{{sc.IndexName}}</p><md-switch class=\"md-secondary\" ng-model=\"sc.checked\"></md-switch></md-list-item></md-list></md-dialog-content></md-dialog>");
$templateCache.put("app/main/xhsc/ys/scd.html","<md-content layout-padding=\"\"><div layout=\"row\" layout-align=\"left center\"><span>第</span><md-select ng-model=\"vm.info.t\" style=\"margin:5px 0 10px 0;\"><md-option ng-repeat=\"t in vm.info.Numbers\" value=\"{{t.MeasureRecordID}}\">{{t.Number}}</md-option></md-select><span>次</span></div><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" class=\"zdytable\"><tr><td colspan=\"{{vm.cols + 5}}\" style=\"text-align: center;\" class=\"head\">{{vm.info.aItem.MeasureItemName}}</td></tr><tr><td colspan=\"{{vm.oneCols}}\">项目名称:{{vm.info.name}}</td><td colspan=\"{{vm.twoCols}}\">检查人:{{vm.person}}</td><td colspan=\"{{vm.twoCols}}\">检查日期:{{vm.time}}</td></tr><tr><td align=\"center\">内容</td><td style=\"width:120px;text-align: center;\">位置</td><td align=\"center\">结果</td><td align=\"center\">最大偏差</td><td align=\"center\">合格率</td><td ng-repeat=\"i in vm.alItem[0].Points\" align=\"center\">{{$index+1}}</td></tr><tr ng-repeat=\"item in vm.alItem\"><td rowspan=\"{{vm.alItem.length}}\" colspan=\"1\" class=\"procedurename\" ng-if=\"$index==0\"><p>{{vm.info.aItem.MeasureItemName}}</p></td><td>{{item.IndexName}}</td><td align=\"center\" class=\"normal\" ng-class=\"{\'redColor\':item.ResultStatus == 2}\">{{item.passText}}</td><td align=\"center\">{{item.MaximumDeviation}}</td><td align=\"center\">{{item.QualifiedRate}}</td><td ng-repeat=\"point in item.Points\" align=\"center\">{{point.MeasureValue}}</td></tr></table></md-content>");
$templateCache.put("app/main/xhsc/ys/scdetail.html","<md-content flex=\"\" class=\"subheader\" style=\"position:relative;\" layout-padding=\"\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable zdytable\"><thead><tr><th colspan=\"23\" style=\"text-align: center;\" class=\"head\">{{vm.info.pname}}</th></tr><tr><th colspan=\"9\">项目名称：{{vm.info.name}}</th><th colspan=\"7\">检查人：{{vm.person}}</th><th colspan=\"7\">检查日期：{{vm.time}}</th></tr><tr><th style=\"width:60px;text-align: center;\">指标</th><th style=\"text-align: center\">结果</th><th style=\"text-align: center\">合格率</th><th ng-repeat=\"i in vm.scData[0].rows[0]\">{{$index+1}}</th></tr></thead><tbody ng-repeat=\"item in vm.scData\"><tr ng-repeat=\"row in item.rows\" ng-if=\"!item.Children\"><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\"><tr><td style=\"white-space: nowrap;\"><a ui-sref=\"app.xhsc.sctbdetail({recordId:vm.stateParams.regionId,itemId:item.AcceptanceIndexID, AcceptanceItemID:vm.stateParams.measureItemID,MeasureRecordID:item.MeasureRecordID})\">{{item.AcceptanceIndexName}}</a></td></tr></table></td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" align=\"center\">{{item.QualifiedPointNum}}/{{item.allDot}}</td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\">{{item.QualifiedRate|number:2}}%</td><td ng-repeat=\"point in row\" ng-class=\"{\'yellow\':point.MeasureStatus == 2,\'red\':point.MeasureStatus == 3}\" ng-bind-html=\"point.MeasureValue\"></td></tr><tr ng-repeat=\"row in item.Children\" ng-if=\"item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\"><tr ng-repeat=\"row in item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\">{{item.AcceptanceIndexName}}</td><td><a ui-sref=\"app.xhsc.sctbdetail({recordId:vm.stateParams.regionId,itemId:item.AcceptanceIndexID,AcceptanceItemID:vm.stateParams.measureItemID, MeasureRecordID:item.MeasureRecordID})\">{{row.AcceptanceIndexName}}</a></td></tr></table></td><td align=\"center\" rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\">{{item.QualifiedPointNum}}/{{item.allDot}}</td><td rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\">{{item.QualifiedPointNum*100.0/item.allDot|number:2}}%</td><td ng-repeat=\"point in row.rows[0]\" ng-class=\"{\'yellow\':point.MeasureStatus == 2,\'red\':point.MeasureStatus == 3}\" ng-bind-html=\"point.MeasureValue\"></td></tr></tbody></table></md-content>");
$templateCache.put("app/main/xhsc/ys/scdetail_pc.html","<div flex=\"\" layout=\"column\"><md-toolbar><div class=\"md-toolbar-tools\" layout=\"row\"><h2 class=\"md-flex\">{{vm.info.name}}({{vm.info.pname}})</h2><span flex=\"\"></span><md-button class=\"md-raised md-warn\" ng-click=\"vm.back()\">返回</md-button></div></md-toolbar><md-content class=\"subheader\" style=\"position:relative;\" flex=\"\" layout-padding=\"\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable zdytable\"><thead><tr><th colspan=\"23\" style=\"text-align: center;\" class=\"head\">{{vm.info.pname}}</th></tr><tr><th colspan=\"9\">项目名称：{{vm.info.name}}</th><th colspan=\"7\">检查人：{{vm.person}}</th><th colspan=\"7\">检查日期：{{vm.time}}</th></tr><tr><th style=\"width:60px;text-align: center;\">指标</th><th style=\"text-align: center\">结果</th><th style=\"text-align: center\">合格率</th><th ng-repeat=\"i in vm.scData[0].rows[0]\">{{$index+1}}</th></tr></thead><tbody ng-repeat=\"item in vm.scData\"><tr ng-repeat=\"row in item.rows\" ng-if=\"!item.Children\"><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\"><tr><td style=\"white-space: nowrap;\"><a ng-click=\"vm.go(row,item)\">{{item.AcceptanceIndexName}}</a></td></tr></table></td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\" align=\"center\">{{item.QualifiedPointNum}}/{{item.allDot}}</td><td rowspan=\"{{item.rows.length}}\" ng-if=\"$index == 0\">{{item.QualifiedRate|number:2}}%</td><td ng-repeat=\"point in row\" ng-class=\"{\'yellow\':point.MeasureStatus == 2,\'red\':point.MeasureStatus == 3}\" ng-bind-html=\"point.MeasureValue\"></td></tr><tr ng-repeat=\"row in item.Children\" ng-if=\"item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\" style=\"padding: 0;\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" class=\"levelTable leveltable2\"><tr ng-repeat=\"row in item.Children\"><td rowspan=\"{{item.Children.length}}\" ng-if=\"$index == 0\">{{item.AcceptanceIndexName}}</td><td><a ng-click=\"vm.go(row,item)\">{{row.AcceptanceIndexName}}</a></td></tr></table></td><td align=\"center\" rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\">{{item.QualifiedPointNum}}/{{item.allDot}}</td><td rowspan=\"{{item.rowSpan}}\" ng-if=\"$index==0\">{{item.QualifiedPointNum*100.0/item.allDot|number:2}}%</td><td ng-repeat=\"point in row.rows[0]\" ng-class=\"{\'yellow\':point.MeasureStatus == 2,\'red\':point.MeasureStatus == 3}\" ng-bind-html=\"point.MeasureValue\"></td></tr></tbody></table></md-content></div>");
$templateCache.put("app/main/xhsc/ys/sctbdetail.html","<md-content flex=\"\" layout=\"column\"><sxt-sc-view data=\"vm.data\" procedure=\"vm.procedure\" region-id=\"vm.regionId\" flex=\"\"></sxt-sc-view></md-content>");
$templateCache.put("app/main/xhsc/ys/sctbdetail_pc.html","<div flex=\"\" layout=\"column\"><md-toolbar><div class=\"md-toolbar-tools\" layout=\"row\"><h2 class=\"md-flex\">{{vm.data.Region.FullRegionName}}({{vm.data.Region.HouseTypeName}})</h2><span flex=\"\"></span><md-button class=\"md-raised md-warn\" ng-click=\"vm.back()\">返回</md-button></div></md-toolbar><md-content flex=\"\" layout=\"column\"><sxt-sc-view data=\"vm.data\" procedure=\"vm.procedure\" region-id=\"vm.regionId\" flex=\"\"></sxt-sc-view></md-content></div>");
$templateCache.put("app/main/xhsc/ys/scv.html","<div layout=\"row\" class=\"scTop\"><div flex=\"none\" class=\"scleft\"><md-button class=\"md-fab md-mini\" style=\"line-height: 24px\" ng-click=\"vm.nextRegion(true)\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-left\"></md-icon></md-button><span>{{ vm.info.name}}</span><md-button class=\"md-fab md-mini\" style=\"line-height: 24px\" ng-click=\"vm.nextRegion()\" aria-label=\"\"><md-icon md-font-icon=\"icon-chevron-right\"></md-icon></md-button></div><div flex=\"\" class=\"scright\"><span>{{vm.info.tips}}</span></div></div><div flex=\"none\" layout=\"row\" style=\"border-bottom: 1px solid rgba(0, 0, 0, 0.117647)\"><md-tabs md-dynamic-height=\"\" flex=\"\" md-selected=\"vm.selectedIndex\"><md-tab ng-repeat=\"m in vm.MeasureIndexes\" label=\"{{m.IndexName}}\"></md-tab></md-tabs></div><sxt-sc-map flex=\"\" project=\"vm.project\" readonly=\"true\" region-id=\"vm.info.regionId\" region-type=\"vm.info.regionType\" acceptance-item=\"vm.info.acceptanceItemID\" region-name=\"vm.info.name\" tips=\"vm.info.tips\" measure-indexes=\"vm.MeasureIndexes\" current-index=\"vm.selectedIndex\"></sxt-sc-map><div style=\"display: none\"><sxt-sc-map-popup readonly=\"true\"></sxt-sc-map-popup></div>");
$templateCache.put("app/main/xhsc/ys/stzlDetail.html","<md-tabs md-align-tabs=\"bottom\" flex=\"\" md-swipe-content=\"\" class=\"zlpkwrap\"><md-tab label=\"{{b.AssessmentClassificationName}}\" ng-repeat=\"b in vm.Assessment.AssessmentClassifys\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><div flex=\"none\" layout=\"row\" style=\"border-top: solid 1px silver\" class=\"zlpkheader\"><div flex=\"25\">检测内容</div><div flex=\"35\">评判标准</div><div flex=\"40\" layout=\"row\"><div flex=\"\" style=\"border-right: 1px solid #d8d8d8;\">扣分标准</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">权重</div><div flex=\"none\" style=\"width:50px; border-right: 1px solid #d8d8d8;text-align: center;\">扣分</div><div flex=\"none\" style=\"width:50px;text-align: center;\">得分</div></div></div><div flex=\"\" layout=\"column\" layout-fill=\"\"><md-content flex=\"\" class=\"zlpksub\"><section class=\"zlpklist\" ng-repeat=\"c in b.AssessmentClassifys\"><md-subheader><div layout=\"row\" class=\"zlpksubheader\"><span>{{c.AssessmentClassificationName}}</span></div></md-subheader><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"zlpktables\"><tr ng-repeat=\"e in c.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(1)}}%;\"><p>{{e.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"f in e.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(2)}}%;\"><p>{{f.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"g in f.AssessmentClassifys\"><td style=\"width:{{vm.getWidth(3)}}%;\"><p>{{g.AssessmentClassificationName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr ng-repeat=\"item in g.AssessmentItems\"><td style=\"width:{{vm.getWidth(4)}}%\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:{{vm.getWidth(5)}}%\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\" class=\"lr\"><span ng-click=\"vm.check(item)\" ng-if=\"!vm.input\">录入</span> <span ng-click=\"vm.check(item)\" ng-if=\"vm.input\">{{vm.input}}</span></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">2</td></tr><tr><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">13栋</td><td colspan=\"2\" class=\"lr\"><table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\"><tr><td>&nbsp;&nbsp;照片：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;margin-top:3px;\" sxt-images=\"vm.images\" ng-repeat=\"img in vm.images\"><li><img ng-src=\"{{img.url}}\"></li></ul><md-icon style=\"width:30px;height:30px;\"><img src=\"assets/images/etc/plug.png\"></md-icon></td></tr><tr><td>&nbsp;&nbsp;备注：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;\"><li><span style=\"font-size: 24px;\">T</span></li></ul></td></tr></table></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\">2</td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:6.25%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\" class=\"lr\"><span ng-click=\"vm.check(item)\" ng-if=\"!vm.input\">录入</span> <span ng-click=\"vm.check(item)\" ng-if=\"vm.input\">{{vm.input}}</span></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">2</td></tr><tr><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">13栋</td><td colspan=\"2\" class=\"lr\"><table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\"><tr><td>&nbsp;&nbsp;照片：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;margin-top:3px;\" sxt-images=\"vm.images\" ng-repeat=\"img in vm.images\"><li><img ng-src=\"{{img.url}}\"></li></ul><md-icon style=\"width:30px;height:30px;\"><img src=\"assets/images/etc/plug.png\"></md-icon></td></tr><tr><td>&nbsp;&nbsp;备注：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;\"><li><span style=\"font-size: 24px;\">T</span></li></ul></td></tr></table></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\">2</td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in e.AssessmentItems\"><td style=\"width:6.25%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\" class=\"lr\"><span ng-click=\"vm.check(item)\" ng-if=\"!vm.input\">录入</span> <span ng-click=\"vm.check(item)\" ng-if=\"vm.input\">{{vm.input}}</span></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">2</td></tr><tr><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">13栋</td><td colspan=\"2\" class=\"lr\"><table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\"><tr><td>&nbsp;&nbsp;照片：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;margin-top:3px;\" sxt-images=\"vm.images\" ng-repeat=\"img in vm.images\"><li><img ng-src=\"{{img.url}}\"></li></ul><md-icon style=\"width:30px;height:30px;\"><img src=\"assets/images/etc/plug.png\"></md-icon></td></tr><tr><td>&nbsp;&nbsp;备注：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;\"><li><span style=\"font-size: 24px;\">T</span></li></ul></td></tr></table></td><td style=\"width: 50px;text-align: center;\">2</td><td style=\"width: 50px;text-align: center;\">2</td></tr></table></td></tr></table></td></tr></table></td></tr><tr ng-repeat=\"item in c.AssessmentItems\"><td style=\"width:{{vm.getWidth(1)}}%;\"><p>{{item.AssessmentCheckItemName}}</p></td><td><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:46.9%;\"><p>{{item.EvaluationCriteria}}</p></td><td><p>{{item.DeductionCriteria}}</p></td><td style=\"width: 50px;text-align: center;\">{{item.Weight}}</td><td style=\"width: 50px;text-align: center;\" class=\"lr\"><span ng-click=\"vm.check(item,$event)\" ng-if=\"!vm.input\">录入</span> <span ng-click=\"vm.check(item)\" ng-if=\"vm.input\">{{vm.input}}</span></td><td style=\"width: 50px;text-align: center;\" class=\"lr\">{{item.lastScore}}</td></tr><tr><td colspan=\"5\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"width:50px;text-align:center\">{{vm.Assessment.AssessmentClassifyRegions.RegionName}}</td><td colspan=\"4\" class=\"lr\">&nbsp;&nbsp;照片：<ul class=\"img\" style=\"display: inline-block;vertical-align:top;margin-top:3px;\" sxt-images=\"vm.images\" ng-repeat=\"img in vm.images\"><li><img ng-src=\"{{img.url}}\"></li></ul><md-icon style=\"width:30px;height:30px;\"><img src=\"assets/images/etc/plug.png\"></md-icon></td></tr></table></td></tr></table></td></tr></table></section></md-content></div></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/ys/temp.html","<div flex=\"\"><slide-menu slide-data=\"vm.procedureData\" show-check=\"false\" half-height=\"false\"></slide-menu></div>");
$templateCache.put("app/quick-panel/tabs/activity/activity-tab.html","<md-list class=\"friends\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.FRIENDS\">Friends</span></md-subheader><md-list-item class=\"friend md-3-line\" ng-repeat=\"friend in vm.activities.friends\"><img ng-src=\"{{friend.avatar}}\" class=\"md-avatar\" alt=\"{{friend.name}}\"><div class=\"status {{friend.status}}\"></div><div ng-if=\"contact.unread\" class=\"md-accent-bg unread-message-count\">{{contact.unread}}</div><div class=\"md-list-item-text\"><h3 class=\"message\">{{friend.message}}</h3><p class=\"time\">{{friend.time}}</p></div></md-list-item></md-list><md-divider></md-divider><md-list class=\"servers\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.APP_SERVERS\">Application Servers</span></md-subheader><md-list-item class=\"server md-3-line\" ng-repeat=\"server in vm.activities.servers\"><md-icon md-font-icon=\"icon-checkbox-blank-circle\" class=\"s16 status\" ng-class=\"server.status\"></md-icon><div class=\"md-list-item-text\"><h3>{{server.location}}</h3><p>{{server.detail}}</p></div></md-list-item></md-list><md-divider></md-divider><md-list class=\"stats\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.USER_STATS\">User Stats</span></md-subheader><md-list-item class=\"stat md-2-line\" ng-repeat=\"stat in vm.activities.stats\"><div class=\"md-list-item-text\"><span>{{stat.title}} ({{stat.current}} / {{stat.total}})</span><md-progress-linear ng-class=\"stat.status\" md-mode=\"determinate\" value=\"{{stat.percent}}\"></md-progress-linear></div></md-list-item></md-list>");
$templateCache.put("app/quick-panel/tabs/chat/chat-tab.html","<div class=\"main animate-slide-left\" ng-hide=\"vm.chatActive\"><md-list class=\"recent\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.RECENT\">Recent</span></md-subheader><md-list-item class=\"contact md-3-line\" ng-repeat=\"contact in vm.contacts.recent\" ng-click=\"vm.toggleChat(contact)\"><img ng-src=\"{{contact.avatar}}\" class=\"md-avatar\" alt=\"{{contact.name}}\"><div class=\"status {{contact.status}}\"></div><div ng-if=\"contact.unread\" class=\"md-accent-bg unread-message-count\">{{contact.unread}}</div><div class=\"md-list-item-text\"><h3>{{contact.name}}</h3><p class=\"last-message\">{{contact.lastMessage}}</p></div></md-list-item></md-list><md-divider></md-divider><md-list class=\"all\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.START_NEW_CHAT\">Start New Chat</span></md-subheader><md-list-item class=\"contact\" ng-repeat=\"contact in vm.contacts.all\" ng-click=\"vm.toggleChat(contact)\"><img ng-src=\"{{contact.avatar}}\" class=\"md-avatar\" alt=\"{{contact.name}}\"><div class=\"status {{contact.status}}\"></div><div class=\"md-list-item-text\"><h3>{{contact.name}}</h3></div></md-list-item></md-list><md-divider></md-divider></div><div class=\"chat animate-slide-right\" ng-show=\"vm.chatActive\" layout=\"column\"><md-toolbar class=\"md-accent\"><div class=\"md-toolbar-tools\" layout=\"row\" layout-align=\"space-between center\"><div layout=\"row\" layout-align=\"start center\"><md-button class=\"md-icon-button\" ng-click=\"vm.toggleChat()\" aria-label=\"Back\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.BACK\"><md-icon md-font-icon=\"icon-keyboard-backspace\"></md-icon></md-button><h4><span>{{vm.chat.contact.name}}</span></h4></div><div layout=\"row\" layout-align=\"end center\"><md-button class=\"md-icon-button\" aria-label=\"Call\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.CALL\"><md-icon md-font-icon=\"icon-phone\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"More\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.MORE\"><md-icon md-font-icon=\"icon-dots-vertical\"></md-icon></md-button></div></div></md-toolbar><md-content flex=\"\" layout-paddings=\"\" ms-scroll=\"\" id=\"chat-dialog\"><div layout=\"row\" ng-repeat=\"dialog in vm.chat.contact.dialog\" class=\"md-padding message-row\" ng-class=\"dialog.who\"><img ng-if=\"dialog.who ===\'contact\'\" ng-src=\"{{vm.chat.contact.avatar}}\" class=\"avatar\" alt=\"{{vm.chat.contact.name}}\"> <img ng-if=\"dialog.who ===\'user\'\" class=\"avatar\" src=\"assets/images/avatars/profile.jpg\"><div class=\"bubble\" flex=\"\"><div class=\"message\">{{dialog.message}}</div><div class=\"time secondary-text\">{{dialog.time}}</div></div></div></md-content><form ng-submit=\"vm.reply()\" layout=\"row\" class=\"reply\" layout-align=\"start center\"><textarea ng-keyup=\"$event.keyCode == 13 ? vm.reply() : null\" flex=\"\" ng-model=\"vm.replyMessage\" placeholder=\"Type and hit enter to send message\" translate=\"\" translate-attr-placeholder=\"QUICKPANEL.REPLY_PLACEHOLDER\"></textarea><md-button class=\"md-fab\" type=\"submit\" aria-label=\"Send message\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.SEND_MESSAGE\"><md-icon md-font-icon=\"icon-send\"></md-icon></md-button></form></div>");
$templateCache.put("app/quick-panel/tabs/today/today-tab.html","<md-list class=\"date\"><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.TODAY\">Today</span></md-subheader><md-list-item class=\"md-display-1 md-2-line\" layout=\"column\" layout-align=\"start start\"><div class=\"secondary-text\"><div>{{vm.date | date:\'EEEE\'}}</div><div layout=\"row\" layout-align=\"start start\"><span>{{vm.date | date:\'d\'}}</span> <span class=\"md-subhead\">th</span> <span>{{vm.date | date:\'MMMM\'}}</span></div></div></md-list-item></md-list><md-divider></md-divider><md-list><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.EVENTS\">Events</span></md-subheader><md-list-item class=\"md-2-line\" ng-repeat=\"event in vm.events\" ng-click=\"dummyFunction()\"><div class=\"md-list-item-text\"><h3>{{event.title}}</h3><p>{{event.detail}}</p></div></md-list-item></md-list><md-divider></md-divider><md-list><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.NOTES\">Notes</span></md-subheader><md-list-item class=\"md-2-line\" ng-repeat=\"note in vm.notes\" ng-click=\"dummyFunction()\"><div class=\"md-list-item-text\"><h3>{{note.title}}</h3><p>{{note.detail}}</p></div></md-list-item></md-list><md-divider></md-divider><md-list><md-subheader class=\"md-no-sticky\"><span translate=\"QUICKPANEL.QUICK_SETTINGS\">Quick Settings</span></md-subheader><md-list-item><h3 translate=\"QUICKPANEL.NOTIFICATIONS\">Notifications</h3><md-switch class=\"md-secondary\" ng-model=\"vm.settings.notify\" aria-label=\"Notifications\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.NOTIFICATIONS\"></md-switch></md-list-item><md-list-item><h3 translate=\"QUICKPANEL.CLOUD_SYNC\">Cloud Sync</h3><md-switch class=\"md-secondary\" ng-model=\"vm.settings.cloud\" aria-label=\"Cloud Sync\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.CLOUD_SYNC\"></md-switch></md-list-item><md-list-item><h3 translate=\"QUICKPANEL.RETRO_THRUSTERS\">Retro Thrusters</h3><md-switch class=\"md-secondary md-warn\" ng-model=\"vm.settings.retro\" aria-label=\"Retro Thrusters\" translate=\"\" translate-attr-aria-label=\"QUICKPANEL.RETRO_THRUSTERS\"></md-switch></md-list-item></md-list>");
$templateCache.put("app/toolbar/layouts/content-with-toolbar/toolbar.html","<div layout=\"row\" layout-align=\"space-between center\"><div layout=\"row\" layout-align=\"start center\"><div class=\"logo\" layout=\"row\" layout-align=\"start center\"><span class=\"logo-image\">F</span> <span class=\"logo-text\">FUSE</span></div><md-progress-circular id=\"toolbar-progress\" ng-if=\"$root.loadingProgress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"64\"></md-progress-circular></div><div layout=\"row\" layout-align=\"start center\"><div class=\"toolbar-separator\"></div><ms-search-bar></ms-search-bar><div class=\"toolbar-separator\"></div><md-menu-bar id=\"user-menu\"><md-menu md-position-mode=\"left bottom\"><md-button class=\"user-button\" ng-click=\"$mdOpenMenu()\" aria-label=\"User settings\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.USER_SETTINGS\"><div layout=\"row\" layout-align=\"space-between center\"><div class=\"avatar-wrapper\"><img md-menu-align-target=\"\" class=\"avatar\" src=\"assets/images/avatars/profile.jpg\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon status s16\"></md-icon></div><span class=\"username\" hide-xs=\"\">John Doe</span><md-icon md-font-icon=\"icon-chevron-down\" class=\"icon s16\" hide-xs=\"\"></md-icon></div></md-button><md-menu-content width=\"3\"><md-menu-item class=\"md-indent\" ui-sref=\"app.pages_profile\"><md-icon md-font-icon=\"icon-account\" class=\"icon\"></md-icon><md-button>My Profile</md-button></md-menu-item><md-menu-item class=\"md-indent\" ui-sref=\"app.mail\"><md-icon md-font-icon=\"icon-email\" class=\"icon\"></md-icon><md-button>Inbox</md-button></md-menu-item><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon\"></md-icon><md-menu id=\"user-status-menu\"><md-button ng-click=\"$mdOpenMenu()\" class=\"status\" ng-class=\"vm.userStatus.class\">{{vm.userStatus.title}}</md-button><md-menu-content width=\"2\"><md-menu-item class=\"status md-indent\" ng-class=\"{\'selected\': status === vm.userStatus}\" ng-repeat=\"status in vm.userStatusOptions\"><md-icon md-font-icon=\"{{status.icon}}\" ng-style=\"{\'color\': status.color }\" class=\"icon\"></md-icon><md-button ng-click=\"vm.setUserStatus(status)\">{{status.title}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-divider></md-menu-divider><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"icon-logout\" class=\"icon\"></md-icon><md-button ng-click=\"vm.logout()\">Logout</md-button></md-menu-item></md-menu-content></md-menu></md-menu-bar><div class=\"toolbar-separator\"></div><md-menu id=\"language-menu\" md-offset=\"0 72\" md-position-mode=\"target-right target\"><md-button class=\"language-button\" ng-click=\"$mdOpenMenu()\" aria-label=\"Language\" md-menu-origin=\"\" md-menu-align-target=\"\"><div layout=\"row\" layout-align=\"center center\"><img class=\"flag\" ng-src=\"assets/images/flags/{{vm.selectedLanguage.flag}}.png\"> <span class=\"iso\">{{vm.selectedLanguage.code}}</span></div></md-button><md-menu-content width=\"3\" id=\"language-menu-content\"><md-menu-item ng-repeat=\"(iso, lang) in vm.languages\"><md-button ng-click=\"vm.changeLanguage(lang)\" aria-label=\"{{lang.title}}\" translate=\"\" translate-attr-aria-label=\"{{lang.title}}\"><span layout=\"row\" layout-align=\"start center\"><img class=\"flag\" ng-src=\"assets/images/flags/{{lang.flag}}.png\"> <span translate=\"{{lang.translation}}\">{{lang.title}}</span></span></md-button></md-menu-item></md-menu-content></md-menu><div class=\"toolbar-separator\"></div><md-button id=\"quick-panel-toggle\" class=\"md-icon-button\" ng-click=\"vm.toggleSidenav(\'quick-panel\')\" aria-label=\"Toggle quick panel\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.TOGGLE_QUICK_PANEL\"><md-icon md-font-icon=\"icon-format-list-bulleted\" class=\"icon\"></md-icon></md-button></div></div>");
$templateCache.put("app/toolbar/layouts/content-with-footbar/footbar.html","<md-list flex=\"\" layout=\"row\"><span class=\"border1px top1px\"></span><md-list-item layout=\"row\" flex=\"\"><md-button flex=\"\" ng-click=\"vm.active_selected(\'app.xhsc.home\')\" ui-sref=\"app.xhsc.home\"><img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/xhhome.svg\" ng-if=\"vm.current_active==\'app.xhsc.home\'\"> <img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/xhhome_pre.svg\" ng-if=\"vm.current_active!=\'app.xhsc.home\'\"><div class=\"md-grid-text\" style=\"line-height: 20px\" ng-style=\"{\'color\':vm.current_active==\'app.xhsc.home\'?\'#e93030\':\'rgba(0,0,0,0.54)\'}\">首页</div></md-button></md-list-item><md-list-item layout=\"row\" flex=\"\"><md-button flex=\"\" ng-click=\"vm.active_selected(\'app.xhsc.application\')\" ui-sref=\"app.xhsc.application\"><img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/app.svg\" ng-if=\"vm.current_active==\'app.xhsc.application\'\"> <img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/app_pre.svg\" ng-if=\"vm.current_active!=\'app.xhsc.application\'\"><div class=\"md-grid-text\" style=\"line-height: 20px\" ng-style=\"{\'color\':vm.current_active==\'app.xhsc.application\'?\'#e93030\':\'rgba(0,0,0,0.54)\'}\">应用</div></md-button></md-list-item><md-list-item layout=\"row\" flex=\"\"><md-button flex=\"\" ng-click=\"vm.active_selected(\'app.pcReport_main\')\" ui-sref=\"app.pcReport_main\" class=\"ys\"><img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/report.svg\" ng-if=\"vm.current_active==\'app.pcReport_main\'\"> <img style=\"display: inline-block;height: 24px;width: 24px\" ng-src=\"app/toolbar/images/report_pre.svg\" ng-if=\"vm.current_active!=\'app.pcReport_main\'\"><div class=\"md-grid-text\" style=\"line-height: 20px\" ng-style=\"{\'color\':vm.current_active==\'app.pcReport_main\'?\'#e93030\':\'rgba(0,0,0,0.54)\'}\">报表中心</div></md-button></md-list-item><md-list-item layout=\"row\" flex=\"\"><md-button flex=\"\" ng-click=\"vm.active_selected(\'app.xhsc.pcmain\')\" ui-sref=\"app.xhsc.pcmain\" class=\"ys\"><img style=\"display: inline-block;height: 28px;width: 24px\" ng-src=\"app/toolbar/images/xhchange.svg\" ng-if=\"vm.current_active==\'app.xhsc.pcmain\'\"> <img style=\"display: inline-block;height: 28px;width: 24px\" ng-src=\"app/toolbar/images/xhchange_pre.svg\" ng-if=\"vm.current_active!=\'app.xhsc.pcmain\'\"><div class=\"md-grid-text\" style=\"line-height: 20px\" ng-style=\"{\'color\':vm.is(\'app.xhsc.pcenter\')?\'#e93030\':\'rgba(0,0,0,0.54)\'}\">设置</div></md-button></md-list-item></md-list>");
$templateCache.put("app/toolbar/layouts/content-with-footbar/toptoolbar.html","<h2 style=\"width: 100%;position: absolute;top: -5px\"><md-icon class=\"arrows icon s32\" ng-show=\"$root.leftArrow===true\" md-font-icon=\"icon-chevron-left\" style=\"color:#fff;\" ng-click=\"toLeft()\"></md-icon><span style=\"width:70%;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\" ng-class=\"{\'subtitle\':$root.leftArrow===true}\">{{$root.subtitle||$root.title || \'星河大数据工程管理平台\'}}</span><md-icon class=\"arrows icon s32\" ng-show=\"$root.rightArrow===true\" md-font-icon=\"icon-chevron-right\" style=\"color:#fff;\" ng-click=\"toRight()\"></md-icon></h2><div class=\"md-toolbar-tools grzx\" style=\"padding: 0\" layout=\"row\"><md-button flex=\"none\" ng-show=\"$root.noBack\" ng-click=\"goBack();\">返回</md-button><md-button flex=\"none\" ng-show=\"$root.showgrzx\" ui-sref=\"app.xhsc.pcmain\"><md-icon><img src=\"app/main/xhsc/images/grzx.png\" width=\"21\"></md-icon></md-button><span flex=\"\"></span><md-button flex=\"none\" ng-show=\"vm.is(\'app.xhsc.gx.selfGx\')||vm.is(\'app.xhsc.gx.selfRegion\')|| vm.is(\'app.xhsc.sf.selfItem\')||vm.is(\'app.xhsc.sf.selfRegion\')\" ng-click=\"ok();\">确定</md-button><md-button flex=\"none\" style=\"font-size:14px;\" ng-show=\"$root.sendBt\" ng-click=\"vm.sendGxResult()\">提交</md-button><md-button flex=\"none\" style=\"font-size:14px;\" ng-show=\"$root.sendPs\" ng-click=\"vm.sendClResult()\">批示</md-button><md-button flex=\"none\" style=\"font-size:14px;\" ng-show=\"$root.opBtn\" ng-click=\"vm.operateMsg($event)\">清除</md-button><md-button flex=\"none\" style=\"font-size:14px;\" ng-show=\"$root.refreshBtn===true\" class=\"md-link md-mini\"><md-icon><img src=\"app/main/xhsc/images/refresh.png\"></md-icon></md-button><md-progress-circular id=\"updateV\" md-diameter=\"24\" md-mode=\"indeterminate\" ng-if=\"vm.updateVison\"></md-progress-circular></div><div ng-if=\"$root.msg\" style=\"margin: auto;position: absolute; top: 0; left: 0; bottom: 0; right: 0; height: 34px;width: 200px\" layout=\"row\" layout-align=\"center stretch\"><span style=\"font-size: 14px;line-height: 32px;padding: 0px 20px;border-radius:8px;border:1px solid #ffffff;border-top-right-radius: 0px;border-bottom-right-radius:0px\" ng-click=\"setMsg(msgFlag)\" ng-class=\"{\'messager_active\':msgFlag,\'no_messager_active\':!msgFlag}\">待办通知</span> <span style=\"font-size: 14px;line-height: 32px ;padding: 0px 20px;border-radius:8px;border:1px solid #ffffff;border-top-left-radius: 0px;border-bottom-left-radius:0px\" ng-click=\"setMsg(msgFlag)\" ng-class=\"{\'messager_active\':!msgFlag,\'no_messager_active\':msgFlag}\">系统消息</span></div>");
$templateCache.put("app/toolbar/layouts/horizontal-navigation/toolbar.html","<div layout=\"row\" layout-align=\"space-between center\"><div layout=\"row\" layout-align=\"start center\"><div class=\"navigation-toggle\" hide-gt-sm=\"\"><md-button class=\"md-icon-button\" ng-click=\"vm.toggleHorizontalMobileMenu()\" aria-label=\"Toggle Mobile Navigation\"><md-icon md-font-icon=\"icon-menu\"></md-icon></md-button></div><div class=\"logo\" layout=\"row\" layout-align=\"start center\"><span class=\"logo-image\">F</span> <span class=\"logo-text\">FUSE</span></div><md-progress-circular id=\"toolbar-progress\" ng-if=\"$root.loadingProgress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"64\"></md-progress-circular></div><div layout=\"row\" layout-align=\"start center\"><ms-search-bar></ms-search-bar><md-menu-bar id=\"user-menu\"><md-menu md-position-mode=\"left bottom\"><md-button class=\"user-button\" ng-click=\"$mdOpenMenu()\" aria-label=\"User settings\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.USER_SETTINGS\"><div layout=\"row\" layout-align=\"space-between center\"><div class=\"avatar-wrapper\"><img md-menu-align-target=\"\" class=\"avatar\" src=\"assets/images/avatars/profile.jpg\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon status s16\"></md-icon></div><span class=\"username\" hide-xs=\"\">John Doe</span><md-icon md-font-icon=\"icon-chevron-down\" class=\"icon s16\" hide-xs=\"\"></md-icon></div></md-button><md-menu-content width=\"3\"><md-menu-item class=\"md-indent\" ui-sref=\"app.pages_profile\"><md-icon md-font-icon=\"icon-account\" class=\"icon\"></md-icon><md-button>My Profile</md-button></md-menu-item><md-menu-item class=\"md-indent\" ui-sref=\"app.mail\"><md-icon md-font-icon=\"icon-email\" class=\"icon\"></md-icon><md-button>Inbox</md-button></md-menu-item><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon\"></md-icon><md-menu id=\"user-status-menu\"><md-button ng-click=\"$mdOpenMenu()\" class=\"status\" ng-class=\"vm.userStatus.class\">{{vm.userStatus.title}}</md-button><md-menu-content width=\"2\"><md-menu-item class=\"status md-indent\" ng-class=\"{\'selected\': status === vm.userStatus}\" ng-repeat=\"status in vm.userStatusOptions\"><md-icon md-font-icon=\"{{status.icon}}\" ng-style=\"{\'color\': status.color }\" class=\"icon\"></md-icon><md-button ng-click=\"vm.setUserStatus(status)\">{{status.title}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-divider></md-menu-divider><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"icon-logout\" class=\"icon\"></md-icon><md-button ng-click=\"vm.logout()\">Logout</md-button></md-menu-item></md-menu-content></md-menu></md-menu-bar><md-menu id=\"language-menu\" md-offset=\"0 72\" md-position-mode=\"target-right target\"><md-button class=\"language-button\" ng-click=\"$mdOpenMenu()\" aria-label=\"Language\" md-menu-origin=\"\" md-menu-align-target=\"\"><div layout=\"row\" layout-align=\"center center\"><img class=\"flag\" ng-src=\"assets/images/flags/{{vm.selectedLanguage.flag}}.png\"> <span class=\"iso\">{{vm.selectedLanguage.code}}</span></div></md-button><md-menu-content width=\"3\" id=\"language-menu-content\"><md-menu-item ng-repeat=\"(iso, lang) in vm.languages\"><md-button ng-click=\"vm.changeLanguage(lang)\" aria-label=\"{{lang.title}}\" translate=\"\" translate-attr-aria-label=\"{{lang.title}}\"><span layout=\"row\" layout-align=\"start center\"><img class=\"flag\" ng-src=\"assets/images/flags/{{lang.flag}}.png\"> <span translate=\"{{lang.translation}}\">{{lang.title}}</span></span></md-button></md-menu-item></md-menu-content></md-menu><md-button id=\"quick-panel-toggle\" class=\"md-icon-button\" ng-click=\"vm.toggleSidenav(\'quick-panel\')\" aria-label=\"Toggle quick panel\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.TOGGLE_QUICK_PANEL\"><md-icon md-font-icon=\"icon-format-list-bulleted\" class=\"icon\"></md-icon></md-button></div></div>");
$templateCache.put("app/toolbar/layouts/vertical-navigation/toolbar.html","<div layout=\"row\" layout-align=\"start center\"><div layout=\"row\" layout-align=\"start center\" flex=\"\"><md-button id=\"navigation-toggle\" class=\"md-icon-button\" ng-click=\"vm.toggleSidenav(\'navigation\')\" hide-gt-sm=\"\" aria-label=\"Toggle navigation\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.TOGGLE_NAVIGATION\"><md-icon md-font-icon=\"icon-menu\" class=\"icon\"></md-icon></md-button><ms-search-bar></ms-search-bar><div class=\"toolbar-separator\"></div><md-progress-circular id=\"toolbar-progress\" ng-if=\"$root.loadingProgress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"32\"></md-progress-circular></div><div layout=\"row\" layout-align=\"start center\"><md-menu-bar id=\"user-menu\"><md-menu md-position-mode=\"left bottom\"><md-button class=\"user-button\" ng-click=\"$mdOpenMenu()\" aria-label=\"User settings\" translate=\"\" translate-attr-aria-label=\"TOOLBAR.USER_SETTINGS\"><div layout=\"row\" layout-align=\"space-between center\"><div class=\"avatar-wrapper\"><img md-menu-align-target=\"\" class=\"avatar\" src=\"assets/images/avatars/profile.jpg\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon status s16\"></md-icon></div><span class=\"username\" hide-xs=\"\">{{vm.user.Name}}</span><md-icon md-font-icon=\"icon-chevron-down\" class=\"icon s16\" hide-xs=\"\"></md-icon></div></md-button><md-menu-content width=\"3\"><md-menu-item class=\"md-indent\" ui-sref=\"app.pages_profile\"><md-icon md-font-icon=\"icon-account\" class=\"icon\"></md-icon><md-button>个人信息</md-button></md-menu-item><md-menu-item class=\"md-indent\" ui-sref=\"app.mail\"><md-icon md-font-icon=\"icon-email\" class=\"icon\"></md-icon><md-button>收件箱</md-button></md-menu-item><md-menu-item class=\"md-indent\" ng-click=\"vm.resetPassword()\"><md-icon md-svg-icon=\"app/main/auth/images/password.svg\" class=\"icon\"></md-icon><md-button><span style=\"margin-top: -1px;\">修改密码</span></md-button></md-menu-item><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"\" ng-class=\"vm.userStatus.icon\" ng-style=\"{\'color\': vm.userStatus.color }\" class=\"icon\"></md-icon><md-menu id=\"user-status-menu\"><md-button ng-click=\"$mdOpenMenu()\" class=\"status\" ng-class=\"vm.userStatus.class\">{{vm.userStatus.title}}</md-button><md-menu-content width=\"2\"><md-menu-item class=\"status md-indent\" ng-class=\"{\'selected\': status === vm.userStatus}\" ng-repeat=\"status in vm.userStatusOptions\"><md-icon md-font-icon=\"{{status.icon}}\" ng-style=\"{\'color\': status.color }\" class=\"icon\"></md-icon><md-button ng-click=\"vm.setUserStatus(status)\">{{status.title}}</md-button></md-menu-item></md-menu-content></md-menu></md-menu-item><md-menu-divider></md-menu-divider><md-menu-item class=\"md-indent\"><md-icon md-font-icon=\"icon-logout\" class=\"icon\"></md-icon><md-button ng-click=\"vm.logout()\">退出</md-button></md-menu-item></md-menu-content></md-menu></md-menu-bar></div></div>");
$templateCache.put("app/core/directives/ms-navigation/templates/horizontal.html","<div class=\"navigation-toggle\" hide-gt-sm=\"\"><md-button class=\"md-icon-button\" ng-click=\"vm.toggleHorizontalMobileMenu()\" aria-label=\"Toggle Mobile Navigation\"><md-icon md-font-icon=\"icon-menu\"></md-icon></md-button></div><ul class=\"horizontal\"><li ng-repeat=\"node in vm.navigation\" ms-navigation-horizontal-node=\"node\" ng-class=\"{\'has-children\': vm.hasChildren}\" ng-include=\"\'navigation-horizontal-nested.html\'\"></li></ul><script type=\"text/ng-template\" id=\"navigation-horizontal-nested.html\"><div ms-navigation-horizontal-item layout=\"row\" ng-if=\"!vm.isHidden()\"> <div class=\"ms-navigation-horizontal-button\" ng-if=\"!node.uisref && node.title\" ng-class=\"{\'active md-accent-bg\': vm.isActive}\"> <i class=\"icon s18 {{node.icon}}\" ng-if=\"node.icon\"></i> <span class=\"title\" translate=\"{{node.translate}}\" flex>{{node.title}}</span> <span class=\"badge white-fg\" style=\"background: {{node.badge.color}}\" ng-if=\"node.badge\">{{node.badge.content}}</span> <i class=\"icon-chevron-right s18 arrow\" ng-if=\"vm.hasChildren\"></i> </div> <a class=\"ms-navigation-horizontal-button\" ui-sref=\"{{node.uisref}}\" ui-sref-active=\"active md-accent-bg\" ng-class=\"{\'active md-accent-bg\': vm.isActive}\" ng-if=\"node.uisref && node.title\"> <i class=\"icon s18 {{node.icon}}\" ng-if=\"node.icon\"></i> <span class=\"title\" translate=\"{{node.translate}}\" flex>{{node.title}}</span> <span class=\"badge white-fg\" style=\"background: {{node.badge.color}}\" ng-if=\"node.badge\">{{node.badge.content}}</span> <i class=\"icon-chevron-right s18 arrow\" ng-if=\"vm.hasChildren\"></i> </a> </div> <ul ng-if=\"vm.hasChildren && !vm.isHidden()\"> <li ng-repeat=\"node in node.children\" ms-navigation-horizontal-node=\"node\" ng-class=\"{\'has-children\': vm.hasChildren}\" ng-include=\"\'navigation-horizontal-nested.html\'\"></li> </ul></script>");
$templateCache.put("app/core/directives/ms-navigation/templates/vertical.html","<ul><li ng-repeat=\"node in vm.navigation|nav\" ms-navigation-node=\"node\" ng-class=\"{\'collapsed\': vm.collapsed, \'has-children\': vm.hasChildren}\" ng-include=\"\'navigation-nested.html\'\"></li></ul><script type=\"text/ng-template\" id=\"navigation-nested.html\"><div ms-navigation-item layout=\"row\" ng-if=\"!vm.isHidden()\"> <div class=\"ms-navigation-button\" ng-if=\"!node.uisref && node.title\"> <i class=\"icon s16 {{node.icon}}\" ng-if=\"node.icon\"></i> <span class=\"title\" translate=\"{{node.translate}}\" flex>{{node.title}}</span> <span class=\"badge white-fg\" ng-style=\"{\'background\': node.badge.color}\" ng-if=\"node.badge\">{{node.badge.content}}</span> <i class=\"icon-chevron-right s16 arrow\" ng-if=\"vm.collapsable && vm.hasChildren\"></i> </div> <a class=\"ms-navigation-button\" ui-sref=\"{{node.uisref}}\" ui-sref-active=\"active md-accent-bg\" ng-if=\"node.uisref && node.title\"> <i class=\"icon s16 {{node.icon}}\" ng-if=\"node.icon\"></i> <span class=\"title\" translate=\"{{node.translate}}\" flex>{{node.title}}</span> <span class=\"badge white-fg\" ng-style=\"{\'background\': node.badge.color}\" ng-if=\"node.badge\">{{node.badge.content}}</span> <i class=\"icon-chevron-right s16 arrow\" ng-if=\"vm.collapsable && vm.hasChildren\"></i> </a> </div> <ul ng-if=\"vm.hasChildren && !vm.isHidden()\"> <li ng-repeat=\"node in node.children\" ms-navigation-node=\"node\" ng-class=\"{\'collapsed\': vm.collapsed, \'has-children\': vm.hasChildren}\" ng-include=\"\'navigation-nested.html\'\"></li> </ul></script>");
$templateCache.put("app/main/pcReport/insideYs/component/insideYs-list.html","<md-card style=\"background-color: white;min-height:140px\" md-theme-watch=\"\"><md-card-content><div flex=\"\" layout=\"row\"><md-input-container md-theme=\"default\" flex=\"\"><label>整改单位</label><md-select ng-model=\"vm.project\" multiple=\"\"><md-option ng-value=\"item.rectifyOu\" ng-repeat=\"item in vm.projectData\">{{item.rectifyOuName}}</md-option></md-select></md-input-container></div><div style=\"width: 20px\"></div><div layout=\"row\" layout-align=\"start\"><md-checkbox ng-value=\"1\" ng-click=\"vm.toggle(\'未反馈\', vm.selected)\">未反馈</md-checkbox><md-checkbox ng-value=\"4\" ng-click=\"vm.toggle(\'未确认\', vm.selected)\">未确认</md-checkbox><md-checkbox ng-value=\"2\" ng-click=\"vm.toggle(\'已关闭\', vm.selected)\">已关闭</md-checkbox></div></md-card-content></md-card><md-content flex=\"\" layout=\"column\" ms-scroll=\"\"><table class=\"summaryReport\"><header><tr><th>序号</th><th>项目/分期/批次</th><th>楼栋/区域</th><th>楼层</th><th>房号</th><th>部位</th><th>区域类型</th><th>一级分类</th><th>二级分类</th><th>三级分类</th><th>问题描述</th><th>问题级别</th><th>所属专业</th><th>验收时间</th><th>验收人</th><th>整改单位</th><th>是否已整改</th><th>复查状态</th><th>整改时间</th><th>关闭时间</th><th>关闭人员</th><th>问题状态</th></tr></header><tbody><tr ng-repeat=\"item in vm.data\"><td>{{$index+1}}</td><td ng-repeat=\"(i,n) in item\" ng-if=\"i!=\'rectifyOu\'\">{{n}}</td></tr></tbody></table></md-content>");
$templateCache.put("app/main/pcReport/scReport/jt/history.html","<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\"><title>Title</title></head><body></body></html>");
$templateCache.put("app/main/pcReport/scReport/jt/scJt.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><div flex=\"\" style=\"overflow: hidden;position: relative\" layout=\"column\" ng-if=\"vm.loaded\"><div flex=\"\" style=\"margin-left: 170px;margin-top: 118px;overflow: scroll\" fix-title=\"fixTitle\" item-name=\"itemName\" jt-report=\"\"><table class=\"table table-bordered\"><tbody><tr ng-repeat=\"item in vm.vals\"><td colspan=\"{{vm.tilte.footHead.length}}\" ng-if=\"!item.length\"><div style=\"height: 25px\"></div></td><td ng-repeat=\"s_item in item track by $index\" ng-style=\"{\'firstCell\':$index==0,\'second\':$index==1}\" style=\"background-color:rgb(255,255,255);\" ng-if=\"item.length\"><div style=\"width: 80px;height: 25px\">{{s_item}}</div></td></tr></tbody></table></div><div layout=\"row\" style=\"border: 1px solid #d8d8d8;position: absolute;top:0px;left:0px;z-index: 100; height: 118px;background-color: white\"><div layout=\"row\"><div style=\"width: 50px;min-width: 50px;border-right: 1px solid #d8d8d8\" layout=\"row\" layout-align=\"center center\">序号</div><div style=\"width: 120px;min-width: 120px\" layout=\"row\" layout-align=\"center center\">实测项</div></div></div><table id=\"itemName\" class=\"table table-bordered\" style=\"position: absolute;top:118px;left: 0px;z-index: 50;width: 171px\"><tr ng-repeat=\"nav in vm.leftNav\"><td width=\"51px\"><div style=\"height: 25px\">{{nav.sco}}</div></td><td><div style=\"height: 25px\">{{nav.name}}</div></td></tr></table><table id=\"fixTitle\" class=\"table table-bordered\" style=\"position: absolute;top:1px;z-index: 50\"><thead><tr><th ng-repeat=\"ti in vm.tilte.head\" colspan=\"{{3*ti.secNums}}\">{{ti.ProjectName}}</th></tr><tr><th ng-repeat=\"su in vm.tilte.subHead\" colspan=\"3\">{{su.SectionName}}</th></tr><tr><th ng-repeat=\"ft in vm.tilte.footHead\"><div style=\"width: 80px\">{{ft.des}}</div></th></tr></thead></table></div><div ng-if=\"vm.isShowbg\" layout=\"column\" flex=\"\" layout-align=\"center center\"><div layout=\"row\" layout-align=\"center center\"><img class=\"nullImg\" src=\"app/main/xhsc/images/null.png\"></div><div layout=\"row\"><p style=\"font-size: 16px; color: #808080;\">暂无数据</p></div></div>");
$templateCache.put("app/main/pcReport/ysReport/hzProblem/hzProblem.html","<div ng-if=\"!vm.loaded\"><md-progress-circular id=\"toolbar-progress\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular></div><table ng-if=\"vm.loaded\" class=\"table table-bordered\"><tr><th rowspan=\"2\" style=\"min-width: 50px;width: 50px;\">序号</th><th rowspan=\"2\" style=\"min-width: 80px;\">楼栋号</th><th ng-repeat=\"item in vm.source.Heads\" colspan=\"3\">{{item.Name}}</th></tr><tr><th ng-repeat=\"item in vm.source.subTitle\" class=\"center w\">{{item.Value}}</th></tr><tr ng-repeat=\"item in vm.source.Body\"><td>{{$index+1}}</td><td>{{item.Name}}</td><td ng-repeat=\"k in item.Item\">{{k.Value}}</td></tr></table>");
$templateCache.put("app/main/xhsc/directive/cycle/cycleAcceptPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/cycle/cycleRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && images.zb.length\" class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==16?\'已整改\':\'未整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"16\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/gx/building-select.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs flex=\"\" ng-if=\"show\" class=\"selfGx\"><md-tab ng-repeat=\"prjs in data\" label=\"{{prjs.RegionName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"prjs.Children.length\" ng-repeat=\"item in prjs.Children\" style=\"position: relative\"><div style=\"position: absolute;right: 0px;z-index: 9999\"><md-button ng-click=\"zk(item)\" style=\"min-width: 50px;color: rgba(0,0,0,0.541176)\"><span ng-show=\"item.hide\">展开</span><span ng-show=\"!item.hide\">收起</span></md-button></div><md-subheader class=\"md-no-sticky\" style=\"background:#f0f0f0\" layout=\"row\">{{item.RegionName}}</md-subheader><md-list-item style=\"background: white;\" layout=\"row\" ng-repeat=\"k in item.Children\" ng-show=\"!item.hide\"><md-checkbox ng-disabled=\"k.disable\" ng-model=\"k.checked\" ng-click=\"checked(k)\"><span>{{k.RegionName}}</span></md-checkbox><md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/directive/gx/gx-select.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs flex=\"\" ng-if=\"show\" class=\"selfGx\"><md-tab ng-if=\"showTab(gx1)\" ng-repeat=\"gx1 in data\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"item.WPAcceptanceList.length\" ng-repeat=\"item in gx1.SpecialtyChildren\"><md-subheader class=\"md-no-sticky\" style=\"background:#f0f0f0\">{{item.SpecialtyName}}</md-subheader><md-list-item style=\"background: white;\" ng-repeat=\"k in item.WPAcceptanceList\"><md-checkbox ng-model=\"k.checked\" ng-click=\"checked(k)\"><span>{{k.AcceptanceItemName}}</span></md-checkbox><md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/directive/gx/selfAcceptPopup.html","<div style=\"width: 260px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"column\"><p style=\"margin: 0px 8px;color: rgb(255,255,255)\">{{ data.p.Describe}}(绿色:合格点)</p><div layout=\"row\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" style=\"border-right:1px solid #555;\"><md-switch flex=\"\" ng-model=\"status\" style=\"margin: 0px 8px;color: rgb(255,255,255);\" ng-change=\"onChange(status)\"></md-switch></div><div layout=\"row\" flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/safeDialog.html","<div class=\"my-dialog-mask\"><div class=\"my-dialog\"><div class=\"dialog-top\" layout=\"column\" ng-cloak=\"\"><div class=\"dialog-msg\" layout=\"column\" style=\"border-bottom: 1px solid #dedede;padding:20px;\"><p>{{dialogMsg}}</p><md-input-container ng-show=\"!logOut\"><label>描述</label> <input md-no-asterisk=\"\" name=\"description\" ng-model=\"description\"></md-input-container></div><md-button flex=\"\" style=\"width:100%;\" ng-click=\"submit($event)\">{{dialogSure}}</md-button></div><div class=\"dialog-bottom\"><md-button flex=\"\" style=\"width:100%;\" ng-click=\"cancel($event)\">取消</md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/safeSlideMenu.html","<div flex=\"\" layout=\"row\" class=\"gx-list\" ng-class=\"{\'narrow\':level == 2}\"><div flex=\"33\" layout=\"column\"><md-content class=\"list-left\" flex=\"\" style=\"background: #f0f0f0;border-right:1px solid #dedede;\"><div ng-repeat=\"gx in slideData\"><md-list ng-cloak=\"\" style=\"padding-top:0;padding-bottom: 0;\"><md-list-item ng-class=\"{\'active\':gx1.checked}\" ng-repeat=\"gx1 in gx.SpecialtyChildren\"><md-button flex=\"\" ng-click=\"selectProcedure(gx1)\">{{gx1.SpecialtyName}}</md-button></md-list-item></md-list></div></md-content></div><div flex=\"66\" layout=\"column\" style=\"background: #fff;position:relative;\"><md-content class=\"list-right\" flex=\"\"><div class=\"floors\" layout=\"column\"><md-list ng-if=\"!showCheck\"><md-list-item layout=\"row\" ng-repeat=\"gxc in gxlevels\" ng-click=\"goToLink(gxc)\"><p>{{gxc.AcceptanceItemName}}</p></md-list-item></md-list><md-radio-group ng-if=\"showCheck\" ng-model=\"info.current\"><div style=\"height:49px;overflow: hidden;line-height: 49px;padding: 0 5px; border-bottom: 1px solid rgb(222, 222, 222);\" ng-repeat=\"gxc in gxlevels\"><md-radio-button ng-value=\"gxc\" aria-label=\"{{gxc.AcceptanceItemName}}\">{{gxc.AcceptanceItemName}}</md-radio-button></div></md-radio-group></div></md-content></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtDynamicAcceptPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtDynamicRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && images.zb.length\" class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==8?\'未整改\':\'已整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"16\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtMapAcceptPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtSafeRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && images.zb.length\" class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==16?\'已整改\':\'未整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"16\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtWeekAcceptPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_civiliz/sxtWeekRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && images.zb.length\" class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==16?\'已整改\':\'未整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"16\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复查状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/directive/safe_self/safe-item-select.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!show\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><md-tabs flex=\"\" ng-if=\"show\" class=\"selfGx\"><md-tab ng-if=\"showTab(gx1)\" ng-repeat=\"gx1 in data\" label=\"{{gx1.SpecialtyName}}\"><md-tab-content flex=\"\" layout-fill=\"\" layout=\"column\"><md-list><section ng-if=\"item.WPAcceptanceList.length\" ng-repeat=\"item in gx1.SpecialtyChildren\"><md-subheader class=\"md-no-sticky\" style=\"background:#f0f0f0\">{{item.SpecialtyName}}</md-subheader><md-list-item style=\"background: white;\" ng-repeat=\"k in item.WPAcceptanceList\"><md-checkbox ng-model=\"k.checked\" ng-click=\"checked(k)\"><span>{{k.AcceptanceItemName}}</span></md-checkbox><md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></section></md-list></md-tab-content></md-tab></md-tabs>");
$templateCache.put("app/main/xhsc/directive/safe_self/safeSelfAcceptPopup.html","<div style=\"width: 260px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"column\"><p style=\"margin: 0px 8px;color: rgb(255,255,255)\">{{ data.p.Describe}}(绿色:合格点)</p><div layout=\"row\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" style=\"border-right:1px solid #555;\"><md-switch flex=\"\" ng-model=\"status\" style=\"margin: 0px 8px;color: rgb(255,255,255);\" ng-change=\"onChange(status)\"></md-switch></div><div layout=\"row\" flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" layout=\"row\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div></div>");
$templateCache.put("app/main/xhsc/directive/sc/sxtScStandarPop.html","<div style=\"width: 70px;max-width: 70px\"><div class=\"leaflet-draw-subbuttom sure\" style=\"text-align: center\"><ul layout=\"row\" layout-align=\"center center\"><li ng-if=\"!readonly\"><a class=\"\" href=\"javascript:void(0)\" ng-click=\"removeLayer()\">删除</a></li></ul></div></div>");
$templateCache.put("app/main/xhsc/directive/xj/xjAcceptPopup.html","<div style=\"width: 200px;\"><div ng-if=\"data.v.ProblemSortName==\'T\'\" class=\"mappopup\" style=\"margin-bottom:10px;\"><md-input-container><input ng-model=\"data.v.ProblemDescription\"></md-input-container></div><div layout=\"row\"><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"playImage()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-picture\"></md-icon><span style=\"position: absolute;bottom: 0px;right: -1px\">{{ data.images.length }}</span></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"addPhoto()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-camera\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;\"><md-button class=\"md-fab md-mini\" ng-click=\"removeLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-delete\"></md-icon></md-button></div><div flex=\"\" style=\"text-align: center;border-right:1px solid #555;\"><md-button class=\"md-fab md-mini\" ng-click=\"moveLayer()\" style=\"background: none;margin:0;padding:0;\"><md-icon class=\"icon s24\" md-font-icon=\"icon-cursor-move\"></md-icon></md-button></div></div></div>");
$templateCache.put("app/main/xhsc/directive/xj/xjRecheckPopup.html","<div class=\"recheck slideTop\" id=\"recheck\" style=\"position: fixed;top:0;left:0;bottom:0;right:0;background: transparent;z-index:28;box-shadow:0 0 0 transparent;border-bottom: none;\" ng-class=\"{\'slidedown\':slideShow}\"></div><div class=\"slideTop\" id=\"slideTop\" ng-class=\"{\'slidedown\':slideShow}\"><md-list style=\"margin-top: 0\"><md-list-item><label>问题描述</label><p>{{data.value.ProblemDescription}}</p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>首验照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改照片</label><p><span ng-if=\"Record.zb && images.zb.length\" class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length}}</i></span><md-button style=\"min-width: 40px;\" class=\"addphoto\" ng-click=\"addPhoto(warter)\"><img src=\"app/main/xhsc/images/plus-gx.png\" width=\"40\"></md-button></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>备注</label><p><input placeholder=\"备注\" style=\"border: none;\" ng-model=\"Record.zb.Remark\"></p></md-list-item><md-list-item ng-if=\"role == \'zb\'\"><label>整改状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==16?\'已整改\':\'未整改\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"16\" ng-false-value=\"1\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改前照片</label><p><span class=\"photo\" ng-click=\"playImage(images.jl)\"><i>照片</i><i>{{images.jl.length}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'||role==\'\'\"><label>整改后照片</label><p><span class=\"photo\" ng-click=\"playImage(images.zb)\"><i>照片</i><i>{{images.zb.length||0}}</i></span></p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>备注</label><p>{{Record.zb.Remark || \'无\'}}</p></md-list-item><md-list-item ng-if=\"role == \'jl\'\"><label>复验状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item><md-list-item ng-if=\"role==\'zj\'\"><label>状态</label><p style=\"text-align: right;margin-right:70px;\">{{data.value.Status==2?\'合格\':\'不合格\'}}<md-switch ng-model=\"data.value.Status\" ng-true-value=\"2\" ng-false-value=\"4\" class=\"md-secondary\"></md-switch></p></md-list-item></md-list><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\" style=\"padding:6px 0;margin:0;border-right:1px solid #dedede;border-radius:0;\">取消</md-button><md-button flex=\"\" ng-click=\"submit()\" style=\"padding:6px 0;margin:0;\">确定</md-button></div></div>");
$templateCache.put("app/main/xhsc/procedure/self/selfGx.html","<gx-selet flex=\"\" layout=\"column\" model=\"single\" selected=\"vm.selected\"></gx-selet>");
$templateCache.put("app/main/xhsc/procedure/self/selfMain.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\" ng-if=\"vm.isOver\"><div class=\"gxheadzb\"><ul><li ui-sref=\"app.xhsc.gx.selfGx\"><img src=\"app/main/xhsc/images/zbzj.png\"><p>创建自检单</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list style=\"background-color: #FFFFFF\"><md-list-item style=\"gubackground-color: #FFFFFF\" ng-repeat=\"k in vm.Inspections\" layout=\"row\" ng-click=\"vm.jlysAction(k)\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{k.Describe}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">未关闭</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(k,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/main/xhsc/procedure/self/selfPicture.html","<div layout=\"row\" style=\"background-color: rgb(245,246,245);border-bottom: 1px solid #d8d8d8\"><div flex=\"\" layout=\"row\"><md-button flex=\"\" ng-click=\"vm.open(\'acceptItem\')\">{{current.procedure.AcceptanceItemName||\'工序\'}}</md-button></div><div flex=\"\" layout=\"row\" style=\"border-right:1px solid #d8d8d8\"><md-button flex=\"\" ng-click=\"vm.open(\'region\')\">{{current.region.fullName||\'区 域\'}}</md-button></div></div><md-sidenav class=\"md-sidenav-left\" md-component-id=\"acceptItem\" md-whiteframe=\"4\" style=\"min-width: 70%\"><md-toolbar class=\"md-theme-indigo\" layout=\"row\"><span class=\"md-toolbar-tools\" style=\"font-size: 14px\">可选工序</span> <span flex=\"\"></span></md-toolbar><md-list style=\"background-color: rgb(255,255,255)\"><md-list-item ng-repeat=\"item in vm.procedure\" ng-click=\"vm.selectItem(item)\">{{item.AcceptanceItemName}}<md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></md-list></md-sidenav><md-sidenav class=\"md-sidenav-right\" md-component-id=\"region\" md-whiteframe=\"4\" style=\"min-width: 70%;background-color: white\" layout=\"column\"><div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span>全部</span><span>{{vm.num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未检</span><span>{{vm.wy_num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"ng\"></i>不合格</span><span>{{vm.bhg_num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"pass\"></i>合格</span><span>{{vm.hg_num}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div flex=\"\" ng-repeat=\"h in vm.houses\" ng-show=\"vm.loaded\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\">{{h.RegionName }}</p><div class=\"floor-list gxroomlist\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item ng-repeat=\"d in vm.building\" class=\"repeat\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><md-list ng-if=\"maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-if=\"c.Children.length\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selectRegion(c)\" class=\"room-st {{c.style}}\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{c.Percentage}}%\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-repeat=\"r in d.floors\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list><div layout=\"column\" ng-if=\"maxRegion ==8\"><md-list class=\"roomllist\" ng-if=\"!d.show\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-virtual-repeat-container></div></div></md-content></md-sidenav><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" self-accept=\"vm.info.current\" inspection-id=\"vm.inspectionID\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\" gx=\"current.procedure\" img-id=\"vm.imgId\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><self-accept-popup warter=\"vm.water\"></self-accept-popup></div>");
$templateCache.put("app/main/xhsc/procedure/self/selfRegion.html","<building-selet flex=\"\" layout=\"column\" selected=\"vm.selected\"></building-selet>");
$templateCache.put("app/main/xhsc/procedure/self/selfRegionTemp.html","<md-dialog aria-label=\"新建\" style=\"min-height: 250px;width: 80%;max-width: 450px\" ng-cloak=\"\"><md-dialog-content layout=\"column\" style=\"margin:15px 8px 8px 0px\"><form name=\"myForm\" flex=\"\" layout=\"column\"><md-input-container><label>描述</label> <input ng-model=\"describe\" required=\"\" name=\"subject\"><div ng-messages=\"myForm.subject.$error\"><div ng-message-exp=\"[\'required\']\">主题不能为空</div></div></md-input-container><div layout=\"row\"><md-button flex=\"\" ng-click=\"cancel()\">取消</md-button><md-button type=\"submit\" flex=\"\" ng-disabled=\"myForm.$invalid\" ng-click=\"ok(myForm)\">确定</md-button></div></form></md-dialog-content></md-dialog>,");
$templateCache.put("app/main/xhsc/safeCiviliz/self/safe_region.html","<building-selet flex=\"\" layout=\"column\" selected=\"vm.selected\"></building-selet>");
$templateCache.put("app/main/xhsc/safeCiviliz/self/safe_self_accept.html","<div layout=\"row\" style=\"background-color: rgb(245,246,245);border-bottom: 1px solid #d8d8d8\"><div flex=\"\" layout=\"row\"><md-button flex=\"\" ng-click=\"vm.open(\'acceptItem\')\">{{current.procedure.AcceptanceItemName||\'工序\'}}</md-button></div><div flex=\"\" layout=\"row\" style=\"border-right:1px solid #d8d8d8\"><md-button flex=\"\" ng-click=\"vm.open(\'region\')\">{{current.region.fullName||\'区 域\'}}</md-button></div></div><md-sidenav class=\"md-sidenav-left\" md-component-id=\"acceptItem\" md-whiteframe=\"4\" style=\"min-width: 70%\"><md-toolbar class=\"md-theme-indigo\" layout=\"row\"><span class=\"md-toolbar-tools\" style=\"font-size: 14px\">可选工序</span> <span flex=\"\"></span></md-toolbar><md-list style=\"background-color: rgb(255,255,255)\"><md-list-item ng-repeat=\"item in vm.procedure\" ng-click=\"vm.selectItem(item)\">{{item.AcceptanceItemName}}<md-divider style=\"margin-left: 16px\" ng-if=\"!$last\"></md-divider></md-list-item></md-list></md-sidenav><md-sidenav class=\"md-sidenav-right\" md-component-id=\"region\" md-whiteframe=\"4\" style=\"min-width: 70%;background-color: white\" layout=\"column\"><div flex=\"none\" layout=\"column\" style=\"max-height:50px;height:50px;width:100%;z-index: 10;\" class=\"gxxz\"><md-list flex=\"\" layout=\"row\" class=\"gxfilter\"><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span>全部</span><span>{{vm.num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"wait\"></i>未检</span><span>{{vm.wy_num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"ng\"></i>不合格</span><span>{{vm.bhg_num}}</span></md-button></md-list-item><md-list-item flex=\"\"><md-button style=\"margin:6px auto;\"><span><i class=\"pass\"></i>合格</span><span>{{vm.hg_num}}</span></md-button></md-list-item></md-list></div><md-content flex=\"\" ng-cloak=\"\" style=\"background:#f4f4f4;\" layout=\"column\"><div layout=\"row\" layout-sm=\"column\" layout-align=\"space-around\" ng-show=\"!vm.loaded\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div flex=\"\" ng-repeat=\"h in vm.houses\" ng-show=\"vm.loaded\" layout=\"column\"><p style=\"font-size:12px;background: #f4f4f6;padding:10px;margin:0;\">{{h.RegionName }}</p><div class=\"floor-list gxroomlist\" layout=\"column\" flex=\"\"><md-virtual-repeat-container flex=\"\"><md-list-item ng-repeat=\"d in vm.building\" class=\"repeat\" style=\"padding:0;background: #fff;margin-bottom:10px;border-top:1px solid #dedede;\"><div flex=\"\"><div flex=\"\" class=\"gxrooms\" style=\"padding-left:10px;padding-right:10px;\"><span class=\"roomname\">{{d.RegionName}}</span><md-button ng-click=\"vm.zk(d)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"d.show\">展开</span><span ng-show=\"!d.show\">收起</span></md-button></div><md-list ng-if=\"maxRegion>8\" style=\"padding-left:10px;padding-right:10px;\"><md-list-item ng-if=\"c.Children.length\" ng-repeat=\"c in d.Children|filter:{}\"><div flex=\"\" layout=\"column\"><div flex=\"\" class=\"gxrooms\" style=\"overflow: hidden;\"><div style=\"width:20%;float:left;padding:2px 5px;\"><div ng-click=\"vm.selectRegion(c)\" class=\"room-st {{c.style}}\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{c.Percentage}}%\"></div><span>{{c.RegionName}}</span></div></div><md-button ng-click=\"vm.zk(c)\" style=\"color:#49affe;min-width: 50px;\"><span ng-show=\"c.show\">展开</span><span ng-show=\"!c.show\">收起</span></md-button></div><md-list class=\"roomllist\" ng-if=\"!c.show\" style=\"border-bottom: 1px solid #dedede;margin-top:10px;\"><md-list-item ng-repeat=\"r in c.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></md-list-item><section><div class=\"roomllist\"><md-list-item ng-repeat=\"r in d.floors\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:{{r.Percentage}}%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></div></section></md-list><div layout=\"column\" ng-if=\"maxRegion ==8\"><md-list class=\"roomllist\" ng-if=\"!d.show\" style=\"border-bottom: 1px solid #dedede;padding:10px 5px 0;\"><md-list-item ng-repeat=\"r in d.Children\"><div class=\"room-st {{r.style}}\" ng-click=\"vm.selectRegion(r)\" ng-class=\"{\'checked\':r.checked}\"><div style=\"height:100%;width:100%;\"></div><span>{{r.RegionName}}</span></div></md-list-item></md-list></div></div></md-list-item></md-virtual-repeat-container></div></div></md-content></md-sidenav><div class=\"mapcheck\" layout=\"column\" style=\"position: relative\" flex=\"\" safe-self-accept=\"vm.info.current\" inspection-id=\"vm.inspectionID\" procedure=\"current.procedure.AcceptanceItemID\" ct=\"vm.info\" region-id=\"current.region.RegionID\" ng-if=\"vm.info.show\" gx=\"current.procedure\" img-id=\"vm.imgId\"><div flex=\"\" layout=\"row\" layout-align=\"center center\" ng-if=\"vm.info.loading\"><md-progress-circular md-mode=\"indeterminate\" md-diameter=\"28\"></md-progress-circular></div><div style=\"position: absolute;z-index: 79;bottom: 0px;right: 0px\" ng-show=\"vm.info.current\"><md-button class=\"md-fab md-mini md-green\" fast-click=\"vm.cancelCurrent($event)\"><md-icon md-font-icon=\"icon-undo-variant\"></md-icon></md-button></div></div><md-divider></md-divider><safe-slide-menu flex=\"none\" style=\"height: 195px\" ng-if=\"vm.info.show\" layout=\"column\" slide-data=\"vm.procedureData\" current=\"vm.info.current\" show-check=\"true\" level=\"2\"></safe-slide-menu><div style=\"display: none\"><safe-self-accept-popup warter=\"vm.water\"></safe-self-accept-popup></div>");
$templateCache.put("app/main/xhsc/safeCiviliz/self/safe_self_item.html","<safe-item-selet flex=\"\" layout=\"column\" model=\"single\" selected=\"vm.selected\"></safe-item-selet>");
$templateCache.put("app/main/xhsc/safeCiviliz/self/safe_self_main.html","<md-progress-circular id=\"toolbar-progress\" ng-if=\"!vm.isOver\" class=\"md-accent\" md-mode=\"indeterminate\" md-diameter=\"28\" style=\"margin-left: 8px;margin-top: 8px\"></md-progress-circular><div flex=\"\" class=\"gxbg\" layout=\"column\" ms-scroll=\"\" ng-if=\"vm.isOver\"><div class=\"gxheadzb\"><ul><li ui-sref=\"app.xhsc.sf.selfItem\"><img src=\"app/main/xhsc/images/zbzj.png\"><p>创建自检单</p></li><li ng-click=\"vm.upload()\"><img src=\"app/main/xhsc/images/upload.png\"><p>离线上传</p></li></ul></div><div flex=\"\" style=\"background-color: white;\"><md-list style=\"background-color: #FFFFFF\"><md-list-item style=\"gubackground-color: #FFFFFF\" ng-repeat=\"k in vm.Inspections\" layout=\"row\" ng-click=\"vm.jlysAction(k)\"><div layout=\"column\" flex=\"80\" style=\"padding-bottom: 16px\"><p style=\"padding-right: 20px;font-size:16px;line-height: 20px;padding-left:8px;margin-bottom: 0px\">{{k.Describe}} <span style=\"margin-left:2%;color:white;background-color: #ff6d1f;font-size:12px;border-radius: 3px\">未关闭</span></p></div><span flex=\"\"></span><md-button ng-click=\"vm.jlysbtnAction(k,$event)\" class=\"md-icon-button\" aria-label=\"More\"><img ng-src=\"app/main/xhsc/images/more_vert.svg\"></md-button><span class=\"border1px bottom1px\"></span></md-list-item></md-list></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-1/template-1.html","<div class=\"template-1\"><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div><div class=\"content pv-24 ph-16\"><div class=\"title h1\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div><div class=\"text pt-16\" ng-if=\"card.text\">{{card.text}}</div></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-10/template-10.html","<div class=\"template-10 p-16\"><div class=\"pb-16\" layout=\"row\" layout-align=\"space-between center\"><div class=\"info\"><div class=\"title secondary-text\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle h2\" ng-if=\"card.subtitle\">{{card.subtitle}}</div></div><div class=\"media ml-16\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div></div><div class=\"text\">{{card.text}}</div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-2/template-2.html","<div class=\"template-2\"><div class=\"header p-16\" layout=\"row\" layout-align=\"start center\"><div ng-if=\"card.avatar\"><img class=\"avatar mr-16\" ng-src=\"{{card.avatar.src}}\" alt=\"{{card.avatar.alt}}\"></div><div class=\"info\"><div class=\"title\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div></div></div><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div><div class=\"text p-16\" ng-if=\"card.text\">{{card.text}}</div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-3/template-3.html","<div class=\"template-3 p-16 teal-bg white-fg\" layout=\"row\" layout-align=\"space-between\"><div layout=\"column\" layout-align=\"space-between\"><div class=\"info\"><div class=\"title h1\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle h3 secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div></div><div class=\"cta\"><md-button class=\"m-0\">{{card.cta}}</md-button></div></div><div class=\"media pl-16\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-4/template-4.html","<div class=\"template-4\"><div class=\"info white-fg ph-16 pv-24\"><div class=\"title h1\" ng-if=\"card.title\">{{card.title}}</div><div class=\"text\" ng-if=\"card.text\">{{card.text}}</div></div><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-5/template-5.html","<div class=\"template-5 p-16\" layout=\"row\" layout-align=\"space-between start\"><div class=\"info\"><div class=\"title secondary-text\" ng-if=\"card.title\">{{card.title}}</div><div class=\"event h2\" ng-if=\"card.event\">{{card.event}}</div></div><div class=\"media ml-16\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-6/template-6.html","<div class=\"template-6\"><div class=\"content pv-24 ph-16\"><div class=\"subtitle secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div><div class=\"title h2\" ng-if=\"card.title\">{{card.title}}</div><div class=\"text pt-8\" ng-if=\"card.text\">{{card.text}}</div></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-7/template-7.html","<div class=\"template-7\" layout=\"row\" layout-align=\"space-between\"><div class=\"info\" layout=\"column\" layout-align=\"space-between\" layout-fill=\"\" flex=\"\"><div class=\"p-16\"><div class=\"title h1\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle h4 secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div><div class=\"text h4 pt-8\" ng-if=\"card.text\">{{card.text}}</div></div><div><md-divider></md-divider><div class=\"p-8\" layout=\"row\"><md-icon md-font-icon=\"icon-star-outline\" class=\"mh-5\"></md-icon><md-icon md-font-icon=\"icon-star-outline\" class=\"mh-5\"></md-icon><md-icon md-font-icon=\"icon-star-outline\" class=\"mh-5\"></md-icon><md-icon md-font-icon=\"icon-star-outline\" class=\"mh-5\"></md-icon><md-icon md-font-icon=\"icon-star-outline\" class=\"mh-5\"></md-icon></div></div></div><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-8/template-8.html","<div class=\"template-8\"><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div><div class=\"content pv-24 ph-16\"><div class=\"title h1\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div><div class=\"buttons pt-16\"><md-button class=\"m-0\">{{card.button1}}</md-button><md-button class=\"m-0 md-accent\">{{card.button2}}</md-button></div><div class=\"text pt-16\" ng-if=\"card.text\">{{card.text}}</div></div></div>");
$templateCache.put("app/core/directives/ms-card/templates/template-9/template-9.html","<div class=\"template-9\"><div class=\"header p-16\" layout=\"row\" layout-align=\"start center\"><div ng-if=\"card.avatar\"><img class=\"avatar mr-16\" ng-src=\"{{card.avatar.src}}\" alt=\"{{card.avatar.alt}}\"></div><div class=\"info\"><div class=\"title\" ng-if=\"card.title\">{{card.title}}</div><div class=\"subtitle secondary-text\" ng-if=\"card.subtitle\">{{card.subtitle}}</div></div></div><div class=\"text ph-16 pb-16\" ng-if=\"card.text\">{{card.text}}</div><div class=\"media\"><img class=\"image\" ng-src=\"{{card.media.image.src}}\" alt=\"{{card.media.image.alt}}\" ng-show=\"card.media.image\"></div><div class=\"buttons m-8\"><md-button class=\"md-icon-button mr-16\" aria-label=\"Favorite\"><md-icon md-font-icon=\"icon-heart-outline\" class=\"s24\"></md-icon></md-button><md-button class=\"md-icon-button\" aria-label=\"Share\"><md-icon md-font-icon=\"icon-share\" class=\"s24\"></md-icon></md-button></div></div>");
$templateCache.put("app/core/directives/ms-stepper/templates/horizontal/horizontal.html","<div class=\"ms-stepper-horizontal\"><div class=\"ms-stepper-navigation-wrapper\"><div class=\"ms-stepper-navigation\" layout=\"row\" layout-align=\"center center\"><md-button class=\"ms-stepper-navigation-item\" ng-class=\"{\'current\': MsStepper.isStepCurrent(step.stepNumber), \'valid\': MsStepper.isStepValid(step.stepNumber), \'disabled\': MsStepper.isStepDisabled(step.stepNumber), \'optional\': MsStepper.isStepOptional(step.stepNumber)}\" ng-click=\"MsStepper.gotoStep(step.stepNumber)\" ng-disabled=\"MsStepper.isStepDisabled(step.stepNumber)\" ng-repeat=\"step in MsStepper.steps\" layout=\"row\" layout-align=\"start center\"><div class=\"step md-accent-bg\" layout=\"row\" layout-align=\"center center\"><span ng-if=\"!MsStepper.isStepValid(step.stepNumber) || MsStepper.isStepOptional(step.stepNumber)\">{{step.stepNumber}}</span> <span ng-if=\"MsStepper.isStepValid(step.stepNumber) && !MsStepper.isStepOptional(step.stepNumber)\"><i class=\"icon icon-check s18\"></i></span></div><div layout=\"column\" layout-align=\"start start\"><div class=\"title\">{{step.stepTitle}}</div><div class=\"subtitle\" ng-if=\"MsStepper.isStepOptional(step.stepNumber)\">Optional</div></div></md-button></div></div><div class=\"ms-stepper-steps\" ng-transclude=\"\"></div><div class=\"ms-stepper-controls\" layout=\"row\" layout-align=\"center center\"><md-button class=\"md-accent md-raised\" ng-disabled=\"MsStepper.isFirstStep()\" ng-click=\"MsStepper.gotoPreviousStep()\">Back</md-button><div class=\"ms-stepper-dots\"><span ng-repeat=\"step in MsStepper.steps\" ng-class=\"{\'selected md-accent-bg\':MsStepper.currentStepNumber === $index + 1}\"></span></div><md-button class=\"md-accent md-raised\" ng-if=\"!MsStepper.isLastStep()\" ng-disabled=\"!MsStepper.isStepValid(MsStepper.currentStepNumber)\" ng-click=\"MsStepper.gotoNextStep()\">Next</md-button><md-button type=\"submit\" class=\"md-accent md-raised\" ng-click=\"MsStepper.resetForm()\" ng-if=\"MsStepper.isLastStep()\" ng-disabled=\"!MsStepper.isFormValid()\">Submit</md-button></div></div>");}]);